function gN(i,e){for(var t=0;t<e.length;t++){const s=e[t];if(typeof s!="string"&&!Array.isArray(s)){for(const r in s)if(r!=="default"&&!(r in i)){const n=Object.getOwnPropertyDescriptor(s,r);n&&Object.defineProperty(i,r,n.get?n:{enumerable:!0,get:()=>s[r]})}}}return Object.freeze(Object.defineProperty(i,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const n of r)if(n.type==="childList")for(const a of n.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function t(r){const n={};return r.integrity&&(n.integrity=r.integrity),r.referrerPolicy&&(n.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?n.credentials="include":r.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(r){if(r.ep)return;r.ep=!0;const n=t(r);fetch(r.href,n)}})();var ys=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function im(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var dw={exports:{}},Jc={},fw={exports:{}},tt={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Tu=Symbol.for("react.element"),mN=Symbol.for("react.portal"),yN=Symbol.for("react.fragment"),bN=Symbol.for("react.strict_mode"),SN=Symbol.for("react.profiler"),wN=Symbol.for("react.provider"),vN=Symbol.for("react.context"),kN=Symbol.for("react.forward_ref"),xN=Symbol.for("react.suspense"),_N=Symbol.for("react.memo"),TN=Symbol.for("react.lazy"),py=Symbol.iterator;function NN(i){return i===null||typeof i!="object"?null:(i=py&&i[py]||i["@@iterator"],typeof i=="function"?i:null)}var pw={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},gw=Object.assign,mw={};function Uo(i,e,t){this.props=i,this.context=e,this.refs=mw,this.updater=t||pw}Uo.prototype.isReactComponent={};Uo.prototype.setState=function(i,e){if(typeof i!="object"&&typeof i!="function"&&i!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,i,e,"setState")};Uo.prototype.forceUpdate=function(i){this.updater.enqueueForceUpdate(this,i,"forceUpdate")};function yw(){}yw.prototype=Uo.prototype;function sm(i,e,t){this.props=i,this.context=e,this.refs=mw,this.updater=t||pw}var rm=sm.prototype=new yw;rm.constructor=sm;gw(rm,Uo.prototype);rm.isPureReactComponent=!0;var gy=Array.isArray,bw=Object.prototype.hasOwnProperty,nm={current:null},Sw={key:!0,ref:!0,__self:!0,__source:!0};function ww(i,e,t){var s,r={},n=null,a=null;if(e!=null)for(s in e.ref!==void 0&&(a=e.ref),e.key!==void 0&&(n=""+e.key),e)bw.call(e,s)&&!Sw.hasOwnProperty(s)&&(r[s]=e[s]);var o=arguments.length-2;if(o===1)r.children=t;else if(1<o){for(var l=Array(o),u=0;u<o;u++)l[u]=arguments[u+2];r.children=l}if(i&&i.defaultProps)for(s in o=i.defaultProps,o)r[s]===void 0&&(r[s]=o[s]);return{$$typeof:Tu,type:i,key:n,ref:a,props:r,_owner:nm.current}}function BN(i,e){return{$$typeof:Tu,type:i.type,key:e,ref:i.ref,props:i.props,_owner:i._owner}}function am(i){return typeof i=="object"&&i!==null&&i.$$typeof===Tu}function CN(i){var e={"=":"=0",":":"=2"};return"$"+i.replace(/[=:]/g,function(t){return e[t]})}var my=/\/+/g;function $d(i,e){return typeof i=="object"&&i!==null&&i.key!=null?CN(""+i.key):e.toString(36)}function Nh(i,e,t,s,r){var n=typeof i;(n==="undefined"||n==="boolean")&&(i=null);var a=!1;if(i===null)a=!0;else switch(n){case"string":case"number":a=!0;break;case"object":switch(i.$$typeof){case Tu:case mN:a=!0}}if(a)return a=i,r=r(a),i=s===""?"."+$d(a,0):s,gy(r)?(t="",i!=null&&(t=i.replace(my,"$&/")+"/"),Nh(r,e,t,"",function(u){return u})):r!=null&&(am(r)&&(r=BN(r,t+(!r.key||a&&a.key===r.key?"":(""+r.key).replace(my,"$&/")+"/")+i)),e.push(r)),1;if(a=0,s=s===""?".":s+":",gy(i))for(var o=0;o<i.length;o++){n=i[o];var l=s+$d(n,o);a+=Nh(n,e,t,l,r)}else if(l=NN(i),typeof l=="function")for(i=l.call(i),o=0;!(n=i.next()).done;)n=n.value,l=s+$d(n,o++),a+=Nh(n,e,t,l,r);else if(n==="object")throw e=String(i),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(i).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return a}function Yu(i,e,t){if(i==null)return i;var s=[],r=0;return Nh(i,s,"","",function(n){return e.call(t,n,r++)}),s}function PN(i){if(i._status===-1){var e=i._result;e=e(),e.then(function(t){(i._status===0||i._status===-1)&&(i._status=1,i._result=t)},function(t){(i._status===0||i._status===-1)&&(i._status=2,i._result=t)}),i._status===-1&&(i._status=0,i._result=e)}if(i._status===1)return i._result.default;throw i._result}var ns={current:null},Bh={transition:null},MN={ReactCurrentDispatcher:ns,ReactCurrentBatchConfig:Bh,ReactCurrentOwner:nm};tt.Children={map:Yu,forEach:function(i,e,t){Yu(i,function(){e.apply(this,arguments)},t)},count:function(i){var e=0;return Yu(i,function(){e++}),e},toArray:function(i){return Yu(i,function(e){return e})||[]},only:function(i){if(!am(i))throw Error("React.Children.only expected to receive a single React element child.");return i}};tt.Component=Uo;tt.Fragment=yN;tt.Profiler=SN;tt.PureComponent=sm;tt.StrictMode=bN;tt.Suspense=xN;tt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=MN;tt.cloneElement=function(i,e,t){if(i==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+i+".");var s=gw({},i.props),r=i.key,n=i.ref,a=i._owner;if(e!=null){if(e.ref!==void 0&&(n=e.ref,a=nm.current),e.key!==void 0&&(r=""+e.key),i.type&&i.type.defaultProps)var o=i.type.defaultProps;for(l in e)bw.call(e,l)&&!Sw.hasOwnProperty(l)&&(s[l]=e[l]===void 0&&o!==void 0?o[l]:e[l])}var l=arguments.length-2;if(l===1)s.children=t;else if(1<l){o=Array(l);for(var u=0;u<l;u++)o[u]=arguments[u+2];s.children=o}return{$$typeof:Tu,type:i.type,key:r,ref:n,props:s,_owner:a}};tt.createContext=function(i){return i={$$typeof:vN,_currentValue:i,_currentValue2:i,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},i.Provider={$$typeof:wN,_context:i},i.Consumer=i};tt.createElement=ww;tt.createFactory=function(i){var e=ww.bind(null,i);return e.type=i,e};tt.createRef=function(){return{current:null}};tt.forwardRef=function(i){return{$$typeof:kN,render:i}};tt.isValidElement=am;tt.lazy=function(i){return{$$typeof:TN,_payload:{_status:-1,_result:i},_init:PN}};tt.memo=function(i,e){return{$$typeof:_N,type:i,compare:e===void 0?null:e}};tt.startTransition=function(i){var e=Bh.transition;Bh.transition={};try{i()}finally{Bh.transition=e}};tt.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")};tt.useCallback=function(i,e){return ns.current.useCallback(i,e)};tt.useContext=function(i){return ns.current.useContext(i)};tt.useDebugValue=function(){};tt.useDeferredValue=function(i){return ns.current.useDeferredValue(i)};tt.useEffect=function(i,e){return ns.current.useEffect(i,e)};tt.useId=function(){return ns.current.useId()};tt.useImperativeHandle=function(i,e,t){return ns.current.useImperativeHandle(i,e,t)};tt.useInsertionEffect=function(i,e){return ns.current.useInsertionEffect(i,e)};tt.useLayoutEffect=function(i,e){return ns.current.useLayoutEffect(i,e)};tt.useMemo=function(i,e){return ns.current.useMemo(i,e)};tt.useReducer=function(i,e,t){return ns.current.useReducer(i,e,t)};tt.useRef=function(i){return ns.current.useRef(i)};tt.useState=function(i){return ns.current.useState(i)};tt.useSyncExternalStore=function(i,e,t){return ns.current.useSyncExternalStore(i,e,t)};tt.useTransition=function(){return ns.current.useTransition()};tt.version="18.2.0";fw.exports=tt;var P=fw.exports;const tn=im(P),Al=gN({__proto__:null,default:tn},[P]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var EN=P,LN=Symbol.for("react.element"),DN=Symbol.for("react.fragment"),AN=Object.prototype.hasOwnProperty,IN=EN.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,RN={key:!0,ref:!0,__self:!0,__source:!0};function vw(i,e,t){var s,r={},n=null,a=null;t!==void 0&&(n=""+t),e.key!==void 0&&(n=""+e.key),e.ref!==void 0&&(a=e.ref);for(s in e)AN.call(e,s)&&!RN.hasOwnProperty(s)&&(r[s]=e[s]);if(i&&i.defaultProps)for(s in e=i.defaultProps,e)r[s]===void 0&&(r[s]=e[s]);return{$$typeof:LN,type:i,key:n,ref:a,props:r,_owner:IN.current}}Jc.Fragment=DN;Jc.jsx=vw;Jc.jsxs=vw;dw.exports=Jc;var v=dw.exports,kw={exports:{}},Is={},xw={exports:{}},_w={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(i){function e(A,Y){var le=A.length;A.push(Y);e:for(;0<le;){var pe=le-1>>>1,oe=A[pe];if(0<r(oe,Y))A[pe]=Y,A[le]=oe,le=pe;else break e}}function t(A){return A.length===0?null:A[0]}function s(A){if(A.length===0)return null;var Y=A[0],le=A.pop();if(le!==Y){A[0]=le;e:for(var pe=0,oe=A.length,ze=oe>>>1;pe<ze;){var Ye=2*(pe+1)-1,Ie=A[Ye],it=Ye+1,Pt=A[it];if(0>r(Ie,le))it<oe&&0>r(Pt,Ie)?(A[pe]=Pt,A[it]=le,pe=it):(A[pe]=Ie,A[Ye]=le,pe=Ye);else if(it<oe&&0>r(Pt,le))A[pe]=Pt,A[it]=le,pe=it;else break e}}return Y}function r(A,Y){var le=A.sortIndex-Y.sortIndex;return le!==0?le:A.id-Y.id}if(typeof performance=="object"&&typeof performance.now=="function"){var n=performance;i.unstable_now=function(){return n.now()}}else{var a=Date,o=a.now();i.unstable_now=function(){return a.now()-o}}var l=[],u=[],h=1,c=null,d=3,f=!1,p=!1,g=!1,b=typeof setTimeout=="function"?setTimeout:null,m=typeof clearTimeout=="function"?clearTimeout:null,y=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function w(A){for(var Y=t(u);Y!==null;){if(Y.callback===null)s(u);else if(Y.startTime<=A)s(u),Y.sortIndex=Y.expirationTime,e(l,Y);else break;Y=t(u)}}function x(A){if(g=!1,w(A),!p)if(t(l)!==null)p=!0,ae(k);else{var Y=t(u);Y!==null&&ie(x,Y.startTime-A)}}function k(A,Y){p=!1,g&&(g=!1,m(C),C=-1),f=!0;var le=d;try{for(w(Y),c=t(l);c!==null&&(!(c.expirationTime>Y)||A&&!te());){var pe=c.callback;if(typeof pe=="function"){c.callback=null,d=c.priorityLevel;var oe=pe(c.expirationTime<=Y);Y=i.unstable_now(),typeof oe=="function"?c.callback=oe:c===t(l)&&s(l),w(Y)}else s(l);c=t(l)}if(c!==null)var ze=!0;else{var Ye=t(u);Ye!==null&&ie(x,Ye.startTime-Y),ze=!1}return ze}finally{c=null,d=le,f=!1}}var _=!1,T=null,C=-1,W=5,z=-1;function te(){return!(i.unstable_now()-z<W)}function E(){if(T!==null){var A=i.unstable_now();z=A;var Y=!0;try{Y=T(!0,A)}finally{Y?U():(_=!1,T=null)}}else _=!1}var U;if(typeof y=="function")U=function(){y(E)};else if(typeof MessageChannel<"u"){var re=new MessageChannel,K=re.port2;re.port1.onmessage=E,U=function(){K.postMessage(null)}}else U=function(){b(E,0)};function ae(A){T=A,_||(_=!0,U())}function ie(A,Y){C=b(function(){A(i.unstable_now())},Y)}i.unstable_IdlePriority=5,i.unstable_ImmediatePriority=1,i.unstable_LowPriority=4,i.unstable_NormalPriority=3,i.unstable_Profiling=null,i.unstable_UserBlockingPriority=2,i.unstable_cancelCallback=function(A){A.callback=null},i.unstable_continueExecution=function(){p||f||(p=!0,ae(k))},i.unstable_forceFrameRate=function(A){0>A||125<A?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):W=0<A?Math.floor(1e3/A):5},i.unstable_getCurrentPriorityLevel=function(){return d},i.unstable_getFirstCallbackNode=function(){return t(l)},i.unstable_next=function(A){switch(d){case 1:case 2:case 3:var Y=3;break;default:Y=d}var le=d;d=Y;try{return A()}finally{d=le}},i.unstable_pauseExecution=function(){},i.unstable_requestPaint=function(){},i.unstable_runWithPriority=function(A,Y){switch(A){case 1:case 2:case 3:case 4:case 5:break;default:A=3}var le=d;d=A;try{return Y()}finally{d=le}},i.unstable_scheduleCallback=function(A,Y,le){var pe=i.unstable_now();switch(typeof le=="object"&&le!==null?(le=le.delay,le=typeof le=="number"&&0<le?pe+le:pe):le=pe,A){case 1:var oe=-1;break;case 2:oe=250;break;case 5:oe=1073741823;break;case 4:oe=1e4;break;default:oe=5e3}return oe=le+oe,A={id:h++,callback:Y,priorityLevel:A,startTime:le,expirationTime:oe,sortIndex:-1},le>pe?(A.sortIndex=le,e(u,A),t(l)===null&&A===t(u)&&(g?(m(C),C=-1):g=!0,ie(x,le-pe))):(A.sortIndex=oe,e(l,A),p||f||(p=!0,ae(k))),A},i.unstable_shouldYield=te,i.unstable_wrapCallback=function(A){var Y=d;return function(){var le=d;d=Y;try{return A.apply(this,arguments)}finally{d=le}}}})(_w);xw.exports=_w;var ON=xw.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Tw=P,Ls=ON;function J(i){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+i,t=1;t<arguments.length;t++)e+="&args[]="+encodeURIComponent(arguments[t]);return"Minified React error #"+i+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var Nw=new Set,Il={};function Ia(i,e){No(i,e),No(i+"Capture",e)}function No(i,e){for(Il[i]=e,i=0;i<e.length;i++)Nw.add(e[i])}var on=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),pp=Object.prototype.hasOwnProperty,FN=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,yy={},by={};function VN(i){return pp.call(by,i)?!0:pp.call(yy,i)?!1:FN.test(i)?by[i]=!0:(yy[i]=!0,!1)}function HN(i,e,t,s){if(t!==null&&t.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return s?!1:t!==null?!t.acceptsBooleans:(i=i.toLowerCase().slice(0,5),i!=="data-"&&i!=="aria-");default:return!1}}function zN(i,e,t,s){if(e===null||typeof e>"u"||HN(i,e,t,s))return!0;if(s)return!1;if(t!==null)switch(t.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function as(i,e,t,s,r,n,a){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=s,this.attributeNamespace=r,this.mustUseProperty=t,this.propertyName=i,this.type=e,this.sanitizeURL=n,this.removeEmptyString=a}var ji={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(i){ji[i]=new as(i,0,!1,i,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(i){var e=i[0];ji[e]=new as(e,1,!1,i[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(i){ji[i]=new as(i,2,!1,i.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(i){ji[i]=new as(i,2,!1,i,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(i){ji[i]=new as(i,3,!1,i.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(i){ji[i]=new as(i,3,!0,i,null,!1,!1)});["capture","download"].forEach(function(i){ji[i]=new as(i,4,!1,i,null,!1,!1)});["cols","rows","size","span"].forEach(function(i){ji[i]=new as(i,6,!1,i,null,!1,!1)});["rowSpan","start"].forEach(function(i){ji[i]=new as(i,5,!1,i.toLowerCase(),null,!1,!1)});var om=/[\-:]([a-z])/g;function lm(i){return i[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(i){var e=i.replace(om,lm);ji[e]=new as(e,1,!1,i,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(i){var e=i.replace(om,lm);ji[e]=new as(e,1,!1,i,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(i){var e=i.replace(om,lm);ji[e]=new as(e,1,!1,i,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(i){ji[i]=new as(i,1,!1,i.toLowerCase(),null,!1,!1)});ji.xlinkHref=new as("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(i){ji[i]=new as(i,1,!1,i.toLowerCase(),null,!0,!0)});function um(i,e,t,s){var r=ji.hasOwnProperty(e)?ji[e]:null;(r!==null?r.type!==0:s||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(zN(e,t,r,s)&&(t=null),s||r===null?VN(e)&&(t===null?i.removeAttribute(e):i.setAttribute(e,""+t)):r.mustUseProperty?i[r.propertyName]=t===null?r.type===3?!1:"":t:(e=r.attributeName,s=r.attributeNamespace,t===null?i.removeAttribute(e):(r=r.type,t=r===3||r===4&&t===!0?"":""+t,s?i.setAttributeNS(s,e,t):i.setAttribute(e,t))))}var bn=Tw.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Xu=Symbol.for("react.element"),Ka=Symbol.for("react.portal"),Za=Symbol.for("react.fragment"),hm=Symbol.for("react.strict_mode"),gp=Symbol.for("react.profiler"),Bw=Symbol.for("react.provider"),Cw=Symbol.for("react.context"),cm=Symbol.for("react.forward_ref"),mp=Symbol.for("react.suspense"),yp=Symbol.for("react.suspense_list"),dm=Symbol.for("react.memo"),Cn=Symbol.for("react.lazy"),Pw=Symbol.for("react.offscreen"),Sy=Symbol.iterator;function Ko(i){return i===null||typeof i!="object"?null:(i=Sy&&i[Sy]||i["@@iterator"],typeof i=="function"?i:null)}var $t=Object.assign,Yd;function cl(i){if(Yd===void 0)try{throw Error()}catch(t){var e=t.stack.trim().match(/\n( *(at )?)/);Yd=e&&e[1]||""}return`
`+Yd+i}var Xd=!1;function Qd(i,e){if(!i||Xd)return"";Xd=!0;var t=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(u){var s=u}Reflect.construct(i,[],e)}else{try{e.call()}catch(u){s=u}i.call(e.prototype)}else{try{throw Error()}catch(u){s=u}i()}}catch(u){if(u&&s&&typeof u.stack=="string"){for(var r=u.stack.split(`
`),n=s.stack.split(`
`),a=r.length-1,o=n.length-1;1<=a&&0<=o&&r[a]!==n[o];)o--;for(;1<=a&&0<=o;a--,o--)if(r[a]!==n[o]){if(a!==1||o!==1)do if(a--,o--,0>o||r[a]!==n[o]){var l=`
`+r[a].replace(" at new "," at ");return i.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",i.displayName)),l}while(1<=a&&0<=o);break}}}finally{Xd=!1,Error.prepareStackTrace=t}return(i=i?i.displayName||i.name:"")?cl(i):""}function WN(i){switch(i.tag){case 5:return cl(i.type);case 16:return cl("Lazy");case 13:return cl("Suspense");case 19:return cl("SuspenseList");case 0:case 2:case 15:return i=Qd(i.type,!1),i;case 11:return i=Qd(i.type.render,!1),i;case 1:return i=Qd(i.type,!0),i;default:return""}}function bp(i){if(i==null)return null;if(typeof i=="function")return i.displayName||i.name||null;if(typeof i=="string")return i;switch(i){case Za:return"Fragment";case Ka:return"Portal";case gp:return"Profiler";case hm:return"StrictMode";case mp:return"Suspense";case yp:return"SuspenseList"}if(typeof i=="object")switch(i.$$typeof){case Cw:return(i.displayName||"Context")+".Consumer";case Bw:return(i._context.displayName||"Context")+".Provider";case cm:var e=i.render;return i=i.displayName,i||(i=e.displayName||e.name||"",i=i!==""?"ForwardRef("+i+")":"ForwardRef"),i;case dm:return e=i.displayName||null,e!==null?e:bp(i.type)||"Memo";case Cn:e=i._payload,i=i._init;try{return bp(i(e))}catch{}}return null}function GN(i){var e=i.type;switch(i.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return i=e.render,i=i.displayName||i.name||"",e.displayName||(i!==""?"ForwardRef("+i+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return bp(e);case 8:return e===hm?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function $n(i){switch(typeof i){case"boolean":case"number":case"string":case"undefined":return i;case"object":return i;default:return""}}function Mw(i){var e=i.type;return(i=i.nodeName)&&i.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function jN(i){var e=Mw(i)?"checked":"value",t=Object.getOwnPropertyDescriptor(i.constructor.prototype,e),s=""+i[e];if(!i.hasOwnProperty(e)&&typeof t<"u"&&typeof t.get=="function"&&typeof t.set=="function"){var r=t.get,n=t.set;return Object.defineProperty(i,e,{configurable:!0,get:function(){return r.call(this)},set:function(a){s=""+a,n.call(this,a)}}),Object.defineProperty(i,e,{enumerable:t.enumerable}),{getValue:function(){return s},setValue:function(a){s=""+a},stopTracking:function(){i._valueTracker=null,delete i[e]}}}}function Qu(i){i._valueTracker||(i._valueTracker=jN(i))}function Ew(i){if(!i)return!1;var e=i._valueTracker;if(!e)return!0;var t=e.getValue(),s="";return i&&(s=Mw(i)?i.checked?"true":"false":i.value),i=s,i!==t?(e.setValue(i),!0):!1}function $h(i){if(i=i||(typeof document<"u"?document:void 0),typeof i>"u")return null;try{return i.activeElement||i.body}catch{return i.body}}function Sp(i,e){var t=e.checked;return $t({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:t??i._wrapperState.initialChecked})}function wy(i,e){var t=e.defaultValue==null?"":e.defaultValue,s=e.checked!=null?e.checked:e.defaultChecked;t=$n(e.value!=null?e.value:t),i._wrapperState={initialChecked:s,initialValue:t,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function Lw(i,e){e=e.checked,e!=null&&um(i,"checked",e,!1)}function wp(i,e){Lw(i,e);var t=$n(e.value),s=e.type;if(t!=null)s==="number"?(t===0&&i.value===""||i.value!=t)&&(i.value=""+t):i.value!==""+t&&(i.value=""+t);else if(s==="submit"||s==="reset"){i.removeAttribute("value");return}e.hasOwnProperty("value")?vp(i,e.type,t):e.hasOwnProperty("defaultValue")&&vp(i,e.type,$n(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(i.defaultChecked=!!e.defaultChecked)}function vy(i,e,t){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var s=e.type;if(!(s!=="submit"&&s!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+i._wrapperState.initialValue,t||e===i.value||(i.value=e),i.defaultValue=e}t=i.name,t!==""&&(i.name=""),i.defaultChecked=!!i._wrapperState.initialChecked,t!==""&&(i.name=t)}function vp(i,e,t){(e!=="number"||$h(i.ownerDocument)!==i)&&(t==null?i.defaultValue=""+i._wrapperState.initialValue:i.defaultValue!==""+t&&(i.defaultValue=""+t))}var dl=Array.isArray;function mo(i,e,t,s){if(i=i.options,e){e={};for(var r=0;r<t.length;r++)e["$"+t[r]]=!0;for(t=0;t<i.length;t++)r=e.hasOwnProperty("$"+i[t].value),i[t].selected!==r&&(i[t].selected=r),r&&s&&(i[t].defaultSelected=!0)}else{for(t=""+$n(t),e=null,r=0;r<i.length;r++){if(i[r].value===t){i[r].selected=!0,s&&(i[r].defaultSelected=!0);return}e!==null||i[r].disabled||(e=i[r])}e!==null&&(e.selected=!0)}}function kp(i,e){if(e.dangerouslySetInnerHTML!=null)throw Error(J(91));return $t({},e,{value:void 0,defaultValue:void 0,children:""+i._wrapperState.initialValue})}function ky(i,e){var t=e.value;if(t==null){if(t=e.children,e=e.defaultValue,t!=null){if(e!=null)throw Error(J(92));if(dl(t)){if(1<t.length)throw Error(J(93));t=t[0]}e=t}e==null&&(e=""),t=e}i._wrapperState={initialValue:$n(t)}}function Dw(i,e){var t=$n(e.value),s=$n(e.defaultValue);t!=null&&(t=""+t,t!==i.value&&(i.value=t),e.defaultValue==null&&i.defaultValue!==t&&(i.defaultValue=t)),s!=null&&(i.defaultValue=""+s)}function xy(i){var e=i.textContent;e===i._wrapperState.initialValue&&e!==""&&e!==null&&(i.value=e)}function Aw(i){switch(i){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function xp(i,e){return i==null||i==="http://www.w3.org/1999/xhtml"?Aw(e):i==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":i}var Ju,Iw=function(i){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,t,s,r){MSApp.execUnsafeLocalFunction(function(){return i(e,t,s,r)})}:i}(function(i,e){if(i.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in i)i.innerHTML=e;else{for(Ju=Ju||document.createElement("div"),Ju.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=Ju.firstChild;i.firstChild;)i.removeChild(i.firstChild);for(;e.firstChild;)i.appendChild(e.firstChild)}});function Rl(i,e){if(e){var t=i.firstChild;if(t&&t===i.lastChild&&t.nodeType===3){t.nodeValue=e;return}}i.textContent=e}var Sl={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},UN=["Webkit","ms","Moz","O"];Object.keys(Sl).forEach(function(i){UN.forEach(function(e){e=e+i.charAt(0).toUpperCase()+i.substring(1),Sl[e]=Sl[i]})});function Rw(i,e,t){return e==null||typeof e=="boolean"||e===""?"":t||typeof e!="number"||e===0||Sl.hasOwnProperty(i)&&Sl[i]?(""+e).trim():e+"px"}function Ow(i,e){i=i.style;for(var t in e)if(e.hasOwnProperty(t)){var s=t.indexOf("--")===0,r=Rw(t,e[t],s);t==="float"&&(t="cssFloat"),s?i.setProperty(t,r):i[t]=r}}var $N=$t({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function _p(i,e){if(e){if($N[i]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(J(137,i));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(J(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(J(61))}if(e.style!=null&&typeof e.style!="object")throw Error(J(62))}}function Tp(i,e){if(i.indexOf("-")===-1)return typeof e.is=="string";switch(i){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Np=null;function fm(i){return i=i.target||i.srcElement||window,i.correspondingUseElement&&(i=i.correspondingUseElement),i.nodeType===3?i.parentNode:i}var Bp=null,yo=null,bo=null;function _y(i){if(i=Cu(i)){if(typeof Bp!="function")throw Error(J(280));var e=i.stateNode;e&&(e=td(e),Bp(i.stateNode,i.type,e))}}function Fw(i){yo?bo?bo.push(i):bo=[i]:yo=i}function Vw(){if(yo){var i=yo,e=bo;if(bo=yo=null,_y(i),e)for(i=0;i<e.length;i++)_y(e[i])}}function Hw(i,e){return i(e)}function zw(){}var Jd=!1;function Ww(i,e,t){if(Jd)return i(e,t);Jd=!0;try{return Hw(i,e,t)}finally{Jd=!1,(yo!==null||bo!==null)&&(zw(),Vw())}}function Ol(i,e){var t=i.stateNode;if(t===null)return null;var s=td(t);if(s===null)return null;t=s[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(s=!s.disabled)||(i=i.type,s=!(i==="button"||i==="input"||i==="select"||i==="textarea")),i=!s;break e;default:i=!1}if(i)return null;if(t&&typeof t!="function")throw Error(J(231,e,typeof t));return t}var Cp=!1;if(on)try{var Zo={};Object.defineProperty(Zo,"passive",{get:function(){Cp=!0}}),window.addEventListener("test",Zo,Zo),window.removeEventListener("test",Zo,Zo)}catch{Cp=!1}function YN(i,e,t,s,r,n,a,o,l){var u=Array.prototype.slice.call(arguments,3);try{e.apply(t,u)}catch(h){this.onError(h)}}var wl=!1,Yh=null,Xh=!1,Pp=null,XN={onError:function(i){wl=!0,Yh=i}};function QN(i,e,t,s,r,n,a,o,l){wl=!1,Yh=null,YN.apply(XN,arguments)}function JN(i,e,t,s,r,n,a,o,l){if(QN.apply(this,arguments),wl){if(wl){var u=Yh;wl=!1,Yh=null}else throw Error(J(198));Xh||(Xh=!0,Pp=u)}}function Ra(i){var e=i,t=i;if(i.alternate)for(;e.return;)e=e.return;else{i=e;do e=i,e.flags&4098&&(t=e.return),i=e.return;while(i)}return e.tag===3?t:null}function Gw(i){if(i.tag===13){var e=i.memoizedState;if(e===null&&(i=i.alternate,i!==null&&(e=i.memoizedState)),e!==null)return e.dehydrated}return null}function Ty(i){if(Ra(i)!==i)throw Error(J(188))}function qN(i){var e=i.alternate;if(!e){if(e=Ra(i),e===null)throw Error(J(188));return e!==i?null:i}for(var t=i,s=e;;){var r=t.return;if(r===null)break;var n=r.alternate;if(n===null){if(s=r.return,s!==null){t=s;continue}break}if(r.child===n.child){for(n=r.child;n;){if(n===t)return Ty(r),i;if(n===s)return Ty(r),e;n=n.sibling}throw Error(J(188))}if(t.return!==s.return)t=r,s=n;else{for(var a=!1,o=r.child;o;){if(o===t){a=!0,t=r,s=n;break}if(o===s){a=!0,s=r,t=n;break}o=o.sibling}if(!a){for(o=n.child;o;){if(o===t){a=!0,t=n,s=r;break}if(o===s){a=!0,s=n,t=r;break}o=o.sibling}if(!a)throw Error(J(189))}}if(t.alternate!==s)throw Error(J(190))}if(t.tag!==3)throw Error(J(188));return t.stateNode.current===t?i:e}function jw(i){return i=qN(i),i!==null?Uw(i):null}function Uw(i){if(i.tag===5||i.tag===6)return i;for(i=i.child;i!==null;){var e=Uw(i);if(e!==null)return e;i=i.sibling}return null}var $w=Ls.unstable_scheduleCallback,Ny=Ls.unstable_cancelCallback,KN=Ls.unstable_shouldYield,ZN=Ls.unstable_requestPaint,ti=Ls.unstable_now,eB=Ls.unstable_getCurrentPriorityLevel,pm=Ls.unstable_ImmediatePriority,Yw=Ls.unstable_UserBlockingPriority,Qh=Ls.unstable_NormalPriority,tB=Ls.unstable_LowPriority,Xw=Ls.unstable_IdlePriority,qc=null,Ir=null;function iB(i){if(Ir&&typeof Ir.onCommitFiberRoot=="function")try{Ir.onCommitFiberRoot(qc,i,void 0,(i.current.flags&128)===128)}catch{}}var pr=Math.clz32?Math.clz32:nB,sB=Math.log,rB=Math.LN2;function nB(i){return i>>>=0,i===0?32:31-(sB(i)/rB|0)|0}var qu=64,Ku=4194304;function fl(i){switch(i&-i){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return i&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return i&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return i}}function Jh(i,e){var t=i.pendingLanes;if(t===0)return 0;var s=0,r=i.suspendedLanes,n=i.pingedLanes,a=t&268435455;if(a!==0){var o=a&~r;o!==0?s=fl(o):(n&=a,n!==0&&(s=fl(n)))}else a=t&~r,a!==0?s=fl(a):n!==0&&(s=fl(n));if(s===0)return 0;if(e!==0&&e!==s&&!(e&r)&&(r=s&-s,n=e&-e,r>=n||r===16&&(n&4194240)!==0))return e;if(s&4&&(s|=t&16),e=i.entangledLanes,e!==0)for(i=i.entanglements,e&=s;0<e;)t=31-pr(e),r=1<<t,s|=i[t],e&=~r;return s}function aB(i,e){switch(i){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function oB(i,e){for(var t=i.suspendedLanes,s=i.pingedLanes,r=i.expirationTimes,n=i.pendingLanes;0<n;){var a=31-pr(n),o=1<<a,l=r[a];l===-1?(!(o&t)||o&s)&&(r[a]=aB(o,e)):l<=e&&(i.expiredLanes|=o),n&=~o}}function Mp(i){return i=i.pendingLanes&-1073741825,i!==0?i:i&1073741824?1073741824:0}function Qw(){var i=qu;return qu<<=1,!(qu&4194240)&&(qu=64),i}function qd(i){for(var e=[],t=0;31>t;t++)e.push(i);return e}function Nu(i,e,t){i.pendingLanes|=e,e!==536870912&&(i.suspendedLanes=0,i.pingedLanes=0),i=i.eventTimes,e=31-pr(e),i[e]=t}function lB(i,e){var t=i.pendingLanes&~e;i.pendingLanes=e,i.suspendedLanes=0,i.pingedLanes=0,i.expiredLanes&=e,i.mutableReadLanes&=e,i.entangledLanes&=e,e=i.entanglements;var s=i.eventTimes;for(i=i.expirationTimes;0<t;){var r=31-pr(t),n=1<<r;e[r]=0,s[r]=-1,i[r]=-1,t&=~n}}function gm(i,e){var t=i.entangledLanes|=e;for(i=i.entanglements;t;){var s=31-pr(t),r=1<<s;r&e|i[s]&e&&(i[s]|=e),t&=~r}}var bt=0;function Jw(i){return i&=-i,1<i?4<i?i&268435455?16:536870912:4:1}var qw,mm,Kw,Zw,ev,Ep=!1,Zu=[],On=null,Fn=null,Vn=null,Fl=new Map,Vl=new Map,Ln=[],uB="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function By(i,e){switch(i){case"focusin":case"focusout":On=null;break;case"dragenter":case"dragleave":Fn=null;break;case"mouseover":case"mouseout":Vn=null;break;case"pointerover":case"pointerout":Fl.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":Vl.delete(e.pointerId)}}function el(i,e,t,s,r,n){return i===null||i.nativeEvent!==n?(i={blockedOn:e,domEventName:t,eventSystemFlags:s,nativeEvent:n,targetContainers:[r]},e!==null&&(e=Cu(e),e!==null&&mm(e)),i):(i.eventSystemFlags|=s,e=i.targetContainers,r!==null&&e.indexOf(r)===-1&&e.push(r),i)}function hB(i,e,t,s,r){switch(e){case"focusin":return On=el(On,i,e,t,s,r),!0;case"dragenter":return Fn=el(Fn,i,e,t,s,r),!0;case"mouseover":return Vn=el(Vn,i,e,t,s,r),!0;case"pointerover":var n=r.pointerId;return Fl.set(n,el(Fl.get(n)||null,i,e,t,s,r)),!0;case"gotpointercapture":return n=r.pointerId,Vl.set(n,el(Vl.get(n)||null,i,e,t,s,r)),!0}return!1}function tv(i){var e=aa(i.target);if(e!==null){var t=Ra(e);if(t!==null){if(e=t.tag,e===13){if(e=Gw(t),e!==null){i.blockedOn=e,ev(i.priority,function(){Kw(t)});return}}else if(e===3&&t.stateNode.current.memoizedState.isDehydrated){i.blockedOn=t.tag===3?t.stateNode.containerInfo:null;return}}}i.blockedOn=null}function Ch(i){if(i.blockedOn!==null)return!1;for(var e=i.targetContainers;0<e.length;){var t=Lp(i.domEventName,i.eventSystemFlags,e[0],i.nativeEvent);if(t===null){t=i.nativeEvent;var s=new t.constructor(t.type,t);Np=s,t.target.dispatchEvent(s),Np=null}else return e=Cu(t),e!==null&&mm(e),i.blockedOn=t,!1;e.shift()}return!0}function Cy(i,e,t){Ch(i)&&t.delete(e)}function cB(){Ep=!1,On!==null&&Ch(On)&&(On=null),Fn!==null&&Ch(Fn)&&(Fn=null),Vn!==null&&Ch(Vn)&&(Vn=null),Fl.forEach(Cy),Vl.forEach(Cy)}function tl(i,e){i.blockedOn===e&&(i.blockedOn=null,Ep||(Ep=!0,Ls.unstable_scheduleCallback(Ls.unstable_NormalPriority,cB)))}function Hl(i){function e(r){return tl(r,i)}if(0<Zu.length){tl(Zu[0],i);for(var t=1;t<Zu.length;t++){var s=Zu[t];s.blockedOn===i&&(s.blockedOn=null)}}for(On!==null&&tl(On,i),Fn!==null&&tl(Fn,i),Vn!==null&&tl(Vn,i),Fl.forEach(e),Vl.forEach(e),t=0;t<Ln.length;t++)s=Ln[t],s.blockedOn===i&&(s.blockedOn=null);for(;0<Ln.length&&(t=Ln[0],t.blockedOn===null);)tv(t),t.blockedOn===null&&Ln.shift()}var So=bn.ReactCurrentBatchConfig,qh=!0;function dB(i,e,t,s){var r=bt,n=So.transition;So.transition=null;try{bt=1,ym(i,e,t,s)}finally{bt=r,So.transition=n}}function fB(i,e,t,s){var r=bt,n=So.transition;So.transition=null;try{bt=4,ym(i,e,t,s)}finally{bt=r,So.transition=n}}function ym(i,e,t,s){if(qh){var r=Lp(i,e,t,s);if(r===null)lf(i,e,s,Kh,t),By(i,s);else if(hB(r,i,e,t,s))s.stopPropagation();else if(By(i,s),e&4&&-1<uB.indexOf(i)){for(;r!==null;){var n=Cu(r);if(n!==null&&qw(n),n=Lp(i,e,t,s),n===null&&lf(i,e,s,Kh,t),n===r)break;r=n}r!==null&&s.stopPropagation()}else lf(i,e,s,null,t)}}var Kh=null;function Lp(i,e,t,s){if(Kh=null,i=fm(s),i=aa(i),i!==null)if(e=Ra(i),e===null)i=null;else if(t=e.tag,t===13){if(i=Gw(e),i!==null)return i;i=null}else if(t===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;i=null}else e!==i&&(i=null);return Kh=i,null}function iv(i){switch(i){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(eB()){case pm:return 1;case Yw:return 4;case Qh:case tB:return 16;case Xw:return 536870912;default:return 16}default:return 16}}var An=null,bm=null,Ph=null;function sv(){if(Ph)return Ph;var i,e=bm,t=e.length,s,r="value"in An?An.value:An.textContent,n=r.length;for(i=0;i<t&&e[i]===r[i];i++);var a=t-i;for(s=1;s<=a&&e[t-s]===r[n-s];s++);return Ph=r.slice(i,1<s?1-s:void 0)}function Mh(i){var e=i.keyCode;return"charCode"in i?(i=i.charCode,i===0&&e===13&&(i=13)):i=e,i===10&&(i=13),32<=i||i===13?i:0}function eh(){return!0}function Py(){return!1}function Rs(i){function e(t,s,r,n,a){this._reactName=t,this._targetInst=r,this.type=s,this.nativeEvent=n,this.target=a,this.currentTarget=null;for(var o in i)i.hasOwnProperty(o)&&(t=i[o],this[o]=t?t(n):n[o]);return this.isDefaultPrevented=(n.defaultPrevented!=null?n.defaultPrevented:n.returnValue===!1)?eh:Py,this.isPropagationStopped=Py,this}return $t(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var t=this.nativeEvent;t&&(t.preventDefault?t.preventDefault():typeof t.returnValue!="unknown"&&(t.returnValue=!1),this.isDefaultPrevented=eh)},stopPropagation:function(){var t=this.nativeEvent;t&&(t.stopPropagation?t.stopPropagation():typeof t.cancelBubble!="unknown"&&(t.cancelBubble=!0),this.isPropagationStopped=eh)},persist:function(){},isPersistent:eh}),e}var $o={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(i){return i.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Sm=Rs($o),Bu=$t({},$o,{view:0,detail:0}),pB=Rs(Bu),Kd,Zd,il,Kc=$t({},Bu,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:wm,button:0,buttons:0,relatedTarget:function(i){return i.relatedTarget===void 0?i.fromElement===i.srcElement?i.toElement:i.fromElement:i.relatedTarget},movementX:function(i){return"movementX"in i?i.movementX:(i!==il&&(il&&i.type==="mousemove"?(Kd=i.screenX-il.screenX,Zd=i.screenY-il.screenY):Zd=Kd=0,il=i),Kd)},movementY:function(i){return"movementY"in i?i.movementY:Zd}}),My=Rs(Kc),gB=$t({},Kc,{dataTransfer:0}),mB=Rs(gB),yB=$t({},Bu,{relatedTarget:0}),ef=Rs(yB),bB=$t({},$o,{animationName:0,elapsedTime:0,pseudoElement:0}),SB=Rs(bB),wB=$t({},$o,{clipboardData:function(i){return"clipboardData"in i?i.clipboardData:window.clipboardData}}),vB=Rs(wB),kB=$t({},$o,{data:0}),Ey=Rs(kB),xB={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},_B={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},TB={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function NB(i){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(i):(i=TB[i])?!!e[i]:!1}function wm(){return NB}var BB=$t({},Bu,{key:function(i){if(i.key){var e=xB[i.key]||i.key;if(e!=="Unidentified")return e}return i.type==="keypress"?(i=Mh(i),i===13?"Enter":String.fromCharCode(i)):i.type==="keydown"||i.type==="keyup"?_B[i.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:wm,charCode:function(i){return i.type==="keypress"?Mh(i):0},keyCode:function(i){return i.type==="keydown"||i.type==="keyup"?i.keyCode:0},which:function(i){return i.type==="keypress"?Mh(i):i.type==="keydown"||i.type==="keyup"?i.keyCode:0}}),CB=Rs(BB),PB=$t({},Kc,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Ly=Rs(PB),MB=$t({},Bu,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:wm}),EB=Rs(MB),LB=$t({},$o,{propertyName:0,elapsedTime:0,pseudoElement:0}),DB=Rs(LB),AB=$t({},Kc,{deltaX:function(i){return"deltaX"in i?i.deltaX:"wheelDeltaX"in i?-i.wheelDeltaX:0},deltaY:function(i){return"deltaY"in i?i.deltaY:"wheelDeltaY"in i?-i.wheelDeltaY:"wheelDelta"in i?-i.wheelDelta:0},deltaZ:0,deltaMode:0}),IB=Rs(AB),RB=[9,13,27,32],vm=on&&"CompositionEvent"in window,vl=null;on&&"documentMode"in document&&(vl=document.documentMode);var OB=on&&"TextEvent"in window&&!vl,rv=on&&(!vm||vl&&8<vl&&11>=vl),Dy=" ",Ay=!1;function nv(i,e){switch(i){case"keyup":return RB.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function av(i){return i=i.detail,typeof i=="object"&&"data"in i?i.data:null}var eo=!1;function FB(i,e){switch(i){case"compositionend":return av(e);case"keypress":return e.which!==32?null:(Ay=!0,Dy);case"textInput":return i=e.data,i===Dy&&Ay?null:i;default:return null}}function VB(i,e){if(eo)return i==="compositionend"||!vm&&nv(i,e)?(i=sv(),Ph=bm=An=null,eo=!1,i):null;switch(i){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return rv&&e.locale!=="ko"?null:e.data;default:return null}}var HB={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Iy(i){var e=i&&i.nodeName&&i.nodeName.toLowerCase();return e==="input"?!!HB[i.type]:e==="textarea"}function ov(i,e,t,s){Fw(s),e=Zh(e,"onChange"),0<e.length&&(t=new Sm("onChange","change",null,t,s),i.push({event:t,listeners:e}))}var kl=null,zl=null;function zB(i){bv(i,0)}function Zc(i){var e=so(i);if(Ew(e))return i}function WB(i,e){if(i==="change")return e}var lv=!1;if(on){var tf;if(on){var sf="oninput"in document;if(!sf){var Ry=document.createElement("div");Ry.setAttribute("oninput","return;"),sf=typeof Ry.oninput=="function"}tf=sf}else tf=!1;lv=tf&&(!document.documentMode||9<document.documentMode)}function Oy(){kl&&(kl.detachEvent("onpropertychange",uv),zl=kl=null)}function uv(i){if(i.propertyName==="value"&&Zc(zl)){var e=[];ov(e,zl,i,fm(i)),Ww(zB,e)}}function GB(i,e,t){i==="focusin"?(Oy(),kl=e,zl=t,kl.attachEvent("onpropertychange",uv)):i==="focusout"&&Oy()}function jB(i){if(i==="selectionchange"||i==="keyup"||i==="keydown")return Zc(zl)}function UB(i,e){if(i==="click")return Zc(e)}function $B(i,e){if(i==="input"||i==="change")return Zc(e)}function YB(i,e){return i===e&&(i!==0||1/i===1/e)||i!==i&&e!==e}var br=typeof Object.is=="function"?Object.is:YB;function Wl(i,e){if(br(i,e))return!0;if(typeof i!="object"||i===null||typeof e!="object"||e===null)return!1;var t=Object.keys(i),s=Object.keys(e);if(t.length!==s.length)return!1;for(s=0;s<t.length;s++){var r=t[s];if(!pp.call(e,r)||!br(i[r],e[r]))return!1}return!0}function Fy(i){for(;i&&i.firstChild;)i=i.firstChild;return i}function Vy(i,e){var t=Fy(i);i=0;for(var s;t;){if(t.nodeType===3){if(s=i+t.textContent.length,i<=e&&s>=e)return{node:t,offset:e-i};i=s}e:{for(;t;){if(t.nextSibling){t=t.nextSibling;break e}t=t.parentNode}t=void 0}t=Fy(t)}}function hv(i,e){return i&&e?i===e?!0:i&&i.nodeType===3?!1:e&&e.nodeType===3?hv(i,e.parentNode):"contains"in i?i.contains(e):i.compareDocumentPosition?!!(i.compareDocumentPosition(e)&16):!1:!1}function cv(){for(var i=window,e=$h();e instanceof i.HTMLIFrameElement;){try{var t=typeof e.contentWindow.location.href=="string"}catch{t=!1}if(t)i=e.contentWindow;else break;e=$h(i.document)}return e}function km(i){var e=i&&i.nodeName&&i.nodeName.toLowerCase();return e&&(e==="input"&&(i.type==="text"||i.type==="search"||i.type==="tel"||i.type==="url"||i.type==="password")||e==="textarea"||i.contentEditable==="true")}function XB(i){var e=cv(),t=i.focusedElem,s=i.selectionRange;if(e!==t&&t&&t.ownerDocument&&hv(t.ownerDocument.documentElement,t)){if(s!==null&&km(t)){if(e=s.start,i=s.end,i===void 0&&(i=e),"selectionStart"in t)t.selectionStart=e,t.selectionEnd=Math.min(i,t.value.length);else if(i=(e=t.ownerDocument||document)&&e.defaultView||window,i.getSelection){i=i.getSelection();var r=t.textContent.length,n=Math.min(s.start,r);s=s.end===void 0?n:Math.min(s.end,r),!i.extend&&n>s&&(r=s,s=n,n=r),r=Vy(t,n);var a=Vy(t,s);r&&a&&(i.rangeCount!==1||i.anchorNode!==r.node||i.anchorOffset!==r.offset||i.focusNode!==a.node||i.focusOffset!==a.offset)&&(e=e.createRange(),e.setStart(r.node,r.offset),i.removeAllRanges(),n>s?(i.addRange(e),i.extend(a.node,a.offset)):(e.setEnd(a.node,a.offset),i.addRange(e)))}}for(e=[],i=t;i=i.parentNode;)i.nodeType===1&&e.push({element:i,left:i.scrollLeft,top:i.scrollTop});for(typeof t.focus=="function"&&t.focus(),t=0;t<e.length;t++)i=e[t],i.element.scrollLeft=i.left,i.element.scrollTop=i.top}}var QB=on&&"documentMode"in document&&11>=document.documentMode,to=null,Dp=null,xl=null,Ap=!1;function Hy(i,e,t){var s=t.window===t?t.document:t.nodeType===9?t:t.ownerDocument;Ap||to==null||to!==$h(s)||(s=to,"selectionStart"in s&&km(s)?s={start:s.selectionStart,end:s.selectionEnd}:(s=(s.ownerDocument&&s.ownerDocument.defaultView||window).getSelection(),s={anchorNode:s.anchorNode,anchorOffset:s.anchorOffset,focusNode:s.focusNode,focusOffset:s.focusOffset}),xl&&Wl(xl,s)||(xl=s,s=Zh(Dp,"onSelect"),0<s.length&&(e=new Sm("onSelect","select",null,e,t),i.push({event:e,listeners:s}),e.target=to)))}function th(i,e){var t={};return t[i.toLowerCase()]=e.toLowerCase(),t["Webkit"+i]="webkit"+e,t["Moz"+i]="moz"+e,t}var io={animationend:th("Animation","AnimationEnd"),animationiteration:th("Animation","AnimationIteration"),animationstart:th("Animation","AnimationStart"),transitionend:th("Transition","TransitionEnd")},rf={},dv={};on&&(dv=document.createElement("div").style,"AnimationEvent"in window||(delete io.animationend.animation,delete io.animationiteration.animation,delete io.animationstart.animation),"TransitionEvent"in window||delete io.transitionend.transition);function ed(i){if(rf[i])return rf[i];if(!io[i])return i;var e=io[i],t;for(t in e)if(e.hasOwnProperty(t)&&t in dv)return rf[i]=e[t];return i}var fv=ed("animationend"),pv=ed("animationiteration"),gv=ed("animationstart"),mv=ed("transitionend"),yv=new Map,zy="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Kn(i,e){yv.set(i,e),Ia(e,[i])}for(var nf=0;nf<zy.length;nf++){var af=zy[nf],JB=af.toLowerCase(),qB=af[0].toUpperCase()+af.slice(1);Kn(JB,"on"+qB)}Kn(fv,"onAnimationEnd");Kn(pv,"onAnimationIteration");Kn(gv,"onAnimationStart");Kn("dblclick","onDoubleClick");Kn("focusin","onFocus");Kn("focusout","onBlur");Kn(mv,"onTransitionEnd");No("onMouseEnter",["mouseout","mouseover"]);No("onMouseLeave",["mouseout","mouseover"]);No("onPointerEnter",["pointerout","pointerover"]);No("onPointerLeave",["pointerout","pointerover"]);Ia("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Ia("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Ia("onBeforeInput",["compositionend","keypress","textInput","paste"]);Ia("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Ia("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Ia("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var pl="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),KB=new Set("cancel close invalid load scroll toggle".split(" ").concat(pl));function Wy(i,e,t){var s=i.type||"unknown-event";i.currentTarget=t,JN(s,e,void 0,i),i.currentTarget=null}function bv(i,e){e=(e&4)!==0;for(var t=0;t<i.length;t++){var s=i[t],r=s.event;s=s.listeners;e:{var n=void 0;if(e)for(var a=s.length-1;0<=a;a--){var o=s[a],l=o.instance,u=o.currentTarget;if(o=o.listener,l!==n&&r.isPropagationStopped())break e;Wy(r,o,u),n=l}else for(a=0;a<s.length;a++){if(o=s[a],l=o.instance,u=o.currentTarget,o=o.listener,l!==n&&r.isPropagationStopped())break e;Wy(r,o,u),n=l}}}if(Xh)throw i=Pp,Xh=!1,Pp=null,i}function Tt(i,e){var t=e[Vp];t===void 0&&(t=e[Vp]=new Set);var s=i+"__bubble";t.has(s)||(Sv(e,i,2,!1),t.add(s))}function of(i,e,t){var s=0;e&&(s|=4),Sv(t,i,s,e)}var ih="_reactListening"+Math.random().toString(36).slice(2);function Gl(i){if(!i[ih]){i[ih]=!0,Nw.forEach(function(t){t!=="selectionchange"&&(KB.has(t)||of(t,!1,i),of(t,!0,i))});var e=i.nodeType===9?i:i.ownerDocument;e===null||e[ih]||(e[ih]=!0,of("selectionchange",!1,e))}}function Sv(i,e,t,s){switch(iv(e)){case 1:var r=dB;break;case 4:r=fB;break;default:r=ym}t=r.bind(null,e,t,i),r=void 0,!Cp||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(r=!0),s?r!==void 0?i.addEventListener(e,t,{capture:!0,passive:r}):i.addEventListener(e,t,!0):r!==void 0?i.addEventListener(e,t,{passive:r}):i.addEventListener(e,t,!1)}function lf(i,e,t,s,r){var n=s;if(!(e&1)&&!(e&2)&&s!==null)e:for(;;){if(s===null)return;var a=s.tag;if(a===3||a===4){var o=s.stateNode.containerInfo;if(o===r||o.nodeType===8&&o.parentNode===r)break;if(a===4)for(a=s.return;a!==null;){var l=a.tag;if((l===3||l===4)&&(l=a.stateNode.containerInfo,l===r||l.nodeType===8&&l.parentNode===r))return;a=a.return}for(;o!==null;){if(a=aa(o),a===null)return;if(l=a.tag,l===5||l===6){s=n=a;continue e}o=o.parentNode}}s=s.return}Ww(function(){var u=n,h=fm(t),c=[];e:{var d=yv.get(i);if(d!==void 0){var f=Sm,p=i;switch(i){case"keypress":if(Mh(t)===0)break e;case"keydown":case"keyup":f=CB;break;case"focusin":p="focus",f=ef;break;case"focusout":p="blur",f=ef;break;case"beforeblur":case"afterblur":f=ef;break;case"click":if(t.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":f=My;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":f=mB;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":f=EB;break;case fv:case pv:case gv:f=SB;break;case mv:f=DB;break;case"scroll":f=pB;break;case"wheel":f=IB;break;case"copy":case"cut":case"paste":f=vB;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":f=Ly}var g=(e&4)!==0,b=!g&&i==="scroll",m=g?d!==null?d+"Capture":null:d;g=[];for(var y=u,w;y!==null;){w=y;var x=w.stateNode;if(w.tag===5&&x!==null&&(w=x,m!==null&&(x=Ol(y,m),x!=null&&g.push(jl(y,x,w)))),b)break;y=y.return}0<g.length&&(d=new f(d,p,null,t,h),c.push({event:d,listeners:g}))}}if(!(e&7)){e:{if(d=i==="mouseover"||i==="pointerover",f=i==="mouseout"||i==="pointerout",d&&t!==Np&&(p=t.relatedTarget||t.fromElement)&&(aa(p)||p[ln]))break e;if((f||d)&&(d=h.window===h?h:(d=h.ownerDocument)?d.defaultView||d.parentWindow:window,f?(p=t.relatedTarget||t.toElement,f=u,p=p?aa(p):null,p!==null&&(b=Ra(p),p!==b||p.tag!==5&&p.tag!==6)&&(p=null)):(f=null,p=u),f!==p)){if(g=My,x="onMouseLeave",m="onMouseEnter",y="mouse",(i==="pointerout"||i==="pointerover")&&(g=Ly,x="onPointerLeave",m="onPointerEnter",y="pointer"),b=f==null?d:so(f),w=p==null?d:so(p),d=new g(x,y+"leave",f,t,h),d.target=b,d.relatedTarget=w,x=null,aa(h)===u&&(g=new g(m,y+"enter",p,t,h),g.target=w,g.relatedTarget=b,x=g),b=x,f&&p)t:{for(g=f,m=p,y=0,w=g;w;w=Ua(w))y++;for(w=0,x=m;x;x=Ua(x))w++;for(;0<y-w;)g=Ua(g),y--;for(;0<w-y;)m=Ua(m),w--;for(;y--;){if(g===m||m!==null&&g===m.alternate)break t;g=Ua(g),m=Ua(m)}g=null}else g=null;f!==null&&Gy(c,d,f,g,!1),p!==null&&b!==null&&Gy(c,b,p,g,!0)}}e:{if(d=u?so(u):window,f=d.nodeName&&d.nodeName.toLowerCase(),f==="select"||f==="input"&&d.type==="file")var k=WB;else if(Iy(d))if(lv)k=$B;else{k=jB;var _=GB}else(f=d.nodeName)&&f.toLowerCase()==="input"&&(d.type==="checkbox"||d.type==="radio")&&(k=UB);if(k&&(k=k(i,u))){ov(c,k,t,h);break e}_&&_(i,d,u),i==="focusout"&&(_=d._wrapperState)&&_.controlled&&d.type==="number"&&vp(d,"number",d.value)}switch(_=u?so(u):window,i){case"focusin":(Iy(_)||_.contentEditable==="true")&&(to=_,Dp=u,xl=null);break;case"focusout":xl=Dp=to=null;break;case"mousedown":Ap=!0;break;case"contextmenu":case"mouseup":case"dragend":Ap=!1,Hy(c,t,h);break;case"selectionchange":if(QB)break;case"keydown":case"keyup":Hy(c,t,h)}var T;if(vm)e:{switch(i){case"compositionstart":var C="onCompositionStart";break e;case"compositionend":C="onCompositionEnd";break e;case"compositionupdate":C="onCompositionUpdate";break e}C=void 0}else eo?nv(i,t)&&(C="onCompositionEnd"):i==="keydown"&&t.keyCode===229&&(C="onCompositionStart");C&&(rv&&t.locale!=="ko"&&(eo||C!=="onCompositionStart"?C==="onCompositionEnd"&&eo&&(T=sv()):(An=h,bm="value"in An?An.value:An.textContent,eo=!0)),_=Zh(u,C),0<_.length&&(C=new Ey(C,i,null,t,h),c.push({event:C,listeners:_}),T?C.data=T:(T=av(t),T!==null&&(C.data=T)))),(T=OB?FB(i,t):VB(i,t))&&(u=Zh(u,"onBeforeInput"),0<u.length&&(h=new Ey("onBeforeInput","beforeinput",null,t,h),c.push({event:h,listeners:u}),h.data=T))}bv(c,e)})}function jl(i,e,t){return{instance:i,listener:e,currentTarget:t}}function Zh(i,e){for(var t=e+"Capture",s=[];i!==null;){var r=i,n=r.stateNode;r.tag===5&&n!==null&&(r=n,n=Ol(i,t),n!=null&&s.unshift(jl(i,n,r)),n=Ol(i,e),n!=null&&s.push(jl(i,n,r))),i=i.return}return s}function Ua(i){if(i===null)return null;do i=i.return;while(i&&i.tag!==5);return i||null}function Gy(i,e,t,s,r){for(var n=e._reactName,a=[];t!==null&&t!==s;){var o=t,l=o.alternate,u=o.stateNode;if(l!==null&&l===s)break;o.tag===5&&u!==null&&(o=u,r?(l=Ol(t,n),l!=null&&a.unshift(jl(t,l,o))):r||(l=Ol(t,n),l!=null&&a.push(jl(t,l,o)))),t=t.return}a.length!==0&&i.push({event:e,listeners:a})}var ZB=/\r\n?/g,e2=/\u0000|\uFFFD/g;function jy(i){return(typeof i=="string"?i:""+i).replace(ZB,`
`).replace(e2,"")}function sh(i,e,t){if(e=jy(e),jy(i)!==e&&t)throw Error(J(425))}function ec(){}var Ip=null,Rp=null;function Op(i,e){return i==="textarea"||i==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var Fp=typeof setTimeout=="function"?setTimeout:void 0,t2=typeof clearTimeout=="function"?clearTimeout:void 0,Uy=typeof Promise=="function"?Promise:void 0,i2=typeof queueMicrotask=="function"?queueMicrotask:typeof Uy<"u"?function(i){return Uy.resolve(null).then(i).catch(s2)}:Fp;function s2(i){setTimeout(function(){throw i})}function uf(i,e){var t=e,s=0;do{var r=t.nextSibling;if(i.removeChild(t),r&&r.nodeType===8)if(t=r.data,t==="/$"){if(s===0){i.removeChild(r),Hl(e);return}s--}else t!=="$"&&t!=="$?"&&t!=="$!"||s++;t=r}while(t);Hl(e)}function Hn(i){for(;i!=null;i=i.nextSibling){var e=i.nodeType;if(e===1||e===3)break;if(e===8){if(e=i.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return i}function $y(i){i=i.previousSibling;for(var e=0;i;){if(i.nodeType===8){var t=i.data;if(t==="$"||t==="$!"||t==="$?"){if(e===0)return i;e--}else t==="/$"&&e++}i=i.previousSibling}return null}var Yo=Math.random().toString(36).slice(2),Er="__reactFiber$"+Yo,Ul="__reactProps$"+Yo,ln="__reactContainer$"+Yo,Vp="__reactEvents$"+Yo,r2="__reactListeners$"+Yo,n2="__reactHandles$"+Yo;function aa(i){var e=i[Er];if(e)return e;for(var t=i.parentNode;t;){if(e=t[ln]||t[Er]){if(t=e.alternate,e.child!==null||t!==null&&t.child!==null)for(i=$y(i);i!==null;){if(t=i[Er])return t;i=$y(i)}return e}i=t,t=i.parentNode}return null}function Cu(i){return i=i[Er]||i[ln],!i||i.tag!==5&&i.tag!==6&&i.tag!==13&&i.tag!==3?null:i}function so(i){if(i.tag===5||i.tag===6)return i.stateNode;throw Error(J(33))}function td(i){return i[Ul]||null}var Hp=[],ro=-1;function Zn(i){return{current:i}}function Ct(i){0>ro||(i.current=Hp[ro],Hp[ro]=null,ro--)}function xt(i,e){ro++,Hp[ro]=i.current,i.current=e}var Yn={},Ki=Zn(Yn),ps=Zn(!1),wa=Yn;function Bo(i,e){var t=i.type.contextTypes;if(!t)return Yn;var s=i.stateNode;if(s&&s.__reactInternalMemoizedUnmaskedChildContext===e)return s.__reactInternalMemoizedMaskedChildContext;var r={},n;for(n in t)r[n]=e[n];return s&&(i=i.stateNode,i.__reactInternalMemoizedUnmaskedChildContext=e,i.__reactInternalMemoizedMaskedChildContext=r),r}function gs(i){return i=i.childContextTypes,i!=null}function tc(){Ct(ps),Ct(Ki)}function Yy(i,e,t){if(Ki.current!==Yn)throw Error(J(168));xt(Ki,e),xt(ps,t)}function wv(i,e,t){var s=i.stateNode;if(e=e.childContextTypes,typeof s.getChildContext!="function")return t;s=s.getChildContext();for(var r in s)if(!(r in e))throw Error(J(108,GN(i)||"Unknown",r));return $t({},t,s)}function ic(i){return i=(i=i.stateNode)&&i.__reactInternalMemoizedMergedChildContext||Yn,wa=Ki.current,xt(Ki,i),xt(ps,ps.current),!0}function Xy(i,e,t){var s=i.stateNode;if(!s)throw Error(J(169));t?(i=wv(i,e,wa),s.__reactInternalMemoizedMergedChildContext=i,Ct(ps),Ct(Ki),xt(Ki,i)):Ct(ps),xt(ps,t)}var Ur=null,id=!1,hf=!1;function vv(i){Ur===null?Ur=[i]:Ur.push(i)}function a2(i){id=!0,vv(i)}function ea(){if(!hf&&Ur!==null){hf=!0;var i=0,e=bt;try{var t=Ur;for(bt=1;i<t.length;i++){var s=t[i];do s=s(!0);while(s!==null)}Ur=null,id=!1}catch(r){throw Ur!==null&&(Ur=Ur.slice(i+1)),$w(pm,ea),r}finally{bt=e,hf=!1}}return null}var no=[],ao=0,sc=null,rc=0,Ws=[],Gs=0,va=null,Jr=1,qr="";function ia(i,e){no[ao++]=rc,no[ao++]=sc,sc=i,rc=e}function kv(i,e,t){Ws[Gs++]=Jr,Ws[Gs++]=qr,Ws[Gs++]=va,va=i;var s=Jr;i=qr;var r=32-pr(s)-1;s&=~(1<<r),t+=1;var n=32-pr(e)+r;if(30<n){var a=r-r%5;n=(s&(1<<a)-1).toString(32),s>>=a,r-=a,Jr=1<<32-pr(e)+r|t<<r|s,qr=n+i}else Jr=1<<n|t<<r|s,qr=i}function xm(i){i.return!==null&&(ia(i,1),kv(i,1,0))}function _m(i){for(;i===sc;)sc=no[--ao],no[ao]=null,rc=no[--ao],no[ao]=null;for(;i===va;)va=Ws[--Gs],Ws[Gs]=null,qr=Ws[--Gs],Ws[Gs]=null,Jr=Ws[--Gs],Ws[Gs]=null}var Ps=null,Bs=null,It=!1,ar=null;function xv(i,e){var t=$s(5,null,null,0);t.elementType="DELETED",t.stateNode=e,t.return=i,e=i.deletions,e===null?(i.deletions=[t],i.flags|=16):e.push(t)}function Qy(i,e){switch(i.tag){case 5:var t=i.type;return e=e.nodeType!==1||t.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(i.stateNode=e,Ps=i,Bs=Hn(e.firstChild),!0):!1;case 6:return e=i.pendingProps===""||e.nodeType!==3?null:e,e!==null?(i.stateNode=e,Ps=i,Bs=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(t=va!==null?{id:Jr,overflow:qr}:null,i.memoizedState={dehydrated:e,treeContext:t,retryLane:1073741824},t=$s(18,null,null,0),t.stateNode=e,t.return=i,i.child=t,Ps=i,Bs=null,!0):!1;default:return!1}}function zp(i){return(i.mode&1)!==0&&(i.flags&128)===0}function Wp(i){if(It){var e=Bs;if(e){var t=e;if(!Qy(i,e)){if(zp(i))throw Error(J(418));e=Hn(t.nextSibling);var s=Ps;e&&Qy(i,e)?xv(s,t):(i.flags=i.flags&-4097|2,It=!1,Ps=i)}}else{if(zp(i))throw Error(J(418));i.flags=i.flags&-4097|2,It=!1,Ps=i}}}function Jy(i){for(i=i.return;i!==null&&i.tag!==5&&i.tag!==3&&i.tag!==13;)i=i.return;Ps=i}function rh(i){if(i!==Ps)return!1;if(!It)return Jy(i),It=!0,!1;var e;if((e=i.tag!==3)&&!(e=i.tag!==5)&&(e=i.type,e=e!=="head"&&e!=="body"&&!Op(i.type,i.memoizedProps)),e&&(e=Bs)){if(zp(i))throw _v(),Error(J(418));for(;e;)xv(i,e),e=Hn(e.nextSibling)}if(Jy(i),i.tag===13){if(i=i.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(J(317));e:{for(i=i.nextSibling,e=0;i;){if(i.nodeType===8){var t=i.data;if(t==="/$"){if(e===0){Bs=Hn(i.nextSibling);break e}e--}else t!=="$"&&t!=="$!"&&t!=="$?"||e++}i=i.nextSibling}Bs=null}}else Bs=Ps?Hn(i.stateNode.nextSibling):null;return!0}function _v(){for(var i=Bs;i;)i=Hn(i.nextSibling)}function Co(){Bs=Ps=null,It=!1}function Tm(i){ar===null?ar=[i]:ar.push(i)}var o2=bn.ReactCurrentBatchConfig;function sr(i,e){if(i&&i.defaultProps){e=$t({},e),i=i.defaultProps;for(var t in i)e[t]===void 0&&(e[t]=i[t]);return e}return e}var nc=Zn(null),ac=null,oo=null,Nm=null;function Bm(){Nm=oo=ac=null}function Cm(i){var e=nc.current;Ct(nc),i._currentValue=e}function Gp(i,e,t){for(;i!==null;){var s=i.alternate;if((i.childLanes&e)!==e?(i.childLanes|=e,s!==null&&(s.childLanes|=e)):s!==null&&(s.childLanes&e)!==e&&(s.childLanes|=e),i===t)break;i=i.return}}function wo(i,e){ac=i,Nm=oo=null,i=i.dependencies,i!==null&&i.firstContext!==null&&(i.lanes&e&&(ds=!0),i.firstContext=null)}function Qs(i){var e=i._currentValue;if(Nm!==i)if(i={context:i,memoizedValue:e,next:null},oo===null){if(ac===null)throw Error(J(308));oo=i,ac.dependencies={lanes:0,firstContext:i}}else oo=oo.next=i;return e}var oa=null;function Pm(i){oa===null?oa=[i]:oa.push(i)}function Tv(i,e,t,s){var r=e.interleaved;return r===null?(t.next=t,Pm(e)):(t.next=r.next,r.next=t),e.interleaved=t,un(i,s)}function un(i,e){i.lanes|=e;var t=i.alternate;for(t!==null&&(t.lanes|=e),t=i,i=i.return;i!==null;)i.childLanes|=e,t=i.alternate,t!==null&&(t.childLanes|=e),t=i,i=i.return;return t.tag===3?t.stateNode:null}var Pn=!1;function Mm(i){i.updateQueue={baseState:i.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Nv(i,e){i=i.updateQueue,e.updateQueue===i&&(e.updateQueue={baseState:i.baseState,firstBaseUpdate:i.firstBaseUpdate,lastBaseUpdate:i.lastBaseUpdate,shared:i.shared,effects:i.effects})}function sn(i,e){return{eventTime:i,lane:e,tag:0,payload:null,callback:null,next:null}}function zn(i,e,t){var s=i.updateQueue;if(s===null)return null;if(s=s.shared,at&2){var r=s.pending;return r===null?e.next=e:(e.next=r.next,r.next=e),s.pending=e,un(i,t)}return r=s.interleaved,r===null?(e.next=e,Pm(s)):(e.next=r.next,r.next=e),s.interleaved=e,un(i,t)}function Eh(i,e,t){if(e=e.updateQueue,e!==null&&(e=e.shared,(t&4194240)!==0)){var s=e.lanes;s&=i.pendingLanes,t|=s,e.lanes=t,gm(i,t)}}function qy(i,e){var t=i.updateQueue,s=i.alternate;if(s!==null&&(s=s.updateQueue,t===s)){var r=null,n=null;if(t=t.firstBaseUpdate,t!==null){do{var a={eventTime:t.eventTime,lane:t.lane,tag:t.tag,payload:t.payload,callback:t.callback,next:null};n===null?r=n=a:n=n.next=a,t=t.next}while(t!==null);n===null?r=n=e:n=n.next=e}else r=n=e;t={baseState:s.baseState,firstBaseUpdate:r,lastBaseUpdate:n,shared:s.shared,effects:s.effects},i.updateQueue=t;return}i=t.lastBaseUpdate,i===null?t.firstBaseUpdate=e:i.next=e,t.lastBaseUpdate=e}function oc(i,e,t,s){var r=i.updateQueue;Pn=!1;var n=r.firstBaseUpdate,a=r.lastBaseUpdate,o=r.shared.pending;if(o!==null){r.shared.pending=null;var l=o,u=l.next;l.next=null,a===null?n=u:a.next=u,a=l;var h=i.alternate;h!==null&&(h=h.updateQueue,o=h.lastBaseUpdate,o!==a&&(o===null?h.firstBaseUpdate=u:o.next=u,h.lastBaseUpdate=l))}if(n!==null){var c=r.baseState;a=0,h=u=l=null,o=n;do{var d=o.lane,f=o.eventTime;if((s&d)===d){h!==null&&(h=h.next={eventTime:f,lane:0,tag:o.tag,payload:o.payload,callback:o.callback,next:null});e:{var p=i,g=o;switch(d=e,f=t,g.tag){case 1:if(p=g.payload,typeof p=="function"){c=p.call(f,c,d);break e}c=p;break e;case 3:p.flags=p.flags&-65537|128;case 0:if(p=g.payload,d=typeof p=="function"?p.call(f,c,d):p,d==null)break e;c=$t({},c,d);break e;case 2:Pn=!0}}o.callback!==null&&o.lane!==0&&(i.flags|=64,d=r.effects,d===null?r.effects=[o]:d.push(o))}else f={eventTime:f,lane:d,tag:o.tag,payload:o.payload,callback:o.callback,next:null},h===null?(u=h=f,l=c):h=h.next=f,a|=d;if(o=o.next,o===null){if(o=r.shared.pending,o===null)break;d=o,o=d.next,d.next=null,r.lastBaseUpdate=d,r.shared.pending=null}}while(!0);if(h===null&&(l=c),r.baseState=l,r.firstBaseUpdate=u,r.lastBaseUpdate=h,e=r.shared.interleaved,e!==null){r=e;do a|=r.lane,r=r.next;while(r!==e)}else n===null&&(r.shared.lanes=0);xa|=a,i.lanes=a,i.memoizedState=c}}function Ky(i,e,t){if(i=e.effects,e.effects=null,i!==null)for(e=0;e<i.length;e++){var s=i[e],r=s.callback;if(r!==null){if(s.callback=null,s=t,typeof r!="function")throw Error(J(191,r));r.call(s)}}}var Bv=new Tw.Component().refs;function jp(i,e,t,s){e=i.memoizedState,t=t(s,e),t=t==null?e:$t({},e,t),i.memoizedState=t,i.lanes===0&&(i.updateQueue.baseState=t)}var sd={isMounted:function(i){return(i=i._reactInternals)?Ra(i)===i:!1},enqueueSetState:function(i,e,t){i=i._reactInternals;var s=rs(),r=Gn(i),n=sn(s,r);n.payload=e,t!=null&&(n.callback=t),e=zn(i,n,r),e!==null&&(gr(e,i,r,s),Eh(e,i,r))},enqueueReplaceState:function(i,e,t){i=i._reactInternals;var s=rs(),r=Gn(i),n=sn(s,r);n.tag=1,n.payload=e,t!=null&&(n.callback=t),e=zn(i,n,r),e!==null&&(gr(e,i,r,s),Eh(e,i,r))},enqueueForceUpdate:function(i,e){i=i._reactInternals;var t=rs(),s=Gn(i),r=sn(t,s);r.tag=2,e!=null&&(r.callback=e),e=zn(i,r,s),e!==null&&(gr(e,i,s,t),Eh(e,i,s))}};function Zy(i,e,t,s,r,n,a){return i=i.stateNode,typeof i.shouldComponentUpdate=="function"?i.shouldComponentUpdate(s,n,a):e.prototype&&e.prototype.isPureReactComponent?!Wl(t,s)||!Wl(r,n):!0}function Cv(i,e,t){var s=!1,r=Yn,n=e.contextType;return typeof n=="object"&&n!==null?n=Qs(n):(r=gs(e)?wa:Ki.current,s=e.contextTypes,n=(s=s!=null)?Bo(i,r):Yn),e=new e(t,n),i.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=sd,i.stateNode=e,e._reactInternals=i,s&&(i=i.stateNode,i.__reactInternalMemoizedUnmaskedChildContext=r,i.__reactInternalMemoizedMaskedChildContext=n),e}function e1(i,e,t,s){i=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(t,s),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(t,s),e.state!==i&&sd.enqueueReplaceState(e,e.state,null)}function Up(i,e,t,s){var r=i.stateNode;r.props=t,r.state=i.memoizedState,r.refs=Bv,Mm(i);var n=e.contextType;typeof n=="object"&&n!==null?r.context=Qs(n):(n=gs(e)?wa:Ki.current,r.context=Bo(i,n)),r.state=i.memoizedState,n=e.getDerivedStateFromProps,typeof n=="function"&&(jp(i,e,n,t),r.state=i.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof r.getSnapshotBeforeUpdate=="function"||typeof r.UNSAFE_componentWillMount!="function"&&typeof r.componentWillMount!="function"||(e=r.state,typeof r.componentWillMount=="function"&&r.componentWillMount(),typeof r.UNSAFE_componentWillMount=="function"&&r.UNSAFE_componentWillMount(),e!==r.state&&sd.enqueueReplaceState(r,r.state,null),oc(i,t,r,s),r.state=i.memoizedState),typeof r.componentDidMount=="function"&&(i.flags|=4194308)}function sl(i,e,t){if(i=t.ref,i!==null&&typeof i!="function"&&typeof i!="object"){if(t._owner){if(t=t._owner,t){if(t.tag!==1)throw Error(J(309));var s=t.stateNode}if(!s)throw Error(J(147,i));var r=s,n=""+i;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===n?e.ref:(e=function(a){var o=r.refs;o===Bv&&(o=r.refs={}),a===null?delete o[n]:o[n]=a},e._stringRef=n,e)}if(typeof i!="string")throw Error(J(284));if(!t._owner)throw Error(J(290,i))}return i}function nh(i,e){throw i=Object.prototype.toString.call(e),Error(J(31,i==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":i))}function t1(i){var e=i._init;return e(i._payload)}function Pv(i){function e(m,y){if(i){var w=m.deletions;w===null?(m.deletions=[y],m.flags|=16):w.push(y)}}function t(m,y){if(!i)return null;for(;y!==null;)e(m,y),y=y.sibling;return null}function s(m,y){for(m=new Map;y!==null;)y.key!==null?m.set(y.key,y):m.set(y.index,y),y=y.sibling;return m}function r(m,y){return m=jn(m,y),m.index=0,m.sibling=null,m}function n(m,y,w){return m.index=w,i?(w=m.alternate,w!==null?(w=w.index,w<y?(m.flags|=2,y):w):(m.flags|=2,y)):(m.flags|=1048576,y)}function a(m){return i&&m.alternate===null&&(m.flags|=2),m}function o(m,y,w,x){return y===null||y.tag!==6?(y=yf(w,m.mode,x),y.return=m,y):(y=r(y,w),y.return=m,y)}function l(m,y,w,x){var k=w.type;return k===Za?h(m,y,w.props.children,x,w.key):y!==null&&(y.elementType===k||typeof k=="object"&&k!==null&&k.$$typeof===Cn&&t1(k)===y.type)?(x=r(y,w.props),x.ref=sl(m,y,w),x.return=m,x):(x=Oh(w.type,w.key,w.props,null,m.mode,x),x.ref=sl(m,y,w),x.return=m,x)}function u(m,y,w,x){return y===null||y.tag!==4||y.stateNode.containerInfo!==w.containerInfo||y.stateNode.implementation!==w.implementation?(y=bf(w,m.mode,x),y.return=m,y):(y=r(y,w.children||[]),y.return=m,y)}function h(m,y,w,x,k){return y===null||y.tag!==7?(y=ga(w,m.mode,x,k),y.return=m,y):(y=r(y,w),y.return=m,y)}function c(m,y,w){if(typeof y=="string"&&y!==""||typeof y=="number")return y=yf(""+y,m.mode,w),y.return=m,y;if(typeof y=="object"&&y!==null){switch(y.$$typeof){case Xu:return w=Oh(y.type,y.key,y.props,null,m.mode,w),w.ref=sl(m,null,y),w.return=m,w;case Ka:return y=bf(y,m.mode,w),y.return=m,y;case Cn:var x=y._init;return c(m,x(y._payload),w)}if(dl(y)||Ko(y))return y=ga(y,m.mode,w,null),y.return=m,y;nh(m,y)}return null}function d(m,y,w,x){var k=y!==null?y.key:null;if(typeof w=="string"&&w!==""||typeof w=="number")return k!==null?null:o(m,y,""+w,x);if(typeof w=="object"&&w!==null){switch(w.$$typeof){case Xu:return w.key===k?l(m,y,w,x):null;case Ka:return w.key===k?u(m,y,w,x):null;case Cn:return k=w._init,d(m,y,k(w._payload),x)}if(dl(w)||Ko(w))return k!==null?null:h(m,y,w,x,null);nh(m,w)}return null}function f(m,y,w,x,k){if(typeof x=="string"&&x!==""||typeof x=="number")return m=m.get(w)||null,o(y,m,""+x,k);if(typeof x=="object"&&x!==null){switch(x.$$typeof){case Xu:return m=m.get(x.key===null?w:x.key)||null,l(y,m,x,k);case Ka:return m=m.get(x.key===null?w:x.key)||null,u(y,m,x,k);case Cn:var _=x._init;return f(m,y,w,_(x._payload),k)}if(dl(x)||Ko(x))return m=m.get(w)||null,h(y,m,x,k,null);nh(y,x)}return null}function p(m,y,w,x){for(var k=null,_=null,T=y,C=y=0,W=null;T!==null&&C<w.length;C++){T.index>C?(W=T,T=null):W=T.sibling;var z=d(m,T,w[C],x);if(z===null){T===null&&(T=W);break}i&&T&&z.alternate===null&&e(m,T),y=n(z,y,C),_===null?k=z:_.sibling=z,_=z,T=W}if(C===w.length)return t(m,T),It&&ia(m,C),k;if(T===null){for(;C<w.length;C++)T=c(m,w[C],x),T!==null&&(y=n(T,y,C),_===null?k=T:_.sibling=T,_=T);return It&&ia(m,C),k}for(T=s(m,T);C<w.length;C++)W=f(T,m,C,w[C],x),W!==null&&(i&&W.alternate!==null&&T.delete(W.key===null?C:W.key),y=n(W,y,C),_===null?k=W:_.sibling=W,_=W);return i&&T.forEach(function(te){return e(m,te)}),It&&ia(m,C),k}function g(m,y,w,x){var k=Ko(w);if(typeof k!="function")throw Error(J(150));if(w=k.call(w),w==null)throw Error(J(151));for(var _=k=null,T=y,C=y=0,W=null,z=w.next();T!==null&&!z.done;C++,z=w.next()){T.index>C?(W=T,T=null):W=T.sibling;var te=d(m,T,z.value,x);if(te===null){T===null&&(T=W);break}i&&T&&te.alternate===null&&e(m,T),y=n(te,y,C),_===null?k=te:_.sibling=te,_=te,T=W}if(z.done)return t(m,T),It&&ia(m,C),k;if(T===null){for(;!z.done;C++,z=w.next())z=c(m,z.value,x),z!==null&&(y=n(z,y,C),_===null?k=z:_.sibling=z,_=z);return It&&ia(m,C),k}for(T=s(m,T);!z.done;C++,z=w.next())z=f(T,m,C,z.value,x),z!==null&&(i&&z.alternate!==null&&T.delete(z.key===null?C:z.key),y=n(z,y,C),_===null?k=z:_.sibling=z,_=z);return i&&T.forEach(function(E){return e(m,E)}),It&&ia(m,C),k}function b(m,y,w,x){if(typeof w=="object"&&w!==null&&w.type===Za&&w.key===null&&(w=w.props.children),typeof w=="object"&&w!==null){switch(w.$$typeof){case Xu:e:{for(var k=w.key,_=y;_!==null;){if(_.key===k){if(k=w.type,k===Za){if(_.tag===7){t(m,_.sibling),y=r(_,w.props.children),y.return=m,m=y;break e}}else if(_.elementType===k||typeof k=="object"&&k!==null&&k.$$typeof===Cn&&t1(k)===_.type){t(m,_.sibling),y=r(_,w.props),y.ref=sl(m,_,w),y.return=m,m=y;break e}t(m,_);break}else e(m,_);_=_.sibling}w.type===Za?(y=ga(w.props.children,m.mode,x,w.key),y.return=m,m=y):(x=Oh(w.type,w.key,w.props,null,m.mode,x),x.ref=sl(m,y,w),x.return=m,m=x)}return a(m);case Ka:e:{for(_=w.key;y!==null;){if(y.key===_)if(y.tag===4&&y.stateNode.containerInfo===w.containerInfo&&y.stateNode.implementation===w.implementation){t(m,y.sibling),y=r(y,w.children||[]),y.return=m,m=y;break e}else{t(m,y);break}else e(m,y);y=y.sibling}y=bf(w,m.mode,x),y.return=m,m=y}return a(m);case Cn:return _=w._init,b(m,y,_(w._payload),x)}if(dl(w))return p(m,y,w,x);if(Ko(w))return g(m,y,w,x);nh(m,w)}return typeof w=="string"&&w!==""||typeof w=="number"?(w=""+w,y!==null&&y.tag===6?(t(m,y.sibling),y=r(y,w),y.return=m,m=y):(t(m,y),y=yf(w,m.mode,x),y.return=m,m=y),a(m)):t(m,y)}return b}var Po=Pv(!0),Mv=Pv(!1),Pu={},Rr=Zn(Pu),$l=Zn(Pu),Yl=Zn(Pu);function la(i){if(i===Pu)throw Error(J(174));return i}function Em(i,e){switch(xt(Yl,e),xt($l,i),xt(Rr,Pu),i=e.nodeType,i){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:xp(null,"");break;default:i=i===8?e.parentNode:e,e=i.namespaceURI||null,i=i.tagName,e=xp(e,i)}Ct(Rr),xt(Rr,e)}function Mo(){Ct(Rr),Ct($l),Ct(Yl)}function Ev(i){la(Yl.current);var e=la(Rr.current),t=xp(e,i.type);e!==t&&(xt($l,i),xt(Rr,t))}function Lm(i){$l.current===i&&(Ct(Rr),Ct($l))}var Wt=Zn(0);function lc(i){for(var e=i;e!==null;){if(e.tag===13){var t=e.memoizedState;if(t!==null&&(t=t.dehydrated,t===null||t.data==="$?"||t.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===i)break;for(;e.sibling===null;){if(e.return===null||e.return===i)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var cf=[];function Dm(){for(var i=0;i<cf.length;i++)cf[i]._workInProgressVersionPrimary=null;cf.length=0}var Lh=bn.ReactCurrentDispatcher,df=bn.ReactCurrentBatchConfig,ka=0,Ut=null,Si=null,Pi=null,uc=!1,_l=!1,Xl=0,l2=0;function Yi(){throw Error(J(321))}function Am(i,e){if(e===null)return!1;for(var t=0;t<e.length&&t<i.length;t++)if(!br(i[t],e[t]))return!1;return!0}function Im(i,e,t,s,r,n){if(ka=n,Ut=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,Lh.current=i===null||i.memoizedState===null?d2:f2,i=t(s,r),_l){n=0;do{if(_l=!1,Xl=0,25<=n)throw Error(J(301));n+=1,Pi=Si=null,e.updateQueue=null,Lh.current=p2,i=t(s,r)}while(_l)}if(Lh.current=hc,e=Si!==null&&Si.next!==null,ka=0,Pi=Si=Ut=null,uc=!1,e)throw Error(J(300));return i}function Rm(){var i=Xl!==0;return Xl=0,i}function Nr(){var i={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Pi===null?Ut.memoizedState=Pi=i:Pi=Pi.next=i,Pi}function Js(){if(Si===null){var i=Ut.alternate;i=i!==null?i.memoizedState:null}else i=Si.next;var e=Pi===null?Ut.memoizedState:Pi.next;if(e!==null)Pi=e,Si=i;else{if(i===null)throw Error(J(310));Si=i,i={memoizedState:Si.memoizedState,baseState:Si.baseState,baseQueue:Si.baseQueue,queue:Si.queue,next:null},Pi===null?Ut.memoizedState=Pi=i:Pi=Pi.next=i}return Pi}function Ql(i,e){return typeof e=="function"?e(i):e}function ff(i){var e=Js(),t=e.queue;if(t===null)throw Error(J(311));t.lastRenderedReducer=i;var s=Si,r=s.baseQueue,n=t.pending;if(n!==null){if(r!==null){var a=r.next;r.next=n.next,n.next=a}s.baseQueue=r=n,t.pending=null}if(r!==null){n=r.next,s=s.baseState;var o=a=null,l=null,u=n;do{var h=u.lane;if((ka&h)===h)l!==null&&(l=l.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),s=u.hasEagerState?u.eagerState:i(s,u.action);else{var c={lane:h,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};l===null?(o=l=c,a=s):l=l.next=c,Ut.lanes|=h,xa|=h}u=u.next}while(u!==null&&u!==n);l===null?a=s:l.next=o,br(s,e.memoizedState)||(ds=!0),e.memoizedState=s,e.baseState=a,e.baseQueue=l,t.lastRenderedState=s}if(i=t.interleaved,i!==null){r=i;do n=r.lane,Ut.lanes|=n,xa|=n,r=r.next;while(r!==i)}else r===null&&(t.lanes=0);return[e.memoizedState,t.dispatch]}function pf(i){var e=Js(),t=e.queue;if(t===null)throw Error(J(311));t.lastRenderedReducer=i;var s=t.dispatch,r=t.pending,n=e.memoizedState;if(r!==null){t.pending=null;var a=r=r.next;do n=i(n,a.action),a=a.next;while(a!==r);br(n,e.memoizedState)||(ds=!0),e.memoizedState=n,e.baseQueue===null&&(e.baseState=n),t.lastRenderedState=n}return[n,s]}function Lv(){}function Dv(i,e){var t=Ut,s=Js(),r=e(),n=!br(s.memoizedState,r);if(n&&(s.memoizedState=r,ds=!0),s=s.queue,Om(Rv.bind(null,t,s,i),[i]),s.getSnapshot!==e||n||Pi!==null&&Pi.memoizedState.tag&1){if(t.flags|=2048,Jl(9,Iv.bind(null,t,s,r,e),void 0,null),Li===null)throw Error(J(349));ka&30||Av(t,e,r)}return r}function Av(i,e,t){i.flags|=16384,i={getSnapshot:e,value:t},e=Ut.updateQueue,e===null?(e={lastEffect:null,stores:null},Ut.updateQueue=e,e.stores=[i]):(t=e.stores,t===null?e.stores=[i]:t.push(i))}function Iv(i,e,t,s){e.value=t,e.getSnapshot=s,Ov(e)&&Fv(i)}function Rv(i,e,t){return t(function(){Ov(e)&&Fv(i)})}function Ov(i){var e=i.getSnapshot;i=i.value;try{var t=e();return!br(i,t)}catch{return!0}}function Fv(i){var e=un(i,1);e!==null&&gr(e,i,1,-1)}function i1(i){var e=Nr();return typeof i=="function"&&(i=i()),e.memoizedState=e.baseState=i,i={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Ql,lastRenderedState:i},e.queue=i,i=i.dispatch=c2.bind(null,Ut,i),[e.memoizedState,i]}function Jl(i,e,t,s){return i={tag:i,create:e,destroy:t,deps:s,next:null},e=Ut.updateQueue,e===null?(e={lastEffect:null,stores:null},Ut.updateQueue=e,e.lastEffect=i.next=i):(t=e.lastEffect,t===null?e.lastEffect=i.next=i:(s=t.next,t.next=i,i.next=s,e.lastEffect=i)),i}function Vv(){return Js().memoizedState}function Dh(i,e,t,s){var r=Nr();Ut.flags|=i,r.memoizedState=Jl(1|e,t,void 0,s===void 0?null:s)}function rd(i,e,t,s){var r=Js();s=s===void 0?null:s;var n=void 0;if(Si!==null){var a=Si.memoizedState;if(n=a.destroy,s!==null&&Am(s,a.deps)){r.memoizedState=Jl(e,t,n,s);return}}Ut.flags|=i,r.memoizedState=Jl(1|e,t,n,s)}function s1(i,e){return Dh(8390656,8,i,e)}function Om(i,e){return rd(2048,8,i,e)}function Hv(i,e){return rd(4,2,i,e)}function zv(i,e){return rd(4,4,i,e)}function Wv(i,e){if(typeof e=="function")return i=i(),e(i),function(){e(null)};if(e!=null)return i=i(),e.current=i,function(){e.current=null}}function Gv(i,e,t){return t=t!=null?t.concat([i]):null,rd(4,4,Wv.bind(null,e,i),t)}function Fm(){}function jv(i,e){var t=Js();e=e===void 0?null:e;var s=t.memoizedState;return s!==null&&e!==null&&Am(e,s[1])?s[0]:(t.memoizedState=[i,e],i)}function Uv(i,e){var t=Js();e=e===void 0?null:e;var s=t.memoizedState;return s!==null&&e!==null&&Am(e,s[1])?s[0]:(i=i(),t.memoizedState=[i,e],i)}function $v(i,e,t){return ka&21?(br(t,e)||(t=Qw(),Ut.lanes|=t,xa|=t,i.baseState=!0),e):(i.baseState&&(i.baseState=!1,ds=!0),i.memoizedState=t)}function u2(i,e){var t=bt;bt=t!==0&&4>t?t:4,i(!0);var s=df.transition;df.transition={};try{i(!1),e()}finally{bt=t,df.transition=s}}function Yv(){return Js().memoizedState}function h2(i,e,t){var s=Gn(i);if(t={lane:s,action:t,hasEagerState:!1,eagerState:null,next:null},Xv(i))Qv(e,t);else if(t=Tv(i,e,t,s),t!==null){var r=rs();gr(t,i,s,r),Jv(t,e,s)}}function c2(i,e,t){var s=Gn(i),r={lane:s,action:t,hasEagerState:!1,eagerState:null,next:null};if(Xv(i))Qv(e,r);else{var n=i.alternate;if(i.lanes===0&&(n===null||n.lanes===0)&&(n=e.lastRenderedReducer,n!==null))try{var a=e.lastRenderedState,o=n(a,t);if(r.hasEagerState=!0,r.eagerState=o,br(o,a)){var l=e.interleaved;l===null?(r.next=r,Pm(e)):(r.next=l.next,l.next=r),e.interleaved=r;return}}catch{}finally{}t=Tv(i,e,r,s),t!==null&&(r=rs(),gr(t,i,s,r),Jv(t,e,s))}}function Xv(i){var e=i.alternate;return i===Ut||e!==null&&e===Ut}function Qv(i,e){_l=uc=!0;var t=i.pending;t===null?e.next=e:(e.next=t.next,t.next=e),i.pending=e}function Jv(i,e,t){if(t&4194240){var s=e.lanes;s&=i.pendingLanes,t|=s,e.lanes=t,gm(i,t)}}var hc={readContext:Qs,useCallback:Yi,useContext:Yi,useEffect:Yi,useImperativeHandle:Yi,useInsertionEffect:Yi,useLayoutEffect:Yi,useMemo:Yi,useReducer:Yi,useRef:Yi,useState:Yi,useDebugValue:Yi,useDeferredValue:Yi,useTransition:Yi,useMutableSource:Yi,useSyncExternalStore:Yi,useId:Yi,unstable_isNewReconciler:!1},d2={readContext:Qs,useCallback:function(i,e){return Nr().memoizedState=[i,e===void 0?null:e],i},useContext:Qs,useEffect:s1,useImperativeHandle:function(i,e,t){return t=t!=null?t.concat([i]):null,Dh(4194308,4,Wv.bind(null,e,i),t)},useLayoutEffect:function(i,e){return Dh(4194308,4,i,e)},useInsertionEffect:function(i,e){return Dh(4,2,i,e)},useMemo:function(i,e){var t=Nr();return e=e===void 0?null:e,i=i(),t.memoizedState=[i,e],i},useReducer:function(i,e,t){var s=Nr();return e=t!==void 0?t(e):e,s.memoizedState=s.baseState=e,i={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:i,lastRenderedState:e},s.queue=i,i=i.dispatch=h2.bind(null,Ut,i),[s.memoizedState,i]},useRef:function(i){var e=Nr();return i={current:i},e.memoizedState=i},useState:i1,useDebugValue:Fm,useDeferredValue:function(i){return Nr().memoizedState=i},useTransition:function(){var i=i1(!1),e=i[0];return i=u2.bind(null,i[1]),Nr().memoizedState=i,[e,i]},useMutableSource:function(){},useSyncExternalStore:function(i,e,t){var s=Ut,r=Nr();if(It){if(t===void 0)throw Error(J(407));t=t()}else{if(t=e(),Li===null)throw Error(J(349));ka&30||Av(s,e,t)}r.memoizedState=t;var n={value:t,getSnapshot:e};return r.queue=n,s1(Rv.bind(null,s,n,i),[i]),s.flags|=2048,Jl(9,Iv.bind(null,s,n,t,e),void 0,null),t},useId:function(){var i=Nr(),e=Li.identifierPrefix;if(It){var t=qr,s=Jr;t=(s&~(1<<32-pr(s)-1)).toString(32)+t,e=":"+e+"R"+t,t=Xl++,0<t&&(e+="H"+t.toString(32)),e+=":"}else t=l2++,e=":"+e+"r"+t.toString(32)+":";return i.memoizedState=e},unstable_isNewReconciler:!1},f2={readContext:Qs,useCallback:jv,useContext:Qs,useEffect:Om,useImperativeHandle:Gv,useInsertionEffect:Hv,useLayoutEffect:zv,useMemo:Uv,useReducer:ff,useRef:Vv,useState:function(){return ff(Ql)},useDebugValue:Fm,useDeferredValue:function(i){var e=Js();return $v(e,Si.memoizedState,i)},useTransition:function(){var i=ff(Ql)[0],e=Js().memoizedState;return[i,e]},useMutableSource:Lv,useSyncExternalStore:Dv,useId:Yv,unstable_isNewReconciler:!1},p2={readContext:Qs,useCallback:jv,useContext:Qs,useEffect:Om,useImperativeHandle:Gv,useInsertionEffect:Hv,useLayoutEffect:zv,useMemo:Uv,useReducer:pf,useRef:Vv,useState:function(){return pf(Ql)},useDebugValue:Fm,useDeferredValue:function(i){var e=Js();return Si===null?e.memoizedState=i:$v(e,Si.memoizedState,i)},useTransition:function(){var i=pf(Ql)[0],e=Js().memoizedState;return[i,e]},useMutableSource:Lv,useSyncExternalStore:Dv,useId:Yv,unstable_isNewReconciler:!1};function Eo(i,e){try{var t="",s=e;do t+=WN(s),s=s.return;while(s);var r=t}catch(n){r=`
Error generating stack: `+n.message+`
`+n.stack}return{value:i,source:e,stack:r,digest:null}}function gf(i,e,t){return{value:i,source:null,stack:t??null,digest:e??null}}function $p(i,e){try{console.error(e.value)}catch(t){setTimeout(function(){throw t})}}var g2=typeof WeakMap=="function"?WeakMap:Map;function qv(i,e,t){t=sn(-1,t),t.tag=3,t.payload={element:null};var s=e.value;return t.callback=function(){dc||(dc=!0,ig=s),$p(i,e)},t}function Kv(i,e,t){t=sn(-1,t),t.tag=3;var s=i.type.getDerivedStateFromError;if(typeof s=="function"){var r=e.value;t.payload=function(){return s(r)},t.callback=function(){$p(i,e)}}var n=i.stateNode;return n!==null&&typeof n.componentDidCatch=="function"&&(t.callback=function(){$p(i,e),typeof s!="function"&&(Wn===null?Wn=new Set([this]):Wn.add(this));var a=e.stack;this.componentDidCatch(e.value,{componentStack:a!==null?a:""})}),t}function r1(i,e,t){var s=i.pingCache;if(s===null){s=i.pingCache=new g2;var r=new Set;s.set(e,r)}else r=s.get(e),r===void 0&&(r=new Set,s.set(e,r));r.has(t)||(r.add(t),i=P2.bind(null,i,e,t),e.then(i,i))}function n1(i){do{var e;if((e=i.tag===13)&&(e=i.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return i;i=i.return}while(i!==null);return null}function a1(i,e,t,s,r){return i.mode&1?(i.flags|=65536,i.lanes=r,i):(i===e?i.flags|=65536:(i.flags|=128,t.flags|=131072,t.flags&=-52805,t.tag===1&&(t.alternate===null?t.tag=17:(e=sn(-1,1),e.tag=2,zn(t,e,1))),t.lanes|=1),i)}var m2=bn.ReactCurrentOwner,ds=!1;function es(i,e,t,s){e.child=i===null?Mv(e,null,t,s):Po(e,i.child,t,s)}function o1(i,e,t,s,r){t=t.render;var n=e.ref;return wo(e,r),s=Im(i,e,t,s,n,r),t=Rm(),i!==null&&!ds?(e.updateQueue=i.updateQueue,e.flags&=-2053,i.lanes&=~r,hn(i,e,r)):(It&&t&&xm(e),e.flags|=1,es(i,e,s,r),e.child)}function l1(i,e,t,s,r){if(i===null){var n=t.type;return typeof n=="function"&&!$m(n)&&n.defaultProps===void 0&&t.compare===null&&t.defaultProps===void 0?(e.tag=15,e.type=n,Zv(i,e,n,s,r)):(i=Oh(t.type,null,s,e,e.mode,r),i.ref=e.ref,i.return=e,e.child=i)}if(n=i.child,!(i.lanes&r)){var a=n.memoizedProps;if(t=t.compare,t=t!==null?t:Wl,t(a,s)&&i.ref===e.ref)return hn(i,e,r)}return e.flags|=1,i=jn(n,s),i.ref=e.ref,i.return=e,e.child=i}function Zv(i,e,t,s,r){if(i!==null){var n=i.memoizedProps;if(Wl(n,s)&&i.ref===e.ref)if(ds=!1,e.pendingProps=s=n,(i.lanes&r)!==0)i.flags&131072&&(ds=!0);else return e.lanes=i.lanes,hn(i,e,r)}return Yp(i,e,t,s,r)}function ek(i,e,t){var s=e.pendingProps,r=s.children,n=i!==null?i.memoizedState:null;if(s.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},xt(uo,ks),ks|=t;else{if(!(t&1073741824))return i=n!==null?n.baseLanes|t:t,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:i,cachePool:null,transitions:null},e.updateQueue=null,xt(uo,ks),ks|=i,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},s=n!==null?n.baseLanes:t,xt(uo,ks),ks|=s}else n!==null?(s=n.baseLanes|t,e.memoizedState=null):s=t,xt(uo,ks),ks|=s;return es(i,e,r,t),e.child}function tk(i,e){var t=e.ref;(i===null&&t!==null||i!==null&&i.ref!==t)&&(e.flags|=512,e.flags|=2097152)}function Yp(i,e,t,s,r){var n=gs(t)?wa:Ki.current;return n=Bo(e,n),wo(e,r),t=Im(i,e,t,s,n,r),s=Rm(),i!==null&&!ds?(e.updateQueue=i.updateQueue,e.flags&=-2053,i.lanes&=~r,hn(i,e,r)):(It&&s&&xm(e),e.flags|=1,es(i,e,t,r),e.child)}function u1(i,e,t,s,r){if(gs(t)){var n=!0;ic(e)}else n=!1;if(wo(e,r),e.stateNode===null)Ah(i,e),Cv(e,t,s),Up(e,t,s,r),s=!0;else if(i===null){var a=e.stateNode,o=e.memoizedProps;a.props=o;var l=a.context,u=t.contextType;typeof u=="object"&&u!==null?u=Qs(u):(u=gs(t)?wa:Ki.current,u=Bo(e,u));var h=t.getDerivedStateFromProps,c=typeof h=="function"||typeof a.getSnapshotBeforeUpdate=="function";c||typeof a.UNSAFE_componentWillReceiveProps!="function"&&typeof a.componentWillReceiveProps!="function"||(o!==s||l!==u)&&e1(e,a,s,u),Pn=!1;var d=e.memoizedState;a.state=d,oc(e,s,a,r),l=e.memoizedState,o!==s||d!==l||ps.current||Pn?(typeof h=="function"&&(jp(e,t,h,s),l=e.memoizedState),(o=Pn||Zy(e,t,o,s,d,l,u))?(c||typeof a.UNSAFE_componentWillMount!="function"&&typeof a.componentWillMount!="function"||(typeof a.componentWillMount=="function"&&a.componentWillMount(),typeof a.UNSAFE_componentWillMount=="function"&&a.UNSAFE_componentWillMount()),typeof a.componentDidMount=="function"&&(e.flags|=4194308)):(typeof a.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=s,e.memoizedState=l),a.props=s,a.state=l,a.context=u,s=o):(typeof a.componentDidMount=="function"&&(e.flags|=4194308),s=!1)}else{a=e.stateNode,Nv(i,e),o=e.memoizedProps,u=e.type===e.elementType?o:sr(e.type,o),a.props=u,c=e.pendingProps,d=a.context,l=t.contextType,typeof l=="object"&&l!==null?l=Qs(l):(l=gs(t)?wa:Ki.current,l=Bo(e,l));var f=t.getDerivedStateFromProps;(h=typeof f=="function"||typeof a.getSnapshotBeforeUpdate=="function")||typeof a.UNSAFE_componentWillReceiveProps!="function"&&typeof a.componentWillReceiveProps!="function"||(o!==c||d!==l)&&e1(e,a,s,l),Pn=!1,d=e.memoizedState,a.state=d,oc(e,s,a,r);var p=e.memoizedState;o!==c||d!==p||ps.current||Pn?(typeof f=="function"&&(jp(e,t,f,s),p=e.memoizedState),(u=Pn||Zy(e,t,u,s,d,p,l)||!1)?(h||typeof a.UNSAFE_componentWillUpdate!="function"&&typeof a.componentWillUpdate!="function"||(typeof a.componentWillUpdate=="function"&&a.componentWillUpdate(s,p,l),typeof a.UNSAFE_componentWillUpdate=="function"&&a.UNSAFE_componentWillUpdate(s,p,l)),typeof a.componentDidUpdate=="function"&&(e.flags|=4),typeof a.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof a.componentDidUpdate!="function"||o===i.memoizedProps&&d===i.memoizedState||(e.flags|=4),typeof a.getSnapshotBeforeUpdate!="function"||o===i.memoizedProps&&d===i.memoizedState||(e.flags|=1024),e.memoizedProps=s,e.memoizedState=p),a.props=s,a.state=p,a.context=l,s=u):(typeof a.componentDidUpdate!="function"||o===i.memoizedProps&&d===i.memoizedState||(e.flags|=4),typeof a.getSnapshotBeforeUpdate!="function"||o===i.memoizedProps&&d===i.memoizedState||(e.flags|=1024),s=!1)}return Xp(i,e,t,s,n,r)}function Xp(i,e,t,s,r,n){tk(i,e);var a=(e.flags&128)!==0;if(!s&&!a)return r&&Xy(e,t,!1),hn(i,e,n);s=e.stateNode,m2.current=e;var o=a&&typeof t.getDerivedStateFromError!="function"?null:s.render();return e.flags|=1,i!==null&&a?(e.child=Po(e,i.child,null,n),e.child=Po(e,null,o,n)):es(i,e,o,n),e.memoizedState=s.state,r&&Xy(e,t,!0),e.child}function ik(i){var e=i.stateNode;e.pendingContext?Yy(i,e.pendingContext,e.pendingContext!==e.context):e.context&&Yy(i,e.context,!1),Em(i,e.containerInfo)}function h1(i,e,t,s,r){return Co(),Tm(r),e.flags|=256,es(i,e,t,s),e.child}var Qp={dehydrated:null,treeContext:null,retryLane:0};function Jp(i){return{baseLanes:i,cachePool:null,transitions:null}}function sk(i,e,t){var s=e.pendingProps,r=Wt.current,n=!1,a=(e.flags&128)!==0,o;if((o=a)||(o=i!==null&&i.memoizedState===null?!1:(r&2)!==0),o?(n=!0,e.flags&=-129):(i===null||i.memoizedState!==null)&&(r|=1),xt(Wt,r&1),i===null)return Wp(e),i=e.memoizedState,i!==null&&(i=i.dehydrated,i!==null)?(e.mode&1?i.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(a=s.children,i=s.fallback,n?(s=e.mode,n=e.child,a={mode:"hidden",children:a},!(s&1)&&n!==null?(n.childLanes=0,n.pendingProps=a):n=od(a,s,0,null),i=ga(i,s,t,null),n.return=e,i.return=e,n.sibling=i,e.child=n,e.child.memoizedState=Jp(t),e.memoizedState=Qp,i):Vm(e,a));if(r=i.memoizedState,r!==null&&(o=r.dehydrated,o!==null))return y2(i,e,a,s,o,r,t);if(n){n=s.fallback,a=e.mode,r=i.child,o=r.sibling;var l={mode:"hidden",children:s.children};return!(a&1)&&e.child!==r?(s=e.child,s.childLanes=0,s.pendingProps=l,e.deletions=null):(s=jn(r,l),s.subtreeFlags=r.subtreeFlags&14680064),o!==null?n=jn(o,n):(n=ga(n,a,t,null),n.flags|=2),n.return=e,s.return=e,s.sibling=n,e.child=s,s=n,n=e.child,a=i.child.memoizedState,a=a===null?Jp(t):{baseLanes:a.baseLanes|t,cachePool:null,transitions:a.transitions},n.memoizedState=a,n.childLanes=i.childLanes&~t,e.memoizedState=Qp,s}return n=i.child,i=n.sibling,s=jn(n,{mode:"visible",children:s.children}),!(e.mode&1)&&(s.lanes=t),s.return=e,s.sibling=null,i!==null&&(t=e.deletions,t===null?(e.deletions=[i],e.flags|=16):t.push(i)),e.child=s,e.memoizedState=null,s}function Vm(i,e){return e=od({mode:"visible",children:e},i.mode,0,null),e.return=i,i.child=e}function ah(i,e,t,s){return s!==null&&Tm(s),Po(e,i.child,null,t),i=Vm(e,e.pendingProps.children),i.flags|=2,e.memoizedState=null,i}function y2(i,e,t,s,r,n,a){if(t)return e.flags&256?(e.flags&=-257,s=gf(Error(J(422))),ah(i,e,a,s)):e.memoizedState!==null?(e.child=i.child,e.flags|=128,null):(n=s.fallback,r=e.mode,s=od({mode:"visible",children:s.children},r,0,null),n=ga(n,r,a,null),n.flags|=2,s.return=e,n.return=e,s.sibling=n,e.child=s,e.mode&1&&Po(e,i.child,null,a),e.child.memoizedState=Jp(a),e.memoizedState=Qp,n);if(!(e.mode&1))return ah(i,e,a,null);if(r.data==="$!"){if(s=r.nextSibling&&r.nextSibling.dataset,s)var o=s.dgst;return s=o,n=Error(J(419)),s=gf(n,s,void 0),ah(i,e,a,s)}if(o=(a&i.childLanes)!==0,ds||o){if(s=Li,s!==null){switch(a&-a){case 4:r=2;break;case 16:r=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:r=32;break;case 536870912:r=268435456;break;default:r=0}r=r&(s.suspendedLanes|a)?0:r,r!==0&&r!==n.retryLane&&(n.retryLane=r,un(i,r),gr(s,i,r,-1))}return Um(),s=gf(Error(J(421))),ah(i,e,a,s)}return r.data==="$?"?(e.flags|=128,e.child=i.child,e=M2.bind(null,i),r._reactRetry=e,null):(i=n.treeContext,Bs=Hn(r.nextSibling),Ps=e,It=!0,ar=null,i!==null&&(Ws[Gs++]=Jr,Ws[Gs++]=qr,Ws[Gs++]=va,Jr=i.id,qr=i.overflow,va=e),e=Vm(e,s.children),e.flags|=4096,e)}function c1(i,e,t){i.lanes|=e;var s=i.alternate;s!==null&&(s.lanes|=e),Gp(i.return,e,t)}function mf(i,e,t,s,r){var n=i.memoizedState;n===null?i.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:s,tail:t,tailMode:r}:(n.isBackwards=e,n.rendering=null,n.renderingStartTime=0,n.last=s,n.tail=t,n.tailMode=r)}function rk(i,e,t){var s=e.pendingProps,r=s.revealOrder,n=s.tail;if(es(i,e,s.children,t),s=Wt.current,s&2)s=s&1|2,e.flags|=128;else{if(i!==null&&i.flags&128)e:for(i=e.child;i!==null;){if(i.tag===13)i.memoizedState!==null&&c1(i,t,e);else if(i.tag===19)c1(i,t,e);else if(i.child!==null){i.child.return=i,i=i.child;continue}if(i===e)break e;for(;i.sibling===null;){if(i.return===null||i.return===e)break e;i=i.return}i.sibling.return=i.return,i=i.sibling}s&=1}if(xt(Wt,s),!(e.mode&1))e.memoizedState=null;else switch(r){case"forwards":for(t=e.child,r=null;t!==null;)i=t.alternate,i!==null&&lc(i)===null&&(r=t),t=t.sibling;t=r,t===null?(r=e.child,e.child=null):(r=t.sibling,t.sibling=null),mf(e,!1,r,t,n);break;case"backwards":for(t=null,r=e.child,e.child=null;r!==null;){if(i=r.alternate,i!==null&&lc(i)===null){e.child=r;break}i=r.sibling,r.sibling=t,t=r,r=i}mf(e,!0,t,null,n);break;case"together":mf(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function Ah(i,e){!(e.mode&1)&&i!==null&&(i.alternate=null,e.alternate=null,e.flags|=2)}function hn(i,e,t){if(i!==null&&(e.dependencies=i.dependencies),xa|=e.lanes,!(t&e.childLanes))return null;if(i!==null&&e.child!==i.child)throw Error(J(153));if(e.child!==null){for(i=e.child,t=jn(i,i.pendingProps),e.child=t,t.return=e;i.sibling!==null;)i=i.sibling,t=t.sibling=jn(i,i.pendingProps),t.return=e;t.sibling=null}return e.child}function b2(i,e,t){switch(e.tag){case 3:ik(e),Co();break;case 5:Ev(e);break;case 1:gs(e.type)&&ic(e);break;case 4:Em(e,e.stateNode.containerInfo);break;case 10:var s=e.type._context,r=e.memoizedProps.value;xt(nc,s._currentValue),s._currentValue=r;break;case 13:if(s=e.memoizedState,s!==null)return s.dehydrated!==null?(xt(Wt,Wt.current&1),e.flags|=128,null):t&e.child.childLanes?sk(i,e,t):(xt(Wt,Wt.current&1),i=hn(i,e,t),i!==null?i.sibling:null);xt(Wt,Wt.current&1);break;case 19:if(s=(t&e.childLanes)!==0,i.flags&128){if(s)return rk(i,e,t);e.flags|=128}if(r=e.memoizedState,r!==null&&(r.rendering=null,r.tail=null,r.lastEffect=null),xt(Wt,Wt.current),s)break;return null;case 22:case 23:return e.lanes=0,ek(i,e,t)}return hn(i,e,t)}var nk,qp,ak,ok;nk=function(i,e){for(var t=e.child;t!==null;){if(t.tag===5||t.tag===6)i.appendChild(t.stateNode);else if(t.tag!==4&&t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return;t=t.return}t.sibling.return=t.return,t=t.sibling}};qp=function(){};ak=function(i,e,t,s){var r=i.memoizedProps;if(r!==s){i=e.stateNode,la(Rr.current);var n=null;switch(t){case"input":r=Sp(i,r),s=Sp(i,s),n=[];break;case"select":r=$t({},r,{value:void 0}),s=$t({},s,{value:void 0}),n=[];break;case"textarea":r=kp(i,r),s=kp(i,s),n=[];break;default:typeof r.onClick!="function"&&typeof s.onClick=="function"&&(i.onclick=ec)}_p(t,s);var a;t=null;for(u in r)if(!s.hasOwnProperty(u)&&r.hasOwnProperty(u)&&r[u]!=null)if(u==="style"){var o=r[u];for(a in o)o.hasOwnProperty(a)&&(t||(t={}),t[a]="")}else u!=="dangerouslySetInnerHTML"&&u!=="children"&&u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&u!=="autoFocus"&&(Il.hasOwnProperty(u)?n||(n=[]):(n=n||[]).push(u,null));for(u in s){var l=s[u];if(o=r!=null?r[u]:void 0,s.hasOwnProperty(u)&&l!==o&&(l!=null||o!=null))if(u==="style")if(o){for(a in o)!o.hasOwnProperty(a)||l&&l.hasOwnProperty(a)||(t||(t={}),t[a]="");for(a in l)l.hasOwnProperty(a)&&o[a]!==l[a]&&(t||(t={}),t[a]=l[a])}else t||(n||(n=[]),n.push(u,t)),t=l;else u==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,o=o?o.__html:void 0,l!=null&&o!==l&&(n=n||[]).push(u,l)):u==="children"?typeof l!="string"&&typeof l!="number"||(n=n||[]).push(u,""+l):u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&(Il.hasOwnProperty(u)?(l!=null&&u==="onScroll"&&Tt("scroll",i),n||o===l||(n=[])):(n=n||[]).push(u,l))}t&&(n=n||[]).push("style",t);var u=n;(e.updateQueue=u)&&(e.flags|=4)}};ok=function(i,e,t,s){t!==s&&(e.flags|=4)};function rl(i,e){if(!It)switch(i.tailMode){case"hidden":e=i.tail;for(var t=null;e!==null;)e.alternate!==null&&(t=e),e=e.sibling;t===null?i.tail=null:t.sibling=null;break;case"collapsed":t=i.tail;for(var s=null;t!==null;)t.alternate!==null&&(s=t),t=t.sibling;s===null?e||i.tail===null?i.tail=null:i.tail.sibling=null:s.sibling=null}}function Xi(i){var e=i.alternate!==null&&i.alternate.child===i.child,t=0,s=0;if(e)for(var r=i.child;r!==null;)t|=r.lanes|r.childLanes,s|=r.subtreeFlags&14680064,s|=r.flags&14680064,r.return=i,r=r.sibling;else for(r=i.child;r!==null;)t|=r.lanes|r.childLanes,s|=r.subtreeFlags,s|=r.flags,r.return=i,r=r.sibling;return i.subtreeFlags|=s,i.childLanes=t,e}function S2(i,e,t){var s=e.pendingProps;switch(_m(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Xi(e),null;case 1:return gs(e.type)&&tc(),Xi(e),null;case 3:return s=e.stateNode,Mo(),Ct(ps),Ct(Ki),Dm(),s.pendingContext&&(s.context=s.pendingContext,s.pendingContext=null),(i===null||i.child===null)&&(rh(e)?e.flags|=4:i===null||i.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,ar!==null&&(ng(ar),ar=null))),qp(i,e),Xi(e),null;case 5:Lm(e);var r=la(Yl.current);if(t=e.type,i!==null&&e.stateNode!=null)ak(i,e,t,s,r),i.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!s){if(e.stateNode===null)throw Error(J(166));return Xi(e),null}if(i=la(Rr.current),rh(e)){s=e.stateNode,t=e.type;var n=e.memoizedProps;switch(s[Er]=e,s[Ul]=n,i=(e.mode&1)!==0,t){case"dialog":Tt("cancel",s),Tt("close",s);break;case"iframe":case"object":case"embed":Tt("load",s);break;case"video":case"audio":for(r=0;r<pl.length;r++)Tt(pl[r],s);break;case"source":Tt("error",s);break;case"img":case"image":case"link":Tt("error",s),Tt("load",s);break;case"details":Tt("toggle",s);break;case"input":wy(s,n),Tt("invalid",s);break;case"select":s._wrapperState={wasMultiple:!!n.multiple},Tt("invalid",s);break;case"textarea":ky(s,n),Tt("invalid",s)}_p(t,n),r=null;for(var a in n)if(n.hasOwnProperty(a)){var o=n[a];a==="children"?typeof o=="string"?s.textContent!==o&&(n.suppressHydrationWarning!==!0&&sh(s.textContent,o,i),r=["children",o]):typeof o=="number"&&s.textContent!==""+o&&(n.suppressHydrationWarning!==!0&&sh(s.textContent,o,i),r=["children",""+o]):Il.hasOwnProperty(a)&&o!=null&&a==="onScroll"&&Tt("scroll",s)}switch(t){case"input":Qu(s),vy(s,n,!0);break;case"textarea":Qu(s),xy(s);break;case"select":case"option":break;default:typeof n.onClick=="function"&&(s.onclick=ec)}s=r,e.updateQueue=s,s!==null&&(e.flags|=4)}else{a=r.nodeType===9?r:r.ownerDocument,i==="http://www.w3.org/1999/xhtml"&&(i=Aw(t)),i==="http://www.w3.org/1999/xhtml"?t==="script"?(i=a.createElement("div"),i.innerHTML="<script><\/script>",i=i.removeChild(i.firstChild)):typeof s.is=="string"?i=a.createElement(t,{is:s.is}):(i=a.createElement(t),t==="select"&&(a=i,s.multiple?a.multiple=!0:s.size&&(a.size=s.size))):i=a.createElementNS(i,t),i[Er]=e,i[Ul]=s,nk(i,e,!1,!1),e.stateNode=i;e:{switch(a=Tp(t,s),t){case"dialog":Tt("cancel",i),Tt("close",i),r=s;break;case"iframe":case"object":case"embed":Tt("load",i),r=s;break;case"video":case"audio":for(r=0;r<pl.length;r++)Tt(pl[r],i);r=s;break;case"source":Tt("error",i),r=s;break;case"img":case"image":case"link":Tt("error",i),Tt("load",i),r=s;break;case"details":Tt("toggle",i),r=s;break;case"input":wy(i,s),r=Sp(i,s),Tt("invalid",i);break;case"option":r=s;break;case"select":i._wrapperState={wasMultiple:!!s.multiple},r=$t({},s,{value:void 0}),Tt("invalid",i);break;case"textarea":ky(i,s),r=kp(i,s),Tt("invalid",i);break;default:r=s}_p(t,r),o=r;for(n in o)if(o.hasOwnProperty(n)){var l=o[n];n==="style"?Ow(i,l):n==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,l!=null&&Iw(i,l)):n==="children"?typeof l=="string"?(t!=="textarea"||l!=="")&&Rl(i,l):typeof l=="number"&&Rl(i,""+l):n!=="suppressContentEditableWarning"&&n!=="suppressHydrationWarning"&&n!=="autoFocus"&&(Il.hasOwnProperty(n)?l!=null&&n==="onScroll"&&Tt("scroll",i):l!=null&&um(i,n,l,a))}switch(t){case"input":Qu(i),vy(i,s,!1);break;case"textarea":Qu(i),xy(i);break;case"option":s.value!=null&&i.setAttribute("value",""+$n(s.value));break;case"select":i.multiple=!!s.multiple,n=s.value,n!=null?mo(i,!!s.multiple,n,!1):s.defaultValue!=null&&mo(i,!!s.multiple,s.defaultValue,!0);break;default:typeof r.onClick=="function"&&(i.onclick=ec)}switch(t){case"button":case"input":case"select":case"textarea":s=!!s.autoFocus;break e;case"img":s=!0;break e;default:s=!1}}s&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return Xi(e),null;case 6:if(i&&e.stateNode!=null)ok(i,e,i.memoizedProps,s);else{if(typeof s!="string"&&e.stateNode===null)throw Error(J(166));if(t=la(Yl.current),la(Rr.current),rh(e)){if(s=e.stateNode,t=e.memoizedProps,s[Er]=e,(n=s.nodeValue!==t)&&(i=Ps,i!==null))switch(i.tag){case 3:sh(s.nodeValue,t,(i.mode&1)!==0);break;case 5:i.memoizedProps.suppressHydrationWarning!==!0&&sh(s.nodeValue,t,(i.mode&1)!==0)}n&&(e.flags|=4)}else s=(t.nodeType===9?t:t.ownerDocument).createTextNode(s),s[Er]=e,e.stateNode=s}return Xi(e),null;case 13:if(Ct(Wt),s=e.memoizedState,i===null||i.memoizedState!==null&&i.memoizedState.dehydrated!==null){if(It&&Bs!==null&&e.mode&1&&!(e.flags&128))_v(),Co(),e.flags|=98560,n=!1;else if(n=rh(e),s!==null&&s.dehydrated!==null){if(i===null){if(!n)throw Error(J(318));if(n=e.memoizedState,n=n!==null?n.dehydrated:null,!n)throw Error(J(317));n[Er]=e}else Co(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;Xi(e),n=!1}else ar!==null&&(ng(ar),ar=null),n=!0;if(!n)return e.flags&65536?e:null}return e.flags&128?(e.lanes=t,e):(s=s!==null,s!==(i!==null&&i.memoizedState!==null)&&s&&(e.child.flags|=8192,e.mode&1&&(i===null||Wt.current&1?ki===0&&(ki=3):Um())),e.updateQueue!==null&&(e.flags|=4),Xi(e),null);case 4:return Mo(),qp(i,e),i===null&&Gl(e.stateNode.containerInfo),Xi(e),null;case 10:return Cm(e.type._context),Xi(e),null;case 17:return gs(e.type)&&tc(),Xi(e),null;case 19:if(Ct(Wt),n=e.memoizedState,n===null)return Xi(e),null;if(s=(e.flags&128)!==0,a=n.rendering,a===null)if(s)rl(n,!1);else{if(ki!==0||i!==null&&i.flags&128)for(i=e.child;i!==null;){if(a=lc(i),a!==null){for(e.flags|=128,rl(n,!1),s=a.updateQueue,s!==null&&(e.updateQueue=s,e.flags|=4),e.subtreeFlags=0,s=t,t=e.child;t!==null;)n=t,i=s,n.flags&=14680066,a=n.alternate,a===null?(n.childLanes=0,n.lanes=i,n.child=null,n.subtreeFlags=0,n.memoizedProps=null,n.memoizedState=null,n.updateQueue=null,n.dependencies=null,n.stateNode=null):(n.childLanes=a.childLanes,n.lanes=a.lanes,n.child=a.child,n.subtreeFlags=0,n.deletions=null,n.memoizedProps=a.memoizedProps,n.memoizedState=a.memoizedState,n.updateQueue=a.updateQueue,n.type=a.type,i=a.dependencies,n.dependencies=i===null?null:{lanes:i.lanes,firstContext:i.firstContext}),t=t.sibling;return xt(Wt,Wt.current&1|2),e.child}i=i.sibling}n.tail!==null&&ti()>Lo&&(e.flags|=128,s=!0,rl(n,!1),e.lanes=4194304)}else{if(!s)if(i=lc(a),i!==null){if(e.flags|=128,s=!0,t=i.updateQueue,t!==null&&(e.updateQueue=t,e.flags|=4),rl(n,!0),n.tail===null&&n.tailMode==="hidden"&&!a.alternate&&!It)return Xi(e),null}else 2*ti()-n.renderingStartTime>Lo&&t!==1073741824&&(e.flags|=128,s=!0,rl(n,!1),e.lanes=4194304);n.isBackwards?(a.sibling=e.child,e.child=a):(t=n.last,t!==null?t.sibling=a:e.child=a,n.last=a)}return n.tail!==null?(e=n.tail,n.rendering=e,n.tail=e.sibling,n.renderingStartTime=ti(),e.sibling=null,t=Wt.current,xt(Wt,s?t&1|2:t&1),e):(Xi(e),null);case 22:case 23:return jm(),s=e.memoizedState!==null,i!==null&&i.memoizedState!==null!==s&&(e.flags|=8192),s&&e.mode&1?ks&1073741824&&(Xi(e),e.subtreeFlags&6&&(e.flags|=8192)):Xi(e),null;case 24:return null;case 25:return null}throw Error(J(156,e.tag))}function w2(i,e){switch(_m(e),e.tag){case 1:return gs(e.type)&&tc(),i=e.flags,i&65536?(e.flags=i&-65537|128,e):null;case 3:return Mo(),Ct(ps),Ct(Ki),Dm(),i=e.flags,i&65536&&!(i&128)?(e.flags=i&-65537|128,e):null;case 5:return Lm(e),null;case 13:if(Ct(Wt),i=e.memoizedState,i!==null&&i.dehydrated!==null){if(e.alternate===null)throw Error(J(340));Co()}return i=e.flags,i&65536?(e.flags=i&-65537|128,e):null;case 19:return Ct(Wt),null;case 4:return Mo(),null;case 10:return Cm(e.type._context),null;case 22:case 23:return jm(),null;case 24:return null;default:return null}}var oh=!1,Ji=!1,v2=typeof WeakSet=="function"?WeakSet:Set,ye=null;function lo(i,e){var t=i.ref;if(t!==null)if(typeof t=="function")try{t(null)}catch(s){Xt(i,e,s)}else t.current=null}function Kp(i,e,t){try{t()}catch(s){Xt(i,e,s)}}var d1=!1;function k2(i,e){if(Ip=qh,i=cv(),km(i)){if("selectionStart"in i)var t={start:i.selectionStart,end:i.selectionEnd};else e:{t=(t=i.ownerDocument)&&t.defaultView||window;var s=t.getSelection&&t.getSelection();if(s&&s.rangeCount!==0){t=s.anchorNode;var r=s.anchorOffset,n=s.focusNode;s=s.focusOffset;try{t.nodeType,n.nodeType}catch{t=null;break e}var a=0,o=-1,l=-1,u=0,h=0,c=i,d=null;t:for(;;){for(var f;c!==t||r!==0&&c.nodeType!==3||(o=a+r),c!==n||s!==0&&c.nodeType!==3||(l=a+s),c.nodeType===3&&(a+=c.nodeValue.length),(f=c.firstChild)!==null;)d=c,c=f;for(;;){if(c===i)break t;if(d===t&&++u===r&&(o=a),d===n&&++h===s&&(l=a),(f=c.nextSibling)!==null)break;c=d,d=c.parentNode}c=f}t=o===-1||l===-1?null:{start:o,end:l}}else t=null}t=t||{start:0,end:0}}else t=null;for(Rp={focusedElem:i,selectionRange:t},qh=!1,ye=e;ye!==null;)if(e=ye,i=e.child,(e.subtreeFlags&1028)!==0&&i!==null)i.return=e,ye=i;else for(;ye!==null;){e=ye;try{var p=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(p!==null){var g=p.memoizedProps,b=p.memoizedState,m=e.stateNode,y=m.getSnapshotBeforeUpdate(e.elementType===e.type?g:sr(e.type,g),b);m.__reactInternalSnapshotBeforeUpdate=y}break;case 3:var w=e.stateNode.containerInfo;w.nodeType===1?w.textContent="":w.nodeType===9&&w.documentElement&&w.removeChild(w.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(J(163))}}catch(x){Xt(e,e.return,x)}if(i=e.sibling,i!==null){i.return=e.return,ye=i;break}ye=e.return}return p=d1,d1=!1,p}function Tl(i,e,t){var s=e.updateQueue;if(s=s!==null?s.lastEffect:null,s!==null){var r=s=s.next;do{if((r.tag&i)===i){var n=r.destroy;r.destroy=void 0,n!==void 0&&Kp(e,t,n)}r=r.next}while(r!==s)}}function nd(i,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var t=e=e.next;do{if((t.tag&i)===i){var s=t.create;t.destroy=s()}t=t.next}while(t!==e)}}function Zp(i){var e=i.ref;if(e!==null){var t=i.stateNode;switch(i.tag){case 5:i=t;break;default:i=t}typeof e=="function"?e(i):e.current=i}}function lk(i){var e=i.alternate;e!==null&&(i.alternate=null,lk(e)),i.child=null,i.deletions=null,i.sibling=null,i.tag===5&&(e=i.stateNode,e!==null&&(delete e[Er],delete e[Ul],delete e[Vp],delete e[r2],delete e[n2])),i.stateNode=null,i.return=null,i.dependencies=null,i.memoizedProps=null,i.memoizedState=null,i.pendingProps=null,i.stateNode=null,i.updateQueue=null}function uk(i){return i.tag===5||i.tag===3||i.tag===4}function f1(i){e:for(;;){for(;i.sibling===null;){if(i.return===null||uk(i.return))return null;i=i.return}for(i.sibling.return=i.return,i=i.sibling;i.tag!==5&&i.tag!==6&&i.tag!==18;){if(i.flags&2||i.child===null||i.tag===4)continue e;i.child.return=i,i=i.child}if(!(i.flags&2))return i.stateNode}}function eg(i,e,t){var s=i.tag;if(s===5||s===6)i=i.stateNode,e?t.nodeType===8?t.parentNode.insertBefore(i,e):t.insertBefore(i,e):(t.nodeType===8?(e=t.parentNode,e.insertBefore(i,t)):(e=t,e.appendChild(i)),t=t._reactRootContainer,t!=null||e.onclick!==null||(e.onclick=ec));else if(s!==4&&(i=i.child,i!==null))for(eg(i,e,t),i=i.sibling;i!==null;)eg(i,e,t),i=i.sibling}function tg(i,e,t){var s=i.tag;if(s===5||s===6)i=i.stateNode,e?t.insertBefore(i,e):t.appendChild(i);else if(s!==4&&(i=i.child,i!==null))for(tg(i,e,t),i=i.sibling;i!==null;)tg(i,e,t),i=i.sibling}var Vi=null,rr=!1;function Tn(i,e,t){for(t=t.child;t!==null;)hk(i,e,t),t=t.sibling}function hk(i,e,t){if(Ir&&typeof Ir.onCommitFiberUnmount=="function")try{Ir.onCommitFiberUnmount(qc,t)}catch{}switch(t.tag){case 5:Ji||lo(t,e);case 6:var s=Vi,r=rr;Vi=null,Tn(i,e,t),Vi=s,rr=r,Vi!==null&&(rr?(i=Vi,t=t.stateNode,i.nodeType===8?i.parentNode.removeChild(t):i.removeChild(t)):Vi.removeChild(t.stateNode));break;case 18:Vi!==null&&(rr?(i=Vi,t=t.stateNode,i.nodeType===8?uf(i.parentNode,t):i.nodeType===1&&uf(i,t),Hl(i)):uf(Vi,t.stateNode));break;case 4:s=Vi,r=rr,Vi=t.stateNode.containerInfo,rr=!0,Tn(i,e,t),Vi=s,rr=r;break;case 0:case 11:case 14:case 15:if(!Ji&&(s=t.updateQueue,s!==null&&(s=s.lastEffect,s!==null))){r=s=s.next;do{var n=r,a=n.destroy;n=n.tag,a!==void 0&&(n&2||n&4)&&Kp(t,e,a),r=r.next}while(r!==s)}Tn(i,e,t);break;case 1:if(!Ji&&(lo(t,e),s=t.stateNode,typeof s.componentWillUnmount=="function"))try{s.props=t.memoizedProps,s.state=t.memoizedState,s.componentWillUnmount()}catch(o){Xt(t,e,o)}Tn(i,e,t);break;case 21:Tn(i,e,t);break;case 22:t.mode&1?(Ji=(s=Ji)||t.memoizedState!==null,Tn(i,e,t),Ji=s):Tn(i,e,t);break;default:Tn(i,e,t)}}function p1(i){var e=i.updateQueue;if(e!==null){i.updateQueue=null;var t=i.stateNode;t===null&&(t=i.stateNode=new v2),e.forEach(function(s){var r=E2.bind(null,i,s);t.has(s)||(t.add(s),s.then(r,r))})}}function er(i,e){var t=e.deletions;if(t!==null)for(var s=0;s<t.length;s++){var r=t[s];try{var n=i,a=e,o=a;e:for(;o!==null;){switch(o.tag){case 5:Vi=o.stateNode,rr=!1;break e;case 3:Vi=o.stateNode.containerInfo,rr=!0;break e;case 4:Vi=o.stateNode.containerInfo,rr=!0;break e}o=o.return}if(Vi===null)throw Error(J(160));hk(n,a,r),Vi=null,rr=!1;var l=r.alternate;l!==null&&(l.return=null),r.return=null}catch(u){Xt(r,e,u)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)ck(e,i),e=e.sibling}function ck(i,e){var t=i.alternate,s=i.flags;switch(i.tag){case 0:case 11:case 14:case 15:if(er(e,i),_r(i),s&4){try{Tl(3,i,i.return),nd(3,i)}catch(g){Xt(i,i.return,g)}try{Tl(5,i,i.return)}catch(g){Xt(i,i.return,g)}}break;case 1:er(e,i),_r(i),s&512&&t!==null&&lo(t,t.return);break;case 5:if(er(e,i),_r(i),s&512&&t!==null&&lo(t,t.return),i.flags&32){var r=i.stateNode;try{Rl(r,"")}catch(g){Xt(i,i.return,g)}}if(s&4&&(r=i.stateNode,r!=null)){var n=i.memoizedProps,a=t!==null?t.memoizedProps:n,o=i.type,l=i.updateQueue;if(i.updateQueue=null,l!==null)try{o==="input"&&n.type==="radio"&&n.name!=null&&Lw(r,n),Tp(o,a);var u=Tp(o,n);for(a=0;a<l.length;a+=2){var h=l[a],c=l[a+1];h==="style"?Ow(r,c):h==="dangerouslySetInnerHTML"?Iw(r,c):h==="children"?Rl(r,c):um(r,h,c,u)}switch(o){case"input":wp(r,n);break;case"textarea":Dw(r,n);break;case"select":var d=r._wrapperState.wasMultiple;r._wrapperState.wasMultiple=!!n.multiple;var f=n.value;f!=null?mo(r,!!n.multiple,f,!1):d!==!!n.multiple&&(n.defaultValue!=null?mo(r,!!n.multiple,n.defaultValue,!0):mo(r,!!n.multiple,n.multiple?[]:"",!1))}r[Ul]=n}catch(g){Xt(i,i.return,g)}}break;case 6:if(er(e,i),_r(i),s&4){if(i.stateNode===null)throw Error(J(162));r=i.stateNode,n=i.memoizedProps;try{r.nodeValue=n}catch(g){Xt(i,i.return,g)}}break;case 3:if(er(e,i),_r(i),s&4&&t!==null&&t.memoizedState.isDehydrated)try{Hl(e.containerInfo)}catch(g){Xt(i,i.return,g)}break;case 4:er(e,i),_r(i);break;case 13:er(e,i),_r(i),r=i.child,r.flags&8192&&(n=r.memoizedState!==null,r.stateNode.isHidden=n,!n||r.alternate!==null&&r.alternate.memoizedState!==null||(Wm=ti())),s&4&&p1(i);break;case 22:if(h=t!==null&&t.memoizedState!==null,i.mode&1?(Ji=(u=Ji)||h,er(e,i),Ji=u):er(e,i),_r(i),s&8192){if(u=i.memoizedState!==null,(i.stateNode.isHidden=u)&&!h&&i.mode&1)for(ye=i,h=i.child;h!==null;){for(c=ye=h;ye!==null;){switch(d=ye,f=d.child,d.tag){case 0:case 11:case 14:case 15:Tl(4,d,d.return);break;case 1:lo(d,d.return);var p=d.stateNode;if(typeof p.componentWillUnmount=="function"){s=d,t=d.return;try{e=s,p.props=e.memoizedProps,p.state=e.memoizedState,p.componentWillUnmount()}catch(g){Xt(s,t,g)}}break;case 5:lo(d,d.return);break;case 22:if(d.memoizedState!==null){m1(c);continue}}f!==null?(f.return=d,ye=f):m1(c)}h=h.sibling}e:for(h=null,c=i;;){if(c.tag===5){if(h===null){h=c;try{r=c.stateNode,u?(n=r.style,typeof n.setProperty=="function"?n.setProperty("display","none","important"):n.display="none"):(o=c.stateNode,l=c.memoizedProps.style,a=l!=null&&l.hasOwnProperty("display")?l.display:null,o.style.display=Rw("display",a))}catch(g){Xt(i,i.return,g)}}}else if(c.tag===6){if(h===null)try{c.stateNode.nodeValue=u?"":c.memoizedProps}catch(g){Xt(i,i.return,g)}}else if((c.tag!==22&&c.tag!==23||c.memoizedState===null||c===i)&&c.child!==null){c.child.return=c,c=c.child;continue}if(c===i)break e;for(;c.sibling===null;){if(c.return===null||c.return===i)break e;h===c&&(h=null),c=c.return}h===c&&(h=null),c.sibling.return=c.return,c=c.sibling}}break;case 19:er(e,i),_r(i),s&4&&p1(i);break;case 21:break;default:er(e,i),_r(i)}}function _r(i){var e=i.flags;if(e&2){try{e:{for(var t=i.return;t!==null;){if(uk(t)){var s=t;break e}t=t.return}throw Error(J(160))}switch(s.tag){case 5:var r=s.stateNode;s.flags&32&&(Rl(r,""),s.flags&=-33);var n=f1(i);tg(i,n,r);break;case 3:case 4:var a=s.stateNode.containerInfo,o=f1(i);eg(i,o,a);break;default:throw Error(J(161))}}catch(l){Xt(i,i.return,l)}i.flags&=-3}e&4096&&(i.flags&=-4097)}function x2(i,e,t){ye=i,dk(i)}function dk(i,e,t){for(var s=(i.mode&1)!==0;ye!==null;){var r=ye,n=r.child;if(r.tag===22&&s){var a=r.memoizedState!==null||oh;if(!a){var o=r.alternate,l=o!==null&&o.memoizedState!==null||Ji;o=oh;var u=Ji;if(oh=a,(Ji=l)&&!u)for(ye=r;ye!==null;)a=ye,l=a.child,a.tag===22&&a.memoizedState!==null?y1(r):l!==null?(l.return=a,ye=l):y1(r);for(;n!==null;)ye=n,dk(n),n=n.sibling;ye=r,oh=o,Ji=u}g1(i)}else r.subtreeFlags&8772&&n!==null?(n.return=r,ye=n):g1(i)}}function g1(i){for(;ye!==null;){var e=ye;if(e.flags&8772){var t=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:Ji||nd(5,e);break;case 1:var s=e.stateNode;if(e.flags&4&&!Ji)if(t===null)s.componentDidMount();else{var r=e.elementType===e.type?t.memoizedProps:sr(e.type,t.memoizedProps);s.componentDidUpdate(r,t.memoizedState,s.__reactInternalSnapshotBeforeUpdate)}var n=e.updateQueue;n!==null&&Ky(e,n,s);break;case 3:var a=e.updateQueue;if(a!==null){if(t=null,e.child!==null)switch(e.child.tag){case 5:t=e.child.stateNode;break;case 1:t=e.child.stateNode}Ky(e,a,t)}break;case 5:var o=e.stateNode;if(t===null&&e.flags&4){t=o;var l=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&t.focus();break;case"img":l.src&&(t.src=l.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var u=e.alternate;if(u!==null){var h=u.memoizedState;if(h!==null){var c=h.dehydrated;c!==null&&Hl(c)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(J(163))}Ji||e.flags&512&&Zp(e)}catch(d){Xt(e,e.return,d)}}if(e===i){ye=null;break}if(t=e.sibling,t!==null){t.return=e.return,ye=t;break}ye=e.return}}function m1(i){for(;ye!==null;){var e=ye;if(e===i){ye=null;break}var t=e.sibling;if(t!==null){t.return=e.return,ye=t;break}ye=e.return}}function y1(i){for(;ye!==null;){var e=ye;try{switch(e.tag){case 0:case 11:case 15:var t=e.return;try{nd(4,e)}catch(l){Xt(e,t,l)}break;case 1:var s=e.stateNode;if(typeof s.componentDidMount=="function"){var r=e.return;try{s.componentDidMount()}catch(l){Xt(e,r,l)}}var n=e.return;try{Zp(e)}catch(l){Xt(e,n,l)}break;case 5:var a=e.return;try{Zp(e)}catch(l){Xt(e,a,l)}}}catch(l){Xt(e,e.return,l)}if(e===i){ye=null;break}var o=e.sibling;if(o!==null){o.return=e.return,ye=o;break}ye=e.return}}var _2=Math.ceil,cc=bn.ReactCurrentDispatcher,Hm=bn.ReactCurrentOwner,Ys=bn.ReactCurrentBatchConfig,at=0,Li=null,di=null,Gi=0,ks=0,uo=Zn(0),ki=0,ql=null,xa=0,ad=0,zm=0,Nl=null,us=null,Wm=0,Lo=1/0,jr=null,dc=!1,ig=null,Wn=null,lh=!1,In=null,fc=0,Bl=0,sg=null,Ih=-1,Rh=0;function rs(){return at&6?ti():Ih!==-1?Ih:Ih=ti()}function Gn(i){return i.mode&1?at&2&&Gi!==0?Gi&-Gi:o2.transition!==null?(Rh===0&&(Rh=Qw()),Rh):(i=bt,i!==0||(i=window.event,i=i===void 0?16:iv(i.type)),i):1}function gr(i,e,t,s){if(50<Bl)throw Bl=0,sg=null,Error(J(185));Nu(i,t,s),(!(at&2)||i!==Li)&&(i===Li&&(!(at&2)&&(ad|=t),ki===4&&Dn(i,Gi)),ms(i,s),t===1&&at===0&&!(e.mode&1)&&(Lo=ti()+500,id&&ea()))}function ms(i,e){var t=i.callbackNode;oB(i,e);var s=Jh(i,i===Li?Gi:0);if(s===0)t!==null&&Ny(t),i.callbackNode=null,i.callbackPriority=0;else if(e=s&-s,i.callbackPriority!==e){if(t!=null&&Ny(t),e===1)i.tag===0?a2(b1.bind(null,i)):vv(b1.bind(null,i)),i2(function(){!(at&6)&&ea()}),t=null;else{switch(Jw(s)){case 1:t=pm;break;case 4:t=Yw;break;case 16:t=Qh;break;case 536870912:t=Xw;break;default:t=Qh}t=wk(t,fk.bind(null,i))}i.callbackPriority=e,i.callbackNode=t}}function fk(i,e){if(Ih=-1,Rh=0,at&6)throw Error(J(327));var t=i.callbackNode;if(vo()&&i.callbackNode!==t)return null;var s=Jh(i,i===Li?Gi:0);if(s===0)return null;if(s&30||s&i.expiredLanes||e)e=pc(i,s);else{e=s;var r=at;at|=2;var n=gk();(Li!==i||Gi!==e)&&(jr=null,Lo=ti()+500,pa(i,e));do try{B2();break}catch(o){pk(i,o)}while(!0);Bm(),cc.current=n,at=r,di!==null?e=0:(Li=null,Gi=0,e=ki)}if(e!==0){if(e===2&&(r=Mp(i),r!==0&&(s=r,e=rg(i,r))),e===1)throw t=ql,pa(i,0),Dn(i,s),ms(i,ti()),t;if(e===6)Dn(i,s);else{if(r=i.current.alternate,!(s&30)&&!T2(r)&&(e=pc(i,s),e===2&&(n=Mp(i),n!==0&&(s=n,e=rg(i,n))),e===1))throw t=ql,pa(i,0),Dn(i,s),ms(i,ti()),t;switch(i.finishedWork=r,i.finishedLanes=s,e){case 0:case 1:throw Error(J(345));case 2:sa(i,us,jr);break;case 3:if(Dn(i,s),(s&130023424)===s&&(e=Wm+500-ti(),10<e)){if(Jh(i,0)!==0)break;if(r=i.suspendedLanes,(r&s)!==s){rs(),i.pingedLanes|=i.suspendedLanes&r;break}i.timeoutHandle=Fp(sa.bind(null,i,us,jr),e);break}sa(i,us,jr);break;case 4:if(Dn(i,s),(s&4194240)===s)break;for(e=i.eventTimes,r=-1;0<s;){var a=31-pr(s);n=1<<a,a=e[a],a>r&&(r=a),s&=~n}if(s=r,s=ti()-s,s=(120>s?120:480>s?480:1080>s?1080:1920>s?1920:3e3>s?3e3:4320>s?4320:1960*_2(s/1960))-s,10<s){i.timeoutHandle=Fp(sa.bind(null,i,us,jr),s);break}sa(i,us,jr);break;case 5:sa(i,us,jr);break;default:throw Error(J(329))}}}return ms(i,ti()),i.callbackNode===t?fk.bind(null,i):null}function rg(i,e){var t=Nl;return i.current.memoizedState.isDehydrated&&(pa(i,e).flags|=256),i=pc(i,e),i!==2&&(e=us,us=t,e!==null&&ng(e)),i}function ng(i){us===null?us=i:us.push.apply(us,i)}function T2(i){for(var e=i;;){if(e.flags&16384){var t=e.updateQueue;if(t!==null&&(t=t.stores,t!==null))for(var s=0;s<t.length;s++){var r=t[s],n=r.getSnapshot;r=r.value;try{if(!br(n(),r))return!1}catch{return!1}}}if(t=e.child,e.subtreeFlags&16384&&t!==null)t.return=e,e=t;else{if(e===i)break;for(;e.sibling===null;){if(e.return===null||e.return===i)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function Dn(i,e){for(e&=~zm,e&=~ad,i.suspendedLanes|=e,i.pingedLanes&=~e,i=i.expirationTimes;0<e;){var t=31-pr(e),s=1<<t;i[t]=-1,e&=~s}}function b1(i){if(at&6)throw Error(J(327));vo();var e=Jh(i,0);if(!(e&1))return ms(i,ti()),null;var t=pc(i,e);if(i.tag!==0&&t===2){var s=Mp(i);s!==0&&(e=s,t=rg(i,s))}if(t===1)throw t=ql,pa(i,0),Dn(i,e),ms(i,ti()),t;if(t===6)throw Error(J(345));return i.finishedWork=i.current.alternate,i.finishedLanes=e,sa(i,us,jr),ms(i,ti()),null}function Gm(i,e){var t=at;at|=1;try{return i(e)}finally{at=t,at===0&&(Lo=ti()+500,id&&ea())}}function _a(i){In!==null&&In.tag===0&&!(at&6)&&vo();var e=at;at|=1;var t=Ys.transition,s=bt;try{if(Ys.transition=null,bt=1,i)return i()}finally{bt=s,Ys.transition=t,at=e,!(at&6)&&ea()}}function jm(){ks=uo.current,Ct(uo)}function pa(i,e){i.finishedWork=null,i.finishedLanes=0;var t=i.timeoutHandle;if(t!==-1&&(i.timeoutHandle=-1,t2(t)),di!==null)for(t=di.return;t!==null;){var s=t;switch(_m(s),s.tag){case 1:s=s.type.childContextTypes,s!=null&&tc();break;case 3:Mo(),Ct(ps),Ct(Ki),Dm();break;case 5:Lm(s);break;case 4:Mo();break;case 13:Ct(Wt);break;case 19:Ct(Wt);break;case 10:Cm(s.type._context);break;case 22:case 23:jm()}t=t.return}if(Li=i,di=i=jn(i.current,null),Gi=ks=e,ki=0,ql=null,zm=ad=xa=0,us=Nl=null,oa!==null){for(e=0;e<oa.length;e++)if(t=oa[e],s=t.interleaved,s!==null){t.interleaved=null;var r=s.next,n=t.pending;if(n!==null){var a=n.next;n.next=r,s.next=a}t.pending=s}oa=null}return i}function pk(i,e){do{var t=di;try{if(Bm(),Lh.current=hc,uc){for(var s=Ut.memoizedState;s!==null;){var r=s.queue;r!==null&&(r.pending=null),s=s.next}uc=!1}if(ka=0,Pi=Si=Ut=null,_l=!1,Xl=0,Hm.current=null,t===null||t.return===null){ki=1,ql=e,di=null;break}e:{var n=i,a=t.return,o=t,l=e;if(e=Gi,o.flags|=32768,l!==null&&typeof l=="object"&&typeof l.then=="function"){var u=l,h=o,c=h.tag;if(!(h.mode&1)&&(c===0||c===11||c===15)){var d=h.alternate;d?(h.updateQueue=d.updateQueue,h.memoizedState=d.memoizedState,h.lanes=d.lanes):(h.updateQueue=null,h.memoizedState=null)}var f=n1(a);if(f!==null){f.flags&=-257,a1(f,a,o,n,e),f.mode&1&&r1(n,u,e),e=f,l=u;var p=e.updateQueue;if(p===null){var g=new Set;g.add(l),e.updateQueue=g}else p.add(l);break e}else{if(!(e&1)){r1(n,u,e),Um();break e}l=Error(J(426))}}else if(It&&o.mode&1){var b=n1(a);if(b!==null){!(b.flags&65536)&&(b.flags|=256),a1(b,a,o,n,e),Tm(Eo(l,o));break e}}n=l=Eo(l,o),ki!==4&&(ki=2),Nl===null?Nl=[n]:Nl.push(n),n=a;do{switch(n.tag){case 3:n.flags|=65536,e&=-e,n.lanes|=e;var m=qv(n,l,e);qy(n,m);break e;case 1:o=l;var y=n.type,w=n.stateNode;if(!(n.flags&128)&&(typeof y.getDerivedStateFromError=="function"||w!==null&&typeof w.componentDidCatch=="function"&&(Wn===null||!Wn.has(w)))){n.flags|=65536,e&=-e,n.lanes|=e;var x=Kv(n,o,e);qy(n,x);break e}}n=n.return}while(n!==null)}yk(t)}catch(k){e=k,di===t&&t!==null&&(di=t=t.return);continue}break}while(!0)}function gk(){var i=cc.current;return cc.current=hc,i===null?hc:i}function Um(){(ki===0||ki===3||ki===2)&&(ki=4),Li===null||!(xa&268435455)&&!(ad&268435455)||Dn(Li,Gi)}function pc(i,e){var t=at;at|=2;var s=gk();(Li!==i||Gi!==e)&&(jr=null,pa(i,e));do try{N2();break}catch(r){pk(i,r)}while(!0);if(Bm(),at=t,cc.current=s,di!==null)throw Error(J(261));return Li=null,Gi=0,ki}function N2(){for(;di!==null;)mk(di)}function B2(){for(;di!==null&&!KN();)mk(di)}function mk(i){var e=Sk(i.alternate,i,ks);i.memoizedProps=i.pendingProps,e===null?yk(i):di=e,Hm.current=null}function yk(i){var e=i;do{var t=e.alternate;if(i=e.return,e.flags&32768){if(t=w2(t,e),t!==null){t.flags&=32767,di=t;return}if(i!==null)i.flags|=32768,i.subtreeFlags=0,i.deletions=null;else{ki=6,di=null;return}}else if(t=S2(t,e,ks),t!==null){di=t;return}if(e=e.sibling,e!==null){di=e;return}di=e=i}while(e!==null);ki===0&&(ki=5)}function sa(i,e,t){var s=bt,r=Ys.transition;try{Ys.transition=null,bt=1,C2(i,e,t,s)}finally{Ys.transition=r,bt=s}return null}function C2(i,e,t,s){do vo();while(In!==null);if(at&6)throw Error(J(327));t=i.finishedWork;var r=i.finishedLanes;if(t===null)return null;if(i.finishedWork=null,i.finishedLanes=0,t===i.current)throw Error(J(177));i.callbackNode=null,i.callbackPriority=0;var n=t.lanes|t.childLanes;if(lB(i,n),i===Li&&(di=Li=null,Gi=0),!(t.subtreeFlags&2064)&&!(t.flags&2064)||lh||(lh=!0,wk(Qh,function(){return vo(),null})),n=(t.flags&15990)!==0,t.subtreeFlags&15990||n){n=Ys.transition,Ys.transition=null;var a=bt;bt=1;var o=at;at|=4,Hm.current=null,k2(i,t),ck(t,i),XB(Rp),qh=!!Ip,Rp=Ip=null,i.current=t,x2(t),ZN(),at=o,bt=a,Ys.transition=n}else i.current=t;if(lh&&(lh=!1,In=i,fc=r),n=i.pendingLanes,n===0&&(Wn=null),iB(t.stateNode),ms(i,ti()),e!==null)for(s=i.onRecoverableError,t=0;t<e.length;t++)r=e[t],s(r.value,{componentStack:r.stack,digest:r.digest});if(dc)throw dc=!1,i=ig,ig=null,i;return fc&1&&i.tag!==0&&vo(),n=i.pendingLanes,n&1?i===sg?Bl++:(Bl=0,sg=i):Bl=0,ea(),null}function vo(){if(In!==null){var i=Jw(fc),e=Ys.transition,t=bt;try{if(Ys.transition=null,bt=16>i?16:i,In===null)var s=!1;else{if(i=In,In=null,fc=0,at&6)throw Error(J(331));var r=at;for(at|=4,ye=i.current;ye!==null;){var n=ye,a=n.child;if(ye.flags&16){var o=n.deletions;if(o!==null){for(var l=0;l<o.length;l++){var u=o[l];for(ye=u;ye!==null;){var h=ye;switch(h.tag){case 0:case 11:case 15:Tl(8,h,n)}var c=h.child;if(c!==null)c.return=h,ye=c;else for(;ye!==null;){h=ye;var d=h.sibling,f=h.return;if(lk(h),h===u){ye=null;break}if(d!==null){d.return=f,ye=d;break}ye=f}}}var p=n.alternate;if(p!==null){var g=p.child;if(g!==null){p.child=null;do{var b=g.sibling;g.sibling=null,g=b}while(g!==null)}}ye=n}}if(n.subtreeFlags&2064&&a!==null)a.return=n,ye=a;else e:for(;ye!==null;){if(n=ye,n.flags&2048)switch(n.tag){case 0:case 11:case 15:Tl(9,n,n.return)}var m=n.sibling;if(m!==null){m.return=n.return,ye=m;break e}ye=n.return}}var y=i.current;for(ye=y;ye!==null;){a=ye;var w=a.child;if(a.subtreeFlags&2064&&w!==null)w.return=a,ye=w;else e:for(a=y;ye!==null;){if(o=ye,o.flags&2048)try{switch(o.tag){case 0:case 11:case 15:nd(9,o)}}catch(k){Xt(o,o.return,k)}if(o===a){ye=null;break e}var x=o.sibling;if(x!==null){x.return=o.return,ye=x;break e}ye=o.return}}if(at=r,ea(),Ir&&typeof Ir.onPostCommitFiberRoot=="function")try{Ir.onPostCommitFiberRoot(qc,i)}catch{}s=!0}return s}finally{bt=t,Ys.transition=e}}return!1}function S1(i,e,t){e=Eo(t,e),e=qv(i,e,1),i=zn(i,e,1),e=rs(),i!==null&&(Nu(i,1,e),ms(i,e))}function Xt(i,e,t){if(i.tag===3)S1(i,i,t);else for(;e!==null;){if(e.tag===3){S1(e,i,t);break}else if(e.tag===1){var s=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof s.componentDidCatch=="function"&&(Wn===null||!Wn.has(s))){i=Eo(t,i),i=Kv(e,i,1),e=zn(e,i,1),i=rs(),e!==null&&(Nu(e,1,i),ms(e,i));break}}e=e.return}}function P2(i,e,t){var s=i.pingCache;s!==null&&s.delete(e),e=rs(),i.pingedLanes|=i.suspendedLanes&t,Li===i&&(Gi&t)===t&&(ki===4||ki===3&&(Gi&130023424)===Gi&&500>ti()-Wm?pa(i,0):zm|=t),ms(i,e)}function bk(i,e){e===0&&(i.mode&1?(e=Ku,Ku<<=1,!(Ku&130023424)&&(Ku=4194304)):e=1);var t=rs();i=un(i,e),i!==null&&(Nu(i,e,t),ms(i,t))}function M2(i){var e=i.memoizedState,t=0;e!==null&&(t=e.retryLane),bk(i,t)}function E2(i,e){var t=0;switch(i.tag){case 13:var s=i.stateNode,r=i.memoizedState;r!==null&&(t=r.retryLane);break;case 19:s=i.stateNode;break;default:throw Error(J(314))}s!==null&&s.delete(e),bk(i,t)}var Sk;Sk=function(i,e,t){if(i!==null)if(i.memoizedProps!==e.pendingProps||ps.current)ds=!0;else{if(!(i.lanes&t)&&!(e.flags&128))return ds=!1,b2(i,e,t);ds=!!(i.flags&131072)}else ds=!1,It&&e.flags&1048576&&kv(e,rc,e.index);switch(e.lanes=0,e.tag){case 2:var s=e.type;Ah(i,e),i=e.pendingProps;var r=Bo(e,Ki.current);wo(e,t),r=Im(null,e,s,i,r,t);var n=Rm();return e.flags|=1,typeof r=="object"&&r!==null&&typeof r.render=="function"&&r.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,gs(s)?(n=!0,ic(e)):n=!1,e.memoizedState=r.state!==null&&r.state!==void 0?r.state:null,Mm(e),r.updater=sd,e.stateNode=r,r._reactInternals=e,Up(e,s,i,t),e=Xp(null,e,s,!0,n,t)):(e.tag=0,It&&n&&xm(e),es(null,e,r,t),e=e.child),e;case 16:s=e.elementType;e:{switch(Ah(i,e),i=e.pendingProps,r=s._init,s=r(s._payload),e.type=s,r=e.tag=D2(s),i=sr(s,i),r){case 0:e=Yp(null,e,s,i,t);break e;case 1:e=u1(null,e,s,i,t);break e;case 11:e=o1(null,e,s,i,t);break e;case 14:e=l1(null,e,s,sr(s.type,i),t);break e}throw Error(J(306,s,""))}return e;case 0:return s=e.type,r=e.pendingProps,r=e.elementType===s?r:sr(s,r),Yp(i,e,s,r,t);case 1:return s=e.type,r=e.pendingProps,r=e.elementType===s?r:sr(s,r),u1(i,e,s,r,t);case 3:e:{if(ik(e),i===null)throw Error(J(387));s=e.pendingProps,n=e.memoizedState,r=n.element,Nv(i,e),oc(e,s,null,t);var a=e.memoizedState;if(s=a.element,n.isDehydrated)if(n={element:s,isDehydrated:!1,cache:a.cache,pendingSuspenseBoundaries:a.pendingSuspenseBoundaries,transitions:a.transitions},e.updateQueue.baseState=n,e.memoizedState=n,e.flags&256){r=Eo(Error(J(423)),e),e=h1(i,e,s,t,r);break e}else if(s!==r){r=Eo(Error(J(424)),e),e=h1(i,e,s,t,r);break e}else for(Bs=Hn(e.stateNode.containerInfo.firstChild),Ps=e,It=!0,ar=null,t=Mv(e,null,s,t),e.child=t;t;)t.flags=t.flags&-3|4096,t=t.sibling;else{if(Co(),s===r){e=hn(i,e,t);break e}es(i,e,s,t)}e=e.child}return e;case 5:return Ev(e),i===null&&Wp(e),s=e.type,r=e.pendingProps,n=i!==null?i.memoizedProps:null,a=r.children,Op(s,r)?a=null:n!==null&&Op(s,n)&&(e.flags|=32),tk(i,e),es(i,e,a,t),e.child;case 6:return i===null&&Wp(e),null;case 13:return sk(i,e,t);case 4:return Em(e,e.stateNode.containerInfo),s=e.pendingProps,i===null?e.child=Po(e,null,s,t):es(i,e,s,t),e.child;case 11:return s=e.type,r=e.pendingProps,r=e.elementType===s?r:sr(s,r),o1(i,e,s,r,t);case 7:return es(i,e,e.pendingProps,t),e.child;case 8:return es(i,e,e.pendingProps.children,t),e.child;case 12:return es(i,e,e.pendingProps.children,t),e.child;case 10:e:{if(s=e.type._context,r=e.pendingProps,n=e.memoizedProps,a=r.value,xt(nc,s._currentValue),s._currentValue=a,n!==null)if(br(n.value,a)){if(n.children===r.children&&!ps.current){e=hn(i,e,t);break e}}else for(n=e.child,n!==null&&(n.return=e);n!==null;){var o=n.dependencies;if(o!==null){a=n.child;for(var l=o.firstContext;l!==null;){if(l.context===s){if(n.tag===1){l=sn(-1,t&-t),l.tag=2;var u=n.updateQueue;if(u!==null){u=u.shared;var h=u.pending;h===null?l.next=l:(l.next=h.next,h.next=l),u.pending=l}}n.lanes|=t,l=n.alternate,l!==null&&(l.lanes|=t),Gp(n.return,t,e),o.lanes|=t;break}l=l.next}}else if(n.tag===10)a=n.type===e.type?null:n.child;else if(n.tag===18){if(a=n.return,a===null)throw Error(J(341));a.lanes|=t,o=a.alternate,o!==null&&(o.lanes|=t),Gp(a,t,e),a=n.sibling}else a=n.child;if(a!==null)a.return=n;else for(a=n;a!==null;){if(a===e){a=null;break}if(n=a.sibling,n!==null){n.return=a.return,a=n;break}a=a.return}n=a}es(i,e,r.children,t),e=e.child}return e;case 9:return r=e.type,s=e.pendingProps.children,wo(e,t),r=Qs(r),s=s(r),e.flags|=1,es(i,e,s,t),e.child;case 14:return s=e.type,r=sr(s,e.pendingProps),r=sr(s.type,r),l1(i,e,s,r,t);case 15:return Zv(i,e,e.type,e.pendingProps,t);case 17:return s=e.type,r=e.pendingProps,r=e.elementType===s?r:sr(s,r),Ah(i,e),e.tag=1,gs(s)?(i=!0,ic(e)):i=!1,wo(e,t),Cv(e,s,r),Up(e,s,r,t),Xp(null,e,s,!0,i,t);case 19:return rk(i,e,t);case 22:return ek(i,e,t)}throw Error(J(156,e.tag))};function wk(i,e){return $w(i,e)}function L2(i,e,t,s){this.tag=i,this.key=t,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=s,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function $s(i,e,t,s){return new L2(i,e,t,s)}function $m(i){return i=i.prototype,!(!i||!i.isReactComponent)}function D2(i){if(typeof i=="function")return $m(i)?1:0;if(i!=null){if(i=i.$$typeof,i===cm)return 11;if(i===dm)return 14}return 2}function jn(i,e){var t=i.alternate;return t===null?(t=$s(i.tag,e,i.key,i.mode),t.elementType=i.elementType,t.type=i.type,t.stateNode=i.stateNode,t.alternate=i,i.alternate=t):(t.pendingProps=e,t.type=i.type,t.flags=0,t.subtreeFlags=0,t.deletions=null),t.flags=i.flags&14680064,t.childLanes=i.childLanes,t.lanes=i.lanes,t.child=i.child,t.memoizedProps=i.memoizedProps,t.memoizedState=i.memoizedState,t.updateQueue=i.updateQueue,e=i.dependencies,t.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},t.sibling=i.sibling,t.index=i.index,t.ref=i.ref,t}function Oh(i,e,t,s,r,n){var a=2;if(s=i,typeof i=="function")$m(i)&&(a=1);else if(typeof i=="string")a=5;else e:switch(i){case Za:return ga(t.children,r,n,e);case hm:a=8,r|=8;break;case gp:return i=$s(12,t,e,r|2),i.elementType=gp,i.lanes=n,i;case mp:return i=$s(13,t,e,r),i.elementType=mp,i.lanes=n,i;case yp:return i=$s(19,t,e,r),i.elementType=yp,i.lanes=n,i;case Pw:return od(t,r,n,e);default:if(typeof i=="object"&&i!==null)switch(i.$$typeof){case Bw:a=10;break e;case Cw:a=9;break e;case cm:a=11;break e;case dm:a=14;break e;case Cn:a=16,s=null;break e}throw Error(J(130,i==null?i:typeof i,""))}return e=$s(a,t,e,r),e.elementType=i,e.type=s,e.lanes=n,e}function ga(i,e,t,s){return i=$s(7,i,s,e),i.lanes=t,i}function od(i,e,t,s){return i=$s(22,i,s,e),i.elementType=Pw,i.lanes=t,i.stateNode={isHidden:!1},i}function yf(i,e,t){return i=$s(6,i,null,e),i.lanes=t,i}function bf(i,e,t){return e=$s(4,i.children!==null?i.children:[],i.key,e),e.lanes=t,e.stateNode={containerInfo:i.containerInfo,pendingChildren:null,implementation:i.implementation},e}function A2(i,e,t,s,r){this.tag=e,this.containerInfo=i,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=qd(0),this.expirationTimes=qd(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=qd(0),this.identifierPrefix=s,this.onRecoverableError=r,this.mutableSourceEagerHydrationData=null}function Ym(i,e,t,s,r,n,a,o,l){return i=new A2(i,e,t,o,l),e===1?(e=1,n===!0&&(e|=8)):e=0,n=$s(3,null,null,e),i.current=n,n.stateNode=i,n.memoizedState={element:s,isDehydrated:t,cache:null,transitions:null,pendingSuspenseBoundaries:null},Mm(n),i}function I2(i,e,t){var s=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Ka,key:s==null?null:""+s,children:i,containerInfo:e,implementation:t}}function vk(i){if(!i)return Yn;i=i._reactInternals;e:{if(Ra(i)!==i||i.tag!==1)throw Error(J(170));var e=i;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(gs(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(J(171))}if(i.tag===1){var t=i.type;if(gs(t))return wv(i,t,e)}return e}function kk(i,e,t,s,r,n,a,o,l){return i=Ym(t,s,!0,i,r,n,a,o,l),i.context=vk(null),t=i.current,s=rs(),r=Gn(t),n=sn(s,r),n.callback=e??null,zn(t,n,r),i.current.lanes=r,Nu(i,r,s),ms(i,s),i}function ld(i,e,t,s){var r=e.current,n=rs(),a=Gn(r);return t=vk(t),e.context===null?e.context=t:e.pendingContext=t,e=sn(n,a),e.payload={element:i},s=s===void 0?null:s,s!==null&&(e.callback=s),i=zn(r,e,a),i!==null&&(gr(i,r,a,n),Eh(i,r,a)),a}function gc(i){if(i=i.current,!i.child)return null;switch(i.child.tag){case 5:return i.child.stateNode;default:return i.child.stateNode}}function w1(i,e){if(i=i.memoizedState,i!==null&&i.dehydrated!==null){var t=i.retryLane;i.retryLane=t!==0&&t<e?t:e}}function Xm(i,e){w1(i,e),(i=i.alternate)&&w1(i,e)}function R2(){return null}var xk=typeof reportError=="function"?reportError:function(i){console.error(i)};function Qm(i){this._internalRoot=i}ud.prototype.render=Qm.prototype.render=function(i){var e=this._internalRoot;if(e===null)throw Error(J(409));ld(i,e,null,null)};ud.prototype.unmount=Qm.prototype.unmount=function(){var i=this._internalRoot;if(i!==null){this._internalRoot=null;var e=i.containerInfo;_a(function(){ld(null,i,null,null)}),e[ln]=null}};function ud(i){this._internalRoot=i}ud.prototype.unstable_scheduleHydration=function(i){if(i){var e=Zw();i={blockedOn:null,target:i,priority:e};for(var t=0;t<Ln.length&&e!==0&&e<Ln[t].priority;t++);Ln.splice(t,0,i),t===0&&tv(i)}};function Jm(i){return!(!i||i.nodeType!==1&&i.nodeType!==9&&i.nodeType!==11)}function hd(i){return!(!i||i.nodeType!==1&&i.nodeType!==9&&i.nodeType!==11&&(i.nodeType!==8||i.nodeValue!==" react-mount-point-unstable "))}function v1(){}function O2(i,e,t,s,r){if(r){if(typeof s=="function"){var n=s;s=function(){var u=gc(a);n.call(u)}}var a=kk(e,s,i,0,null,!1,!1,"",v1);return i._reactRootContainer=a,i[ln]=a.current,Gl(i.nodeType===8?i.parentNode:i),_a(),a}for(;r=i.lastChild;)i.removeChild(r);if(typeof s=="function"){var o=s;s=function(){var u=gc(l);o.call(u)}}var l=Ym(i,0,!1,null,null,!1,!1,"",v1);return i._reactRootContainer=l,i[ln]=l.current,Gl(i.nodeType===8?i.parentNode:i),_a(function(){ld(e,l,t,s)}),l}function cd(i,e,t,s,r){var n=t._reactRootContainer;if(n){var a=n;if(typeof r=="function"){var o=r;r=function(){var l=gc(a);o.call(l)}}ld(e,a,i,r)}else a=O2(t,e,i,r,s);return gc(a)}qw=function(i){switch(i.tag){case 3:var e=i.stateNode;if(e.current.memoizedState.isDehydrated){var t=fl(e.pendingLanes);t!==0&&(gm(e,t|1),ms(e,ti()),!(at&6)&&(Lo=ti()+500,ea()))}break;case 13:_a(function(){var s=un(i,1);if(s!==null){var r=rs();gr(s,i,1,r)}}),Xm(i,1)}};mm=function(i){if(i.tag===13){var e=un(i,134217728);if(e!==null){var t=rs();gr(e,i,134217728,t)}Xm(i,134217728)}};Kw=function(i){if(i.tag===13){var e=Gn(i),t=un(i,e);if(t!==null){var s=rs();gr(t,i,e,s)}Xm(i,e)}};Zw=function(){return bt};ev=function(i,e){var t=bt;try{return bt=i,e()}finally{bt=t}};Bp=function(i,e,t){switch(e){case"input":if(wp(i,t),e=t.name,t.type==="radio"&&e!=null){for(t=i;t.parentNode;)t=t.parentNode;for(t=t.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<t.length;e++){var s=t[e];if(s!==i&&s.form===i.form){var r=td(s);if(!r)throw Error(J(90));Ew(s),wp(s,r)}}}break;case"textarea":Dw(i,t);break;case"select":e=t.value,e!=null&&mo(i,!!t.multiple,e,!1)}};Hw=Gm;zw=_a;var F2={usingClientEntryPoint:!1,Events:[Cu,so,td,Fw,Vw,Gm]},nl={findFiberByHostInstance:aa,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},V2={bundleType:nl.bundleType,version:nl.version,rendererPackageName:nl.rendererPackageName,rendererConfig:nl.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:bn.ReactCurrentDispatcher,findHostInstanceByFiber:function(i){return i=jw(i),i===null?null:i.stateNode},findFiberByHostInstance:nl.findFiberByHostInstance||R2,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var uh=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!uh.isDisabled&&uh.supportsFiber)try{qc=uh.inject(V2),Ir=uh}catch{}}Is.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=F2;Is.createPortal=function(i,e){var t=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Jm(e))throw Error(J(200));return I2(i,e,null,t)};Is.createRoot=function(i,e){if(!Jm(i))throw Error(J(299));var t=!1,s="",r=xk;return e!=null&&(e.unstable_strictMode===!0&&(t=!0),e.identifierPrefix!==void 0&&(s=e.identifierPrefix),e.onRecoverableError!==void 0&&(r=e.onRecoverableError)),e=Ym(i,1,!1,null,null,t,!1,s,r),i[ln]=e.current,Gl(i.nodeType===8?i.parentNode:i),new Qm(e)};Is.findDOMNode=function(i){if(i==null)return null;if(i.nodeType===1)return i;var e=i._reactInternals;if(e===void 0)throw typeof i.render=="function"?Error(J(188)):(i=Object.keys(i).join(","),Error(J(268,i)));return i=jw(e),i=i===null?null:i.stateNode,i};Is.flushSync=function(i){return _a(i)};Is.hydrate=function(i,e,t){if(!hd(e))throw Error(J(200));return cd(null,i,e,!0,t)};Is.hydrateRoot=function(i,e,t){if(!Jm(i))throw Error(J(405));var s=t!=null&&t.hydratedSources||null,r=!1,n="",a=xk;if(t!=null&&(t.unstable_strictMode===!0&&(r=!0),t.identifierPrefix!==void 0&&(n=t.identifierPrefix),t.onRecoverableError!==void 0&&(a=t.onRecoverableError)),e=kk(e,null,i,1,t??null,r,!1,n,a),i[ln]=e.current,Gl(i),s)for(i=0;i<s.length;i++)t=s[i],r=t._getVersion,r=r(t._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[t,r]:e.mutableSourceEagerHydrationData.push(t,r);return new ud(e)};Is.render=function(i,e,t){if(!hd(e))throw Error(J(200));return cd(null,i,e,!1,t)};Is.unmountComponentAtNode=function(i){if(!hd(i))throw Error(J(40));return i._reactRootContainer?(_a(function(){cd(null,null,i,!1,function(){i._reactRootContainer=null,i[ln]=null})}),!0):!1};Is.unstable_batchedUpdates=Gm;Is.unstable_renderSubtreeIntoContainer=function(i,e,t,s){if(!hd(t))throw Error(J(200));if(i==null||i._reactInternals===void 0)throw Error(J(38));return cd(i,e,t,!1,s)};Is.version="18.2.0-next-9e3b772b8-20220608";function _k(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(_k)}catch(i){console.error(i)}}_k(),kw.exports=Is;var dd=kw.exports,Tk,k1=dd;Tk=k1.createRoot,k1.hydrateRoot;var H2=!1;function z2(i){if(i.sheet)return i.sheet;for(var e=0;e<document.styleSheets.length;e++)if(document.styleSheets[e].ownerNode===i)return document.styleSheets[e]}function W2(i){var e=document.createElement("style");return e.setAttribute("data-emotion",i.key),i.nonce!==void 0&&e.setAttribute("nonce",i.nonce),e.appendChild(document.createTextNode("")),e.setAttribute("data-s",""),e}var G2=function(){function i(t){var s=this;this._insertTag=function(r){var n;s.tags.length===0?s.insertionPoint?n=s.insertionPoint.nextSibling:s.prepend?n=s.container.firstChild:n=s.before:n=s.tags[s.tags.length-1].nextSibling,s.container.insertBefore(r,n),s.tags.push(r)},this.isSpeedy=t.speedy===void 0?!H2:t.speedy,this.tags=[],this.ctr=0,this.nonce=t.nonce,this.key=t.key,this.container=t.container,this.prepend=t.prepend,this.insertionPoint=t.insertionPoint,this.before=null}var e=i.prototype;return e.hydrate=function(s){s.forEach(this._insertTag)},e.insert=function(s){this.ctr%(this.isSpeedy?65e3:1)===0&&this._insertTag(W2(this));var r=this.tags[this.tags.length-1];if(this.isSpeedy){var n=z2(r);try{n.insertRule(s,n.cssRules.length)}catch{}}else r.appendChild(document.createTextNode(s));this.ctr++},e.flush=function(){this.tags.forEach(function(s){var r;return(r=s.parentNode)==null?void 0:r.removeChild(s)}),this.tags=[],this.ctr=0},i}(),Qi="-ms-",mc="-moz-",dt="-webkit-",Nk="comm",qm="rule",Km="decl",j2="@import",Bk="@keyframes",U2="@layer",$2=Math.abs,fd=String.fromCharCode,Y2=Object.assign;function X2(i,e){return zi(i,0)^45?(((e<<2^zi(i,0))<<2^zi(i,1))<<2^zi(i,2))<<2^zi(i,3):0}function Ck(i){return i.trim()}function Q2(i,e){return(i=e.exec(i))?i[0]:i}function ft(i,e,t){return i.replace(e,t)}function ag(i,e){return i.indexOf(e)}function zi(i,e){return i.charCodeAt(e)|0}function Kl(i,e,t){return i.slice(e,t)}function Cr(i){return i.length}function Zm(i){return i.length}function hh(i,e){return e.push(i),i}function J2(i,e){return i.map(e).join("")}var pd=1,Do=1,Pk=0,bs=0,hi=0,Xo="";function gd(i,e,t,s,r,n,a){return{value:i,root:e,parent:t,type:s,props:r,children:n,line:pd,column:Do,length:a,return:""}}function al(i,e){return Y2(gd("",null,null,"",null,null,0),i,{length:-i.length},e)}function q2(){return hi}function K2(){return hi=bs>0?zi(Xo,--bs):0,Do--,hi===10&&(Do=1,pd--),hi}function Ms(){return hi=bs<Pk?zi(Xo,bs++):0,Do++,hi===10&&(Do=1,pd++),hi}function Or(){return zi(Xo,bs)}function Fh(){return bs}function Mu(i,e){return Kl(Xo,i,e)}function Zl(i){switch(i){case 0:case 9:case 10:case 13:case 32:return 5;case 33:case 43:case 44:case 47:case 62:case 64:case 126:case 59:case 123:case 125:return 4;case 58:return 3;case 34:case 39:case 40:case 91:return 2;case 41:case 93:return 1}return 0}function Mk(i){return pd=Do=1,Pk=Cr(Xo=i),bs=0,[]}function Ek(i){return Xo="",i}function Vh(i){return Ck(Mu(bs-1,og(i===91?i+2:i===40?i+1:i)))}function Z2(i){for(;(hi=Or())&&hi<33;)Ms();return Zl(i)>2||Zl(hi)>3?"":" "}function eC(i,e){for(;--e&&Ms()&&!(hi<48||hi>102||hi>57&&hi<65||hi>70&&hi<97););return Mu(i,Fh()+(e<6&&Or()==32&&Ms()==32))}function og(i){for(;Ms();)switch(hi){case i:return bs;case 34:case 39:i!==34&&i!==39&&og(hi);break;case 40:i===41&&og(i);break;case 92:Ms();break}return bs}function tC(i,e){for(;Ms()&&i+hi!==57;)if(i+hi===84&&Or()===47)break;return"/*"+Mu(e,bs-1)+"*"+fd(i===47?i:Ms())}function iC(i){for(;!Zl(Or());)Ms();return Mu(i,bs)}function sC(i){return Ek(Hh("",null,null,null,[""],i=Mk(i),0,[0],i))}function Hh(i,e,t,s,r,n,a,o,l){for(var u=0,h=0,c=a,d=0,f=0,p=0,g=1,b=1,m=1,y=0,w="",x=r,k=n,_=s,T=w;b;)switch(p=y,y=Ms()){case 40:if(p!=108&&zi(T,c-1)==58){ag(T+=ft(Vh(y),"&","&\f"),"&\f")!=-1&&(m=-1);break}case 34:case 39:case 91:T+=Vh(y);break;case 9:case 10:case 13:case 32:T+=Z2(p);break;case 92:T+=eC(Fh()-1,7);continue;case 47:switch(Or()){case 42:case 47:hh(rC(tC(Ms(),Fh()),e,t),l);break;default:T+="/"}break;case 123*g:o[u++]=Cr(T)*m;case 125*g:case 59:case 0:switch(y){case 0:case 125:b=0;case 59+h:m==-1&&(T=ft(T,/\f/g,"")),f>0&&Cr(T)-c&&hh(f>32?_1(T+";",s,t,c-1):_1(ft(T," ","")+";",s,t,c-2),l);break;case 59:T+=";";default:if(hh(_=x1(T,e,t,u,h,r,o,w,x=[],k=[],c),n),y===123)if(h===0)Hh(T,e,_,_,x,n,c,o,k);else switch(d===99&&zi(T,3)===110?100:d){case 100:case 108:case 109:case 115:Hh(i,_,_,s&&hh(x1(i,_,_,0,0,r,o,w,r,x=[],c),k),r,k,c,o,s?x:k);break;default:Hh(T,_,_,_,[""],k,0,o,k)}}u=h=f=0,g=m=1,w=T="",c=a;break;case 58:c=1+Cr(T),f=p;default:if(g<1){if(y==123)--g;else if(y==125&&g++==0&&K2()==125)continue}switch(T+=fd(y),y*g){case 38:m=h>0?1:(T+="\f",-1);break;case 44:o[u++]=(Cr(T)-1)*m,m=1;break;case 64:Or()===45&&(T+=Vh(Ms())),d=Or(),h=c=Cr(w=T+=iC(Fh())),y++;break;case 45:p===45&&Cr(T)==2&&(g=0)}}return n}function x1(i,e,t,s,r,n,a,o,l,u,h){for(var c=r-1,d=r===0?n:[""],f=Zm(d),p=0,g=0,b=0;p<s;++p)for(var m=0,y=Kl(i,c+1,c=$2(g=a[p])),w=i;m<f;++m)(w=Ck(g>0?d[m]+" "+y:ft(y,/&\f/g,d[m])))&&(l[b++]=w);return gd(i,e,t,r===0?qm:o,l,u,h)}function rC(i,e,t){return gd(i,e,t,Nk,fd(q2()),Kl(i,2,-2),0)}function _1(i,e,t,s){return gd(i,e,t,Km,Kl(i,0,s),Kl(i,s+1,-1),s)}function ko(i,e){for(var t="",s=Zm(i),r=0;r<s;r++)t+=e(i[r],r,i,e)||"";return t}function nC(i,e,t,s){switch(i.type){case U2:if(i.children.length)break;case j2:case Km:return i.return=i.return||i.value;case Nk:return"";case Bk:return i.return=i.value+"{"+ko(i.children,s)+"}";case qm:i.value=i.props.join(",")}return Cr(t=ko(i.children,s))?i.return=i.value+"{"+t+"}":""}function aC(i){var e=Zm(i);return function(t,s,r,n){for(var a="",o=0;o<e;o++)a+=i[o](t,s,r,n)||"";return a}}function oC(i){return function(e){e.root||(e=e.return)&&i(e)}}function lC(i){var e=Object.create(null);return function(t){return e[t]===void 0&&(e[t]=i(t)),e[t]}}var uC=function(e,t,s){for(var r=0,n=0;r=n,n=Or(),r===38&&n===12&&(t[s]=1),!Zl(n);)Ms();return Mu(e,bs)},hC=function(e,t){var s=-1,r=44;do switch(Zl(r)){case 0:r===38&&Or()===12&&(t[s]=1),e[s]+=uC(bs-1,t,s);break;case 2:e[s]+=Vh(r);break;case 4:if(r===44){e[++s]=Or()===58?"&\f":"",t[s]=e[s].length;break}default:e[s]+=fd(r)}while(r=Ms());return e},cC=function(e,t){return Ek(hC(Mk(e),t))},T1=new WeakMap,dC=function(e){if(!(e.type!=="rule"||!e.parent||e.length<1)){for(var t=e.value,s=e.parent,r=e.column===s.column&&e.line===s.line;s.type!=="rule";)if(s=s.parent,!s)return;if(!(e.props.length===1&&t.charCodeAt(0)!==58&&!T1.get(s))&&!r){T1.set(e,!0);for(var n=[],a=cC(t,n),o=s.props,l=0,u=0;l<a.length;l++)for(var h=0;h<o.length;h++,u++)e.props[u]=n[l]?a[l].replace(/&\f/g,o[h]):o[h]+" "+a[l]}}},fC=function(e){if(e.type==="decl"){var t=e.value;t.charCodeAt(0)===108&&t.charCodeAt(2)===98&&(e.return="",e.value="")}};function Lk(i,e){switch(X2(i,e)){case 5103:return dt+"print-"+i+i;case 5737:case 4201:case 3177:case 3433:case 1641:case 4457:case 2921:case 5572:case 6356:case 5844:case 3191:case 6645:case 3005:case 6391:case 5879:case 5623:case 6135:case 4599:case 4855:case 4215:case 6389:case 5109:case 5365:case 5621:case 3829:return dt+i+i;case 5349:case 4246:case 4810:case 6968:case 2756:return dt+i+mc+i+Qi+i+i;case 6828:case 4268:return dt+i+Qi+i+i;case 6165:return dt+i+Qi+"flex-"+i+i;case 5187:return dt+i+ft(i,/(\w+).+(:[^]+)/,dt+"box-$1$2"+Qi+"flex-$1$2")+i;case 5443:return dt+i+Qi+"flex-item-"+ft(i,/flex-|-self/,"")+i;case 4675:return dt+i+Qi+"flex-line-pack"+ft(i,/align-content|flex-|-self/,"")+i;case 5548:return dt+i+Qi+ft(i,"shrink","negative")+i;case 5292:return dt+i+Qi+ft(i,"basis","preferred-size")+i;case 6060:return dt+"box-"+ft(i,"-grow","")+dt+i+Qi+ft(i,"grow","positive")+i;case 4554:return dt+ft(i,/([^-])(transform)/g,"$1"+dt+"$2")+i;case 6187:return ft(ft(ft(i,/(zoom-|grab)/,dt+"$1"),/(image-set)/,dt+"$1"),i,"")+i;case 5495:case 3959:return ft(i,/(image-set\([^]*)/,dt+"$1$`$1");case 4968:return ft(ft(i,/(.+:)(flex-)?(.*)/,dt+"box-pack:$3"+Qi+"flex-pack:$3"),/s.+-b[^;]+/,"justify")+dt+i+i;case 4095:case 3583:case 4068:case 2532:return ft(i,/(.+)-inline(.+)/,dt+"$1$2")+i;case 8116:case 7059:case 5753:case 5535:case 5445:case 5701:case 4933:case 4677:case 5533:case 5789:case 5021:case 4765:if(Cr(i)-1-e>6)switch(zi(i,e+1)){case 109:if(zi(i,e+4)!==45)break;case 102:return ft(i,/(.+:)(.+)-([^]+)/,"$1"+dt+"$2-$3$1"+mc+(zi(i,e+3)==108?"$3":"$2-$3"))+i;case 115:return~ag(i,"stretch")?Lk(ft(i,"stretch","fill-available"),e)+i:i}break;case 4949:if(zi(i,e+1)!==115)break;case 6444:switch(zi(i,Cr(i)-3-(~ag(i,"!important")&&10))){case 107:return ft(i,":",":"+dt)+i;case 101:return ft(i,/(.+:)([^;!]+)(;|!.+)?/,"$1"+dt+(zi(i,14)===45?"inline-":"")+"box$3$1"+dt+"$2$3$1"+Qi+"$2box$3")+i}break;case 5936:switch(zi(i,e+11)){case 114:return dt+i+Qi+ft(i,/[svh]\w+-[tblr]{2}/,"tb")+i;case 108:return dt+i+Qi+ft(i,/[svh]\w+-[tblr]{2}/,"tb-rl")+i;case 45:return dt+i+Qi+ft(i,/[svh]\w+-[tblr]{2}/,"lr")+i}return dt+i+Qi+i+i}return i}var pC=function(e,t,s,r){if(e.length>-1&&!e.return)switch(e.type){case Km:e.return=Lk(e.value,e.length);break;case Bk:return ko([al(e,{value:ft(e.value,"@","@"+dt)})],r);case qm:if(e.length)return J2(e.props,function(n){switch(Q2(n,/(::plac\w+|:read-\w+)/)){case":read-only":case":read-write":return ko([al(e,{props:[ft(n,/:(read-\w+)/,":"+mc+"$1")]})],r);case"::placeholder":return ko([al(e,{props:[ft(n,/:(plac\w+)/,":"+dt+"input-$1")]}),al(e,{props:[ft(n,/:(plac\w+)/,":"+mc+"$1")]}),al(e,{props:[ft(n,/:(plac\w+)/,Qi+"input-$1")]})],r)}return""})}},gC=[pC],Dk=function(e){var t=e.key;if(t==="css"){var s=document.querySelectorAll("style[data-emotion]:not([data-s])");Array.prototype.forEach.call(s,function(g){var b=g.getAttribute("data-emotion");b.indexOf(" ")!==-1&&(document.head.appendChild(g),g.setAttribute("data-s",""))})}var r=e.stylisPlugins||gC,n={},a,o=[];a=e.container||document.head,Array.prototype.forEach.call(document.querySelectorAll('style[data-emotion^="'+t+' "]'),function(g){for(var b=g.getAttribute("data-emotion").split(" "),m=1;m<b.length;m++)n[b[m]]=!0;o.push(g)});var l,u=[dC,fC];{var h,c=[nC,oC(function(g){h.insert(g)})],d=aC(u.concat(r,c)),f=function(b){return ko(sC(b),d)};l=function(b,m,y,w){h=y,f(b?b+"{"+m.styles+"}":m.styles),w&&(p.inserted[m.name]=!0)}}var p={key:t,sheet:new G2({key:t,container:a,nonce:e.nonce,speedy:e.speedy,prepend:e.prepend,insertionPoint:e.insertionPoint}),nonce:e.nonce,inserted:n,registered:{},insert:l};return p.sheet.hydrate(o),p};function Ae(){return Ae=Object.assign?Object.assign.bind():function(i){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var s in t)({}).hasOwnProperty.call(t,s)&&(i[s]=t[s])}return i},Ae.apply(null,arguments)}var Ak={exports:{}},St={};/** @license React v16.13.1
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ai=typeof Symbol=="function"&&Symbol.for,e0=Ai?Symbol.for("react.element"):60103,t0=Ai?Symbol.for("react.portal"):60106,md=Ai?Symbol.for("react.fragment"):60107,yd=Ai?Symbol.for("react.strict_mode"):60108,bd=Ai?Symbol.for("react.profiler"):60114,Sd=Ai?Symbol.for("react.provider"):60109,wd=Ai?Symbol.for("react.context"):60110,i0=Ai?Symbol.for("react.async_mode"):60111,vd=Ai?Symbol.for("react.concurrent_mode"):60111,kd=Ai?Symbol.for("react.forward_ref"):60112,xd=Ai?Symbol.for("react.suspense"):60113,mC=Ai?Symbol.for("react.suspense_list"):60120,_d=Ai?Symbol.for("react.memo"):60115,Td=Ai?Symbol.for("react.lazy"):60116,yC=Ai?Symbol.for("react.block"):60121,bC=Ai?Symbol.for("react.fundamental"):60117,SC=Ai?Symbol.for("react.responder"):60118,wC=Ai?Symbol.for("react.scope"):60119;function Os(i){if(typeof i=="object"&&i!==null){var e=i.$$typeof;switch(e){case e0:switch(i=i.type,i){case i0:case vd:case md:case bd:case yd:case xd:return i;default:switch(i=i&&i.$$typeof,i){case wd:case kd:case Td:case _d:case Sd:return i;default:return e}}case t0:return e}}}function Ik(i){return Os(i)===vd}St.AsyncMode=i0;St.ConcurrentMode=vd;St.ContextConsumer=wd;St.ContextProvider=Sd;St.Element=e0;St.ForwardRef=kd;St.Fragment=md;St.Lazy=Td;St.Memo=_d;St.Portal=t0;St.Profiler=bd;St.StrictMode=yd;St.Suspense=xd;St.isAsyncMode=function(i){return Ik(i)||Os(i)===i0};St.isConcurrentMode=Ik;St.isContextConsumer=function(i){return Os(i)===wd};St.isContextProvider=function(i){return Os(i)===Sd};St.isElement=function(i){return typeof i=="object"&&i!==null&&i.$$typeof===e0};St.isForwardRef=function(i){return Os(i)===kd};St.isFragment=function(i){return Os(i)===md};St.isLazy=function(i){return Os(i)===Td};St.isMemo=function(i){return Os(i)===_d};St.isPortal=function(i){return Os(i)===t0};St.isProfiler=function(i){return Os(i)===bd};St.isStrictMode=function(i){return Os(i)===yd};St.isSuspense=function(i){return Os(i)===xd};St.isValidElementType=function(i){return typeof i=="string"||typeof i=="function"||i===md||i===vd||i===bd||i===yd||i===xd||i===mC||typeof i=="object"&&i!==null&&(i.$$typeof===Td||i.$$typeof===_d||i.$$typeof===Sd||i.$$typeof===wd||i.$$typeof===kd||i.$$typeof===bC||i.$$typeof===SC||i.$$typeof===wC||i.$$typeof===yC)};St.typeOf=Os;Ak.exports=St;var vC=Ak.exports,Rk=vC,kC={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},xC={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},Ok={};Ok[Rk.ForwardRef]=kC;Ok[Rk.Memo]=xC;var _C=!0;function s0(i,e,t){var s="";return t.split(" ").forEach(function(r){i[r]!==void 0?e.push(i[r]+";"):r&&(s+=r+" ")}),s}var Fk=function(e,t,s){var r=e.key+"-"+t.name;(s===!1||_C===!1)&&e.registered[r]===void 0&&(e.registered[r]=t.styles)},r0=function(e,t,s){Fk(e,t,s);var r=e.key+"-"+t.name;if(e.inserted[t.name]===void 0){var n=t;do e.insert(t===n?"."+r:"",n,e.sheet,!0),n=n.next;while(n!==void 0)}};function TC(i){for(var e=0,t,s=0,r=i.length;r>=4;++s,r-=4)t=i.charCodeAt(s)&255|(i.charCodeAt(++s)&255)<<8|(i.charCodeAt(++s)&255)<<16|(i.charCodeAt(++s)&255)<<24,t=(t&65535)*1540483477+((t>>>16)*59797<<16),t^=t>>>24,e=(t&65535)*1540483477+((t>>>16)*59797<<16)^(e&65535)*1540483477+((e>>>16)*59797<<16);switch(r){case 3:e^=(i.charCodeAt(s+2)&255)<<16;case 2:e^=(i.charCodeAt(s+1)&255)<<8;case 1:e^=i.charCodeAt(s)&255,e=(e&65535)*1540483477+((e>>>16)*59797<<16)}return e^=e>>>13,e=(e&65535)*1540483477+((e>>>16)*59797<<16),((e^e>>>15)>>>0).toString(36)}var NC={animationIterationCount:1,aspectRatio:1,borderImageOutset:1,borderImageSlice:1,borderImageWidth:1,boxFlex:1,boxFlexGroup:1,boxOrdinalGroup:1,columnCount:1,columns:1,flex:1,flexGrow:1,flexPositive:1,flexShrink:1,flexNegative:1,flexOrder:1,gridRow:1,gridRowEnd:1,gridRowSpan:1,gridRowStart:1,gridColumn:1,gridColumnEnd:1,gridColumnSpan:1,gridColumnStart:1,msGridRow:1,msGridRowSpan:1,msGridColumn:1,msGridColumnSpan:1,fontWeight:1,lineHeight:1,opacity:1,order:1,orphans:1,scale:1,tabSize:1,widows:1,zIndex:1,zoom:1,WebkitLineClamp:1,fillOpacity:1,floodOpacity:1,stopOpacity:1,strokeDasharray:1,strokeDashoffset:1,strokeMiterlimit:1,strokeOpacity:1,strokeWidth:1},BC=!1,CC=/[A-Z]|^ms/g,PC=/_EMO_([^_]+?)_([^]*?)_EMO_/g,Vk=function(e){return e.charCodeAt(1)===45},N1=function(e){return e!=null&&typeof e!="boolean"},Sf=lC(function(i){return Vk(i)?i:i.replace(CC,"-$&").toLowerCase()}),B1=function(e,t){switch(e){case"animation":case"animationName":if(typeof t=="string")return t.replace(PC,function(s,r,n){return Pr={name:r,styles:n,next:Pr},r})}return NC[e]!==1&&!Vk(e)&&typeof t=="number"&&t!==0?t+"px":t},MC="Component selectors can only be used in conjunction with @emotion/babel-plugin, the swc Emotion plugin, or another Emotion-aware compiler transform.";function eu(i,e,t){if(t==null)return"";var s=t;if(s.__emotion_styles!==void 0)return s;switch(typeof t){case"boolean":return"";case"object":{var r=t;if(r.anim===1)return Pr={name:r.name,styles:r.styles,next:Pr},r.name;var n=t;if(n.styles!==void 0){var a=n.next;if(a!==void 0)for(;a!==void 0;)Pr={name:a.name,styles:a.styles,next:Pr},a=a.next;var o=n.styles+";";return o}return EC(i,e,t)}case"function":{if(i!==void 0){var l=Pr,u=t(i);return Pr=l,eu(i,e,u)}break}}var h=t;if(e==null)return h;var c=e[h];return c!==void 0?c:h}function EC(i,e,t){var s="";if(Array.isArray(t))for(var r=0;r<t.length;r++)s+=eu(i,e,t[r])+";";else for(var n in t){var a=t[n];if(typeof a!="object"){var o=a;e!=null&&e[o]!==void 0?s+=n+"{"+e[o]+"}":N1(o)&&(s+=Sf(n)+":"+B1(n,o)+";")}else{if(n==="NO_COMPONENT_SELECTOR"&&BC)throw new Error(MC);if(Array.isArray(a)&&typeof a[0]=="string"&&(e==null||e[a[0]]===void 0))for(var l=0;l<a.length;l++)N1(a[l])&&(s+=Sf(n)+":"+B1(n,a[l])+";");else{var u=eu(i,e,a);switch(n){case"animation":case"animationName":{s+=Sf(n)+":"+u+";";break}default:s+=n+"{"+u+"}"}}}}return s}var C1=/label:\s*([^\s;{]+)\s*(;|$)/g,Pr;function xo(i,e,t){if(i.length===1&&typeof i[0]=="object"&&i[0]!==null&&i[0].styles!==void 0)return i[0];var s=!0,r="";Pr=void 0;var n=i[0];if(n==null||n.raw===void 0)s=!1,r+=eu(t,e,n);else{var a=n;r+=a[0]}for(var o=1;o<i.length;o++)if(r+=eu(t,e,i[o]),s){var l=n;r+=l[o]}C1.lastIndex=0;for(var u="",h;(h=C1.exec(r))!==null;)u+="-"+h[1];var c=TC(r)+u;return{name:c,styles:r,next:Pr}}var LC=function(e){return e()},Hk=Al.useInsertionEffect?Al.useInsertionEffect:!1,DC=Hk||LC,P1=Hk||P.useLayoutEffect,n0={}.hasOwnProperty,zk=P.createContext(typeof HTMLElement<"u"?Dk({key:"css"}):null);zk.Provider;var Wk=function(e){return P.forwardRef(function(t,s){var r=P.useContext(zk);return e(t,r,s)})},Gk=P.createContext({}),lg="__EMOTION_TYPE_PLEASE_DO_NOT_USE__",AC=function(e,t){var s={};for(var r in t)n0.call(t,r)&&(s[r]=t[r]);return s[lg]=e,s},IC=function(e){var t=e.cache,s=e.serialized,r=e.isStringTag;return Fk(t,s,r),DC(function(){return r0(t,s,r)}),null},RC=Wk(function(i,e,t){var s=i.css;typeof s=="string"&&e.registered[s]!==void 0&&(s=e.registered[s]);var r=i[lg],n=[s],a="";typeof i.className=="string"?a=s0(e.registered,n,i.className):i.className!=null&&(a=i.className+" ");var o=xo(n,void 0,P.useContext(Gk));a+=e.key+"-"+o.name;var l={};for(var u in i)n0.call(i,u)&&u!=="css"&&u!==lg&&(l[u]=i[u]);return l.ref=t,l.className=a,P.createElement(P.Fragment,null,P.createElement(IC,{cache:e,serialized:o,isStringTag:typeof r=="string"}),P.createElement(r,l))}),OC=RC,Ee=function(e,t){var s=arguments;if(t==null||!n0.call(t,"css"))return P.createElement.apply(void 0,s);var r=s.length,n=new Array(r);n[0]=OC,n[1]=AC(e,t);for(var a=2;a<r;a++)n[a]=s[a];return P.createElement.apply(null,n)},FC=Wk(function(i,e){var t=i.styles,s=xo([t],void 0,P.useContext(Gk)),r=P.useRef();return P1(function(){var n=e.key+"-global",a=new e.sheet.constructor({key:n,nonce:e.sheet.nonce,container:e.sheet.container,speedy:e.sheet.isSpeedy}),o=!1,l=document.querySelector('style[data-emotion="'+n+" "+s.name+'"]');return e.sheet.tags.length&&(a.before=e.sheet.tags[0]),l!==null&&(o=!0,l.setAttribute("data-emotion",n),a.hydrate([l])),r.current=[a,o],function(){a.flush()}},[e]),P1(function(){var n=r.current,a=n[0],o=n[1];if(o){n[1]=!1;return}if(s.next!==void 0&&r0(e,s.next,!0),a.tags.length){var l=a.tags[a.tags.length-1].nextElementSibling;a.before=l,a.flush()}e.insert("",s,a,!1)},[e,s.name]),null});function Nd(){for(var i=arguments.length,e=new Array(i),t=0;t<i;t++)e[t]=arguments[t];return xo(e)}var VC=function(){var e=Nd.apply(void 0,arguments),t="animation-"+e.name;return{name:t,styles:"@keyframes "+t+"{"+e.styles+"}",anim:1,toString:function(){return"_EMO_"+this.name+"_"+this.styles+"_EMO_"}}};/**
 * @remix-run/router v1.19.2
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function yc(){return yc=Object.assign?Object.assign.bind():function(i){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(i[s]=t[s])}return i},yc.apply(this,arguments)}var ua;(function(i){i.Pop="POP",i.Push="PUSH",i.Replace="REPLACE"})(ua||(ua={}));const M1="popstate";function HC(i){i===void 0&&(i={});function e(r,n){let{pathname:a="/",search:o="",hash:l=""}=a0(r.location.hash.substr(1));return!a.startsWith("/")&&!a.startsWith(".")&&(a="/"+a),ug("",{pathname:a,search:o,hash:l},n.state&&n.state.usr||null,n.state&&n.state.key||"default")}function t(r,n){let a=r.document.querySelector("base"),o="";if(a&&a.getAttribute("href")){let l=r.location.href,u=l.indexOf("#");o=u===-1?l:l.slice(0,u)}return o+"#"+(typeof n=="string"?n:Uk(n))}function s(r,n){zC(r.pathname.charAt(0)==="/","relative pathnames are not supported in hash history.push("+JSON.stringify(n)+")")}return GC(e,t,s,i)}function jk(i,e){if(i===!1||i===null||typeof i>"u")throw new Error(e)}function zC(i,e){if(!i){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function WC(){return Math.random().toString(36).substr(2,8)}function E1(i,e){return{usr:i.state,key:i.key,idx:e}}function ug(i,e,t,s){return t===void 0&&(t=null),yc({pathname:typeof i=="string"?i:i.pathname,search:"",hash:""},typeof e=="string"?a0(e):e,{state:t,key:e&&e.key||s||WC()})}function Uk(i){let{pathname:e="/",search:t="",hash:s=""}=i;return t&&t!=="?"&&(e+=t.charAt(0)==="?"?t:"?"+t),s&&s!=="#"&&(e+=s.charAt(0)==="#"?s:"#"+s),e}function a0(i){let e={};if(i){let t=i.indexOf("#");t>=0&&(e.hash=i.substr(t),i=i.substr(0,t));let s=i.indexOf("?");s>=0&&(e.search=i.substr(s),i=i.substr(0,s)),i&&(e.pathname=i)}return e}function GC(i,e,t,s){s===void 0&&(s={});let{window:r=document.defaultView,v5Compat:n=!1}=s,a=r.history,o=ua.Pop,l=null,u=h();u==null&&(u=0,a.replaceState(yc({},a.state,{idx:u}),""));function h(){return(a.state||{idx:null}).idx}function c(){o=ua.Pop;let b=h(),m=b==null?null:b-u;u=b,l&&l({action:o,location:g.location,delta:m})}function d(b,m){o=ua.Push;let y=ug(g.location,b,m);t&&t(y,b),u=h()+1;let w=E1(y,u),x=g.createHref(y);try{a.pushState(w,"",x)}catch(k){if(k instanceof DOMException&&k.name==="DataCloneError")throw k;r.location.assign(x)}n&&l&&l({action:o,location:g.location,delta:1})}function f(b,m){o=ua.Replace;let y=ug(g.location,b,m);t&&t(y,b),u=h();let w=E1(y,u),x=g.createHref(y);a.replaceState(w,"",x),n&&l&&l({action:o,location:g.location,delta:0})}function p(b){let m=r.location.origin!=="null"?r.location.origin:r.location.href,y=typeof b=="string"?b:Uk(b);return y=y.replace(/ $/,"%20"),jk(m,"No window.location.(origin|href) available to create URL for href: "+y),new URL(y,m)}let g={get action(){return o},get location(){return i(r,a)},listen(b){if(l)throw new Error("A history only accepts one active listener");return r.addEventListener(M1,c),l=b,()=>{r.removeEventListener(M1,c),l=null}},createHref(b){return e(r,b)},createURL:p,encodeLocation(b){let m=p(b);return{pathname:m.pathname,search:m.search,hash:m.hash}},push:d,replace:f,go(b){return a.go(b)}};return g}var L1;(function(i){i.data="data",i.deferred="deferred",i.redirect="redirect",i.error="error"})(L1||(L1={}));function jC(i,e){if(e==="/")return i;if(!i.toLowerCase().startsWith(e.toLowerCase()))return null;let t=e.endsWith("/")?e.length-1:e.length,s=i.charAt(t);return s&&s!=="/"?null:i.slice(t)||"/"}const $k=["post","put","patch","delete"];new Set($k);const UC=["get",...$k];new Set(UC);/**
 * React Router v6.26.2
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function hg(){return hg=Object.assign?Object.assign.bind():function(i){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(i[s]=t[s])}return i},hg.apply(this,arguments)}const $C=P.createContext(null),Yk=P.createContext(null);function YC(){return P.useContext(Yk)!=null}function XC(i){let{basename:e="/",children:t=null,location:s,navigationType:r=ua.Pop,navigator:n,static:a=!1,future:o}=i;YC()&&jk(!1);let l=e.replace(/^\/*/,"/"),u=P.useMemo(()=>({basename:l,navigator:n,static:a,future:hg({v7_relativeSplatPath:!1},o)}),[l,o,n,a]);typeof s=="string"&&(s=a0(s));let{pathname:h="/",search:c="",hash:d="",state:f=null,key:p="default"}=s,g=P.useMemo(()=>{let b=jC(h,l);return b==null?null:{location:{pathname:b,search:c,hash:d,state:f,key:p},navigationType:r}},[l,h,c,d,f,p,r]);return g==null?null:P.createElement($C.Provider,{value:u},P.createElement(Yk.Provider,{children:t,value:g}))}new Promise(()=>{});/**
 * React Router DOM v6.26.2
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */const QC="6";try{window.__reactRouterVersion=QC}catch{}const JC="startTransition",D1=Al[JC];function qC(i){let{basename:e,children:t,future:s,window:r}=i,n=P.useRef();n.current==null&&(n.current=HC({window:r,v5Compat:!0}));let a=n.current,[o,l]=P.useState({action:a.action,location:a.location}),{v7_startTransition:u}=s||{},h=P.useCallback(c=>{u&&D1?D1(()=>l(c)):l(c)},[l,u]);return P.useLayoutEffect(()=>a.listen(h),[a,h]),P.createElement(XC,{basename:e,children:t,location:o.location,navigationType:o.action,navigator:a,future:s})}var A1;(function(i){i.UseScrollRestoration="useScrollRestoration",i.UseSubmit="useSubmit",i.UseSubmitFetcher="useSubmitFetcher",i.UseFetcher="useFetcher",i.useViewTransitionState="useViewTransitionState"})(A1||(A1={}));var I1;(function(i){i.UseFetcher="useFetcher",i.UseFetchers="useFetchers",i.UseScrollRestoration="useScrollRestoration"})(I1||(I1={}));var KC={area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0};const ZC=im(KC);var eP=/\s([^'"/\s><]+?)[\s/>]|([^\s=]+)=\s?(".*?"|'.*?')/g;function R1(i){var e={type:"tag",name:"",voidElement:!1,attrs:{},children:[]},t=i.match(/<\/?([^\s]+?)[/\s>]/);if(t&&(e.name=t[1],(ZC[t[1]]||i.charAt(i.length-2)==="/")&&(e.voidElement=!0),e.name.startsWith("!--"))){var s=i.indexOf("-->");return{type:"comment",comment:s!==-1?i.slice(4,s):""}}for(var r=new RegExp(eP),n=null;(n=r.exec(i))!==null;)if(n[0].trim())if(n[1]){var a=n[1].trim(),o=[a,""];a.indexOf("=")>-1&&(o=a.split("=")),e.attrs[o[0]]=o[1],r.lastIndex--}else n[2]&&(e.attrs[n[2]]=n[3].trim().substring(1,n[3].length-1));return e}var tP=/<[a-zA-Z0-9\-\!\/](?:"[^"]*"|'[^']*'|[^'">])*>/g,iP=/^\s*$/,sP=Object.create(null);function Xk(i,e){switch(e.type){case"text":return i+e.content;case"tag":return i+="<"+e.name+(e.attrs?function(t){var s=[];for(var r in t)s.push(r+'="'+t[r]+'"');return s.length?" "+s.join(" "):""}(e.attrs):"")+(e.voidElement?"/>":">"),e.voidElement?i:i+e.children.reduce(Xk,"")+"</"+e.name+">";case"comment":return i+"<!--"+e.comment+"-->"}}var rP={parse:function(i,e){e||(e={}),e.components||(e.components=sP);var t,s=[],r=[],n=-1,a=!1;if(i.indexOf("<")!==0){var o=i.indexOf("<");s.push({type:"text",content:o===-1?i:i.substring(0,o)})}return i.replace(tP,function(l,u){if(a){if(l!=="</"+t.name+">")return;a=!1}var h,c=l.charAt(1)!=="/",d=l.startsWith("<!--"),f=u+l.length,p=i.charAt(f);if(d){var g=R1(l);return n<0?(s.push(g),s):((h=r[n]).children.push(g),s)}if(c&&(n++,(t=R1(l)).type==="tag"&&e.components[t.name]&&(t.type="component",a=!0),t.voidElement||a||!p||p==="<"||t.children.push({type:"text",content:i.slice(f,i.indexOf("<",f))}),n===0&&s.push(t),(h=r[n-1])&&h.children.push(t),r[n]=t),(!c||t.voidElement)&&(n>-1&&(t.voidElement||t.name===l.slice(2,-1))&&(n--,t=n===-1?s:r[n]),!a&&p!=="<"&&p)){h=n===-1?s:r[n].children;var b=i.indexOf("<",f),m=i.slice(f,b===-1?void 0:b);iP.test(m)&&(m=" "),(b>-1&&n+h.length>=0||m!==" ")&&h.push({type:"text",content:m})}}),s},stringify:function(i){return i.reduce(function(e,t){return e+Xk("",t)},"")}};const zh=(...i)=>{console!=null&&console.warn&&(Xs(i[0])&&(i[0]=`react-i18next:: ${i[0]}`),console.warn(...i))},O1={},bc=(...i)=>{Xs(i[0])&&O1[i[0]]||(Xs(i[0])&&(O1[i[0]]=new Date),zh(...i))},Qk=(i,e)=>()=>{if(i.isInitialized)e();else{const t=()=>{setTimeout(()=>{i.off("initialized",t)},0),e()};i.on("initialized",t)}},F1=(i,e,t)=>{i.loadNamespaces(e,Qk(i,t))},V1=(i,e,t,s)=>{Xs(t)&&(t=[t]),t.forEach(r=>{i.options.ns.indexOf(r)<0&&i.options.ns.push(r)}),i.loadLanguages(e,Qk(i,s))},nP=(i,e,t={})=>!e.languages||!e.languages.length?(bc("i18n.languages were undefined or empty",e.languages),!0):e.hasLoadedNamespace(i,{lng:t.lng,precheck:(s,r)=>{var n;if(((n=t.bindI18n)==null?void 0:n.indexOf("languageChanging"))>-1&&s.services.backendConnector.backend&&s.isLanguageChangingTo&&!r(s.isLanguageChangingTo,i))return!1}}),Xs=i=>typeof i=="string",ho=i=>typeof i=="object"&&i!==null,aP=/&(?:amp|#38|lt|#60|gt|#62|apos|#39|quot|#34|nbsp|#160|copy|#169|reg|#174|hellip|#8230|#x2F|#47);/g,oP={"&amp;":"&","&#38;":"&","&lt;":"<","&#60;":"<","&gt;":">","&#62;":">","&apos;":"'","&#39;":"'","&quot;":'"',"&#34;":'"',"&nbsp;":" ","&#160;":" ","&copy;":"©","&#169;":"©","&reg;":"®","&#174;":"®","&hellip;":"…","&#8230;":"…","&#x2F;":"/","&#47;":"/"},lP=i=>oP[i],uP=i=>i.replace(aP,lP);let hP={bindI18n:"languageChanged",bindI18nStore:"",transEmptyNodeValue:"",transSupportBasicHtmlNodes:!0,transWrapTextNodes:"",transKeepBasicHtmlNodesFor:["br","strong","i","p"],useSuspense:!0,unescape:uP};const Jk=()=>hP;let cP;const o0=()=>cP,wf=(i,e)=>{var s;if(!i)return!1;const t=((s=i.props)==null?void 0:s.children)??i.children;return e?t.length>0:!!t},vf=i=>{var t,s;if(!i)return[];const e=((t=i.props)==null?void 0:t.children)??i.children;return(s=i.props)!=null&&s.i18nIsDynamicList?co(e):e},dP=i=>Array.isArray(i)&&i.every(P.isValidElement),co=i=>Array.isArray(i)?i:[i],fP=(i,e)=>{const t={...e};return t.props=Object.assign(i.props,e.props),t},qk=(i,e)=>{if(!i)return"";let t="";const s=co(i),r=e!=null&&e.transSupportBasicHtmlNodes?e.transKeepBasicHtmlNodesFor??[]:[];return s.forEach((n,a)=>{if(Xs(n))t+=`${n}`;else if(P.isValidElement(n)){const{props:o,type:l}=n,u=Object.keys(o).length,h=r.indexOf(l)>-1,c=o.children;if(!c&&h&&!u)t+=`<${l}/>`;else if(!c&&(!h||u)||o.i18nIsDynamicList)t+=`<${a}></${a}>`;else if(h&&u===1&&Xs(c))t+=`<${l}>${c}</${l}>`;else{const d=qk(c,e);t+=`<${a}>${d}</${a}>`}}else if(n===null)zh("Trans: the passed in value is invalid - seems you passed in a null child.");else if(ho(n)){const{format:o,...l}=n,u=Object.keys(l);if(u.length===1){const h=o?`${u[0]}, ${o}`:u[0];t+=`{{${h}}}`}else zh("react-i18next: the passed in object contained more than one variable - the object should look like {{ value, format }} where format is optional.",n)}else zh("Trans: the passed in value is invalid - seems you passed in a variable like {number} - please pass in variables for interpolation as full objects like {{number}}.",n)}),t},pP=(i,e,t,s,r,n)=>{if(e==="")return[];const a=s.transKeepBasicHtmlNodesFor||[],o=e&&new RegExp(a.map(b=>`<${b}`).join("|")).test(e);if(!i&&!o&&!n)return[e];const l={},u=b=>{co(b).forEach(y=>{Xs(y)||(wf(y)?u(vf(y)):ho(y)&&!P.isValidElement(y)&&Object.assign(l,y))})};u(i);const h=rP.parse(`<0>${e}</0>`),c={...l,...r},d=(b,m,y)=>{var k;const w=vf(b),x=p(w,m.children,y);return dP(w)&&x.length===0||(k=b.props)!=null&&k.i18nIsDynamicList?w:x},f=(b,m,y,w,x)=>{b.dummy?(b.children=m,y.push(P.cloneElement(b,{key:w},x?void 0:m))):y.push(...P.Children.map([b],k=>{const _={...k.props};return delete _.i18nIsDynamicList,P.createElement(k.type,{..._,key:w,ref:k.ref},x?null:m)}))},p=(b,m,y)=>{const w=co(b);return co(m).reduce((k,_,T)=>{var W,z;const C=((z=(W=_.children)==null?void 0:W[0])==null?void 0:z.content)&&t.services.interpolator.interpolate(_.children[0].content,c,t.language);if(_.type==="tag"){let te=w[parseInt(_.name,10)];y.length===1&&!te&&(te=y[0][_.name]),te||(te={});const E=Object.keys(_.attrs).length!==0?fP({props:_.attrs},te):te,U=P.isValidElement(E),re=U&&wf(_,!0)&&!_.voidElement,K=o&&ho(E)&&E.dummy&&!U,ae=ho(i)&&Object.hasOwnProperty.call(i,_.name);if(Xs(E)){const ie=t.services.interpolator.interpolate(E,c,t.language);k.push(ie)}else if(wf(E)||re){const ie=d(E,_,y);f(E,ie,k,T)}else if(K){const ie=p(w,_.children,y);f(E,ie,k,T)}else if(Number.isNaN(parseFloat(_.name)))if(ae){const ie=d(E,_,y);f(E,ie,k,T,_.voidElement)}else if(s.transSupportBasicHtmlNodes&&a.indexOf(_.name)>-1)if(_.voidElement)k.push(P.createElement(_.name,{key:`${_.name}-${T}`}));else{const ie=p(w,_.children,y);k.push(P.createElement(_.name,{key:`${_.name}-${T}`},ie))}else if(_.voidElement)k.push(`<${_.name} />`);else{const ie=p(w,_.children,y);k.push(`<${_.name}>${ie}</${_.name}>`)}else if(ho(E)&&!U){const ie=_.children[0]?C:null;ie&&k.push(ie)}else f(E,C,k,T,_.children.length!==1||!C)}else if(_.type==="text"){const te=s.transWrapTextNodes,E=n?s.unescape(t.services.interpolator.interpolate(_.content,c,t.language)):t.services.interpolator.interpolate(_.content,c,t.language);te?k.push(P.createElement(te,{key:`${_.name}-${T}`},E)):k.push(E)}return k},[])},g=p([{dummy:!0,children:i||[]}],h,co(i||[]));return vf(g[0])};function gP({children:i,count:e,parent:t,i18nKey:s,context:r,tOptions:n={},values:a,defaults:o,components:l,ns:u,i18n:h,t:c,shouldUnescape:d,...f}){var te,E,U,re;const p=h||o0();if(!p)return bc("You will need to pass in an i18next instance by using i18nextReactModule"),i;const g=c||p.t.bind(p)||(K=>K),b={...Jk(),...(te=p.options)==null?void 0:te.react};let m=u||g.ns||((E=p.options)==null?void 0:E.defaultNS);m=Xs(m)?[m]:m||["translation"];const y=qk(i,b),w=o||y||b.transEmptyNodeValue||s,{hashTransKey:x}=b,k=s||(x?x(y||w):y||w);(re=(U=p.options)==null?void 0:U.interpolation)!=null&&re.defaultVariables&&(a=a&&Object.keys(a).length>0?{...a,...p.options.interpolation.defaultVariables}:{...p.options.interpolation.defaultVariables});const _=a||e!==void 0||!i?n.interpolation:{interpolation:{...n.interpolation,prefix:"#$?",suffix:"?$#"}},T={...n,context:r||n.context,count:e,...a,..._,defaultValue:w,ns:m},C=k?g(k,T):w;l&&Object.keys(l).forEach(K=>{const ae=l[K];if(typeof ae.type=="function"||!ae.props||!ae.props.children||C.indexOf(`${K}/>`)<0&&C.indexOf(`${K} />`)<0)return;function ie(){return P.createElement(P.Fragment,null,ae)}l[K]=P.createElement(ie)});const W=pP(l||i,C,p,b,T,d),z=t??b.defaultTransParent;return z?P.createElement(z,f,W):W}const l0=P.createContext();class mP{constructor(){this.usedNamespaces={}}addUsedNamespaces(e){e.forEach(t=>{var s;(s=this.usedNamespaces)[t]??(s[t]=!0)})}getUsedNamespaces(){return Object.keys(this.usedNamespaces)}}function u0({children:i,count:e,parent:t,i18nKey:s,context:r,tOptions:n={},values:a,defaults:o,components:l,ns:u,i18n:h,t:c,shouldUnescape:d,...f}){var y;const{i18n:p,defaultNS:g}=P.useContext(l0)||{},b=h||p||o0(),m=c||(b==null?void 0:b.t.bind(b));return gP({children:i,count:e,parent:t,i18nKey:s,context:r,tOptions:n,values:a,defaults:o,components:l,ns:u||(m==null?void 0:m.ns)||g||((y=b==null?void 0:b.options)==null?void 0:y.defaultNS),i18n:b,t:c,shouldUnescape:d,...f})}const yP=(i,e)=>{const t=P.useRef();return P.useEffect(()=>{t.current=i},[i,e]),t.current},Kk=(i,e,t,s)=>i.getFixedT(e,t,s),bP=(i,e,t,s)=>P.useCallback(Kk(i,e,t,s),[i,e,t,s]),Yt=(i,e={})=>{var x,k,_,T;const{i18n:t}=e,{i18n:s,defaultNS:r}=P.useContext(l0)||{},n=t||s||o0();if(n&&!n.reportNamespaces&&(n.reportNamespaces=new mP),!n){bc("You will need to pass in an i18next instance by using initReactI18next");const C=(z,te)=>Xs(te)?te:ho(te)&&Xs(te.defaultValue)?te.defaultValue:Array.isArray(z)?z[z.length-1]:z,W=[C,{},!1];return W.t=C,W.i18n={},W.ready=!1,W}(x=n.options.react)!=null&&x.wait&&bc("It seems you are still using the old wait option, you may migrate to the new useSuspense behaviour.");const a={...Jk(),...n.options.react,...e},{useSuspense:o,keyPrefix:l}=a;let u=i||r||((k=n.options)==null?void 0:k.defaultNS);u=Xs(u)?[u]:u||["translation"],(T=(_=n.reportNamespaces).addUsedNamespaces)==null||T.call(_,u);const h=(n.isInitialized||n.initializedStoreOnce)&&u.every(C=>nP(C,n,a)),c=bP(n,e.lng||null,a.nsMode==="fallback"?u:u[0],l),d=()=>c,f=()=>Kk(n,e.lng||null,a.nsMode==="fallback"?u:u[0],l),[p,g]=P.useState(d);let b=u.join();e.lng&&(b=`${e.lng}${b}`);const m=yP(b),y=P.useRef(!0);P.useEffect(()=>{const{bindI18n:C,bindI18nStore:W}=a;y.current=!0,!h&&!o&&(e.lng?V1(n,e.lng,u,()=>{y.current&&g(f)}):F1(n,u,()=>{y.current&&g(f)})),h&&m&&m!==b&&y.current&&g(f);const z=()=>{y.current&&g(f)};return C&&(n==null||n.on(C,z)),W&&(n==null||n.store.on(W,z)),()=>{y.current=!1,n&&(C==null||C.split(" ").forEach(te=>n.off(te,z))),W&&n&&W.split(" ").forEach(te=>n.store.off(te,z))}},[n,b]),P.useEffect(()=>{y.current&&h&&g(d)},[n,l,h]);const w=[p,n,h];if(w.t=p,w.i18n=n,w.ready=h,h||!h&&!o)return w;throw new Promise(C=>{e.lng?V1(n,e.lng,u,()=>C()):F1(n,u,()=>C())})},kf=({ns:i,children:e,...t})=>{const[s,r,n]=Yt(i,t);return e(s,{i18n:r,lng:r.language},n)};function SP({i18n:i,defaultNS:e,children:t}){const s=P.useMemo(()=>({i18n:i,defaultNS:e}),[i,e]);return P.createElement(l0.Provider,{value:s},t)}const wP={type:"logger",log(i){this.output("log",i)},warn(i){this.output("warn",i)},error(i){this.output("error",i)},output(i,e){console&&console[i]&&console[i].apply(console,e)}};let vP=class cg{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.init(e,t)}init(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.prefix=t.prefix||"i18next:",this.logger=e||wP,this.options=t,this.debug=t.debug}log(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];return this.forward(t,"log","",!0)}warn(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];return this.forward(t,"warn","",!0)}error(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];return this.forward(t,"error","")}deprecate(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];return this.forward(t,"warn","WARNING DEPRECATED: ",!0)}forward(e,t,s,r){return r&&!this.debug?null:(typeof e[0]=="string"&&(e[0]=`${s}${this.prefix} ${e[0]}`),this.logger[t](e))}create(e){return new cg(this.logger,{prefix:`${this.prefix}:${e}:`,...this.options})}clone(e){return e=e||this.options,e.prefix=e.prefix||this.prefix,new cg(this.logger,e)}};var Ar=new vP;let Bd=class{constructor(){this.observers={}}on(e,t){return e.split(" ").forEach(s=>{this.observers[s]||(this.observers[s]=new Map);const r=this.observers[s].get(t)||0;this.observers[s].set(t,r+1)}),this}off(e,t){if(this.observers[e]){if(!t){delete this.observers[e];return}this.observers[e].delete(t)}}emit(e){for(var t=arguments.length,s=new Array(t>1?t-1:0),r=1;r<t;r++)s[r-1]=arguments[r];this.observers[e]&&Array.from(this.observers[e].entries()).forEach(a=>{let[o,l]=a;for(let u=0;u<l;u++)o(...s)}),this.observers["*"]&&Array.from(this.observers["*"].entries()).forEach(a=>{let[o,l]=a;for(let u=0;u<l;u++)o.apply(o,[e,...s])})}};const ol=()=>{let i,e;const t=new Promise((s,r)=>{i=s,e=r});return t.resolve=i,t.reject=e,t},H1=i=>i==null?"":""+i,kP=(i,e,t)=>{i.forEach(s=>{e[s]&&(t[s]=e[s])})},xP=/###/g,z1=i=>i&&i.indexOf("###")>-1?i.replace(xP,"."):i,W1=i=>!i||typeof i=="string",Cl=(i,e,t)=>{const s=typeof e!="string"?e:e.split(".");let r=0;for(;r<s.length-1;){if(W1(i))return{};const n=z1(s[r]);!i[n]&&t&&(i[n]=new t),Object.prototype.hasOwnProperty.call(i,n)?i=i[n]:i={},++r}return W1(i)?{}:{obj:i,k:z1(s[r])}},G1=(i,e,t)=>{const{obj:s,k:r}=Cl(i,e,Object);if(s!==void 0||e.length===1){s[r]=t;return}let n=e[e.length-1],a=e.slice(0,e.length-1),o=Cl(i,a,Object);for(;o.obj===void 0&&a.length;)n=`${a[a.length-1]}.${n}`,a=a.slice(0,a.length-1),o=Cl(i,a,Object),o&&o.obj&&typeof o.obj[`${o.k}.${n}`]<"u"&&(o.obj=void 0);o.obj[`${o.k}.${n}`]=t},_P=(i,e,t,s)=>{const{obj:r,k:n}=Cl(i,e,Object);r[n]=r[n]||[],r[n].push(t)},Sc=(i,e)=>{const{obj:t,k:s}=Cl(i,e);if(t)return t[s]},TP=(i,e,t)=>{const s=Sc(i,t);return s!==void 0?s:Sc(e,t)},Zk=(i,e,t)=>{for(const s in e)s!=="__proto__"&&s!=="constructor"&&(s in i?typeof i[s]=="string"||i[s]instanceof String||typeof e[s]=="string"||e[s]instanceof String?t&&(i[s]=e[s]):Zk(i[s],e[s],t):i[s]=e[s]);return i},$a=i=>i.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&");var NP={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};const BP=i=>typeof i=="string"?i.replace(/[&<>"'\/]/g,e=>NP[e]):i;class CP{constructor(e){this.capacity=e,this.regExpMap=new Map,this.regExpQueue=[]}getRegExp(e){const t=this.regExpMap.get(e);if(t!==void 0)return t;const s=new RegExp(e);return this.regExpQueue.length===this.capacity&&this.regExpMap.delete(this.regExpQueue.shift()),this.regExpMap.set(e,s),this.regExpQueue.push(e),s}}const PP=[" ",",","?","!",";"],MP=new CP(20),EP=(i,e,t)=>{e=e||"",t=t||"";const s=PP.filter(a=>e.indexOf(a)<0&&t.indexOf(a)<0);if(s.length===0)return!0;const r=MP.getRegExp(`(${s.map(a=>a==="?"?"\\?":a).join("|")})`);let n=!r.test(i);if(!n){const a=i.indexOf(t);a>0&&!r.test(i.substring(0,a))&&(n=!0)}return n},dg=function(i,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:".";if(!i)return;if(i[e])return i[e];const s=e.split(t);let r=i;for(let n=0;n<s.length;){if(!r||typeof r!="object")return;let a,o="";for(let l=n;l<s.length;++l)if(l!==n&&(o+=t),o+=s[l],a=r[o],a!==void 0){if(["string","number","boolean"].indexOf(typeof a)>-1&&l<s.length-1)continue;n+=l-n+1;break}r=a}return r},wc=i=>i&&i.indexOf("_")>0?i.replace("_","-"):i;class j1 extends Bd{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{ns:["translation"],defaultNS:"translation"};super(),this.data=e||{},this.options=t,this.options.keySeparator===void 0&&(this.options.keySeparator="."),this.options.ignoreJSONStructure===void 0&&(this.options.ignoreJSONStructure=!0)}addNamespaces(e){this.options.ns.indexOf(e)<0&&this.options.ns.push(e)}removeNamespaces(e){const t=this.options.ns.indexOf(e);t>-1&&this.options.ns.splice(t,1)}getResource(e,t,s){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};const n=r.keySeparator!==void 0?r.keySeparator:this.options.keySeparator,a=r.ignoreJSONStructure!==void 0?r.ignoreJSONStructure:this.options.ignoreJSONStructure;let o;e.indexOf(".")>-1?o=e.split("."):(o=[e,t],s&&(Array.isArray(s)?o.push(...s):typeof s=="string"&&n?o.push(...s.split(n)):o.push(s)));const l=Sc(this.data,o);return!l&&!t&&!s&&e.indexOf(".")>-1&&(e=o[0],t=o[1],s=o.slice(2).join(".")),l||!a||typeof s!="string"?l:dg(this.data&&this.data[e]&&this.data[e][t],s,n)}addResource(e,t,s,r){let n=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{silent:!1};const a=n.keySeparator!==void 0?n.keySeparator:this.options.keySeparator;let o=[e,t];s&&(o=o.concat(a?s.split(a):s)),e.indexOf(".")>-1&&(o=e.split("."),r=t,t=o[1]),this.addNamespaces(t),G1(this.data,o,r),n.silent||this.emit("added",e,t,s,r)}addResources(e,t,s){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{silent:!1};for(const n in s)(typeof s[n]=="string"||Array.isArray(s[n]))&&this.addResource(e,t,n,s[n],{silent:!0});r.silent||this.emit("added",e,t,s)}addResourceBundle(e,t,s,r,n){let a=arguments.length>5&&arguments[5]!==void 0?arguments[5]:{silent:!1,skipCopy:!1},o=[e,t];e.indexOf(".")>-1&&(o=e.split("."),r=s,s=t,t=o[1]),this.addNamespaces(t);let l=Sc(this.data,o)||{};a.skipCopy||(s=JSON.parse(JSON.stringify(s))),r?Zk(l,s,n):l={...l,...s},G1(this.data,o,l),a.silent||this.emit("added",e,t,s)}removeResourceBundle(e,t){this.hasResourceBundle(e,t)&&delete this.data[e][t],this.removeNamespaces(t),this.emit("removed",e,t)}hasResourceBundle(e,t){return this.getResource(e,t)!==void 0}getResourceBundle(e,t){return t||(t=this.options.defaultNS),this.options.compatibilityAPI==="v1"?{...this.getResource(e,t)}:this.getResource(e,t)}getDataByLanguage(e){return this.data[e]}hasLanguageSomeTranslations(e){const t=this.getDataByLanguage(e);return!!(t&&Object.keys(t)||[]).find(r=>t[r]&&Object.keys(t[r]).length>0)}toJSON(){return this.data}}var ex={processors:{},addPostProcessor(i){this.processors[i.name]=i},handle(i,e,t,s,r){return i.forEach(n=>{this.processors[n]&&(e=this.processors[n].process(e,t,s,r))}),e}};const U1={};class vc extends Bd{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),kP(["resourceStore","languageUtils","pluralResolver","interpolator","backendConnector","i18nFormat","utils"],e,this),this.options=t,this.options.keySeparator===void 0&&(this.options.keySeparator="."),this.logger=Ar.create("translator")}changeLanguage(e){e&&(this.language=e)}exists(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{interpolation:{}};if(e==null)return!1;const s=this.resolve(e,t);return s&&s.res!==void 0}extractFromKey(e,t){let s=t.nsSeparator!==void 0?t.nsSeparator:this.options.nsSeparator;s===void 0&&(s=":");const r=t.keySeparator!==void 0?t.keySeparator:this.options.keySeparator;let n=t.ns||this.options.defaultNS||[];const a=s&&e.indexOf(s)>-1,o=!this.options.userDefinedKeySeparator&&!t.keySeparator&&!this.options.userDefinedNsSeparator&&!t.nsSeparator&&!EP(e,s,r);if(a&&!o){const l=e.match(this.interpolator.nestingRegexp);if(l&&l.length>0)return{key:e,namespaces:n};const u=e.split(s);(s!==r||s===r&&this.options.ns.indexOf(u[0])>-1)&&(n=u.shift()),e=u.join(r)}return typeof n=="string"&&(n=[n]),{key:e,namespaces:n}}translate(e,t,s){if(typeof t!="object"&&this.options.overloadTranslationOptionHandler&&(t=this.options.overloadTranslationOptionHandler(arguments)),typeof t=="object"&&(t={...t}),t||(t={}),e==null)return"";Array.isArray(e)||(e=[String(e)]);const r=t.returnDetails!==void 0?t.returnDetails:this.options.returnDetails,n=t.keySeparator!==void 0?t.keySeparator:this.options.keySeparator,{key:a,namespaces:o}=this.extractFromKey(e[e.length-1],t),l=o[o.length-1],u=t.lng||this.language,h=t.appendNamespaceToCIMode||this.options.appendNamespaceToCIMode;if(u&&u.toLowerCase()==="cimode"){if(h){const x=t.nsSeparator||this.options.nsSeparator;return r?{res:`${l}${x}${a}`,usedKey:a,exactUsedKey:a,usedLng:u,usedNS:l,usedParams:this.getUsedParamsDetails(t)}:`${l}${x}${a}`}return r?{res:a,usedKey:a,exactUsedKey:a,usedLng:u,usedNS:l,usedParams:this.getUsedParamsDetails(t)}:a}const c=this.resolve(e,t);let d=c&&c.res;const f=c&&c.usedKey||a,p=c&&c.exactUsedKey||a,g=Object.prototype.toString.apply(d),b=["[object Number]","[object Function]","[object RegExp]"],m=t.joinArrays!==void 0?t.joinArrays:this.options.joinArrays,y=!this.i18nFormat||this.i18nFormat.handleAsObject;if(y&&d&&(typeof d!="string"&&typeof d!="boolean"&&typeof d!="number")&&b.indexOf(g)<0&&!(typeof m=="string"&&Array.isArray(d))){if(!t.returnObjects&&!this.options.returnObjects){this.options.returnedObjectHandler||this.logger.warn("accessing an object - but returnObjects options is not enabled!");const x=this.options.returnedObjectHandler?this.options.returnedObjectHandler(f,d,{...t,ns:o}):`key '${a} (${this.language})' returned an object instead of string.`;return r?(c.res=x,c.usedParams=this.getUsedParamsDetails(t),c):x}if(n){const x=Array.isArray(d),k=x?[]:{},_=x?p:f;for(const T in d)if(Object.prototype.hasOwnProperty.call(d,T)){const C=`${_}${n}${T}`;k[T]=this.translate(C,{...t,joinArrays:!1,ns:o}),k[T]===C&&(k[T]=d[T])}d=k}}else if(y&&typeof m=="string"&&Array.isArray(d))d=d.join(m),d&&(d=this.extendTranslation(d,e,t,s));else{let x=!1,k=!1;const _=t.count!==void 0&&typeof t.count!="string",T=vc.hasDefaultValue(t),C=_?this.pluralResolver.getSuffix(u,t.count,t):"",W=t.ordinal&&_?this.pluralResolver.getSuffix(u,t.count,{ordinal:!1}):"",z=_&&!t.ordinal&&t.count===0&&this.pluralResolver.shouldUseIntlApi(),te=z&&t[`defaultValue${this.options.pluralSeparator}zero`]||t[`defaultValue${C}`]||t[`defaultValue${W}`]||t.defaultValue;!this.isValidLookup(d)&&T&&(x=!0,d=te),this.isValidLookup(d)||(k=!0,d=a);const U=(t.missingKeyNoValueFallbackToKey||this.options.missingKeyNoValueFallbackToKey)&&k?void 0:d,re=T&&te!==d&&this.options.updateMissing;if(k||x||re){if(this.logger.log(re?"updateKey":"missingKey",u,l,a,re?te:d),n){const A=this.resolve(a,{...t,keySeparator:!1});A&&A.res&&this.logger.warn("Seems the loaded translations were in flat JSON format instead of nested. Either set keySeparator: false on init or make sure your translations are published in nested format.")}let K=[];const ae=this.languageUtils.getFallbackCodes(this.options.fallbackLng,t.lng||this.language);if(this.options.saveMissingTo==="fallback"&&ae&&ae[0])for(let A=0;A<ae.length;A++)K.push(ae[A]);else this.options.saveMissingTo==="all"?K=this.languageUtils.toResolveHierarchy(t.lng||this.language):K.push(t.lng||this.language);const ie=(A,Y,le)=>{const pe=T&&le!==d?le:U;this.options.missingKeyHandler?this.options.missingKeyHandler(A,l,Y,pe,re,t):this.backendConnector&&this.backendConnector.saveMissing&&this.backendConnector.saveMissing(A,l,Y,pe,re,t),this.emit("missingKey",A,l,Y,d)};this.options.saveMissing&&(this.options.saveMissingPlurals&&_?K.forEach(A=>{const Y=this.pluralResolver.getSuffixes(A,t);z&&t[`defaultValue${this.options.pluralSeparator}zero`]&&Y.indexOf(`${this.options.pluralSeparator}zero`)<0&&Y.push(`${this.options.pluralSeparator}zero`),Y.forEach(le=>{ie([A],a+le,t[`defaultValue${le}`]||te)})}):ie(K,a,te))}d=this.extendTranslation(d,e,t,c,s),k&&d===a&&this.options.appendNamespaceToMissingKey&&(d=`${l}:${a}`),(k||x)&&this.options.parseMissingKeyHandler&&(this.options.compatibilityAPI!=="v1"?d=this.options.parseMissingKeyHandler(this.options.appendNamespaceToMissingKey?`${l}:${a}`:a,x?d:void 0):d=this.options.parseMissingKeyHandler(d))}return r?(c.res=d,c.usedParams=this.getUsedParamsDetails(t),c):d}extendTranslation(e,t,s,r,n){var a=this;if(this.i18nFormat&&this.i18nFormat.parse)e=this.i18nFormat.parse(e,{...this.options.interpolation.defaultVariables,...s},s.lng||this.language||r.usedLng,r.usedNS,r.usedKey,{resolved:r});else if(!s.skipInterpolation){s.interpolation&&this.interpolator.init({...s,interpolation:{...this.options.interpolation,...s.interpolation}});const u=typeof e=="string"&&(s&&s.interpolation&&s.interpolation.skipOnVariables!==void 0?s.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables);let h;if(u){const d=e.match(this.interpolator.nestingRegexp);h=d&&d.length}let c=s.replace&&typeof s.replace!="string"?s.replace:s;if(this.options.interpolation.defaultVariables&&(c={...this.options.interpolation.defaultVariables,...c}),e=this.interpolator.interpolate(e,c,s.lng||this.language||r.usedLng,s),u){const d=e.match(this.interpolator.nestingRegexp),f=d&&d.length;h<f&&(s.nest=!1)}!s.lng&&this.options.compatibilityAPI!=="v1"&&r&&r.res&&(s.lng=this.language||r.usedLng),s.nest!==!1&&(e=this.interpolator.nest(e,function(){for(var d=arguments.length,f=new Array(d),p=0;p<d;p++)f[p]=arguments[p];return n&&n[0]===f[0]&&!s.context?(a.logger.warn(`It seems you are nesting recursively key: ${f[0]} in key: ${t[0]}`),null):a.translate(...f,t)},s)),s.interpolation&&this.interpolator.reset()}const o=s.postProcess||this.options.postProcess,l=typeof o=="string"?[o]:o;return e!=null&&l&&l.length&&s.applyPostProcessor!==!1&&(e=ex.handle(l,e,t,this.options&&this.options.postProcessPassResolved?{i18nResolved:{...r,usedParams:this.getUsedParamsDetails(s)},...s}:s,this)),e}resolve(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s,r,n,a,o;return typeof e=="string"&&(e=[e]),e.forEach(l=>{if(this.isValidLookup(s))return;const u=this.extractFromKey(l,t),h=u.key;r=h;let c=u.namespaces;this.options.fallbackNS&&(c=c.concat(this.options.fallbackNS));const d=t.count!==void 0&&typeof t.count!="string",f=d&&!t.ordinal&&t.count===0&&this.pluralResolver.shouldUseIntlApi(),p=t.context!==void 0&&(typeof t.context=="string"||typeof t.context=="number")&&t.context!=="",g=t.lngs?t.lngs:this.languageUtils.toResolveHierarchy(t.lng||this.language,t.fallbackLng);c.forEach(b=>{this.isValidLookup(s)||(o=b,!U1[`${g[0]}-${b}`]&&this.utils&&this.utils.hasLoadedNamespace&&!this.utils.hasLoadedNamespace(o)&&(U1[`${g[0]}-${b}`]=!0,this.logger.warn(`key "${r}" for languages "${g.join(", ")}" won't get resolved as namespace "${o}" was not yet loaded`,"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!")),g.forEach(m=>{if(this.isValidLookup(s))return;a=m;const y=[h];if(this.i18nFormat&&this.i18nFormat.addLookupKeys)this.i18nFormat.addLookupKeys(y,h,m,b,t);else{let x;d&&(x=this.pluralResolver.getSuffix(m,t.count,t));const k=`${this.options.pluralSeparator}zero`,_=`${this.options.pluralSeparator}ordinal${this.options.pluralSeparator}`;if(d&&(y.push(h+x),t.ordinal&&x.indexOf(_)===0&&y.push(h+x.replace(_,this.options.pluralSeparator)),f&&y.push(h+k)),p){const T=`${h}${this.options.contextSeparator}${t.context}`;y.push(T),d&&(y.push(T+x),t.ordinal&&x.indexOf(_)===0&&y.push(T+x.replace(_,this.options.pluralSeparator)),f&&y.push(T+k))}}let w;for(;w=y.pop();)this.isValidLookup(s)||(n=w,s=this.getResource(m,b,w,t))}))})}),{res:s,usedKey:r,exactUsedKey:n,usedLng:a,usedNS:o}}isValidLookup(e){return e!==void 0&&!(!this.options.returnNull&&e===null)&&!(!this.options.returnEmptyString&&e==="")}getResource(e,t,s){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return this.i18nFormat&&this.i18nFormat.getResource?this.i18nFormat.getResource(e,t,s,r):this.resourceStore.getResource(e,t,s,r)}getUsedParamsDetails(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=["defaultValue","ordinal","context","replace","lng","lngs","fallbackLng","ns","keySeparator","nsSeparator","returnObjects","returnDetails","joinArrays","postProcess","interpolation"],s=e.replace&&typeof e.replace!="string";let r=s?e.replace:e;if(s&&typeof e.count<"u"&&(r.count=e.count),this.options.interpolation.defaultVariables&&(r={...this.options.interpolation.defaultVariables,...r}),!s){r={...r};for(const n of t)delete r[n]}return r}static hasDefaultValue(e){const t="defaultValue";for(const s in e)if(Object.prototype.hasOwnProperty.call(e,s)&&t===s.substring(0,t.length)&&e[s]!==void 0)return!0;return!1}}const xf=i=>i.charAt(0).toUpperCase()+i.slice(1);class $1{constructor(e){this.options=e,this.supportedLngs=this.options.supportedLngs||!1,this.logger=Ar.create("languageUtils")}getScriptPartFromCode(e){if(e=wc(e),!e||e.indexOf("-")<0)return null;const t=e.split("-");return t.length===2||(t.pop(),t[t.length-1].toLowerCase()==="x")?null:this.formatLanguageCode(t.join("-"))}getLanguagePartFromCode(e){if(e=wc(e),!e||e.indexOf("-")<0)return e;const t=e.split("-");return this.formatLanguageCode(t[0])}formatLanguageCode(e){if(typeof e=="string"&&e.indexOf("-")>-1){const t=["hans","hant","latn","cyrl","cans","mong","arab"];let s=e.split("-");return this.options.lowerCaseLng?s=s.map(r=>r.toLowerCase()):s.length===2?(s[0]=s[0].toLowerCase(),s[1]=s[1].toUpperCase(),t.indexOf(s[1].toLowerCase())>-1&&(s[1]=xf(s[1].toLowerCase()))):s.length===3&&(s[0]=s[0].toLowerCase(),s[1].length===2&&(s[1]=s[1].toUpperCase()),s[0]!=="sgn"&&s[2].length===2&&(s[2]=s[2].toUpperCase()),t.indexOf(s[1].toLowerCase())>-1&&(s[1]=xf(s[1].toLowerCase())),t.indexOf(s[2].toLowerCase())>-1&&(s[2]=xf(s[2].toLowerCase()))),s.join("-")}return this.options.cleanCode||this.options.lowerCaseLng?e.toLowerCase():e}isSupportedCode(e){return(this.options.load==="languageOnly"||this.options.nonExplicitSupportedLngs)&&(e=this.getLanguagePartFromCode(e)),!this.supportedLngs||!this.supportedLngs.length||this.supportedLngs.indexOf(e)>-1}getBestMatchFromCodes(e){if(!e)return null;let t;return e.forEach(s=>{if(t)return;const r=this.formatLanguageCode(s);(!this.options.supportedLngs||this.isSupportedCode(r))&&(t=r)}),!t&&this.options.supportedLngs&&e.forEach(s=>{if(t)return;const r=this.getLanguagePartFromCode(s);if(this.isSupportedCode(r))return t=r;t=this.options.supportedLngs.find(n=>{if(n===r)return n;if(!(n.indexOf("-")<0&&r.indexOf("-")<0)&&(n.indexOf("-")>0&&r.indexOf("-")<0&&n.substring(0,n.indexOf("-"))===r||n.indexOf(r)===0&&r.length>1))return n})}),t||(t=this.getFallbackCodes(this.options.fallbackLng)[0]),t}getFallbackCodes(e,t){if(!e)return[];if(typeof e=="function"&&(e=e(t)),typeof e=="string"&&(e=[e]),Array.isArray(e))return e;if(!t)return e.default||[];let s=e[t];return s||(s=e[this.getScriptPartFromCode(t)]),s||(s=e[this.formatLanguageCode(t)]),s||(s=e[this.getLanguagePartFromCode(t)]),s||(s=e.default),s||[]}toResolveHierarchy(e,t){const s=this.getFallbackCodes(t||this.options.fallbackLng||[],e),r=[],n=a=>{a&&(this.isSupportedCode(a)?r.push(a):this.logger.warn(`rejecting language code not found in supportedLngs: ${a}`))};return typeof e=="string"&&(e.indexOf("-")>-1||e.indexOf("_")>-1)?(this.options.load!=="languageOnly"&&n(this.formatLanguageCode(e)),this.options.load!=="languageOnly"&&this.options.load!=="currentOnly"&&n(this.getScriptPartFromCode(e)),this.options.load!=="currentOnly"&&n(this.getLanguagePartFromCode(e))):typeof e=="string"&&n(this.formatLanguageCode(e)),s.forEach(a=>{r.indexOf(a)<0&&n(this.formatLanguageCode(a))}),r}}let LP=[{lngs:["ach","ak","am","arn","br","fil","gun","ln","mfe","mg","mi","oc","pt","pt-BR","tg","tl","ti","tr","uz","wa"],nr:[1,2],fc:1},{lngs:["af","an","ast","az","bg","bn","ca","da","de","dev","el","en","eo","es","et","eu","fi","fo","fur","fy","gl","gu","ha","hi","hu","hy","ia","it","kk","kn","ku","lb","mai","ml","mn","mr","nah","nap","nb","ne","nl","nn","no","nso","pa","pap","pms","ps","pt-PT","rm","sco","se","si","so","son","sq","sv","sw","ta","te","tk","ur","yo"],nr:[1,2],fc:2},{lngs:["ay","bo","cgg","fa","ht","id","ja","jbo","ka","km","ko","ky","lo","ms","sah","su","th","tt","ug","vi","wo","zh"],nr:[1],fc:3},{lngs:["be","bs","cnr","dz","hr","ru","sr","uk"],nr:[1,2,5],fc:4},{lngs:["ar"],nr:[0,1,2,3,11,100],fc:5},{lngs:["cs","sk"],nr:[1,2,5],fc:6},{lngs:["csb","pl"],nr:[1,2,5],fc:7},{lngs:["cy"],nr:[1,2,3,8],fc:8},{lngs:["fr"],nr:[1,2],fc:9},{lngs:["ga"],nr:[1,2,3,7,11],fc:10},{lngs:["gd"],nr:[1,2,3,20],fc:11},{lngs:["is"],nr:[1,2],fc:12},{lngs:["jv"],nr:[0,1],fc:13},{lngs:["kw"],nr:[1,2,3,4],fc:14},{lngs:["lt"],nr:[1,2,10],fc:15},{lngs:["lv"],nr:[1,2,0],fc:16},{lngs:["mk"],nr:[1,2],fc:17},{lngs:["mnk"],nr:[0,1,2],fc:18},{lngs:["mt"],nr:[1,2,11,20],fc:19},{lngs:["or"],nr:[2,1],fc:2},{lngs:["ro"],nr:[1,2,20],fc:20},{lngs:["sl"],nr:[5,1,2,3],fc:21},{lngs:["he","iw"],nr:[1,2,20,21],fc:22}],DP={1:i=>+(i>1),2:i=>+(i!=1),3:i=>0,4:i=>i%10==1&&i%100!=11?0:i%10>=2&&i%10<=4&&(i%100<10||i%100>=20)?1:2,5:i=>i==0?0:i==1?1:i==2?2:i%100>=3&&i%100<=10?3:i%100>=11?4:5,6:i=>i==1?0:i>=2&&i<=4?1:2,7:i=>i==1?0:i%10>=2&&i%10<=4&&(i%100<10||i%100>=20)?1:2,8:i=>i==1?0:i==2?1:i!=8&&i!=11?2:3,9:i=>+(i>=2),10:i=>i==1?0:i==2?1:i<7?2:i<11?3:4,11:i=>i==1||i==11?0:i==2||i==12?1:i>2&&i<20?2:3,12:i=>+(i%10!=1||i%100==11),13:i=>+(i!==0),14:i=>i==1?0:i==2?1:i==3?2:3,15:i=>i%10==1&&i%100!=11?0:i%10>=2&&(i%100<10||i%100>=20)?1:2,16:i=>i%10==1&&i%100!=11?0:i!==0?1:2,17:i=>i==1||i%10==1&&i%100!=11?0:1,18:i=>i==0?0:i==1?1:2,19:i=>i==1?0:i==0||i%100>1&&i%100<11?1:i%100>10&&i%100<20?2:3,20:i=>i==1?0:i==0||i%100>0&&i%100<20?1:2,21:i=>i%100==1?1:i%100==2?2:i%100==3||i%100==4?3:0,22:i=>i==1?0:i==2?1:(i<0||i>10)&&i%10==0?2:3};const AP=["v1","v2","v3"],IP=["v4"],Y1={zero:0,one:1,two:2,few:3,many:4,other:5},RP=()=>{const i={};return LP.forEach(e=>{e.lngs.forEach(t=>{i[t]={numbers:e.nr,plurals:DP[e.fc]}})}),i};class OP{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.languageUtils=e,this.options=t,this.logger=Ar.create("pluralResolver"),(!this.options.compatibilityJSON||IP.includes(this.options.compatibilityJSON))&&(typeof Intl>"u"||!Intl.PluralRules)&&(this.options.compatibilityJSON="v3",this.logger.error("Your environment seems not to be Intl API compatible, use an Intl.PluralRules polyfill. Will fallback to the compatibilityJSON v3 format handling.")),this.rules=RP()}addRule(e,t){this.rules[e]=t}getRule(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(this.shouldUseIntlApi())try{return new Intl.PluralRules(wc(e==="dev"?"en":e),{type:t.ordinal?"ordinal":"cardinal"})}catch{return}return this.rules[e]||this.rules[this.languageUtils.getLanguagePartFromCode(e)]}needsPlural(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const s=this.getRule(e,t);return this.shouldUseIntlApi()?s&&s.resolvedOptions().pluralCategories.length>1:s&&s.numbers.length>1}getPluralFormsOfKey(e,t){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this.getSuffixes(e,s).map(r=>`${t}${r}`)}getSuffixes(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const s=this.getRule(e,t);return s?this.shouldUseIntlApi()?s.resolvedOptions().pluralCategories.sort((r,n)=>Y1[r]-Y1[n]).map(r=>`${this.options.prepend}${t.ordinal?`ordinal${this.options.prepend}`:""}${r}`):s.numbers.map(r=>this.getSuffix(e,r,t)):[]}getSuffix(e,t){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const r=this.getRule(e,s);return r?this.shouldUseIntlApi()?`${this.options.prepend}${s.ordinal?`ordinal${this.options.prepend}`:""}${r.select(t)}`:this.getSuffixRetroCompatible(r,t):(this.logger.warn(`no plural rule found for: ${e}`),"")}getSuffixRetroCompatible(e,t){const s=e.noAbs?e.plurals(t):e.plurals(Math.abs(t));let r=e.numbers[s];this.options.simplifyPluralSuffix&&e.numbers.length===2&&e.numbers[0]===1&&(r===2?r="plural":r===1&&(r=""));const n=()=>this.options.prepend&&r.toString()?this.options.prepend+r.toString():r.toString();return this.options.compatibilityJSON==="v1"?r===1?"":typeof r=="number"?`_plural_${r.toString()}`:n():this.options.compatibilityJSON==="v2"||this.options.simplifyPluralSuffix&&e.numbers.length===2&&e.numbers[0]===1?n():this.options.prepend&&s.toString()?this.options.prepend+s.toString():s.toString()}shouldUseIntlApi(){return!AP.includes(this.options.compatibilityJSON)}}const X1=function(i,e,t){let s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:".",r=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!0,n=TP(i,e,t);return!n&&r&&typeof t=="string"&&(n=dg(i,t,s),n===void 0&&(n=dg(e,t,s))),n},_f=i=>i.replace(/\$/g,"$$$$");class FP{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.logger=Ar.create("interpolator"),this.options=e,this.format=e.interpolation&&e.interpolation.format||(t=>t),this.init(e)}init(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};e.interpolation||(e.interpolation={escapeValue:!0});const{escape:t,escapeValue:s,useRawValueToEscape:r,prefix:n,prefixEscaped:a,suffix:o,suffixEscaped:l,formatSeparator:u,unescapeSuffix:h,unescapePrefix:c,nestingPrefix:d,nestingPrefixEscaped:f,nestingSuffix:p,nestingSuffixEscaped:g,nestingOptionsSeparator:b,maxReplaces:m,alwaysFormat:y}=e.interpolation;this.escape=t!==void 0?t:BP,this.escapeValue=s!==void 0?s:!0,this.useRawValueToEscape=r!==void 0?r:!1,this.prefix=n?$a(n):a||"{{",this.suffix=o?$a(o):l||"}}",this.formatSeparator=u||",",this.unescapePrefix=h?"":c||"-",this.unescapeSuffix=this.unescapePrefix?"":h||"",this.nestingPrefix=d?$a(d):f||$a("$t("),this.nestingSuffix=p?$a(p):g||$a(")"),this.nestingOptionsSeparator=b||",",this.maxReplaces=m||1e3,this.alwaysFormat=y!==void 0?y:!1,this.resetRegExp()}reset(){this.options&&this.init(this.options)}resetRegExp(){const e=(t,s)=>t&&t.source===s?(t.lastIndex=0,t):new RegExp(s,"g");this.regexp=e(this.regexp,`${this.prefix}(.+?)${this.suffix}`),this.regexpUnescape=e(this.regexpUnescape,`${this.prefix}${this.unescapePrefix}(.+?)${this.unescapeSuffix}${this.suffix}`),this.nestingRegexp=e(this.nestingRegexp,`${this.nestingPrefix}(.+?)${this.nestingSuffix}`)}interpolate(e,t,s,r){let n,a,o;const l=this.options&&this.options.interpolation&&this.options.interpolation.defaultVariables||{},u=f=>{if(f.indexOf(this.formatSeparator)<0){const m=X1(t,l,f,this.options.keySeparator,this.options.ignoreJSONStructure);return this.alwaysFormat?this.format(m,void 0,s,{...r,...t,interpolationkey:f}):m}const p=f.split(this.formatSeparator),g=p.shift().trim(),b=p.join(this.formatSeparator).trim();return this.format(X1(t,l,g,this.options.keySeparator,this.options.ignoreJSONStructure),b,s,{...r,...t,interpolationkey:g})};this.resetRegExp();const h=r&&r.missingInterpolationHandler||this.options.missingInterpolationHandler,c=r&&r.interpolation&&r.interpolation.skipOnVariables!==void 0?r.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables;return[{regex:this.regexpUnescape,safeValue:f=>_f(f)},{regex:this.regexp,safeValue:f=>this.escapeValue?_f(this.escape(f)):_f(f)}].forEach(f=>{for(o=0;n=f.regex.exec(e);){const p=n[1].trim();if(a=u(p),a===void 0)if(typeof h=="function"){const b=h(e,n,r);a=typeof b=="string"?b:""}else if(r&&Object.prototype.hasOwnProperty.call(r,p))a="";else if(c){a=n[0];continue}else this.logger.warn(`missed to pass in variable ${p} for interpolating ${e}`),a="";else typeof a!="string"&&!this.useRawValueToEscape&&(a=H1(a));const g=f.safeValue(a);if(e=e.replace(n[0],g),c?(f.regex.lastIndex+=a.length,f.regex.lastIndex-=n[0].length):f.regex.lastIndex=0,o++,o>=this.maxReplaces)break}}),e}nest(e,t){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},r,n,a;const o=(l,u)=>{const h=this.nestingOptionsSeparator;if(l.indexOf(h)<0)return l;const c=l.split(new RegExp(`${h}[ ]*{`));let d=`{${c[1]}`;l=c[0],d=this.interpolate(d,a);const f=d.match(/'/g),p=d.match(/"/g);(f&&f.length%2===0&&!p||p.length%2!==0)&&(d=d.replace(/'/g,'"'));try{a=JSON.parse(d),u&&(a={...u,...a})}catch(g){return this.logger.warn(`failed parsing options string in nesting for key ${l}`,g),`${l}${h}${d}`}return a.defaultValue&&a.defaultValue.indexOf(this.prefix)>-1&&delete a.defaultValue,l};for(;r=this.nestingRegexp.exec(e);){let l=[];a={...s},a=a.replace&&typeof a.replace!="string"?a.replace:a,a.applyPostProcessor=!1,delete a.defaultValue;let u=!1;if(r[0].indexOf(this.formatSeparator)!==-1&&!/{.*}/.test(r[1])){const h=r[1].split(this.formatSeparator).map(c=>c.trim());r[1]=h.shift(),l=h,u=!0}if(n=t(o.call(this,r[1].trim(),a),a),n&&r[0]===e&&typeof n!="string")return n;typeof n!="string"&&(n=H1(n)),n||(this.logger.warn(`missed to resolve ${r[1]} for nesting ${e}`),n=""),u&&(n=l.reduce((h,c)=>this.format(h,c,s.lng,{...s,interpolationkey:r[1].trim()}),n.trim())),e=e.replace(r[0],n),this.regexp.lastIndex=0}return e}}const VP=i=>{let e=i.toLowerCase().trim();const t={};if(i.indexOf("(")>-1){const s=i.split("(");e=s[0].toLowerCase().trim();const r=s[1].substring(0,s[1].length-1);e==="currency"&&r.indexOf(":")<0?t.currency||(t.currency=r.trim()):e==="relativetime"&&r.indexOf(":")<0?t.range||(t.range=r.trim()):r.split(";").forEach(a=>{if(a){const[o,...l]=a.split(":"),u=l.join(":").trim().replace(/^'+|'+$/g,""),h=o.trim();t[h]||(t[h]=u),u==="false"&&(t[h]=!1),u==="true"&&(t[h]=!0),isNaN(u)||(t[h]=parseInt(u,10))}})}return{formatName:e,formatOptions:t}},Ya=i=>{const e={};return(t,s,r)=>{const n=s+JSON.stringify(r);let a=e[n];return a||(a=i(wc(s),r),e[n]=a),a(t)}};class HP{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.logger=Ar.create("formatter"),this.options=e,this.formats={number:Ya((t,s)=>{const r=new Intl.NumberFormat(t,{...s});return n=>r.format(n)}),currency:Ya((t,s)=>{const r=new Intl.NumberFormat(t,{...s,style:"currency"});return n=>r.format(n)}),datetime:Ya((t,s)=>{const r=new Intl.DateTimeFormat(t,{...s});return n=>r.format(n)}),relativetime:Ya((t,s)=>{const r=new Intl.RelativeTimeFormat(t,{...s});return n=>r.format(n,s.range||"day")}),list:Ya((t,s)=>{const r=new Intl.ListFormat(t,{...s});return n=>r.format(n)})},this.init(e)}init(e){const s=(arguments.length>1&&arguments[1]!==void 0?arguments[1]:{interpolation:{}}).interpolation;this.formatSeparator=s.formatSeparator?s.formatSeparator:s.formatSeparator||","}add(e,t){this.formats[e.toLowerCase().trim()]=t}addCached(e,t){this.formats[e.toLowerCase().trim()]=Ya(t)}format(e,t,s){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};const n=t.split(this.formatSeparator);if(n.length>1&&n[0].indexOf("(")>1&&n[0].indexOf(")")<0&&n.find(o=>o.indexOf(")")>-1)){const o=n.findIndex(l=>l.indexOf(")")>-1);n[0]=[n[0],...n.splice(1,o)].join(this.formatSeparator)}return n.reduce((o,l)=>{const{formatName:u,formatOptions:h}=VP(l);if(this.formats[u]){let c=o;try{const d=r&&r.formatParams&&r.formatParams[r.interpolationkey]||{},f=d.locale||d.lng||r.locale||r.lng||s;c=this.formats[u](o,f,{...h,...r,...d})}catch(d){this.logger.warn(d)}return c}else this.logger.warn(`there was no format function for ${u}`);return o},e)}}const zP=(i,e)=>{i.pending[e]!==void 0&&(delete i.pending[e],i.pendingCount--)};class WP extends Bd{constructor(e,t,s){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};super(),this.backend=e,this.store=t,this.services=s,this.languageUtils=s.languageUtils,this.options=r,this.logger=Ar.create("backendConnector"),this.waitingReads=[],this.maxParallelReads=r.maxParallelReads||10,this.readingCalls=0,this.maxRetries=r.maxRetries>=0?r.maxRetries:5,this.retryTimeout=r.retryTimeout>=1?r.retryTimeout:350,this.state={},this.queue=[],this.backend&&this.backend.init&&this.backend.init(s,r.backend,r)}queueLoad(e,t,s,r){const n={},a={},o={},l={};return e.forEach(u=>{let h=!0;t.forEach(c=>{const d=`${u}|${c}`;!s.reload&&this.store.hasResourceBundle(u,c)?this.state[d]=2:this.state[d]<0||(this.state[d]===1?a[d]===void 0&&(a[d]=!0):(this.state[d]=1,h=!1,a[d]===void 0&&(a[d]=!0),n[d]===void 0&&(n[d]=!0),l[c]===void 0&&(l[c]=!0)))}),h||(o[u]=!0)}),(Object.keys(n).length||Object.keys(a).length)&&this.queue.push({pending:a,pendingCount:Object.keys(a).length,loaded:{},errors:[],callback:r}),{toLoad:Object.keys(n),pending:Object.keys(a),toLoadLanguages:Object.keys(o),toLoadNamespaces:Object.keys(l)}}loaded(e,t,s){const r=e.split("|"),n=r[0],a=r[1];t&&this.emit("failedLoading",n,a,t),s&&this.store.addResourceBundle(n,a,s,void 0,void 0,{skipCopy:!0}),this.state[e]=t?-1:2;const o={};this.queue.forEach(l=>{_P(l.loaded,[n],a),zP(l,e),t&&l.errors.push(t),l.pendingCount===0&&!l.done&&(Object.keys(l.loaded).forEach(u=>{o[u]||(o[u]={});const h=l.loaded[u];h.length&&h.forEach(c=>{o[u][c]===void 0&&(o[u][c]=!0)})}),l.done=!0,l.errors.length?l.callback(l.errors):l.callback())}),this.emit("loaded",o),this.queue=this.queue.filter(l=>!l.done)}read(e,t,s){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0,n=arguments.length>4&&arguments[4]!==void 0?arguments[4]:this.retryTimeout,a=arguments.length>5?arguments[5]:void 0;if(!e.length)return a(null,{});if(this.readingCalls>=this.maxParallelReads){this.waitingReads.push({lng:e,ns:t,fcName:s,tried:r,wait:n,callback:a});return}this.readingCalls++;const o=(u,h)=>{if(this.readingCalls--,this.waitingReads.length>0){const c=this.waitingReads.shift();this.read(c.lng,c.ns,c.fcName,c.tried,c.wait,c.callback)}if(u&&h&&r<this.maxRetries){setTimeout(()=>{this.read.call(this,e,t,s,r+1,n*2,a)},n);return}a(u,h)},l=this.backend[s].bind(this.backend);if(l.length===2){try{const u=l(e,t);u&&typeof u.then=="function"?u.then(h=>o(null,h)).catch(o):o(null,u)}catch(u){o(u)}return}return l(e,t,o)}prepareLoading(e,t){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},r=arguments.length>3?arguments[3]:void 0;if(!this.backend)return this.logger.warn("No backend was added via i18next.use. Will not load resources."),r&&r();typeof e=="string"&&(e=this.languageUtils.toResolveHierarchy(e)),typeof t=="string"&&(t=[t]);const n=this.queueLoad(e,t,s,r);if(!n.toLoad.length)return n.pending.length||r(),null;n.toLoad.forEach(a=>{this.loadOne(a)})}load(e,t,s){this.prepareLoading(e,t,{},s)}reload(e,t,s){this.prepareLoading(e,t,{reload:!0},s)}loadOne(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";const s=e.split("|"),r=s[0],n=s[1];this.read(r,n,"read",void 0,void 0,(a,o)=>{a&&this.logger.warn(`${t}loading namespace ${n} for language ${r} failed`,a),!a&&o&&this.logger.log(`${t}loaded namespace ${n} for language ${r}`,o),this.loaded(e,a,o)})}saveMissing(e,t,s,r,n){let a=arguments.length>5&&arguments[5]!==void 0?arguments[5]:{},o=arguments.length>6&&arguments[6]!==void 0?arguments[6]:()=>{};if(this.services.utils&&this.services.utils.hasLoadedNamespace&&!this.services.utils.hasLoadedNamespace(t)){this.logger.warn(`did not save key "${s}" as the namespace "${t}" was not yet loaded`,"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!");return}if(!(s==null||s==="")){if(this.backend&&this.backend.create){const l={...a,isUpdate:n},u=this.backend.create.bind(this.backend);if(u.length<6)try{let h;u.length===5?h=u(e,t,s,r,l):h=u(e,t,s,r),h&&typeof h.then=="function"?h.then(c=>o(null,c)).catch(o):o(null,h)}catch(h){o(h)}else u(e,t,s,r,o,l)}!e||!e[0]||this.store.addResource(e[0],t,s,r)}}}const Q1=()=>({debug:!1,initImmediate:!0,ns:["translation"],defaultNS:["translation"],fallbackLng:["dev"],fallbackNS:!1,supportedLngs:!1,nonExplicitSupportedLngs:!1,load:"all",preload:!1,simplifyPluralSuffix:!0,keySeparator:".",nsSeparator:":",pluralSeparator:"_",contextSeparator:"_",partialBundledLanguages:!1,saveMissing:!1,updateMissing:!1,saveMissingTo:"fallback",saveMissingPlurals:!0,missingKeyHandler:!1,missingInterpolationHandler:!1,postProcess:!1,postProcessPassResolved:!1,returnNull:!1,returnEmptyString:!0,returnObjects:!1,joinArrays:!1,returnedObjectHandler:!1,parseMissingKeyHandler:!1,appendNamespaceToMissingKey:!1,appendNamespaceToCIMode:!1,overloadTranslationOptionHandler:i=>{let e={};if(typeof i[1]=="object"&&(e=i[1]),typeof i[1]=="string"&&(e.defaultValue=i[1]),typeof i[2]=="string"&&(e.tDescription=i[2]),typeof i[2]=="object"||typeof i[3]=="object"){const t=i[3]||i[2];Object.keys(t).forEach(s=>{e[s]=t[s]})}return e},interpolation:{escapeValue:!0,format:i=>i,prefix:"{{",suffix:"}}",formatSeparator:",",unescapePrefix:"-",nestingPrefix:"$t(",nestingSuffix:")",nestingOptionsSeparator:",",maxReplaces:1e3,skipOnVariables:!0}}),J1=i=>(typeof i.ns=="string"&&(i.ns=[i.ns]),typeof i.fallbackLng=="string"&&(i.fallbackLng=[i.fallbackLng]),typeof i.fallbackNS=="string"&&(i.fallbackNS=[i.fallbackNS]),i.supportedLngs&&i.supportedLngs.indexOf("cimode")<0&&(i.supportedLngs=i.supportedLngs.concat(["cimode"])),i),ch=()=>{},GP=i=>{Object.getOwnPropertyNames(Object.getPrototypeOf(i)).forEach(t=>{typeof i[t]=="function"&&(i[t]=i[t].bind(i))})};class tu extends Bd{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;if(super(),this.options=J1(e),this.services={},this.logger=Ar,this.modules={external:[]},GP(this),t&&!this.isInitialized&&!e.isClone){if(!this.options.initImmediate)return this.init(e,t),this;setTimeout(()=>{this.init(e,t)},0)}}init(){var e=this;let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},s=arguments.length>1?arguments[1]:void 0;this.isInitializing=!0,typeof t=="function"&&(s=t,t={}),!t.defaultNS&&t.defaultNS!==!1&&t.ns&&(typeof t.ns=="string"?t.defaultNS=t.ns:t.ns.indexOf("translation")<0&&(t.defaultNS=t.ns[0]));const r=Q1();this.options={...r,...this.options,...J1(t)},this.options.compatibilityAPI!=="v1"&&(this.options.interpolation={...r.interpolation,...this.options.interpolation}),t.keySeparator!==void 0&&(this.options.userDefinedKeySeparator=t.keySeparator),t.nsSeparator!==void 0&&(this.options.userDefinedNsSeparator=t.nsSeparator);const n=h=>h?typeof h=="function"?new h:h:null;if(!this.options.isClone){this.modules.logger?Ar.init(n(this.modules.logger),this.options):Ar.init(null,this.options);let h;this.modules.formatter?h=this.modules.formatter:typeof Intl<"u"&&(h=HP);const c=new $1(this.options);this.store=new j1(this.options.resources,this.options);const d=this.services;d.logger=Ar,d.resourceStore=this.store,d.languageUtils=c,d.pluralResolver=new OP(c,{prepend:this.options.pluralSeparator,compatibilityJSON:this.options.compatibilityJSON,simplifyPluralSuffix:this.options.simplifyPluralSuffix}),h&&(!this.options.interpolation.format||this.options.interpolation.format===r.interpolation.format)&&(d.formatter=n(h),d.formatter.init(d,this.options),this.options.interpolation.format=d.formatter.format.bind(d.formatter)),d.interpolator=new FP(this.options),d.utils={hasLoadedNamespace:this.hasLoadedNamespace.bind(this)},d.backendConnector=new WP(n(this.modules.backend),d.resourceStore,d,this.options),d.backendConnector.on("*",function(f){for(var p=arguments.length,g=new Array(p>1?p-1:0),b=1;b<p;b++)g[b-1]=arguments[b];e.emit(f,...g)}),this.modules.languageDetector&&(d.languageDetector=n(this.modules.languageDetector),d.languageDetector.init&&d.languageDetector.init(d,this.options.detection,this.options)),this.modules.i18nFormat&&(d.i18nFormat=n(this.modules.i18nFormat),d.i18nFormat.init&&d.i18nFormat.init(this)),this.translator=new vc(this.services,this.options),this.translator.on("*",function(f){for(var p=arguments.length,g=new Array(p>1?p-1:0),b=1;b<p;b++)g[b-1]=arguments[b];e.emit(f,...g)}),this.modules.external.forEach(f=>{f.init&&f.init(this)})}if(this.format=this.options.interpolation.format,s||(s=ch),this.options.fallbackLng&&!this.services.languageDetector&&!this.options.lng){const h=this.services.languageUtils.getFallbackCodes(this.options.fallbackLng);h.length>0&&h[0]!=="dev"&&(this.options.lng=h[0])}!this.services.languageDetector&&!this.options.lng&&this.logger.warn("init: no languageDetector is used and no lng is defined"),["getResource","hasResourceBundle","getResourceBundle","getDataByLanguage"].forEach(h=>{this[h]=function(){return e.store[h](...arguments)}}),["addResource","addResources","addResourceBundle","removeResourceBundle"].forEach(h=>{this[h]=function(){return e.store[h](...arguments),e}});const l=ol(),u=()=>{const h=(c,d)=>{this.isInitializing=!1,this.isInitialized&&!this.initializedStoreOnce&&this.logger.warn("init: i18next is already initialized. You should call init just once!"),this.isInitialized=!0,this.options.isClone||this.logger.log("initialized",this.options),this.emit("initialized",this.options),l.resolve(d),s(c,d)};if(this.languages&&this.options.compatibilityAPI!=="v1"&&!this.isInitialized)return h(null,this.t.bind(this));this.changeLanguage(this.options.lng,h)};return this.options.resources||!this.options.initImmediate?u():setTimeout(u,0),l}loadResources(e){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:ch;const r=typeof e=="string"?e:this.language;if(typeof e=="function"&&(s=e),!this.options.resources||this.options.partialBundledLanguages){if(r&&r.toLowerCase()==="cimode"&&(!this.options.preload||this.options.preload.length===0))return s();const n=[],a=o=>{if(!o||o==="cimode")return;this.services.languageUtils.toResolveHierarchy(o).forEach(u=>{u!=="cimode"&&n.indexOf(u)<0&&n.push(u)})};r?a(r):this.services.languageUtils.getFallbackCodes(this.options.fallbackLng).forEach(l=>a(l)),this.options.preload&&this.options.preload.forEach(o=>a(o)),this.services.backendConnector.load(n,this.options.ns,o=>{!o&&!this.resolvedLanguage&&this.language&&this.setResolvedLanguage(this.language),s(o)})}else s(null)}reloadResources(e,t,s){const r=ol();return e||(e=this.languages),t||(t=this.options.ns),s||(s=ch),this.services.backendConnector.reload(e,t,n=>{r.resolve(),s(n)}),r}use(e){if(!e)throw new Error("You are passing an undefined module! Please check the object you are passing to i18next.use()");if(!e.type)throw new Error("You are passing a wrong module! Please check the object you are passing to i18next.use()");return e.type==="backend"&&(this.modules.backend=e),(e.type==="logger"||e.log&&e.warn&&e.error)&&(this.modules.logger=e),e.type==="languageDetector"&&(this.modules.languageDetector=e),e.type==="i18nFormat"&&(this.modules.i18nFormat=e),e.type==="postProcessor"&&ex.addPostProcessor(e),e.type==="formatter"&&(this.modules.formatter=e),e.type==="3rdParty"&&this.modules.external.push(e),this}setResolvedLanguage(e){if(!(!e||!this.languages)&&!(["cimode","dev"].indexOf(e)>-1))for(let t=0;t<this.languages.length;t++){const s=this.languages[t];if(!(["cimode","dev"].indexOf(s)>-1)&&this.store.hasLanguageSomeTranslations(s)){this.resolvedLanguage=s;break}}}changeLanguage(e,t){var s=this;this.isLanguageChangingTo=e;const r=ol();this.emit("languageChanging",e);const n=l=>{this.language=l,this.languages=this.services.languageUtils.toResolveHierarchy(l),this.resolvedLanguage=void 0,this.setResolvedLanguage(l)},a=(l,u)=>{u?(n(u),this.translator.changeLanguage(u),this.isLanguageChangingTo=void 0,this.emit("languageChanged",u),this.logger.log("languageChanged",u)):this.isLanguageChangingTo=void 0,r.resolve(function(){return s.t(...arguments)}),t&&t(l,function(){return s.t(...arguments)})},o=l=>{!e&&!l&&this.services.languageDetector&&(l=[]);const u=typeof l=="string"?l:this.services.languageUtils.getBestMatchFromCodes(l);u&&(this.language||n(u),this.translator.language||this.translator.changeLanguage(u),this.services.languageDetector&&this.services.languageDetector.cacheUserLanguage&&this.services.languageDetector.cacheUserLanguage(u)),this.loadResources(u,h=>{a(h,u)})};return!e&&this.services.languageDetector&&!this.services.languageDetector.async?o(this.services.languageDetector.detect()):!e&&this.services.languageDetector&&this.services.languageDetector.async?this.services.languageDetector.detect.length===0?this.services.languageDetector.detect().then(o):this.services.languageDetector.detect(o):o(e),r}getFixedT(e,t,s){var r=this;const n=function(a,o){let l;if(typeof o!="object"){for(var u=arguments.length,h=new Array(u>2?u-2:0),c=2;c<u;c++)h[c-2]=arguments[c];l=r.options.overloadTranslationOptionHandler([a,o].concat(h))}else l={...o};l.lng=l.lng||n.lng,l.lngs=l.lngs||n.lngs,l.ns=l.ns||n.ns,l.keyPrefix!==""&&(l.keyPrefix=l.keyPrefix||s||n.keyPrefix);const d=r.options.keySeparator||".";let f;return l.keyPrefix&&Array.isArray(a)?f=a.map(p=>`${l.keyPrefix}${d}${p}`):f=l.keyPrefix?`${l.keyPrefix}${d}${a}`:a,r.t(f,l)};return typeof e=="string"?n.lng=e:n.lngs=e,n.ns=t,n.keyPrefix=s,n}t(){return this.translator&&this.translator.translate(...arguments)}exists(){return this.translator&&this.translator.exists(...arguments)}setDefaultNamespace(e){this.options.defaultNS=e}hasLoadedNamespace(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!this.isInitialized)return this.logger.warn("hasLoadedNamespace: i18next was not initialized",this.languages),!1;if(!this.languages||!this.languages.length)return this.logger.warn("hasLoadedNamespace: i18n.languages were undefined or empty",this.languages),!1;const s=t.lng||this.resolvedLanguage||this.languages[0],r=this.options?this.options.fallbackLng:!1,n=this.languages[this.languages.length-1];if(s.toLowerCase()==="cimode")return!0;const a=(o,l)=>{const u=this.services.backendConnector.state[`${o}|${l}`];return u===-1||u===2};if(t.precheck){const o=t.precheck(this,a);if(o!==void 0)return o}return!!(this.hasResourceBundle(s,e)||!this.services.backendConnector.backend||this.options.resources&&!this.options.partialBundledLanguages||a(s,e)&&(!r||a(n,e)))}loadNamespaces(e,t){const s=ol();return this.options.ns?(typeof e=="string"&&(e=[e]),e.forEach(r=>{this.options.ns.indexOf(r)<0&&this.options.ns.push(r)}),this.loadResources(r=>{s.resolve(),t&&t(r)}),s):(t&&t(),Promise.resolve())}loadLanguages(e,t){const s=ol();typeof e=="string"&&(e=[e]);const r=this.options.preload||[],n=e.filter(a=>r.indexOf(a)<0&&this.services.languageUtils.isSupportedCode(a));return n.length?(this.options.preload=r.concat(n),this.loadResources(a=>{s.resolve(),t&&t(a)}),s):(t&&t(),Promise.resolve())}dir(e){if(e||(e=this.resolvedLanguage||(this.languages&&this.languages.length>0?this.languages[0]:this.language)),!e)return"rtl";const t=["ar","shu","sqr","ssh","xaa","yhd","yud","aao","abh","abv","acm","acq","acw","acx","acy","adf","ads","aeb","aec","afb","ajp","apc","apd","arb","arq","ars","ary","arz","auz","avl","ayh","ayl","ayn","ayp","bbz","pga","he","iw","ps","pbt","pbu","pst","prp","prd","ug","ur","ydd","yds","yih","ji","yi","hbo","men","xmn","fa","jpr","peo","pes","prs","dv","sam","ckb"],s=this.services&&this.services.languageUtils||new $1(Q1());return t.indexOf(s.getLanguagePartFromCode(e))>-1||e.toLowerCase().indexOf("-arab")>1?"rtl":"ltr"}static createInstance(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;return new tu(e,t)}cloneInstance(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:ch;const s=e.forkResourceStore;s&&delete e.forkResourceStore;const r={...this.options,...e,isClone:!0},n=new tu(r);return(e.debug!==void 0||e.prefix!==void 0)&&(n.logger=n.logger.clone(e)),["store","services","language"].forEach(o=>{n[o]=this[o]}),n.services={...this.services},n.services.utils={hasLoadedNamespace:n.hasLoadedNamespace.bind(n)},s&&(n.store=new j1(this.store.data,r),n.services.resourceStore=n.store),n.translator=new vc(n.services,r),n.translator.on("*",function(o){for(var l=arguments.length,u=new Array(l>1?l-1:0),h=1;h<l;h++)u[h-1]=arguments[h];n.emit(o,...u)}),n.init(r,t),n.translator.options=r,n.translator.backendConnector.services.utils={hasLoadedNamespace:n.hasLoadedNamespace.bind(n)},n}toJSON(){return{options:this.options,store:this.store,language:this.language,languages:this.languages,resolvedLanguage:this.resolvedLanguage}}}const Ui=tu.createInstance();Ui.createInstance=tu.createInstance;Ui.createInstance;Ui.dir;Ui.init;Ui.loadResources;Ui.reloadResources;Ui.use;Ui.changeLanguage;Ui.getFixedT;Ui.t;Ui.exists;Ui.setDefaultNamespace;Ui.hasLoadedNamespace;Ui.loadNamespaces;Ui.loadLanguages;var ot=(i=>(i.BASS="F4",i.TREBLE="G2",i.TENOR="C3",i.ALTO="C4",i.PERCUSSION="N",i))(ot||{}),ne=(i=>(i.WHOLE="1/1",i.DOTTED_WHOLE="3/2",i.HALF="1/2",i.DOTTED_HALF="3/4",i.QUARTER="1/4",i.DOTTED_QUARTER="3/8",i.EIGHTH="1/8",i.DOTTED_EIGHT="3/16",i.SIXTEENTH="1/16",i.DOTTED_SIXTEENTH="3/32",i))(ne||{}),Bt=(i=>(i.FREQUENT="F",i.MODERATE="M",i.INFREQUENT="I",i))(Bt||{}),pi=(i=>(i.REST="REST",i.NOTE="NOTE",i))(pi||{}),j=(i=>(i.C_MAJOR_A_MINOR="C",i.G_MAJOR_E_MINOR_1_SHARP="G",i.D_MAJOR_B_MINOR_2_SHARPS="D",i.A_MAJOR_F_SHARP_MINOR_3_SHARPS="A",i.E_MAJOR_C_SHARP_MINOR_4_SHARPS="E",i.B_MAJOR_G_SHARP_MINOR_5_SHARPS="B",i.F_SHARP_MAJOR_D_SHARP_MINOR_6_SHARPS="F#",i.C_SHARP_MAJOR_A_SHARP_MINOR_7_SHARPS="C#",i.F_MAJOR_D_MINOR_1_FLAT="F",i.Bb_MAJOR_G_MINOR_2_FLATS="Bb",i.Eb_MAJOR_C_MINOR_3_FLATS="Eb",i.Ab_MAJOR_F_MINOR_4_FLATS="Ab",i.Db_MAJOR_Bb_MINOR_5_FLATS="Db",i.Gb_MAJOR_Eb_MINOR_6_FLATS="Gb",i.Cb_MAJOR_Ab_MINOR_7_FLATS="Cb",i))(j||{});const jP={[ot.BASS]:"Bass clef",[ot.TREBLE]:"Treble clef",[ot.PERCUSSION]:"Percussion clef",[ot.TENOR]:"Tenor clef",[ot.ALTO]:"Alto clef"},UP={[ot.BASS]:"F clef",[ot.TREBLE]:"G clef",[ot.PERCUSSION]:"Percussion",[ot.TENOR]:"C(3) clef ",[ot.ALTO]:"C(4) clef "},$P={[ne.WHOLE]:"whole",[ne.DOTTED_WHOLE]:"dotted whole",[ne.HALF]:"half",[ne.DOTTED_HALF]:"dotted half",[ne.QUARTER]:"quarter",[ne.DOTTED_QUARTER]:"dotted quarter",[ne.EIGHTH]:"eighth",[ne.DOTTED_EIGHT]:"dotted eighth",[ne.SIXTEENTH]:"sixteenth",[ne.DOTTED_SIXTEENTH]:"dotted sixteenth"},YP={[pi.NOTE]:"note",[pi.REST]:"note rest"},XP={[j.C_MAJOR_A_MINOR]:"C Major / A Minor",[j.G_MAJOR_E_MINOR_1_SHARP]:"G Major / E Minor",[j.D_MAJOR_B_MINOR_2_SHARPS]:"D Major / B Minor",[j.A_MAJOR_F_SHARP_MINOR_3_SHARPS]:"A Major / F♯ Minor",[j.E_MAJOR_C_SHARP_MINOR_4_SHARPS]:"E Major / C♯ Minor",[j.B_MAJOR_G_SHARP_MINOR_5_SHARPS]:"B Major / G♯ Minor",[j.F_SHARP_MAJOR_D_SHARP_MINOR_6_SHARPS]:"F♯ Major / D♯ Minor",[j.C_SHARP_MAJOR_A_SHARP_MINOR_7_SHARPS]:"C♯ Major / A♯ Minor",[j.F_MAJOR_D_MINOR_1_FLAT]:"F Major / D Minor",[j.Bb_MAJOR_G_MINOR_2_FLATS]:"B♭ Major / G Minor",[j.Eb_MAJOR_C_MINOR_3_FLATS]:"E♭ Major / C Minor",[j.Ab_MAJOR_F_MINOR_4_FLATS]:"A♭ Major / F Minor",[j.Db_MAJOR_Bb_MINOR_5_FLATS]:"D♭ Major / F Minor",[j.Gb_MAJOR_Eb_MINOR_6_FLATS]:"G♭ Major / E♭ Minor",[j.Cb_MAJOR_Ab_MINOR_7_FLATS]:"C♭ Major / A♭ Minor"},QP={[Bt.FREQUENT]:"Frequent",[Bt.MODERATE]:"Moderate",[Bt.INFREQUENT]:"Infrequent"},JP={WHOLE_NOTES:"Steady whole notes",HALF_NOTES:"Steady half notes",QUARTER_NOTES:"Steady quarter notes",MELODY:"Realistic melody"},qP={Language:"Language",Score:{MelodyIn:"A Melody in {{key}}",AlphaTabRenderedBy:"Score rendered by:",Issues:"Report issues & ideas:",Loading:"Score is loading..."},Menu:{GenerateNew:"Generate new",Settings:"Settings",Help:"Help"},Help:{Help:"Help",TrebleClef:"Treble Clef",BassClef:"Bass Clef"},Settings:{Settings:"Settings",BasicsPage:"Basic Settings",NotesPage:"Notes",RhythmsPage:"Rhythms",RestsPage:"Rests",ChordsPage:"Chords",SharePage:"Share",Save:"Save",BarCount:"Number of bars",BarCountDescription:"Number of bars (length of the random generated piece).",Clef:"Clef",ClefDescription:"Clef you want to practice. Can be either bass or treble.",KeySignature:"Key signature",KeySignatureDescription:"The key you want to practice in.",TimeSignature:"Time signature",TimeSignatureDescription:"The time you want to practice in.",MelodyType:"Melody type",MelodyTypeDescription:"The type of melodies you want to practice.",Range:"Range",RangeDescription:"Fret range on your stringed instrument (guitar or bass).",NonScaleNotes:"Use non scale notes",NonScaleNotesDescription:"Use notes that are outside of your selected scale, to practice accidentals.",Tempo:"Tempo (in BPM)",TempoDescription:"The tempo of the generated melody.",ShowNoteNames:"Show note names",ShowNoteNamesDescription:"When turned on, shows the note names above the score.",TuningName:"Tuning",TuningDescription:"Individual strings of the instruments you want to practice with",TuningAddString:"Add string",NotesPreset:"Notes preset",NotesPresetDescription:"Select notes from the available presets describing the range of common instruments",Notes:"Notes",NotesDescription:"Select the individual notes of your instruments range, if the presets are not suitable",NoteDurations:"Note durations",NoteDurationsDescription:"Select the individual note durations, how often they occur and in what clusters.",DottedNoteDurations:"Dotted note durations",DottedNoteDurationsDescription:"Select the individual dotted note durations, how often they occur and in what clusters.",RestDurations:"Rest durations",RestDurationsDescription:"Select the individual rest durations, how often they occur and in what clusters.",DottedRestDurations:"Dotted rest durations",DottedRestDurationsDescription:"Select the individual dotted rest durations, how often they occur and in what clusters.",ShareableLink:"Shareable link",ShareableLinkDescription:"Grab a shareable link for your configuration! This contains no tracking data!",ClickToCopy:"Click to copy URL to the clipboard!",CopySuccess:"Successfully copied to the clipboard!",CopyFailure:"Failed to copy to the clipboard!",ScaleOnly:"Scale",ShowChordLabels:"Show chord labels",ShowChordLabelsDescription:"Shows chords labels above the melody.",ShowChordsStaff:"Show accompaniment",ShowChordsStaffDescription:"Shows chords played under the main melody part in a separate staff",SeventhChords:"Use extended chords",SeventhChordsDescription:"Uses extended chords for the accompaniment instead of triads"},Instruments:{SixStringGuitar:"6 String Guitar",SevenStringGuitar:"7 String Guitar",FourStringBass:"4 String Bass",FiveStringBass:"5 String Bass"},PresetNames:{Custom:"Custom notes",Unfretted:"Unfretted strings ({{notes}})",Position:"{{position}}. position ({{lowest}} to {{highest}})",ToNthFret:"Up to {{fret}}th fret ({{lowest}} to {{highest}})"},NotePresets:{Custom:"Custom notes",SixStringGuitar:"6 String Guitar",SevenStringGuitar:"7 String Guitar",FourStringBass:"4 String Bass",FiveStringBass:"5 String Bass",SixStringGuitarUnfretted:"6 String Guitar (unfretted)",SevenStringGuitarUnfretted:"7 String Guitar (unfretted)",FourStringBassUnfretted:"4 String Bass (unfretted)",FiveStringBassUnfretted:"5 String Bass (unfretted)"},NoteAndRestHeaders:{Notes:"Notes",DottedNotes:"Dotted notes",Rests:"Rests",DottedRests:"Dotted rests"},DurationHeaders:{Whole:"Whole notes",Half:"Half notes",Quarter:"Quarter notes",Eighth:"Eighth notes",Sixteenth:"Sixteenth notes"},ClefsPrimary:jP,ClefsAlternate:UP,KeySignatures:XP,MelodyTypes:JP,Durations:$P,Frequency:QP,DurationTypes:YP,Logo:{Name:"Gonb",Slogan:"learn to read."},Validation:{EmptyBars:"Number of bars cannot be empty.",EmptyTempo:"Tempo cannot be empty.",EmptyTimeSignatureUpper:"Upper part of time signature cannot be empty.",EmptyTimeSignatureLower:"Lower part of time signature cannot be empty.",DurationLongerThanBar:"Duration {{duration}} doesn't fit in a bar of {{timeSignature}}, so it will never occur in the score.",DurationInvalidBecauseOfTimeSignature:"Invalid because of time signature.",DurationInvalidBeacauseOfTimeSignature:"Please fix the time signature before configuring durations!",PercussionClef:"This clef is not yet supported.",ZeroBars:"There must be at least one bar.",WrongBpm:"Tempo must be between 10 and 400 bpm.",EmptyNotes:"Select at least 1 note.",NoScaleNotes:"Select at least 1 note of {{scale}} major (one of {{scaleNotes}}).",EmptyDurations:"Select at least one duration, that fits in {{timeSignature}}.",DottedRhytms:"When {{dotted}} is selected, {{required}} must be selected as well.",TimeSignatureLower:"Lower value must be {{lower}}",TimeSignatureUpper:"Upper value must be between {{min}} and {{max}}",ErrorInUrl:"Can't share your configuration until it has critical issues."},ErrorBoundary:{Title:"An unexpected error happened!",Explanation:"This may occur if your locally saved configuration is out of date, or you have found a bug! If you think it is a bug please report it (include the message below).",Reset:"Reset App"},DurationGrid:{IsNotActive:"is inactive.",Enabled:"Enabled",Probability:"Probability",ClusterSize:"Cluster size",DurationTooLong:"{{duration}} does not fit in a bar."},PlayerTooltips:{MelodyVolume:"Melody volume",ChordsVolume:"Chords volume",MetronomeVolume:"Metronome volume",Play:"Play",Pause:"Pause",Stop:"Stop",Loop:"Loop",CountIn:"Count-in",Regenerate:"Generate"}},KP={[ot.BASS]:"Basszuskulcs",[ot.TREBLE]:"Violinkulcs",[ot.PERCUSSION]:"Ütőkulcs",[ot.TENOR]:"Tenorkulcs",[ot.ALTO]:"Altokulcs"},ZP={[ot.BASS]:"F kulcs",[ot.TREBLE]:"G kulcs",[ot.PERCUSSION]:"Ütőkulcs",[ot.TENOR]:"C(3) kulcs ",[ot.ALTO]:"C(4) kulcs "},eM={[ne.WHOLE]:"egész",[ne.DOTTED_WHOLE]:"pontozott egész",[ne.HALF]:"fél",[ne.DOTTED_HALF]:"pontozott fél",[ne.QUARTER]:"negyed",[ne.DOTTED_QUARTER]:"pontozott negyed",[ne.EIGHTH]:"nyolcad",[ne.DOTTED_EIGHT]:"pontozott nyolcad",[ne.SIXTEENTH]:"tizenhatod",[ne.DOTTED_SIXTEENTH]:"pontozott tizenhatod"},tM={[pi.NOTE]:"hang",[pi.REST]:"értékű szünet"},iM={[j.C_MAJOR_A_MINOR]:"C Dúr / A Moll",[j.G_MAJOR_E_MINOR_1_SHARP]:"G Dúr / E Moll",[j.D_MAJOR_B_MINOR_2_SHARPS]:"D Dúr / B Moll",[j.A_MAJOR_F_SHARP_MINOR_3_SHARPS]:"A Dúr / F♯ Moll",[j.E_MAJOR_C_SHARP_MINOR_4_SHARPS]:"E Dúr / C♯ Moll",[j.B_MAJOR_G_SHARP_MINOR_5_SHARPS]:"H Dúr / G♯ Moll",[j.F_SHARP_MAJOR_D_SHARP_MINOR_6_SHARPS]:"F♯ Dúr / D♯ Moll",[j.C_SHARP_MAJOR_A_SHARP_MINOR_7_SHARPS]:"C♯ Dúr / A♯ Moll",[j.F_MAJOR_D_MINOR_1_FLAT]:"F Dúr / D Moll",[j.Bb_MAJOR_G_MINOR_2_FLATS]:"B Dúr / G Moll",[j.Eb_MAJOR_C_MINOR_3_FLATS]:"E♭ Dúr / C Moll",[j.Ab_MAJOR_F_MINOR_4_FLATS]:"A♭ Dúr / F Moll",[j.Db_MAJOR_Bb_MINOR_5_FLATS]:"D♭ Dúr / F Moll",[j.Gb_MAJOR_Eb_MINOR_6_FLATS]:"G♭ Dúr / E♭ Moll",[j.Cb_MAJOR_Ab_MINOR_7_FLATS]:"C♭ Dúr / A♭ Moll"},sM={WHOLE_NOTES:"Egész hangok",HALF_NOTES:"Fél hangok",QUARTER_NOTES:"Negyed hangok",MELODY:"Realisztikus dallam"},rM={[Bt.FREQUENT]:"Gyakori",[Bt.MODERATE]:"Mérsékelt",[Bt.INFREQUENT]:"Ritka"},nM={Language:"Nyelv",Logo:{Name:"Gonb",Slogan:"tanulj meg olvasni."},Score:{MelodyIn:"Egy dallam {{key}}-ben",AlphaTabRenderedBy:"Kottát rajzolta:",Issues:"Hibák és ötletek:",Loading:"A kotta töltődik..."},Menu:{GenerateNew:"Generálj újat",Settings:"Beállítások",Help:"Segítség"},Help:{Help:"Segítség",TrebleClef:"Violin kulcs",BassClef:"Basszus kulcs"},Settings:{Settings:"Beállítások",BarCount:"Ütemek száma",BarCountDescription:"Generált ütemek száma (a generált dallam hossza).",Clef:"Kulcs",ClefDescription:"Zenei kulcs amiben gyakorolni szeretnél.",KeySignature:"Előjegyzés",KeySignatureDescription:"Az előjegyzés amivel gyakorolni szeretnél.",TimeSignature:"Ütemmutató",TimeSignatureDescription:"Az ütemmutató amivel gyakorolni szeretnél.",MelodyType:"Dallam típusa",MelodyTypeDescription:"Dallam típusa amit gyakorolni szeretnél.",Range:"Tartomány",RangeDescription:"Bundok tartománya amiben gyakorolni szeretnél (gitár vagy basszus).",NonScaleNotes:"Skálán kívüli hangok",NonScaleNotesDescription:"Skálán kívül eső hangok használata (random ♯-ek és ♭-k gyakorlására).",Tempo:"Tempó (BPM-ben)",TempoDescription:"A generált dallam sebessége.",ShowNoteNames:"Hangok nevei",ShowNoteNamesDescription:"Mutassa a hangok nevét.",TuningName:"Hangolás",TuningDescription:"A hangszered hangolása",TuningAddString:"Húr hozzáadása",BasicsPage:"Alapbeállítások",NotesPage:"Hangok",RhythmsPage:"Ritmusok",RestsPage:"Szünetek",ChordsPage:"Akkordok",SharePage:"Megosztás",Save:"Mentés",NotesPreset:"Profilok",NotesPresetDescription:"Válassz előre beállított profilok közül!",Notes:"Hangok",NotesDescription:"Válaszd ki a hangokat amikkel gyakorolni szeretnél (vagy válassz egy profilt).",NoteDurations:"Ritmusok",NoteDurationsDescription:"Válaszd ki a ritmusokat amiket gyakorolni szerenél.",DottedNoteDurations:"Pontozott ritmusok",DottedNoteDurationsDescription:"Válaszd ki a pontozott ritmusokat amiket gyakorolni szerenél.",RestDurations:"Szünetek",RestDurationsDescription:"Válaszd ki a szüneteket amiket gyakorolni szerenél.",DottedRestDurations:"Pontozott szünetek",DottedRestDurationsDescription:"Válaszd ki a pontozott szüneteket amiket gyakorolni szerenél.",ShareableLink:"Megosztható link",ShareableLinkDescription:"Ezen a linken megoszthatod a beállításaidat.",ClickToCopy:"Kattints a link vágólapra másolásához!",CopySuccess:"Link sikeresen a vágólapra másolva!",CopyFailure:"Vágólapra másolás sikertelen.",ScaleOnly:"Skála",ShowChordsStaff:"Mutasd a kíséretet",ShowChordsStaffDescription:"Mutatja a fő dallam alatt játszott akkordokat egy külön szólamon.",ShowChordLabels:"Mutasd az akkordszimbólumokat",ShowChordLabelsDescription:"Mutatja a kíséretben használt akkordok neveit a dallam fölött.",SeventhChords:"Használj dúsított akkordokat",SeventhChordsDescription:"Dúsabb akkordhangzásokat használ az alap hármashangzatok helyett."},KeySignatures:iM,MelodyTypes:sM,PresetNames:{Custom:"Egyedi hangok",Unfretted:"Üres húrok ({{notes}})",Position:"{{position}}. fekvés ({{lowest}}-{{highest}})",ToNthFret:"A {{fret}}. bundig ({{lowest}}-{{highest}})"},Instruments:{SixStringGuitar:"6 Húros Gitár",SevenStringGuitar:"7 Húros Gitár",FourStringBass:"4 Húros Basszusgitár",FiveStringBass:"5 Húros Basszusgitár"},NotePresets:{SixStringGuitar:"6 Húros Gitár",SevenStringGuitar:"7 Húros Gitár",FourStringBass:"4 Húros Basszusgitár",FiveStringBass:"5 Húros Basszusgitár",SixStringGuitarUnfretted:"6 Húros Gitár (csak húrok)",SevenStringGuitarUnfretted:"7 Húros Gitár (csak húrok)",FourStringBassUnfretted:"4 Húros Basszusgitár (csak húrok)",FiveStringBassUnfretted:"5 Húros Basszusgitár (csak húrok)",Custom:"Egyedi hangok"},NoteAndRestHeaders:{Notes:"Hangok",DottedNotes:"Pontozott hangok",Rests:"Szünetek",DottedRests:"Pontozott szünetek"},DurationHeaders:{Whole:"Egész hangok",Half:"Fél hangok",Quarter:"Negyed hangok",Eighth:"Nyolcad hangok",Sixteenth:"Tizenhatod hangok"},ClefsPrimary:KP,ClefsAlternate:ZP,Durations:eM,DurationTypes:tM,Frequency:rM,Validation:{PercussionClef:"Ez a kulcs még nem működik.",ZeroBars:"Legalább 1 ütem szükséges.",WrongBpm:"A tempó 10 és 400 bpm között kell hogy legyen.",EmptyNotes:"Válassz legalább 1 hangot.",NoScaleNotes:"Válassz legalább 1 hangot a {{scale}} dúr skálából ({{scaleNotes}} hangok egyikét).",EmptyDurations:"Válassz legalább 1 ritmusértéket, ami befér {{timeSignature}}-be.",DottedRhytms:"A {{required}} (ritmus vagy szünet) kiválasztása kötelező  (a {{dotted}} miatt).",TimeSignatureLower:"Az ütemmutató nevezője a következő értékek egyike kell hogy legyen: {{lower}}.",TimeSignatureUpper:"Az ütemmutató számlálója {{min}} és {{max}} között kell hogy legyen.",EmptyBars:"Az ütemszám nem lehet üres.",EmptyTempo:"A tempó nem lehet üres.",EmptyTimeSignatureUpper:"Az ütemmutató számlálója nem lehet üres.",EmptyTimeSignatureLower:"Az ütemmutató nevezője nem lehet üres.",ErrorInUrl:"Megosztható URL nem generálható ameddig a beállítás kritikus hibákat tartalmaz.",DurationLongerThanBar:"Egy {{duration}} nem fér egy {{timeSignature}} ütemmutatójú ütembe, emiatt nem fog előfordulni a kottában.",DurationInvalidBecauseOfTimeSignature:"Érvénytelen a hibás ütemmutató miatt.",DurationInvalidBeacauseOfTimeSignature:"Javítsd az ütemmutatót a ritmusok beállítása előtt!"},ErrorBoundary:{Title:"Hiba történt!",Explanation:"Vagy régiek a mentett adataid, vagy programhibát találtál. Ha úgy gondolod hogy ez programhiba, kérlek jelentsd (az alábbiakat csatolva):",Reset:"App alaphelyzetbe állítása"},DurationGrid:{IsNotActive:"inaktív.",Enabled:"Aktív",Probability:"Gyakoriság",ClusterSize:"Csoport méret",DurationTooLong:"Egy {{duration}} nem fér egy ütembe."},PlayerTooltips:{MelodyVolume:"Dallam hangereje",ChordsVolume:"Kíséret hangereje",MetronomeVolume:"Metronóm hangereje",Play:"Lejátszás",Pause:"Szünet",Stop:"Stop",Loop:"Ismétel",CountIn:"Beszámol",Regenerate:"Újat!"}};function Oi(i){return`Minified Redux error #${i}; visit https://redux.js.org/Errors?code=${i} for the full message or use the non-minified dev environment for full errors. `}var aM=typeof Symbol=="function"&&Symbol.observable||"@@observable",q1=aM,Tf=()=>Math.random().toString(36).substring(7).split("").join("."),oM={INIT:`@@redux/INIT${Tf()}`,REPLACE:`@@redux/REPLACE${Tf()}`,PROBE_UNKNOWN_ACTION:()=>`@@redux/PROBE_UNKNOWN_ACTION${Tf()}`},kc=oM;function h0(i){if(typeof i!="object"||i===null)return!1;let e=i;for(;Object.getPrototypeOf(e)!==null;)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(i)===e||Object.getPrototypeOf(i)===null}function tx(i,e,t){if(typeof i!="function")throw new Error(Oi(2));if(typeof e=="function"&&typeof t=="function"||typeof t=="function"&&typeof arguments[3]=="function")throw new Error(Oi(0));if(typeof e=="function"&&typeof t>"u"&&(t=e,e=void 0),typeof t<"u"){if(typeof t!="function")throw new Error(Oi(1));return t(tx)(i,e)}let s=i,r=e,n=new Map,a=n,o=0,l=!1;function u(){a===n&&(a=new Map,n.forEach((b,m)=>{a.set(m,b)}))}function h(){if(l)throw new Error(Oi(3));return r}function c(b){if(typeof b!="function")throw new Error(Oi(4));if(l)throw new Error(Oi(5));let m=!0;u();const y=o++;return a.set(y,b),function(){if(m){if(l)throw new Error(Oi(6));m=!1,u(),a.delete(y),n=null}}}function d(b){if(!h0(b))throw new Error(Oi(7));if(typeof b.type>"u")throw new Error(Oi(8));if(typeof b.type!="string")throw new Error(Oi(17));if(l)throw new Error(Oi(9));try{l=!0,r=s(r,b)}finally{l=!1}return(n=a).forEach(y=>{y()}),b}function f(b){if(typeof b!="function")throw new Error(Oi(10));s=b,d({type:kc.REPLACE})}function p(){const b=c;return{subscribe(m){if(typeof m!="object"||m===null)throw new Error(Oi(11));function y(){const x=m;x.next&&x.next(h())}return y(),{unsubscribe:b(y)}},[q1](){return this}}}return d({type:kc.INIT}),{dispatch:d,subscribe:c,getState:h,replaceReducer:f,[q1]:p}}function lM(i){Object.keys(i).forEach(e=>{const t=i[e];if(typeof t(void 0,{type:kc.INIT})>"u")throw new Error(Oi(12));if(typeof t(void 0,{type:kc.PROBE_UNKNOWN_ACTION()})>"u")throw new Error(Oi(13))})}function uM(i){const e=Object.keys(i),t={};for(let n=0;n<e.length;n++){const a=e[n];typeof i[a]=="function"&&(t[a]=i[a])}const s=Object.keys(t);let r;try{lM(t)}catch(n){r=n}return function(a={},o){if(r)throw r;let l=!1;const u={};for(let h=0;h<s.length;h++){const c=s[h],d=t[c],f=a[c],p=d(f,o);if(typeof p>"u")throw o&&o.type,new Error(Oi(14));u[c]=p,l=l||p!==f}return l=l||s.length!==Object.keys(a).length,l?u:a}}function xc(...i){return i.length===0?e=>e:i.length===1?i[0]:i.reduce((e,t)=>(...s)=>e(t(...s)))}function hM(...i){return e=>(t,s)=>{const r=e(t,s);let n=()=>{throw new Error(Oi(15))};const a={getState:r.getState,dispatch:(l,...u)=>n(l,...u)},o=i.map(l=>l(a));return n=xc(...o)(r.dispatch),{...r,dispatch:n}}}function cM(i){return h0(i)&&"type"in i&&typeof i.type=="string"}var ix=Symbol.for("immer-nothing"),K1=Symbol.for("immer-draftable"),Ds=Symbol.for("immer-state");function lr(i,...e){throw new Error(`[Immer] minified error nr: ${i}. Full error at: https://bit.ly/3cXEKWf`)}var Ao=Object.getPrototypeOf;function Ta(i){return!!i&&!!i[Ds]}function cn(i){var e;return i?sx(i)||Array.isArray(i)||!!i[K1]||!!((e=i.constructor)!=null&&e[K1])||Pd(i)||Md(i):!1}var dM=Object.prototype.constructor.toString();function sx(i){if(!i||typeof i!="object")return!1;const e=Ao(i);if(e===null)return!0;const t=Object.hasOwnProperty.call(e,"constructor")&&e.constructor;return t===Object?!0:typeof t=="function"&&Function.toString.call(t)===dM}function _c(i,e){Cd(i)===0?Reflect.ownKeys(i).forEach(t=>{e(t,i[t],i)}):i.forEach((t,s)=>e(s,t,i))}function Cd(i){const e=i[Ds];return e?e.type_:Array.isArray(i)?1:Pd(i)?2:Md(i)?3:0}function fg(i,e){return Cd(i)===2?i.has(e):Object.prototype.hasOwnProperty.call(i,e)}function rx(i,e,t){const s=Cd(i);s===2?i.set(e,t):s===3?i.add(t):i[e]=t}function fM(i,e){return i===e?i!==0||1/i===1/e:i!==i&&e!==e}function Pd(i){return i instanceof Map}function Md(i){return i instanceof Set}function ra(i){return i.copy_||i.base_}function pg(i,e){if(Pd(i))return new Map(i);if(Md(i))return new Set(i);if(Array.isArray(i))return Array.prototype.slice.call(i);const t=sx(i);if(e===!0||e==="class_only"&&!t){const s=Object.getOwnPropertyDescriptors(i);delete s[Ds];let r=Reflect.ownKeys(s);for(let n=0;n<r.length;n++){const a=r[n],o=s[a];o.writable===!1&&(o.writable=!0,o.configurable=!0),(o.get||o.set)&&(s[a]={configurable:!0,writable:!0,enumerable:o.enumerable,value:i[a]})}return Object.create(Ao(i),s)}else{const s=Ao(i);if(s!==null&&t)return{...i};const r=Object.create(s);return Object.assign(r,i)}}function c0(i,e=!1){return Ed(i)||Ta(i)||!cn(i)||(Cd(i)>1&&(i.set=i.add=i.clear=i.delete=pM),Object.freeze(i),e&&Object.entries(i).forEach(([t,s])=>c0(s,!0))),i}function pM(){lr(2)}function Ed(i){return Object.isFrozen(i)}var gM={};function Na(i){const e=gM[i];return e||lr(0,i),e}var iu;function nx(){return iu}function mM(i,e){return{drafts_:[],parent_:i,immer_:e,canAutoFreeze_:!0,unfinalizedDrafts_:0}}function Z1(i,e){e&&(Na("Patches"),i.patches_=[],i.inversePatches_=[],i.patchListener_=e)}function gg(i){mg(i),i.drafts_.forEach(yM),i.drafts_=null}function mg(i){i===iu&&(iu=i.parent_)}function eb(i){return iu=mM(iu,i)}function yM(i){const e=i[Ds];e.type_===0||e.type_===1?e.revoke_():e.revoked_=!0}function tb(i,e){e.unfinalizedDrafts_=e.drafts_.length;const t=e.drafts_[0];return i!==void 0&&i!==t?(t[Ds].modified_&&(gg(e),lr(4)),cn(i)&&(i=Tc(e,i),e.parent_||Nc(e,i)),e.patches_&&Na("Patches").generateReplacementPatches_(t[Ds].base_,i,e.patches_,e.inversePatches_)):i=Tc(e,t,[]),gg(e),e.patches_&&e.patchListener_(e.patches_,e.inversePatches_),i!==ix?i:void 0}function Tc(i,e,t){if(Ed(e))return e;const s=e[Ds];if(!s)return _c(e,(r,n)=>ib(i,s,e,r,n,t)),e;if(s.scope_!==i)return e;if(!s.modified_)return Nc(i,s.base_,!0),s.base_;if(!s.finalized_){s.finalized_=!0,s.scope_.unfinalizedDrafts_--;const r=s.copy_;let n=r,a=!1;s.type_===3&&(n=new Set(r),r.clear(),a=!0),_c(n,(o,l)=>ib(i,s,r,o,l,t,a)),Nc(i,r,!1),t&&i.patches_&&Na("Patches").generatePatches_(s,t,i.patches_,i.inversePatches_)}return s.copy_}function ib(i,e,t,s,r,n,a){if(Ta(r)){const o=n&&e&&e.type_!==3&&!fg(e.assigned_,s)?n.concat(s):void 0,l=Tc(i,r,o);if(rx(t,s,l),Ta(l))i.canAutoFreeze_=!1;else return}else a&&t.add(r);if(cn(r)&&!Ed(r)){if(!i.immer_.autoFreeze_&&i.unfinalizedDrafts_<1)return;Tc(i,r),(!e||!e.scope_.parent_)&&typeof s!="symbol"&&Object.prototype.propertyIsEnumerable.call(t,s)&&Nc(i,r)}}function Nc(i,e,t=!1){!i.parent_&&i.immer_.autoFreeze_&&i.canAutoFreeze_&&c0(e,t)}function bM(i,e){const t=Array.isArray(i),s={type_:t?1:0,scope_:e?e.scope_:nx(),modified_:!1,finalized_:!1,assigned_:{},parent_:e,base_:i,draft_:null,copy_:null,revoke_:null,isManual_:!1};let r=s,n=d0;t&&(r=[s],n=su);const{revoke:a,proxy:o}=Proxy.revocable(r,n);return s.draft_=o,s.revoke_=a,o}var d0={get(i,e){if(e===Ds)return i;const t=ra(i);if(!fg(t,e))return SM(i,t,e);const s=t[e];return i.finalized_||!cn(s)?s:s===Nf(i.base_,e)?(Bf(i),i.copy_[e]=bg(s,i)):s},has(i,e){return e in ra(i)},ownKeys(i){return Reflect.ownKeys(ra(i))},set(i,e,t){const s=ax(ra(i),e);if(s!=null&&s.set)return s.set.call(i.draft_,t),!0;if(!i.modified_){const r=Nf(ra(i),e),n=r==null?void 0:r[Ds];if(n&&n.base_===t)return i.copy_[e]=t,i.assigned_[e]=!1,!0;if(fM(t,r)&&(t!==void 0||fg(i.base_,e)))return!0;Bf(i),yg(i)}return i.copy_[e]===t&&(t!==void 0||e in i.copy_)||Number.isNaN(t)&&Number.isNaN(i.copy_[e])||(i.copy_[e]=t,i.assigned_[e]=!0),!0},deleteProperty(i,e){return Nf(i.base_,e)!==void 0||e in i.base_?(i.assigned_[e]=!1,Bf(i),yg(i)):delete i.assigned_[e],i.copy_&&delete i.copy_[e],!0},getOwnPropertyDescriptor(i,e){const t=ra(i),s=Reflect.getOwnPropertyDescriptor(t,e);return s&&{writable:!0,configurable:i.type_!==1||e!=="length",enumerable:s.enumerable,value:t[e]}},defineProperty(){lr(11)},getPrototypeOf(i){return Ao(i.base_)},setPrototypeOf(){lr(12)}},su={};_c(d0,(i,e)=>{su[i]=function(){return arguments[0]=arguments[0][0],e.apply(this,arguments)}});su.deleteProperty=function(i,e){return su.set.call(this,i,e,void 0)};su.set=function(i,e,t){return d0.set.call(this,i[0],e,t,i[0])};function Nf(i,e){const t=i[Ds];return(t?ra(t):i)[e]}function SM(i,e,t){var r;const s=ax(e,t);return s?"value"in s?s.value:(r=s.get)==null?void 0:r.call(i.draft_):void 0}function ax(i,e){if(!(e in i))return;let t=Ao(i);for(;t;){const s=Object.getOwnPropertyDescriptor(t,e);if(s)return s;t=Ao(t)}}function yg(i){i.modified_||(i.modified_=!0,i.parent_&&yg(i.parent_))}function Bf(i){i.copy_||(i.copy_=pg(i.base_,i.scope_.immer_.useStrictShallowCopy_))}var wM=class{constructor(i){this.autoFreeze_=!0,this.useStrictShallowCopy_=!1,this.produce=(e,t,s)=>{if(typeof e=="function"&&typeof t!="function"){const n=t;t=e;const a=this;return function(l=n,...u){return a.produce(l,h=>t.call(this,h,...u))}}typeof t!="function"&&lr(6),s!==void 0&&typeof s!="function"&&lr(7);let r;if(cn(e)){const n=eb(this),a=bg(e,void 0);let o=!0;try{r=t(a),o=!1}finally{o?gg(n):mg(n)}return Z1(n,s),tb(r,n)}else if(!e||typeof e!="object"){if(r=t(e),r===void 0&&(r=e),r===ix&&(r=void 0),this.autoFreeze_&&c0(r,!0),s){const n=[],a=[];Na("Patches").generateReplacementPatches_(e,r,n,a),s(n,a)}return r}else lr(1,e)},this.produceWithPatches=(e,t)=>{if(typeof e=="function")return(a,...o)=>this.produceWithPatches(a,l=>e(l,...o));let s,r;return[this.produce(e,t,(a,o)=>{s=a,r=o}),s,r]},typeof(i==null?void 0:i.autoFreeze)=="boolean"&&this.setAutoFreeze(i.autoFreeze),typeof(i==null?void 0:i.useStrictShallowCopy)=="boolean"&&this.setUseStrictShallowCopy(i.useStrictShallowCopy)}createDraft(i){cn(i)||lr(8),Ta(i)&&(i=vM(i));const e=eb(this),t=bg(i,void 0);return t[Ds].isManual_=!0,mg(e),t}finishDraft(i,e){const t=i&&i[Ds];(!t||!t.isManual_)&&lr(9);const{scope_:s}=t;return Z1(s,e),tb(void 0,s)}setAutoFreeze(i){this.autoFreeze_=i}setUseStrictShallowCopy(i){this.useStrictShallowCopy_=i}applyPatches(i,e){let t;for(t=e.length-1;t>=0;t--){const r=e[t];if(r.path.length===0&&r.op==="replace"){i=r.value;break}}t>-1&&(e=e.slice(t+1));const s=Na("Patches").applyPatches_;return Ta(i)?s(i,e):this.produce(i,r=>s(r,e))}};function bg(i,e){const t=Pd(i)?Na("MapSet").proxyMap_(i,e):Md(i)?Na("MapSet").proxySet_(i,e):bM(i,e);return(e?e.scope_:nx()).drafts_.push(t),t}function vM(i){return Ta(i)||lr(10,i),ox(i)}function ox(i){if(!cn(i)||Ed(i))return i;const e=i[Ds];let t;if(e){if(!e.modified_)return e.base_;e.finalized_=!0,t=pg(i,e.scope_.immer_.useStrictShallowCopy_)}else t=pg(i,!0);return _c(t,(s,r)=>{rx(t,s,ox(r))}),e&&(e.finalized_=!1),t}var As=new wM,lx=As.produce;As.produceWithPatches.bind(As);As.setAutoFreeze.bind(As);As.setUseStrictShallowCopy.bind(As);As.applyPatches.bind(As);As.createDraft.bind(As);As.finishDraft.bind(As);function kM(i,e=`expected a function, instead received ${typeof i}`){if(typeof i!="function")throw new TypeError(e)}function xM(i,e=`expected an object, instead received ${typeof i}`){if(typeof i!="object")throw new TypeError(e)}function _M(i,e="expected all items to be functions, instead received the following types: "){if(!i.every(t=>typeof t=="function")){const t=i.map(s=>typeof s=="function"?`function ${s.name||"unnamed"}()`:typeof s).join(", ");throw new TypeError(`${e}[${t}]`)}}var sb=i=>Array.isArray(i)?i:[i];function TM(i){const e=Array.isArray(i[0])?i[0]:i;return _M(e,"createSelector expects all input-selectors to be functions, but received the following types: "),e}function NM(i,e){const t=[],{length:s}=i;for(let r=0;r<s;r++)t.push(i[r].apply(null,e));return t}var BM=class{constructor(i){this.value=i}deref(){return this.value}},CM=typeof WeakRef<"u"?WeakRef:BM,PM=0,rb=1;function dh(){return{s:PM,v:void 0,o:null,p:null}}function ux(i,e={}){let t=dh();const{resultEqualityCheck:s}=e;let r,n=0;function a(){var c;let o=t;const{length:l}=arguments;for(let d=0,f=l;d<f;d++){const p=arguments[d];if(typeof p=="function"||typeof p=="object"&&p!==null){let g=o.o;g===null&&(o.o=g=new WeakMap);const b=g.get(p);b===void 0?(o=dh(),g.set(p,o)):o=b}else{let g=o.p;g===null&&(o.p=g=new Map);const b=g.get(p);b===void 0?(o=dh(),g.set(p,o)):o=b}}const u=o;let h;if(o.s===rb)h=o.v;else if(h=i.apply(null,arguments),n++,s){const d=((c=r==null?void 0:r.deref)==null?void 0:c.call(r))??r;d!=null&&s(d,h)&&(h=d,n!==0&&n--),r=typeof h=="object"&&h!==null||typeof h=="function"?new CM(h):h}return u.s=rb,u.v=h,h}return a.clearCache=()=>{t=dh(),a.resetResultsCount()},a.resultsCount=()=>n,a.resetResultsCount=()=>{n=0},a}function MM(i,...e){const t=typeof i=="function"?{memoize:i,memoizeOptions:e}:i,s=(...r)=>{let n=0,a=0,o,l={},u=r.pop();typeof u=="object"&&(l=u,u=r.pop()),kM(u,`createSelector expects an output function after the inputs, but received: [${typeof u}]`);const h={...t,...l},{memoize:c,memoizeOptions:d=[],argsMemoize:f=ux,argsMemoizeOptions:p=[],devModeChecks:g={}}=h,b=sb(d),m=sb(p),y=TM(r),w=c(function(){return n++,u.apply(null,arguments)},...b),x=f(function(){a++;const _=NM(y,arguments);return o=w.apply(null,_),o},...m);return Object.assign(x,{resultFunc:u,memoizedResultFunc:w,dependencies:y,dependencyRecomputations:()=>a,resetDependencyRecomputations:()=>{a=0},lastResult:()=>o,recomputations:()=>n,resetRecomputations:()=>{n=0},memoize:c,argsMemoize:f})};return Object.assign(s,{withTypes:()=>s}),s}var f0=MM(ux),EM=Object.assign((i,e=f0)=>{xM(i,`createStructuredSelector expects first argument to be an object where each property is a selector, instead received a ${typeof i}`);const t=Object.keys(i),s=t.map(n=>i[n]);return e(s,(...n)=>n.reduce((a,o,l)=>(a[t[l]]=o,a),{}))},{withTypes:()=>EM});function hx(i){return({dispatch:t,getState:s})=>r=>n=>typeof n=="function"?n(t,s,i):r(n)}var LM=hx(),DM=hx,AM=typeof window<"u"&&window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__?window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__:function(){if(arguments.length!==0)return typeof arguments[0]=="object"?xc:xc.apply(null,arguments)};function nb(i,e){function t(...s){if(e){let r=e(...s);if(!r)throw new Error(mr(0));return{type:i,payload:r.payload,..."meta"in r&&{meta:r.meta},..."error"in r&&{error:r.error}}}return{type:i,payload:s[0]}}return t.toString=()=>`${i}`,t.type=i,t.match=s=>cM(s)&&s.type===i,t}var cx=class gl extends Array{constructor(...e){super(...e),Object.setPrototypeOf(this,gl.prototype)}static get[Symbol.species](){return gl}concat(...e){return super.concat.apply(this,e)}prepend(...e){return e.length===1&&Array.isArray(e[0])?new gl(...e[0].concat(this)):new gl(...e.concat(this))}};function ab(i){return cn(i)?lx(i,()=>{}):i}function ob(i,e,t){if(i.has(e)){let r=i.get(e);return t.update&&(r=t.update(r,e,i),i.set(e,r)),r}if(!t.insert)throw new Error(mr(10));const s=t.insert(e,i);return i.set(e,s),s}function IM(i){return typeof i=="boolean"}var RM=()=>function(e){const{thunk:t=!0,immutableCheck:s=!0,serializableCheck:r=!0,actionCreatorCheck:n=!0}=e??{};let a=new cx;return t&&(IM(t)?a.push(LM):a.push(DM(t.extraArgument))),a},OM="RTK_autoBatch",dx=i=>e=>{setTimeout(e,i)},FM=typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame:dx(10),VM=(i={type:"raf"})=>e=>(...t)=>{const s=e(...t);let r=!0,n=!1,a=!1;const o=new Set,l=i.type==="tick"?queueMicrotask:i.type==="raf"?FM:i.type==="callback"?i.queueNotification:dx(i.timeout),u=()=>{a=!1,n&&(n=!1,o.forEach(h=>h()))};return Object.assign({},s,{subscribe(h){const c=()=>r&&h(),d=s.subscribe(c);return o.add(h),()=>{d(),o.delete(h)}},dispatch(h){var c;try{return r=!((c=h==null?void 0:h.meta)!=null&&c[OM]),n=!r,n&&(a||(a=!0,l(u))),s.dispatch(h)}finally{r=!0}}})},HM=i=>function(t){const{autoBatch:s=!0}=t??{};let r=new cx(i);return s&&r.push(VM(typeof s=="object"?s:void 0)),r};function zM(i){const e=RM(),{reducer:t=void 0,middleware:s,devTools:r=!0,preloadedState:n=void 0,enhancers:a=void 0}=i||{};let o;if(typeof t=="function")o=t;else if(h0(t))o=uM(t);else throw new Error(mr(1));let l;typeof s=="function"?l=s(e):l=e();let u=xc;r&&(u=AM({trace:!1,...typeof r=="object"&&r}));const h=hM(...l),c=HM(h);let d=typeof a=="function"?a(c):c();const f=u(...d);return tx(o,n,f)}function fx(i){const e={},t=[];let s;const r={addCase(n,a){const o=typeof n=="string"?n:n.type;if(!o)throw new Error(mr(28));if(o in e)throw new Error(mr(29));return e[o]=a,r},addMatcher(n,a){return t.push({matcher:n,reducer:a}),r},addDefaultCase(n){return s=n,r}};return i(r),[e,t,s]}function WM(i){return typeof i=="function"}function GM(i,e){let[t,s,r]=fx(e),n;if(WM(i))n=()=>ab(i());else{const o=ab(i);n=()=>o}function a(o=n(),l){let u=[t[l.type],...s.filter(({matcher:h})=>h(l)).map(({reducer:h})=>h)];return u.filter(h=>!!h).length===0&&(u=[r]),u.reduce((h,c)=>{if(c)if(Ta(h)){const f=c(h,l);return f===void 0?h:f}else{if(cn(h))return lx(h,d=>c(d,l));{const d=c(h,l);if(d===void 0){if(h===null)return h;throw new Error(mr(9))}return d}}return h},o)}return a.getInitialState=n,a}var jM=Symbol.for("rtk-slice-createasyncthunk");function UM(i,e){return`${i}/${e}`}function $M({creators:i}={}){var t;const e=(t=i==null?void 0:i.asyncThunk)==null?void 0:t[jM];return function(r){const{name:n,reducerPath:a=n}=r;if(!n)throw new Error(mr(11));typeof process<"u";const o=(typeof r.reducers=="function"?r.reducers(XM()):r.reducers)||{},l=Object.keys(o),u={sliceCaseReducersByName:{},sliceCaseReducersByType:{},actionCreators:{},sliceMatchers:[]},h={addCase(w,x){const k=typeof w=="string"?w:w.type;if(!k)throw new Error(mr(12));if(k in u.sliceCaseReducersByType)throw new Error(mr(13));return u.sliceCaseReducersByType[k]=x,h},addMatcher(w,x){return u.sliceMatchers.push({matcher:w,reducer:x}),h},exposeAction(w,x){return u.actionCreators[w]=x,h},exposeCaseReducer(w,x){return u.sliceCaseReducersByName[w]=x,h}};l.forEach(w=>{const x=o[w],k={reducerName:w,type:UM(n,w),createNotation:typeof r.reducers=="function"};JM(x)?KM(k,x,h,e):QM(k,x,h)});function c(){const[w={},x=[],k=void 0]=typeof r.extraReducers=="function"?fx(r.extraReducers):[r.extraReducers],_={...w,...u.sliceCaseReducersByType};return GM(r.initialState,T=>{for(let C in _)T.addCase(C,_[C]);for(let C of u.sliceMatchers)T.addMatcher(C.matcher,C.reducer);for(let C of x)T.addMatcher(C.matcher,C.reducer);k&&T.addDefaultCase(k)})}const d=w=>w,f=new Map;let p;function g(w,x){return p||(p=c()),p(w,x)}function b(){return p||(p=c()),p.getInitialState()}function m(w,x=!1){function k(T){let C=T[w];return typeof C>"u"&&x&&(C=b()),C}function _(T=d){const C=ob(f,x,{insert:()=>new WeakMap});return ob(C,T,{insert:()=>{const W={};for(const[z,te]of Object.entries(r.selectors??{}))W[z]=YM(te,T,b,x);return W}})}return{reducerPath:w,getSelectors:_,get selectors(){return _(k)},selectSlice:k}}const y={name:n,reducer:g,actions:u.actionCreators,caseReducers:u.sliceCaseReducersByName,getInitialState:b,...m(a),injectInto(w,{reducerPath:x,...k}={}){const _=x??a;return w.inject({reducerPath:_,reducer:g},k),{...y,...m(_,!0)}}};return y}}function YM(i,e,t,s){function r(n,...a){let o=e(n);return typeof o>"u"&&s&&(o=t()),i(o,...a)}return r.unwrapped=i,r}var Ld=$M();function XM(){function i(e,t){return{_reducerDefinitionType:"asyncThunk",payloadCreator:e,...t}}return i.withTypes=()=>i,{reducer(e){return Object.assign({[e.name](...t){return e(...t)}}[e.name],{_reducerDefinitionType:"reducer"})},preparedReducer(e,t){return{_reducerDefinitionType:"reducerWithPrepare",prepare:e,reducer:t}},asyncThunk:i}}function QM({type:i,reducerName:e,createNotation:t},s,r){let n,a;if("reducer"in s){if(t&&!qM(s))throw new Error(mr(17));n=s.reducer,a=s.prepare}else n=s;r.addCase(i,n).exposeCaseReducer(e,n).exposeAction(e,a?nb(i,a):nb(i))}function JM(i){return i._reducerDefinitionType==="asyncThunk"}function qM(i){return i._reducerDefinitionType==="reducerWithPrepare"}function KM({type:i,reducerName:e},t,s,r){if(!r)throw new Error(mr(18));const{payloadCreator:n,fulfilled:a,pending:o,rejected:l,settled:u,options:h}=t,c=r(i,n,h);s.exposeAction(e,c),a&&s.addCase(c.fulfilled,a),o&&s.addCase(c.pending,o),l&&s.addCase(c.rejected,l),u&&s.addMatcher(c.settled,u),s.exposeCaseReducer(e,{fulfilled:a||fh,pending:o||fh,rejected:l||fh,settled:u||fh})}function fh(){}function mr(i){return`Minified Redux Toolkit error #${i}; visit https://redux-toolkit.js.org/Errors?code=${i} for the full message or use the non-minified dev environment for full errors. `}function ZM(i,e){const t=[];for(;e--;t[e]=e+i);return t}function eE(i,e){const t=[];for(;e--;t[e]=i-e);return t}function tE(i,e){return i<e?ZM(i,e-i+1):eE(i,i-e+1)}function iE(i,e){const t=e.length,s=(i%t+t)%t;return e.slice(s,t).concat(e.slice(0,s))}function sE(i){return i.filter(e=>e===0||e)}function p0(i){return i!==null&&typeof i=="object"&&"name"in i&&typeof i.name=="string"}function g0(i){return i!==null&&typeof i=="object"&&"step"in i&&typeof i.step=="number"&&"alt"in i&&typeof i.alt=="number"&&!isNaN(i.step)&&!isNaN(i.alt)}var px=[0,2,4,-1,1,3,5],gx=px.map(i=>Math.floor(i*7/12));function mx(i){const{step:e,alt:t,oct:s,dir:r=1}=i,n=px[e]+7*t;if(s===void 0)return[r*n];const a=s-gx[e]-4*t;return[r*n,r*a]}var rE=[3,0,4,1,5,2,6];function yx(i){const[e,t,s]=i,r=rE[nE(e)],n=Math.floor((e+1)/7);if(t===void 0)return{step:r,alt:n,dir:s};const a=t+4*n+gx[r];return{step:r,alt:n,oct:a,dir:s}}function nE(i){const e=(i+1)%7;return e<0?7+e:e}var lb=(i,e)=>Array(Math.abs(e)+1).join(i),Sg=Object.freeze({empty:!0,name:"",num:NaN,q:"",type:"",step:NaN,alt:NaN,dir:NaN,simple:NaN,semitones:NaN,chroma:NaN,coord:[],oct:NaN}),aE="([-+]?\\d+)(d{1,4}|m|M|P|A{1,4})",oE="(AA|A|P|M|m|d|dd)([-+]?\\d+)",lE=new RegExp("^"+aE+"|"+oE+"$");function uE(i){const e=lE.exec(`${i}`);return e===null?["",""]:e[1]?[e[1],e[2]]:[e[4],e[3]]}var ub={};function dn(i){return typeof i=="string"?ub[i]||(ub[i]=hE(i)):g0(i)?dn(dE(i)):p0(i)?dn(i.name):Sg}var hb=[0,2,4,5,7,9,11],bx="PMMPPMM";function hE(i){const e=uE(i);if(e[0]==="")return Sg;const t=+e[0],s=e[1],r=(Math.abs(t)-1)%7,n=bx[r];if(n==="M"&&s==="P")return Sg;const a=n==="M"?"majorable":"perfectable",o=""+t+s,l=t<0?-1:1,u=t===8||t===-8?t:l*(r+1),h=cE(a,s),c=Math.floor((Math.abs(t)-1)/7),d=l*(hb[r]+h+12*c),f=(l*(hb[r]+h)%12+12)%12,p=mx({step:r,alt:h,oct:c,dir:l});return{empty:!1,name:o,num:t,q:s,step:r,alt:h,dir:l,type:a,simple:u,semitones:d,chroma:f,coord:p,oct:c}}function Sx(i,e){const[t,s=0]=i,r=t*7+s*12<0,n=e||r?[-t,-s,-1]:[t,s,1];return dn(yx(n))}function cE(i,e){return e==="M"&&i==="majorable"||e==="P"&&i==="perfectable"?0:e==="m"&&i==="majorable"?-1:/^A+$/.test(e)?e.length:/^d+$/.test(e)?-1*(i==="perfectable"?e.length:e.length+1):0}function dE(i){const{step:e,alt:t,oct:s=0,dir:r}=i;if(!r)return"";const n=e+1+7*s,a=n===0?e+1:n,o=r<0?"-":"",l=bx[e]==="M"?"majorable":"perfectable";return o+a+fE(l,t)}function fE(i,e){return e===0?i==="majorable"?"M":"P":e===-1&&i==="majorable"?"m":e>0?lb("A",e):lb("d",i==="perfectable"?e:e+1)}var cb=(i,e)=>Array(Math.abs(e)+1).join(i),wx=Object.freeze({empty:!0,name:"",letter:"",acc:"",pc:"",step:NaN,alt:NaN,chroma:NaN,height:NaN,coord:[],midi:null,freq:null}),db=new Map,pE=i=>"CDEFGAB".charAt(i),m0=i=>i<0?cb("b",-i):cb("#",i),vx=i=>i[0]==="b"?-i.length:i.length;function Di(i){const e=JSON.stringify(i),t=db.get(e);if(t)return t;const s=typeof i=="string"?bE(i):g0(i)?Di(SE(i)):p0(i)?Di(i.name):wx;return db.set(e,s),s}var gE=/^([a-gA-G]?)(#{1,}|b{1,}|x{1,}|)(-?\d*)\s*(.*)$/;function y0(i){const e=gE.exec(i);return e?[e[1].toUpperCase(),e[2].replace(/x/g,"##"),e[3],e[4]]:["","","",""]}function mE(i){return Di(yx(i))}var yE=(i,e)=>(i%e+e)%e,Cf=[0,2,4,5,7,9,11];function bE(i){const e=y0(i);if(e[0]===""||e[3]!=="")return wx;const t=e[0],s=e[1],r=e[2],n=(t.charCodeAt(0)+3)%7,a=vx(s),o=r.length?+r:void 0,l=mx({step:n,alt:a,oct:o}),u=t+s+r,h=t+s,c=(Cf[n]+a+120)%12,d=o===void 0?yE(Cf[n]+a,12)-12*99:Cf[n]+a+12*(o+1),f=d>=0&&d<=127?d:null,p=o===void 0?null:Math.pow(2,(d-69)/12)*440;return{empty:!1,acc:s,alt:a,chroma:c,coord:l,freq:p,height:d,letter:t,midi:f,name:u,oct:o,pc:h,step:n}}function SE(i){const{step:e,alt:t,oct:s}=i,r=pE(e);if(!r)return"";const n=r+m0(t);return s||s===0?n+s:n}function b0(i,e){const t=Di(i),s=Array.isArray(e)?e:dn(e).coord;if(t.empty||!s||s.length<2)return"";const r=t.coord,n=r.length===1?[r[0]+s[0]]:[r[0]+s[0],r[1]+s[1]];return mE(n).name}function wg(i,e){const t=Di(i),s=Di(e);if(t.empty||s.empty)return"";const r=t.coord,n=s.coord,a=n[0]-r[0],o=r.length===2&&n.length===2?n[1]-r[1]:-Math.floor(a*7/12),l=s.height===t.height&&s.midi!==null&&t.oct===s.oct&&t.step>s.step;return Sx([a,o],l).name}var Io={empty:!0,name:"",setNum:0,chroma:"000000000000",normalized:"000000000000",intervals:[]},kx=i=>Number(i).toString(2).padStart(12,"0"),fb=i=>parseInt(i,2),wE=/^[01]{12}$/;function xx(i){return wE.test(i)}var vE=i=>typeof i=="number"&&i>=0&&i<=4095,kE=i=>i&&xx(i.chroma),pb={[Io.chroma]:Io};function _x(i){const e=xx(i)?i:vE(i)?kx(i):Array.isArray(i)?BE(i):kE(i)?i.chroma:Io.chroma;return pb[e]=pb[e]||NE(e)}var xE=["1P","2m","2M","3m","3M","4P","5d","5P","6m","6M","7m","7M"];function _E(i){const e=[];for(let t=0;t<12;t++)i.charAt(t)==="1"&&e.push(xE[t]);return e}function TE(i){const e=i.split("");return e.map((t,s)=>iE(s,e).join(""))}function NE(i){const e=fb(i),t=TE(i).map(fb).filter(n=>n>=2048).sort()[0],s=kx(t),r=_E(i);return{empty:!1,name:"",setNum:e,chroma:i,normalized:s,intervals:r}}function BE(i){if(i.length===0)return Io.chroma;let e;const t=[0,0,0,0,0,0,0,0,0,0,0,0];for(let s=0;s<i.length;s++)e=Di(i[s]),e.empty&&(e=dn(i[s])),e.empty||(t[e.chroma]=1);return t.join("")}var CE=[["1P 3M 5P","major","M ^  maj"],["1P 3M 5P 7M","major seventh","maj7 Δ ma7 M7 Maj7 ^7"],["1P 3M 5P 7M 9M","major ninth","maj9 Δ9 ^9"],["1P 3M 5P 7M 9M 13M","major thirteenth","maj13 Maj13 ^13"],["1P 3M 5P 6M","sixth","6 add6 add13 M6"],["1P 3M 5P 6M 9M","sixth added ninth","6add9 6/9 69 M69"],["1P 3M 6m 7M","major seventh flat sixth","M7b6 ^7b6"],["1P 3M 5P 7M 11A","major seventh sharp eleventh","maj#4 Δ#4 Δ#11 M7#11 ^7#11 maj7#11"],["1P 3m 5P","minor","m min -"],["1P 3m 5P 7m","minor seventh","m7 min7 mi7 -7"],["1P 3m 5P 7M","minor/major seventh","m/ma7 m/maj7 mM7 mMaj7 m/M7 -Δ7 mΔ -^7 -maj7"],["1P 3m 5P 6M","minor sixth","m6 -6"],["1P 3m 5P 7m 9M","minor ninth","m9 -9"],["1P 3m 5P 7M 9M","minor/major ninth","mM9 mMaj9 -^9"],["1P 3m 5P 7m 9M 11P","minor eleventh","m11 -11"],["1P 3m 5P 7m 9M 13M","minor thirteenth","m13 -13"],["1P 3m 5d","diminished","dim ° o"],["1P 3m 5d 7d","diminished seventh","dim7 °7 o7"],["1P 3m 5d 7m","half-diminished","m7b5 ø -7b5 h7 h"],["1P 3M 5P 7m","dominant seventh","7 dom"],["1P 3M 5P 7m 9M","dominant ninth","9"],["1P 3M 5P 7m 9M 13M","dominant thirteenth","13"],["1P 3M 5P 7m 11A","lydian dominant seventh","7#11 7#4"],["1P 3M 5P 7m 9m","dominant flat ninth","7b9"],["1P 3M 5P 7m 9A","dominant sharp ninth","7#9"],["1P 3M 7m 9m","altered","alt7"],["1P 4P 5P","suspended fourth","sus4 sus"],["1P 2M 5P","suspended second","sus2"],["1P 4P 5P 7m","suspended fourth seventh","7sus4 7sus"],["1P 5P 7m 9M 11P","eleventh","11"],["1P 4P 5P 7m 9m","suspended fourth flat ninth","b9sus phryg 7b9sus 7b9sus4"],["1P 5P","fifth","5"],["1P 3M 5A","augmented","aug + +5 ^#5"],["1P 3m 5A","minor augmented","m#5 -#5 m+"],["1P 3M 5A 7M","augmented seventh","maj7#5 maj7+5 +maj7 ^7#5"],["1P 3M 5P 7M 9M 11A","major sharp eleventh (lydian)","maj9#11 Δ9#11 ^9#11"],["1P 2M 4P 5P","","sus24 sus4add9"],["1P 3M 5A 7M 9M","","maj9#5 Maj9#5"],["1P 3M 5A 7m","","7#5 +7 7+ 7aug aug7"],["1P 3M 5A 7m 9A","","7#5#9 7#9#5 7alt"],["1P 3M 5A 7m 9M","","9#5 9+"],["1P 3M 5A 7m 9M 11A","","9#5#11"],["1P 3M 5A 7m 9m","","7#5b9 7b9#5"],["1P 3M 5A 7m 9m 11A","","7#5b9#11"],["1P 3M 5A 9A","","+add#9"],["1P 3M 5A 9M","","M#5add9 +add9"],["1P 3M 5P 6M 11A","","M6#11 M6b5 6#11 6b5"],["1P 3M 5P 6M 7M 9M","","M7add13"],["1P 3M 5P 6M 9M 11A","","69#11"],["1P 3m 5P 6M 9M","","m69 -69"],["1P 3M 5P 6m 7m","","7b6"],["1P 3M 5P 7M 9A 11A","","maj7#9#11"],["1P 3M 5P 7M 9M 11A 13M","","M13#11 maj13#11 M13+4 M13#4"],["1P 3M 5P 7M 9m","","M7b9"],["1P 3M 5P 7m 11A 13m","","7#11b13 7b5b13"],["1P 3M 5P 7m 13M","","7add6 67 7add13"],["1P 3M 5P 7m 9A 11A","","7#9#11 7b5#9 7#9b5"],["1P 3M 5P 7m 9A 11A 13M","","13#9#11"],["1P 3M 5P 7m 9A 11A 13m","","7#9#11b13"],["1P 3M 5P 7m 9A 13M","","13#9"],["1P 3M 5P 7m 9A 13m","","7#9b13"],["1P 3M 5P 7m 9M 11A","","9#11 9+4 9#4"],["1P 3M 5P 7m 9M 11A 13M","","13#11 13+4 13#4"],["1P 3M 5P 7m 9M 11A 13m","","9#11b13 9b5b13"],["1P 3M 5P 7m 9m 11A","","7b9#11 7b5b9 7b9b5"],["1P 3M 5P 7m 9m 11A 13M","","13b9#11"],["1P 3M 5P 7m 9m 11A 13m","","7b9b13#11 7b9#11b13 7b5b9b13"],["1P 3M 5P 7m 9m 13M","","13b9"],["1P 3M 5P 7m 9m 13m","","7b9b13"],["1P 3M 5P 7m 9m 9A","","7b9#9"],["1P 3M 5P 9M","","Madd9 2 add9 add2"],["1P 3M 5P 9m","","Maddb9"],["1P 3M 5d","","Mb5"],["1P 3M 5d 6M 7m 9M","","13b5"],["1P 3M 5d 7M","","M7b5"],["1P 3M 5d 7M 9M","","M9b5"],["1P 3M 5d 7m","","7b5"],["1P 3M 5d 7m 9M","","9b5"],["1P 3M 7m","","7no5"],["1P 3M 7m 13m","","7b13"],["1P 3M 7m 9M","","9no5"],["1P 3M 7m 9M 13M","","13no5"],["1P 3M 7m 9M 13m","","9b13"],["1P 3m 4P 5P","","madd4"],["1P 3m 5P 6m 7M","","mMaj7b6"],["1P 3m 5P 6m 7M 9M","","mMaj9b6"],["1P 3m 5P 7m 11P","","m7add11 m7add4"],["1P 3m 5P 9M","","madd9"],["1P 3m 5d 6M 7M","","o7M7"],["1P 3m 5d 7M","","oM7"],["1P 3m 6m 7M","","mb6M7"],["1P 3m 6m 7m","","m7#5"],["1P 3m 6m 7m 9M","","m9#5"],["1P 3m 5A 7m 9M 11P","","m11A"],["1P 3m 6m 9m","","mb6b9"],["1P 2M 3m 5d 7m","","m9b5"],["1P 4P 5A 7M","","M7#5sus4"],["1P 4P 5A 7M 9M","","M9#5sus4"],["1P 4P 5A 7m","","7#5sus4"],["1P 4P 5P 7M","","M7sus4"],["1P 4P 5P 7M 9M","","M9sus4"],["1P 4P 5P 7m 9M","","9sus4 9sus"],["1P 4P 5P 7m 9M 13M","","13sus4 13sus"],["1P 4P 5P 7m 9m 13m","","7sus4b9b13 7b9b13sus4"],["1P 4P 7m 10m","","4 quartal"],["1P 5P 7m 9m 11P","","11b9"]],PE=CE,ME={...Io,name:"",quality:"Unknown",intervals:[],aliases:[]},Tx=[],Pl={};function EE(i){return Pl[i]||ME}function LE(i,e,t){const s=AE(i),r={..._x(i),name:t||"",quality:s,intervals:i,aliases:e};Tx.push(r),r.name&&(Pl[r.name]=r),Pl[r.setNum]=r,Pl[r.chroma]=r,r.aliases.forEach(n=>DE(r,n))}function DE(i,e){Pl[e]=i}function AE(i){const e=t=>i.indexOf(t)!==-1;return e("5A")?"Augmented":e("3M")?"Major":e("5d")?"Diminished":e("3m")?"Minor":"Unknown"}PE.forEach(([i,e,t])=>LE(i.split(" "),t.split(" "),e));Tx.sort((i,e)=>i.setNum-e.setNum);function IE(i){return+i>=0&&+i<=127}function RE(i){if(IE(i))return+i;const e=Di(i);return e.empty?null:e.midi}var OE="C C# D D# E F F# G G# A A# B".split(" "),FE="C Db D Eb E F Gb G Ab A Bb B".split(" ");function S0(i,e={}){if(isNaN(i)||i===-1/0||i===1/0)return"";i=Math.round(i);const s=(e.sharps===!0?OE:FE)[i%12];if(e.pitchClass)return s;const r=Math.floor(i/12)-1;return s+r}var fn=Di,Ba=i=>fn(i).pc,VE=i=>fn(i).oct,Bc=i=>fn(i).midi;function HE(i){return S0(i)}var Ro=wg,_o=b0;function Oa(i,e){const t=fn(i);if(t.empty)return"";const s=fn(e||S0(t.midi||t.chroma,{sharps:t.alt<0,pitchClass:!0}));if(s.empty||s.chroma!==t.chroma)return"";if(t.oct===void 0)return s.pc;const r=t.chroma-t.alt,n=s.chroma-s.alt,a=r>11||n<0?-1:r<0||n>11?1:0,o=t.oct+a;return s.pc+o}var zE=[["1P 2M 3M 5P 6M","major pentatonic","pentatonic"],["1P 2M 3M 4P 5P 6M 7M","major","ionian"],["1P 2M 3m 4P 5P 6m 7m","minor","aeolian"],["1P 2M 3m 3M 5P 6M","major blues"],["1P 3m 4P 5d 5P 7m","minor blues","blues"],["1P 2M 3m 4P 5P 6M 7M","melodic minor"],["1P 2M 3m 4P 5P 6m 7M","harmonic minor"],["1P 2M 3M 4P 5P 6M 7m 7M","bebop"],["1P 2M 3m 4P 5d 6m 6M 7M","diminished","whole-half diminished"],["1P 2M 3m 4P 5P 6M 7m","dorian"],["1P 2M 3M 4A 5P 6M 7M","lydian"],["1P 2M 3M 4P 5P 6M 7m","mixolydian","dominant"],["1P 2m 3m 4P 5P 6m 7m","phrygian"],["1P 2m 3m 4P 5d 6m 7m","locrian"],["1P 3M 4P 5P 7M","ionian pentatonic"],["1P 3M 4P 5P 7m","mixolydian pentatonic","indian"],["1P 2M 4P 5P 6M","ritusen"],["1P 2M 4P 5P 7m","egyptian"],["1P 3M 4P 5d 7m","neopolitan major pentatonic"],["1P 3m 4P 5P 6m","vietnamese 1"],["1P 2m 3m 5P 6m","pelog"],["1P 2m 4P 5P 6m","kumoijoshi"],["1P 2M 3m 5P 6m","hirajoshi"],["1P 2m 4P 5d 7m","iwato"],["1P 2m 4P 5P 7m","in-sen"],["1P 3M 4A 5P 7M","lydian pentatonic","chinese"],["1P 3m 4P 6m 7m","malkos raga"],["1P 3m 4P 5d 7m","locrian pentatonic","minor seven flat five pentatonic"],["1P 3m 4P 5P 7m","minor pentatonic","vietnamese 2"],["1P 3m 4P 5P 6M","minor six pentatonic"],["1P 2M 3m 5P 6M","flat three pentatonic","kumoi"],["1P 2M 3M 5P 6m","flat six pentatonic"],["1P 2m 3M 5P 6M","scriabin"],["1P 3M 5d 6m 7m","whole tone pentatonic"],["1P 3M 4A 5A 7M","lydian #5P pentatonic"],["1P 3M 4A 5P 7m","lydian dominant pentatonic"],["1P 3m 4P 5P 7M","minor #7M pentatonic"],["1P 3m 4d 5d 7m","super locrian pentatonic"],["1P 2M 3m 4P 5P 7M","minor hexatonic"],["1P 2A 3M 5P 5A 7M","augmented"],["1P 2M 4P 5P 6M 7m","piongio"],["1P 2m 3M 4A 6M 7m","prometheus neopolitan"],["1P 2M 3M 4A 6M 7m","prometheus"],["1P 2m 3M 5d 6m 7m","mystery #1"],["1P 2m 3M 4P 5A 6M","six tone symmetric"],["1P 2M 3M 4A 5A 6A","whole tone","messiaen's mode #1"],["1P 2m 4P 4A 5P 7M","messiaen's mode #5"],["1P 2M 3M 4P 5d 6m 7m","locrian major","arabian"],["1P 2m 3M 4A 5P 6m 7M","double harmonic lydian"],["1P 2m 2A 3M 4A 6m 7m","altered","super locrian","diminished whole tone","pomeroy"],["1P 2M 3m 4P 5d 6m 7m","locrian #2","half-diminished","aeolian b5"],["1P 2M 3M 4P 5P 6m 7m","mixolydian b6","melodic minor fifth mode","hindu"],["1P 2M 3M 4A 5P 6M 7m","lydian dominant","lydian b7","overtone"],["1P 2M 3M 4A 5A 6M 7M","lydian augmented"],["1P 2m 3m 4P 5P 6M 7m","dorian b2","phrygian #6","melodic minor second mode"],["1P 2m 3m 4d 5d 6m 7d","ultralocrian","superlocrian bb7","superlocrian diminished"],["1P 2m 3m 4P 5d 6M 7m","locrian 6","locrian natural 6","locrian sharp 6"],["1P 2A 3M 4P 5P 5A 7M","augmented heptatonic"],["1P 2M 3m 4A 5P 6M 7m","dorian #4","ukrainian dorian","romanian minor","altered dorian"],["1P 2M 3m 4A 5P 6M 7M","lydian diminished"],["1P 2M 3M 4A 5A 7m 7M","leading whole tone"],["1P 2M 3M 4A 5P 6m 7m","lydian minor"],["1P 2m 3M 4P 5P 6m 7m","phrygian dominant","spanish","phrygian major"],["1P 2m 3m 4P 5P 6m 7M","balinese"],["1P 2m 3m 4P 5P 6M 7M","neopolitan major"],["1P 2M 3M 4P 5P 6m 7M","harmonic major"],["1P 2m 3M 4P 5P 6m 7M","double harmonic major","gypsy"],["1P 2M 3m 4A 5P 6m 7M","hungarian minor"],["1P 2A 3M 4A 5P 6M 7m","hungarian major"],["1P 2m 3M 4P 5d 6M 7m","oriental"],["1P 2m 3m 3M 4A 5P 7m","flamenco"],["1P 2m 3m 4A 5P 6m 7M","todi raga"],["1P 2m 3M 4P 5d 6m 7M","persian"],["1P 2m 3M 5d 6m 7m 7M","enigmatic"],["1P 2M 3M 4P 5A 6M 7M","major augmented","major #5","ionian augmented","ionian #5"],["1P 2A 3M 4A 5P 6M 7M","lydian #9"],["1P 2m 2M 4P 4A 5P 6m 7M","messiaen's mode #4"],["1P 2m 3M 4P 4A 5P 6m 7M","purvi raga"],["1P 2m 3m 3M 4P 5P 6m 7m","spanish heptatonic"],["1P 2M 3m 3M 4P 5P 6M 7m","bebop minor"],["1P 2M 3M 4P 5P 5A 6M 7M","bebop major"],["1P 2m 3m 4P 5d 5P 6m 7m","bebop locrian"],["1P 2M 3m 4P 5P 6m 7m 7M","minor bebop"],["1P 2M 3M 4P 5d 5P 6M 7M","ichikosucho"],["1P 2M 3m 4P 5P 6m 6M 7M","minor six diminished"],["1P 2m 3m 3M 4A 5P 6M 7m","half-whole diminished","dominant diminished","messiaen's mode #2"],["1P 3m 3M 4P 5P 6M 7m 7M","kafi raga"],["1P 2M 3M 4P 4A 5A 6A 7M","messiaen's mode #6"],["1P 2M 3m 3M 4P 5d 5P 6M 7m","composite blues"],["1P 2M 3m 3M 4A 5P 6m 7m 7M","messiaen's mode #3"],["1P 2m 2M 3m 4P 4A 5P 6m 6M 7M","messiaen's mode #7"],["1P 2m 2M 3m 3M 4P 5d 5P 6m 6M 7m 7M","chromatic"]],WE=zE,GE={...Io,intervals:[],aliases:[]},Ml={};function jE(i){return Ml[i]||GE}function UE(i,e,t=[]){const s={..._x(i),name:e,intervals:i,aliases:t};return Ml[s.name]=s,Ml[s.setNum]=s,Ml[s.chroma]=s,s.aliases.forEach(r=>$E(s,r)),s}function $E(i,e){Ml[e]=i}WE.forEach(([i,e,...t])=>UE(i.split(" "),e,t));var YE={empty:!0,name:"",type:"",tonic:null,setNum:NaN,chroma:"",normalized:"",aliases:[],notes:[],intervals:[]};function XE(i){if(typeof i!="string")return["",""];const e=i.indexOf(" "),t=Di(i.substring(0,e));if(t.empty){const r=Di(i);return r.empty?["",i]:[r.name,""]}const s=i.substring(t.name.length+1).toLowerCase();return[t.name,s.length?s:""]}function Eu(i){const e=Array.isArray(i)?i:XE(i),t=Di(e[0]).name,s=jE(e[1]);if(s.empty)return YE;const r=s.name,n=t?s.intervals.map(o=>b0(t,o)):[],a=t?t+" "+r:r;return{...s,name:a,type:r,tonic:t,notes:n}}function QE(i){const e=sE(i.map(t=>typeof t=="number"?t:RE(t)));return!i.length||e.length!==i.length?[]:e.reduce((t,s)=>{const r=t[t.length-1];return t.concat(tE(r,s).slice(1))},[e[0]])}function Lu(i,e){return QE(i).map(t=>S0(t,e))}const JE=Lu(["E2","E5"],{sharps:!0});Lu(["B1","E5"],{sharps:!0});Lu(["E1","G3"],{sharps:!0});Lu(["B0","G3"],{sharps:!0});var Fr=(i=>(i.Hungarian="hu",i.English="en",i))(Fr||{}),Oo=i=>dn(i).semitones,qE=[1,2,2,3,3,4,5,5,6,6,7,7],KE="P m M m M P d P m M m M".split(" ");function ZE(i){const e=i<0?-1:1,t=Math.abs(i),s=t%12,r=Math.floor(t/12);return e*(qE[s]+7*r)+KE[s]}var eL=tL((i,e)=>[i[0]-e[0],i[1]-e[1]]);function tL(i){return(e,t)=>{const s=dn(e).coord,r=dn(t).coord;if(s&&r){const n=i(s,r);return Sx(n).name}}}var Nx={empty:!0,name:"",symbol:"",root:"",bass:"",rootDegree:0,type:"",tonic:null,setNum:NaN,quality:"Unknown",chroma:"",normalized:"",aliases:[],notes:[],intervals:[]};function iL(i){const[e,t,s,r]=y0(i);return e===""?Pf("",i):e==="A"&&r==="ug"?Pf("","aug"):Pf(e+t,s+r)}function Pf(i,e){const t=e.split("/");if(t.length===1)return[i,t[0],""];const[s,r,n,a]=y0(t[1]);return s!==""&&n===""&&a===""?[i,t[0],s+r]:[i,e,""]}function vg(i){if(Array.isArray(i))return Mf(i[1]||"",i[0],i[2]);if(i==="")return Nx;{const[e,t,s]=iL(i),r=Mf(t,e,s);return r.empty?Mf(i):r}}function Mf(i,e,t){const s=EE(i),r=Di(e||""),n=Di(t||"");if(s.empty||e&&r.empty||t&&n.empty)return Nx;const a=wg(r.pc,n.pc),o=s.intervals.indexOf(a),l=o>=0,u=l?n:Di(""),h=o===-1?NaN:o+1,c=n.pc&&n.pc!==r.pc,d=Array.from(s.intervals);if(l)for(let b=1;b<h;b++){const m=d[0][0],y=d[0][1],w=parseInt(m,10)+7;d.push(`${w}${y}`),d.shift()}else if(c){const b=eL(wg(r.pc,n.pc),"8P");b&&d.unshift(b)}const f=r.empty?[]:d.map(b=>b0(r.pc,b));i=s.aliases.indexOf(i)!==-1?i:s.aliases[0];const p=`${r.empty?"":r.pc}${i}${l&&h>1?"/"+u.pc:c?"/"+n.pc:""}`,g=`${e?r.pc+" ":""}${s.name}${l&&h>1?" over "+u.pc:c?" over "+n.pc:""}`;return{...s,name:g,symbol:p,tonic:r.pc,type:s.name,root:u.pc,bass:c?n.pc:"",intervals:d,rootDegree:h,notes:f}}function ee(i){return i==null}function Et(){}function Ca(i){return i!=null}function Bx(i){switch(i.length){case 0:return i;case 1:return i.toUpperCase();default:return i[0].toUpperCase()+i.slice(1)}}function ru(i){return i[Math.floor(Math.random()*i.length)]}function sL(i,e){const t=[];for(let s=0,r=i.length;s<r;s+=e)t.push(i.slice(s,s+e));return t}const rL={[j.C_MAJOR_A_MINOR]:"C major",[j.G_MAJOR_E_MINOR_1_SHARP]:"G major",[j.D_MAJOR_B_MINOR_2_SHARPS]:"D major",[j.A_MAJOR_F_SHARP_MINOR_3_SHARPS]:"A major",[j.E_MAJOR_C_SHARP_MINOR_4_SHARPS]:"E major",[j.B_MAJOR_G_SHARP_MINOR_5_SHARPS]:"B major",[j.F_SHARP_MAJOR_D_SHARP_MINOR_6_SHARPS]:"F# major",[j.C_SHARP_MAJOR_A_SHARP_MINOR_7_SHARPS]:"C# major",[j.F_MAJOR_D_MINOR_1_FLAT]:"F major",[j.Bb_MAJOR_G_MINOR_2_FLATS]:"Bb major",[j.Eb_MAJOR_C_MINOR_3_FLATS]:"Eb major",[j.Ab_MAJOR_F_MINOR_4_FLATS]:"Ab major",[j.Db_MAJOR_Bb_MINOR_5_FLATS]:"Db major",[j.Gb_MAJOR_Eb_MINOR_6_FLATS]:"Gb major",[j.Cb_MAJOR_Ab_MINOR_7_FLATS]:"Cb major"};function nL(i,e,t){const s=rL[i],r=Eu(s).notes,n=Bc(e),a=Bc(t);if(ee(n)||ee(a))throw new Error("Invalid low or high note");const o=[];for(let l=n;l<=a;l++){const u=HE(l),h=Ba(u),c=Oa(u),d=Ba(c);r.includes(h)&&o.push(u),c!==u&&r.includes(d)&&o.push(c)}return o}function aL(i,e){if(i===e)return!0;if(i==null||e==null||i.length!==e.length)return!1;for(let t=0;t<i.length;++t)if(i[t]!==e[t])return!1;return!0}function Cc(i){const e=i.reduce((r,n)=>r+n.weight,0),t=Math.random()*e;let s=0;for(const{value:r,weight:n}of i)if(s+=n,t<s)return r;throw new Error("Should never reach here if input is valid")}function w0(i,e){const t=Bc(i)??1/0,s=Bc(e)??1/0;return t-s}function Fo(i,e){const{chroma:t}=fn(i),{chroma:s}=fn(e);return t===s}function oL(i){return e=>!i(e)}function Dd(i){switch(i){case ne.DOTTED_WHOLE:case ne.DOTTED_HALF:case ne.DOTTED_QUARTER:case ne.DOTTED_EIGHT:case ne.DOTTED_SIXTEENTH:return!0;default:return!1}}function lL(i,e){switch(i){case"B":return e===Fr.Hungarian?"H":"B";case"Bb":return e===Fr.Hungarian?"B":"Bb";default:return i}}function qi(i,e){return lL(i,e).replace("#","♯").replace("b","♭")}function Cx(i,e){const{tonic:t,aliases:[s]}=vg(i);if(ee(t)||ee(s))throw new Error(`Invalid chord ${i}, it's tonic was identified as  ${t} by tonal.`);const r=s==="M"?"":s;return`${qi(t,e)}${r}`}function uL(i){switch(i){case j.C_MAJOR_A_MINOR:case j.G_MAJOR_E_MINOR_1_SHARP:case j.D_MAJOR_B_MINOR_2_SHARPS:case j.A_MAJOR_F_SHARP_MINOR_3_SHARPS:case j.E_MAJOR_C_SHARP_MINOR_4_SHARPS:case j.B_MAJOR_G_SHARP_MINOR_5_SHARPS:case j.F_SHARP_MAJOR_D_SHARP_MINOR_6_SHARPS:case j.C_SHARP_MAJOR_A_SHARP_MINOR_7_SHARPS:return"#";case j.F_MAJOR_D_MINOR_1_FLAT:case j.Bb_MAJOR_G_MINOR_2_FLATS:case j.Eb_MAJOR_C_MINOR_3_FLATS:case j.Ab_MAJOR_F_MINOR_4_FLATS:case j.Db_MAJOR_Bb_MINOR_5_FLATS:case j.Gb_MAJOR_Eb_MINOR_6_FLATS:case j.Cb_MAJOR_Ab_MINOR_7_FLATS:return"b"}}var Mn=(i=>(i.BASICS="basics",i.RHYTHMS="rhythms",i.RESTS="rests",i.NOTES="notes",i.CHORDS="chords",i.SHARE="share",i))(Mn||{}),Pc=(i=>(i.TREBLE_CLEF="treble-clef",i.BASS_CLEF="bass-clef",i.SOPRANO_CLEF="soprano-clef",i))(Pc||{});const hL=Eu("C major").notes,cL=JE.filter(i=>hL.some(e=>Fo(e,i))),Pa={player:{isLooping:!1,isCountingIn:!1,metronomeVolume:.25,instrumentVolume:.5,chordsVolume:.25},generator:{bars:4,tempo:60,timeStamp:0,showChordsStaff:!1,useSeventhChords:!1,showChordSymbols:!1,clef:ot.TREBLE,timeSignature:{upper:4,lower:4},keySignature:j.C_MAJOR_A_MINOR,noteDurations:{[ne.HALF]:{cluster:1,frequency:Bt.INFREQUENT},[ne.QUARTER]:{cluster:1,frequency:Bt.MODERATE},[ne.EIGHTH]:{cluster:2,frequency:Bt.INFREQUENT}},restDurations:{[ne.QUARTER]:{cluster:1,frequency:Bt.INFREQUENT},[ne.HALF]:{cluster:1,frequency:Bt.INFREQUENT}},notes:cL},pages:{settings:Mn.BASICS,help:Pc.TREBLE_CLEF},language:null},kg=Ld({name:"player",initialState:Pa.player,reducers:{setPlayerConfig:(i,{payload:e})=>e}}),Vr=Ld({name:"generator",initialState:Pa.generator,reducers:{setGeneratorConfig:(i,{payload:e})=>e}}),nu=Ld({name:"pages",initialState:Pa.pages,reducers:{setHelpPage:(i,{payload:e})=>({...i,help:e}),setSettingsPage:(i,{payload:e})=>({...i,settings:e})},selectors:{selectHelpPage:i=>i.help,selectSettingsPage:i=>i.settings}}),xg=Ld({name:"language",initialState:Pa.language,reducers:{setLanguage:(i,{payload:e})=>e}}),Px="sheet-app-data";function dL(i){try{localStorage.setItem(Px,JSON.stringify(i))}catch(e){console.error("Could not save state",e)}}function fL(){try{const i=localStorage.getItem(Px);return i===null?Pa:JSON.parse(i)}catch(i){return console.error("Could not load state",i),Pa}}const pL=i=>e=>t=>{const s=e(t);return dL(i.getState()),s},Mx=zM({reducer:{player:kg.reducer,pages:nu.reducer,generator:Vr.reducer,language:xg.reducer},middleware:i=>i().concat(pL),preloadedState:fL()});Ui.init({interpolation:{escapeValue:!1},debug:!0,lng:Mx.getState().language??window.navigator.language,fallbackLng:"en",resources:{en:{translation:qP},hu:{translation:nM}},react:{transSupportBasicHtmlNodes:!0,transKeepBasicHtmlNodesFor:["br","strong","i"]}});const Wh=Ui,Xn="screen and (pointer: coarse) and (hover: none)",Du=()=>{const[i,e]=P.useState(Ex());return P.useLayoutEffect(()=>{const t=matchMedia(Xn);e(t.matches);const s=r=>{e(r.matches)};return t.addEventListener("change",s),()=>{t.removeEventListener("change",s)}},[]),i};function Ex(){return matchMedia(Xn).matches}const gL=Nd`
  @font-face {
    font-family: 'Bravura';
    src: url('font/Bravura.eot');
    src: url('font/Bravura.woff') format('woff'),
      url('font/Bravura.otf') format('opentype');
  }

  html {
    // Base font size
    font-size: 16px;

    @media ${Xn} {
      font-size: 24px;
    }
  }

  #root {
    width: 100vw;
    height: 100vh;
    @supports (height: 100dvh) {
      height: min(100vh, 100dvh);
    }
  }
  #modal {
    /* No styling for now */
  }
  #tooltip {
    position: fixed;
    top: 0px;
    left: 0px;
    width: 100vw;
    height: 100vh;
    pointer-events: none;
  }

  *,
  *::before,
  *::after {
    box-sizing: border-box;
    margin: 0px;
    padding: 0px;
  }

  div,
  span {
    font-family: 'Poppins', sans-serif;
  }

  body {
    -webkit-font-smoothing: antialiased;
    background-color: #ebebeb;
    height: 100vh;
    width: 100vw;

    @supports (height: 100dvh) {
      height: min(100vh, 100dvh);
    }

    @media ${Xn} {
      background-color: #f0f0f0;
    }
  }

  img,
  picture,
  video,
  canvas,
  svg {
    display: block;
    max-width: 100%;
  }

  input,
  button,
  textarea,
  select {
    font: inherit;
  }

  p,
  h1,
  h2,
  h3,
  h4,
  h5,
  h6 {
    overflow-wrap: break-word;
  }

  a:-webkit-any-link {
    text-decoration: none;
  }

  a {
    text-decoration: none !important;
  }

  /** Alphatab stuff */
  .at-cursor-bar {
    /* Defines the color of the bar background when a bar is played */
    background: transparent;
  }
  .at-selection div {
    /* Defines the color of the selection background */
    background: #00000020;
  }
  .at-cursor-beat {
    /* Defines the beat cursor */
    background: #cb1600bb;
    width: 3px;
  }
  .at-highlight * {
    /* Defines the color of the music symbols when played (svg) */
  }
  .at-surface > div:last-child {
    display: none !important;
  }
`;var Lx={exports:{}},Dx={};/**
 * @license React
 * use-sync-external-store-with-selector.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Au=P;function mL(i,e){return i===e&&(i!==0||1/i===1/e)||i!==i&&e!==e}var yL=typeof Object.is=="function"?Object.is:mL,bL=Au.useSyncExternalStore,SL=Au.useRef,wL=Au.useEffect,vL=Au.useMemo,kL=Au.useDebugValue;Dx.useSyncExternalStoreWithSelector=function(i,e,t,s,r){var n=SL(null);if(n.current===null){var a={hasValue:!1,value:null};n.current=a}else a=n.current;n=vL(function(){function l(f){if(!u){if(u=!0,h=f,f=s(f),r!==void 0&&a.hasValue){var p=a.value;if(r(p,f))return c=p}return c=f}if(p=c,yL(h,f))return p;var g=s(f);return r!==void 0&&r(p,g)?p:(h=f,c=g)}var u=!1,h,c,d=t===void 0?null:t;return[function(){return l(e())},d===null?void 0:function(){return l(d())}]},[e,t,s,r]);var o=bL(i,n[0],n[1]);return wL(function(){a.hasValue=!0,a.value=o},[o]),kL(o),o};Lx.exports=Dx;var xL=Lx.exports,nt="default"in Al?tn:Al,gb=Symbol.for("react-redux-context"),mb=typeof globalThis<"u"?globalThis:{};function _L(){if(!nt.createContext)return{};const i=mb[gb]??(mb[gb]=new Map);let e=i.get(nt.createContext);return e||(e=nt.createContext(null),i.set(nt.createContext,e)),e}var pn=_L(),Ax=()=>{throw new Error("uSES not initialized!")};function v0(i=pn){return function(){return nt.useContext(i)}}var Ix=v0(),Rx=Ax,TL=i=>{Rx=i},NL=(i,e)=>i===e;function BL(i=pn){const e=i===pn?Ix:v0(i),t=(s,r={})=>{const{equalityFn:n=NL,devModeChecks:a={}}=typeof r=="function"?{equalityFn:r}:r,{store:o,subscription:l,getServerState:u,stabilityCheck:h,identityFunctionCheck:c}=e();nt.useRef(!0);const d=nt.useCallback({[s.name](p){return s(p)}}[s.name],[s,h,a.stabilityCheck]),f=Rx(l.addNestedSub,o.getState,u||o.getState,d,n);return nt.useDebugValue(f),f};return Object.assign(t,{withTypes:()=>t}),t}var Rn=BL(),CL=Symbol.for("react.element"),PL=Symbol.for("react.portal"),ML=Symbol.for("react.fragment"),EL=Symbol.for("react.strict_mode"),LL=Symbol.for("react.profiler"),DL=Symbol.for("react.provider"),AL=Symbol.for("react.context"),IL=Symbol.for("react.server_context"),Ox=Symbol.for("react.forward_ref"),RL=Symbol.for("react.suspense"),OL=Symbol.for("react.suspense_list"),k0=Symbol.for("react.memo"),FL=Symbol.for("react.lazy"),VL=Ox,HL=k0;function zL(i){if(typeof i=="object"&&i!==null){const e=i.$$typeof;switch(e){case CL:{const t=i.type;switch(t){case ML:case LL:case EL:case RL:case OL:return t;default:{const s=t&&t.$$typeof;switch(s){case IL:case AL:case Ox:case FL:case k0:case DL:return s;default:return e}}}}case PL:return e}}}function WL(i){return zL(i)===k0}function GL(i,e,t,s,{areStatesEqual:r,areOwnPropsEqual:n,areStatePropsEqual:a}){let o=!1,l,u,h,c,d;function f(y,w){return l=y,u=w,h=i(l,u),c=e(s,u),d=t(h,c,u),o=!0,d}function p(){return h=i(l,u),e.dependsOnOwnProps&&(c=e(s,u)),d=t(h,c,u),d}function g(){return i.dependsOnOwnProps&&(h=i(l,u)),e.dependsOnOwnProps&&(c=e(s,u)),d=t(h,c,u),d}function b(){const y=i(l,u),w=!a(y,h);return h=y,w&&(d=t(h,c,u)),d}function m(y,w){const x=!n(w,u),k=!r(y,l,w,u);return l=y,u=w,x&&k?p():x?g():k?b():d}return function(w,x){return o?m(w,x):f(w,x)}}function jL(i,{initMapStateToProps:e,initMapDispatchToProps:t,initMergeProps:s,...r}){const n=e(i,r),a=t(i,r),o=s(i,r);return GL(n,a,o,i,r)}function UL(i,e){const t={};for(const s in i){const r=i[s];typeof r=="function"&&(t[s]=(...n)=>e(r(...n)))}return t}function _g(i){return function(t){const s=i(t);function r(){return s}return r.dependsOnOwnProps=!1,r}}function yb(i){return i.dependsOnOwnProps?!!i.dependsOnOwnProps:i.length!==1}function Fx(i,e){return function(s,{displayName:r}){const n=function(o,l){return n.dependsOnOwnProps?n.mapToProps(o,l):n.mapToProps(o,void 0)};return n.dependsOnOwnProps=!0,n.mapToProps=function(o,l){n.mapToProps=i,n.dependsOnOwnProps=yb(i);let u=n(o,l);return typeof u=="function"&&(n.mapToProps=u,n.dependsOnOwnProps=yb(u),u=n(o,l)),u},n}}function x0(i,e){return(t,s)=>{throw new Error(`Invalid value of type ${typeof i} for ${e} argument when connecting component ${s.wrappedComponentName}.`)}}function $L(i){return i&&typeof i=="object"?_g(e=>UL(i,e)):i?typeof i=="function"?Fx(i):x0(i,"mapDispatchToProps"):_g(e=>({dispatch:e}))}function YL(i){return i?typeof i=="function"?Fx(i):x0(i,"mapStateToProps"):_g(()=>({}))}function XL(i,e,t){return{...t,...i,...e}}function QL(i){return function(t,{displayName:s,areMergedPropsEqual:r}){let n=!1,a;return function(l,u,h){const c=i(l,u,h);return n?r(c,a)||(a=c):(n=!0,a=c),a}}}function JL(i){return i?typeof i=="function"?QL(i):x0(i,"mergeProps"):()=>XL}function qL(i){i()}function KL(){let i=null,e=null;return{clear(){i=null,e=null},notify(){qL(()=>{let t=i;for(;t;)t.callback(),t=t.next})},get(){const t=[];let s=i;for(;s;)t.push(s),s=s.next;return t},subscribe(t){let s=!0;const r=e={callback:t,next:null,prev:e};return r.prev?r.prev.next=r:i=r,function(){!s||i===null||(s=!1,r.next?r.next.prev=r.prev:e=r.prev,r.prev?r.prev.next=r.next:i=r.next)}}}}var bb={notify(){},get:()=>[]};function Vx(i,e){let t,s=bb,r=0,n=!1;function a(g){h();const b=s.subscribe(g);let m=!1;return()=>{m||(m=!0,b(),c())}}function o(){s.notify()}function l(){p.onStateChange&&p.onStateChange()}function u(){return n}function h(){r++,t||(t=e?e.addNestedSub(l):i.subscribe(l),s=KL())}function c(){r--,t&&r===0&&(t(),t=void 0,s.clear(),s=bb)}function d(){n||(n=!0,h())}function f(){n&&(n=!1,c())}const p={addNestedSub:a,notifyNestedSubs:o,handleChangeWrapper:l,isSubscribed:u,trySubscribe:d,tryUnsubscribe:f,getListeners:()=>s};return p}var ZL=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",eD=typeof navigator<"u"&&navigator.product==="ReactNative",Mc=ZL||eD?nt.useLayoutEffect:nt.useEffect;function Sb(i,e){return i===e?i!==0||e!==0||1/i===1/e:i!==i&&e!==e}function Ef(i,e){if(Sb(i,e))return!0;if(typeof i!="object"||i===null||typeof e!="object"||e===null)return!1;const t=Object.keys(i),s=Object.keys(e);if(t.length!==s.length)return!1;for(let r=0;r<t.length;r++)if(!Object.prototype.hasOwnProperty.call(e,t[r])||!Sb(i[t[r]],e[t[r]]))return!1;return!0}var tD={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},iD={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},sD={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},Hx={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},rD={[VL]:sD,[HL]:Hx};function wb(i){return WL(i)?Hx:rD[i.$$typeof]||tD}var nD=Object.defineProperty,aD=Object.getOwnPropertyNames,vb=Object.getOwnPropertySymbols,oD=Object.getOwnPropertyDescriptor,lD=Object.getPrototypeOf,kb=Object.prototype;function Tg(i,e){if(typeof e!="string"){if(kb){const n=lD(e);n&&n!==kb&&Tg(i,n)}let t=aD(e);vb&&(t=t.concat(vb(e)));const s=wb(i),r=wb(e);for(let n=0;n<t.length;++n){const a=t[n];if(!iD[a]&&!(r&&r[a])&&!(s&&s[a])){const o=oD(e,a);try{nD(i,a,o)}catch{}}}}return i}var zx=Ax,uD=i=>{zx=i},hD=[null,null];function cD(i,e,t){Mc(()=>i(...e),t)}function dD(i,e,t,s,r,n){i.current=s,t.current=!1,r.current&&(r.current=null,n())}function fD(i,e,t,s,r,n,a,o,l,u,h){if(!i)return()=>{};let c=!1,d=null;const f=()=>{if(c||!o.current)return;const g=e.getState();let b,m;try{b=s(g,r.current)}catch(y){m=y,d=y}m||(d=null),b===n.current?a.current||u():(n.current=b,l.current=b,a.current=!0,h())};return t.onStateChange=f,t.trySubscribe(),f(),()=>{if(c=!0,t.tryUnsubscribe(),t.onStateChange=null,d)throw d}}function pD(i,e){return i===e}function gD(i,e,t,{pure:s,areStatesEqual:r=pD,areOwnPropsEqual:n=Ef,areStatePropsEqual:a=Ef,areMergedPropsEqual:o=Ef,forwardRef:l=!1,context:u=pn}={}){const h=u,c=YL(i),d=$L(e),f=JL(t),p=!!i;return b=>{const m=b.displayName||b.name||"Component",y=`Connect(${m})`,w={shouldHandleStateChanges:p,displayName:y,wrappedComponentName:m,WrappedComponent:b,initMapStateToProps:c,initMapDispatchToProps:d,initMergeProps:f,areStatesEqual:r,areStatePropsEqual:a,areOwnPropsEqual:n,areMergedPropsEqual:o};function x(T){const[C,W,z]=nt.useMemo(()=>{const{reactReduxForwardedRef:Ii,...xr}=T;return[T.context,Ii,xr]},[T]),te=nt.useMemo(()=>{let Ii=h;return C!=null&&C.Consumer,Ii},[C,h]),E=nt.useContext(te),U=!!T.store&&!!T.store.getState&&!!T.store.dispatch,re=!!E&&!!E.store,K=U?T.store:E.store,ae=re?E.getServerState:K.getState,ie=nt.useMemo(()=>jL(K.dispatch,w),[K]),[A,Y]=nt.useMemo(()=>{if(!p)return hD;const Ii=Vx(K,U?void 0:E.subscription),xr=Ii.notifyNestedSubs.bind(Ii);return[Ii,xr]},[K,U,E]),le=nt.useMemo(()=>U?E:{...E,subscription:A},[U,E,A]),pe=nt.useRef(void 0),oe=nt.useRef(z),ze=nt.useRef(void 0),Ye=nt.useRef(!1),Ie=nt.useRef(!1),it=nt.useRef(void 0);Mc(()=>(Ie.current=!0,()=>{Ie.current=!1}),[]);const Pt=nt.useMemo(()=>()=>ze.current&&z===oe.current?ze.current:ie(K.getState(),z),[K,z]),$i=nt.useMemo(()=>xr=>A?fD(p,K,A,ie,oe,pe,Ye,Ie,ze,Y,xr):()=>{},[A]);cD(dD,[oe,pe,Ye,z,ze,Y]);let Fs;try{Fs=zx($i,Pt,ae?()=>ie(ae(),z):Pt)}catch(Ii){throw it.current&&(Ii.message+=`
The error may be correlated with this previous error:
${it.current.stack}

`),Ii}Mc(()=>{it.current=void 0,ze.current=void 0,pe.current=Fs});const kr=nt.useMemo(()=>nt.createElement(b,{...Fs,ref:W}),[W,b,Fs]);return nt.useMemo(()=>p?nt.createElement(te.Provider,{value:le},kr):kr,[te,kr,le])}const _=nt.memo(x);if(_.WrappedComponent=b,_.displayName=x.displayName=y,l){const C=nt.forwardRef(function(z,te){return nt.createElement(_,{...z,reactReduxForwardedRef:te})});return C.displayName=y,C.WrappedComponent=b,Tg(C,b)}return Tg(_,b)}}var mD=gD;function yD({store:i,context:e,children:t,serverState:s,stabilityCheck:r="once",identityFunctionCheck:n="once"}){const a=nt.useMemo(()=>{const u=Vx(i);return{store:i,subscription:u,getServerState:s?()=>s:void 0,stabilityCheck:r,identityFunctionCheck:n}},[i,s,r,n]),o=nt.useMemo(()=>i.getState(),[i]);Mc(()=>{const{subscription:u}=a;return u.onStateChange=u.notifyNestedSubs,u.trySubscribe(),o!==i.getState()&&u.notifyNestedSubs(),()=>{u.tryUnsubscribe(),u.onStateChange=void 0}},[a,o]);const l=e||pn;return nt.createElement(l.Provider,{value:a},t)}var bD=yD;function Wx(i=pn){const e=i===pn?Ix:v0(i),t=()=>{const{store:s}=e();return s};return Object.assign(t,{withTypes:()=>t}),t}var SD=Wx();function wD(i=pn){const e=i===pn?SD:Wx(i),t=()=>e().dispatch;return Object.assign(t,{withTypes:()=>t}),t}var Ad=wD();TL(xL.useSyncExternalStoreWithSelector);uD(P.useSyncExternalStore);function xb(i,e){if(i.inserted[e.name]===void 0)return i.insert("",e,i.sheet,!0)}function _b(i,e,t){var s=[],r=s0(i,s,t);return s.length<2?t:r+e(s)}var vD=function(e){var t=Dk(e);t.sheet.speedy=function(o){this.isSpeedy=o},t.compat=!0;var s=function(){for(var l=arguments.length,u=new Array(l),h=0;h<l;h++)u[h]=arguments[h];var c=xo(u,t.registered,void 0);return r0(t,c,!1),t.key+"-"+c.name},r=function(){for(var l=arguments.length,u=new Array(l),h=0;h<l;h++)u[h]=arguments[h];var c=xo(u,t.registered),d="animation-"+c.name;return xb(t,{name:c.name,styles:"@keyframes "+d+"{"+c.styles+"}"}),d},n=function(){for(var l=arguments.length,u=new Array(l),h=0;h<l;h++)u[h]=arguments[h];var c=xo(u,t.registered);xb(t,c)},a=function(){for(var l=arguments.length,u=new Array(l),h=0;h<l;h++)u[h]=arguments[h];return _b(t.registered,s,kD(u))};return{css:s,cx:a,injectGlobal:n,keyframes:r,hydrate:function(l){l.forEach(function(u){t.inserted[u]=!0})},flush:function(){t.registered={},t.inserted={},t.sheet.flush()},sheet:t.sheet,cache:t,getRegisteredStyles:s0.bind(null,t.registered),merge:_b.bind(null,t.registered,s)}},kD=function i(e){for(var t="",s=0;s<e.length;s++){var r=e[s];if(r!=null){var n=void 0;switch(typeof r){case"boolean":break;case"object":{if(Array.isArray(r))n=i(r);else{n="";for(var a in r)r[a]&&a&&(n&&(n+=" "),n+=a)}break}default:n=r}n&&(t&&(t+=" "),t+=n)}}return t},_0=vD({key:"css"}),X=_0.cx,xD=_0.keyframes,B=_0.css;const au=70,Ng=120,ws="screen and (max-width: 479px)",Ks="screen and (min-width: 480px) and (max-width: 1024px)",Gx=B`
  font-size: 2rem;
  font-weight: 700;
  letter-spacing: -0.02em;

  @media ${Ks} {
    font-size: 1.4rem;
  }

  @media ${ws} {
    font-size: 1.1rem;
  }
`,_D=B`
  font-size: 2rem;
  font-weight: 400;
  letter-spacing: -0.02em;

  @media ${Ks} {
    font-size: 1.1rem;
  }

  @media ${ws} {
    font-size: 1rem;
  }
`,Ot=B`
  font-size: 1rem;
  font-weight: 400;

  @media ${Ks} {
    font-size: 0.9rem;
  }

  @media ${ws} {
    font-size: 0.8rem;
  }
`,Iu=B`
  font-size: 0.9rem;
  font-weight: 400;

  @media ${Ks} {
    font-size: 0.65rem;
  }

  @media ${ws} {
    font-size: 0.55rem;
  }
`,Zs=B`
  font-size: 0.875rem;
  font-weight: 400;

  @media ${Ks} {
    font-size: 0.75rem;
  }

  @media ${ws} {
    font-size: 0.625rem;
  }
`,TD=B`
  font-size: 1rem;

  @media ${Ks} {
    font-size: 0.9rem;
  }

  @media ${ws} {
    font-size: 0.8rem;
  }
`,T0=B`
  font-size: 2.5rem;

  @media ${Ks} {
    font-size: 2.2rem;
  }

  @media ${ws} {
    font-size: 1.8rem;
  }
`,N0=B`
  font-size: 1.5rem;

  @media ${Ks} {
    margin-top: 3px;
    font-size: 1.1rem;
  }

  @media ${ws} {
    margin-top: 3px;
    font-size: 0.8rem;
  }
`,jx=B`
  font-size: 2.3rem;

  @media ${Ks} {
    font-size: 0.9rem;
  }

  @media ${ws} {
    font-size: 1.1rem;
  }
`,ND=X(Ot,B`
    display: flex;
    flex-direction: row;
    align-items: center;
    justify-content: center;
    border: none;
    color: #ffffff;
    padding: 5px 14px 5px 12px;
    gap: 6px;
    cursor: pointer;
    height: 40px;
    border-radius: 20px;
    background-color: transparent;
    background-color: #444;
    &:hover {
      color: #ffffff;
      background-color: #333;
    }
    &:disabled {
      background-color: #888;
      color: #ddd;
      cursor: not-allowed;
    }
  `),ma=({className:i,disabled:e,children:t,onClick:s})=>v.jsx("button",{className:X(ND,i),onClick:s,disabled:e,children:t});var Ux={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},Tb=tn.createContext&&tn.createContext(Ux),BD=["attr","size","title"];function CD(i,e){if(i==null)return{};var t=PD(i,e),s,r;if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(i);for(r=0;r<n.length;r++)s=n[r],!(e.indexOf(s)>=0)&&Object.prototype.propertyIsEnumerable.call(i,s)&&(t[s]=i[s])}return t}function PD(i,e){if(i==null)return{};var t={};for(var s in i)if(Object.prototype.hasOwnProperty.call(i,s)){if(e.indexOf(s)>=0)continue;t[s]=i[s]}return t}function Ec(){return Ec=Object.assign?Object.assign.bind():function(i){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(i[s]=t[s])}return i},Ec.apply(this,arguments)}function Nb(i,e){var t=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);e&&(s=s.filter(function(r){return Object.getOwnPropertyDescriptor(i,r).enumerable})),t.push.apply(t,s)}return t}function Lc(i){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Nb(Object(t),!0).forEach(function(s){MD(i,s,t[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(t)):Nb(Object(t)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(t,s))})}return i}function MD(i,e,t){return e=ED(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function ED(i){var e=LD(i,"string");return typeof e=="symbol"?e:e+""}function LD(i,e){if(typeof i!="object"||!i)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}function $x(i){return i&&i.map((e,t)=>tn.createElement(e.tag,Lc({key:t},e.attr),$x(e.child)))}function ct(i){return e=>tn.createElement(DD,Ec({attr:Lc({},i.attr)},e),$x(i.child))}function DD(i){var e=t=>{var{attr:s,size:r,title:n}=i,a=CD(i,BD),o=r||t.size||"1em",l;return t.className&&(l=t.className),i.className&&(l=(l?l+" ":"")+i.className),tn.createElement("svg",Ec({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},t.attr,s,a,{className:l,style:Lc(Lc({color:i.color||t.color},t.style),i.style),height:o,width:o,xmlns:"http://www.w3.org/2000/svg"}),n&&tn.createElement("title",null,n),i.children)};return Tb!==void 0?tn.createElement(Tb.Consumer,null,t=>e(t)):e(Ux)}function AD(i){return ct({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M244,56v48a12,12,0,0,1-12,12H184a12,12,0,1,1,0-24H201.1l-19-17.38c-.13-.12-.26-.24-.38-.37A76,76,0,1,0,127,204h1a75.53,75.53,0,0,0,52.15-20.72,12,12,0,0,1,16.49,17.45A99.45,99.45,0,0,1,128,228h-1.37A100,100,0,1,1,198.51,57.06L220,76.72V56a12,12,0,0,1,24,0Z"},child:[]}]})(i)}function ID(i){return ct({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M232.49,80.49l-128,128a12,12,0,0,1-17,0l-56-56a12,12,0,1,1,17-17L96,183,215.51,63.51a12,12,0,0,1,17,17Z"},child:[]}]})(i)}function RD(i){return ct({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M246.81,111.29,158.63,55.12A19.91,19.91,0,0,0,128,71.84v30L54.63,55.12A19.91,19.91,0,0,0,24,71.84V184.16a19.93,19.93,0,0,0,30.63,16.72L128,154.15v30a19.93,19.93,0,0,0,30.63,16.72l88.18-56.17a19.79,19.79,0,0,0,0-33.42ZM48,176.64V79.36L124.38,128Zm104,0V79.36L228.38,128Z"},child:[]}]})(i)}function OD(i){return ct({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M222.14,69.17,186.83,33.86A19.86,19.86,0,0,0,172.69,28H48A20,20,0,0,0,28,48V208a20,20,0,0,0,20,20H208a20,20,0,0,0,20-20V83.31A19.86,19.86,0,0,0,222.14,69.17ZM164,204H92V160h72Zm40,0H188V156a20,20,0,0,0-20-20H88a20,20,0,0,0-20,20v48H52V52H171l33,33ZM164,84a12,12,0,0,1-12,12H96a12,12,0,0,1,0-24h56A12,12,0,0,1,164,84Z"},child:[]}]})(i)}function Id(i){return ct({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M128,76a52,52,0,1,0,52,52A52.06,52.06,0,0,0,128,76Zm0,80a28,28,0,1,1,28-28A28,28,0,0,1,128,156Zm92-27.21v-1.58l14-17.51a12,12,0,0,0,2.23-10.59A111.75,111.75,0,0,0,225,71.89,12,12,0,0,0,215.89,66L193.61,63.5l-1.11-1.11L190,40.1A12,12,0,0,0,184.11,31a111.67,111.67,0,0,0-27.23-11.27A12,12,0,0,0,146.3,22L128.79,36h-1.58L109.7,22a12,12,0,0,0-10.59-2.23A111.75,111.75,0,0,0,71.89,31.05,12,12,0,0,0,66,40.11L63.5,62.39,62.39,63.5,40.1,66A12,12,0,0,0,31,71.89,111.67,111.67,0,0,0,19.77,99.12,12,12,0,0,0,22,109.7l14,17.51v1.58L22,146.3a12,12,0,0,0-2.23,10.59,111.75,111.75,0,0,0,11.29,27.22A12,12,0,0,0,40.11,190l22.28,2.48,1.11,1.11L66,215.9A12,12,0,0,0,71.89,225a111.67,111.67,0,0,0,27.23,11.27A12,12,0,0,0,109.7,234l17.51-14h1.58l17.51,14a12,12,0,0,0,10.59,2.23A111.75,111.75,0,0,0,184.11,225a12,12,0,0,0,5.91-9.06l2.48-22.28,1.11-1.11L215.9,190a12,12,0,0,0,9.06-5.91,111.67,111.67,0,0,0,11.27-27.23A12,12,0,0,0,234,146.3Zm-24.12-4.89a70.1,70.1,0,0,1,0,8.2,12,12,0,0,0,2.61,8.22l12.84,16.05A86.47,86.47,0,0,1,207,166.86l-20.43,2.27a12,12,0,0,0-7.65,4,69,69,0,0,1-5.8,5.8,12,12,0,0,0-4,7.65L166.86,207a86.47,86.47,0,0,1-10.49,4.35l-16.05-12.85a12,12,0,0,0-7.5-2.62c-.24,0-.48,0-.72,0a70.1,70.1,0,0,1-8.2,0,12.06,12.06,0,0,0-8.22,2.6L99.63,211.33A86.47,86.47,0,0,1,89.14,207l-2.27-20.43a12,12,0,0,0-4-7.65,69,69,0,0,1-5.8-5.8,12,12,0,0,0-7.65-4L49,166.86a86.47,86.47,0,0,1-4.35-10.49l12.84-16.05a12,12,0,0,0,2.61-8.22,70.1,70.1,0,0,1,0-8.2,12,12,0,0,0-2.61-8.22L44.67,99.63A86.47,86.47,0,0,1,49,89.14l20.43-2.27a12,12,0,0,0,7.65-4,69,69,0,0,1,5.8-5.8,12,12,0,0,0,4-7.65L89.14,49a86.47,86.47,0,0,1,10.49-4.35l16.05,12.85a12.06,12.06,0,0,0,8.22,2.6,70.1,70.1,0,0,1,8.2,0,12,12,0,0,0,8.22-2.6l16.05-12.85A86.47,86.47,0,0,1,166.86,49l2.27,20.43a12,12,0,0,0,4,7.65,69,69,0,0,1,5.8,5.8,12,12,0,0,0,7.65,4L207,89.14a86.47,86.47,0,0,1,4.35,10.49l-12.84,16.05A12,12,0,0,0,195.88,123.9Z"},child:[]}]})(i)}function FD(i){return ct({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M212.62,75.17A63.7,63.7,0,0,0,206.39,26,12,12,0,0,0,196,20a63.71,63.71,0,0,0-50,24H126A63.71,63.71,0,0,0,76,20a12,12,0,0,0-10.39,6,63.7,63.7,0,0,0-6.23,49.17A61.5,61.5,0,0,0,52,104v8a60.1,60.1,0,0,0,45.76,58.28A43.66,43.66,0,0,0,92,192v4H76a20,20,0,0,1-20-20,44.05,44.05,0,0,0-44-44,12,12,0,0,0,0,24,20,20,0,0,1,20,20,44.05,44.05,0,0,0,44,44H92v12a12,12,0,0,0,24,0V192a20,20,0,0,1,40,0v40a12,12,0,0,0,24,0V192a43.66,43.66,0,0,0-5.76-21.72A60.1,60.1,0,0,0,220,112v-8A61.5,61.5,0,0,0,212.62,75.17ZM196,112a36,36,0,0,1-36,36H112a36,36,0,0,1-36-36v-8a37.87,37.87,0,0,1,6.13-20.12,11.65,11.65,0,0,0,1.58-11.49,39.9,39.9,0,0,1-.4-27.72,39.87,39.87,0,0,1,26.41,17.8A12,12,0,0,0,119.82,68h32.35a12,12,0,0,0,10.11-5.53,39.84,39.84,0,0,1,26.41-17.8,39.9,39.9,0,0,1-.4,27.72,12,12,0,0,0,1.61,11.53A37.85,37.85,0,0,1,196,104Z"},child:[]}]})(i)}function Bg(i){return ct({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M204,75.64V40a20,20,0,0,0-20-20H72A20,20,0,0,0,52,40V76a20.1,20.1,0,0,0,8,16l48,36L60,164a20.1,20.1,0,0,0-8,16v36a20,20,0,0,0,20,20H184a20,20,0,0,0,20-20V180.36a20.13,20.13,0,0,0-7.94-16L147.9,128l48.16-36.4A20.13,20.13,0,0,0,204,75.64ZM180,212H76V182l52-39,52,39.33Zm0-138.35L128,113,76,74V44H180Z"},child:[]}]})(i)}function Yx(i){return ct({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M219.05,201.94l-27.4-86.12,25.23-27.75a12,12,0,0,0-17.76-16.14L183.24,89.39l-15.1-47.45A19.93,19.93,0,0,0,149.08,28H106.91A19.93,19.93,0,0,0,87.85,41.94l-50.91,160A20,20,0,0,0,56,228H200a20,20,0,0,0,19.06-26.06ZM179.25,156H155.12L173,136.34ZM109.83,52h36.33l18.42,57.91L122.69,156H76.74ZM61.47,204l7.63-24H186.89l7.63,24Z"},child:[]}]})(i)}function Xx(i){return ct({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M211.45,52.51l-80-24A12,12,0,0,0,116,40V140.22A52,52,0,1,0,140,184V104.13l64.55,19.36A12,12,0,0,0,220,112V64A12,12,0,0,0,211.45,52.51ZM88,212a28,28,0,1,1,28-28A28,28,0,0,1,88,212ZM196,95.87l-56-16.8V56.13l56,16.8Z"},child:[]}]})(i)}function B0(i){return ct({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M215.38,14.54a12,12,0,0,0-10.29-2.18l-128,32A12,12,0,0,0,68,56V159.35A40,40,0,1,0,92,196V113.37l104-26v40A40,40,0,1,0,220,164V24A12,12,0,0,0,215.38,14.54ZM52,212a16,16,0,1,1,16-16A16,16,0,0,1,52,212ZM92,88.63V65.37l104-26V62.63ZM180,180a16,16,0,1,1,16-16A16,16,0,0,1,180,180Z"},child:[]}]})(i)}function VD(i){return ct({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M200,28H160a20,20,0,0,0-20,20V208a20,20,0,0,0,20,20h40a20,20,0,0,0,20-20V48A20,20,0,0,0,200,28Zm-4,176H164V52h32ZM96,28H56A20,20,0,0,0,36,48V208a20,20,0,0,0,20,20H96a20,20,0,0,0,20-20V48A20,20,0,0,0,96,28ZM92,204H60V52H92Z"},child:[]}]})(i)}function HD(i){return ct({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M144,180a16,16,0,1,1-16-16A16,16,0,0,1,144,180Zm92-52A108,108,0,1,1,128,20,108.12,108.12,0,0,1,236,128Zm-24,0a84,84,0,1,0-84,84A84.09,84.09,0,0,0,212,128ZM128,64c-24.26,0-44,17.94-44,40v4a12,12,0,0,0,24,0v-4c0-8.82,9-16,20-16s20,7.18,20,16-9,16-20,16a12,12,0,0,0-12,12v8a12,12,0,0,0,23.73,2.56C158.31,137.88,172,122.37,172,104,172,81.94,152.26,64,128,64Z"},child:[]}]})(i)}function Cg(i){return ct({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M20,128A76.08,76.08,0,0,1,96,52h99l-3.52-3.51a12,12,0,1,1,17-17l24,24a12,12,0,0,1,0,17l-24,24a12,12,0,0,1-17-17L195,76H96a52.06,52.06,0,0,0-52,52,12,12,0,0,1-24,0Zm204-12a12,12,0,0,0-12,12,52.06,52.06,0,0,1-52,52H61l3.52-3.51a12,12,0,1,0-17-17l-24,24a12,12,0,0,0,0,17l24,24a12,12,0,1,0,17-17L61,204h99a76.08,76.08,0,0,0,76-76A12,12,0,0,0,224,116Z"},child:[]}]})(i)}function zD(i){return ct({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M232.49,112.49l-48,48a12,12,0,0,1-17-17L195,116H165a84,84,0,0,0-81.36,63,12,12,0,1,1-23.24-6A107.94,107.94,0,0,1,165,92H195L167.51,64.48a12,12,0,0,1,17-17l48,48A12,12,0,0,1,232.49,112.49ZM192,204H44V88a12,12,0,0,0-24,0V216a12,12,0,0,0,12,12H192a12,12,0,0,0,0-24Z"},child:[]}]})(i)}function WD(i){return ct({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M240.26,186.1,152.81,34.23h0a28.74,28.74,0,0,0-49.62,0L15.74,186.1a27.45,27.45,0,0,0,0,27.71A28.31,28.31,0,0,0,40.55,228h174.9a28.31,28.31,0,0,0,24.79-14.19A27.45,27.45,0,0,0,240.26,186.1Zm-20.8,15.7a4.46,4.46,0,0,1-4,2.2H40.55a4.46,4.46,0,0,1-4-2.2,3.56,3.56,0,0,1,0-3.73L124,46.2a4.77,4.77,0,0,1,8,0l87.44,151.87A3.56,3.56,0,0,1,219.46,201.8ZM116,136V104a12,12,0,0,1,24,0v32a12,12,0,0,1-24,0Zm28,40a16,16,0,1,1-16-16A16,16,0,0,1,144,176Z"},child:[]}]})(i)}function Qx(i){return ct({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M128,20A108,108,0,1,0,236,128,108.12,108.12,0,0,0,128,20Zm0,192a84,84,0,1,1,84-84A84.09,84.09,0,0,1,128,212Zm-12-80V80a12,12,0,0,1,24,0v52a12,12,0,0,1-24,0Zm28,40a16,16,0,1,1-16-16A16,16,0,0,1,144,172Z"},child:[]}]})(i)}function GD(i){return ct({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M243.31,90.91l-128.4,128.4a16,16,0,0,1-22.62,0l-71.62-72a16,16,0,0,1,0-22.61l20-20a16,16,0,0,1,22.58,0L104,144.22l96.76-95.57a16,16,0,0,1,22.59,0l19.95,19.54A16,16,0,0,1,243.31,90.91Z"},child:[]}]})(i)}function jD(i){return ct({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M256,128a15.76,15.76,0,0,1-7.33,13.34L160.48,197.5A15.91,15.91,0,0,1,136,184.16v-37.3L56.48,197.5A15.91,15.91,0,0,1,32,184.16V71.84A15.91,15.91,0,0,1,56.48,58.5L136,109.14V71.84A15.91,15.91,0,0,1,160.48,58.5l88.19,56.16A15.76,15.76,0,0,1,256,128Z"},child:[]}]})(i)}function Jx(i){return ct({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M216,48V208a16,16,0,0,1-16,16H160a16,16,0,0,1-16-16V48a16,16,0,0,1,16-16h40A16,16,0,0,1,216,48ZM96,32H56A16,16,0,0,0,40,48V208a16,16,0,0,0,16,16H96a16,16,0,0,0,16-16V48A16,16,0,0,0,96,32Z"},child:[]}]})(i)}function qx(i){return ct({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M240,128a15.74,15.74,0,0,1-7.6,13.51L88.32,229.65a16,16,0,0,1-16.2.3A15.86,15.86,0,0,1,64,216.13V39.87a15.86,15.86,0,0,1,8.12-13.82,16,16,0,0,1,16.2.3L232.4,114.49A15.74,15.74,0,0,1,240,128Z"},child:[]}]})(i)}function Kx(i){return ct({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M216,56V200a16,16,0,0,1-16,16H56a16,16,0,0,1-16-16V56A16,16,0,0,1,56,40H200A16,16,0,0,1,216,56Z"},child:[]}]})(i)}function UD(i){return ct({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M204.24,195.76a6,6,0,1,1-8.48,8.48L128,136.49,60.24,204.24a6,6,0,0,1-8.48-8.48L119.51,128,51.76,60.24a6,6,0,0,1,8.48-8.48L128,119.51l67.76-67.75a6,6,0,0,1,8.48,8.48L136.49,128Z"},child:[]}]})(i)}function $D(i){return ct({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M165.66,202.34a8,8,0,0,1-11.32,11.32l-80-80a8,8,0,0,1,0-11.32l80-80a8,8,0,0,1,11.32,11.32L91.31,128Z"},child:[]}]})(i)}function YD(i){return ct({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M128,80a48,48,0,1,0,48,48A48.05,48.05,0,0,0,128,80Zm0,80a32,32,0,1,1,32-32A32,32,0,0,1,128,160Zm88-29.84q.06-2.16,0-4.32l14.92-18.64a8,8,0,0,0,1.48-7.06,107.21,107.21,0,0,0-10.88-26.25,8,8,0,0,0-6-3.93l-23.72-2.64q-1.48-1.56-3-3L186,40.54a8,8,0,0,0-3.94-6,107.71,107.71,0,0,0-26.25-10.87,8,8,0,0,0-7.06,1.49L130.16,40Q128,40,125.84,40L107.2,25.11a8,8,0,0,0-7.06-1.48A107.6,107.6,0,0,0,73.89,34.51a8,8,0,0,0-3.93,6L67.32,64.27q-1.56,1.49-3,3L40.54,70a8,8,0,0,0-6,3.94,107.71,107.71,0,0,0-10.87,26.25,8,8,0,0,0,1.49,7.06L40,125.84Q40,128,40,130.16L25.11,148.8a8,8,0,0,0-1.48,7.06,107.21,107.21,0,0,0,10.88,26.25,8,8,0,0,0,6,3.93l23.72,2.64q1.49,1.56,3,3L70,215.46a8,8,0,0,0,3.94,6,107.71,107.71,0,0,0,26.25,10.87,8,8,0,0,0,7.06-1.49L125.84,216q2.16.06,4.32,0l18.64,14.92a8,8,0,0,0,7.06,1.48,107.21,107.21,0,0,0,26.25-10.88,8,8,0,0,0,3.93-6l2.64-23.72q1.56-1.48,3-3L215.46,186a8,8,0,0,0,6-3.94,107.71,107.71,0,0,0,10.87-26.25,8,8,0,0,0-1.49-7.06Zm-16.1-6.5a73.93,73.93,0,0,1,0,8.68,8,8,0,0,0,1.74,5.48l14.19,17.73a91.57,91.57,0,0,1-6.23,15L187,173.11a8,8,0,0,0-5.1,2.64,74.11,74.11,0,0,1-6.14,6.14,8,8,0,0,0-2.64,5.1l-2.51,22.58a91.32,91.32,0,0,1-15,6.23l-17.74-14.19a8,8,0,0,0-5-1.75h-.48a73.93,73.93,0,0,1-8.68,0,8,8,0,0,0-5.48,1.74L100.45,215.8a91.57,91.57,0,0,1-15-6.23L82.89,187a8,8,0,0,0-2.64-5.1,74.11,74.11,0,0,1-6.14-6.14,8,8,0,0,0-5.1-2.64L46.43,170.6a91.32,91.32,0,0,1-6.23-15l14.19-17.74a8,8,0,0,0,1.74-5.48,73.93,73.93,0,0,1,0-8.68,8,8,0,0,0-1.74-5.48L40.2,100.45a91.57,91.57,0,0,1,6.23-15L69,82.89a8,8,0,0,0,5.1-2.64,74.11,74.11,0,0,1,6.14-6.14A8,8,0,0,0,82.89,69L85.4,46.43a91.32,91.32,0,0,1,15-6.23l17.74,14.19a8,8,0,0,0,5.48,1.74,73.93,73.93,0,0,1,8.68,0,8,8,0,0,0,5.48-1.74L155.55,40.2a91.57,91.57,0,0,1,15,6.23L173.11,69a8,8,0,0,0,2.64,5.1,74.11,74.11,0,0,1,6.14,6.14,8,8,0,0,0,5.1,2.64l22.58,2.51a91.32,91.32,0,0,1,6.23,15l-14.19,17.74A8,8,0,0,0,199.87,123.66Z"},child:[]}]})(i)}function Zx(i){return ct({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M205.66,194.34a8,8,0,0,1-11.32,11.32L128,139.31,61.66,205.66a8,8,0,0,1-11.32-11.32L116.69,128,50.34,61.66A8,8,0,0,1,61.66,50.34L128,116.69l66.34-66.35a8,8,0,0,1,11.32,11.32L139.31,128Z"},child:[]}]})(i)}function XD(i){return ct({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M240.47,71.09l-24-23.58a12,12,0,0,0-17,0L104,141.83l-39.5-38.32a12,12,0,0,0-17,0l-24,24a12,12,0,0,0,0,17l71.61,72a12,12,0,0,0,17,0L240.49,88.08A12,12,0,0,0,240.47,71.09Zm-5.63,11.34L106.43,210.83a4,4,0,0,1-5.65,0l-71.61-72a4,4,0,0,1,0-5.66l24-24A3.94,3.94,0,0,1,56,108a4.11,4.11,0,0,1,2.89,1.21l42.35,41.08a4,4,0,0,0,5.59,0l98.37-97.1a4,4,0,0,1,5.68,0l24,23.58A4,4,0,0,1,234.84,82.43Z"},child:[]}]})(i)}const QD=B`
  position: fixed;
  top: 0px;
  left: 0px;
  height: 100vh;
  width: 100vw;
  @supports (height: 100dvh) {
    height: min(100vh, 100dvh);
  }
  backdrop-filter: blur(30px);
  background-color: #ffffff99;

  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  @media ${ws} {
    padding: 10px;
  }
  @media ${Ks} {
    padding: 10px;
  }
`,JD=B`
  display: flex;
  flex-direction: column;
  align-items: center;
  max-width: 800px;
  text-align: center;
  gap: 10px;
`,qD=X(Gx,B`
    color: #000000;
  `),KD=X(Ot,B`
    color: #00000090;
  `),ZD=X(Ot,B`
    padding: 10px;
    background-color: #00000010;
    border-radius: 10px;
    text-align: left;
    max-width: 800px;
    overflow: auto;
    @media ${ws} {
      max-width: calc(100vw - 20px);
      max-height: 50vh;
    }
    @media ${Ks} {
      max-width: calc(100vw - 20px);
      max-height: 50vh;
    }
  `);class eA extends P.Component{constructor(e){super(e),this.state={error:void 0}}componentDidCatch(e){this.setState({error:e})}reset(){localStorage.clear(),this.props.reset(),location.reload()}render(){const{error:e}=this.state;return ee(e)?this.props.children:v.jsx("div",{className:QD,children:v.jsxs("div",{className:JD,children:[v.jsx("h1",{className:qD,children:v.jsx(kf,{children:t=>t("ErrorBoundary.Title")})}),v.jsx("span",{className:KD,children:v.jsx(kf,{children:t=>t("ErrorBoundary.Explanation")})}),v.jsx("pre",{className:ZD,children:e.stack??e.message}),v.jsxs(ma,{onClick:this.reset.bind(this),children:[v.jsx(AD,{}),v.jsx(kf,{children:t=>t("ErrorBoundary.Reset")})]})]})})}}const tA=i=>({reset:()=>{i(Vr.actions.setGeneratorConfig(Pa.generator))}}),iA=mD(void 0,tA)(eA),sA=xD`
  0% {
    transform: rotate(0deg);
  }
  100% {
    transform: rotate(360deg);
  }
`,rA=B`
  width: 60px;
  height: 60px;
  border: 7px solid #ffffff;
  border-bottom-color: transparent;
  border-radius: 50%;
  display: inline-block;
  box-sizing: border-box;
  animation: ${sA} 1s linear infinite;
`,nA=()=>v.jsx("span",{className:rA}),aA=B`
  position: fixed;
  top: 0px;
  left: 0px;
  right: 0px;
  bottom: 0px;
  z-index: 3;

  backdrop-filter: blur(5px);
  background: #22222299;

  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  gap: 20px;
`,oA=X(Ot,B`
    color: #ffffff;
  `),lA=({isVisible:i})=>{const{t:e}=Yt();return i?v.jsxs("div",{className:aA,children:[v.jsx(nA,{}),v.jsx("div",{className:oA,children:e("Score.Loading")})]}):null},e_=B`
  border-radius: 50%;
  background-color: #ffffff15;
  color: #ffffff;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: background-color 0.2s ease, outline 0.2s ease;
  border: none;
  &:hover {
    background-color: #ffffff40;
  }
  &:focus {
    outline: 2px solid #ffffff;
  }
`,t_=B`
  width: 100px;
  height: 100px;
  font-size: 50px;
`,i_=B`
  width: 70px;
  height: 70px;
  font-size: 25px;
`,uA=B`
  background-color: #ffffff60;
  &:hover {
    background-color: #ffffff60;
  }
`,hA=B`
  display: flex;
  flex-direction: row;
  align-items: center;

  button:first-child {
    border-radius: 50% 0 0 50%;
    padding-left: 6px;
  }

  button:last-child {
    border-radius: 0 50% 50% 0;
    padding-right: 6px;
  }

  button:not(:first-child):not(:last-child) {
    border-radius: 0;
    padding: 0px;
  }
`,cA=({onClick:i,kind:e,label:t,icon:s})=>{const r=X({[e_]:!0,[t_]:e==="primary",[i_]:e==="secondary"});return v.jsx("button",{className:r,onClick:i,"data-tooltip":t,children:v.jsx(s,{})})},Lf=({kind:i,isToggled:e,label:t,onToggle:s,icon:r})=>{const n=X({[e_]:!0,[t_]:i==="primary",[i_]:i==="secondary",[uA]:e}),a=()=>s(!e);return v.jsx("button",{className:n,onClick:a,"data-tooltip":t,children:v.jsx(r,{className:N0})})},s_=B`
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 6px;

  color: #eeeeee;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  background-color: transparent;
  border: none;
  &:focus {
    color: #ffffff;
  }
`,dA=B`
  color: #ffffff;
  background-color: #ffffff20;
`,fA=B`
  display: grid;
`,Pg=X(N0,B`
    transition: opacity 0.2s ease, transform 0.2s ease;
    grid-row: 1;
    grid-column: 1;
  `),pA=B`
  opacity: 0;
  transform: translateX(-20px) scale(0.8);
`,gA=B`
  opacity: 0;
  transform: translateX(20px) scale(0.8);
`,mA=B`
  opacity: 1;
  transform: translateX(0) scale(1);
`,yA=B`
  opacity: 1;
  transform: translateX(0) scale(1.25);
`,bA=B`
  transform: scale(1.25);
`,SA=({isToggled:i,offIcon:e,onIcon:t})=>{const s=X({[Pg]:!0,[pA]:!0,[mA]:!i}),r=X({[Pg]:!0,[gA]:!0,[yA]:i});return v.jsxs("div",{className:fA,children:[v.jsx(e,{className:s}),v.jsx(t,{className:r})]})},wA=({isToggled:i,icon:e})=>{const t=X({[Pg]:!0,[bA]:i});return v.jsx(e,{className:t})},Df=({isToggled:i,label:e,onToggle:t,offIcon:s,onIcon:r})=>{const n=X({[s_]:!0,[dA]:i}),a=()=>t(!i);return v.jsxs("button",{className:n,onClick:a,children:[s===r?v.jsx(wA,{isToggled:i,icon:r}):v.jsx(SA,{isToggled:i,offIcon:s,onIcon:r}),v.jsx("span",{className:Iu,children:v.jsx(u0,{i18nKey:e})})]})},Bb=({onClick:i,label:e,icon:t})=>{const s=X({[s_]:!0});return v.jsxs("button",{className:s,onClick:i,children:[v.jsx(t,{className:N0}),v.jsx("span",{className:Iu,children:v.jsx(u0,{i18nKey:e})})]})},vA=({children:i})=>v.jsx("div",{className:hA,children:i}),r_=P.createContext({isPlaying:!1,isLooping:!1,isLoading:!1,isCountingIn:!1,instrumentVolume:0,metronomeVolume:0,chordsVolume:0,isSettingsOpen:!1,isHelpOpen:!1,language:void 0,setRootDOMElement:Et,setScrollAreaDOMElement:Et,stop:Et,regenerate:Et,playPause:Et,toggleLooping:Et,toggleCountIn:Et,setInstrumentVolume:Et,setChordsVolume:Et,setMetronomeVolume:Et,setSettingsOpen:Et,setHelpOpen:Et,setLanguage:Et}),vr=()=>P.useContext(r_),kA=B`
  display: flex;
  flex-direction: column;
  gap: 10px;
  align-items: center;
  justify-content: center;
`,xA=B`
  display: flex;
  flex-direction: row;
  align-items: center;
  justify-content: center;
  justify-self: center;
  gap: 10px;
`,_A=B`
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  width: 100%;
`,TA=()=>{const{stop:i,playPause:e,toggleLooping:t,toggleCountIn:s,isPlaying:r,isLooping:n,isCountingIn:a}=vr();return v.jsx("div",{className:kA,children:v.jsxs("div",{className:xA,children:[v.jsx(cA,{kind:"secondary",icon:Kx,onClick:i,label:"PlayerTooltips.Stop"}),v.jsx(Lf,{kind:"primary",icon:r?Jx:qx,isToggled:r,onToggle:e,label:r?"PlayerTooltips.Pause":"PlayerTooltips.Play"}),v.jsxs(vA,{children:[v.jsx(Lf,{kind:"secondary",icon:Cg,isToggled:n,onToggle:t,label:"PlayerTooltips.Loop"}),v.jsx(Lf,{kind:"secondary",icon:Bg,isToggled:a,onToggle:s,label:"PlayerTooltips.CountIn"})]})]})})},NA=()=>{const{stop:i,playPause:e,regenerate:t,toggleLooping:s,toggleCountIn:r,isPlaying:n,isLooping:a,isCountingIn:o}=vr();return v.jsxs("div",{className:_A,children:[v.jsx(Bb,{icon:jD,onClick:t,label:"PlayerTooltips.Regenerate"}),v.jsx(Bb,{icon:Kx,onClick:i,label:"PlayerTooltips.Stop"}),v.jsx(Df,{offIcon:qx,onIcon:Jx,isToggled:n,onToggle:e,label:n?"PlayerTooltips.Pause":"PlayerTooltips.Play"}),v.jsx(Df,{offIcon:Cg,onIcon:Cg,isToggled:a,onToggle:s,label:"PlayerTooltips.Loop"}),v.jsx(Df,{kind:"secondary",offIcon:Bg,onIcon:Bg,isToggled:o,onToggle:r,label:"PlayerTooltips.CountIn"})]})},BA=B`
  // .at-content
  position: relative;
  overflow: hidden;
  flex: 1 1 auto;
`,CA=B`
  // .at-viewport
  overflow-y: auto;
  position: absolute;
  top: 0px;
  bottom: 30px;
  border-radius: 8px;
  box-shadow: rgba(100, 100, 111, 0.2) 0px 7px 29px 0px;
  background-color: #ffffff;
`,n_=({setRootCallback:i,setScrollAreaCallback:e,viewPortStyle:t})=>v.jsx("div",{className:BA,children:v.jsx("div",{className:X(CA,t),ref:e,children:v.jsx("div",{ref:i})})}),PA="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxOTAuODY1IiBoZWlnaHQ9IjUwLjMxNiI%2BPHBhdGggZD0iTTUxLjY1NyAzMi41MzJhMTQuNSAxNC41IDAgMCAxLTIuODYgNC42MTYgNS4yIDUuMiAwIDAgMS02LjIyNSAxLjA1OSA1LjU1IDUuNTUgMCAwIDEtMS44NzMtMS42NjUgOC4xIDguMSAwIDAgMS0xLjE5NC0yLjU3IDEyLjIgMTIuMiAwIDAgMS0uNDIyLTMuMzEgMTMuOSAxMy45IDAgMCAxIC40NzMtMy43MjEgOS40IDkuNCAwIDAgMSAxLjM1OC0yLjk1IDYuNCA2LjQgMCAwIDEgMi4xNjEtMS45NDMgNS44NSA1Ljg1IDAgMCAxIDIuODYtLjcgNC40NiA0LjQ2IDAgMCAxIDIuNDI4LjY0OCA2LjE1IDYuMTUgMCAwIDEgMS44MTMgMS44MDQgMTIuNSAxMi41IDAgMCAxIDEuMzU4IDIuNzc2IDM2IDM2IDAgMCAxIDEuMDQ5IDMuNTQ3em02LjggOC4yMzRxLjM4MS0uMDcyLjg1NC0uMnYtMi4zMTlxLS4yMjcuMDYyLS40NjMuMWEzIDMgMCAwIDEtLjUuMDQxIDEuNDUgMS40NSAwIDAgMS0uODg1LS4yODggMi45NSAyLjk1IDAgMCAxLS43ODItMS4xODIgMTcuNiAxNy42IDAgMCAxLS44MTMtMi41MjlxLS40MjItMS42MzUtLjk3Ny00LjMwN2w0LjA1NC0xMC41MDZoLTIuODM5bC0yLjI2NCA2LjdoLS4wNjVhMTkuNiAxOS42IDAgMCAwLTEuMTcxLTIuNzYgOS43IDkuNyAwIDAgMC0xLjYzNi0yLjI5MiA3LjMgNy4zIDAgMCAwLTIuMjEyLTEuNTYzIDYuOCA2LjggMCAwIDAtMi44Ni0uNTc2IDkgOSAwIDAgMC00LjAyMy44NzQgOC41IDguNSAwIDAgMC0yLjk5NCAyLjQyNiAxMS4yIDExLjIgMCAwIDAtMS44NjUgMy43MTUgMTYuNCAxNi40IDAgMCAwLS42NDggNC43MjlBMTQgMTQgMCAwIDAgMzYuOTU0IDM1YTkuOCA5LjggMCAwIDAgMS42NjcgMy4yNDkgNy43IDcuNyAwIDAgMCAyLjYgMi4xMTggNy40NSA3LjQ1IDAgMCAwIDMuMzc1Ljc2MSA4LjIgOC4yIDAgMCAwIDIuNjU1LS40MjIgNy40IDcuNCAwIDAgMCAyLjMtMS4zIDEwLjYgMTAuNiAwIDAgMCAyLTIuMjIxIDIwIDIwIDAgMCAwIDEuNzQ5LTMuMmguMDg2cS4zNzEgMS43NDguNzcyIDMuMDQzYTEwLjcgMTAuNyAwIDAgMCAuODg1IDIuMTM4IDMuOCAzLjggMCAwIDAgMS4wNyAxLjI1NCAyLjMgMi4zIDAgMCAwIDEuMzQ4LjQxMSA1LjYgNS42IDAgMCAwIC45OTctLjA2NXptNS45MTgtLjEzNFY5LjQ2M2gtMi42MzN2MzEuMTY5aDIuNjM0em03LjgyMi0zLjM5MmE3LjE3IDcuMTcgMCAwIDAgNi42NDcgMy44ODYgOSA5IDAgMCAwIDMuOTYxLS44NTMgOC42IDguNiAwIDAgMCAyLjk5NC0yLjQgMTEgMTEgMCAwIDAgMS44OTMtMy42OSAxNi4yIDE2LjIgMCAwIDAgLjY1OS00Ljc2IDE0LjYgMTQuNiAwIDAgMC0uNTg3LTQuMyA5LjQgOS40IDAgMCAwLTEuNjg3LTMuMjQ4IDcuNSA3LjUgMCAwIDAtMi43LTIuMDY2IDkuMTYgOS4xNiAwIDAgMC04LjA0Ni40MzIgOC4zNyA4LjM3IDAgMCAwLTMuMTM4IDMuMzYxaC0uMDc3di00LjAzaC0yLjYzNXYzMC43NDRoMi42MzVWMzcuMjRoLjA4MnptLS4wODEtOC4xNjJhOSA5IDAgMCAxIC40OTQtMi45OTEgNy4zIDcuMyAwIDAgMSAxLjQyLTIuNDU3IDYuNyA2LjcgMCAwIDEgMi4yNDMtMS42NTUgNyA3IDAgMCAxIDIuOTYzLS42MDcgNi4xNSA2LjE1IDAgMCAxIDIuNjQ0LjU1NSA1LjYgNS42IDAgMCAxIDIuMDE3IDEuNiA3LjYgNy42IDAgMCAxIDEuMjg2IDIuNTM5IDExLjUgMTEuNSAwIDAgMSAuNDUyIDMuMzQxIDE0LjcgMTQuNyAwIDAgMS0uNDgzIDMuOTA2IDkuMiA5LjIgMCAwIDEtMS4zNzkgMi45ODEgNi4yNCA2LjI0IDAgMCAxLTIuMTY3IDEuOTEgNi4xIDYuMSAwIDAgMS0yLjg2LjY2OCA2LjUgNi41IDAgMCAxLTIuNzA2LS41NTUgNi4zIDYuMyAwIDAgMS0yLjA5My0xLjUxMyA3IDcgMCAwIDEtMS4zNDgtMi4yMjEgNy41IDcuNSAwIDAgMS0uNDg0LTIuN3ptMzYuNzEzIDExLjU1NVYyNy42MThxMC00LjIxNC0xLjc3LTYuMzc0YTYuNDQgNi40NCAwIDAgMC01LjI4OC0yLjE1OSA3LjgxIDcuODEgMCAwIDAtNy4wNzkgNC4xMzNoLS4wODZWOS40NjNoLTIuNjM0djMxLjE2OWgyLjYzNFYyOC44NTFhOSA5IDAgMCAxIC41MTUtMy4xMzUgNy4zIDcuMyAwIDAgMSAxLjM3OS0yLjM1NCA1LjkgNS45IDAgMCAxIDQuNDQ0LTEuOTk0IDQuNjcgNC42NyAwIDAgMSAzLjk3MiAxLjY3NiA4LjYgOC42IDAgMCAxIDEuMjc2IDUuMjEydjEyLjM3NmgyLjYzNHptMTguNC04LjFhMTQuNSAxNC41IDAgMCAxLTIuODYxIDQuNjE2IDUuMiA1LjIgMCAwIDEtNi4yMjUgMS4wNTkgNS41NSA1LjU1IDAgMCAxLTEuODcyLTEuNjY1IDguMSA4LjEgMCAwIDEtMS4xOTQtMi41NyAxMi4yIDEyLjIgMCAwIDEtLjQyMi0zLjMxIDEzLjkgMTMuOSAwIDAgMSAuNDc0LTMuNzIxIDkuMyA5LjMgMCAwIDEgMS4zNTgtMi45NSA2LjQgNi40IDAgMCAxIDIuMTYxLTEuOTQzIDUuODUgNS44NSAwIDAgMSAyLjg2LS43IDQuNDYgNC40NiAwIDAgMSAyLjQyOC42NDggNi4xNSA2LjE1IDAgMCAxIDEuODEgMS44MDMgMTIuNSAxMi41IDAgMCAxIDEuMzYgMi43OCAzNiAzNiAwIDAgMSAxLjA1IDMuNTQ3em02LjggOC4yMzRxLjM4LS4wNy44NTQtLjJ2LTIuMzJhNCA0IDAgMCAxLS40NjMuMSAzIDMgMCAwIDEtLjUuMDQxIDEuNDUgMS40NSAwIDAgMS0uODg1LS4yODggMi45NCAyLjk0IDAgMCAxLS43ODItMS4xODIgMTcuNSAxNy41IDAgMCAxLS44MTMtMi41MjlxLS40MjItMS42MzUtLjk3Ny00LjMwN2w0LjA1My0xMC41MDZoLTIuODM5bC0yLjI2NCA2LjdoLS4wNjJhMTkuNSAxOS41IDAgMCAwLTEuMTczLTIuNzY1IDkuNyA5LjcgMCAwIDAtMS42MzYtMi4yOTIgNy4zIDcuMyAwIDAgMC0yLjIxMi0xLjU2MyA2LjggNi44IDAgMCAwLTIuODYtLjU3NiA5IDkgMCAwIDAtNC4wMjMuODc0IDguNSA4LjUgMCAwIDAtMi45OTQgMi40MjYgMTEuMiAxMS4yIDAgMCAwLTEuODY3IDMuNzIgMTYuNCAxNi40IDAgMCAwLS42NDggNC43MjkgMTQgMTQgMCAwIDAgLjU4NiA0LjE3MSA5LjggOS44IDAgMCAwIDEuNjY3IDMuMjQ5IDcuNyA3LjcgMCAwIDAgMi42IDIuMTE4IDcuNDUgNy40NSAwIDAgMCAzLjM3NS43NjEgOC4yIDguMiAwIDAgMCAyLjY1NS0uNDIyIDcuNCA3LjQgMCAwIDAgMi4zLTEuMyAxMC42IDEwLjYgMCAwIDAgMi0yLjIyMSAyMCAyMCAwIDAgMCAxLjc0OS0zLjJoLjA4MnEuMzcxIDEuNzQ4Ljc3MiAzLjA0M2ExMC43IDEwLjcgMCAwIDAgLjg4NSAyLjEzOCAzLjggMy44IDAgMCAwIDEuMDcgMS4yNTQgMi4zIDIuMyAwIDAgMCAxLjM0OC40MTEgNS42IDUuNiAwIDAgMCAxLjAwMi0uMDY1eiIgc3R5bGU9ImZpbGw6I2ZmZiIvPjxwYXRoIGQ9Ik0xNTQuMyAxMy42NTh2LTIuNTA5aC0xOS43NTZ2Mi41MDhoOC41djI2Ljk3NWgyLjczN1YxMy42NThoOC41MnptMTMuMDQ4IDI2Ljk3NVYyNi45MzlxMC0zLjkwNi0xLjgtNS44OGE2Ljg0IDYuODQgMCAwIDAtNS4zMTktMS45NzQgMTIgMTIgMCAwIDAtMS45LjE1NCAxNC41IDE0LjUgMCAwIDAtMS45LjQzMiAxNCAxNCAwIDAgMC0xLjc2LjY1OCA5IDkgMCAwIDAtMS40OTIuODUzdjIuODc4YTEwLjMgMTAuMyAwIDAgMSA2LjgyOS0yLjY5MnE0LjcxMyAwIDQuNzEzIDYuMDY1bC02LjQuOTI1YTkuNSA5LjUgMCAwIDAtNS4zNSAyLjIxIDYuMDEgNi4wMSAwIDAgMC0xLjc3IDQuNTU0IDYuMyA2LjMgMCAwIDAgLjQ2MyAyLjQ0NyA1LjQgNS40IDAgMCAwIDEuMzE3IDEuOSA1LjkgNS45IDAgMCAwIDIuMDc4IDEuMjIzIDguMiA4LjIgMCAwIDAgMi43NDguNDMyIDcuNDUgNy40NSAwIDAgMCA0LjAyMy0xLjExIDcuNzQgNy43NCAwIDAgMCAyLjgwOS0zLjEyNWguMDgydjMuNzQyaDIuNjM0em0tMi42MzQtMTAuOTc5djIuMDc2YTguMiA4LjIgMCAwIDEtLjQ4NCAyLjg1OCA2LjkgNi45IDAgMCAxLTEuMzM3IDIuMjYyIDYuMDggNi4wOCAwIDAgMS00LjYgMi4wMTUgNS41IDUuNSAwIDAgMS0xLjg0MS0uMjg4IDMuOSAzLjkgMCAwIDEtMS4zNzktLjgxMiAzLjUgMy41IDAgMCAxLS44NjQtMS4yNDQgNCA0IDAgMCAxLS4zLTEuNTYyIDUuMSA1LjEgMCAwIDEgLjMwOS0xLjkgMy4xIDMuMSAwIDAgMSAuOTY3LTEuMyA1IDUgMCAwIDEgMS42NjctLjgzMyAxNi41IDE2LjUgMCAwIDEgMi40MjgtLjUxNHptMTAgNy41ODdhNy4xNCA3LjE0IDAgMCAwIDYuNjQ3IDMuODg2IDguOSA4LjkgMCAwIDAgMy45NC0uODUzIDguNiA4LjYgMCAwIDAgMi45OTQtMi40IDExLjEgMTEuMSAwIDAgMCAxLjktMy42OSAxNiAxNiAwIDAgMCAuNjY5LTQuNzYgMTQuNSAxNC41IDAgMCAwLS41ODctNC4yNTYgOS42IDkuNiAwIDAgMC0xLjY4Ny0zLjI2OSA3LjQgNy40IDAgMCAwLTIuNy0yLjA4NyA5LjE2IDkuMTYgMCAwIDAtOC4wNDYuNDMyIDguMzcgOC4zNyAwIDAgMC0zLjEzOCAzLjM2MWgtLjA4M1Y5LjQ2M2gtMi42MzR2MzEuMTY5aDIuNjM0VjM3LjI0aC4wODN6bS0uMDgzLTguMTYyYTkgOSAwIDAgMSAuNDk0LTIuOTkxIDcuNCA3LjQgMCAwIDEgMS40Mi0yLjQ1NyA2LjcgNi43IDAgMCAxIDIuMjQzLTEuNjU1IDcgNyAwIDAgMSAyLjk2NC0uNjA3IDYuMTUgNi4xNSAwIDAgMSAyLjY0NC41NTUgNS42IDUuNiAwIDAgMSAyLjAxNyAxLjYgNy42IDcuNiAwIDAgMSAxLjI4NiAyLjUzOSAxMS41IDExLjUgMCAwIDEgLjQ1MiAzLjM0MSAxNC43IDE0LjcgMCAwIDEtLjQ4MyAzLjkwNiA5LjIgOS4yIDAgMCAxLTEuMzc5IDIuOTgxIDYuMjUgNi4yNSAwIDAgMS0yLjE3MSAxLjkgNi4xIDYuMSAwIDAgMS0yLjg2LjY2OCA2LjUgNi41IDAgMCAxLTIuNzA2LS41NTUgNi4zIDYuMyAwIDAgMS0yLjA4Ni0xLjUwNCA3IDcgMCAwIDEtMS4zNDgtMi4yMjEgNy41IDcuNSAwIDAgMS0uNDg0LTIuN3YtMi44eiIgc3R5bGU9ImZpbGw6I2ZmZmZmZjk5Ii8%2BPHBhdGggZD0iTTE0LjczNiAwdjM3LjkzN2E2LjMgNi4zIDAgMCAwLTUuMDMtMS45NDRDNC41MjcgMzUuOTkzIDAgNDAuMTUgMCA0NC43MjRjMCAzLjUgMi40MSA1LjI0MiA2LjEyIDUuMjQyIDUuNiAwIDkuNjgxLTQuMjkgOS43MDYtOC43VjEwLjUyNGM1LjUxNCAyLjgyNSA5LjQ4NiA1LjY0MSAxMS42MjUgOS43MzEgMi4xNjYgNC4xNDEuOCA5Ljg3My01LjEgMTUuMTA5LS4xNTEuNTQ1LjA5Mi44MjYuNTE4LjgwOCAxMC40NjEtOC43ODEgOC43NjktMTkuNzg3LS43NDItMjcuMzU4QTE5LjEgMTkuMSAwIDAgMSAxNS44MjggMFoiIHN0eWxlPSJmaWxsOiNmZmYiLz48L3N2Zz4%3D",MA=B`
  width: 120px;
  opacity: 0.8;
  &:hover {
    opacity: 1;
  }
`,EA=B`
  margin-bottom: 18px;
`,LA=B`
  color: #ffffffaa;
  &:hover {
    color: #ffffff;
  }
  display: flex;
  flex-direction: row;
  gap: 1px;
  align-items: center;
  font-size: 1.3rem;
`,Cb=B`
  visibility: hidden;
  font-size: 0.8rem;
  line-height: 100%;
  color: #ffffff99;
  @media (min-width: 1080px) {
    visibility: visible;
  }
`,DA=B`
  display: flex;
  flex-direction: column;
  justify-content: center;
  height: 75%;
  gap: 2px;
  cursor: pointer;
  transition: opacity 0.2s ease;
`,AA=({className:i})=>{const{t:e}=Yt();return v.jsxs("div",{className:X(DA,i),children:[v.jsx("span",{className:Cb,children:e("Score.AlphaTabRenderedBy")}),v.jsx("a",{href:"https://alphatab.net",className:EA,children:v.jsx("img",{src:PA,className:MA})}),v.jsx("span",{className:Cb,children:e("Score.Issues")}),v.jsxs("a",{href:"https://github.com/bali182/gonb/issues/new",className:LA,children:[v.jsx(FD,{})," Github"]})]})};function IA(i){return ct({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M5.88889 16H2C1.44772 16 1 15.5523 1 15V9.00001C1 8.44772 1.44772 8.00001 2 8.00001H5.88889L11.1834 3.66815C11.3971 3.49329 11.7121 3.52479 11.887 3.73851C11.9601 3.82784 12 3.93971 12 4.05513V19.9449C12 20.221 11.7761 20.4449 11.5 20.4449C11.3846 20.4449 11.2727 20.405 11.1834 20.3319L5.88889 16ZM20.4142 12L23.9497 15.5355L22.5355 16.9498L19 13.4142L15.4645 16.9498L14.0503 15.5355L17.5858 12L14.0503 8.46447L15.4645 7.05026L19 10.5858L22.5355 7.05026L23.9497 8.46447L20.4142 12Z"},child:[]}]})(i)}function Af(i){return ct({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M10 7.22049L6.60282 10H3V14H6.60282L10 16.7795V7.22049ZM5.88889 16H2C1.44772 16 1 15.5523 1 15V9.00001C1 8.44772 1.44772 8.00001 2 8.00001H5.88889L11.1834 3.66815C11.3971 3.49329 11.7121 3.52479 11.887 3.73851C11.9601 3.82784 12 3.93971 12 4.05513V19.9449C12 20.221 11.7761 20.4449 11.5 20.4449C11.3846 20.4449 11.2727 20.405 11.1834 20.3319L5.88889 16ZM20.4142 12L23.9497 15.5355L22.5355 16.9498L19 13.4142L15.4645 16.9498L14.0503 15.5355L17.5858 12L14.0503 8.46447L15.4645 7.05026L19 10.5858L22.5355 7.05026L23.9497 8.46447L20.4142 12Z"},child:[]}]})(i)}function RA(i){return ct({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M2 16.0001H5.88889L11.1834 20.3319C11.2727 20.405 11.3846 20.4449 11.5 20.4449C11.7761 20.4449 12 20.2211 12 19.9449V4.05519C12 3.93977 11.9601 3.8279 11.887 3.73857C11.7121 3.52485 11.3971 3.49335 11.1834 3.66821L5.88889 8.00007H2C1.44772 8.00007 1 8.44778 1 9.00007V15.0001C1 15.5524 1.44772 16.0001 2 16.0001ZM23 12C23 15.292 21.5539 18.2463 19.2622 20.2622L17.8445 18.8444C19.7758 17.1937 21 14.7398 21 12C21 9.26016 19.7758 6.80629 17.8445 5.15557L19.2622 3.73779C21.5539 5.75368 23 8.70795 23 12ZM18 12C18 10.0883 17.106 8.38548 15.7133 7.28673L14.2842 8.71584C15.3213 9.43855 16 10.64 16 12C16 13.36 15.3213 14.5614 14.2842 15.2841L15.7133 16.7132C17.106 15.6145 18 13.9116 18 12Z"},child:[]}]})(i)}function If(i){return ct({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M6.60282 10.0001L10 7.22056V16.7796L6.60282 14.0001H3V10.0001H6.60282ZM2 16.0001H5.88889L11.1834 20.3319C11.2727 20.405 11.3846 20.4449 11.5 20.4449C11.7761 20.4449 12 20.2211 12 19.9449V4.05519C12 3.93977 11.9601 3.8279 11.887 3.73857C11.7121 3.52485 11.3971 3.49335 11.1834 3.66821L5.88889 8.00007H2C1.44772 8.00007 1 8.44778 1 9.00007V15.0001C1 15.5524 1.44772 16.0001 2 16.0001ZM23 12C23 15.292 21.5539 18.2463 19.2622 20.2622L17.8445 18.8444C19.7758 17.1937 21 14.7398 21 12C21 9.26016 19.7758 6.80629 17.8445 5.15557L19.2622 3.73779C21.5539 5.75368 23 8.70795 23 12ZM18 12C18 10.0883 17.106 8.38548 15.7133 7.28673L14.2842 8.71584C15.3213 9.43855 16 10.64 16 12C16 13.36 15.3213 14.5614 14.2842 15.2841L15.7133 16.7132C17.106 15.6145 18 13.9116 18 12Z"},child:[]}]})(i)}const OA=B`
  appearance: none;
  background-color: transparent;
  width: 100%;

  &::-webkit-slider-runnable-track {
    height: 6px;
    border-radius: 6px;
  }

  &::-moz-range-track {
    height: 6px;
    border-radius: 6px;
  }

  &::-webkit-slider-thumb {
    box-sizing: border-box;
    appearance: none;
    position: relative;
    border-radius: 50%;
    width: 24px;
    height: 24px;
    top: 50%;
    translate: 0 -50%;
    transition: background-color 0.2s ease, transform 0.2s ease;
    cursor: pointer;
    &:hover {
      transform: scale(1.4);
    }
  }

  &::-moz-range-thumb {
    box-sizing: border-box;
    appearance: none;
    position: relative;
    border-radius: 50%;
    width: 24px;
    height: 24px;
    transition: background-color 0.2s ease, transform 0.2s ease;
    cursor: pointer;
    &:hover {
      transform: scale(1.4);
    }
  }
`,FA=B`
  &::-webkit-slider-runnable-track {
    background-color: #ffffff60;
  }
  &::-moz-range-track {
    background-color: #ffffff60;
  }
  &::-webkit-slider-thumb {
    background-color: #ffffffdd;
    &:hover,
    &:focus {
      background-color: #ffffff;
    }
  }
  &::-moz-range-thumb {
    background-color: #ffffffdd;
    &:hover,
    &:focus {
      background-color: #ffffff;
    }
  }
`,VA=B`
  &::-webkit-slider-runnable-track {
    background-color: #777777;
  }
  &::-moz-range-track {
    background-color: #777777;
  }
  &::-webkit-slider-thumb {
    background-color: #777777;
    &:hover,
    &:focus {
      background-color: #666666;
    }
  }
  &::-moz-range-thumb {
    background-color: #777777;
    &:hover,
    &:focus {
      background-color: #666666;
    }
  }
`,HA=({value:i,min:e,max:t,step:s,color:r,className:n,onChange:a})=>{const o=X(OA,r==="light"?FA:VA,n);return v.jsx("input",{type:"range",className:o,min:e,max:t,step:s,value:i,onChange:l=>a(l.target.valueAsNumber)})},zA=B`
  display: flex;
  flex-direction: row;
  gap: 14px;
  align-items: center;
  justify-content: center;
`,WA=X(jx,B`
    cursor: pointer;
  `),GA=B`
  color: #ffffffdd;
  &:hover {
    color: #ffffff;
  }
`,jA=B`
  color: #000000aa;
  &:hover {
    color: #000000;
  }
`,UA=X(jx,B`
    margin-right: 10px;
    color: #ffffff;
  `),To=({value:i,onChange:e,Icon:t,MuteIcon:s=RA,MaxVolumeIcon:r=IA,sliderTooltip:n,color:a="light"})=>{const o=X(WA,a==="light"?GA:jA);return v.jsxs("div",{className:zA,"data-tooltip":n,children:[!ee(t)&&v.jsx(t,{className:UA,width:"1rem",height:"1rem"}),v.jsx(s,{className:o,onClick:()=>e(0),width:"1rem",height:"1rem"}),v.jsx(HA,{min:0,max:1,step:.02,value:i,onChange:e,color:a}),v.jsx(r,{className:o,onClick:()=>e(1),width:"1rem",height:"1rem"})]})},$A=B`
  display: flex;
  flex-direction: column;
  gap: 10px;
  justify-self: start;
`,YA=()=>{const{metronomeVolume:i,instrumentVolume:e,chordsVolume:t,setMetronomeVolume:s,setInstrumentVolume:r,setChordsVolume:n}=vr();return v.jsxs("div",{className:$A,children:[v.jsx(To,{Icon:Yx,value:i,onChange:s,sliderTooltip:"PlayerTooltips.MetronomeVolume"}),v.jsx(To,{Icon:Xx,value:e,onChange:r,sliderTooltip:"PlayerTooltips.MelodyVolume"}),v.jsx(To,{Icon:B0,value:t,onChange:n,sliderTooltip:"PlayerTooltips.ChordsVolume"})]})},XA=B`
  //.at-wrap
  width: 100vw;
  margin: 0 auto;
  display: flex;
  flex-direction: column;
  overflow: hidden;
  position: relative;

  height: calc(100vh - ${Ng}px);
  @supports (height: 100dvh) {
    height: calc(min(100vh, 100dvh) - ${Ng}px);
  }

  @media ${Xn} {
    height: calc(100vh - ${au}px);
    @supports (height: 100dvh) {
      height: calc(min(100vh, 100dvh) - ${au}px);
    }
  }
`,QA=B`
  left: 200px;
  right: 200px;
  bottom: 30px;
  padding: 30px;
`,JA=B`
  left: 10px;
  right: 10px;
  bottom: 10px;
  padding: 0px;
`,qA=B`
  padding: 0px 20px;
  display: grid;
  grid-template-columns: 1fr 1fr 1fr;
  align-items: center;
  height: 140px;
  background-color: #333;
  box-shadow: rgba(100, 100, 111, 0.2) 0px 7px 29px 0px;
  margin-left: 200px;
  margin-right: 200px;
  margin-bottom: 20px;
  border-radius: 8px;
`,KA=B`
  display: flex;
  flex-direction: row;
  height: 80px;
  background-color: #333;
  box-shadow: rgba(100, 100, 111, 0.2) 0px 7px 29px 0px;
  margin: 0px;
  padding: 0px;
`,ZA=B`
  justify-self: end;
`,eI=()=>{const i=Du(),e=vr(),t=P.useCallback(r=>{e.setScrollAreaDOMElement(r??void 0)},[]),s=P.useCallback(r=>{e.setRootDOMElement(r??void 0)},[]);return P.useEffect(()=>{if(i)return Et;const r=n=>{if(n.code==="Space")return e.playPause();if(n.code==="KeyR")return e.toggleLooping()};return document.addEventListener("keypress",r),()=>document.removeEventListener("keypress",r)}),v.jsxs("div",{className:XA,children:[v.jsx(lA,{isVisible:e.isLoading}),v.jsx(n_,{viewPortStyle:i?JA:QA,setRootCallback:s,setScrollAreaCallback:t}),v.jsxs("div",{className:i?KA:qA,children:[!i&&v.jsx(YA,{}),i?v.jsx(NA,{}):v.jsx(TA,{}),!i&&v.jsx(AA,{className:ZA})]})]})},tI="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbDpzcGFjZT0icHJlc2VydmUiIHdpZHRoPSI1NzUuMzE4IiBoZWlnaHQ9IjQ0Ny4zNjEiIHZpZXdCb3g9IjAgMCAxNTIuMjIgMTE4LjM2NCI%2BPGcgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTc1NC41NjkgMjEzLjkwOCkiPjxwYXRoIGQ9Ik04MDEuMTItMTI1LjM0NXMxLjE3NyA3Ljg2IDUuODY3IDEyLjc2IDEwLjI3IDYuMjg1IDE0LjI4MyA2Ljc1MiIgc3R5bGU9ImZpbGw6bm9uZTtzdHJva2U6IzAwMDtzdHJva2Utd2lkdGg6Ny4xNTtzdHJva2UtbGluZWNhcDpyb3VuZDtzdHJva2UtbGluZWpvaW46cm91bmQ7c3Ryb2tlLWRhc2hhcnJheTpub25lO3BhaW50LW9yZGVyOnN0cm9rZSBmaWxsIG1hcmtlcnM7c3RvcC1jb2xvcjojMDAwIi8%2BPHBhdGggZD0iTTc4OC40NzYtMTUwLjgyOXMtMjkuNzIyIDEuNjQyLTMwLjMyLTE4Ljc1NmMtLjU5OS0yMC4zOTggMjAuMDIzLTI1Ljc4MiAzOS44MDMtMjMuNDU5czYyLjI2MyAzNi45NTggNzcuNTY0IDM3LjUxMyAyNi41MTYtNC4wNzUgMjcuNjA3LTEyLjM2MmMxLjA5LTguMjg3LTkuNTk2LTE4LjM0OS0yMS4xNTQtMTcuNzY5cy0xNC4yODQgNC4xODgtMjcuMDQyIDYuOTIyLTQwLjgxOS04Ljc1Ny00MC44MTktOC43NTciIHN0eWxlPSJmaWxsOm5vbmU7c3Ryb2tlOiMwMDA7c3Ryb2tlLXdpZHRoOjcuMTU7c3Ryb2tlLWxpbmVjYXA6cm91bmQ7c3Ryb2tlLWxpbmVqb2luOnJvdW5kO3N0cm9rZS1kYXNoYXJyYXk6bm9uZTtzdHJva2Utb3BhY2l0eToxO3BhaW50LW9yZGVyOnN0cm9rZSBmaWxsIG1hcmtlcnM7c3RvcC1jb2xvcjojMDAwIi8%2BPHBhdGggZD0iTTc3OC4wNDgtOTkuMTJjMy4zNDMtMjIuNTIgNi41OTUtNDguNzQ2IDE0LjA1OC01NC45NTIgOC40OS02LjkyMSAyMC44MjUtMTEuNTAzIDM2LjU2Mi0xMi42OTJzMzIuNDM2IDUuMDc2IDMzIDcuMDVjLTEyLjkxNiAxLjA5Ni0xOS4xMSAxMS45NjktMTguMTA4IDI1LjAwNy43OTMgMTAuMzE5IDcuMjk4IDE2Ljk0NSAxMS41MTcgMjAuMTA1IDEuNzE5IDEuMjg2IDEuNzYyIDkuMjYzIDIuODA4IDE1LjQ4MyIgc3R5bGU9ImZpbGw6bm9uZTtzdHJva2U6IzAwMDtzdHJva2Utd2lkdGg6Ny4xNTtzdHJva2UtbGluZWNhcDpyb3VuZDtzdHJva2UtbGluZWpvaW46cm91bmQ7c3Ryb2tlLWRhc2hhcnJheTpub25lO3N0cm9rZS1vcGFjaXR5OjE7cGFpbnQtb3JkZXI6c3Ryb2tlIGZpbGwgbWFya2VycztzdG9wLWNvbG9yOiMwMDAiLz48cGF0aCBkPSJNODU0Ljk4LTE1Ny44MzhjNC40MS0xLjMzNyAxNC45NDItLjc0OCAyMS4zODcgMTMuODQ3IDYuODIyIDE1LjQ1Mi4zIDIyLjQxMS4zIDIyLjQxMXMtNC4wMzMtOS43MDMtOC40ODktMTAuMTkzYy00LjQ1NS0uNDktNi4zMjYgMS40ODItMTQuNDIxIDEuMjgtOC4wOTYtLjIwMS0xMC4xOC00Ljc5NC0xMC4xMy05LjIzOS4xMTgtMTAuODA3IDYuOTQ0LTE2Ljc2OSAxMS4zNTMtMTguMTA2IiBzdHlsZT0iZmlsbDpub25lO3N0cm9rZTojMDAwO3N0cm9rZS13aWR0aDo3LjE1O3N0cm9rZS1saW5lY2FwOnJvdW5kO3N0cm9rZS1saW5lam9pbjpyb3VuZDtzdHJva2UtZGFzaGFycmF5Om5vbmU7c3Ryb2tlLW9wYWNpdHk6MTtwYWludC1vcmRlcjpzdHJva2UgZmlsbCBtYXJrZXJzO3N0b3AtY29sb3I6IzAwMCIvPjxjaXJjbGUgY3g9IjgyMy4xMDkiIGN5PSItMTQ5LjM1OSIgcj0iNC44NTMiIHN0eWxlPSJmaWxsOm5vbmU7c3Ryb2tlOiMwMDA7c3Ryb2tlLXdpZHRoOjYuMzgyOTk7c3Ryb2tlLWxpbmVjYXA6cm91bmQ7c3Ryb2tlLWxpbmVqb2luOnJvdW5kO3N0cm9rZS1kYXNoYXJyYXk6bm9uZTtzdHJva2Utb3BhY2l0eToxO3BhaW50LW9yZGVyOnN0cm9rZSBmaWxsIG1hcmtlcnM7c3RvcC1jb2xvcjojMDAwIi8%2BPHBhdGggZD0iTTg2OC44OTYtMTI5LjI5MnMtMy43MSAxMy4xNTgtMTQuMDA0IDE0LjA0NCIgc3R5bGU9ImZpbGw6bm9uZTtzdHJva2U6IzAwMDtzdHJva2Utd2lkdGg6Ny4xNTtzdHJva2UtbGluZWNhcDpyb3VuZDtzdHJva2UtbGluZWpvaW46cm91bmQ7c3Ryb2tlLWRhc2hhcnJheTpub25lO3N0cm9rZS1vcGFjaXR5OjE7cGFpbnQtb3JkZXI6c3Ryb2tlIGZpbGwgbWFya2VycztzdG9wLWNvbG9yOiMwMDAiLz48cGF0aCBkPSJNNzg4LjIwNC0xOTQuOTY2cy0xLjQ2LTUuNzQzIDcuMTE4LTExLjE2OWM4LjU3OC01LjQyNSAyOS4wNTgtNS41MTcgNDQuNDg0LS43MTIgMTUuNDI1IDQuODA0IDIwLjM4IDI0LjY0NSAyMC4zOCAyNC42NDUiIHN0eWxlPSJmaWxsOm5vbmU7c3Ryb2tlOiMwMDA7c3Ryb2tlLXdpZHRoOjcuMTQ5OTk7c3Ryb2tlLWxpbmVjYXA6cm91bmQ7c3Ryb2tlLWxpbmVqb2luOnJvdW5kO3N0cm9rZS1kYXNoYXJyYXk6bm9uZTtzdHJva2Utb3BhY2l0eToxO3BhaW50LW9yZGVyOnN0cm9rZSBmaWxsIG1hcmtlcnM7c3RvcC1jb2xvcjojMDAwIi8%2BPC9nPjwvc3ZnPg%3D%3D",iI=B`
  display: flex;
  flex-direction: row;
  align-items: center;
  margin-right: 60px;
  flex-shrink: 0;
  &:hover,
  &:active,
  &:visited {
    text-decoration: none;
  }
  user-select: none;

  gap: 8px;

  @media ${Xn} {
    gap: 8px;
  }
`,sI=B`
  display: flex;
  flex-direction: column;
  align-items: flex-start;
  gap: 4px;
`,rI=B`
  @media ${Xn} {
    max-width: 18vw;
    max-height: ${au-10}px;
    height: auto;
  }
  width: 100px;
`,nI=X(Gx,B`
    line-height: 90%;
    margin: 0px;
  `),aI=X(Iu,B`
    color: #000000aa;
    line-height: 90%;
    font-weight: normal;
    white-space: nowrap;
  `),oI=()=>{const{t:i}=Yt();return v.jsxs("span",{className:iI,children:[v.jsx("img",{src:tI,className:rI}),v.jsxs("span",{className:sI,children:[v.jsx("h1",{className:nI,children:i("Logo.Name")}),v.jsx("h2",{className:aI,children:i("Logo.Slogan")})]})]})},a_="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA2NDAgNDgwIj48ZyBmaWxsLXJ1bGU9ImV2ZW5vZGQiPjxwYXRoIGZpbGw9IiNmZmYiIGQ9Ik02NDAgNDgwSDBWMGg2NDB6Ii8%2BPHBhdGggZmlsbD0iIzM4OGQwMCIgZD0iTTY0MCA0ODBIMFYzMjBoNjQweiIvPjxwYXRoIGZpbGw9IiNkNDM1MTYiIGQ9Ik02NDAgMTYwLjFIMFYuMWg2NDB6Ii8%2BPC9nPjwvc3ZnPg%3D%3D",o_="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA2NDAgNDgwIj48cGF0aCBmaWxsPSIjMDEyMTY5IiBkPSJNMCAwaDY0MHY0ODBIMHoiLz48cGF0aCBmaWxsPSIjRkZGIiBkPSJtNzUgMCAyNDQgMTgxTDU2MiAwaDc4djYyTDQwMCAyNDFsMjQwIDE3OHY2MWgtODBMMzIwIDMwMSA4MSA0ODBIMHYtNjBsMjM5LTE3OEwwIDY0VjB6Ii8%2BPHBhdGggZmlsbD0iI0M4MTAyRSIgZD0ibTQyNCAyODEgMjE2IDE1OXY0MEwzNjkgMjgxem0tMTg0IDIwIDYgMzVMNTQgNDgwSDB6TTY0MCAwdjNMMzkxIDE5MWwyLTQ0TDU5MCAwek0wIDBsMjM5IDE3NmgtNjBMMCA0MnoiLz48cGF0aCBmaWxsPSIjRkZGIiBkPSJNMjQxIDB2NDgwaDE2MFYwek0wIDE2MHYxNjBoNjQwVjE2MHoiLz48cGF0aCBmaWxsPSIjQzgxMDJFIiBkPSJNMCAxOTN2OTZoNjQwdi05NnpNMjczIDB2NDgwaDk2VjB6Ii8%2BPC9zdmc%2B",lI=B`
  position: relative;
  display: inline-block;
  width: 60px;
  height: 40px;
  overflow: hidden;
`,l_=B`
  position: absolute;
  cursor: pointer;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  transition: 0.4s;
  border-radius: 20px;
  background-repeat: no-repeat;
  background-position: center;
  background-size: 110%;
  background-image: url('${a_}');
`,uI=X(l_,B`
    background-image: url('${o_}');
  `),u_=B`
  position: absolute;
  content: '';
  height: 32px;
  width: 32px;
  left: 4px;
  bottom: 4px;
  transition: 0.4s;
  border-radius: 50%;
  background-color: #ffffff;
`,hI=X(u_,B`
    transform: translateX(20px);
  `),cI=B`
  opacity: 0;
  width: 100%;
  height: 100%;
  position: absolute;
  top: 0;
  left: 0;
  cursor: pointer;
  z-index: 2; /* Ensure the input is on top of the slider */
`,h_=B`
  position: absolute;
  pointer-events: none;
  border-radius: 26px;
  transition: 0.4s;
  top: 0px;
  left: 0px;
  bottom: 0px;
  right: 0px;
`,dI=X(h_,B`
    background: linear-gradient(90deg, #444 0%, transparent 100%);
  `),fI=X(h_,B`
    background: linear-gradient(270deg, #444 0%, transparent 100%);
  `),pI=({language:i,onChange:e})=>{const t=i===Fr.English,s=()=>{const n=!t?Fr.English:Fr.Hungarian;e(n)};return v.jsxs("label",{className:lI,children:[v.jsx("div",{className:t?uI:l_}),v.jsx("div",{className:t?fI:dI}),v.jsx("div",{className:t?hI:u_}),v.jsx("input",{type:"checkbox",checked:t,onChange:Et,onClick:s,className:cI})]})},gI=B`
  display: flex;
  flex-direction: row;
  align-items: center;
  gap: 8px;
  overflow: hidden;
`,Rf=B`
  overflow: hidden;
  flex: 0 1 auto;
`,Of=B`
  white-space: nowrap;
  text-overflow: ellipsis;
  overflow: hidden;
  flex: 0 1 auto;
`,Ff=B`
  flex-shrink: 0;
`,mI=()=>{const{t:i}=Yt(),{language:e,regenerate:t,setSettingsOpen:s,setHelpOpen:r,setLanguage:n}=vr(),a=()=>s(!0),o=()=>r(!0);return v.jsxs("div",{className:gI,children:[v.jsxs(ma,{onClick:t,className:Rf,children:[v.jsx(RD,{className:Ff}),v.jsx("span",{className:Of,children:i("Menu.GenerateNew")})]}),v.jsxs(ma,{onClick:a,className:Rf,children:[v.jsx(Id,{className:Ff}),v.jsxs("span",{className:Of,children:[" ",i("Menu.Settings")]})]}),v.jsxs(ma,{onClick:o,className:Rf,children:[v.jsx(HD,{className:Ff}),v.jsxs("span",{className:Of,children:[" ",i("Menu.Help")]})]}),v.jsx(pI,{onChange:n,language:e})]})},yI=B`
  flex-grow: 1;
  flex-shrink: 1;
  display: flex;
  align-items: center;
  justify-content: flex-end;
`,bI=()=>{const{isSettingsOpen:i,setSettingsOpen:e}=vr(),t=()=>{e(!i)};return v.jsx("div",{className:yI,children:v.jsx(YD,{onClick:t,className:T0})})},SI=B`
  display: flex;
  flex-direction: row;
  align-items: center;
  justify-content: space-between;
  width: 100%;
  height: ${Ng}px;
  padding: 20px 200px;
  @media ${Xn} {
    padding: 10px;
    height: ${au}px;
  }
`,wI=()=>{const i=Du();return v.jsxs("div",{className:SI,children:[v.jsx(oI,{}),i?v.jsx(bI,{}):v.jsx(mI,{})]})},ml="#111",c_=8,ph=c_*2-2,vI=B`
  position: fixed;
  max-width: 400px;
  background-color: ${ml};
  color: #ffffff;
  padding: 5px 10px;
  border-radius: 6px;
  pointer-events: none;
  z-index: 1000;
  visibility: hidden;
  opacity: 0;
  /* transition: opacity 0.1s ease, visibility 0.1s ease; */
`,kI=B`
  position: absolute;
  width: 0;
  height: 0;
  border-style: solid;
  border-width: ${c_}px;
  border-color: transparent;
`,xI={top:B`
    transform: translate(-50%, -100%);
  `,bottom:B`
    transform: translate(-50%, 10px);
  `,left:B`
    transform: translate(-100%, -50%);
  `,right:B`
    transform: translate(10px, -50%);
  `},_I={top:B`
    bottom: -${ph}px;
    left: 50%;
    transform: translateX(-50%);
    border-top-color: ${ml} !important;
  `,bottom:B`
    top: -${ph}px;
    left: 50%;
    transform: translateX(-50%);
    border-bottom-color: ${ml} !important;
  `,left:B`
    right: -${ph}px;
    top: 50%;
    transform: translateY(-50%);
    border-left-color: ${ml} !important;
  `,right:B`
    left: -${ph}px;
    top: 50%;
    transform: translateY(-50%);
    border-right-color: ${ml} !important;
  `},Pb=P.forwardRef(({messageKey:i,x:e,y:t,width:s,height:r,visible:n,position:a},o)=>{const l={top:t,left:e,visibility:n?"visible":"hidden",opacity:n?1:0};!ee(s)&&s>0&&(l.width=s),!ee(r)&&r>0&&(l.height=r);const u=X(vI,ee(a)?void 0:xI[a]),h=X(kI,ee(a)?void 0:_I[a]);return v.jsxs("div",{ref:o,className:u,style:l,children:[v.jsx("div",{className:h}),v.jsx(u0,{i18nKey:i})]})}),TI=(i="data-tooltip")=>{const[e,t]=P.useState();return P.useEffect(()=>{const s=a=>{let o=a.target;for(;o&&o!==document.body;){if(o.hasAttribute(i)){t(o);return}o=o.parentElement}t(void 0)},r=a=>{let o=a.relatedTarget;for(;o&&o!==document.body;){if(o.hasAttribute(i))return;o=o.parentElement}t(void 0)},n=()=>{t(void 0)};return document.addEventListener("mouseover",s),document.addEventListener("mouseout",r),document.addEventListener("wheel",n),document.addEventListener("keydown",n),()=>{document.removeEventListener("mouseover",s),document.removeEventListener("mouseout",r),document.removeEventListener("wheel",n),document.removeEventListener("keydown",n)}},[]),e},Vs=10,NI={top:(i,{spaceAbove:e,spaceLeft:t,spaceRight:s})=>e>i.height+Vs&&t>i.width/2+Vs&&s>i.width/2+Vs,bottom:(i,{spaceBelow:e,spaceLeft:t,spaceRight:s})=>e>i.height+Vs&&t>i.width/2+Vs&&s>i.width/2+Vs,left:(i,{spaceLeft:e,spaceAbove:t,spaceBelow:s})=>e>i.width+Vs&&t>i.height/2+Vs&&s>i.height/2+Vs,right:(i,{spaceRight:e,spaceAbove:t,spaceBelow:s})=>e>i.width+Vs&&t>i.height/2+Vs&&s>i.height/2+Vs},BI=["top","bottom","left","right"];function CI(i,e,t=BI){const s=window.innerWidth,r=window.innerHeight,n={spaceAbove:i.top,spaceBelow:r-i.bottom,spaceLeft:i.left,spaceRight:s-i.right},a=t.find(o=>NI[o](e,n));return ee(a)?(console.error("Can't fit tooltip properly",i),"bottom"):a}function PI(i,e,t){let s=0,r=0;switch(i){case"top":{s=e.left+e.width/2,r=e.top-10;break}case"bottom":{s=e.left+e.width/2,r=e.bottom;break}case"left":{s=e.left-10,r=e.top+e.height/2;break}case"right":{s=e.right,r=e.top+e.height/2;break}}return[s,r]}const MI=document.getElementById("tooltip"),EI=500,LI=300,DI=({disabled:i})=>{const e=P.useRef(null),t=TI(),[s,r]=P.useState(),[n,a]=P.useState(!1),[{position:o,x:l,y:u,width:h,height:c},d]=P.useState({position:"bottom",x:0,y:0,width:0,height:0});return P.useEffect(()=>{let f;return!ee(t)&&!i?(r(t.getAttribute("data-tooltip")),f=setTimeout(()=>a(!0),EI),()=>clearTimeout(f)):(f=setTimeout(()=>a(!1),LI),()=>clearTimeout(f))},[t]),P.useLayoutEffect(()=>{if(ee(e.current)||ee(t)||i)return;const f=e.current.getBoundingClientRect(),p=t.getBoundingClientRect(),g=CI(p,f),[b,m]=PI(g,p);d({position:g,x:b,y:m,width:f.width,height:f.height})},[t,s]),dd.createPortal(v.jsxs(v.Fragment,{children:[v.jsx(Pb,{messageKey:s,visible:n,position:o,x:l,y:u,width:h,height:c}),v.jsx(Pb,{ref:e,messageKey:s,visible:!1,x:1,y:1})]}),MI)},Mg=["C0","C#0","D0","D#0","E0","F0","F#0","G0","G#0","A0","A#0","B0"];function AI(i,e,t){return e.map(s=>{const r=i.useSeventhChords?s.seventh:s.triad,n=i.useSeventhChords?s.seventhName:s.triadName;return{items:[{type:"chord",duration:ne.WHOLE,notes:r.map(o=>`${o}4`),label:i.showChordSymbols?Cx(n,t.language):void 0}]}})}const II=[{value:"chord-tone",weight:5},{value:"chord-scale",weight:10},{value:"random",weight:2}],RI=[{value:"closest",weight:1},{value:"close",weight:2}],OI=[{value:"chord-scale",weight:1},{value:"random",weight:1}],FI=i=>(e,t)=>{const s=Math.abs(Oo(Ro(i,e))),r=Math.abs(Oo(Ro(i,t)));return s-r};function Eg(i,e){const t=e.filter(r=>r!==i);if(t.length===0)return[i];const s=t.sort(FI(i));return s.length===0?[i]:s}function VI(i,e){const s=Array.from(i).reverse().find(e);if(ee(s))throw new Error("No last item found");return s}function Lg(i){return VI(i,e=>e.type==="note")}function HI(i,e,t,s,r){const n=t[s-1],a=e[s],o=e[s+1],l=s===0,u=ee(o),h=[];for(let c=0;c<a.rhythm.length;c+=1){const d=a.rhythm[c];if(d.type===pi.REST){h.push({type:"rest",duration:d.duration});continue}const f=c===0,p=c===a.rhythm.length-1;if(f&&l){h.push(zI(d,a,i));continue}if(f&&!l){h.push(WI(d,a,n,i));continue}if(p&&!u){h.push(XI(d,a,o,i,Lg(h).note));continue}h.push(UI(d,a,i,Lg(h).note))}if(h.length>0&&i.showChordSymbols){const c=h[0],d=i.useSeventhChords?a.chord.seventhName:a.chord.triadName;c.label=Cx(d,r.language)}return{items:h}}function zI(i,e,t){const s=t.clef===ot.BASS?e.chord.bassMelodyNotes:e.chord.triadMelodyNotes,r=ru(s);return{type:"note",duration:i.duration,note:r}}function WI(i,e,t,s){const r=Lg((t==null?void 0:t.items)??[]).note,n=s.clef===ot.BASS?e.chord.bassMelodyNotes:e.chord.triadMelodyNotes,a=Eg(r,n)[0];return{type:"note",duration:i.duration,note:a}}function GI(i,e,t){switch(i){case"chord-tone":return e.seventhMelodyNotes;case"chord-scale":return e.scaleMelodyNotes;case"random":return t.notes}}function jI(i,e,t){switch(e){case"closest":return[Eg(i,t)[0]];case"close":return Eg(i,t).slice(0,4);case"random":return t}}function UI(i,e,t,s){const r=Cc(II),n=Cc(RI),a=GI(r,e.chord,t),o=jI(s,n,a),l=ru(o);return{type:"note",duration:i.duration,note:l}}function $I(i,e,t){switch(i){case"chord-tone":throw new Error("Chord tone is invalid for this application.");case"chord-scale":return e.chord.scaleMelodyNotes;case"random":return t.notes}}function YI(i,e,t){const s=[];for(const n of e){let a=1/0;const o=Math.abs(Oo(Ro(i,n)));for(let l of t){const u=Math.abs(Oo(Ro(l,n)));u<a&&(a=u)}s.push({note:n,distanceToNext:a,distanceToPrevious:o})}const r=s.sort((n,a)=>{let o=n.distanceToNext===0||n.distanceToPrevious===0?1/0:n.distanceToNext+n.distanceToPrevious,l=a.distanceToNext===0||a.distanceToPrevious===0?1/0:a.distanceToNext+a.distanceToPrevious;return o-l});if(r.length===0)throw new Error("Unexpected empty array");return r[0].note}function XI(i,e,t,s,r){const n=Cc(OI),a=$I(n,e,s),o=s.clef===ot.BASS?t.chord.bassMelodyNotes:t.chord.triadMelodyNotes,l=YI(r,a,o);return{type:"note",duration:i.duration,note:l}}function QI(i,e,t){const s=[];for(let r=0;r<e.length;r+=1){const n=HI(i,e,s,r,t);s.push(n)}return s}function JI(i){const e=new Map;for(const t of i)e.has(t.length)||e.set(t.length,[]),e.get(t.length).push(t);return e}function qI(i,e){if(i.bars===0)return[];if(e.length===0)throw new Error("No templates!");const t=JI(e),s=Array.from(t.keys()).sort((o,l)=>l-o),r=e.some(o=>o.length===1&&o[0]==="Tonic"),n=r?i.bars-1:i.bars,a=[];for(;a.length<n;){const o=s.find(h=>a.length+h<=n);if(ee(o))throw new Error("No matching length");const l=t.get(o)??[],u=ru(l);if(ee(u))throw new Error("Template was null or undefined");a.push(...u)}return r&&a.push("Tonic"),a}var d_={empty:!0,name:"",chordType:""},Mb={};function Dc(i){return typeof i=="string"?Mb[i]||(Mb[i]=iR(i)):typeof i=="number"?Dc(C0[i]||""):g0(i)?KI(i):p0(i)?Dc(i.name):d_}function KI(i){return Dc(m0(i.alt)+C0[i.step])}var ZI=/^(#{1,}|b{1,}|x{1,}|)(IV|I{1,3}|VI{0,2}|iv|i{1,3}|vi{0,2})([^IViv]*)$/;function eR(i){return ZI.exec(i)||["","","",""]}var tR="I II III IV V VI VII",C0=tR.split(" ");function iR(i){const[e,t,s,r]=eR(i);if(!s)return d_;const n=s.toUpperCase(),a=C0.indexOf(n),o=vx(t),l=1;return{empty:!1,name:e,roman:s,interval:dn({step:a,alt:o,dir:l}).name,acc:t,chordType:r,alt:o,step:a,major:s===n,oct:0,dir:l}}var Fi=Object.freeze([]),sR={type:"major",tonic:"",alteration:0,keySignature:""},rR={tonic:"",grades:Fi,intervals:Fi,scale:Fi,triads:Fi,chords:Fi,chordsHarmonicFunction:Fi,chordScales:Fi,secondaryDominants:Fi,secondaryDominantSupertonics:Fi,substituteDominantsMinorRelative:Fi,substituteDominants:Fi,substituteDominantSupertonics:Fi,secondaryDominantsMinorRelative:Fi},nR={...sR,...rR,type:"major",minorRelative:"",scale:Fi,substituteDominants:Fi,secondaryDominantSupertonics:Fi,substituteDominantsMinorRelative:Fi},Vf=(i,e,t="")=>e.map((s,r)=>`${i[r]}${t}${s}`);function aR(i,e,t,s,r){return n=>{const a=i.map(f=>Dc(f).interval||""),o=a.map(f=>_o(n,f)),l=Vf(o,t),u=o.map(f=>_o(f,"5P")).map(f=>o.includes(f)&&!l.includes(f+"7")?f+"7":""),h=Eb(u,e),c=u.map(f=>{if(!f)return"";const p=f.slice(0,-1);return _o(p,"5d")+"7"}),d=Eb(c,e);return{tonic:n,grades:i,intervals:a,scale:o,triads:Vf(o,e),chords:l,chordsHarmonicFunction:s.slice(),chordScales:Vf(o,r," "),secondaryDominants:u,secondaryDominantSupertonics:h,substituteDominants:c,substituteDominantSupertonics:d,secondaryDominantsMinorRelative:h,substituteDominantsMinorRelative:d}}}var Eb=(i,e)=>i.map((t,s)=>{if(!t)return"";const r=t.slice(0,-1),n=_o(r,"5P");return e[s].endsWith("m")?n+"m7":n+"m7b5"}),oR=(i,e)=>{const t=Di(i),s=Di(e);return t.empty||s.empty?0:s.coord[0]-t.coord[0]},lR=aR("I II III IV V VI VII".split(" ")," m m   m dim".split(" "),"maj7 m7 m7 maj7 7 m7 m7b5".split(" "),"T SD T SD D T D".split(" "),"major,dorian,phrygian,lydian,mixolydian,minor,locrian".split(","));function uR(i){const e=Di(i).pc;if(!e)return nR;const t=lR(e),s=oR("C",e);return{...t,type:"major",minorRelative:_o(e,"-3m"),alteration:s,keySignature:m0(s)}}function hR(i){switch(i){case"T":return"Tonic";case"SD":return"SubDominant";case"D":return"Dominant"}}function Hf(i,e){return i.flatMap(t=>e.filter(s=>Fo(t,s))).sort(w0)}function cR(i,e){if(e.length===0)return[];const t=i.tonic??i.notes[0],s=e.filter(a=>Fo(t,a));if(s.length>0)return s;const r=i.intervals.findIndex(a=>a==="5P"||a==="5A"||a==="5d"),n=i.notes[r];if(!ee(n)){const a=e.filter(o=>Fo(n,o));if(a.length>0)return a}return e}function f_(i,e,t,s,r){const n=vg(t),a=vg(e),o=Hf(a.notes,r),l=cR(a,o);return{seventhName:t,triadName:e,seventh:n.notes,triad:a.notes,harmonicFunction:s,scale:i,bassMelodyNotes:l,triadMelodyNotes:o,seventhMelodyNotes:Hf(n.notes,r),scaleMelodyNotes:Hf(i,r)}}function dR(i){const e=uR(i.keySignature),t=e.chordsHarmonicFunction;return e.triads.map((s,r)=>f_(e.scale,s,e.chords[r],hR(t[r]),i.notes)).filter(s=>s.triadMelodyNotes.length>0)}const fR=[["Tonic","Dominant","Tonic","SubDominant"],["Tonic","SubDominant","Tonic","Dominant"],["Tonic","SubDominant","Dominant","SubDominant"],["Tonic","Tonic","SubDominant","Dominant"],["Tonic","SubDominant","SecondaryDominant","Tonic"],["Tonic","SubDominant","SecondaryDominant","Dominant"],["Tonic","SubDominant","SecondaryDominant","SubDominant"]],pR=[["Tonic","SubDominant","Dominant"],["Tonic","SecondaryDominant","Dominant"],["Tonic","SecondaryDominant","SubDominant"],["Tonic","Dominant","SubDominant"],["Tonic","Tonic","SubDominant"],["Tonic","Tonic","Dominant"]],gR=[["Tonic","Dominant"],["Tonic","SubDominant"]],mR=[["Tonic"],["SubDominant"],["Dominant"]],yR=[...fR,...pR,...gR,...mR];function bR(i,e,t,s=yR){const r=[];e:for(let n=0;n<s.length;n+=1){const a=s[n];if(!(a.length>i.bars)){for(let o=0;o<a.length;o+=1){const l=a[o];if(l==="SecondaryDominant"){const u=a[o+1];if(ee(u))throw new Error("Secondary dominant cannot be the last chord");if(e.filter(d=>d.harmonicFunction===u).map(d=>t.get(d)).filter(Ca).length===0)continue e}else if(e.every(u=>u.harmonicFunction!==l))continue e}r.push(a)}}return r}function SR(i,e){const t=new Map;for(const s of e){if(s.triadName.includes("dim"))continue;const r=s.triad[2],n=`${r}7`;if(e.some(l=>l.triadName===r&&l.seventhName===n))continue;const a=Eu(`${r} mixolydian`).notes,o=f_(a,r,n,"SecondaryDominant",i.notes);o.triadMelodyNotes.length>0&&t.set(s,o)}return t}function wR(i){const e=new Map,t=["Tonic","SubDominant","Dominant"];for(const s of t)e.set(s,i.filter(r=>r.harmonicFunction===s));return e}function vR(i){const e=dR(i),t=SR(i,e),s=bR(i,e,t),r=qI(i,s),n=wR(e),a=[];for(let o=0;o<r.length;o+=1){const l=r[o];if(l==="SecondaryDominant"){const u=r[o+1];if(ee(u))throw new Error("Secondary dominant cannot be the last chord");if(u==="SecondaryDominant")throw new Error("Consequitive secondary dominants are not supported");const h=e.filter(f=>t.has(f)),c=ru(h);if(ee(c))throw new Error(`No secondary dominant for chord function "${u}"`);const d=t.get(c);a.push(d,c),o+=1}else{const u=n.get(l);a.push(ru(u))}}return a}typeof BigInt>"u"&&(BigInt=function(i){if(isNaN(i))throw new Error("");return i});const Oe=BigInt(0),$e=BigInt(1),ou=BigInt(2),Dg=BigInt(5),os=BigInt(10),kR=2e3,ce={s:$e,n:Oe,d:$e};function Gr(i,e){try{i=BigInt(i)}catch{throw Bn()}return i*e}function tr(i){return typeof i=="bigint"?i:Math.floor(i)}function Ft(i,e){if(e===Oe)throw P0();const t=Object.create(bi.prototype);t.s=i<Oe?-$e:$e,i=i<Oe?-i:i;const s=fo(i,e);return t.n=i/s,t.d=e/s,t}function Lb(i){const e={};let t=i,s=ou,r=Dg-$e;for(;r<=t;){for(;t%s===Oe;)t/=s,e[s]=(e[s]||Oe)+$e;r+=$e+ou*s++}return t!==i?t>1&&(e[t]=(e[t]||Oe)+$e):e[i]=(e[i]||Oe)+$e,e}const Ri=function(i,e){let t=Oe,s=$e,r=$e;if(i!=null)if(e!==void 0){if(typeof i=="bigint")t=i;else{if(isNaN(i))throw Bn();if(i%1!==0)throw Db();t=BigInt(i)}if(typeof e=="bigint")s=e;else{if(isNaN(e))throw Bn();if(e%1!==0)throw Db();s=BigInt(e)}r=t*s}else if(typeof i=="object"){if("d"in i&&"n"in i)t=BigInt(i.n),s=BigInt(i.d),"s"in i&&(t*=BigInt(i.s));else if(0 in i)t=BigInt(i[0]),1 in i&&(s=BigInt(i[1]));else if(typeof i=="bigint")t=i;else throw Bn();r=t*s}else if(typeof i=="number"){if(isNaN(i))throw Bn();if(i<0&&(r=-$e,i=-i),i%1===0)t=BigInt(i);else if(i>0){let n=1,a=0,o=1,l=1,u=1,h=1e7;for(i>=1&&(n=10**Math.floor(1+Math.log10(i)),i/=n);o<=h&&u<=h;){let c=(a+l)/(o+u);if(i===c){o+u<=h?(t=a+l,s=o+u):u>o?(t=l,s=u):(t=a,s=o);break}else i>c?(a+=l,o+=u):(l+=a,u+=o),o>h?(t=l,s=u):(t=a,s=o)}t=BigInt(t)*BigInt(n),s=BigInt(s)}}else if(typeof i=="string"){let n=0,a=Oe,o=Oe,l=Oe,u=$e,h=$e,c=i.replace(/_/g,"").match(/\d+|./g);if(c===null)throw Bn();if(c[n]==="-"?(r=-$e,n++):c[n]==="+"&&n++,c.length===n+1?o=Gr(c[n++],r):c[n+1]==="."||c[n]==="."?(c[n]!=="."&&(a=Gr(c[n++],r)),n++,(n+1===c.length||c[n+1]==="("&&c[n+3]===")"||c[n+1]==="'"&&c[n+3]==="'")&&(o=Gr(c[n],r),u=os**BigInt(c[n].length),n++),(c[n]==="("&&c[n+2]===")"||c[n]==="'"&&c[n+2]==="'")&&(l=Gr(c[n+1],r),h=os**BigInt(c[n+1].length)-$e,n+=3)):c[n+1]==="/"||c[n+1]===":"?(o=Gr(c[n],r),u=Gr(c[n+2],$e),n+=3):c[n+3]==="/"&&c[n+1]===" "&&(a=Gr(c[n],r),o=Gr(c[n+2],r),u=Gr(c[n+4],$e),n+=5),c.length<=n)s=u*h,r=t=l+s*a+h*o;else throw Bn()}else if(typeof i=="bigint")t=i,r=i,s=$e;else throw Bn();if(s===Oe)throw P0();ce.s=r<Oe?-$e:$e,ce.n=t<Oe?-t:t,ce.d=s<Oe?-s:s};function xR(i,e,t){let s=$e;for(;e>Oe;i=i*i%t,e>>=$e)e&$e&&(s=s*i%t);return s}function _R(i,e){for(;e%ou===Oe;e/=ou);for(;e%Dg===Oe;e/=Dg);if(e===$e)return Oe;let t=os%e,s=1;for(;t!==$e;s++)if(t=t*os%e,s>kR)return Oe;return BigInt(s)}function TR(i,e,t){let s=$e,r=xR(os,t,e);for(let n=0;n<300;n++){if(s===r)return BigInt(n);s=s*os%e,r=r*os%e}return 0}function fo(i,e){if(!i)return e;if(!e)return i;for(;;){if(i%=e,!i)return e;if(e%=i,!e)return i}}function bi(i,e){if(Ri(i,e),this instanceof bi)i=fo(ce.d,ce.n),this.s=ce.s,this.n=ce.n/i,this.d=ce.d/i;else return Ft(ce.s*ce.n,ce.d)}var P0=function(){return new Error("Division by Zero")},Bn=function(){return new Error("Invalid argument")},Db=function(){return new Error("Parameters must be integer")};bi.prototype={s:$e,n:Oe,d:$e,abs:function(){return Ft(this.n,this.d)},neg:function(){return Ft(-this.s*this.n,this.d)},add:function(i,e){return Ri(i,e),Ft(this.s*this.n*ce.d+ce.s*this.d*ce.n,this.d*ce.d)},sub:function(i,e){return Ri(i,e),Ft(this.s*this.n*ce.d-ce.s*this.d*ce.n,this.d*ce.d)},mul:function(i,e){return Ri(i,e),Ft(this.s*ce.s*this.n*ce.n,this.d*ce.d)},div:function(i,e){return Ri(i,e),Ft(this.s*ce.s*this.n*ce.d,this.d*ce.n)},clone:function(){return Ft(this.s*this.n,this.d)},mod:function(i,e){if(i===void 0)return Ft(this.s*this.n%this.d,$e);if(Ri(i,e),Oe===ce.n*this.d)throw P0();return Ft(this.s*(ce.d*this.n)%(ce.n*this.d),ce.d*this.d)},gcd:function(i,e){return Ri(i,e),Ft(fo(ce.n,this.n)*fo(ce.d,this.d),ce.d*this.d)},lcm:function(i,e){return Ri(i,e),ce.n===Oe&&this.n===Oe?Ft(Oe,$e):Ft(ce.n*this.n,fo(ce.n,this.n)*fo(ce.d,this.d))},inverse:function(){return Ft(this.s*this.d,this.n)},pow:function(i,e){if(Ri(i,e),ce.d===$e)return ce.s<Oe?Ft((this.s*this.d)**ce.n,this.n**ce.n):Ft((this.s*this.n)**ce.n,this.d**ce.n);if(this.s<Oe)return null;let t=Lb(this.n),s=Lb(this.d),r=$e,n=$e;for(let a in t)if(a!=="1"){if(a==="0"){r=Oe;break}if(t[a]*=ce.n,t[a]%ce.d===Oe)t[a]/=ce.d;else return null;r*=BigInt(a)**t[a]}for(let a in s)if(a!=="1"){if(s[a]*=ce.n,s[a]%ce.d===Oe)s[a]/=ce.d;else return null;n*=BigInt(a)**s[a]}return ce.s<Oe?Ft(n,r):Ft(r,n)},equals:function(i,e){return Ri(i,e),this.s*this.n*ce.d===ce.s*ce.n*this.d},lt:function(i,e){return Ri(i,e),this.s*this.n*ce.d<ce.s*ce.n*this.d},lte:function(i,e){return Ri(i,e),this.s*this.n*ce.d<=ce.s*ce.n*this.d},gt:function(i,e){return Ri(i,e),this.s*this.n*ce.d>ce.s*ce.n*this.d},gte:function(i,e){return Ri(i,e),this.s*this.n*ce.d>=ce.s*ce.n*this.d},compare:function(i,e){Ri(i,e);let t=this.s*this.n*ce.d-ce.s*ce.n*this.d;return(Oe<t)-(t<Oe)},ceil:function(i){return i=os**BigInt(i||0),Ft(tr(this.s*i*this.n/this.d)+(i*this.n%this.d>Oe&&this.s>=Oe?$e:Oe),i)},floor:function(i){return i=os**BigInt(i||0),Ft(tr(this.s*i*this.n/this.d)-(i*this.n%this.d>Oe&&this.s<Oe?$e:Oe),i)},round:function(i){return i=os**BigInt(i||0),Ft(tr(this.s*i*this.n/this.d)+this.s*((this.s>=Oe?$e:Oe)+ou*(i*this.n%this.d)>this.d?$e:Oe),i)},roundTo:function(i,e){Ri(i,e);const t=this.n*ce.d,s=this.d*ce.n,r=t%s;let n=tr(t/s);return r+r>=s&&n++,Ft(this.s*n*ce.n,ce.d)},divisible:function(i,e){return Ri(i,e),!(!(ce.n*this.d)||this.n*ce.d%(ce.n*this.d))},valueOf:function(){return Number(this.s*this.n)/Number(this.d)},toString:function(i){let e=this.n,t=this.d;i=i||15;let s=_R(e,t),r=TR(e,t,s),n=this.s<Oe?"-":"";if(n+=tr(e/t),e%=t,e*=os,e&&(n+="."),s){for(let a=r;a--;)n+=tr(e/t),e%=t,e*=os;n+="(";for(let a=s;a--;)n+=tr(e/t),e%=t,e*=os;n+=")"}else for(let a=i;e&&a--;)n+=tr(e/t),e%=t,e*=os;return n},toFraction:function(i){let e=this.n,t=this.d,s=this.s<Oe?"-":"";if(t===$e)s+=e;else{let r=tr(e/t);i&&r>Oe&&(s+=r,s+=" ",e%=t),s+=e,s+="/",s+=t}return s},toLatex:function(i){let e=this.n,t=this.d,s=this.s<Oe?"-":"";if(t===$e)s+=e;else{let r=tr(e/t);i&&r>Oe&&(s+=r,e%=t),s+="\\frac{",s+=e,s+="}{",s+=t,s+="}"}return s},toContinued:function(){let i=this.n,e=this.d,t=[];do{t.push(tr(i/e));let s=i%e;i=e,e=s}while(i!==$e);return t},simplify:function(i){i=i||.001;const e=this.abs(),t=e.toContinued();for(let s=1;s<t.length;s++){let r=Ft(t[s-1],$e);for(let n=s-2;n>=0;n--)r=r.inverse().add(t[n]);if(Math.abs(r.sub(e).valueOf())<i)return r.mul(this.s)}return this}};function NR(i,e,t,s){const r=i.filter(({value:n})=>e.add(n.length).lte(t));return s===0?r.filter(n=>n.value.type===pi.NOTE):r}function BR(i,e){const t=[];let s=new bi(0,1),r=0;const n=new bi(i.timeSignature.upper,i.timeSignature.lower);for(;s.lt(n);){const a=NR(e,s,n,r);if(a.length===0){const{n:l,d:u}=n.sub(s),h=Object.keys(i.noteDurations),c=Object.keys(i.restDurations);throw new Error(`${l}/${u} duration remains, but no rhytms fit (notes: ${h}, rests: ${c}`)}const o=Cc(a);for(let l=0;l<o.cluster;l+=1)t.push({duration:o.duration,type:o.type});s=s.add(o.length),r+=1}return t}const wi={[ne.WHOLE]:new bi(1,1),[ne.DOTTED_WHOLE]:new bi(3,2),[ne.HALF]:new bi(1,2),[ne.DOTTED_HALF]:new bi(3,4),[ne.QUARTER]:new bi(1,4),[ne.DOTTED_QUARTER]:new bi(3,8),[ne.EIGHTH]:new bi(1,8),[ne.DOTTED_EIGHT]:new bi(3,16),[ne.SIXTEENTH]:new bi(1,16),[ne.DOTTED_SIXTEENTH]:new bi(3,32)};function Ab(i,e=1){const t=wi[i];return e===1?t:t.mul(e)}const CR={[Bt.FREQUENT]:1e3,[Bt.MODERATE]:500,[Bt.INFREQUENT]:100},PR={[Bt.FREQUENT]:500,[Bt.MODERATE]:100,[Bt.INFREQUENT]:50};function Ib(i,e){const t=[],s=Object.entries(i),r=e===pi.NOTE?CR:PR;for(const[n,{cluster:a,frequency:o}]of s){const l=Ab(n,a),u=r[o],h={duration:n,cluster:a,type:e,length:l};if(t.push({value:h,weight:u}),a>1){const c=Ab(n),d={cluster:1,duration:n,length:c,type:e};t.push({value:d,weight:1})}}return t}function MR(i){return[...Ib(i.noteDurations,pi.NOTE),...Ib(i.restDurations,pi.REST)].sort((e,t)=>e.weight-t.weight)}function ER(i){const e=[],t=MR(i);for(let s=0;s<i.bars;s+=1)e.push(BR(i,t));return e}function LR(i){const e=vR(i),t=AI(i,e,Wh),s=ER(i),r=e.map((l,u)=>({chord:l,rhythm:s[u]})),a={name:"melody",shortName:"m",bars:QI(i,r,Wh),clef:i.clef,instrument:i.clef===ot.BASS?"AcousticBass":"AcousticGuitarSteel",keySignature:i.keySignature,timeSignature:i.timeSignature,tuning:Mg,staff:"score"},o={bars:t,name:"chords",shortName:"c",clef:ot.TREBLE,instrument:"AcousticGuitarSteel",keySignature:i.keySignature,timeSignature:i.timeSignature,tuning:Mg,staff:"score"};return{title:Wh.t("Score.MelodyIn",{key:i.keySignature}),music:"Édes Balázs",tempo:i.tempo,tracks:[a,o]}}function M0(i){switch(i){case ne.DOTTED_WHOLE:case ne.DOTTED_HALF:case ne.DOTTED_QUARTER:case ne.DOTTED_EIGHT:case ne.DOTTED_SIXTEENTH:return!0;case ne.WHOLE:case ne.HALF:case ne.QUARTER:case ne.EIGHTH:case ne.SIXTEENTH:return!1}}function E0(i){switch(i){case ne.DOTTED_WHOLE:case ne.WHOLE:return 1;case ne.HALF:case ne.DOTTED_HALF:return 2;case ne.QUARTER:case ne.DOTTED_QUARTER:return 4;case ne.EIGHTH:case ne.DOTTED_EIGHT:return 8;case ne.SIXTEENTH:case ne.DOTTED_SIXTEENTH:return 16}}function DR(i,e){let t=0,s=1/0;for(let r=0;r<e.length;r+=1){const n=e[r],a=Math.abs(Oo(Ro(Ba(n),i)));a<s&&(s=a,t=r)}return[e[t],t]}function p_(i,e){const t=Ba(i),[s,r]=DR(t,e),n=Oo(Ro(s,i));return{string:r+1,fret:n}}function AR(i){return[...Ex()?[]:[ee(i.title)?void 0:`\\title "${i.title}"`,ee(i.subtitle)?void 0:`\\subtitle "${i.subtitle}"`,ee(i.artist)?void 0:`\\artist "${i.artist}"`,ee(i.album)?void 0:`\\album "${i.album}"`,ee(i.words)?void 0:`\\words "${i.words}"`,ee(i.music)?void 0:`\\music "${i.music}"`,ee(i.copyright)?void 0:`\\copyright "${i.copyright}"`],`\\tempo ${i.tempo??120}`].filter(Ca)}function IR(i){return[`\\track "${i.name}" "${i.shortName}"`,ee(i.staff)||i.staff==="both"?void 0:`\\staff{${i.staff}}`,i.instrument?`\\instrument "${i.instrument}"`:void 0,`\\tuning ${i.tuning.join(" ")}`].filter(Ca)}function L0(i){if(i.filter(Ca).length!==0)return` {${i.join(" ")}}`}function RR({duration:i,note:e,label:t},s){const{fret:r,string:n}=p_(e,s),a=E0(i),o=L0([M0(i)?"d":void 0,ee(t)?void 0:`ch "${t}"`]);return`${r}.${n}.${a}${ee(o)?"":o}`}function OR({duration:i,label:e}){const t=L0([M0(i)?"d":void 0,ee(e)?void 0:`ch "${e}"`]);return`r.${E0(i)}${ee(t)?"":t}`}function FR(i,e){const t=i.notes.map(n=>{const{fret:a,string:o}=p_(n,e);return`${a}.${o}`}),s=L0([M0(i.duration)?"d":void 0,ee(i.label)?void 0:`ch "${i.label}"`]),r=E0(i.duration);return`(${t.join(" ")}).${r}${ee(s)?"":s}`}function VR(i,e){switch(i.type){case"note":return RR(i,e);case"rest":return OR(i);case"chord":return FR(i,e)}}function Rb(i,e){return i.items.map(t=>VR(t,e)).join(" ")}function HR(i){if(i.bars.length===0)return[];const e=[`\\clef ${i.clef}`,`\\ts ${i.timeSignature.upper} ${i.timeSignature.lower}`,`\\ks ${i.keySignature}`].join(" "),[t,...s]=i.bars;return[`${e} ${Rb(t,i.tuning)}`,...s.map(n=>Rb(n,i.tuning))]}function zR(i){return[IR(i).join(" "),HR(i).join(" | ")].join(`
`)}function g_(i){return[AR(i).join(" "),".",...i.tracks.map(t=>`${zR(t)}`)].join(`
`)}const WR=f0([Vr.selectSlice],i=>LR(i)),GR=f0([WR],i=>g_(i));var rn;(function(i){i[i.Page=0]="Page",i[i.Horizontal=1]="Horizontal"})(rn||(rn={}));var Yr;(function(i){i[i.Default=0]="Default",i[i.ScoreTab=1]="ScoreTab",i[i.Score=2]="Score",i[i.Tab=3]="Tab",i[i.TabMixed=4]="TabMixed"})(Yr||(Yr={}));class Kr{static getValue(e){return Kr._values||(Kr._values=new Map),e=e.toLowerCase().replaceAll(" ",""),Kr._values.has(e)?Kr._values.get(e):0}static isPiano(e){return e<=7||e>=16&&e<=23}static isGuitar(e){return e>=24&&e<=39||e===105||e===43}}Kr._values=new Map([["acousticgrandpiano",0],["brightacousticpiano",1],["electricgrandpiano",2],["honkytonkpiano",3],["electricpiano1",4],["electricpiano2",5],["harpsichord",6],["clavinet",7],["celesta",8],["glockenspiel",9],["musicbox",10],["vibraphone",11],["marimba",12],["xylophone",13],["tubularbells",14],["dulcimer",15],["drawbarorgan",16],["percussiveorgan",17],["rockorgan",18],["churchorgan",19],["reedorgan",20],["accordion",21],["harmonica",22],["tangoaccordion",23],["acousticguitarnylon",24],["acousticguitarsteel",25],["electricguitarjazz",26],["electricguitarclean",27],["electricguitarmuted",28],["overdrivenguitar",29],["distortionguitar",30],["guitarharmonics",31],["acousticbass",32],["electricbassfinger",33],["electricbasspick",34],["fretlessbass",35],["slapbass1",36],["slapbass2",37],["synthbass1",38],["synthbass2",39],["violin",40],["viola",41],["cello",42],["contrabass",43],["tremolostrings",44],["pizzicatostrings",45],["orchestralharp",46],["timpani",47],["stringensemble1",48],["stringensemble2",49],["synthstrings1",50],["synthstrings2",51],["choiraahs",52],["voiceoohs",53],["synthvoice",54],["orchestrahit",55],["trumpet",56],["trombone",57],["tuba",58],["mutedtrumpet",59],["frenchhorn",60],["brasssection",61],["synthbrass1",62],["synthbrass2",63],["sopranosax",64],["altosax",65],["tenorsax",66],["baritonesax",67],["oboe",68],["englishhorn",69],["bassoon",70],["clarinet",71],["piccolo",72],["flute",73],["recorder",74],["panflute",75],["blownbottle",76],["shakuhachi",77],["whistle",78],["ocarina",79],["lead1square",80],["lead2sawtooth",81],["lead3calliope",82],["lead4chiff",83],["lead5charang",84],["lead6voice",85],["lead7fifths",86],["lead8bassandlead",87],["pad1newage",88],["pad2warm",89],["pad3polysynth",90],["pad4choir",91],["pad5bowed",92],["pad6metallic",93],["pad7halo",94],["pad8sweep",95],["fx1rain",96],["fx2soundtrack",97],["fx3crystal",98],["fx4atmosphere",99],["fx5brightness",100],["fx6goblins",101],["fx7echoes",102],["fx8scifi",103],["sitar",104],["banjo",105],["shamisen",106],["koto",107],["kalimba",108],["bagpipe",109],["fiddle",110],["shanai",111],["tinklebell",112],["agogo",113],["steeldrums",114],["woodblock",115],["taikodrum",116],["melodictom",117],["synthdrum",118],["reversecymbal",119],["guitarfretnoise",120],["breathnoise",121],["seashore",122],["birdtweet",123],["telephonering",124],["helicopter",125],["applause",126],["gunshot",127]]);class Qo{init(e,t){this.data=e,this.settings=t}}var ri;(function(i){i[i.General=0]="General",i[i.Format=1]="Format",i[i.AlphaTex=2]="AlphaTex"})(ri||(ri={}));class ni extends Error{constructor(e,t="",s){super(t??"",{cause:s}),this.type=e,Object.setPrototypeOf(this,ni.prototype)}}class yt extends ni{constructor(e=null,t){super(ri.Format,e??"Unsupported format",t),Object.setPrototypeOf(this,yt.prototype)}}var _t;(function(i){i[i.None=0]="None",i[i.Normal=1]="Normal",i[i.Heavy=2]="Heavy",i[i.Tenuto=3]="Tenuto"})(_t||(_t={}));var jt;(function(i){i[i.Tempo=0]="Tempo",i[i.Volume=1]="Volume",i[i.Instrument=2]="Instrument",i[i.Balance=3]="Balance"})(jt||(jt={}));class vi{constructor(){this.isLinear=!1,this.type=jt.Tempo,this.value=0,this.ratioPosition=0,this.text=""}static buildTempoAutomation(e,t,s,r){(r<1||r>5)&&(r=2);let n=new Float32Array([1,.5,1,1.5,2,3]),a=new vi;return a.type=jt.Tempo,a.isLinear=e,a.ratioPosition=t,a.value=s*n[r],a}static buildInstrumentAutomation(e,t,s){let r=new vi;return r.type=jt.Instrument,r.isLinear=e,r.ratioPosition=t,r.value=s,r}}var ve;(function(i){i[i.Neutral=0]="Neutral",i[i.C3=1]="C3",i[i.C4=2]="C4",i[i.F4=3]="F4",i[i.G2=4]="G2"})(ve||(ve={}));var Ue;(function(i){i[i._15ma=0]="_15ma",i[i._8va=1]="_8va",i[i.Regular=2]="Regular",i[i._8vb=3]="_8vb",i[i._15mb=4]="_15mb"})(Ue||(Ue={}));var Es;(function(i){i[i.None=0]="None",i[i.Simple=1]="Simple",i[i.FirstOfDouble=2]="FirstOfDouble",i[i.SecondOfDouble=3]="SecondOfDouble"})(Es||(Es={}));class Sn{constructor(){this.id=Sn._globalBarId++,this.index=0,this.nextBar=null,this.previousBar=null,this.clef=ve.G2,this.clefOttava=Ue.Regular,this.voices=[],this.simileMark=Es.None,this.isMultiVoice=!1,this.displayScale=1,this.displayWidth=-1}get masterBar(){return this.staff.track.score.masterBars[this.index]}get isEmpty(){for(let e=0,t=this.voices.length;e<t;e++)if(!this.voices[e].isEmpty)return!1;return!0}addVoice(e){e.bar=this,e.index=this.voices.length,this.voices.push(e)}finish(e,t=null){this.isMultiVoice=!1;for(let s=0,r=this.voices.length;s<r;s++){let n=this.voices[s];n.finish(e,t),s>0&&!n.isEmpty&&(this.isMultiVoice=!0)}}calculateDuration(){let e=0;for(let t of this.voices){let s=t.calculateDuration();s>e&&(e=s)}return e}}Sn._globalBarId=0;class ke{static ticksToMillis(e,t){return e*(6e4/(t*ke.QuarterTime))|0}static millisToTicks(e,t){return e/(6e4/(t*ke.QuarterTime))|0}static toTicks(e){return ke.valueToTicks(e)}static valueToTicks(e){let t=e;return t<0&&(t=1/-t),ke.QuarterTime*(4/t)|0}static applyDot(e,t){return t?e+(e/4|0)*3:e+(e/2|0)}static applyTuplet(e,t,s){return e*s/t|0}static removeTuplet(e,t,s){return e*t/s|0}static dynamicToVelocity(e){return ke.MinVelocity+e*ke.VelocityIncrement}}ke.QuarterTime=960;ke.MinVelocity=15;ke.VelocityIncrement=16;class G{constructor(e=0,t=0){this.offset=e,this.value=t}}G.MaxPosition=60;G.MaxValue=12;var qe;(function(i){i[i.Default=0]="Default",i[i.Gradual=1]="Gradual",i[i.Fast=2]="Fast"})(qe||(qe={}));var se;(function(i){i[i.None=0]="None",i[i.Custom=1]="Custom",i[i.Bend=2]="Bend",i[i.Release=3]="Release",i[i.BendRelease=4]="BendRelease",i[i.Hold=5]="Hold",i[i.Prebend=6]="Prebend",i[i.PrebendBend=7]="PrebendBend",i[i.PrebendRelease=8]="PrebendRelease"})(se||(se={}));var ut;(function(i){i[i.None=0]="None",i[i.BrushUp=1]="BrushUp",i[i.BrushDown=2]="BrushDown",i[i.ArpeggioUp=3]="ArpeggioUp",i[i.ArpeggioDown=4]="ArpeggioDown"})(ut||(ut={}));var ss;(function(i){i[i.None=0]="None",i[i.Crescendo=1]="Crescendo",i[i.Decrescendo=2]="Decrescendo"})(ss||(ss={}));var N;(function(i){i[i.QuadrupleWhole=-4]="QuadrupleWhole",i[i.DoubleWhole=-2]="DoubleWhole",i[i.Whole=1]="Whole",i[i.Half=2]="Half",i[i.Quarter=4]="Quarter",i[i.Eighth=8]="Eighth",i[i.Sixteenth=16]="Sixteenth",i[i.ThirtySecond=32]="ThirtySecond",i[i.SixtyFourth=64]="SixtyFourth",i[i.OneHundredTwentyEighth=128]="OneHundredTwentyEighth",i[i.TwoHundredFiftySixth=256]="TwoHundredFiftySixth"})(N||(N={}));var Me;(function(i){i[i.PPP=0]="PPP",i[i.PP=1]="PP",i[i.P=2]="P",i[i.MP=3]="MP",i[i.MF=4]="MF",i[i.F=5]="F",i[i.FF=6]="FF",i[i.FFF=7]="FFF"})(Me||(Me={}));var he;(function(i){i[i.None=0]="None",i[i.OnBeat=1]="OnBeat",i[i.BeforeBeat=2]="BeforeBeat",i[i.BendGrace=3]="BendGrace"})(he||(he={}));var Te;(function(i){i[i.Unknown=-2]="Unknown",i[i.NoOrDead=-1]="NoOrDead",i[i.Thumb=0]="Thumb",i[i.IndexFinger=1]="IndexFinger",i[i.MiddleFinger=2]="MiddleFinger",i[i.AnnularFinger=3]="AnnularFinger",i[i.LittleFinger=4]="LittleFinger"})(Te||(Te={}));var fe;(function(i){i[i.None=0]="None",i[i.Natural=1]="Natural",i[i.Artificial=2]="Artificial",i[i.Pinch=3]="Pinch",i[i.Tap=4]="Tap",i[i.Semi=5]="Semi",i[i.Feedback=6]="Feedback"})(fe||(fe={}));var At;(function(i){i[i.Default=0]="Default",i[i.ForceNone=1]="ForceNone",i[i.ForceNatural=2]="ForceNatural",i[i.ForceSharp=3]="ForceSharp",i[i.ForceDoubleSharp=4]="ForceDoubleSharp",i[i.ForceFlat=5]="ForceFlat",i[i.ForceDoubleFlat=6]="ForceDoubleFlat"})(At||(At={}));var ii;(function(i){i[i.None=0]="None",i[i.IntoFromBelow=1]="IntoFromBelow",i[i.IntoFromAbove=2]="IntoFromAbove"})(ii||(ii={}));var xe;(function(i){i[i.None=0]="None",i[i.Shift=1]="Shift",i[i.Legato=2]="Legato",i[i.OutUp=3]="OutUp",i[i.OutDown=4]="OutDown",i[i.PickSlideDown=5]="PickSlideDown",i[i.PickSlideUp=6]="PickSlideUp"})(xe||(xe={}));var Ge;(function(i){i[i.None=0]="None",i[i.Slight=1]="Slight",i[i.Wide=2]="Wide"})(Ge||(Ge={}));var Zr;(function(i){i[i.Hidden=0]="Hidden",i[i.ShowWithBeams=1]="ShowWithBeams",i[i.ShowWithBars=2]="ShowWithBars"})(Zr||(Zr={}));var Sr;(function(i){i[i.ScoreDefault=0]="ScoreDefault",i[i.ScoreForcePiano=1]="ScoreForcePiano",i[i.SingleNoteEffectBand=2]="SingleNoteEffectBand",i[i.SingleNoteEffectBandForcePiano=3]="SingleNoteEffectBandForcePiano"})(Sr||(Sr={}));var Qt;(function(i){i[i.GuitarPro=0]="GuitarPro",i[i.SongBook=1]="SongBook"})(Qt||(Qt={}));var me;(function(i){i[i.ScoreTitle=0]="ScoreTitle",i[i.ScoreSubTitle=1]="ScoreSubTitle",i[i.ScoreArtist=2]="ScoreArtist",i[i.ScoreAlbum=3]="ScoreAlbum",i[i.ScoreWords=4]="ScoreWords",i[i.ScoreMusic=5]="ScoreMusic",i[i.ScoreWordsAndMusic=6]="ScoreWordsAndMusic",i[i.ScoreCopyright=7]="ScoreCopyright",i[i.GuitarTuning=8]="GuitarTuning",i[i.TrackNames=9]="TrackNames",i[i.ChordDiagrams=10]="ChordDiagrams",i[i.ParenthesisOnTiedBends=11]="ParenthesisOnTiedBends",i[i.TabNotesOnTiedBends=12]="TabNotesOnTiedBends",i[i.ZerosOnDiveWhammys=13]="ZerosOnDiveWhammys",i[i.EffectAlternateEndings=14]="EffectAlternateEndings",i[i.EffectCapo=15]="EffectCapo",i[i.EffectChordNames=16]="EffectChordNames",i[i.EffectCrescendo=17]="EffectCrescendo",i[i.EffectDynamics=18]="EffectDynamics",i[i.EffectFadeIn=19]="EffectFadeIn",i[i.EffectFermata=20]="EffectFermata",i[i.EffectFingering=21]="EffectFingering",i[i.EffectHarmonics=22]="EffectHarmonics",i[i.EffectLetRing=23]="EffectLetRing",i[i.EffectLyrics=24]="EffectLyrics",i[i.EffectMarker=25]="EffectMarker",i[i.EffectOttavia=26]="EffectOttavia",i[i.EffectPalmMute=27]="EffectPalmMute",i[i.EffectPickSlide=28]="EffectPickSlide",i[i.EffectPickStroke=29]="EffectPickStroke",i[i.EffectSlightBeatVibrato=30]="EffectSlightBeatVibrato",i[i.EffectSlightNoteVibrato=31]="EffectSlightNoteVibrato",i[i.EffectTap=32]="EffectTap",i[i.EffectTempo=33]="EffectTempo",i[i.EffectText=34]="EffectText",i[i.EffectTrill=35]="EffectTrill",i[i.EffectTripletFeel=36]="EffectTripletFeel",i[i.EffectWhammyBar=37]="EffectWhammyBar",i[i.EffectWideBeatVibrato=38]="EffectWideBeatVibrato",i[i.EffectWideNoteVibrato=39]="EffectWideNoteVibrato",i[i.EffectLeftHandTap=40]="EffectLeftHandTap",i[i.EffectFreeTime=41]="EffectFreeTime"})(me||(me={}));class lu{constructor(){this.notationMode=Qt.GuitarPro,this.fingeringMode=Sr.ScoreDefault,this.elements=new Map,this.rhythmMode=Zr.Hidden,this.rhythmHeight=15,this.transpositionPitches=[],this.displayTranspositionPitches=[],this.smallGraceTabNotes=!0,this.extendBendArrowsOnTiedNotes=!0,this.extendLineEffectsToBeatEnd=!1,this.slurHeight=5}isNotationElementVisible(e){return this.elements.has(e)?this.elements.get(e):lu.defaultElements.has(e)?lu.defaultElements.get(e):!0}}lu.defaultElements=new Map([[me.ZerosOnDiveWhammys,!1]]);class m_{constructor(e){this._value=void 0,this._factory=e}get value(){return this._value===void 0&&(this._value=this._factory()),this._value}}var ur;(function(i){i[i.None=0]="None",i[i.Debug=1]="Debug",i[i.Info=2]="Info",i[i.Warning=3]="Warning",i[i.Error=4]="Error"})(ur||(ur={}));class ha{static format(e,t){return`[AlphaTab][${e}] ${t}`}debug(e,t,...s){console.debug(ha.format(e,t),...s)}warning(e,t,...s){console.warn(ha.format(e,t),...s)}info(e,t,...s){console.info(ha.format(e,t),...s)}error(e,t,...s){console.error(ha.format(e,t),...s)}}ha.logLevel=ur.Info;class I{static shouldLog(e){return I.logLevel!==ur.None&&e>=I.logLevel}static debug(e,t,...s){I.shouldLog(ur.Debug)&&I.log.debug(e,t,...s)}static warning(e,t,...s){I.shouldLog(ur.Warning)&&I.log.warning(e,t,...s)}static info(e,t,...s){I.shouldLog(ur.Info)&&I.log.info(e,t,...s)}static error(e,t,...s){I.shouldLog(ur.Error)&&I.log.error(e,t,...s)}}I.logLevel=ur.Info;I.log=new ha;class jR{constructor(){this.note=null,this.noteValue=0,this.octave=0}get realValue(){return this.octave*12+this.noteValue}}class et{static getIndex(e){let t=0;return e<0?t:Math.log2(e)|0}static keySignatureIsFlat(e){return e<0}static keySignatureIsNatural(e){return e===0}static keySignatureIsSharp(e){return e>0}static applyPitchOffsets(e,t){for(let s=0;s<t.tracks.length;s++){if(s<e.notation.displayTranspositionPitches.length)for(let r of t.tracks[s].staves)r.displayTranspositionPitch=-e.notation.displayTranspositionPitches[s];if(s<e.notation.transpositionPitches.length)for(let r of t.tracks[s].staves)r.transpositionPitch=-e.notation.transpositionPitches[s]}}static fingerToString(e,t,s,r){if(e.notation.fingeringMode===Sr.ScoreForcePiano||e.notation.fingeringMode===Sr.SingleNoteEffectBandForcePiano||Kr.isPiano(t.voice.bar.staff.track.playbackInfo.program))switch(s){case Te.Unknown:case Te.NoOrDead:return null;case Te.Thumb:return"1";case Te.IndexFinger:return"2";case Te.MiddleFinger:return"3";case Te.AnnularFinger:return"4";case Te.LittleFinger:return"5";default:return null}if(r)switch(s){case Te.Unknown:return null;case Te.NoOrDead:return"0";case Te.Thumb:return"t";case Te.IndexFinger:return"1";case Te.MiddleFinger:return"2";case Te.AnnularFinger:return"3";case Te.LittleFinger:return"4";default:return null}switch(s){case Te.Unknown:case Te.NoOrDead:return null;case Te.Thumb:return"p";case Te.IndexFinger:return"i";case Te.MiddleFinger:return"m";case Te.AnnularFinger:return"a";case Te.LittleFinger:return"c";default:return null}}static isTuning(e){return!!et.parseTuning(e)}static parseTuning(e){let t="",s="";for(let n=0;n<e.length;n++){let a=e.charCodeAt(n);if(a>=48&&a<=57){if(!t)return null;s+=String.fromCharCode(a)}else if(a>=65&&a<=90||a>=97&&a<=122||a===35)t+=String.fromCharCode(a);else return null}if(!s||!t)return null;let r=new jR;return r.octave=parseInt(s)+1,r.note=t.toLowerCase(),r.noteValue=et.getToneForText(r.note),r}static getTuningForText(e){let t=et.parseTuning(e);return t?t.realValue:-1}static getToneForText(e){switch(e.toLowerCase()){case"c":return 0;case"c#":case"db":return 1;case"d":return 2;case"d#":case"eb":return 3;case"e":return 4;case"f":return 5;case"f#":case"gb":return 6;case"g":return 7;case"g#":case"ab":return 8;case"a":return 9;case"a#":case"bb":return 10;case"b":return 11;default:return 0}}static newGuid(){return Math.floor((1+Math.random())*65536).toString(16).substring(1)+Math.floor((1+Math.random())*65536).toString(16).substring(1)+"-"+Math.floor((1+Math.random())*65536).toString(16).substring(1)+"-"+Math.floor((1+Math.random())*65536).toString(16).substring(1)+"-"+Math.floor((1+Math.random())*65536).toString(16).substring(1)+"-"+Math.floor((1+Math.random())*65536).toString(16).substring(1)+Math.floor((1+Math.random())*65536).toString(16).substring(1)+Math.floor((1+Math.random())*65536).toString(16).substring(1)}static isAlmostEqualTo(e,t){return Math.abs(e-t)<1e-5}static toHexString(e,t=0){let s="",r="0123456789ABCDEF";do s=String.fromCharCode(r.charCodeAt(e&15))+s,e=e>>4;while(e>0);for(;s.length<t;)s="0"+s;return s}}var fi;(function(i){i[i.None=0]="None",i[i.Up=1]="Up",i[i.Down=2]="Down"})(fi||(fi={}));var S;(function(i){i[i.None=-1]="None",i[i.GClef=57424]="GClef",i[i.CClef=57436]="CClef",i[i.FClef=57442]="FClef",i[i.UnpitchedPercussionClef1=57449]="UnpitchedPercussionClef1",i[i.SixStringTabClef=57453]="SixStringTabClef",i[i.FourStringTabClef=57454]="FourStringTabClef",i[i.TimeSig0=57472]="TimeSig0",i[i.TimeSig1=57473]="TimeSig1",i[i.TimeSig2=57474]="TimeSig2",i[i.TimeSig3=57475]="TimeSig3",i[i.TimeSig4=57476]="TimeSig4",i[i.TimeSig5=57477]="TimeSig5",i[i.TimeSig6=57478]="TimeSig6",i[i.TimeSig7=57479]="TimeSig7",i[i.TimeSig8=57480]="TimeSig8",i[i.TimeSig9=57481]="TimeSig9",i[i.TimeSigCommon=57482]="TimeSigCommon",i[i.TimeSigCutCommon=57483]="TimeSigCutCommon",i[i.NoteheadDoubleWholeSquare=57505]="NoteheadDoubleWholeSquare",i[i.NoteheadDoubleWhole=57504]="NoteheadDoubleWhole",i[i.NoteheadWhole=57506]="NoteheadWhole",i[i.NoteheadHalf=57507]="NoteheadHalf",i[i.NoteheadBlack=57508]="NoteheadBlack",i[i.NoteheadNull=57509]="NoteheadNull",i[i.NoteheadXOrnate=57514]="NoteheadXOrnate",i[i.NoteheadTriangleUpWhole=57531]="NoteheadTriangleUpWhole",i[i.NoteheadTriangleUpHalf=57532]="NoteheadTriangleUpHalf",i[i.NoteheadTriangleUpBlack=57534]="NoteheadTriangleUpBlack",i[i.NoteheadDiamondBlackWide=57564]="NoteheadDiamondBlackWide",i[i.NoteheadDiamondWhite=57565]="NoteheadDiamondWhite",i[i.NoteheadDiamondWhiteWide=57566]="NoteheadDiamondWhiteWide",i[i.NoteheadCircleX=57523]="NoteheadCircleX",i[i.NoteheadXWhole=57511]="NoteheadXWhole",i[i.NoteheadXHalf=57512]="NoteheadXHalf",i[i.NoteheadXBlack=57513]="NoteheadXBlack",i[i.NoteheadParenthesis=57550]="NoteheadParenthesis",i[i.NoteheadSlashedBlack2=57552]="NoteheadSlashedBlack2",i[i.NoteheadCircleSlash=57591]="NoteheadCircleSlash",i[i.NoteheadHeavyX=57592]="NoteheadHeavyX",i[i.NoteheadHeavyXHat=57593]="NoteheadHeavyXHat",i[i.NoteheadSlashVerticalEnds=57600]="NoteheadSlashVerticalEnds",i[i.NoteheadSlashWhiteWhole=57602]="NoteheadSlashWhiteWhole",i[i.NoteheadSlashWhiteHalf=57603]="NoteheadSlashWhiteHalf",i[i.NoteQuarterUp=57813]="NoteQuarterUp",i[i.NoteEighthUp=57815]="NoteEighthUp",i[i.Tremolo3=57890]="Tremolo3",i[i.Tremolo2=57889]="Tremolo2",i[i.Tremolo1=57888]="Tremolo1",i[i.FlagEighthUp=57920]="FlagEighthUp",i[i.FlagEighthDown=57921]="FlagEighthDown",i[i.FlagSixteenthUp=57922]="FlagSixteenthUp",i[i.FlagSixteenthDown=57923]="FlagSixteenthDown",i[i.FlagThirtySecondUp=57924]="FlagThirtySecondUp",i[i.FlagThirtySecondDown=57925]="FlagThirtySecondDown",i[i.FlagSixtyFourthUp=57926]="FlagSixtyFourthUp",i[i.FlagSixtyFourthDown=57927]="FlagSixtyFourthDown",i[i.FlagOneHundredTwentyEighthUp=57928]="FlagOneHundredTwentyEighthUp",i[i.FlagOneHundredTwentyEighthDown=57929]="FlagOneHundredTwentyEighthDown",i[i.FlagTwoHundredFiftySixthUp=57930]="FlagTwoHundredFiftySixthUp",i[i.FlagTwoHundredFiftySixthDown=57931]="FlagTwoHundredFiftySixthDown",i[i.AccidentalFlat=57952]="AccidentalFlat",i[i.AccidentalNatural=57953]="AccidentalNatural",i[i.AccidentalSharp=57954]="AccidentalSharp",i[i.AccidentalDoubleSharp=57955]="AccidentalDoubleSharp",i[i.AccidentalDoubleFlat=57956]="AccidentalDoubleFlat",i[i.AccidentalQuarterToneFlatArrowUp=57968]="AccidentalQuarterToneFlatArrowUp",i[i.AccidentalQuarterToneSharpArrowUp=57972]="AccidentalQuarterToneSharpArrowUp",i[i.AccidentalQuarterToneNaturalArrowUp=57970]="AccidentalQuarterToneNaturalArrowUp",i[i.ArticAccentAbove=58528]="ArticAccentAbove",i[i.ArticAccentBelow=58529]="ArticAccentBelow",i[i.ArticStaccatoAbove=58530]="ArticStaccatoAbove",i[i.ArticStaccatoBelow=58531]="ArticStaccatoBelow",i[i.ArticTenutoAbove=58532]="ArticTenutoAbove",i[i.ArticTenutoBelow=58533]="ArticTenutoBelow",i[i.ArticMarcatoAbove=58540]="ArticMarcatoAbove",i[i.ArticMarcatoBelow=58541]="ArticMarcatoBelow",i[i.FermataAbove=58560]="FermataAbove",i[i.FermataShortAbove=58564]="FermataShortAbove",i[i.FermataLongAbove=58566]="FermataLongAbove",i[i.RestLonga=58593]="RestLonga",i[i.RestDoubleWhole=58594]="RestDoubleWhole",i[i.RestWhole=58595]="RestWhole",i[i.RestHalf=58596]="RestHalf",i[i.RestQuarter=58597]="RestQuarter",i[i.RestEighth=58598]="RestEighth",i[i.RestSixteenth=58599]="RestSixteenth",i[i.RestThirtySecond=58600]="RestThirtySecond",i[i.RestSixtyFourth=58601]="RestSixtyFourth",i[i.RestOneHundredTwentyEighth=58602]="RestOneHundredTwentyEighth",i[i.RestTwoHundredFiftySixth=58603]="RestTwoHundredFiftySixth",i[i.Repeat1Bar=58624]="Repeat1Bar",i[i.Repeat2Bars=58625]="Repeat2Bars",i[i.Ottava=58640]="Ottava",i[i.OttavaAlta=58641]="OttavaAlta",i[i.OttavaBassaVb=58652]="OttavaBassaVb",i[i.Quindicesima=58644]="Quindicesima",i[i.QuindicesimaAlta=58645]="QuindicesimaAlta",i[i.DynamicPPP=58666]="DynamicPPP",i[i.DynamicPP=58667]="DynamicPP",i[i.DynamicPiano=58656]="DynamicPiano",i[i.DynamicMP=58668]="DynamicMP",i[i.DynamicMF=58669]="DynamicMF",i[i.DynamicForte=58658]="DynamicForte",i[i.DynamicFF=58671]="DynamicFF",i[i.DynamicFFF=58672]="DynamicFFF",i[i.OrnamentTrill=58726]="OrnamentTrill",i[i.StringsDownBow=58896]="StringsDownBow",i[i.StringsUpBow=58898]="StringsUpBow",i[i.PictEdgeOfCymbal=59177]="PictEdgeOfCymbal",i[i.GuitarString0=59443]="GuitarString0",i[i.GuitarString1=59444]="GuitarString1",i[i.GuitarString2=59445]="GuitarString2",i[i.GuitarString3=59446]="GuitarString3",i[i.GuitarString4=59447]="GuitarString4",i[i.GuitarString5=59448]="GuitarString5",i[i.GuitarString6=59449]="GuitarString6",i[i.GuitarString7=59450]="GuitarString7",i[i.GuitarString8=59451]="GuitarString8",i[i.GuitarString9=59452]="GuitarString9",i[i.GuitarGolpe=59458]="GuitarGolpe",i[i.FretboardX=59481]="FretboardX",i[i.FretboardO=59482]="FretboardO",i[i.WiggleTrill=60068]="WiggleTrill",i[i.WiggleVibratoMediumFast=60126]="WiggleVibratoMediumFast",i[i.OctaveBaselineM=60565]="OctaveBaselineM",i[i.OctaveBaselineB=60563]="OctaveBaselineB"})(S||(S={}));var de;(function(i){i[i.Left=0]="Left",i[i.Center=1]="Center",i[i.Right=2]="Right"})(de||(de={}));var we;(function(i){i[i.Top=0]="Top",i[i.Middle=1]="Middle",i[i.Bottom=2]="Bottom"})(we||(we={}));class Rd{constructor(e,t){this.width=e,this.height=t}}class Q{constructor(e="",t=0,s=0,r=S.None,n=S.None,a=S.None,o=S.None,l=we.Middle){this.elementType=e,this.outputMidiNumber=s,this.staffLine=t,this.noteHeadDefault=r,this.noteHeadHalf=n!==S.None?n:r,this.noteHeadWhole=a!==S.None?a:r,this.techniqueSymbol=o,this.techniqueSymbolPlacement=l}getSymbol(e){switch(e){case N.Whole:return this.noteHeadWhole;case N.Half:return this.noteHeadHalf;default:return this.noteHeadDefault}}}class Lt{static articulationFromElementVariation(e,t){return e<Lt.gp6ElementAndVariationToArticulation.length?(t>=Lt.gp6ElementAndVariationToArticulation.length&&(t=0),Lt.gp6ElementAndVariationToArticulation[e][t]):38}static getArticulation(e){const t=e.percussionArticulation,s=e.beat.voice.bar.staff.track.percussionArticulations;return t<s.length?s[t]:Lt.getArticulationByValue(t)}static getElementAndVariation(e){const t=Lt.getArticulation(e);if(!t)return[-1,-1];for(let s=0;s<Lt.gp6ElementAndVariationToArticulation.length;s++){const r=Lt.gp6ElementAndVariationToArticulation[s];for(let n=0;n<r.length;n++){const a=Lt.getArticulationByValue(r[n]);if((a==null?void 0:a.outputMidiNumber)===t.outputMidiNumber)return[s,n]}}return[-1,-1]}static getArticulationByValue(e){return Lt.instrumentArticulations.has(e)?Lt.instrumentArticulations.get(e):null}}Lt.gp6ElementAndVariationToArticulation=[[35,35,35],[38,91,37],[99,100,99],[56,100,56],[102,103,102],[43,43,43],[45,45,45],[47,47,47],[48,48,48],[50,50,50],[42,92,46],[44,44,44],[57,98,57],[49,97,49],[55,95,55],[51,93,127],[52,96,52]];Lt.instrumentArticulations=new Map([[38,new Q("snare",3,38,S.NoteheadBlack,S.NoteheadHalf,S.NoteheadWhole)],[37,new Q("snare",3,37,S.NoteheadXBlack,S.NoteheadXBlack,S.NoteheadXBlack)],[91,new Q("snare",3,38,S.NoteheadDiamondWhite,S.NoteheadDiamondWhite,S.NoteheadDiamondWhite)],[42,new Q("hiHat",-1,42,S.NoteheadXBlack,S.NoteheadXBlack,S.NoteheadXBlack)],[92,new Q("hiHat",-1,46,S.NoteheadCircleSlash,S.NoteheadCircleSlash,S.NoteheadCircleSlash)],[46,new Q("hiHat",-1,46,S.NoteheadCircleX,S.NoteheadCircleX,S.NoteheadCircleX)],[44,new Q("hiHat",9,44,S.NoteheadXBlack,S.NoteheadXBlack,S.NoteheadXBlack)],[35,new Q("kickDrum",8,35,S.NoteheadBlack,S.NoteheadHalf,S.NoteheadWhole)],[36,new Q("kickDrum",7,36,S.NoteheadBlack,S.NoteheadHalf,S.NoteheadWhole)],[50,new Q("tom",1,50,S.NoteheadBlack,S.NoteheadHalf,S.NoteheadWhole)],[48,new Q("tom",2,48,S.NoteheadBlack,S.NoteheadHalf,S.NoteheadWhole)],[47,new Q("tom",4,47,S.NoteheadBlack,S.NoteheadHalf,S.NoteheadWhole)],[45,new Q("tom",5,45,S.NoteheadBlack,S.NoteheadHalf,S.NoteheadWhole)],[43,new Q("tom",6,43,S.NoteheadBlack,S.NoteheadHalf,S.NoteheadWhole)],[93,new Q("ride",0,51,S.NoteheadXBlack,S.NoteheadXBlack,S.NoteheadXBlack,S.PictEdgeOfCymbal,we.Bottom)],[51,new Q("ride",0,51,S.NoteheadXBlack,S.NoteheadXBlack,S.NoteheadXBlack)],[53,new Q("ride",0,53,S.NoteheadDiamondWhite,S.NoteheadDiamondWhite,S.NoteheadDiamondWhite)],[94,new Q("ride",0,51,S.NoteheadXBlack,S.NoteheadXBlack,S.NoteheadXBlack,S.ArticStaccatoAbove,we.Top)],[55,new Q("splash",-2,55,S.NoteheadXBlack,S.NoteheadXBlack,S.NoteheadXBlack)],[95,new Q("splash",-2,55,S.NoteheadXBlack,S.NoteheadXBlack,S.NoteheadXBlack,S.ArticStaccatoAbove,we.Bottom)],[52,new Q("china",-3,52,S.NoteheadHeavyXHat,S.NoteheadHeavyXHat,S.NoteheadHeavyXHat)],[96,new Q("china",-3,52,S.NoteheadHeavyXHat,S.NoteheadHeavyXHat,S.NoteheadHeavyXHat)],[49,new Q("crash",-2,49,S.NoteheadHeavyX,S.NoteheadHeavyX,S.NoteheadHeavyX)],[97,new Q("crash",-2,49,S.NoteheadHeavyX,S.NoteheadHeavyX,S.NoteheadHeavyX,S.ArticStaccatoAbove,we.Bottom)],[57,new Q("crash",-1,57,S.NoteheadHeavyX,S.NoteheadHeavyX,S.NoteheadHeavyX)],[98,new Q("crash",-1,57,S.NoteheadHeavyX,S.NoteheadHeavyX,S.NoteheadHeavyX,S.ArticStaccatoAbove,we.Bottom)],[99,new Q("cowbell",1,56,S.NoteheadTriangleUpBlack,S.NoteheadTriangleUpHalf,S.NoteheadTriangleUpWhole)],[100,new Q("cowbell",1,56,S.NoteheadXBlack,S.NoteheadXHalf,S.NoteheadXWhole)],[56,new Q("cowbell",0,56,S.NoteheadTriangleUpBlack,S.NoteheadTriangleUpHalf,S.NoteheadTriangleUpWhole)],[101,new Q("cowbell",0,56,S.NoteheadXBlack,S.NoteheadXHalf,S.NoteheadXWhole)],[102,new Q("cowbell",-1,56,S.NoteheadTriangleUpBlack,S.NoteheadTriangleUpHalf,S.NoteheadTriangleUpWhole)],[103,new Q("cowbell",-1,56,S.NoteheadXBlack,S.NoteheadXHalf,S.NoteheadXWhole)],[77,new Q("woodblock",-9,77,S.NoteheadTriangleUpBlack,S.NoteheadTriangleUpBlack,S.NoteheadTriangleUpBlack)],[76,new Q("woodblock",-10,76,S.NoteheadTriangleUpBlack,S.NoteheadTriangleUpBlack,S.NoteheadTriangleUpBlack)],[60,new Q("bongo",-4,60,S.NoteheadBlack,S.NoteheadHalf,S.NoteheadWhole)],[104,new Q("bongo",-5,60,S.NoteheadBlack,S.NoteheadHalf,S.NoteheadWhole,S.NoteheadParenthesis,we.Middle)],[105,new Q("bongo",-6,60,S.NoteheadXBlack,S.NoteheadXBlack,S.NoteheadXBlack)],[61,new Q("bongo",-7,61,S.NoteheadBlack,S.NoteheadHalf,S.NoteheadWhole)],[106,new Q("bongo",-8,61,S.NoteheadBlack,S.NoteheadHalf,S.NoteheadWhole,S.NoteheadParenthesis,we.Middle)],[107,new Q("bongo",-16,61,S.NoteheadXBlack,S.NoteheadXBlack,S.NoteheadXBlack)],[66,new Q("timbale",10,66,S.NoteheadBlack,S.NoteheadHalf,S.NoteheadWhole)],[65,new Q("timbale",9,65,S.NoteheadBlack,S.NoteheadHalf,S.NoteheadWhole)],[68,new Q("agogo",12,68,S.NoteheadBlack,S.NoteheadHalf,S.NoteheadWhole)],[67,new Q("agogo",11,67,S.NoteheadBlack,S.NoteheadHalf,S.NoteheadWhole)],[64,new Q("conga",17,64,S.NoteheadBlack,S.NoteheadHalf,S.NoteheadWhole)],[108,new Q("conga",16,64,S.NoteheadXBlack,S.NoteheadXBlack,S.NoteheadXBlack)],[109,new Q("conga",15,64,S.NoteheadBlack,S.NoteheadHalf,S.NoteheadWhole,S.NoteheadParenthesis,we.Middle)],[63,new Q("conga",14,63,S.NoteheadBlack,S.NoteheadHalf,S.NoteheadWhole)],[110,new Q("conga",13,63,S.NoteheadXBlack,S.NoteheadXBlack,S.NoteheadXBlack)],[62,new Q("conga",19,62,S.NoteheadBlack,S.NoteheadHalf,S.NoteheadWhole,S.NoteheadParenthesis,we.Middle)],[72,new Q("whistle",-11,72,S.NoteheadBlack,S.NoteheadHalf,S.NoteheadWhole)],[71,new Q("whistle",-17,71,S.NoteheadBlack,S.NoteheadHalf,S.NoteheadWhole)],[73,new Q("guiro",38,73,S.NoteheadBlack,S.NoteheadHalf,S.NoteheadWhole)],[74,new Q("guiro",37,74,S.NoteheadBlack,S.NoteheadHalf,S.NoteheadWhole)],[86,new Q("surdo",36,86,S.NoteheadBlack,S.NoteheadHalf,S.NoteheadWhole)],[87,new Q("surdo",35,87,S.NoteheadXBlack,S.NoteheadXBlack,S.NoteheadXBlack,S.NoteheadParenthesis,we.Middle)],[54,new Q("tambourine",3,54,S.NoteheadTriangleUpBlack,S.NoteheadTriangleUpBlack,S.NoteheadTriangleUpBlack)],[111,new Q("tambourine",2,54,S.NoteheadTriangleUpBlack,S.NoteheadTriangleUpBlack,S.NoteheadTriangleUpBlack,S.StringsUpBow,we.Bottom)],[112,new Q("tambourine",1,54,S.NoteheadTriangleUpBlack,S.NoteheadTriangleUpBlack,S.NoteheadTriangleUpBlack,S.StringsDownBow,we.Bottom)],[113,new Q("tambourine",-7,54,S.NoteheadXBlack,S.NoteheadXBlack,S.NoteheadXBlack)],[79,new Q("cuica",30,79,S.NoteheadBlack,S.NoteheadHalf,S.NoteheadWhole)],[78,new Q("cuica",29,78,S.NoteheadXBlack,S.NoteheadXBlack,S.NoteheadXBlack)],[58,new Q("vibraslap",28,58,S.NoteheadBlack,S.NoteheadHalf,S.NoteheadWhole)],[81,new Q("triangle",27,81,S.NoteheadBlack,S.NoteheadHalf,S.NoteheadWhole)],[80,new Q("triangle",26,80,S.NoteheadXBlack,S.NoteheadXBlack,S.NoteheadXBlack,S.NoteheadParenthesis,we.Middle)],[114,new Q("grancassa",25,43,S.NoteheadBlack,S.NoteheadHalf,S.NoteheadWhole)],[115,new Q("piatti",18,49,S.NoteheadBlack,S.NoteheadHalf,S.NoteheadWhole)],[116,new Q("piatti",24,49,S.NoteheadXBlack,S.NoteheadXBlack,S.NoteheadXBlack)],[69,new Q("cabasa",23,69,S.NoteheadBlack,S.NoteheadHalf,S.NoteheadWhole)],[117,new Q("cabasa",22,69,S.NoteheadBlack,S.NoteheadHalf,S.NoteheadWhole,S.StringsUpBow,we.Bottom)],[85,new Q("castanets",21,85,S.NoteheadBlack,S.NoteheadHalf,S.NoteheadWhole)],[75,new Q("claves",20,75,S.NoteheadBlack,S.NoteheadHalf,S.NoteheadWhole)],[70,new Q("maraca",-12,70,S.NoteheadBlack,S.NoteheadHalf,S.NoteheadWhole)],[118,new Q("maraca",-13,70,S.NoteheadBlack,S.NoteheadHalf,S.NoteheadWhole,S.StringsUpBow,we.Bottom)],[119,new Q("maraca",-14,70,S.NoteheadBlack,S.NoteheadHalf,S.NoteheadWhole)],[120,new Q("maraca",-15,70,S.NoteheadBlack,S.NoteheadHalf,S.NoteheadWhole,S.StringsUpBow,we.Bottom)],[82,new Q("shaker",-23,54,S.NoteheadBlack,S.NoteheadHalf,S.NoteheadWhole)],[122,new Q("shaker",-24,54,S.NoteheadBlack,S.NoteheadHalf,S.NoteheadWhole,S.StringsUpBow,we.Bottom)],[84,new Q("bellTree",-18,53,S.NoteheadBlack,S.NoteheadHalf,S.NoteheadWhole)],[123,new Q("bellTree",-19,53,S.NoteheadBlack,S.NoteheadHalf,S.NoteheadWhole,S.StringsUpBow,we.Bottom)],[83,new Q("jingleBell",-20,53,S.NoteheadBlack,S.NoteheadHalf,S.NoteheadWhole)],[124,new Q("unpitched",-21,62,S.NoteheadNull,S.NoteheadNull,S.NoteheadNull,S.GuitarGolpe,we.Top)],[125,new Q("unpitched",-22,62,S.NoteheadNull,S.NoteheadNull,S.NoteheadNull,S.GuitarGolpe,we.Bottom)],[39,new Q("handClap",3,39,S.NoteheadBlack,S.NoteheadHalf,S.NoteheadWhole)],[40,new Q("snare",3,40,S.NoteheadBlack,S.NoteheadHalf,S.NoteheadWhole)],[31,new Q("snare",3,40,S.NoteheadSlashedBlack2,S.NoteheadSlashedBlack2,S.NoteheadSlashedBlack2)],[41,new Q("tom",5,41,S.NoteheadBlack,S.NoteheadHalf,S.NoteheadWhole)],[59,new Q("ride",2,59,S.NoteheadXBlack,S.NoteheadXBlack,S.NoteheadXBlack,S.PictEdgeOfCymbal,we.Bottom)],[126,new Q("ride",2,59,S.NoteheadXBlack,S.NoteheadXBlack,S.NoteheadXBlack)],[127,new Q("ride",2,59,S.NoteheadDiamondWhite,S.NoteheadDiamondWhite,S.NoteheadDiamondWhite)],[29,new Q("ride",2,59,S.NoteheadXBlack,S.NoteheadXBlack,S.NoteheadXBlack,S.ArticStaccatoAbove,we.Top)],[30,new Q("crash",-3,49,S.NoteheadXBlack,S.NoteheadXBlack,S.NoteheadXBlack)],[33,new Q("snare",3,37,S.NoteheadXBlack,S.NoteheadXBlack,S.NoteheadXBlack)],[34,new Q("snare",3,38,S.NoteheadBlack,S.NoteheadBlack,S.NoteheadBlack)]]);Lt.instrumentArticulationNames=new Map([["Ride (choke)",29],["Cymbal (hit)",30],["Snare (side stick)",31],["Snare (side stick) 2",33],["Snare (hit)",34],["Kick (hit)",35],["Kick (hit) 2",36],["Snare (side stick) 3",37],["Snare (hit) 2",38],["Hand Clap (hit)",39],["Snare (hit) 3",40],["Low Floor Tom (hit)",41],["Hi-Hat (closed)",42],["Very Low Tom (hit)",43],["Pedal Hi-Hat (hit)",44],["Low Tom (hit)",45],["Hi-Hat (open)",46],["Mid Tom (hit)",47],["High Tom (hit)",48],["Crash high (hit)",49],["High Floor Tom (hit)",50],["Ride (middle)",51],["China (hit)",52],["Ride (bell)",53],["Tambourine (hit)",54],["Splash (hit)",55],["Cowbell medium (hit)",56],["Crash medium (hit)",57],["Vibraslap (hit)",58],["Ride (edge)",59],["Hand (hit)",60],["Hand (hit)",61],["Conga high (mute)",62],["Conga high (hit)",63],["Conga low (hit)",64],["Timbale high (hit)",65],["Timbale low (hit)",66],["Agogo high (hit)",67],["Agogo tow (hit)",68],["Cabasa (hit)",69],["Left Maraca (hit)",70],["Whistle high (hit)",71],["Whistle low (hit)",72],["Guiro (hit)",73],["Guiro (scrap-return)",74],["Claves (hit)",75],["Woodblock high (hit)",76],["Woodblock low (hit)",77],["Cuica (mute)",78],["Cuica (open)",79],["Triangle (rnute)",80],["Triangle (hit)",81],["Shaker (hit)",82],["Tinkle Bell (hat)",83],["Jingle Bell (hit)",83],["Bell Tree (hit)",84],["Castanets (hit)",85],["Surdo (hit)",86],["Surdo (mute)",87],["Snare (rim shot)",91],["Hi-Hat (half)",92],["Ride (edge) 2",93],["Ride (choke) 2",94],["Splash (choke)",95],["China (choke)",96],["Crash high (choke)",97],["Crash medium (choke)",98],["Cowbell low (hit)",99],["Cowbell low (tip)",100],["Cowbell medium (tip)",101],["Cowbell high (hit)",102],["Cowbell high (tip)",103],["Hand (mute)",104],["Hand (slap)",105],["Hand (mute) 2",106],["Hand (slap) 2",107],["Conga low (slap)",108],["Conga low (mute)",109],["Conga high (slap)",110],["Tambourine (return)",111],["Tambourine (roll)",112],["Tambourine (hand)",113],["Grancassa (hit)",114],["Piatti (hat)",115],["Piatti (hand)",116],["Cabasa (return)",117],["Left Maraca (return)",118],["Right Maraca (hit)",119],["Right Maraca (return)",120],["Shaker (return)",122],["Bell Tee (return)",123],["Golpe (thumb)",124],["Golpe (finger)",125],["Ride (middle) 2",126],["Ride (bell) 2",127]]);class Xa{constructor(){this.tieDestinationNoteId=-1,this.tieOriginNoteId=-1,this.slurDestinationNoteId=-1,this.slurOriginNoteId=-1,this.hammerPullDestinationNoteId=-1,this.hammerPullOriginNoteId=-1}}let Ss=class zs{constructor(){this.id=zs.GlobalNoteId++,this.index=0,this.accentuated=_t.None,this.bendType=se.None,this.bendStyle=qe.Default,this.bendOrigin=null,this.isContinuedBend=!1,this.bendPoints=null,this.maxBendPoint=null,this.fret=-1,this.string=-1,this.showStringNumber=!1,this.octave=-1,this.tone=-1,this.percussionArticulation=-1,this.isVisible=!0,this.isLeftHandTapped=!1,this.isHammerPullOrigin=!1,this.hammerPullOrigin=null,this.hammerPullDestination=null,this.isSlurDestination=!1,this.slurOrigin=null,this.slurDestination=null,this.harmonicType=fe.None,this.harmonicValue=0,this.isGhost=!1,this.isLetRing=!1,this.letRingDestination=null,this.isPalmMute=!1,this.palmMuteDestination=null,this.isDead=!1,this.isStaccato=!1,this.slideInType=ii.None,this.slideOutType=xe.None,this.slideTarget=null,this.slideOrigin=null,this.vibrato=Ge.None,this.tieOrigin=null,this.tieDestination=null,this.isTieDestination=!1,this.leftHandFinger=Te.Unknown,this.rightHandFinger=Te.Unknown,this.isFingering=!1,this.trillValue=-1,this.trillSpeed=N.ThirtySecond,this.durationPercent=1,this.accidentalMode=At.Default,this.dynamics=Me.F,this.isEffectSlurOrigin=!1,this.hasEffectSlur=!1,this.effectSlurOrigin=null,this.effectSlurDestination=null,this._noteIdBag=null}get hasBend(){return this.bendPoints!==null&&this.bendType!==se.None}get isStringed(){return this.string>=0}get isPiano(){return!this.isStringed&&this.octave>=0&&this.tone>=0}get isPercussion(){return!this.isStringed&&this.percussionArticulation>=0}get element(){return this.isPercussion?Lt.getElementAndVariation(this)[0]:-1}get variation(){return this.isPercussion?Lt.getElementAndVariation(this)[1]:-1}get isHammerPullDestination(){return!!this.hammerPullOrigin}get isSlurOrigin(){return!!this.slurDestination}get isHarmonic(){return this.harmonicType!==fe.None}get isTieOrigin(){return this.tieDestination!==null}get trillFret(){return this.trillValue-this.stringTuning}get isTrill(){return this.trillValue>=0}get isEffectSlurDestination(){return!!this.effectSlurOrigin}get stringTuning(){return this.beat.voice.bar.staff.capo+zs.getStringTuning(this.beat.voice.bar.staff,this.string)}static getStringTuning(e,t){return e.tuning.length>0?e.tuning[e.tuning.length-(t-1)-1]:0}get realValue(){return this.calculateRealValue(!0,!0)}get realValueWithoutHarmonic(){return this.calculateRealValue(!0,!1)}calculateRealValue(e,t){const s=e?this.beat.voice.bar.staff.transpositionPitch:0;if(t){let r=this.calculateRealValue(e,!1);return this.isStringed&&(this.harmonicType===fe.Natural?r=this.harmonicPitch+this.stringTuning-s:r+=this.harmonicPitch),r}else return this.isPercussion?this.percussionArticulation:this.isStringed?this.fret+this.stringTuning-s:this.isPiano?this.octave*12+this.tone-s:0}get harmonicPitch(){if(this.harmonicType===fe.None||!this.isStringed)return 0;let e=this.harmonicValue;return et.isAlmostEqualTo(e,2.4)?36:et.isAlmostEqualTo(e,2.7)?34:e<3?0:e<=3.5?31:e<=4?28:e<=5?24:e<=6?34:e<=7?19:e<=8.5?36:e<=9?28:e<=10?34:e<=11?0:e<=12?12:e<14?0:e<=15?34:e<=16?28:e<=17?36:e<=18?0:e<=19?19:e<=21?0:e<=22?36:e<=24?24:0}get initialBendValue(){return this.hasBend?Math.floor(this.bendPoints[0].value/2):this.bendOrigin?Math.floor(this.bendOrigin.bendPoints[this.bendOrigin.bendPoints.length-1].value/2):this.isTieDestination&&this.tieOrigin.bendOrigin?Math.floor(this.tieOrigin.bendOrigin.bendPoints[this.tieOrigin.bendOrigin.bendPoints.length-1].value/2):this.beat.hasWhammyBar?Math.floor(this.beat.whammyBarPoints[0].value/2):this.beat.isContinuedWhammy?Math.floor(this.beat.previousBeat.whammyBarPoints[this.beat.previousBeat.whammyBarPoints.length-1].value/2):0}get displayValue(){return this.displayValueWithoutBend+this.initialBendValue}get displayValueWithoutBend(){let e=this.realValue;switch(this.harmonicType!==fe.Natural&&this.harmonicType!==fe.None&&(e-=this.harmonicPitch),this.beat.ottava){case Ue._15ma:e-=24;break;case Ue._8va:e-=12;break;case Ue.Regular:break;case Ue._8vb:e+=12;break;case Ue._15mb:e+=24;break}switch(this.beat.voice.bar.clefOttava){case Ue._15ma:e-=24;break;case Ue._8va:e-=12;break;case Ue.Regular:break;case Ue._8vb:e+=12;break;case Ue._15mb:e+=24;break}return e-this.beat.voice.bar.staff.displayTranspositionPitch}get hasQuarterToneOffset(){return this.hasBend?this.bendPoints[0].value%2!==0:this.bendOrigin?this.bendOrigin.bendPoints[this.bendOrigin.bendPoints.length-1].value%2!==0:this.beat.hasWhammyBar?this.beat.whammyBarPoints[0].value%2!==0:this.beat.isContinuedWhammy?this.beat.previousBeat.whammyBarPoints[this.beat.previousBeat.whammyBarPoints.length-1].value%2!==0:!1}addBendPoint(e){let t=this.bendPoints;t===null&&(t=[],this.bendPoints=t),t.push(e),(!this.maxBendPoint||e.value>this.maxBendPoint.value)&&(this.maxBendPoint=e),this.bendType===se.None&&(this.bendType=se.Custom)}finish(e,t=null){let s=new m_(()=>zs.nextNoteOnSameLine(this)),r=e&&e.notation.notationMode===Qt.SongBook;if(this.isTieDestination&&(this.chain(t),r&&this.tieOrigin&&this.tieOrigin.isLetRing&&(this.isLetRing=!0)),this.isLetRing&&(!s.value||!s.value.isLetRing?this.letRingDestination=this:this.letRingDestination=s.value,r&&this.isTieDestination&&!this.tieOrigin.hasBend&&(this.isVisible=!1)),this.isPalmMute&&(!s.value||!s.value.isPalmMute?this.palmMuteDestination=this:this.palmMuteDestination=s.value),this.isHammerPullOrigin){let o=zs.findHammerPullDestination(this);o?(this.hammerPullDestination=o,o.hammerPullOrigin=this):this.isHammerPullOrigin=!1}switch(this.slideOutType){case xe.Shift:case xe.Legato:this.slideTarget=s.value,this.slideTarget?this.slideTarget.slideOrigin=this:this.slideOutType=xe.None;break}let n=null;this.isHammerPullOrigin&&this.hammerPullDestination?n=this.hammerPullDestination:this.slideOutType===xe.Legato&&this.slideTarget&&(n=this.slideTarget),n&&(this.hasEffectSlur=!0,this.effectSlurOrigin&&this.beat.pickStroke===fi.None?(this.effectSlurOrigin.effectSlurDestination=n,this.effectSlurOrigin.effectSlurDestination.effectSlurOrigin=this.effectSlurOrigin,this.effectSlurOrigin=null):(this.isEffectSlurOrigin=!0,this.effectSlurDestination=n,this.effectSlurDestination.effectSlurOrigin=this));const a=this.bendPoints;if(a!=null&&a.length>0&&this.bendType===se.Custom){let o=this.isTieDestination&&this.tieOrigin.hasBend;if(this.isContinuedBend=o,a.length===4){let l=a[0],u=a[1],h=a[2],c=a[3];u.value===h.value?c.value>l.value?u.value>c.value?this.bendType=se.BendRelease:!o&&l.value>0?(this.bendType=se.PrebendBend,a.splice(2,1),a.splice(1,1)):(this.bendType=se.Bend,a.splice(2,1),a.splice(1,1)):c.value<l.value?o?(this.bendType=se.Release,a.splice(2,1),a.splice(1,1)):(this.bendType=se.PrebendRelease,a.splice(2,1),a.splice(1,1)):u.value>l.value?this.bendType=se.BendRelease:l.value>0&&!o?(this.bendType=se.Prebend,a.splice(2,1),a.splice(1,1)):(this.bendType=se.Hold,a.splice(2,1),a.splice(1,1)):I.warning("Model","Unsupported bend type detected, fallback to custom",null)}else if(a.length===2){let l=a[0],u=a[1];u.value>l.value?!o&&l.value>0?this.bendType=se.PrebendBend:this.bendType=se.Bend:u.value<l.value?o?this.bendType=se.Release:this.bendType=se.PrebendRelease:l.value>0&&!o?this.bendType=se.Prebend:this.bendType=se.Hold}}else(a===null||a.length===0)&&(this.bendType=se.None);this.initialBendValue>0&&(this.accidentalMode=At.Default)}static nextNoteOnSameLine(e){let t=e.beat.nextBeat;for(;t&&t.voice.bar.index<=e.beat.voice.bar.index+zs.MaxOffsetForSameLineSearch;){let s=t.getNoteOnString(e.string);if(s)return s;t=t.nextBeat}return null}static findHammerPullDestination(e){let t=e.beat.nextBeat;for(;t&&t.voice.bar.index<=e.beat.voice.bar.index+zs.MaxOffsetForSameLineSearch;){let s=t.getNoteOnString(e.string);if(s)return s;for(let r=e.string;r>0;r--)if(s=t.getNoteOnString(r),s){if(s.isLeftHandTapped)return s;break}for(let r=e.string;r<=e.beat.voice.bar.staff.tuning.length;r++)if(s=t.getNoteOnString(r),s){if(s.isLeftHandTapped)return s;break}t=t.nextBeat}return null}static findTieOrigin(e){let t=e.beat.previousBeat;for(;t&&t.voice.bar.index>=e.beat.voice.bar.index-zs.MaxOffsetForSameLineSearch;){if(e.isStringed){let s=t.getNoteOnString(e.string);if(s)return s}else if(e.octave===-1&&e.tone===-1){if(e.index<t.notes.length)return t.notes[e.index]}else{let s=t.getNoteWithRealValue(e.realValue);if(s)return s}t=t.previousBeat}return null}chain(e=null){if(e!==null)if(this._noteIdBag!==null){let t;e.has(zs.NoteIdLookupKey)?t=e.get(zs.NoteIdLookupKey):(t=new Map,e.set(zs.NoteIdLookupKey,t)),(this._noteIdBag.hammerPullDestinationNoteId!==-1||this._noteIdBag.tieDestinationNoteId!==-1||this._noteIdBag.slurDestinationNoteId!==-1)&&t.set(this.id,this),this._noteIdBag.hammerPullOriginNoteId!==-1&&(this.hammerPullOrigin=t.get(this._noteIdBag.hammerPullOriginNoteId),this.hammerPullOrigin.hammerPullDestination=this),this._noteIdBag.tieOriginNoteId!==-1&&(this.tieOrigin=t.get(this._noteIdBag.tieOriginNoteId),this.tieOrigin.tieDestination=this),this._noteIdBag.slurOriginNoteId!==-1&&(this.slurOrigin=t.get(this._noteIdBag.slurOriginNoteId),this.slurOrigin.slurDestination=this),this._noteIdBag=null}else{if(!this.isTieDestination&&this.tieOrigin===null)return;let t=this.tieOrigin??zs.findTieOrigin(this);t?(t.tieDestination=this,this.tieOrigin=t,this.fret=t.fret,this.octave=t.octave,this.tone=t.tone,t.hasBend&&(this.bendOrigin=this.tieOrigin)):this.isTieDestination=!1}}toJson(e){this.tieDestination!==null&&e.set("tiedestinationnoteid",this.tieDestination.id),this.tieOrigin!==null&&e.set("tieoriginnoteid",this.tieOrigin.id),this.slurDestination!==null&&e.set("slurdestinationnoteid",this.slurDestination.id),this.slurOrigin!==null&&e.set("sluroriginnoteid",this.slurOrigin.id),this.hammerPullOrigin!==null&&e.set("hammerpulloriginnoteid",this.hammerPullOrigin.id),this.hammerPullDestination!==null&&e.set("hammerpulldestinationnoteid",this.hammerPullDestination.id)}setProperty(e,t){switch(e){case"tiedestinationnoteid":return this._noteIdBag==null&&(this._noteIdBag=new Xa),this._noteIdBag.tieDestinationNoteId=t,!0;case"tieoriginnoteid":return this._noteIdBag==null&&(this._noteIdBag=new Xa),this._noteIdBag.tieOriginNoteId=t,!0;case"slurdestinationnoteid":return this._noteIdBag==null&&(this._noteIdBag=new Xa),this._noteIdBag.slurDestinationNoteId=t,!0;case"sluroriginnoteid":return this._noteIdBag==null&&(this._noteIdBag=new Xa),this._noteIdBag.slurOriginNoteId=t,!0;case"hammerpulloriginnoteid":return this._noteIdBag==null&&(this._noteIdBag=new Xa),this._noteIdBag.hammerPullOriginNoteId=t,!0;case"hammerpulldestinationnoteid":return this._noteIdBag==null&&(this._noteIdBag=new Xa),this._noteIdBag.hammerPullDestinationNoteId=t,!0}return!1}};Ss.GlobalNoteId=0;Ss.MaxOffsetForSameLineSearch=3;Ss.NoteIdLookupKey="NoteIdLookup";class li{constructor(e){this._isEqualLengthTuplet=!0,this.totalDuration=0,this.beats=[],this.isFull=!1,this.voice=e}check(e){if(this.beats.length===0)return this.beats.push(e),this.totalDuration+=e.playbackDuration,!0;if(e.graceType!==he.None)return!0;if(e.voice!==this.voice||this.isFull||e.tupletNumerator!==this.beats[0].tupletNumerator||e.tupletDenominator!==this.beats[0].tupletDenominator)return!1;if(e.playbackDuration!==this.beats[0].playbackDuration&&(this._isEqualLengthTuplet=!1),this.beats.push(e),this.totalDuration+=e.playbackDuration,this._isEqualLengthTuplet)this.beats.length===this.beats[0].tupletNumerator&&(this.isFull=!0);else{let t=this.beats[0].tupletNumerator/this.beats[0].tupletDenominator|0;for(let s of li.AllTicks)if(this.totalDuration===s*t){this.isFull=!0;break}}return!0}}li.HalfTicks=1920;li.QuarterTicks=960;li.EighthTicks=480;li.SixteenthTicks=240;li.ThirtySecondTicks=120;li.SixtyFourthTicks=60;li.OneHundredTwentyEighthTicks=30;li.TwoHundredFiftySixthTicks=15;li.AllTicks=[li.HalfTicks,li.QuarterTicks,li.EighthTicks,li.SixteenthTicks,li.ThirtySecondTicks,li.SixtyFourthTicks,li.OneHundredTwentyEighthTicks,li.TwoHundredFiftySixthTicks];var je;(function(i){i[i.None=0]="None",i[i.Custom=1]="Custom",i[i.Dive=2]="Dive",i[i.Dip=3]="Dip",i[i.Hold=4]="Hold",i[i.Predive=5]="Predive",i[i.PrediveDive=6]="PrediveDive"})(je||(je={}));class y_{static clone(e){const t=new G;return t.offset=e.offset,t.value=e.value,t}}class b_{static clone(e){const t=new Ss;if(t.index=e.index,t.accentuated=e.accentuated,t.bendType=e.bendType,t.bendStyle=e.bendStyle,t.isContinuedBend=e.isContinuedBend,e.bendPoints){t.bendPoints=[];for(const s of e.bendPoints)t.addBendPoint(y_.clone(s))}return t.fret=e.fret,t.string=e.string,t.showStringNumber=e.showStringNumber,t.octave=e.octave,t.tone=e.tone,t.percussionArticulation=e.percussionArticulation,t.isVisible=e.isVisible,t.isLeftHandTapped=e.isLeftHandTapped,t.isHammerPullOrigin=e.isHammerPullOrigin,t.isSlurDestination=e.isSlurDestination,t.harmonicType=e.harmonicType,t.harmonicValue=e.harmonicValue,t.isGhost=e.isGhost,t.isLetRing=e.isLetRing,t.isPalmMute=e.isPalmMute,t.isDead=e.isDead,t.isStaccato=e.isStaccato,t.slideInType=e.slideInType,t.slideOutType=e.slideOutType,t.vibrato=e.vibrato,t.isTieDestination=e.isTieDestination,t.leftHandFinger=e.leftHandFinger,t.rightHandFinger=e.rightHandFinger,t.isFingering=e.isFingering,t.trillValue=e.trillValue,t.trillSpeed=e.trillSpeed,t.durationPercent=e.durationPercent,t.accidentalMode=e.accidentalMode,t.dynamics=e.dynamics,t}}class UR{static clone(e){const t=new vi;return t.isLinear=e.isLinear,t.type=e.type,t.value=e.value,t.ratioPosition=e.ratioPosition,t.text=e.text,t}}class D0{static clone(e){const t=new xi;t.index=e.index,t.notes=[];for(const s of e.notes)t.addNote(b_.clone(s));t.isEmpty=e.isEmpty,t.whammyStyle=e.whammyStyle,t.ottava=e.ottava,t.isLegatoOrigin=e.isLegatoOrigin,t.duration=e.duration,t.isLetRing=e.isLetRing,t.isPalmMute=e.isPalmMute,t.automations=[];for(const s of e.automations)t.automations.push(UR.clone(s));if(t.dots=e.dots,t.fadeIn=e.fadeIn,t.lyrics=e.lyrics?e.lyrics.slice():null,t.hasRasgueado=e.hasRasgueado,t.pop=e.pop,t.slap=e.slap,t.tap=e.tap,t.text=e.text,t.slashed=e.slashed,t.brushType=e.brushType,t.brushDuration=e.brushDuration,t.tupletDenominator=e.tupletDenominator,t.tupletNumerator=e.tupletNumerator,t.isContinuedWhammy=e.isContinuedWhammy,t.whammyBarType=e.whammyBarType,e.whammyBarPoints){t.whammyBarPoints=[];for(const s of e.whammyBarPoints)t.addWhammyBarPoint(y_.clone(s))}return t.vibrato=e.vibrato,t.chordId=e.chordId,t.graceType=e.graceType,t.pickStroke=e.pickStroke,t.tremoloSpeed=e.tremoloSpeed,t.crescendo=e.crescendo,t.displayStart=e.displayStart,t.playbackStart=e.playbackStart,t.displayDuration=e.displayDuration,t.playbackDuration=e.playbackDuration,t.dynamics=e.dynamics,t.invertBeamDirection=e.invertBeamDirection,t.preferredBeamDirection=e.preferredBeamDirection,t.isEffectSlurOrigin=e.isEffectSlurOrigin,t.beamingMode=e.beamingMode,t}}class Ag{constructor(){this.beats=[],this.id="empty",this.isComplete=!1}addBeat(e){e.graceIndex=this.beats.length,e.graceGroup=this,this.beats.push(e)}finish(){this.beats.length>0&&(this.id=this.beats[0].absoluteDisplayStart+"_"+this.beats[0].voice.index)}}var cr;(function(i){i[i.Auto=0]="Auto",i[i.ForceSplitToNext=1]="ForceSplitToNext",i[i.ForceMergeWithNext=2]="ForceMergeWithNext"})(cr||(cr={}));class xi{constructor(){this.id=xi._globalBeatId++,this.index=0,this.previousBeat=null,this.nextBeat=null,this.notes=[],this.noteStringLookup=new Map,this.noteValueLookup=new Map,this.isEmpty=!1,this.whammyStyle=qe.Default,this.ottava=Ue.Regular,this.fermata=null,this.isLegatoOrigin=!1,this.minNote=null,this.maxNote=null,this.maxStringNote=null,this.minStringNote=null,this.duration=N.Quarter,this.isLetRing=!1,this.isPalmMute=!1,this.automations=[],this.dots=0,this.fadeIn=!1,this.lyrics=null,this.hasRasgueado=!1,this.pop=!1,this.slap=!1,this.tap=!1,this.text=null,this.slashed=!1,this.brushType=ut.None,this.brushDuration=0,this.tupletDenominator=-1,this.tupletNumerator=-1,this.tupletGroup=null,this.isContinuedWhammy=!1,this.whammyBarType=je.None,this.whammyBarPoints=null,this.maxWhammyPoint=null,this.minWhammyPoint=null,this.vibrato=Ge.None,this.chordId=null,this.graceType=he.None,this.graceGroup=null,this.graceIndex=-1,this.pickStroke=fi.None,this.tremoloSpeed=null,this.crescendo=ss.None,this.displayStart=0,this.playbackStart=0,this.displayDuration=0,this.playbackDuration=0,this.dynamics=Me.F,this.invertBeamDirection=!1,this.preferredBeamDirection=null,this.isEffectSlurOrigin=!1,this.effectSlurOrigin=null,this.effectSlurDestination=null,this.beamingMode=cr.Auto}get isLastOfVoice(){return this.index===this.voice.beats.length-1}get isLegatoDestination(){return!!this.previousBeat&&this.previousBeat.isLegatoOrigin}get isRest(){return this.isEmpty||this.notes.length===0}get isFullBarRest(){return this.isRest&&this.voice.beats.length===1&&this.duration===N.Whole}get hasTuplet(){return!(this.tupletDenominator===-1&&this.tupletNumerator===-1)&&!(this.tupletDenominator===1&&this.tupletNumerator===1)}get hasWhammyBar(){return this.whammyBarPoints!==null&&this.whammyBarType!==je.None}get hasChord(){return!!this.chordId}get chord(){return this.chordId?this.voice.bar.staff.getChord(this.chordId):null}get isTremolo(){return!!this.tremoloSpeed}get absoluteDisplayStart(){return this.voice.bar.masterBar.start+this.displayStart}get absolutePlaybackStart(){return this.voice.bar.masterBar.start+this.playbackStart}get isEffectSlurDestination(){return!!this.effectSlurOrigin}addWhammyBarPoint(e){let t=this.whammyBarPoints;t===null&&(t=[],this.whammyBarPoints=t),t.push(e),(!this.maxWhammyPoint||e.value>this.maxWhammyPoint.value)&&(this.maxWhammyPoint=e),(!this.minWhammyPoint||e.value<this.minWhammyPoint.value)&&(this.minWhammyPoint=e),this.whammyBarType===je.None&&(this.whammyBarType=je.Custom)}removeWhammyBarPoint(e){const t=this.whammyBarPoints;if(t===null||e<0||e>=t.length)return;t.splice(e,1);let s=t[e];if(s===this.maxWhammyPoint){this.maxWhammyPoint=null;for(let r of t)(!this.maxWhammyPoint||r.value>this.maxWhammyPoint.value)&&(this.maxWhammyPoint=r)}if(s===this.minWhammyPoint){this.minWhammyPoint=null;for(let r of t)(!this.minWhammyPoint||r.value<this.minWhammyPoint.value)&&(this.minWhammyPoint=r)}}addNote(e){e.beat=this,e.index=this.notes.length,this.notes.push(e),e.isStringed&&this.noteStringLookup.set(e.string,e)}removeNote(e){let t=this.notes.indexOf(e);t>=0&&(this.notes.splice(t,1),e.isStringed&&this.noteStringLookup.delete(e.string))}getAutomation(e){for(let t=0,s=this.automations.length;t<s;t++){let r=this.automations[t];if(r.type===e)return r}return null}getNoteOnString(e){return this.noteStringLookup.has(e)?this.noteStringLookup.get(e):null}calculateDuration(){if(this.isFullBarRest)return this.voice.bar.masterBar.calculateDuration();let e=ke.toTicks(this.duration);return this.dots===2?e=ke.applyDot(e,!0):this.dots===1&&(e=ke.applyDot(e,!1)),this.tupletDenominator>0&&this.tupletNumerator>=0&&(e=ke.applyTuplet(e,this.tupletNumerator,this.tupletDenominator)),e}updateDurations(){let e=this.calculateDuration();switch(this.playbackDuration=e,this.graceType){case he.BeforeBeat:case he.OnBeat:switch(this.duration){case N.Sixteenth:this.playbackDuration=ke.toTicks(N.SixtyFourth);break;case N.ThirtySecond:this.playbackDuration=ke.toTicks(N.OneHundredTwentyEighth);break;default:this.playbackDuration=ke.toTicks(N.ThirtySecond);break}this.displayDuration=0;break;case he.BendGrace:this.playbackDuration/=2,this.displayDuration=0;break;default:this.displayDuration=e;let t=this.previousBeat;t&&t.graceType===he.BendGrace&&(this.playbackDuration=t.playbackDuration);break}}finishTuplet(){let e=this.previousBeat,t=e?e.tupletGroup:null;if((this.hasTuplet||this.graceType!==he.None&&t)&&((!e||!t||!t.check(this))&&(t=new li(this.voice),t.check(this)),this.tupletGroup=t),this.index>0){const s=this.voice.bar.masterBar.calculateDuration(),r=[];for(const n of this.automations)n.ratioPosition===0&&(n.ratioPosition=this.playbackStart/s),n.type!==jt.Volume&&r.push(n);this.automations=r}}finish(e,t=null){switch(this.getAutomation(jt.Instrument)===null&&this.index===0&&this.voice.index===0&&this.voice.bar.index===0&&this.voice.bar.staff.index===0&&this.automations.push(vi.buildInstrumentAutomation(!1,0,this.voice.bar.staff.track.playbackInfo.program)),this.graceType){case he.OnBeat:case he.BeforeBeat:let u=this.graceGroup.beats.length;u===1?this.duration=N.Eighth:u===2?this.duration=N.Sixteenth:this.duration=N.ThirtySecond;break}let s=e?e.notation.notationMode:Qt.GuitarPro,r=this.text==="grad"||this.text==="grad.";r&&s===Qt.SongBook&&(this.text="");let n=!1;this.minNote=null,this.maxNote=null,this.minStringNote=null,this.maxStringNote=null;let a=0,o=!1;for(let u=0,h=this.notes.length;u<h;u++){let c=this.notes[u];if(c.dynamics=this.dynamics,c.finish(e,t),c.isLetRing&&(this.isLetRing=!0),c.isPalmMute&&(this.isPalmMute=!0),s===Qt.SongBook&&c.hasBend&&this.graceType!==he.BendGrace){if(!c.isTieOrigin)switch(c.bendType){case se.Bend:case se.PrebendRelease:case se.PrebendBend:n=!0;break}r||c.bendStyle===qe.Gradual?(r=!0,c.bendStyle=qe.Gradual,n=!1):c.bendStyle=qe.Fast}c.isVisible&&(a++,(!this.minNote||c.realValue<this.minNote.realValue)&&(this.minNote=c),(!this.maxNote||c.realValue>this.maxNote.realValue)&&(this.maxNote=c),(!this.minStringNote||c.string<this.minStringNote.string)&&(this.minStringNote=c),(!this.maxStringNote||c.string>this.maxStringNote.string)&&(this.maxStringNote=c),c.hasEffectSlur&&(o=!0))}if(o&&(this.effectSlurOrigin?(this.effectSlurOrigin.effectSlurDestination=this.nextBeat,this.effectSlurOrigin.effectSlurDestination&&(this.effectSlurOrigin.effectSlurDestination.effectSlurOrigin=this.effectSlurOrigin),this.effectSlurOrigin=null):(this.isEffectSlurOrigin=!0,this.effectSlurDestination=this.nextBeat,this.effectSlurDestination&&(this.effectSlurDestination.effectSlurOrigin=this))),this.notes.length>0&&a===0&&(this.isEmpty=!0),!this.isRest&&(!this.isLetRing||!this.isPalmMute)){let u=this.previousBeat;for(;u&&u.isRest;)this.isLetRing||(u.isLetRing=!1),this.isPalmMute||(u.isPalmMute=!1),u=u.previousBeat}else this.isRest&&this.previousBeat&&e&&e.notation.notationMode===Qt.GuitarPro&&(this.previousBeat.isLetRing&&(this.isLetRing=!0),this.previousBeat.isPalmMute&&(this.isPalmMute=!0));const l=this.whammyBarPoints;if(l!==null&&l.length>0&&this.whammyBarType===je.Custom){s===Qt.SongBook&&(this.whammyStyle=r?qe.Gradual:qe.Fast);let u=!!this.previousBeat&&this.previousBeat.hasWhammyBar;if(this.isContinuedWhammy=u,l.length===4){let h=l[0],c=l[1],d=l[2],f=l[3];c.value===d.value&&(h.value<c.value&&c.value<f.value||h.value>c.value&&c.value>f.value?(h.value!==0&&!u?this.whammyBarType=je.PrediveDive:this.whammyBarType=je.Dive,l.splice(2,1),l.splice(1,1)):h.value>c.value&&c.value<f.value||h.value<c.value&&c.value>f.value?(this.whammyBarType=je.Dip,(c.offset===d.offset||s===Qt.SongBook)&&l.splice(2,1)):h.value===c.value&&c.value===f.value&&(h.value!==0&&!u?this.whammyBarType=je.Predive:this.whammyBarType=je.Hold,l.splice(2,1),l.splice(1,1)))}}if(this.updateDurations(),n){let u=D0.clone(this);u.id=xi._globalBeatId++,u.pickStroke=fi.None;for(let h=0,c=u.notes.length;h<c;h++){let d=u.notes[h],f=this.notes[h];if(d.bendType=se.None,d.maxBendPoint=null,d.bendPoints=null,d.bendStyle=qe.Default,d.id=Ss.GlobalNoteId++,f.isTieOrigin&&(d.tieDestination=f.tieDestination,f.tieDestination.tieOrigin=d),f.isTieDestination&&(d.tieOrigin=f.tieOrigin?f.tieOrigin:null,f.tieOrigin.tieDestination=d),f.hasBend&&f.isTieOrigin){let p=Ss.findTieOrigin(f);if(p&&p.hasBend){d.bendType=se.Hold;let g=f.bendPoints[f.bendPoints.length-1];d.addBendPoint(new G(0,g.value)),d.addBendPoint(new G(G.MaxPosition,g.value))}}d.isTieDestination=!0}this.graceType=he.BendGrace,this.graceGroup=new Ag,this.graceGroup.addBeat(this),this.graceGroup.isComplete=!0,this.graceGroup.finish(),this.updateDurations(),this.voice.insertBeat(this,u),u.graceGroup=new Ag,u.graceGroup.addBeat(this),u.graceGroup.isComplete=!0,u.graceGroup.finish()}}isBefore(e){return this.voice.bar.index<e.voice.bar.index||e.voice.bar.index===this.voice.bar.index&&this.index<e.index}isAfter(e){return this.voice.bar.index>e.voice.bar.index||e.voice.bar.index===this.voice.bar.index&&this.index>e.index}hasNoteOnString(e){return this.noteStringLookup.has(e)}getNoteWithRealValue(e){return this.noteValueLookup.has(e)?this.noteValueLookup.get(e):null}chain(e=null){for(const t of this.notes)this.noteValueLookup.set(t.realValue,t),t.chain(e)}}xi._globalBeatId=0;class Qn{constructor(){this.name="",this.firstFret=1,this.strings=[],this.barreFrets=[],this.showName=!0,this.showDiagram=!0,this.showFingering=!0}get uniqueId(){return[this.name,this.firstFret.toString(),this.strings.join(","),this.barreFrets.join(","),this.showDiagram.toString(),this.showFingering.toString(),this.showName.toString()].join("|")}}var Le;(function(i){i[i.Cb=-7]="Cb",i[i.Gb=-6]="Gb",i[i.Db=-5]="Db",i[i.Ab=-4]="Ab",i[i.Eb=-3]="Eb",i[i.Bb=-2]="Bb",i[i.F=-1]="F",i[i.C=0]="C",i[i.G=1]="G",i[i.D=2]="D",i[i.A=3]="A",i[i.E=4]="E",i[i.B=5]="B",i[i.FSharp=6]="FSharp",i[i.CSharp=7]="CSharp"})(Le||(Le={}));var _i;(function(i){i[i.IgnoreSpaces=0]="IgnoreSpaces",i[i.Begin=1]="Begin",i[i.Text=2]="Text",i[i.Comment=3]="Comment",i[i.Dash=4]="Dash"})(_i||(_i={}));class Ht{constructor(){this.startBar=0,this.text=""}finish(e=!1){this.chunks=[],this.parse(this.text,0,this.chunks,e)}parse(e,t,s,r){if(!e)return;let n=_i.Begin,a=_i.Begin,o=!1,l=0;for(;t<e.length;){let u=e.charCodeAt(t);switch(n){case _i.IgnoreSpaces:switch(u){case Ht.CharCodeLF:case Ht.CharCodeCR:case Ht.CharCodeTab:break;case Ht.CharCodeSpace:if(!o){n=a;continue}break;default:o=!1,n=a;continue}break;case _i.Begin:switch(u){case Ht.CharCodeBrackedOpen:n=_i.Comment;break;default:l=t,n=_i.Text;continue}break;case _i.Comment:switch(u){case Ht.CharCodeBrackedClose:n=_i.Begin;break}break;case _i.Text:switch(u){case Ht.CharCodeDash:n=_i.Dash;break;case Ht.CharCodeCR:case Ht.CharCodeLF:case Ht.CharCodeSpace:let h=e.substr(l,t-l);this.addChunk(h,r),n=_i.IgnoreSpaces,a=_i.Begin;break}break;case _i.Dash:switch(u){case Ht.CharCodeDash:break;default:let h=e.substr(l,t-l);this.addChunk(h,r),o=!0,n=_i.IgnoreSpaces,a=_i.Begin;continue}break}t+=1}n===_i.Text&&t!==l&&this.addChunk(e.substr(l,t-l),r)}addChunk(e,t){e=this.prepareChunk(e),(!t||e.length>0&&e!=="-")&&this.chunks.push(e)}prepareChunk(e){let t=e.split("+").join(" "),s=t.length;for(;s>0&&t.charAt(s-1)==="_";)s--;return s!==t.length?t.substr(0,s):t}}Ht.CharCodeLF=10;Ht.CharCodeTab=9;Ht.CharCodeCR=13;Ht.CharCodeSpace=32;Ht.CharCodeBrackedClose=93;Ht.CharCodeBrackedOpen=91;Ht.CharCodeDash=45;var wr;(function(i){i[i.Major=0]="Major",i[i.Minor=1]="Minor"})(wr||(wr={}));var Pe;(function(i){i[i.NoTripletFeel=0]="NoTripletFeel",i[i.Triplet16th=1]="Triplet16th",i[i.Triplet8th=2]="Triplet8th",i[i.Dotted16th=3]="Dotted16th",i[i.Dotted8th=4]="Dotted8th",i[i.Scottish16th=5]="Scottish16th",i[i.Scottish8th=6]="Scottish8th"})(Pe||(Pe={}));class gn{constructor(){this.alternateEndings=0,this.nextMasterBar=null,this.previousMasterBar=null,this.index=0,this.keySignature=Le.C,this.keySignatureType=wr.Major,this.isDoubleBar=!1,this.isRepeatStart=!1,this.repeatCount=0,this.timeSignatureNumerator=4,this.timeSignatureDenominator=4,this.timeSignatureCommon=!1,this.isFreeTime=!1,this.tripletFeel=Pe.NoTripletFeel,this.section=null,this.tempoAutomations=[],this.fermata=null,this.start=0,this.isAnacrusis=!1,this.displayScale=1,this.displayWidth=-1}get isRepeatEnd(){return this.repeatCount>0}get isSectionStart(){return!!this.section}get tempoAutomation(){return this.tempoAutomations.length>0?this.tempoAutomations[0]:null}calculateDuration(e=!0){if(this.isAnacrusis&&e){let t=0;for(let s of this.score.tracks)for(let r of s.staves){let n=this.index<r.bars.length?r.bars[this.index].calculateDuration():0;n>t&&(t=n)}return t}return this.timeSignatureNumerator*ke.valueToTicks(this.timeSignatureDenominator)}addFermata(e,t){let s=this.fermata;s===null&&(s=new Map,this.fermata=s),s.set(e,t)}getFermata(e){const t=this.fermata;return t===null?null:t.has(e.playbackStart)?t.get(e.playbackStart):null}}gn.MaxAlternateEndings=8;class $R{constructor(){this.hideDynamics=!1}}class Ob{constructor(){this.masterBars=[],this.opening=null,this.closings=[],this.isClosed=!1}get openings(){const e=this.opening;return e?[e]:[]}get isOpened(){var e;return((e=this.opening)==null?void 0:e.isRepeatStart)===!0}addMasterBar(e){this.opening===null&&(this.opening=e),this.masterBars.push(e),e.repeatGroup=this,e.isRepeatEnd&&(this.closings.push(e),this.isClosed=!0)}}class Fa{constructor(){this._currentRepeatGroup=null,this._openedRepeatGroups=[],this._properlyOpenedRepeatGroups=0,this.album="",this.artist="",this.copyright="",this.instructions="",this.music="",this.notices="",this.subTitle="",this.title="",this.words="",this.tab="",this.tempo=120,this.tempoLabel="",this.masterBars=[],this.tracks=[],this.defaultSystemsLayout=3,this.systemsLayout=[],this.stylesheet=new $R}rebuildRepeatGroups(){this._currentRepeatGroup=null,this._openedRepeatGroups=[],this._properlyOpenedRepeatGroups=0;for(const e of this.masterBars)this.addMasterBarToRepeatGroups(e)}addMasterBar(e){e.score=this,e.index=this.masterBars.length,this.masterBars.length!==0&&(e.previousMasterBar=this.masterBars[this.masterBars.length-1],e.previousMasterBar.nextMasterBar=e,e.start=e.previousMasterBar.start+(e.previousMasterBar.isAnacrusis?0:e.previousMasterBar.calculateDuration())),this.addMasterBarToRepeatGroups(e),this.masterBars.push(e)}addMasterBarToRepeatGroups(e){var t;e.isRepeatStart?((t=this._currentRepeatGroup)!=null&&t.isClosed&&(this._openedRepeatGroups.pop(),this._properlyOpenedRepeatGroups--),this._currentRepeatGroup=new Ob,this._openedRepeatGroups.push(this._currentRepeatGroup),this._properlyOpenedRepeatGroups++):this._currentRepeatGroup||(this._currentRepeatGroup=new Ob,this._openedRepeatGroups.push(this._currentRepeatGroup)),this._currentRepeatGroup.addMasterBar(e),e.isRepeatEnd&&this._properlyOpenedRepeatGroups>1&&(this._openedRepeatGroups.pop(),this._properlyOpenedRepeatGroups--,this._currentRepeatGroup=this._openedRepeatGroups.length>0?this._openedRepeatGroups[this._openedRepeatGroups.length-1]:null)}addTrack(e){e.score=this,e.index=this.tracks.length,this.tracks.push(e)}finish(e){const t=new Map;for(let s=0,r=this.tracks.length;s<r;s++)this.tracks[s].finish(e,t)}}let Od=class{constructor(){this.marker="",this.text=""}};class Vt extends ni{constructor(e){super(ri.Format,e),Object.setPrototypeOf(this,Vt.prototype)}}class Je{constructor(e,t,s,r=255){this.raw=0,this.raw=(r&255)<<24|(e&255)<<16|(t&255)<<8|s&255,this.updateRgba()}updateRgba(){this.a===255?this.rgba="#"+et.toHexString(this.r,2)+et.toHexString(this.g,2)+et.toHexString(this.b,2):this.rgba=`rgba(${this.r},${this.g},${this.b},${this.a/255})`}get a(){return this.raw>>24&255}get r(){return this.raw>>16&255}get g(){return this.raw>>8&255}get b(){return this.raw&255}static random(e=100){return new Je(Math.random()*255|0,Math.random()*255|0,Math.random()*255|0,e)}static fromJson(e){if(e instanceof Je)return e;switch(typeof e){case"number":{const t=new Je(0,0,0,0);return t.raw=e,t.updateRgba(),t}case"string":{const t=e;if(t.startsWith("#")){if(t.length===4)return new Je(parseInt(t[1],16)*17,parseInt(t[2],16)*17,parseInt(t[3],16)*17);if(t.length===5)return new Je(parseInt(t[1],16)*17,parseInt(t[2],16)*17,parseInt(t[3],16)*17,parseInt(t[4],16)*17);if(t.length===7)return new Je(parseInt(t.substring(1,3),16),parseInt(t.substring(3,5),16),parseInt(t.substring(5,7),16));if(t.length===9)return new Je(parseInt(t.substring(1,3),16),parseInt(t.substring(3,5),16),parseInt(t.substring(5,7),16),parseInt(t.substring(7,9),16))}else if(t.startsWith("rgba")||t.startsWith("rgb")){const s=t.indexOf("("),r=t.lastIndexOf(")");if(s===-1||r===-1)throw new Vt("No values specified for rgb/rgba function");const n=t.substring(s+1,r).split(",");if(n.length===3)return new Je(parseInt(n[0]),parseInt(n[1]),parseInt(n[2]));if(n.length===4)return new Je(parseInt(n[0]),parseInt(n[1]),parseInt(n[2]),parseFloat(n[3])*255)}return null}}throw new Vt("Unsupported format for color")}static toJson(e){return e.raw}}Je.BlackRgb="#000000";class S_{constructor(){this.volume=15,this.balance=8,this.port=1,this.program=0,this.primaryChannel=0,this.secondaryChannel=0,this.isMute=!1,this.isSolo=!1}}class H{static getTextForTuning(e,t){let s=H.getTextPartsForTuning(e);return t?s.join(""):s[0]}static getTextPartsForTuning(e,t=-1){let s=e/12|0,r=e%12;return[["C","Db","D","Eb","E","F","Gb","G","Ab","A","Bb","B"][r],(s+t).toString()]}static getDefaultTuningFor(e){return H._defaultTunings.has(e)?H._defaultTunings.get(e):null}static getPresetsFor(e){switch(e){case 7:return H._sevenStrings;case 6:return H._sixStrings;case 5:return H._fiveStrings;case 4:return H._fourStrings}return[]}static initialize(){H._defaultTunings.set(7,new H("Guitar 7 strings",[64,59,55,50,45,40,35],!0)),H._sevenStrings.push(H._defaultTunings.get(7)),H._defaultTunings.set(6,new H("Guitar Standard Tuning",[64,59,55,50,45,40],!0)),H._sixStrings.push(H._defaultTunings.get(6)),H._sixStrings.push(new H("Guitar Tune down ½ step",[63,58,54,49,44,39],!1)),H._sixStrings.push(new H("Guitar Tune down 1 step",[62,57,53,48,43,38],!1)),H._sixStrings.push(new H("Guitar Tune down 2 step",[60,55,51,46,41,36],!1)),H._sixStrings.push(new H("Guitar Dropped D Tuning",[64,59,55,50,45,38],!1)),H._sixStrings.push(new H("Guitar Dropped D Tuning variant",[64,57,55,50,45,38],!1)),H._sixStrings.push(new H("Guitar Double Dropped D Tuning",[62,59,55,50,45,38],!1)),H._sixStrings.push(new H("Guitar Dropped E Tuning",[66,61,57,52,47,40],!1)),H._sixStrings.push(new H("Guitar Dropped C Tuning",[62,57,53,48,43,36],!1)),H._sixStrings.push(new H("Guitar Open C Tuning",[64,60,55,48,43,36],!1)),H._sixStrings.push(new H("Guitar Open Cm Tuning",[63,60,55,48,43,36],!1)),H._sixStrings.push(new H("Guitar Open C6 Tuning",[64,57,55,48,43,36],!1)),H._sixStrings.push(new H("Guitar Open Cmaj7 Tuning",[64,59,55,52,43,36],!1)),H._sixStrings.push(new H("Guitar Open D Tuning",[62,57,54,50,45,38],!1)),H._sixStrings.push(new H("Guitar Open Dm Tuning",[62,57,53,50,45,38],!1)),H._sixStrings.push(new H("Guitar Open D5 Tuning",[62,57,50,50,45,38],!1)),H._sixStrings.push(new H("Guitar Open D6 Tuning",[62,59,54,50,45,38],!1)),H._sixStrings.push(new H("Guitar Open Dsus4 Tuning",[62,57,55,50,45,38],!1)),H._sixStrings.push(new H("Guitar Open E Tuning",[64,59,56,52,47,40],!1)),H._sixStrings.push(new H("Guitar Open Em Tuning",[64,59,55,52,47,40],!1)),H._sixStrings.push(new H("Guitar Open Esus11 Tuning",[64,59,55,52,45,40],!1)),H._sixStrings.push(new H("Guitar Open F Tuning",[65,60,53,48,45,41],!1)),H._sixStrings.push(new H("Guitar Open G Tuning",[62,59,55,50,43,38],!1)),H._sixStrings.push(new H("Guitar Open Gm Tuning",[62,58,55,50,43,38],!1)),H._sixStrings.push(new H("Guitar Open G6 Tuning",[64,59,55,50,43,38],!1)),H._sixStrings.push(new H("Guitar Open Gsus4 Tuning",[62,60,55,50,43,38],!1)),H._sixStrings.push(new H("Guitar Open A Tuning",[64,61,57,52,45,40],!1)),H._sixStrings.push(new H("Guitar Open Am Tuning",[64,60,57,52,45,40],!1)),H._sixStrings.push(new H("Guitar Nashville Tuning",[64,59,67,62,57,52],!1)),H._sixStrings.push(new H("Bass 6 Strings Tuning",[48,43,38,33,28,23],!1)),H._sixStrings.push(new H("Lute or Vihuela Tuning",[64,59,54,50,45,40],!1)),H._defaultTunings.set(5,new H("Bass 5 Strings Tuning",[43,38,33,28,23],!0)),H._fiveStrings.push(H._defaultTunings.get(5)),H._fiveStrings.push(new H("Banjo Dropped C Tuning",[62,59,55,48,67],!1)),H._fiveStrings.push(new H("Banjo Open D Tuning",[62,57,54,50,69],!1)),H._fiveStrings.push(new H("Banjo Open G Tuning",[62,59,55,50,67],!1)),H._fiveStrings.push(new H("Banjo G Minor Tuning",[62,58,55,50,67],!1)),H._fiveStrings.push(new H("Banjo G Modal Tuning",[62,57,55,50,67],!1)),H._defaultTunings.set(4,new H("Bass Standard Tuning",[43,38,33,28],!0)),H._fourStrings.push(H._defaultTunings.get(4)),H._fourStrings.push(new H("Bass Tune down ½ step",[42,37,32,27],!1)),H._fourStrings.push(new H("Bass Tune down 1 step",[41,36,31,26],!1)),H._fourStrings.push(new H("Bass Tune down 2 step",[39,34,29,24],!1)),H._fourStrings.push(new H("Bass Dropped D Tuning",[43,38,33,26],!1)),H._fourStrings.push(new H("Ukulele C Tuning",[45,40,36,43],!1)),H._fourStrings.push(new H("Ukulele G Tuning",[52,47,43,38],!1)),H._fourStrings.push(new H("Mandolin Standard Tuning",[64,57,50,43],!1)),H._fourStrings.push(new H("Mandolin or Violin Tuning",[76,69,62,55],!1)),H._fourStrings.push(new H("Viola Tuning",[69,62,55,48],!1)),H._fourStrings.push(new H("Cello Tuning",[57,50,43,36],!1))}static findTuning(e){let t=H.getPresetsFor(e.length);for(let s=0,r=t.length;s<r;s++){let n=t[s],a=!0;for(let o=0,l=e.length;o<l;o++)if(e[o]!==n.tunings[o]){a=!1;break}if(a)return n}return null}constructor(e="",t=null,s=!1){this.isStandard=s,this.name=e,this.tunings=t??[]}finish(){const e=H.findTuning(this.tunings);e&&(this.name=e.name,this.isStandard=e.isStandard),this.name=this.name.trim()}}H._sevenStrings=[];H._sixStrings=[];H._fiveStrings=[];H._fourStrings=[];H._defaultTunings=new Map;H.defaultAccidentals=["","#","","#","","","#","","#","","#",""];H.defaultSteps=["C","C","D","D","E","F","F","G","G","A","A","B"];H.initialize();class w_{constructor(){this.index=0,this.bars=[],this.chords=null,this.capo=0,this.transpositionPitch=0,this.displayTranspositionPitch=0,this.stringTuning=new H("",[],!1),this.showSlash=!1,this.showNumbered=!1,this.showTablature=!0,this.showStandardNotation=!0,this.isPercussion=!1,this.standardNotationLineCount=5}get tuning(){return this.stringTuning.tunings}get tuningName(){return this.stringTuning.name}get isStringed(){return this.stringTuning.tunings.length>0}finish(e,t=null){this.stringTuning.finish();for(let s=0,r=this.bars.length;s<r;s++)this.bars[s].finish(e,t)}addChord(e,t){t.staff=this;let s=this.chords;s===null&&(s=new Map,this.chords=s),s.set(e,t)}hasChord(e){var t;return((t=this.chords)==null?void 0:t.has(e))??!1}getChord(e){var t;return((t=this.chords)==null?void 0:t.get(e))??null}addBar(e){let t=this.bars;e.staff=this,e.index=t.length,t.length>0&&(e.previousBar=t[t.length-1],e.previousBar.nextBar=e),t.push(e)}}let Va=class Ig{constructor(){this.index=0,this.staves=[],this.playbackInfo=new S_,this.color=new Je(200,0,0,255),this.name="",this.isVisibleOnMultiTrack=!0,this.shortName="",this.defaultSystemsLayout=3,this.systemsLayout=[],this.percussionArticulations=[]}ensureStaveCount(e){for(;this.staves.length<e;)this.addStaff(new w_)}addStaff(e){e.index=this.staves.length,e.track=this,this.staves.push(e)}finish(e,t=null){this.shortName||(this.shortName=this.name,this.shortName.length>Ig.ShortNameMaxLength&&(this.shortName=this.shortName.substr(0,Ig.ShortNameMaxLength)));for(let s=0,r=this.staves.length;s<r;s++)this.staves[s].finish(e,t)}applyLyrics(e){for(let s of e)s.finish();let t=this.staves[0];for(let s=0;s<e.length;s++){let r=e[s];if(r.startBar>=0&&r.startBar<t.bars.length){let n=t.bars[r.startBar].voices[0].beats[0];for(let a=0;a<r.chunks.length&&n;a++){for(;n&&(n.isEmpty||n.isRest);)n=n.nextBeat;n&&(n.lyrics||(n.lyrics=new Array(e.length),n.lyrics.fill("")),n.lyrics[s]=r.chunks[a],n=n.nextBeat)}}}}};Va.ShortNameMaxLength=10;let Wr=class v_{constructor(){this.id=v_._globalBarId++,this.index=0,this.beats=[],this.isEmpty=!0}insertBeat(e,t){t.nextBeat=e.nextBeat,t.nextBeat&&(t.nextBeat.previousBeat=t),t.previousBeat=e,t.voice=this,e.nextBeat=t,this.beats.splice(e.index+1,0,t)}addBeat(e){e.voice=this,e.index=this.beats.length,this.beats.push(e),e.isEmpty||(this.isEmpty=!1)}chain(e,t=null){if(this.bar){if(e.index<this.beats.length-1)e.nextBeat=this.beats[e.index+1],e.nextBeat.previousBeat=e;else if(e.isLastOfVoice&&e.voice.bar.nextBar){let s=this.bar.nextBar.voices[this.index];s.beats.length>0&&(e.nextBeat=s.beats[0]),e.nextBeat.previousBeat=e}e.chain(t)}}addGraceBeat(e){if(this.beats.length===0){this.addBeat(e);return}let t=this.beats[this.beats.length-1];this.beats.splice(this.beats.length-1,1),this.addBeat(e),this.addBeat(t),this.isEmpty=!1}getBeatAtPlaybackStart(e){return this._beatLookup.has(e)?this._beatLookup.get(e):null}finish(e,t=null){this._beatLookup=new Map;let s=null;for(let a=0;a<this.beats.length;a++){let o=this.beats[a];o.index=a,this.chain(o,t),o.graceType===he.None?(o.graceGroup=s,s&&(s.isComplete=!0),s=null):(s||(s=new Ag),s.addBeat(o))}let r=0,n=0;for(let a=0;a<this.beats.length;a++){let o=this.beats[a];if(o.index=a,o.finish(e,t),o.graceType===he.None){if(o.graceGroup){const l=o.graceGroup.beats[0],u=o.graceGroup.beats[o.graceGroup.beats.length-1];if(l.graceType!==he.BendGrace){let h=u.playbackStart+u.playbackDuration-l.playbackStart;switch(l.graceType){case he.BeforeBeat:l.previousBeat?(l.previousBeat.playbackDuration-=h,l.previousBeat.voice==this?n=l.previousBeat.playbackStart+l.previousBeat.playbackDuration:n=-h):n=-h;for(const c of o.graceGroup.beats)this._beatLookup.delete(c.playbackStart),c.playbackStart=n,this._beatLookup.set(c.playbackStart,o),n+=c.playbackDuration;break;case he.OnBeat:o.playbackDuration-=h,u.voice===this?n=u.playbackStart+u.playbackDuration:n=-h;break}}}o.displayStart=r,o.playbackStart=n,o.fermata?this.bar.masterBar.addFermata(o.playbackStart,o.fermata):o.fermata=this.bar.masterBar.getFermata(o),this._beatLookup.set(o.playbackStart,o)}else o.displayStart=r,o.playbackStart=n;o.finishTuplet(),o.graceGroup&&o.graceGroup.finish(),r+=o.displayDuration,n+=o.playbackDuration}}calculateDuration(){if(this.isEmpty||this.beats.length===0)return 0;let e=this.beats[this.beats.length-1],t=this.beats[0];return e.playbackStart+e.playbackDuration-t.playbackStart}};Wr._globalBarId=0;class Ce{static float64ToBytes(e){return Ce._dataView.setFloat64(0,e,!0),this._conversionByteArray}static bytesToFloat64(e){throw Ce._conversionByteArray.set(e,0),Ce._dataView.getFloat64(0,!0)}static uint16ToInt16(e){return Ce._dataView.setUint16(0,e,!0),Ce._dataView.getInt16(0,!0)}static int16ToUint32(e){return Ce._dataView.setInt16(0,e,!0),Ce._dataView.getUint32(0,!0)}static int32ToUint16(e){return Ce._dataView.setInt32(0,e,!0),Ce._dataView.getUint16(0,!0)}static int32ToInt16(e){return Ce._dataView.setInt32(0,e,!0),Ce._dataView.getInt16(0,!0)}static int32ToUint32(e){return Ce._dataView.setInt32(0,e,!0),Ce._dataView.getUint32(0,!0)}static uint8ToInt8(e){return Ce._dataView.setUint8(0,e),Ce._dataView.getInt8(0)}}Ce._conversionBuffer=new ArrayBuffer(8);Ce._conversionByteArray=new Uint8Array(Ce._conversionBuffer);Ce._dataView=new DataView(Ce._conversionBuffer);class L{static readInt32BE(e){let t=e.readByte(),s=e.readByte(),r=e.readByte(),n=e.readByte();return t<<24|s<<16|r<<8|n}static readInt32LE(e){let t=e.readByte(),s=e.readByte(),r=e.readByte();return e.readByte()<<24|r<<16|s<<8|t}static readUInt32LE(e){let t=e.readByte(),s=e.readByte(),r=e.readByte();return e.readByte()<<24|r<<16|s<<8|t}static decodeUInt32LE(e,t){let s=e[t],r=e[t+1],n=e[t+2];return e[t+3]<<24|n<<16|r<<8|s}static readUInt16LE(e){let t=e.readByte(),s=e.readByte();return Ce.int32ToUint16(s<<8|t)}static readInt16LE(e){let t=e.readByte(),s=e.readByte();return Ce.int32ToInt16(s<<8|t)}static readUInt32BE(e){let t=e.readByte(),s=e.readByte(),r=e.readByte(),n=e.readByte();return Ce.int32ToUint32(t<<24|s<<16|r<<8|n)}static readUInt16BE(e){let t=e.readByte(),s=e.readByte();return Ce.int32ToInt16(t<<8|s)}static readInt16BE(e){let t=e.readByte(),s=e.readByte();return Ce.int32ToInt16(t<<8|s)}static readByteArray(e,t){let s=new Uint8Array(t);return e.read(s,0,t),s}static read8BitChars(e,t){let s=new Uint8Array(t);return e.read(s,0,s.length),L.toString(s,"utf-8")}static read8BitString(e){let t="",s=e.readByte();for(;s!==0;)t+=String.fromCharCode(s),s=e.readByte();return t}static read8BitStringLength(e,t){let s="",r=-1;for(let a=0;a<t;a++){let o=e.readByte();o===0&&r===-1&&(r=a),s+=String.fromCharCode(o)}let n=s;return r>=0?n.substr(0,r):n}static readSInt8(e){let t=e.readByte();return((t&255)>>7)*-256+(t&255)}static readInt24(e,t){let s=e[t]|e[t+1]<<8|e[t+2]<<16;return(s&8388608)===8388608&&(s=s|255<<24),s}static readInt16(e,t){return Ce.int32ToInt16(e[t]|e[t+1]<<8)}static toString(e,t){let s=L.detectEncoding(e);return s&&(t=s),t||(t="utf-8"),new TextDecoder(t).decode(e.buffer)}static detectEncoding(e){return e.length>2&&e[0]===254&&e[1]===255?"utf-16be":e.length>2&&e[0]===255&&e[1]===254?"utf-16le":e.length>4&&e[0]===0&&e[1]===0&&e[2]===254&&e[3]===255?"utf-32be":e.length>4&&e[0]===255&&e[1]===254&&e[2]===0&&e[3]===0?"utf-32le":null}static stringToBytes(e){return new TextEncoder().encode(e)}static writeInt32BE(e,t){e.writeByte(t>>24&255),e.writeByte(t>>16&255),e.writeByte(t>>8&255),e.writeByte(t>>0&255)}static writeInt32LE(e,t){e.writeByte(t>>0&255),e.writeByte(t>>8&255),e.writeByte(t>>16&255),e.writeByte(t>>24&255)}static writeUInt16LE(e,t){e.writeByte(t>>0&255),e.writeByte(t>>8&255)}static writeInt16LE(e,t){e.writeByte(t>>0&255),e.writeByte(t>>8&255)}static writeInt16BE(e,t){e.writeByte(t>>8&255),e.writeByte(t>>0&255)}}class si{constructor(){this.length=0,this.position=0}get bytesWritten(){return this.position}getBuffer(){return this._buffer}static empty(){return si.withCapacity(0)}static withCapacity(e){let t=new si;return t._buffer=new Uint8Array(e),t}static fromBuffer(e){let t=new si;return t._buffer=e,t.length=e.length,t}static fromString(e){let t=L.stringToBytes(e);return si.fromBuffer(t)}reset(){this.position=0}skip(e){this.position+=e}readByte(){return this.length-this.position<=0?-1:this._buffer[this.position++]}read(e,t,s){let r=this.length-this.position;return r>s&&(r=s),r<=0?0:(e.set(this._buffer.subarray(this.position,this.position+r),t),this.position+=r,r)}writeByte(e){let t=this.position+1;this.ensureCapacity(t),this._buffer[this.position]=e&255,t>this.length&&(this.length=t),this.position=t}write(e,t,s){let r=this.position+s;this.ensureCapacity(r);let n=Math.min(s,e.length-t);this._buffer.set(e.subarray(t,t+n),this.position),r>this.length&&(this.length=r),this.position=r}ensureCapacity(e){if(e>this._buffer.length){let t=e;t<256&&(t=256),t<this._buffer.length*2&&(t=this._buffer.length*2);let s=new Uint8Array(t);this.length>0&&s.set(this._buffer.subarray(0,0+this.length),0),this._buffer=s}}readAll(){return this.toArray()}toArray(){let e=new Uint8Array(this.length);return e.set(this._buffer.subarray(0,0+this.length),0),e}copyTo(e){e.write(this._buffer,0,this.length)}}var M;(function(i){i[i.No=0]="No",i[i.Eof=1]="Eof",i[i.Number=2]="Number",i[i.DoubleDot=3]="DoubleDot",i[i.Dot=4]="Dot",i[i.String=5]="String",i[i.Tuning=6]="Tuning",i[i.LParensis=7]="LParensis",i[i.RParensis=8]="RParensis",i[i.LBrace=9]="LBrace",i[i.RBrace=10]="RBrace",i[i.Pipe=11]="Pipe",i[i.MetaCommand=12]="MetaCommand",i[i.Multiply=13]="Multiply",i[i.LowerThan=14]="LowerThan"})(M||(M={}));class ya extends ni{constructor(e,t,s,r,n,a,o,l=null){super(ri.AlphaTex,e),this.position=t,this.line=s,this.col=r,this.nonTerm=n??"",this.expected=a??M.No,this.symbol=o??M.No,this.symbolData=l,Object.setPrototypeOf(this,ya.prototype)}static symbolError(e,t,s,r,n,a,o=null){let l=`MalFormed AlphaTex: @${e} (line ${t}, col ${s}): Error on block ${r}`;return n!==a?(l+=`, expected a ${M[n]} found a ${M[a]}`,o!==null&&(l+=`: '${o}'`)):l+=`, invalid value: '${o}'`,new ya(l,e,t,s,r,n,a,o)}static errorMessage(e,t,s,r){return e=`MalFormed AlphaTex: @${t} (line ${s}, col ${r}): ${e}`,new ya(e,t,s,r,null,null,null,null)}}class Ti extends Qo{constructor(){super(),this._trackChannel=0,this._input="",this._ch=Ti.Eof,this._curChPos=0,this._line=1,this._col=0,this._lastValidSpot=[0,1,0],this._sy=M.No,this._syData="",this._allowNegatives=!1,this._allowFloat=!1,this._allowTuning=!1,this._currentDuration=N.QuadrupleWhole,this._currentDynamics=Me.PPP,this._currentTuplet=0,this._staffHasExplicitTuning=!1,this._staffTuningApplied=!1,this._percussionArticulationNames=new Map,this.logErrors=!1}get name(){return"AlphaTex"}initFromString(e,t){this.data=si.empty(),this._input=e,this.settings=t}readScore(){try{if(this.data.length>0&&(this._input=L.toString(this.data.readAll(),this.settings.importer.encoding)),this._allowTuning=!0,this._lyrics=new Map,this.createDefaultScore(),this._curChPos=0,this._line=1,this._col=0,this.saveValidSpot(),this._currentDuration=N.Quarter,this._currentDynamics=Me.F,this._currentTuplet=1,this._ch=this.nextChar(),this._sy=this.newSy(),this._sy===M.LowerThan)throw new yt("Unknown start sign '<' (meant to import as XML?)");if(this._sy===M.Eof)throw new yt("Unexpected end of file");const e=this.metaData(),t=this.bars();if(!e&&!t)throw new yt("No alphaTex data found");this.consolidate(),this._score.finish(this.settings),this._score.rebuildRepeatGroups();for(const[s,r]of this._lyrics)this._score.tracks[s].applyLyrics(r);return this._score}catch(e){throw e instanceof ya?new yt(e.message,e):e}}consolidate(){for(let e of this._score.tracks)for(let t of e.staves)for(;t.bars.length<this._score.masterBars.length;){let s=this.newBar(t),r=new xi;r.isEmpty=!0,s.voices[0].addBeat(r)}}error(e,t,s=!0){let r,n=!1;s?(r=this._sy,(r===M.String||r===M.Number||r===M.MetaCommand)&&(n=!0)):r=t;let a=ya.symbolError(this._lastValidSpot[0],this._lastValidSpot[1],this._lastValidSpot[2],e,t,r,n?this._syData:null);throw this.logErrors&&I.error(this.name,a.message),a}errorMessage(e){let t=ya.errorMessage(e,this._lastValidSpot[0],this._lastValidSpot[1],this._lastValidSpot[2]);throw this.logErrors&&I.error(this.name,t.message),t}createDefaultScore(){this._score=new Fa,this._score.tempo=120,this._score.tempoLabel="",this.newTrack()}newTrack(){this._currentTrack=new Va,this._currentTrack.ensureStaveCount(1),this._currentTrack.playbackInfo.program=25,this._currentTrack.playbackInfo.primaryChannel=this._trackChannel++,this._currentTrack.playbackInfo.secondaryChannel=this._trackChannel++,this._currentStaff=this._currentTrack.staves[0],this._currentStaff.displayTranspositionPitch=-12,this._currentStaff.stringTuning.tunings=H.getDefaultTuningFor(6).tunings,this._score.addTrack(this._currentTrack),this._lyrics.set(this._currentTrack.index,[]),this._currentDynamics=Me.F}parseClefFromString(e){switch(e.toLowerCase()){case"g2":case"treble":return ve.G2;case"f4":case"bass":return ve.F4;case"c3":case"tenor":return ve.C3;case"c4":case"alto":return ve.C4;case"n":case"neutral":return ve.Neutral;default:return ve.G2}}parseClefFromInt(e){switch(e){case 43:return ve.G2;case 65:return ve.F4;case 48:return ve.C3;case 60:return ve.C4;default:return ve.G2}}parseTripletFeelFromString(e){switch(e.toLowerCase()){case"no":case"none":return Pe.NoTripletFeel;case"t16":case"triplet-16th":return Pe.Triplet16th;case"t8":case"triplet-8th":return Pe.Triplet8th;case"d16":case"dotted-16th":return Pe.Dotted16th;case"d8":case"dotted-8th":return Pe.Dotted8th;case"s16":case"scottish-16th":return Pe.Scottish16th;case"s8":case"scottish-8th":return Pe.Scottish8th;default:return Pe.NoTripletFeel}}parseTripletFeelFromInt(e){switch(e){case 0:return Pe.NoTripletFeel;case 1:return Pe.Triplet16th;case 2:return Pe.Triplet8th;case 3:return Pe.Dotted16th;case 4:return Pe.Dotted8th;case 5:return Pe.Scottish16th;case 6:return Pe.Scottish8th;default:return Pe.NoTripletFeel}}parseKeySignature(e){switch(e.toLowerCase()){case"cb":case"cbmajor":return Le.Cb;case"gb":case"gbmajor":case"d#minor":return Le.Gb;case"db":case"dbmajor":case"bbminor":return Le.Db;case"ab":case"abmajor":case"fminor":return Le.Ab;case"eb":case"ebmajor":case"cminor":return Le.Eb;case"bb":case"bbmajor":case"gminor":return Le.Bb;case"f":case"fmajor":case"dminor":return Le.F;case"c":case"cmajor":case"aminor":return Le.C;case"g":case"gmajor":case"eminor":return Le.G;case"d":case"dmajor":case"bminor":return Le.D;case"a":case"amajor":case"f#minor":return Le.A;case"e":case"emajor":case"c#minor":return Le.E;case"b":case"bmajor":case"g#minor":return Le.B;case"f#":case"f#major":case"ebminor":return Le.FSharp;case"c#":case"c#major":return Le.CSharp;default:return Le.C}}nextChar(){return this._curChPos<this._input.length?(this._ch=this._input.charCodeAt(this._curChPos++),this._ch===10?(this._line++,this._col=0):this._col++):this._ch=Ti.Eof,this._ch}saveValidSpot(){this._lastValidSpot=[this._curChPos,this._line,this._col]}newSy(){for(this.saveValidSpot(),this._sy=M.No;this._sy===M.No;)if(this._ch===Ti.Eof)this._sy=M.Eof;else if(Ti.isWhiteSpace(this._ch))this._ch=this.nextChar(),this.saveValidSpot();else if(this._ch===47){if(this._ch=this.nextChar(),this._ch===47)for(;this._ch!==13&&this._ch!==10&&this._ch!==Ti.Eof;)this._ch=this.nextChar();else if(this._ch===42)for(;this._ch!==Ti.Eof;)if(this._ch===42){if(this._ch=this.nextChar(),this._ch===47){this._ch=this.nextChar();break}}else this._ch=this.nextChar();else this.error("comment",M.String,!1);this.saveValidSpot()}else if(this._ch===34||this._ch===39){let e=this._ch;this._ch=this.nextChar();let t="";for(this._sy=M.String;this._ch!==e&&this._ch!==Ti.Eof;)t+=String.fromCharCode(this._ch),this._ch=this.nextChar();this._ch===Ti.Eof&&this.errorMessage("String opened but never closed"),this._syData=t,this._ch=this.nextChar()}else if(this._ch===45)this._allowNegatives?(this._sy=M.Number,this._syData=this.readNumber()):(this._sy=M.String,this._syData=this.readName());else if(this._ch===46)this._sy=M.Dot,this._ch=this.nextChar();else if(this._ch===58)this._sy=M.DoubleDot,this._ch=this.nextChar();else if(this._ch===40)this._sy=M.LParensis,this._ch=this.nextChar();else if(this._ch===92)this._ch=this.nextChar(),this._sy=M.MetaCommand,this._syData=this.readName();else if(this._ch===41)this._sy=M.RParensis,this._ch=this.nextChar();else if(this._ch===123)this._sy=M.LBrace,this._ch=this.nextChar();else if(this._ch===125)this._sy=M.RBrace,this._ch=this.nextChar();else if(this._ch===124)this._sy=M.Pipe,this._ch=this.nextChar();else if(this._ch===42)this._sy=M.Multiply,this._ch=this.nextChar();else if(this._ch===60)this._sy=M.LowerThan,this._ch=this.nextChar();else if(this.isDigit(this._ch))this._sy=M.Number,this._syData=this.readNumber();else if(Ti.isNameLetter(this._ch)){let e=this.readName(),t=this._allowTuning?et.parseTuning(e):null;t?(this._sy=M.Tuning,this._syData=t):(this._sy=M.String,this._syData=e)}else this.error("symbol",M.String,!1);return this._sy}static isNameLetter(e){return!Ti.isTerminal(e)&&(33<=e&&e<=47||58<=e&&e<=126||128<=e)}static isTerminal(e){return e===46||e===123||e===125||e===91||e===93||e===40||e===41||e===124||e===39||e===34||e===92}static isWhiteSpace(e){return e===9||e===10||e===11||e===13||e===32}isDigit(e){return e>=48&&e<=57||this._allowNegatives&&e===45||this._allowFloat&&e===46}readName(){let e="";do e+=String.fromCharCode(this._ch),this._ch=this.nextChar();while(Ti.isNameLetter(this._ch)||this.isDigit(this._ch));return e}readNumber(){let e="";do e+=String.fromCharCode(this._ch),this._ch=this.nextChar();while(this.isDigit(this._ch));return this._allowFloat?parseFloat(e):parseInt(e)}metaData(){let e=!1,t=!0;for(;this._sy===M.MetaCommand&&t;){let s=this._syData.toLowerCase();switch(s){case"title":case"subtitle":case"artist":case"album":case"words":case"music":case"copyright":this._sy=this.newSy(),this._sy!==M.String&&this.error(s,M.String,!0);let r=this._syData;switch(s){case"title":this._score.title=r;break;case"subtitle":this._score.subTitle=r;break;case"artist":this._score.artist=r;break;case"album":this._score.album=r;break;case"words":this._score.words=r;break;case"music":this._score.music=r;break;case"copyright":this._score.copyright=r;break}this._sy=this.newSy(),e=!0;break;case"tempo":this._allowFloat=!0,this._sy=this.newSy(),this._allowFloat=!1,this._sy===M.Number?this._score.tempo=this._syData:this.error("tempo",M.Number,!0),this._sy=this.newSy(),e=!0;break;default:this.handleStaffMeta()?e=!0:e?this.error("metaDataTags",M.String,!1):t=!1;break}}return e?(this._sy!==M.Dot&&this.error("song",M.Dot,!0),this._sy=this.newSy()):this._sy===M.Dot&&(this._sy=this.newSy()),e}handleStaffMeta(){var e;switch(this._syData.toLowerCase()){case"capo":return this._sy=this.newSy(),this._sy===M.Number?this._currentStaff.capo=this._syData:this.error("capo",M.Number,!0),this._sy=this.newSy(),!0;case"tuning":this._sy=this.newSy();let t=this._currentStaff.tuning.length;switch(this._staffHasExplicitTuning=!0,this._staffTuningApplied=!1,this._sy){case M.String:let o=this._syData.toLowerCase();o==="piano"||o==="none"||o==="voice"?(this._currentStaff.stringTuning.tunings=[],this._currentStaff.displayTranspositionPitch=0):this.error("tuning",M.Tuning,!0),this._sy=this.newSy();break;case M.Tuning:let l=[];do{let u=this._syData;l.push(u.realValue),this._sy=this.newSy()}while(this._sy===M.Tuning);this._currentStaff.stringTuning.tunings=l;break;default:this.error("tuning",M.Tuning,!0);break}return t!==this._currentStaff.tuning.length&&(((e=this._currentStaff.chords)==null?void 0:e.size)??0)>0&&this.errorMessage("Tuning must be defined before any chord"),!0;case"instrument":if(this._sy=this.newSy(),this._staffTuningApplied=!1,this._sy===M.Number){let o=this._syData;o>=0&&o<=127?this._currentTrack.playbackInfo.program=this._syData:this.error("instrument",M.Number,!1)}else if(this._sy===M.String){let o=this._syData.toLowerCase();if(o==="percussion"){for(const l of this._currentTrack.staves)this.applyPercussionStaff(l);this._currentTrack.playbackInfo.primaryChannel=9,this._currentTrack.playbackInfo.secondaryChannel=9}else this._currentTrack.playbackInfo.program=Kr.getValue(o)}else this.error("instrument",M.Number,!0);return this._sy=this.newSy(),!0;case"lyrics":this._sy=this.newSy();let s=new Ht;return s.startBar=0,s.text="",this._sy===M.Number&&(s.startBar=this._syData,this._sy=this.newSy()),this._sy===M.String?(s.text=this._syData,this._sy=this.newSy()):this.error("lyrics",M.String,!0),this._lyrics.get(this._currentTrack.index).push(s),!0;case"chord":this._sy=this.newSy();let r=new Qn;this.chordProperties(r),this._sy===M.String?(r.name=this._syData,this._sy=this.newSy()):this.error("chord-name",M.String,!0);for(let o=0;o<this._currentStaff.tuning.length;o++)this._sy===M.Number?r.strings.push(this._syData):this._sy===M.String&&this._syData.toLowerCase()==="x"&&r.strings.push(-1),this._sy=this.newSy();return this._currentStaff.addChord(this.getChordId(this._currentStaff,r.name),r),!0;case"articulation":this._sy=this.newSy();let n="";if(this._sy===M.String?(n=this._syData,this._sy=this.newSy()):this.error("articulation-name",M.String,!0),n==="defaults"){for(const[o,l]of Lt.instrumentArticulationNames)this._percussionArticulationNames.set(o.toLowerCase(),l),this._percussionArticulationNames.set(Ti.toArticulationId(o),l);return!0}let a=0;return this._sy===M.Number?(a=this._syData,this._sy=this.newSy()):this.error("articulation-number",M.Number,!0),Lt.instrumentArticulations.has(a)||this.errorMessage(`Unknown articulation ${a}. Refer to https://www.alphatab.net/docs/alphatex/percussion for available ids`),this._percussionArticulationNames.set(n.toLowerCase(),a),!0;default:return!1}}static toArticulationId(e){return e.replace(new RegExp("[^a-zA-Z0-9]","g"),"").toLowerCase()}applyPercussionStaff(e){e.isPercussion=!0,e.showTablature=!1}chordProperties(e){if(this._sy===M.LBrace){for(this._sy=this.newSy();this._sy===M.String;)switch(this._syData.toLowerCase()){case"firstfret":switch(this._sy=this.newSy(),this._sy){case M.Number:e.firstFret=this._syData;break;default:this.error("chord-firstfret",M.Number,!0);break}this._sy=this.newSy();break;case"showdiagram":switch(this._sy=this.newSy(),this._sy){case M.String:e.showDiagram=this._syData.toLowerCase()!=="false";break;case M.Number:e.showDiagram=this._syData!==0;break;default:this.error("chord-showdiagram",M.String,!0);break}this._sy=this.newSy();break;case"showfingering":switch(this._sy=this.newSy(),this._sy){case M.String:e.showDiagram=this._syData.toLowerCase()!=="false";break;case M.Number:e.showFingering=this._syData!==0;break;default:this.error("chord-showfingering",M.String,!0);break}this._sy=this.newSy();break;case"showname":switch(this._sy=this.newSy(),this._sy){case M.String:e.showName=this._syData.toLowerCase()!=="false";break;case M.Number:e.showName=this._syData!==0;break;default:this.error("chord-showname",M.String,!0);break}this._sy=this.newSy();break;case"barre":for(this._sy=this.newSy();this._sy===M.Number;)e.barreFrets.push(this._syData),this._sy=this.newSy();break;default:this.error("chord-properties",M.String,!1);break}this._sy!==M.RBrace&&this.error("chord-properties",M.RBrace,!0),this._sy=this.newSy()}}bars(){let e=this.bar();for(;this._sy!==M.Eof;)if(this._sy===M.Pipe)this._sy=this.newSy(),this.bar();else if(this._sy===M.MetaCommand)this.bar();else break;return e}trackStaffMeta(){if(this._sy!==M.MetaCommand)return!1;if(this._syData.toLowerCase()==="track"&&(this._staffHasExplicitTuning=!1,this._staffTuningApplied=!1,this._sy=this.newSy(),this._score.masterBars.length>0&&this.newTrack(),this._sy===M.String&&(this._currentTrack.name=this._syData,this._sy=this.newSy()),this._sy===M.String&&(this._currentTrack.shortName=this._syData,this._sy=this.newSy())),this._sy===M.MetaCommand&&this._syData.toLowerCase()==="staff"){if(this._staffHasExplicitTuning=!1,this._staffTuningApplied=!1,this._sy=this.newSy(),this._currentTrack.staves[0].bars.length>0){this._currentTrack.ensureStaveCount(this._currentTrack.staves.length+1);const e=this._currentStaff.isPercussion;this._currentStaff=this._currentTrack.staves[this._currentTrack.staves.length-1],e&&this.applyPercussionStaff(this._currentStaff),this._currentDynamics=Me.F}this.staffProperties()}return!0}staffProperties(){if(this._sy!==M.LBrace)return;this._sy=this.newSy();let e=!1,t=!1,s=!1,r=!1;for(;this._sy===M.String;)switch(this._syData.toLowerCase()){case"score":e=!0,this._sy=this.newSy();break;case"tabs":t=!0,this._sy=this.newSy();break;case"slash":s=!0,this._sy=this.newSy();break;case"numbered":r=!0,this._sy=this.newSy();break;default:this.error("staff-properties",M.String,!1);break}(e||t||s||r)&&(this._currentStaff.showStandardNotation=e,this._currentStaff.showTablature=t,this._currentStaff.showSlash=s,this._currentStaff.showNumbered=r),this._sy!==M.RBrace&&this.error("staff-properties",M.RBrace,!0),this._sy=this.newSy()}bar(){const e=this.trackStaffMeta();let t=this.newBar(this._currentStaff);if(this._currentStaff.bars.length>this._score.masterBars.length){let a=new gn;this._score.addMasterBar(a),a.index>0&&(a.keySignature=a.previousMasterBar.keySignature,a.keySignatureType=a.previousMasterBar.keySignatureType,a.timeSignatureDenominator=a.previousMasterBar.timeSignatureDenominator,a.timeSignatureNumerator=a.previousMasterBar.timeSignatureNumerator,a.tripletFeel=a.previousMasterBar.tripletFeel)}const s=this.barMeta(t);if(!this._staffTuningApplied&&!this._staffHasExplicitTuning){const a=this._currentTrack.playbackInfo.program;this._currentStaff.displayTranspositionPitch=0,this._currentStaff.stringTuning.tunings=[],a==15||a>=24&&a<=31?(this._currentStaff.displayTranspositionPitch=-12,this._currentStaff.stringTuning.tunings=H.getDefaultTuningFor(6).tunings):a>=32&&a<=39?(this._currentStaff.displayTranspositionPitch=-12,this._currentStaff.stringTuning.tunings=[43,38,33,28]):a==40||a==44||a==45||a==48||a==49||a==50||a==51?this._currentStaff.stringTuning.tunings=[52,57,50,43]:a==41?this._currentStaff.stringTuning.tunings=[57,50,43,36]:a==42?this._currentStaff.stringTuning.tunings=[45,38,31,24]:a==43?(this._currentStaff.displayTranspositionPitch=-12,this._currentStaff.stringTuning.tunings=[43,38,33,28]):a==105?this._currentStaff.stringTuning.tunings=[50,47,43,38,55]:a==106?this._currentStaff.stringTuning.tunings=[57,52,45]:a==107?this._currentStaff.stringTuning.tunings=[52,45,38,31]:a==110&&(this._currentStaff.stringTuning.tunings=[64,57,50,43]),this._staffTuningApplied=!0}let r=!1,n=t.voices[0];for(;this._sy!==M.Pipe&&this._sy!==M.Eof&&this.beat(n);)r=!0;if(n.beats.length===0){let a=new xi;a.isEmpty=!0,n.addBeat(a)}return e||s||r}newBar(e){let t=new Sn;e.addBar(t),t.index>0&&(t.clef=t.previousBar.clef);let s=new Wr;return t.addVoice(s),t}beat(e){this.beatDuration();let t=new xi;if(e.addBeat(t),this._allowTuning=!this._currentStaff.isPercussion,this._sy===M.LParensis){for(this._sy=this.newSy(),this.note(t);this._sy!==M.RParensis&&this._sy!==M.Eof&&(this._allowTuning=!this._currentStaff.isPercussion,!!this.note(t)););this._sy!==M.RParensis&&this.error("note-list",M.RParensis,!0),this._sy=this.newSy()}else if(this._sy===M.String&&this._syData.toLowerCase()==="r")this._sy=this.newSy();else if(!this.note(t))return e.beats.splice(e.beats.length-1,1),!1;this._sy===M.Dot&&(this._allowNegatives=!0,this._sy=this.newSy(),this._allowNegatives=!1,this._sy!==M.Number&&this.error("duration",M.Number,!0),this._currentDuration=this.parseDuration(this._syData),this._sy=this.newSy()),t.duration=this._currentDuration,t.dynamics=this._currentDynamics,this._currentTuplet!==1&&!t.hasTuplet&&Ti.applyTuplet(t,this._currentTuplet);let s=1;this._sy===M.Multiply&&(this._sy=this.newSy(),this._sy!==M.Number?this.error("multiplier",M.Number,!0):s=this._syData,this._sy=this.newSy()),this.beatEffects(t);for(let r=0;r<s-1;r++)e.addBeat(D0.clone(t));return!0}beatDuration(){if(this._sy===M.DoubleDot&&(this._allowNegatives=!0,this._sy=this.newSy(),this._allowNegatives=!1,this._sy!==M.Number&&this.error("duration",M.Number,!0),this._currentDuration=this.parseDuration(this._syData),this._currentTuplet=1,this._sy=this.newSy(),this._sy===M.LBrace)){for(this._sy=this.newSy();this._sy===M.String;)switch(this._syData.toLowerCase()){case"tu":this._sy=this.newSy(),this._sy!==M.Number&&this.error("duration-tuplet",M.Number,!0),this._currentTuplet=this._syData,this._sy=this.newSy();break;default:this.error("beat-duration",M.String,!1);break}this._sy!==M.RBrace&&this.error("beat-duration",M.RBrace,!0),this._sy=this.newSy()}}beatEffects(e){if(this._sy===M.LBrace){for(this._sy=this.newSy();this._sy===M.String;)this.applyBeatEffect(e)||this.error("beat-effects",M.String,!1);this._sy!==M.RBrace&&this.error("beat-effects",M.RBrace,!0),this._sy=this.newSy()}}applyBeatEffect(e){let t=this._syData.toLowerCase();if(t==="f")e.fadeIn=!0;else if(t==="v")e.vibrato=Ge.Slight;else if(t==="s")e.slap=!0;else if(t==="p")e.pop=!0;else if(t==="tt")e.tap=!0;else if(t==="dd")e.dots=2;else if(t==="d")e.dots=1;else if(t==="su")e.pickStroke=fi.Up;else if(t==="sd")e.pickStroke=fi.Down;else if(t==="tu"){if(this._sy=this.newSy(),this._sy!==M.Number)return this.error("tuplet",M.Number,!0),!1;Ti.applyTuplet(e,this._syData)}else if(t==="tb"||t==="tbe"){let s=t==="tbe";for(this._sy=this.newSy(),this._sy!==M.LParensis&&this.error("tremolobar-effect",M.LParensis,!0),this._allowNegatives=!0,this._sy=this.newSy();this._sy!==M.RParensis&&this._sy!==M.Eof;){let r=0,n=0;s?(this._sy!==M.Number&&this.error("tremolobar-effect",M.Number,!0),r=this._syData,this._sy=this.newSy(),this._sy!==M.Number&&this.error("tremolobar-effect",M.Number,!0),n=this._syData):(this._sy!==M.Number&&this.error("tremolobar-effect",M.Number,!0),r=0,n=this._syData),e.addWhammyBarPoint(new G(r,n)),this._sy=this.newSy()}if(e.whammyBarPoints!=null){for(;e.whammyBarPoints.length>60;)e.removeWhammyBarPoint(e.whammyBarPoints.length-1);if(s)e.whammyBarPoints.sort((r,n)=>r.offset-n.offset);else{let r=e.whammyBarPoints.length,n=60/r|0,a=0;for(;a<r;)e.whammyBarPoints[a].offset=Math.min(60,a*n),a++}}this._allowNegatives=!1,this._sy!==M.RParensis&&this.error("tremolobar-effect",M.RParensis,!0)}else if(t==="bu"||t==="bd"||t==="au"||t==="ad"){switch(t){case"bu":e.brushType=ut.BrushUp;break;case"bd":e.brushType=ut.BrushDown;break;case"au":e.brushType=ut.ArpeggioUp;break;case"ad":e.brushType=ut.ArpeggioDown;break}return this._sy=this.newSy(),this._sy===M.Number?(e.brushDuration=this._syData,this._sy=this.newSy(),!0):(e.updateDurations(),t==="bu"||t==="bd"?e.brushDuration=e.playbackDuration/4/e.notes.length:(t==="au"||t==="ad")&&(e.brushDuration=e.playbackDuration/e.notes.length),!0)}else if(t==="ch"){this._sy=this.newSy();let s=this._syData,r=this.getChordId(this._currentStaff,s);if(!this._currentStaff.hasChord(r)){let n=new Qn;n.showDiagram=!1,n.name=s,this._currentStaff.addChord(r,n)}e.chordId=r}else{if(t==="gr")return this._sy=this.newSy(),this._syData.toLowerCase()==="ob"?(e.graceType=he.OnBeat,this._sy=this.newSy()):this._syData.toLowerCase()==="b"?(e.graceType=he.BendGrace,this._sy=this.newSy()):e.graceType=he.BeforeBeat,!0;if(t==="dy"){switch(this._sy=this.newSy(),this._syData.toLowerCase()){case"ppp":e.dynamics=Me.PPP;break;case"pp":e.dynamics=Me.PP;break;case"p":e.dynamics=Me.P;break;case"mp":e.dynamics=Me.MP;break;case"mf":e.dynamics=Me.MF;break;case"f":e.dynamics=Me.F;break;case"ff":e.dynamics=Me.FF;break;case"fff":e.dynamics=Me.FFF;break}this._currentDynamics=e.dynamics}else if(t==="cre")e.crescendo=ss.Crescendo;else if(t==="dec")e.crescendo=ss.Decrescendo;else if(t==="tempo"){const s=this.readTempoAutomation();return e.automations.push(s),e.voice.bar.masterBar.tempoAutomations.push(s),!0}else if(t==="tp"){if(this._sy=this.newSy(),e.tremoloSpeed=N.Eighth,this._sy===M.Number){switch(this._syData){case 8:e.tremoloSpeed=N.Eighth;break;case 16:e.tremoloSpeed=N.Sixteenth;break;case 32:e.tremoloSpeed=N.ThirtySecond;break;default:e.tremoloSpeed=N.Eighth;break}this._sy=this.newSy()}return!0}else return t==="slashed"?(e.slashed=!0,this._sy=this.newSy(),!0):!1}return this._sy=this.newSy(),!0}getChordId(e,t){return t.toLowerCase()+e.index+e.track.index}static applyTuplet(e,t){switch(t){case 3:e.tupletNumerator=3,e.tupletDenominator=2;break;case 5:e.tupletNumerator=5,e.tupletDenominator=4;break;case 6:e.tupletNumerator=6,e.tupletDenominator=4;break;case 7:e.tupletNumerator=7,e.tupletDenominator=4;break;case 9:e.tupletNumerator=9,e.tupletDenominator=8;break;case 10:e.tupletNumerator=10,e.tupletDenominator=8;break;case 11:e.tupletNumerator=11,e.tupletDenominator=8;break;case 12:e.tupletNumerator=12,e.tupletDenominator=8;break;default:e.tupletNumerator=1,e.tupletDenominator=1;break}}isNoteText(e){return e==="x"||e==="-"||e==="r"}note(e){let t=!1,s=!1,r=-1,n=-1,a=-1;switch(this._sy){case M.Number:r=this._syData,this._currentStaff.isPercussion&&!Lt.instrumentArticulations.has(r)&&this.errorMessage(`Unknown percussion articulation ${r}`);break;case M.String:if(this._currentStaff.isPercussion){const c=this._syData.toLowerCase();this._percussionArticulationNames.has(c)?r=this._percussionArticulationNames.get(c):this.errorMessage(`Unknown percussion articulation '${this._syData}'`)}else t=this._syData==="x",s=this._syData==="-",s||t?r=0:this.error("note-fret",M.Number,!0);break;case M.Tuning:let h=this._syData;n=h.octave,a=h.noteValue;break;default:return!1}this._sy=this.newSy();let o=n===-1&&this._currentStaff.tuning.length>0&&!this._currentStaff.isPercussion,l=-1;o&&(this._sy!==M.Dot&&this.error("note",M.Dot,!0),this._sy=this.newSy(),this._sy!==M.Number&&this.error("note-string",M.Number,!0),l=this._syData,(l<1||l>this._currentStaff.tuning.length)&&this.error("note-string",M.Number,!1),this._sy=this.newSy());let u=new Ss;return o?(u.string=this._currentStaff.tuning.length-(l-1),u.isDead=t,u.isTieDestination=s,s||(u.fret=r)):this._currentStaff.isPercussion?u.percussionArticulation=r:(u.octave=n,u.tone=a,u.isTieDestination=s),e.addNote(u),this.noteEffects(u),!0}noteEffects(e){if(this._sy===M.LBrace){for(this._sy=this.newSy();this._sy===M.String;){let t=this._syData.toLowerCase();if(t==="b"||t==="be"){let s=t==="be";for(this._sy=this.newSy(),this._sy!==M.LParensis&&this.error("bend-effect",M.LParensis,!0),this._sy=this.newSy();this._sy!==M.RParensis&&this._sy!==M.Eof;){let n=0,a=0;s?(this._sy!==M.Number&&this.error("bend-effect-value",M.Number,!0),n=this._syData,this._sy=this.newSy(),this._sy!==M.Number&&this.error("bend-effect-value",M.Number,!0),a=this._syData):(this._sy!==M.Number&&this.error("bend-effect-value",M.Number,!0),a=this._syData),e.addBendPoint(new G(n,a)),this._sy=this.newSy()}const r=e.bendPoints;if(r!=null){for(;r.length>60;)r.splice(r.length-1,1);if(s)r.sort((n,a)=>n.offset-a.offset);else{let n=r.length,a=60/(n-1)|0,o=0;for(;o<n;)r[o].offset=Math.min(60,o*a),o++}}this._sy!==M.RParensis&&this.error("bend-effect",M.RParensis,!0),this._sy=this.newSy()}else if(t==="nh")e.harmonicType=fe.Natural,this._sy=this.newSy();else if(t==="ah")e.harmonicType=fe.Artificial,this._sy=this.newSy();else if(t==="th")e.harmonicType=fe.Tap,this._sy=this.newSy();else if(t==="ph")e.harmonicType=fe.Pinch,this._sy=this.newSy();else if(t==="sh")e.harmonicType=fe.Semi,this._sy=this.newSy();else if(t==="tr"){this._sy=this.newSy(),this._sy!==M.Number&&this.error("trill-effect",M.Number,!0);let s=this._syData;this._sy=this.newSy();let r=N.Sixteenth;if(this._sy===M.Number){switch(this._syData){case 16:r=N.Sixteenth;break;case 32:r=N.ThirtySecond;break;case 64:r=N.SixtyFourth;break;default:r=N.Sixteenth;break}this._sy=this.newSy()}e.trillValue=s+e.stringTuning,e.trillSpeed=r}else if(t==="v")this._sy=this.newSy(),e.vibrato=Ge.Slight;else if(t==="sl")this._sy=this.newSy(),e.slideOutType=xe.Legato;else if(t==="ss")this._sy=this.newSy(),e.slideOutType=xe.Shift;else if(t==="sib")this._sy=this.newSy(),e.slideInType=ii.IntoFromBelow;else if(t==="sia")this._sy=this.newSy(),e.slideInType=ii.IntoFromAbove;else if(t==="sou")this._sy=this.newSy(),e.slideOutType=xe.OutUp;else if(t==="sod")this._sy=this.newSy(),e.slideOutType=xe.OutDown;else if(t==="psd")this._sy=this.newSy(),e.slideOutType=xe.PickSlideDown;else if(t==="psu")this._sy=this.newSy(),e.slideOutType=xe.PickSlideUp;else if(t==="h")this._sy=this.newSy(),e.isHammerPullOrigin=!0;else if(t==="lht")this._sy=this.newSy(),e.isLeftHandTapped=!0;else if(t==="g")this._sy=this.newSy(),e.isGhost=!0;else if(t==="ac")this._sy=this.newSy(),e.accentuated=_t.Normal;else if(t==="hac")this._sy=this.newSy(),e.accentuated=_t.Heavy;else if(t==="ten")this._sy=this.newSy(),e.accentuated=_t.Tenuto;else if(t==="pm")this._sy=this.newSy(),e.isPalmMute=!0;else if(t==="st")this._sy=this.newSy(),e.isStaccato=!0;else if(t==="lr")this._sy=this.newSy(),e.isLetRing=!0;else if(t==="x")this._sy=this.newSy(),e.fret=0,e.isDead=!0;else if(t==="-"||t==="t")this._sy=this.newSy(),e.isTieDestination=!0;else if(t==="lf"){this._sy=this.newSy();let s=Te.Thumb;this._sy===M.Number&&(s=this.toFinger(this._syData),this._sy=this.newSy()),e.leftHandFinger=s}else if(t==="rf"){this._sy=this.newSy();let s=Te.Thumb;this._sy===M.Number&&(s=this.toFinger(this._syData),this._sy=this.newSy()),e.rightHandFinger=s}else this.applyBeatEffect(e.beat)||this.error(t,M.String,!1)}this._sy!==M.RBrace&&this.error("note-effect",M.RBrace,!1),this._sy=this.newSy()}}toFinger(e){switch(e){case 1:return Te.Thumb;case 2:return Te.IndexFinger;case 3:return Te.MiddleFinger;case 4:return Te.AnnularFinger;case 5:return Te.LittleFinger}return Te.Thumb}parseDuration(e){switch(e){case-4:return N.QuadrupleWhole;case-2:return N.DoubleWhole;case 1:return N.Whole;case 2:return N.Half;case 4:return N.Quarter;case 8:return N.Eighth;case 16:return N.Sixteenth;case 32:return N.ThirtySecond;case 64:return N.SixtyFourth;case 128:return N.OneHundredTwentyEighth;case 256:return N.TwoHundredFiftySixth;default:return N.Quarter}}barMeta(e){let t=!1,s=e.masterBar;for(;this._sy===M.MetaCommand;){t=!0;let r=this._syData.toLowerCase();if(r==="ts")this._sy=this.newSy(),this._sy!==M.Number&&this.error("timesignature-numerator",M.Number,!0),s.timeSignatureNumerator=this._syData,this._sy=this.newSy(),this._sy!==M.Number&&this.error("timesignature-denominator",M.Number,!0),s.timeSignatureDenominator=this._syData,this._sy=this.newSy();else if(r=="ft")s.isFreeTime=!0;else if(r==="ro")s.isRepeatStart=!0,this._sy=this.newSy();else if(r==="rc")this._sy=this.newSy(),this._sy!==M.Number&&this.error("repeatclose",M.Number,!0),this._syData>2048&&this.error("repeatclose",M.Number,!1),s.repeatCount=this._syData,this._sy=this.newSy();else if(r==="ae")if(this._sy=this.newSy(),this._sy===M.LParensis){for(this._sy=this.newSy(),this._sy!==M.Number&&this.error("alternateending",M.Number,!0),this.applyAlternateEnding(s);this._sy===M.Number;)this.applyAlternateEnding(s);this._sy!==M.RParensis&&this.error("alternateending-list",M.RParensis,!0),this._sy=this.newSy()}else this._sy!==M.Number&&this.error("alternateending",M.Number,!0),this.applyAlternateEnding(s);else if(r==="ks")this._sy=this.newSy(),this._sy!==M.String&&this.error("keysignature",M.String,!0),s.keySignature=this.parseKeySignature(this._syData),this._sy=this.newSy();else if(r==="clef"){switch(this._sy=this.newSy(),this._sy){case M.String:e.clef=this.parseClefFromString(this._syData);break;case M.Number:e.clef=this.parseClefFromInt(this._syData);break;case M.Tuning:let n=this._syData;e.clef=this.parseClefFromInt(n.realValue);break;default:this.error("clef",M.String,!0);break}this._sy=this.newSy()}else if(r==="tempo"){const n=this.readTempoAutomation();s.tempoAutomations.push(n)}else if(r==="section"){this._sy=this.newSy(),this._sy!==M.String&&this.error("section",M.String,!0);let n=this._syData;this._sy=this.newSy();let a="";this._sy===M.String&&!this.isNoteText(this._syData.toLowerCase())&&(a=n,n=this._syData,this._sy=this.newSy());let o=new Od;o.marker=a,o.text=n,s.section=o}else if(r==="tf"){switch(this._allowTuning=!1,this._sy=this.newSy(),this._allowTuning=!0,this._sy){case M.String:s.tripletFeel=this.parseTripletFeelFromString(this._syData);break;case M.Number:s.tripletFeel=this.parseTripletFeelFromInt(this._syData);break;default:this.error("triplet-feel",M.String,!0);break}this._sy=this.newSy()}else r==="ac"?(s.isAnacrusis=!0,this._sy=this.newSy()):e.index===0?this.handleStaffMeta()||this.error("measure-effects",M.String,!1):this.error("measure-effects",M.String,!1)}if(s.index===0&&s.tempoAutomations.length===0){let r=new vi;r.isLinear=!1,r.type=jt.Tempo,r.value=this._score.tempo,s.tempoAutomations.push(r)}return t}readTempoAutomation(){this._allowFloat=!0,this._sy=this.newSy(),this._allowFloat=!1,this._sy!==M.Number&&this.error("tempo",M.Number,!0);const e=new vi;return e.isLinear=!1,e.type=jt.Tempo,e.value=this._syData,this._sy=this.newSy(),e}applyAlternateEnding(e){let t=this._syData;t<1&&this.error("alternateending",M.Number,!0),e.alternateEndings|=1<<t-1,this._sy=this.newSy()}}Ti.Eof=0;class Mr extends Qo{get name(){return"Guitar Pro 3-5"}constructor(){super(),this._versionNumber=0,this._globalTripletFeel=Pe.NoTripletFeel,this._lyricsTrack=0,this._lyrics=[],this._barCount=0,this._trackCount=0,this._playbackInfos=[],this._beatTextChunksByTrack=new Map}readScore(){if(this.readVersion(),this._score=new Fa,this.readScoreInformation(),this._versionNumber<500&&(this._globalTripletFeel=We.gpReadBool(this.data)?Pe.Triplet8th:Pe.NoTripletFeel),this._versionNumber>=400&&this.readLyrics(),this._versionNumber>=510&&this.data.skip(19),this._versionNumber>=500&&(this.readPageSetup(),this._score.tempoLabel=We.gpReadStringIntByte(this.data,this.settings.importer.encoding)),this._score.tempo=L.readInt32LE(this.data),this._versionNumber>=510&&We.gpReadBool(this.data),L.readInt32LE(this.data),this._versionNumber>=400&&this.data.readByte(),this.readPlaybackInfos(),this._versionNumber>=500&&(this.data.skip(38),this.data.skip(4)),this._barCount=L.readInt32LE(this.data),this._trackCount=L.readInt32LE(this.data),this.readMasterBars(),this.readTracks(),this.readBars(),this._score.masterBars.length>0){const e=vi.buildTempoAutomation(!1,0,this._score.tempo,2);e.text=this._score.tempoLabel,this._score.masterBars[0].tempoAutomations.push(e)}return this._score.finish(this.settings),this._lyrics&&this._lyricsTrack>=0&&this._score.tracks[this._lyricsTrack].applyLyrics(this._lyrics),this._score}readVersion(){let e=We.gpReadStringByteLength(this.data,30,this.settings.importer.encoding);if(!e.startsWith(Mr.VersionString))throw new yt("Unsupported format");e=e.substr(Mr.VersionString.length+1);let t=e.indexOf(".");this._versionNumber=100*parseInt(e.substr(0,t))+parseInt(e.substr(t+1)),I.debug(this.name,"Guitar Pro version "+e+" detected")}readScoreInformation(){var s;this._score.title=We.gpReadStringIntUnused(this.data,this.settings.importer.encoding),this._score.subTitle=We.gpReadStringIntUnused(this.data,this.settings.importer.encoding),this._score.artist=We.gpReadStringIntUnused(this.data,this.settings.importer.encoding),this._score.album=We.gpReadStringIntUnused(this.data,this.settings.importer.encoding),this._score.words=We.gpReadStringIntUnused(this.data,this.settings.importer.encoding),this._score.music=this._versionNumber>=500?We.gpReadStringIntUnused(this.data,this.settings.importer.encoding):this._score.words,this._score.copyright=We.gpReadStringIntUnused(this.data,this.settings.importer.encoding),this._score.tab=We.gpReadStringIntUnused(this.data,this.settings.importer.encoding),this._score.instructions=We.gpReadStringIntUnused(this.data,this.settings.importer.encoding);let e=L.readInt32LE(this.data),t="";for(let r=0;r<e;r++)r>0&&(t+=`\r
`),t+=(s=We.gpReadStringIntUnused(this.data,this.settings.importer.encoding))==null?void 0:s.toString();this._score.notices=t}readLyrics(){this._lyrics=[],this._lyricsTrack=L.readInt32LE(this.data)-1;for(let e=0;e<5;e++){let t=new Ht;t.startBar=L.readInt32LE(this.data)-1,t.text=We.gpReadStringInt(this.data,this.settings.importer.encoding),this._lyrics.push(t)}}readPageSetup(){this.data.skip(30);for(let e=0;e<10;e++)We.gpReadStringIntByte(this.data,this.settings.importer.encoding)}readPlaybackInfos(){this._playbackInfos=[];for(let e=0;e<64;e++){let t=new S_;t.primaryChannel=e,t.secondaryChannel=e,t.program=L.readInt32LE(this.data),t.volume=this.data.readByte(),t.balance=this.data.readByte(),this.data.skip(6),this._playbackInfos.push(t)}}readMasterBars(){for(let e=0;e<this._barCount;e++)this.readMasterBar()}readMasterBar(){let e=null;this._score.masterBars.length>0&&(e=this._score.masterBars[this._score.masterBars.length-1]);let t=new gn,s=this.data.readByte();if(s&1?t.timeSignatureNumerator=this.data.readByte():e&&(t.timeSignatureNumerator=e.timeSignatureNumerator),s&2?t.timeSignatureDenominator=this.data.readByte():e&&(t.timeSignatureDenominator=e.timeSignatureDenominator),t.isRepeatStart=(s&4)!==0,s&8&&(t.repeatCount=this.data.readByte()+(this._versionNumber>=500?0:1)),s&16&&this._versionNumber<500){let r=e,n=0;for(;r&&!(r.isRepeatEnd&&r!==e||r.isRepeatStart);)n=n|r.alternateEndings,r=r.previousMasterBar;let a=0,o=this.data.readByte();for(let l=0;l<8;l++){let u=1<<l;o>l&&!(n&u)&&(a=a|u)}t.alternateEndings=a}if(s&32){let r=new Od;r.text=We.gpReadStringIntByte(this.data,this.settings.importer.encoding),r.marker="",We.gpReadColor(this.data,!1),t.section=r}if(s&64?(t.keySignature=L.readSInt8(this.data),t.keySignatureType=this.data.readByte()):e&&(t.keySignature=e.keySignature,t.keySignatureType=e.keySignatureType),this._versionNumber>=500&&s&3&&this.data.skip(4),this._versionNumber>=500&&(t.alternateEndings=this.data.readByte()),this._versionNumber>=500){switch(this.data.readByte()){case 1:t.tripletFeel=Pe.Triplet8th;break;case 2:t.tripletFeel=Pe.Triplet16th;break}this.data.readByte()}else t.tripletFeel=this._globalTripletFeel;t.isDoubleBar=(s&128)!==0,this._score.addMasterBar(t)}readTracks(){for(let e=0;e<this._trackCount;e++)this.readTrack()}readTrack(){let e=new Va;e.ensureStaveCount(1),this._score.addTrack(e);let t=e.staves[0],s=this.data.readByte();e.name=We.gpReadStringByteLength(this.data,40,this.settings.importer.encoding),s&1&&(t.isPercussion=!0),this._versionNumber>=500&&(e.isVisibleOnMultiTrack=(s&8)!==0);let r=L.readInt32LE(this.data),n=[];for(let u=0;u<7;u++){let h=L.readInt32LE(this.data);r>u&&n.push(h)}t.stringTuning.tunings=n;let a=L.readInt32LE(this.data),o=L.readInt32LE(this.data)-1,l=L.readInt32LE(this.data)-1;if(this.data.skip(4),o>=0&&o<this._playbackInfos.length){let u=this._playbackInfos[o];u.port=a,u.isSolo=(s&16)!==0,u.isMute=(s&32)!==0,u.secondaryChannel=l,Kr.isGuitar(u.program)&&(t.displayTranspositionPitch=-12),e.playbackInfo=u}t.capo=L.readInt32LE(this.data),e.color=We.gpReadColor(this.data,!1),this._versionNumber>=500&&(this.data.readByte(),this.data.readByte(),this.data.skip(43)),this._versionNumber>=510&&(this.data.skip(4),We.gpReadStringIntByte(this.data,this.settings.importer.encoding),We.gpReadStringIntByte(this.data,this.settings.importer.encoding))}readBars(){for(let e=0;e<this._barCount;e++)for(let t=0;t<this._trackCount;t++)this.readBar(this._score.tracks[t])}readBar(e){let t=new Sn,s=e.staves[0];s.isPercussion&&(t.clef=ve.Neutral),s.addBar(t);let r=1;this._versionNumber>=500&&(this.data.readByte(),r=2);for(let n=0;n<r;n++)this.readVoice(e,t)}readVoice(e,t){let s=L.readInt32LE(this.data);if(s===0)return;let r=new Wr;t.addVoice(r);for(let n=0;n<s;n++)this.readBeat(e,t,r)}readBeat(e,t,s){let r=new xi,n=this.data.readByte();if(n&1&&(r.dots=1),n&64){let h=this.data.readByte();r.isEmpty=(h&2)===0}switch(s.addBeat(r),L.readSInt8(this.data)){case-2:r.duration=N.Whole;break;case-1:r.duration=N.Half;break;case 0:r.duration=N.Quarter;break;case 1:r.duration=N.Eighth;break;case 2:r.duration=N.Sixteenth;break;case 3:r.duration=N.ThirtySecond;break;case 4:r.duration=N.SixtyFourth;break;default:r.duration=N.Quarter;break}if(n&32)switch(r.tupletNumerator=L.readInt32LE(this.data),r.tupletNumerator){case 1:r.tupletDenominator=1;break;case 3:r.tupletDenominator=2;break;case 5:case 6:case 7:r.tupletDenominator=4;break;case 9:case 10:case 11:case 12:case 13:r.tupletDenominator=8;break;case 2:case 4:case 8:break;default:r.tupletNumerator=1,r.tupletDenominator=1;break}n&2&&this.readChord(r);let o=this.settings.importer.beatTextAsLyrics&&e.index!==this._lyricsTrack;if(n&4){const h=We.gpReadStringIntUnused(this.data,this.settings.importer.encoding);if(o){const c=new Ht;c.text=h.trim(),c.finish(!0);const d=[];for(let f=c.chunks.length-1;f>=0;f--)d.push(c.chunks[f]);this._beatTextChunksByTrack.set(e.index,d)}else r.text=h}let l=fe.None;n&8&&(l=this.readBeatEffects(r)),n&16&&this.readMixTableChange(r);let u=this.data.readByte();for(let h=6;h>=0;h--)if(u&1<<h&&6-h<t.staff.tuning.length){const c=this.readNote(e,t,s,r,6-h);l!==fe.None&&(c.harmonicType=l,c.harmonicType===fe.Natural&&(c.harmonicValue=this.deltaFretToHarmonicValue(c.fret)))}this._versionNumber>=500&&(this.data.readByte(),this.data.readByte()&8&&this.data.readByte()),o&&!r.isRest&&this._beatTextChunksByTrack.has(e.index)&&this._beatTextChunksByTrack.get(e.index).length>0&&(r.lyrics=[this._beatTextChunksByTrack.get(e.index).pop()])}readChord(e){let t=new Qn,s=et.newGuid();if(this._versionNumber>=500){this.data.skip(17),t.name=We.gpReadStringByteLength(this.data,21,this.settings.importer.encoding),this.data.skip(4),t.firstFret=L.readInt32LE(this.data);for(let a=0;a<7;a++){let o=L.readInt32LE(this.data);a<e.voice.bar.staff.tuning.length&&t.strings.push(o)}let r=this.data.readByte(),n=new Uint8Array(5);this.data.read(n,0,n.length);for(let a=0;a<r;a++)t.barreFrets.push(n[a]);this.data.skip(26)}else if(this.data.readByte()!==0)if(this._versionNumber>=400){this.data.skip(16),t.name=We.gpReadStringByteLength(this.data,21,this.settings.importer.encoding),this.data.skip(4),t.firstFret=L.readInt32LE(this.data);for(let a=0;a<7;a++){let o=L.readInt32LE(this.data);a<e.voice.bar.staff.tuning.length&&t.strings.push(o)}let r=this.data.readByte(),n=new Uint8Array(5);this.data.read(n,0,n.length);for(let a=0;a<r;a++)t.barreFrets.push(n[a]);this.data.skip(26)}else{this.data.skip(25),t.name=We.gpReadStringByteLength(this.data,34,this.settings.importer.encoding),t.firstFret=L.readInt32LE(this.data);for(let r=0;r<6;r++){let n=L.readInt32LE(this.data);r<e.voice.bar.staff.tuning.length&&t.strings.push(n)}this.data.skip(36)}else{let r=this._versionNumber>=406?7:6;if(t.name=We.gpReadStringIntByte(this.data,this.settings.importer.encoding),t.firstFret=L.readInt32LE(this.data),t.firstFret>0)for(let n=0;n<r;n++){let a=L.readInt32LE(this.data);n<e.voice.bar.staff.tuning.length&&t.strings.push(a)}}t.name&&(e.chordId=s,e.voice.bar.staff.addChord(e.chordId,t))}readBeatEffects(e){let t=this.data.readByte(),s=0;if(this._versionNumber>=400&&(s=this.data.readByte()),e.fadeIn=(t&16)!==0,(this._versionNumber<400&&t&1||t&2)&&(e.vibrato=Ge.Slight),e.hasRasgueado=(s&1)!==0,t&32&&this._versionNumber>=400)switch(L.readSInt8(this.data)){case 1:e.tap=!0;break;case 2:e.slap=!0;break;case 3:e.pop=!0;break}else if(t&32){switch(L.readSInt8(this.data)){case 1:e.tap=!0;break;case 2:e.slap=!0;break;case 3:e.pop=!0;break}this.data.skip(4)}if(s&4&&this.readTremoloBarEffect(e),t&64){let r=0,n=0;this._versionNumber<500?(n=this.data.readByte(),r=this.data.readByte()):(r=this.data.readByte(),n=this.data.readByte()),r>0?(e.brushType=ut.BrushUp,e.brushDuration=Mr.toStrokeValue(r)):n>0&&(e.brushType=ut.BrushDown,e.brushDuration=Mr.toStrokeValue(n))}if(s&2)switch(L.readSInt8(this.data)){case 0:e.pickStroke=fi.None;break;case 1:e.pickStroke=fi.Up;break;case 2:e.pickStroke=fi.Down;break}if(this._versionNumber<400){if(t&4)return fe.Natural;if(t&8)return fe.Artificial}return fe.None}readTremoloBarEffect(e){this.data.readByte(),L.readInt32LE(this.data);let t=L.readInt32LE(this.data);if(t>0)for(let s=0;s<t;s++){let r=new G(0,0);r.offset=L.readInt32LE(this.data),r.value=L.readInt32LE(this.data)/Mr.BendStep|0,We.gpReadBool(this.data),e.addWhammyBarPoint(r)}}static toStrokeValue(e){switch(e){case 1:return 30;case 2:return 30;case 3:return 60;case 4:return 120;case 5:return 240;case 6:return 480;default:return 0}}readMixTableChange(e){let t=new YR;t.instrument=L.readSInt8(this.data),this._versionNumber>=500&&this.data.skip(16),t.volume=L.readSInt8(this.data),t.balance=L.readSInt8(this.data);let s=L.readSInt8(this.data),r=L.readSInt8(this.data),n=L.readSInt8(this.data),a=L.readSInt8(this.data);if(this._versionNumber>=500&&(t.tempoName=We.gpReadStringIntByte(this.data,this.settings.importer.encoding)),t.tempo=L.readInt32LE(this.data),t.volume>=0&&this.data.readByte(),t.balance>=0&&this.data.readByte(),s>=0&&this.data.readByte(),r>=0&&this.data.readByte(),n>=0&&this.data.readByte(),a>=0&&this.data.readByte(),t.tempo>=0&&(t.duration=L.readSInt8(this.data),this._versionNumber>=510&&this.data.readByte()),this._versionNumber>=400&&this.data.readByte(),this._versionNumber>=500&&this.data.readByte(),this._versionNumber>=510&&(We.gpReadStringIntByte(this.data,this.settings.importer.encoding),We.gpReadStringIntByte(this.data,this.settings.importer.encoding)),t.volume>=0){let o=new vi;o.isLinear=!0,o.type=jt.Volume,o.value=t.volume,e.automations.push(o)}if(t.balance>=0){let o=new vi;o.isLinear=!0,o.type=jt.Balance,o.value=t.balance,e.automations.push(o)}if(t.instrument>=0){let o=new vi;o.isLinear=!0,o.type=jt.Instrument,o.value=t.instrument,e.automations.push(o)}if(t.tempo>=0){let o=new vi;o.isLinear=!0,o.type=jt.Tempo,o.value=t.tempo,e.automations.push(o),e.voice.bar.masterBar.tempoAutomations.push(o)}}readNote(e,t,s,r,n){let a=new Ss;a.string=t.staff.tuning.length-n;let o=this.data.readByte();if(o&2?a.accentuated=_t.Heavy:o&64&&(a.accentuated=_t.Normal),a.isGhost=(o&4)!==0,o&32){let u=this.data.readByte();u===3?a.isDead=!0:u===2&&(a.isTieDestination=!0)}if(o&1&&this._versionNumber<500&&(this.data.readByte(),this.data.readByte()),o&16){let u=L.readSInt8(this.data);a.dynamics=this.toDynamicValue(u),r.dynamics=a.dynamics}o&32&&(a.fret=L.readSInt8(this.data)),o&128&&(a.leftHandFinger=L.readSInt8(this.data),a.rightHandFinger=L.readSInt8(this.data),a.isFingering=!0);let l=!1;if(this._versionNumber>=500&&(o&1&&(a.durationPercent=We.gpReadDouble(this.data)),l=(this.data.readByte()&2)!==0),r.addNote(a),o&8&&this.readNoteEffects(e,s,r,a),t.staff.isPercussion&&(a.percussionArticulation=a.fret,a.string=-1,a.fret=-1),l){const u=H.defaultAccidentals[a.realValueWithoutHarmonic%12];u==="#"?a.accidentalMode=At.ForceFlat:u==="b"&&(a.accidentalMode=At.ForceSharp)}return a}toDynamicValue(e){switch(e){case 1:return Me.PPP;case 2:return Me.PP;case 3:return Me.P;case 4:return Me.MP;case 5:return Me.MF;case 6:return Me.F;case 7:return Me.FF;case 8:return Me.FFF;default:return Me.F}}readNoteEffects(e,t,s,r){let n=this.data.readByte(),a=0;this._versionNumber>=400&&(a=this.data.readByte()),n&1&&this.readBend(r),n&16&&this.readGrace(t,r),a&4&&this.readTremoloPicking(s),a&8?this.readSlide(r):this._versionNumber<400&&n&4&&(r.slideOutType=xe.Shift),a&16&&this.readArtificialHarmonic(r),a&32&&this.readTrill(r),r.isLetRing=(n&8)!==0,r.isHammerPullOrigin=(n&2)!==0,a&64&&(r.vibrato=Ge.Slight),r.isPalmMute=(a&2)!==0,r.isStaccato=(a&1)!==0}readBend(e){this.data.readByte(),L.readInt32LE(this.data);let t=L.readInt32LE(this.data);if(t>0)for(let s=0;s<t;s++){let r=new G(0,0);r.offset=L.readInt32LE(this.data),r.value=L.readInt32LE(this.data)/Mr.BendStep|0,We.gpReadBool(this.data),e.addBendPoint(r)}}readGrace(e,t){let s=new xi,r=new Ss;switch(r.string=t.string,r.fret=L.readSInt8(this.data),s.duration=N.ThirtySecond,s.dynamics=this.toDynamicValue(L.readSInt8(this.data)),L.readSInt8(this.data)){case 0:break;case 1:r.slideOutType=xe.Legato,r.slideTarget=t;break;case 2:break;case 3:r.isHammerPullOrigin=!0;break}if(r.dynamics=s.dynamics,this.data.skip(1),this._versionNumber<500)s.graceType=he.BeforeBeat;else{let a=this.data.readByte();r.isDead=(a&1)!==0,s.graceType=a&2?he.OnBeat:he.BeforeBeat}e.addGraceBeat(s),s.addNote(r)}readTremoloPicking(e){switch(this.data.readByte()){case 1:e.tremoloSpeed=N.Eighth;break;case 2:e.tremoloSpeed=N.Sixteenth;break;case 3:e.tremoloSpeed=N.ThirtySecond;break}}readSlide(e){if(this._versionNumber>=500){let t=L.readSInt8(this.data);t&1?e.slideOutType=xe.Shift:t&2?e.slideOutType=xe.Legato:t&4?e.slideOutType=xe.OutDown:t&8&&(e.slideOutType=xe.OutUp),t&16?e.slideInType=ii.IntoFromBelow:t&32&&(e.slideInType=ii.IntoFromAbove)}else switch(L.readSInt8(this.data)){case 1:e.slideOutType=xe.Shift;break;case 2:e.slideOutType=xe.Legato;break;case 3:e.slideOutType=xe.OutDown;break;case 4:e.slideOutType=xe.OutUp;break;case-1:e.slideInType=ii.IntoFromBelow;break;case-2:e.slideInType=ii.IntoFromAbove;break}}readArtificialHarmonic(e){let t=this.data.readByte();if(this._versionNumber>=500)switch(t){case 1:e.harmonicType=fe.Natural,e.harmonicValue=this.deltaFretToHarmonicValue(e.fret);break;case 2:this.data.readByte(),this.data.readByte(),this.data.readByte(),e.harmonicType=fe.Artificial;break;case 3:e.harmonicType=fe.Tap,e.harmonicValue=this.deltaFretToHarmonicValue(this.data.readByte());break;case 4:e.harmonicType=fe.Pinch,e.harmonicValue=12;break;case 5:e.harmonicType=fe.Semi,e.harmonicValue=12;break}else if(this._versionNumber>=400)switch(t){case 1:e.harmonicType=fe.Natural;break;case 3:e.harmonicType=fe.Tap;break;case 4:e.harmonicType=fe.Pinch;break;case 5:e.harmonicType=fe.Semi;break;case 15:e.harmonicType=fe.Artificial;break;case 17:e.harmonicType=fe.Artificial;break;case 22:e.harmonicType=fe.Artificial;break}}deltaFretToHarmonicValue(e){switch(e){case 2:return 2.4;case 3:return 3.2;case 4:case 5:case 7:case 9:case 12:case 16:case 17:case 19:case 24:return e;case 8:return 8.2;case 10:return 9.6;case 14:case 15:return 14.7;case 21:case 22:return 21.7;default:return 12}}readTrill(e){switch(e.trillValue=this.data.readByte()+e.stringTuning,this.data.readByte()){case 1:e.trillSpeed=N.Sixteenth;break;case 2:e.trillSpeed=N.ThirtySecond;break;case 3:e.trillSpeed=N.SixtyFourth;break}}}Mr.VersionString="FICHIER GUITAR PRO ";Mr.BendStep=25;class We{static gpReadDouble(e){let t=new Uint8Array(8);return e.read(t,0,t.length),new Float64Array(t.buffer)[0]}static gpReadFloat(e){let t=new Uint8Array(4);return t[3]=e.readByte(),t[2]=e.readByte(),t[2]=e.readByte(),t[1]=e.readByte(),new Float32Array(t.buffer)[0]}static gpReadColor(e,t=!1){let s=e.readByte(),r=e.readByte(),n=e.readByte(),a=255;return t?a=e.readByte():e.skip(1),new Je(s,r,n,a)}static gpReadBool(e){return e.readByte()!==0}static gpReadStringIntUnused(e,t){return e.skip(4),We.gpReadString(e,e.readByte(),t)}static gpReadStringInt(e,t){return We.gpReadString(e,L.readInt32LE(e),t)}static gpReadStringIntByte(e,t){let s=L.readInt32LE(e)-1;return e.readByte(),We.gpReadString(e,s,t)}static gpReadString(e,t,s){let r=new Uint8Array(t);return e.read(r,0,r.length),L.toString(r,s)}static gpWriteString(e,t){const s=L.stringToBytes(t);e.writeByte(t.length),e.write(s,0,s.length)}static gpReadStringByteLength(e,t,s){let r=e.readByte(),n=We.gpReadString(e,r,s);return r<t&&e.skip(t-r),n}}class YR{constructor(){this.volume=-1,this.balance=-1,this.instrument=-1,this.tempoName="",this.tempo=-1,this.duration=-1}}class Wi{constructor(){this.x=0,this.y=0,this.w=0,this.h=0}}var ir;(function(i){i[i.Boolean=0]="Boolean",i[i.Integer=1]="Integer",i[i.Float=2]="Float",i[i.String=3]="String",i[i.Point=4]="Point",i[i.Size=5]="Size",i[i.Rectangle=6]="Rectangle",i[i.Color=7]="Color"})(ir||(ir={}));class Fd{constructor(e){this.raw=new Map;let t=si.fromBuffer(e),s=L.readInt32BE(t);for(let r=0;r<s;r++){let n=We.gpReadString(t,t.readByte(),"utf-8");switch(t.readByte()){case ir.Boolean:let o=t.readByte()===1;this.addValue(n,o);break;case ir.Integer:let l=L.readInt32BE(t);this.addValue(n,l);break;case ir.Float:let u=We.gpReadFloat(t);this.addValue(n,u);break;case ir.String:let h=We.gpReadString(t,L.readInt16BE(t),"utf-8");this.addValue(n,h);break;case ir.Point:let c=L.readInt32BE(t),d=L.readInt32BE(t);this.addValue(n,new G(c,d));break;case ir.Size:let f=L.readInt32BE(t),p=L.readInt32BE(t);this.addValue(n,new G(f,p));break;case ir.Rectangle:let g=new Wi;g.x=L.readInt32BE(t),g.y=L.readInt32BE(t),g.w=L.readInt32BE(t),g.h=L.readInt32BE(t),this.addValue(n,g);break;case ir.Color:let b=We.gpReadColor(t,!0);this.addValue(n,b);break}}}apply(e){for(const[t,s]of this.raw)switch(t){case"StandardNotation/hideDynamics":e.stylesheet.hideDynamics=s;break}}addValue(e,t){this.raw.set(e,t)}static writeForScore(e){const t=si.withCapacity(128);return L.writeInt32BE(t,1),Fd.writeBooleanEntry(t,"StandardNotation/hideDynamics",e.stylesheet.hideDynamics),t.toArray()}static writeBooleanEntry(e,t,s){We.gpWriteString(e,t),e.writeByte(ir.Boolean),e.writeByte(s?1:0)}}var yr;(function(i){i[i.Short=0]="Short",i[i.Medium=1]="Medium",i[i.Long=2]="Long"})(yr||(yr={}));class A0{constructor(){this.type=yr.Short,this.length=0}}var O;(function(i){i[i.None=0]="None",i[i.Element=1]="Element",i[i.Text=2]="Text",i[i.CDATA=3]="CDATA",i[i.Document=4]="Document",i[i.DocumentType=5]="DocumentType"})(O||(O={}));class or{constructor(){this.nodeType=O.None,this.localName=null,this.value=null,this.childNodes=[],this.attributes=new Map,this.firstChild=null,this.firstElement=null}addChild(e){this.childNodes.push(e),this.firstChild=e,(e.nodeType===O.Element||e.nodeType===O.CDATA)&&(this.firstElement=e)}getAttribute(e){return this.attributes.has(e)?this.attributes.get(e):""}getElementsByTagName(e,t=!1){let s=[];return this.searchElementsByTagName(this.childNodes,s,e,t),s}searchElementsByTagName(e,t,s,r=!1){for(let n of e)n&&n.nodeType===O.Element&&n.localName===s&&t.push(n),r&&this.searchElementsByTagName(n.childNodes,t,s,!0)}findChildElement(e){for(let t of this.childNodes)if(t&&t.nodeType===O.Element&&t.localName===e)return t;return null}addElement(e){const t=new or;return t.nodeType=O.Element,t.localName=e,this.addChild(t),t}get innerText(){var e;if(this.nodeType===O.Element||this.nodeType===O.Document){if(this.firstElement&&this.firstElement.nodeType===O.CDATA)return this.firstElement.innerText;let t="";for(let r of this.childNodes)t+=(e=r.innerText)==null?void 0:e.toString();return t.trim()}return this.value??""}set innerText(e){const t=new or;t.nodeType=O.Text,t.value=e,this.childNodes=[t]}setCData(e){const t=new or;t.nodeType=O.CDATA,t.value=e,this.childNodes=[t]}}class Zi extends ni{constructor(e,t,s){super(ri.Format,e),this.pos=0,this.xml=t,this.pos=s,Object.setPrototypeOf(this,Zi.prototype)}}var be;(function(i){i[i.IgnoreSpaces=0]="IgnoreSpaces",i[i.Begin=1]="Begin",i[i.BeginNode=2]="BeginNode",i[i.TagName=3]="TagName",i[i.Body=4]="Body",i[i.AttribName=5]="AttribName",i[i.Equals=6]="Equals",i[i.AttvalBegin=7]="AttvalBegin",i[i.AttribVal=8]="AttribVal",i[i.Childs=9]="Childs",i[i.Close=10]="Close",i[i.WaitEnd=11]="WaitEnd",i[i.WaitEndRet=12]="WaitEndRet",i[i.Pcdata=13]="Pcdata",i[i.Header=14]="Header",i[i.Comment=15]="Comment",i[i.Doctype=16]="Doctype",i[i.Cdata=17]="Cdata",i[i.Escape=18]="Escape"})(be||(be={}));class Z{static parse(e,t,s){let r=e.charCodeAt(t),n=be.Begin,a=be.Begin,o=0,l="",u=be.Begin,h=null,c=null,d=0,f=0;for(;t<e.length;){switch(r=e.charCodeAt(t),n){case be.IgnoreSpaces:switch(r){case Z.CharCodeLF:case Z.CharCodeCR:case Z.CharCodeTab:case Z.CharCodeSpace:break;default:n=a;continue}break;case be.Begin:switch(r){case Z.CharCodeLowerThan:n=be.IgnoreSpaces,a=be.BeginNode;break;default:o=t,n=be.Pcdata;continue}break;case be.Pcdata:if(r===Z.CharCodeLowerThan){l+=e.substr(o,t-o);let p=new or;p.nodeType=O.Text,p.value=l,l="",s.addChild(p),n=be.IgnoreSpaces,a=be.BeginNode}else r===Z.CharCodeAmp&&(l+=e.substr(o,t-o),n=be.Escape,u=be.Pcdata,o=t+1);break;case be.Cdata:if(r===Z.CharCodeBrackedClose&&e.charCodeAt(t+1)===Z.CharCodeBrackedClose&&e.charCodeAt(t+2)===Z.CharCodeGreaterThan){let p=new or;p.nodeType=O.CDATA,p.value=e.substr(o,t-o),s.addChild(p),t+=2,n=be.Begin}break;case be.BeginNode:switch(r){case Z.CharCodeExclamation:if(e.charCodeAt(t+1)===Z.CharCodeBrackedOpen){if(t+=2,e.substr(t,6).toUpperCase()!=="CDATA[")throw new Zi("Expected <![CDATA[",e,t);t+=5,n=be.Cdata,o=t+1}else if(e.charCodeAt(t+1)===Z.CharCodeUpperD||e.charCodeAt(t+1)===Z.CharCodeLowerD){if(e.substr(t+2,6).toUpperCase()!=="OCTYPE")throw new Zi("Expected <!DOCTYPE",e,t);t+=8,n=be.Doctype,o=t+1}else{if(e.charCodeAt(t+1)!==Z.CharCodeMinus||e.charCodeAt(t+2)!==Z.CharCodeMinus)throw new Zi("Expected <!--",e,t);t+=2,n=be.Comment,o=t+1}break;case Z.CharCodeQuestion:n=be.Header,o=t;break;case Z.CharCodeSlash:if(!s)throw new Zi("Expected node name",e,t);o=t+1,n=be.IgnoreSpaces,a=be.Close;break;default:n=be.TagName,o=t;continue}break;case be.TagName:if(!Z.isValidChar(r)){if(t===o)throw new Zi("Expected node name",e,t);h=new or,h.nodeType=O.Element,h.localName=e.substr(o,t-o),s.addChild(h),n=be.IgnoreSpaces,a=be.Body;continue}break;case be.Body:switch(r){case Z.CharCodeSlash:n=be.WaitEnd;break;case Z.CharCodeGreaterThan:n=be.Childs;break;default:n=be.AttribName,o=t;continue}break;case be.AttribName:if(!Z.isValidChar(r)){if(o===t)throw new Zi("Expected attribute name",e,t);if(c=e.substr(o,t-o),h.attributes.has(c))throw new Zi(`Duplicate attribute [${c}]`,e,t);n=be.IgnoreSpaces,a=be.Equals;continue}break;case be.Equals:switch(r){case Z.CharCodeEquals:n=be.IgnoreSpaces,a=be.AttvalBegin;break;default:throw new Zi("Expected =",e,t)}break;case be.AttvalBegin:switch(r){case Z.CharCodeDoubleQuote:case Z.CharCodeSingleQuote:l="",n=be.AttribVal,o=t+1,f=r;break}break;case be.AttribVal:switch(r){case Z.CharCodeAmp:l+=e.substr(o,t-o),n=be.Escape,u=be.AttribVal,o=t+1;break;default:if(r===f){l+=e.substr(o,t-o);let p=l;l="",h.attributes.set(c,p),n=be.IgnoreSpaces,a=be.Body}break}break;case be.Childs:t=Z.parse(e,t,h),o=t,n=be.Begin;break;case be.WaitEnd:switch(r){case Z.CharCodeGreaterThan:n=be.Begin;break;default:throw new Zi("Expected >",e,t)}break;case be.WaitEndRet:switch(r){case Z.CharCodeGreaterThan:return t;default:throw new Zi("Expected >",e,t)}case be.Close:if(!Z.isValidChar(r)){if(o===t)throw new Zi("Expected node name",e,t);if(e.substr(o,t-o)!==s.localName)throw new Zi("Expected </"+s.localName+">",e,t);n=be.IgnoreSpaces,a=be.WaitEndRet;continue}break;case be.Comment:r===Z.CharCodeMinus&&e.charCodeAt(t+1)===Z.CharCodeMinus&&e.charCodeAt(t+2)===Z.CharCodeGreaterThan&&(t+=2,n=be.Begin);break;case be.Doctype:if(r===Z.CharCodeBrackedOpen)d++;else if(r===Z.CharCodeBrackedClose)d--;else if(r===Z.CharCodeGreaterThan&&d===0){let p=new or;p.nodeType=O.DocumentType,p.value=e.substr(o,t-o),s.addChild(p),n=be.Begin}break;case be.Header:r===Z.CharCodeQuestion&&e.charCodeAt(t+1)===Z.CharCodeGreaterThan&&(t++,n=be.Begin);break;case be.Escape:if(r===Z.CharCodeSemi){let p=e.substr(o,t-o);if(p.charCodeAt(0)===Z.CharCodeSharp){let g=p.charCodeAt(1)===Z.CharCodeLowerX?parseInt("0"+p.substr(1,p.length-1)):parseInt(p.substr(1,p.length-1));l+=String.fromCharCode(g)}else Z.Escapes.has(p)?l+=Z.Escapes.get(p):l+=("&"+p+";").toString();o=t+1,n=u}else!Z.isValidChar(r)&&r!==Z.CharCodeSharp&&(l+="&",l+=e.substr(o,t-o),t--,o=t+1,n=u);break}t++}if(n===be.Begin&&(o=t,n=be.Pcdata),n===be.Pcdata){if(t!==o){l+=e.substr(o,t-o);let p=new or;p.nodeType=O.Text,p.value=l,s.addChild(p)}return t}if(n===be.Escape&&u===be.Pcdata){l+="&",l+=e.substr(o,t-o);let p=new or;return p.nodeType=O.Text,p.value=l,s.addChild(p),t}throw new Zi("Unexpected end",e,t)}static isValidChar(e){return e>=Z.CharCodeLowerA&&e<=Z.CharCodeLowerZ||e>=Z.CharCodeUpperA&&e<=Z.CharCodeUpperZ||e>=Z.CharCode0&&e<=Z.CharCode9||e===Z.CharCodeColon||e===Z.CharCodeDot||e===Z.CharCodeUnderscore||e===Z.CharCodeMinus}}Z.CharCodeLF=10;Z.CharCodeTab=9;Z.CharCodeCR=13;Z.CharCodeSpace=32;Z.CharCodeLowerThan=60;Z.CharCodeAmp=38;Z.CharCodeBrackedClose=93;Z.CharCodeBrackedOpen=91;Z.CharCodeGreaterThan=62;Z.CharCodeExclamation=33;Z.CharCodeUpperD=68;Z.CharCodeLowerD=100;Z.CharCodeMinus=45;Z.CharCodeQuestion=63;Z.CharCodeSlash=47;Z.CharCodeEquals=61;Z.CharCodeDoubleQuote=34;Z.CharCodeSingleQuote=39;Z.CharCodeSharp=35;Z.CharCodeLowerX=120;Z.CharCodeLowerA=97;Z.CharCodeLowerZ=122;Z.CharCodeUpperA=65;Z.CharCodeUpperZ=90;Z.CharCode0=48;Z.CharCode9=57;Z.CharCodeColon=58;Z.CharCodeDot=46;Z.CharCodeUnderscore=95;Z.CharCodeSemi=59;Z.Escapes=new Map([["lt","<"],["gt",">"],["amp","&"],["quot",'"'],["apos","'"]]);class I0{static write(e,t,s){const r=new I0(t,s);return r.writeNode(e),r.toString()}constructor(e,t){this._result=[],this._indention=e,this._xmlHeader=t,this._currentIndention="",this._isStartOfLine=!0}writeNode(e){switch(e.nodeType){case O.None:break;case O.Element:this._result.length>0&&this.writeLine(),this.write(`<${e.localName}`);for(const[t,s]of e.attributes)this.write(` ${t}="`),this.writeAttributeValue(s),this.write('"');if(e.childNodes.length===0)this.write("/>");else{if(this.write(">"),e.childNodes.length===1&&!e.firstElement)this.writeNode(e.childNodes[0]);else{this.indent();for(const t of e.childNodes)t.nodeType===O.Element&&this.writeNode(t);this.unindend(),this.writeLine()}this.write(`</${e.localName}>`)}break;case O.Text:e.value&&this.write(e.value);break;case O.CDATA:e.value!==null&&this.write(`<![CDATA[${e.value}]]>`);break;case O.Document:this._xmlHeader&&this.write('<?xml version="1.0" encoding="utf-8"?>');for(const t of e.childNodes)this.writeNode(t);break;case O.DocumentType:this.write(`<!DOCTYPE ${e.value}>`);break}}unindend(){this._currentIndention=this._currentIndention.substr(0,this._currentIndention.length-this._indention.length)}indent(){this._currentIndention+=this._indention}writeAttributeValue(e){for(let t=0;t<e.length;t++){const s=e.charAt(t);switch(s){case"<":this._result.push("&lt;");break;case">":this._result.push("&gt;");break;case"&":this._result.push("&amp;");break;case"'":this._result.push("&apos;");break;case'"':this._result.push("&quot;");break;default:this._result.push(s);break}}}write(e){this._isStartOfLine&&this._result.push(this._currentIndention),this._result.push(e),this._isStartOfLine=!1}writeLine(e=null){e&&this.write(e),this._indention.length>0&&!this._isStartOfLine&&(this._result.push(`
`),this._isStartOfLine=!0)}toString(){return this._result.join("").trimRight()}}class Ac extends or{constructor(){super(),this.nodeType=O.Document}parse(e){Z.parse(e,0,this)}toString(){return this.toFormattedString()}toFormattedString(e="",t=!1){return I0.write(this,e,t)}}var R;(function(i){i[i.Up=0]="Up",i[i.Down=1]="Down"})(R||(R={}));class XR{constructor(){this.id="",this.dots=0,this.tupletDenominator=-1,this.tupletNumerator=-1,this.value=N.Quarter}}class QR{constructor(){this.name="",this.path="",this.role="",this.program=0}get uniqueId(){return this.path+";"+this.name+";"+this.role}}class js{constructor(){this._hasAnacrusis=!1,this._skipApplyLyrics=!1}parseXml(e,t){this._masterTrackAutomations=new Map,this._automationsPerTrackIdAndBarIndex=new Map,this._tracksMapping=[],this._tracksById=new Map,this._masterBars=[],this._barsOfMasterBar=[],this._voicesOfBar=new Map,this._barsById=new Map,this._voiceById=new Map,this._beatsOfVoice=new Map,this._beatById=new Map,this._rhythmOfBeat=new Map,this._rhythmById=new Map,this._notesOfBeat=new Map,this._noteById=new Map,this._tappedNotes=new Map,this._lyricsByTrack=new Map,this._soundsByTrack=new Map,this._skipApplyLyrics=!1;let s=new Ac;try{s.parse(e)}catch(r){throw new yt("Could not parse XML",r)}if(this.parseDom(s),this.buildModel(),this.score.finish(t),!this._skipApplyLyrics&&this._lyricsByTrack.size>0)for(const[r,n]of this._lyricsByTrack)this._tracksById.get(r).applyLyrics(n)}parseDom(e){let t=e.firstElement;if(t)if(t.localName==="GPIF"){this.score=new Fa;for(let s of t.childNodes)if(s.nodeType===O.Element)switch(s.localName){case"Score":this.parseScoreNode(s);break;case"MasterTrack":this.parseMasterTrackNode(s);break;case"Tracks":this.parseTracksNode(s);break;case"MasterBars":this.parseMasterBarsNode(s);break;case"Bars":this.parseBars(s);break;case"Voices":this.parseVoices(s);break;case"Beats":this.parseBeats(s);break;case"Notes":this.parseNotes(s);break;case"Rhythms":this.parseRhythms(s);break}}else throw new yt("Root node of XML was not GPIF")}parseScoreNode(e){for(let t of e.childNodes)if(t.nodeType===O.Element)switch(t.localName){case"Title":this.score.title=t.firstChild.innerText;break;case"SubTitle":this.score.subTitle=t.firstChild.innerText;break;case"Artist":this.score.artist=t.firstChild.innerText;break;case"Album":this.score.album=t.firstChild.innerText;break;case"Words":this.score.words=t.firstChild.innerText;break;case"Music":this.score.music=t.firstChild.innerText;break;case"WordsAndMusic":if(t.firstChild&&t.firstChild.innerText!==""){let s=t.firstChild.innerText;s&&!this.score.words&&(this.score.words=s),s&&!this.score.music&&(this.score.music=s)}break;case"Copyright":this.score.copyright=t.firstChild.innerText;break;case"Tabber":this.score.tab=t.firstChild.innerText;break;case"Instructions":this.score.instructions=t.firstChild.innerText;break;case"Notices":this.score.notices=t.firstChild.innerText;break;case"ScoreSystemsDefaultLayout":this.score.defaultSystemsLayout=parseInt(t.innerText);break;case"ScoreSystemsLayout":this.score.systemsLayout=t.innerText.split(" ").map(s=>parseInt(s));break}}parseMasterTrackNode(e){for(let t of e.childNodes)if(t.nodeType===O.Element)switch(t.localName){case"Automations":this.parseAutomations(t,this._masterTrackAutomations,null);break;case"Tracks":this._tracksMapping=t.innerText.split(" ");break;case"Anacrusis":this._hasAnacrusis=!0;break}}parseAutomations(e,t,s){for(let r of e.childNodes)if(r.nodeType===O.Element)switch(r.localName){case"Automation":this.parseAutomation(r,t,s);break}}parseAutomation(e,t,s){let r=null,n=!1,a=-1,o=0,l=0,u=null,h=0,c=null;for(let f of e.childNodes)if(f.nodeType===O.Element)switch(f.localName){case"Type":r=f.innerText;break;case"Linear":n=f.innerText.toLowerCase()==="true";break;case"Bar":a=parseInt(f.innerText);break;case"Position":o=parseFloat(f.innerText);break;case"Value":if(f.firstElement&&f.firstElement.nodeType===O.CDATA)u=f.innerText;else{let p=f.innerText.split(" ");p.length===1?(l=parseFloat(p[0]),h=1):(l=parseFloat(p[0]),h=parseInt(p[1]))}break;case"Text":c=f.innerText;break}if(!r)return;let d=null;switch(r){case"Tempo":d=vi.buildTempoAutomation(n,o,l,h);break;case"Sound":u&&s&&s.has(u)&&(d=vi.buildInstrumentAutomation(n,o,s.get(u).program));break}d&&(c&&(d.text=c),a>=0&&(t.has(a)||t.set(a,[]),t.get(a).push(d)))}parseTracksNode(e){for(let t of e.childNodes)if(t.nodeType===O.Element)switch(t.localName){case"Track":this.parseTrack(t);break}}parseTrack(e){this._articulationByName=new Map;let t=new Va;t.ensureStaveCount(1);let s=t.staves[0];s.showStandardNotation=!0;let r=e.getAttribute("id");for(let n of e.childNodes)if(n.nodeType===O.Element)switch(n.localName){case"Name":t.name=n.innerText;break;case"Color":let a=n.innerText.split(" ");if(a.length>=3){let u=parseInt(a[0]),h=parseInt(a[1]),c=parseInt(a[2]);t.color=new Je(u,h,c,255)}break;case"Instrument":let o=n.getAttribute("ref");(o.endsWith("-gs")||o.endsWith("GrandStaff"))&&(t.ensureStaveCount(2),t.staves[1].showStandardNotation=!0);break;case"InstrumentSet":this.parseInstrumentSet(t,n);break;case"NotationPatch":this.parseNotationPatch(t,n);break;case"ShortName":t.shortName=n.innerText;break;case"SystemsDefautLayout":t.defaultSystemsLayout=parseInt(n.innerText);break;case"SystemsLayout":t.systemsLayout=n.innerText.split(" ").map(u=>parseInt(u));break;case"Lyrics":this.parseLyrics(r,n);break;case"Properties":this.parseTrackProperties(t,n);break;case"GeneralMidi":case"MidiConnection":case"MIDISettings":this.parseGeneralMidi(t,n);break;case"Sounds":this.parseSounds(r,t,n);break;case"PlaybackState":let l=n.innerText;t.playbackInfo.isSolo=l==="Solo",t.playbackInfo.isMute=l==="Mute";break;case"PartSounding":this.parsePartSounding(t,n);break;case"Staves":this.parseStaves(t,n);break;case"Transpose":this.parseTranspose(t,n);break;case"RSE":this.parseRSE(t,n);break;case"Automations":this.parseTrackAutomations(r,n);break}this._tracksById.set(r,t)}parseTrackAutomations(e,t){const s=new Map;this._automationsPerTrackIdAndBarIndex.set(e,s),this.parseAutomations(t,s,this._soundsByTrack.get(e))}parseNotationPatch(e,t){for(let s of t.childNodes)if(s.nodeType===O.Element)switch(s.localName){case"LineCount":const r=parseInt(s.innerText);for(let n of e.staves)n.standardNotationLineCount=r;break;case"Elements":this.parseElements(e,s);break}}parseInstrumentSet(e,t){for(let s of t.childNodes)if(s.nodeType===O.Element)switch(s.localName){case"Type":switch(s.innerText){case"drumKit":for(let n of e.staves)n.isPercussion=!0;break}if(s.innerText==="drumKit")for(let n of e.staves)n.isPercussion=!0;break;case"Elements":this.parseElements(e,s);break;case"LineCount":const r=parseInt(s.innerText);for(let n of e.staves)n.standardNotationLineCount=r;break}}parseElements(e,t){for(let s of t.childNodes)if(s.nodeType===O.Element)switch(s.localName){case"Element":this.parseElement(e,s);break}}parseElement(e,t){const s=t.findChildElement("Type"),r=s?s.innerText:"";for(let n of t.childNodes)if(n.nodeType===O.Element)switch(n.localName){case"Name":case"Articulations":this.parseArticulations(e,n,r);break}}parseArticulations(e,t,s){for(let r of t.childNodes)if(r.nodeType===O.Element)switch(r.localName){case"Articulation":this.parseArticulation(e,r,s);break}}parseArticulation(e,t,s){const r=new Q;r.outputMidiNumber=-1,r.elementType=s;let n="";for(let a of t.childNodes)if(a.nodeType===O.Element){const o=a.innerText;switch(a.localName){case"Name":n=a.innerText;break;case"OutputMidiNumber":o.length>0&&(r.outputMidiNumber=parseInt(o));break;case"TechniqueSymbol":r.techniqueSymbol=this.parseTechniqueSymbol(o);break;case"TechniquePlacement":switch(o){case"outside":r.techniqueSymbolPlacement=we.Bottom;break;case"inside":r.techniqueSymbolPlacement=we.Middle;break;case"above":r.techniqueSymbolPlacement=we.Bottom;break;case"below":r.techniqueSymbolPlacement=we.Top;break}break;case"Noteheads":const l=o.split(" ");l.length>=1&&(r.noteHeadDefault=this.parseNoteHead(l[0])),l.length>=2&&(r.noteHeadHalf=this.parseNoteHead(l[1])),l.length>=3&&(r.noteHeadWhole=this.parseNoteHead(l[2])),r.noteHeadHalf==S.None&&(r.noteHeadHalf=r.noteHeadDefault),r.noteHeadWhole==S.None&&(r.noteHeadWhole=r.noteHeadDefault);break;case"StaffLine":o.length>0&&(r.staffLine=parseInt(o));break}}r.outputMidiNumber!==-1?(e.percussionArticulations.push(r),n.length>0&&this._articulationByName.set(n,r)):n.length>0&&this._articulationByName.has(n)&&(this._articulationByName.get(n).staffLine=r.staffLine)}parseTechniqueSymbol(e){switch(e){case"pictEdgeOfCymbal":return S.PictEdgeOfCymbal;case"articStaccatoAbove":return S.ArticStaccatoAbove;case"noteheadParenthesis":return S.NoteheadParenthesis;case"stringsUpBow":return S.StringsUpBow;case"stringsDownBow":return S.StringsDownBow;case"guitarGolpe":return S.GuitarGolpe;default:return S.None}}parseNoteHead(e){switch(e){case"noteheadDoubleWholeSquare":return S.NoteheadDoubleWholeSquare;case"noteheadDoubleWhole":return S.NoteheadDoubleWhole;case"noteheadWhole":return S.NoteheadWhole;case"noteheadHalf":return S.NoteheadHalf;case"noteheadBlack":return S.NoteheadBlack;case"noteheadNull":return S.NoteheadNull;case"noteheadXOrnate":return S.NoteheadXOrnate;case"noteheadTriangleUpWhole":return S.NoteheadTriangleUpWhole;case"noteheadTriangleUpHalf":return S.NoteheadTriangleUpHalf;case"noteheadTriangleUpBlack":return S.NoteheadTriangleUpBlack;case"noteheadDiamondBlackWide":return S.NoteheadDiamondBlackWide;case"noteheadDiamondWhite":return S.NoteheadDiamondWhite;case"noteheadDiamondWhiteWide":return S.NoteheadDiamondWhiteWide;case"noteheadCircleX":return S.NoteheadCircleX;case"noteheadXWhole":return S.NoteheadXWhole;case"noteheadXHalf":return S.NoteheadXHalf;case"noteheadXBlack":return S.NoteheadXBlack;case"noteheadParenthesis":return S.NoteheadParenthesis;case"noteheadSlashedBlack2":return S.NoteheadSlashedBlack2;case"noteheadCircleSlash":return S.NoteheadCircleSlash;case"noteheadHeavyX":return S.NoteheadHeavyX;case"noteheadHeavyXHat":return S.NoteheadHeavyXHat;default:return I.warning("GPIF","Unknown notehead symbol",e),S.None}}parseStaves(e,t){let s=0;for(let r of t.childNodes)if(r.nodeType===O.Element)switch(r.localName){case"Staff":e.ensureStaveCount(s+1);let n=e.staves[s];this.parseStaff(n,r),s++;break}}parseStaff(e,t){for(let s of t.childNodes)if(s.nodeType===O.Element)switch(s.localName){case"Properties":this.parseStaffProperties(e,s);break}}parseStaffProperties(e,t){for(let s of t.childNodes)if(s.nodeType===O.Element)switch(s.localName){case"Property":this.parseStaffProperty(e,s);break}}parseStaffProperty(e,t){switch(t.getAttribute("name")){case"Tuning":for(let n of t.childNodes)if(n.nodeType===O.Element)switch(n.localName){case"Pitches":let a=t.findChildElement("Pitches").innerText.split(" "),o=new Array(a.length);for(let l=0;l<o.length;l++)o[o.length-1-l]=parseInt(a[l]);e.stringTuning.tunings=o;break;case"Label":e.stringTuning.name=n.innerText;break}e.isPercussion||(e.showTablature=!0);break;case"DiagramCollection":case"ChordCollection":this.parseDiagramCollectionForStaff(e,t);break;case"CapoFret":let r=parseInt(t.findChildElement("Fret").innerText);e.capo=r;break}}parseLyrics(e,t){let s=[];for(let r of t.childNodes)if(r.nodeType===O.Element)switch(r.localName){case"Line":s.push(this.parseLyricsLine(r));break}this._lyricsByTrack.set(e,s)}parseLyricsLine(e){let t=new Ht;for(let s of e.childNodes)if(s.nodeType===O.Element)switch(s.localName){case"Offset":t.startBar=parseInt(s.innerText);break;case"Text":t.text=s.innerText;break}return t}parseDiagramCollectionForTrack(e,t){let s=t.findChildElement("Items");for(let r of s.childNodes)if(r.nodeType===O.Element)switch(r.localName){case"Item":this.parseDiagramItemForTrack(e,r);break}}parseDiagramCollectionForStaff(e,t){let s=t.findChildElement("Items");for(let r of s.childNodes)if(r.nodeType===O.Element)switch(r.localName){case"Item":this.parseDiagramItemForStaff(e,r);break}}parseDiagramItemForTrack(e,t){let s=new Qn,r=t.getAttribute("id");for(let n of e.staves)n.addChord(r,s);this.parseDiagramItemForChord(s,t)}parseDiagramItemForStaff(e,t){let s=new Qn,r=t.getAttribute("id");e.addChord(r,s),this.parseDiagramItemForChord(s,t)}parseDiagramItemForChord(e,t){e.name=t.getAttribute("name");let s=t.findChildElement("Diagram");if(!s){e.showDiagram=!1,e.showFingering=!1;return}let r=parseInt(s.getAttribute("stringCount")),n=parseInt(s.getAttribute("baseFret"));e.firstFret=n+1;for(let a=0;a<r;a++)e.strings.push(-1);for(let a of s.childNodes)if(a.nodeType===O.Element)switch(a.localName){case"Fret":let o=parseInt(a.getAttribute("string"));e.strings[r-o-1]=n+parseInt(a.getAttribute("fret"));break;case"Fingering":let l=new Map;for(let u of a.childNodes)if(u.nodeType===O.Element)switch(u.localName){case"Position":let h=Te.Unknown,c=n+parseInt(u.getAttribute("fret"));switch(u.getAttribute("finger")){case"Index":h=Te.IndexFinger;break;case"Middle":h=Te.MiddleFinger;break;case"Rank":h=Te.AnnularFinger;break;case"Pinky":h=Te.LittleFinger;break;case"Thumb":h=Te.Thumb;break}h!==Te.Unknown&&(l.has(h)?e.barreFrets.push(c):l.set(h,!0));break}break;case"Property":switch(a.getAttribute("name")){case"ShowName":e.showName=a.getAttribute("value")==="true";break;case"ShowDiagram":e.showDiagram=a.getAttribute("value")==="true";break;case"ShowFingering":e.showFingering=a.getAttribute("value")==="true";break}break}}parseTrackProperties(e,t){for(let s of t.childNodes)if(s.nodeType===O.Element)switch(s.localName){case"Property":this.parseTrackProperty(e,s);break}}parseTrackProperty(e,t){switch(t.getAttribute("name")){case"Tuning":let r=t.findChildElement("Pitches").innerText.split(" "),n=new Array(r.length);for(let o=0;o<n.length;o++)n[n.length-1-o]=parseInt(r[o]);for(let o of e.staves)o.stringTuning.tunings=n,o.showStandardNotation=!0,o.showTablature=!0;break;case"DiagramCollection":case"ChordCollection":this.parseDiagramCollectionForTrack(e,t);break;case"CapoFret":let a=parseInt(t.findChildElement("Fret").innerText);for(let o of e.staves)o.capo=a;break}}parseGeneralMidi(e,t){for(let r of t.childNodes)if(r.nodeType===O.Element)switch(r.localName){case"Program":e.playbackInfo.program=parseInt(r.innerText);break;case"Port":e.playbackInfo.port=parseInt(r.innerText);break;case"PrimaryChannel":e.playbackInfo.primaryChannel=parseInt(r.innerText);break;case"SecondaryChannel":e.playbackInfo.secondaryChannel=parseInt(r.innerText);break}if(t.getAttribute("table")==="Percussion")for(let r of e.staves)r.isPercussion=!0}parseSounds(e,t,s){for(let r of s.childNodes)if(r.nodeType===O.Element)switch(r.localName){case"Sound":this.parseSound(e,t,r);break}}parseSound(e,t,s){const r=new QR;for(let n of s.childNodes)if(n.nodeType===O.Element)switch(n.localName){case"Name":r.name=n.innerText;break;case"Path":r.path=n.innerText;break;case"Role":r.role=n.innerText;break;case"MIDI":this.parseSoundMidi(r,n);break}(r.role==="Factory"||t.playbackInfo.program===0)&&(t.playbackInfo.program=r.program),this._soundsByTrack.has(e)||this._soundsByTrack.set(e,new Map),this._soundsByTrack.get(e).set(r.uniqueId,r)}parseSoundMidi(e,t){for(let s of t.childNodes)if(s.nodeType===O.Element)switch(s.localName){case"Program":e.program=parseInt(s.innerText);break}}parsePartSounding(e,t){for(let s of t.childNodes)if(s.nodeType===O.Element)switch(s.localName){case"TranspositionPitch":for(let r of e.staves)r.displayTranspositionPitch=parseInt(s.innerText);break}}parseTranspose(e,t){let s=0,r=0;for(let n of t.childNodes)if(n.nodeType===O.Element)switch(n.localName){case"Chromatic":r=parseInt(n.innerText);break;case"Octave":s=parseInt(n.innerText);break}for(let n of e.staves)n.displayTranspositionPitch=s*12+r}parseRSE(e,t){for(let s of t.childNodes)if(s.nodeType===O.Element)switch(s.localName){case"ChannelStrip":this.parseChannelStrip(e,s);break}}parseChannelStrip(e,t){for(let s of t.childNodes)if(s.nodeType===O.Element)switch(s.localName){case"Parameters":this.parseChannelStripParameters(e,s);break}}parseChannelStripParameters(e,t){if(t.firstChild&&t.firstChild.value){let s=t.firstChild.value.split(" ");s.length>=12&&(e.playbackInfo.balance=Math.floor(parseFloat(s[11])*16),e.playbackInfo.volume=Math.floor(parseFloat(s[12])*16))}}parseMasterBarsNode(e){for(let t of e.childNodes)if(t.nodeType===O.Element)switch(t.localName){case"MasterBar":this.parseMasterBar(t);break}}parseMasterBar(e){let t=new gn;this._masterBars.length===0&&this._hasAnacrusis&&(t.isAnacrusis=!0);for(let s of e.childNodes)if(s.nodeType===O.Element)switch(s.localName){case"Time":let r=s.innerText.split("/");t.timeSignatureNumerator=parseInt(r[0]),t.timeSignatureDenominator=parseInt(r[1]);break;case"FreeTime":t.isFreeTime=!0;break;case"DoubleBar":t.isDoubleBar=!0;break;case"Section":t.section=new Od,t.section.marker=s.findChildElement("Letter").innerText,t.section.text=s.findChildElement("Text").innerText;break;case"Repeat":s.getAttribute("start").toLowerCase()==="true"&&(t.isRepeatStart=!0),s.getAttribute("end").toLowerCase()==="true"&&s.getAttribute("count")&&(t.repeatCount=parseInt(s.getAttribute("count")));break;case"AlternateEndings":let n=s.innerText.split(" "),a=0;for(let l=0;l<n.length;l++)a=a|1<<-1+parseInt(n[l]);t.alternateEndings=a;break;case"Bars":this._barsOfMasterBar.push(s.innerText.split(" "));break;case"TripletFeel":switch(s.innerText){case"NoTripletFeel":t.tripletFeel=Pe.NoTripletFeel;break;case"Triplet8th":t.tripletFeel=Pe.Triplet8th;break;case"Triplet16th":t.tripletFeel=Pe.Triplet16th;break;case"Dotted8th":t.tripletFeel=Pe.Dotted8th;break;case"Dotted16th":t.tripletFeel=Pe.Dotted16th;break;case"Scottish8th":t.tripletFeel=Pe.Scottish8th;break;case"Scottish16th":t.tripletFeel=Pe.Scottish16th;break}break;case"Key":t.keySignature=parseInt(s.findChildElement("AccidentalCount").innerText);let o=s.findChildElement("Mode");if(o)switch(o.innerText.toLowerCase()){case"major":t.keySignatureType=wr.Major;break;case"minor":t.keySignatureType=wr.Minor;break}break;case"Fermatas":this.parseFermatas(t,s);break;case"XProperties":this.parseMasterBarXProperties(s,t);break}this._masterBars.push(t)}parseFermatas(e,t){for(let s of t.childNodes)if(s.nodeType===O.Element)switch(s.localName){case"Fermata":this.parseFermata(e,s);break}}parseFermata(e,t){let s=0,r=new A0;for(let n of t.childNodes)if(n.nodeType===O.Element)switch(n.localName){case"Type":switch(n.innerText){case"Short":r.type=yr.Short;break;case"Medium":r.type=yr.Medium;break;case"Long":r.type=yr.Long;break}break;case"Length":r.length=parseFloat(n.innerText);break;case"Offset":let a=n.innerText.split("/");if(a.length===2){let o=parseInt(a[0]),l=parseInt(a[1]);s=o/l*ke.QuarterTime|0}break}e.addFermata(s,r)}parseBars(e){for(let t of e.childNodes)if(t.nodeType===O.Element)switch(t.localName){case"Bar":this.parseBar(t);break}}parseBar(e){let t=new Sn,s=e.getAttribute("id");for(let r of e.childNodes)if(r.nodeType===O.Element)switch(r.localName){case"Voices":this._voicesOfBar.set(s,r.innerText.split(" "));break;case"Clef":switch(r.innerText){case"Neutral":t.clef=ve.Neutral;break;case"G2":t.clef=ve.G2;break;case"F4":t.clef=ve.F4;break;case"C4":t.clef=ve.C4;break;case"C3":t.clef=ve.C3;break}break;case"Ottavia":switch(r.innerText){case"8va":t.clefOttava=Ue._8va;break;case"15ma":t.clefOttava=Ue._15ma;break;case"8vb":t.clefOttava=Ue._8vb;break;case"15mb":t.clefOttava=Ue._15mb;break}break;case"SimileMark":switch(r.innerText){case"Simple":t.simileMark=Es.Simple;break;case"FirstOfDouble":t.simileMark=Es.FirstOfDouble;break;case"SecondOfDouble":t.simileMark=Es.SecondOfDouble;break}break;case"XProperties":this.parseBarXProperties(r,t);break}this._barsById.set(s,t)}parseVoices(e){for(let t of e.childNodes)if(t.nodeType===O.Element)switch(t.localName){case"Voice":this.parseVoice(t);break}}parseVoice(e){let t=new Wr,s=e.getAttribute("id");for(let r of e.childNodes)if(r.nodeType===O.Element)switch(r.localName){case"Beats":this._beatsOfVoice.set(s,r.innerText.split(" "));break}this._voiceById.set(s,t)}parseBeats(e){for(let t of e.childNodes)if(t.nodeType===O.Element)switch(t.localName){case"Beat":this.parseBeat(t);break}}parseBeat(e){let t=new xi,s=e.getAttribute("id");for(let r of e.childNodes)if(r.nodeType===O.Element)switch(r.localName){case"Notes":this._notesOfBeat.set(s,r.innerText.split(" "));break;case"Rhythm":this._rhythmOfBeat.set(s,r.getAttribute("ref"));break;case"Fadding":r.innerText==="FadeIn"&&(t.fadeIn=!0);break;case"Tremolo":switch(r.innerText){case"1/2":t.tremoloSpeed=N.Eighth;break;case"1/4":t.tremoloSpeed=N.Sixteenth;break;case"1/8":t.tremoloSpeed=N.ThirtySecond;break}break;case"Chord":t.chordId=r.innerText;break;case"Hairpin":switch(r.innerText){case"Crescendo":t.crescendo=ss.Crescendo;break;case"Decrescendo":t.crescendo=ss.Decrescendo;break}break;case"Arpeggio":r.innerText==="Up"?t.brushType=ut.ArpeggioUp:t.brushType=ut.ArpeggioDown;break;case"Properties":this.parseBeatProperties(r,t);break;case"XProperties":this.parseBeatXProperties(r,t);break;case"FreeText":t.text=r.innerText;break;case"TransposedPitchStemOrientation":switch(r.innerText){case"Upward":t.preferredBeamDirection=R.Up;break;case"Downward":t.preferredBeamDirection=R.Down;break}break;case"Dynamic":switch(r.innerText){case"PPP":t.dynamics=Me.PPP;break;case"PP":t.dynamics=Me.PP;break;case"P":t.dynamics=Me.P;break;case"MP":t.dynamics=Me.MP;break;case"MF":t.dynamics=Me.MF;break;case"F":t.dynamics=Me.F;break;case"FF":t.dynamics=Me.FF;break;case"FFF":t.dynamics=Me.FFF;break}break;case"GraceNotes":switch(r.innerText){case"OnBeat":t.graceType=he.OnBeat;break;case"BeforeBeat":t.graceType=he.BeforeBeat;break}break;case"Legato":r.getAttribute("origin")==="true"&&(t.isLegatoOrigin=!0);break;case"Whammy":let n=new G(0,0);n.value=this.toBendValue(parseFloat(r.getAttribute("originValue"))),n.offset=this.toBendOffset(parseFloat(r.getAttribute("originOffset"))),t.addWhammyBarPoint(n);let a=new G(0,0);a.value=this.toBendValue(parseFloat(r.getAttribute("middleValue"))),a.offset=this.toBendOffset(parseFloat(r.getAttribute("middleOffset1"))),t.addWhammyBarPoint(a);let o=new G(0,0);o.value=this.toBendValue(parseFloat(r.getAttribute("middleValue"))),o.offset=this.toBendOffset(parseFloat(r.getAttribute("middleOffset2"))),t.addWhammyBarPoint(o);let l=new G(0,0);l.value=this.toBendValue(parseFloat(r.getAttribute("destinationValue"))),l.offset=this.toBendOffset(parseFloat(r.getAttribute("destinationOffset"))),t.addWhammyBarPoint(l);break;case"Ottavia":switch(r.innerText){case"8va":t.ottava=Ue._8va;break;case"8vb":t.ottava=Ue._8vb;break;case"15ma":t.ottava=Ue._15ma;break;case"15mb":t.ottava=Ue._15mb;break}break;case"Lyrics":t.lyrics=this.parseBeatLyrics(r),this._skipApplyLyrics=!0;break;case"Slashed":t.slashed=!0;break}this._beatById.set(s,t)}parseBeatLyrics(e){const t=[];for(let s of e.childNodes)if(s.nodeType===O.Element)switch(s.localName){case"Line":t.push(s.innerText);break}return t}parseBeatXProperties(e,t){for(let s of e.childNodes)if(s.nodeType===O.Element)switch(s.localName){case"XProperty":let r=s.getAttribute("id"),n=0;switch(r){case"1124204545":n=parseInt(s.findChildElement("Int").innerText),t.invertBeamDirection=n===1;break;case"687935489":n=parseInt(s.findChildElement("Int").innerText),t.brushDuration=n;break}break}}parseBarXProperties(e,t){for(let s of e.childNodes)if(s.nodeType===O.Element)switch(s.localName){case"XProperty":switch(s.getAttribute("id")){case"1124139520":const n=s.findChildElement("Double")??s.findChildElement("Float");t.displayScale=parseFloat(n.innerText);break}break}}parseMasterBarXProperties(e,t){for(let s of e.childNodes)if(s.nodeType===O.Element)switch(s.localName){case"XProperty":switch(s.getAttribute("id")){case"1124073984":t.displayScale=parseFloat(s.findChildElement("Double").innerText);break}break}}parseBeatProperties(e,t){let s=!1,r=null,n=null,a=null,o=null,l=null;for(let u of e.childNodes)if(u.nodeType===O.Element)switch(u.localName){case"Property":switch(u.getAttribute("name")){case"Brush":u.findChildElement("Direction").innerText==="Up"?t.brushType=ut.BrushUp:t.brushType=ut.BrushDown;break;case"PickStroke":u.findChildElement("Direction").innerText==="Up"?t.pickStroke=fi.Up:t.pickStroke=fi.Down;break;case"Slapped":u.findChildElement("Enable")&&(t.slap=!0);break;case"Popped":u.findChildElement("Enable")&&(t.pop=!0);break;case"VibratoWTremBar":switch(u.findChildElement("Strength").innerText){case"Wide":t.vibrato=Ge.Wide;break;case"Slight":t.vibrato=Ge.Slight;break}break;case"WhammyBar":s=!0;break;case"WhammyBarExtend":break;case"WhammyBarOriginValue":r||(r=new G(0,0)),r.value=this.toBendValue(parseFloat(u.findChildElement("Float").innerText));break;case"WhammyBarOriginOffset":r||(r=new G(0,0)),r.offset=this.toBendOffset(parseFloat(u.findChildElement("Float").innerText));break;case"WhammyBarMiddleValue":n=this.toBendValue(parseFloat(u.findChildElement("Float").innerText));break;case"WhammyBarMiddleOffset1":a=this.toBendOffset(parseFloat(u.findChildElement("Float").innerText));break;case"WhammyBarMiddleOffset2":o=this.toBendOffset(parseFloat(u.findChildElement("Float").innerText));break;case"WhammyBarDestinationValue":l||(l=new G(G.MaxPosition,0)),l.value=this.toBendValue(parseFloat(u.findChildElement("Float").innerText));break;case"WhammyBarDestinationOffset":l||(l=new G(0,0)),l.offset=this.toBendOffset(parseFloat(u.findChildElement("Float").innerText));break}break}s&&(r||(r=new G(0,0)),l||(l=new G(G.MaxPosition,0)),t.addWhammyBarPoint(r),a&&n&&t.addWhammyBarPoint(new G(a,n)),o&&n&&t.addWhammyBarPoint(new G(o,n)),!a&&!o&&n&&t.addWhammyBarPoint(new G(G.MaxPosition/2|0,n)),t.addWhammyBarPoint(l))}parseNotes(e){for(let t of e.childNodes)if(t.nodeType===O.Element)switch(t.localName){case"Note":this.parseNote(t);break}}parseNote(e){let t=new Ss,s=e.getAttribute("id");for(let r of e.childNodes)if(r.nodeType===O.Element)switch(r.localName){case"Properties":this.parseNoteProperties(r,t,s);break;case"AntiAccent":r.innerText.toLowerCase()==="normal"&&(t.isGhost=!0);break;case"LetRing":t.isLetRing=!0;break;case"Trill":t.trillValue=parseInt(r.innerText),t.trillSpeed=N.Sixteenth;break;case"Accent":let n=parseInt(r.innerText);n&1&&(t.isStaccato=!0),n&4&&(t.accentuated=_t.Heavy),n&8&&(t.accentuated=_t.Normal),n&16&&(t.accentuated=_t.Tenuto);break;case"Tie":r.getAttribute("destination").toLowerCase()==="true"&&(t.isTieDestination=!0);break;case"Vibrato":switch(r.innerText){case"Slight":t.vibrato=Ge.Slight;break;case"Wide":t.vibrato=Ge.Wide;break}break;case"LeftFingering":switch(t.isFingering=!0,r.innerText){case"P":t.leftHandFinger=Te.Thumb;break;case"I":t.leftHandFinger=Te.IndexFinger;break;case"M":t.leftHandFinger=Te.MiddleFinger;break;case"A":t.leftHandFinger=Te.AnnularFinger;break;case"C":t.leftHandFinger=Te.LittleFinger;break}break;case"RightFingering":switch(t.isFingering=!0,r.innerText){case"P":t.rightHandFinger=Te.Thumb;break;case"I":t.rightHandFinger=Te.IndexFinger;break;case"M":t.rightHandFinger=Te.MiddleFinger;break;case"A":t.rightHandFinger=Te.AnnularFinger;break;case"C":t.rightHandFinger=Te.LittleFinger;break}break;case"InstrumentArticulation":t.percussionArticulation=parseInt(r.innerText);break}this._noteById.set(s,t)}parseNoteProperties(e,t,s){let r=!1,n=null,a=null,o=null,l=null,u=null,h=-1,c=-1;for(let d of e.childNodes)if(d.nodeType===O.Element)switch(d.localName){case"Property":switch(d.getAttribute("name")){case"ShowStringNumber":d.findChildElement("Enable")&&(t.showStringNumber=!0);break;case"String":t.string=parseInt(d.findChildElement("String").innerText)+1;break;case"Fret":t.fret=parseInt(d.findChildElement("Fret").innerText);break;case"Element":h=parseInt(d.findChildElement("Element").innerText);break;case"Variation":c=parseInt(d.findChildElement("Variation").innerText);break;case"Tapped":this._tappedNotes.set(s,!0);break;case"HarmonicType":let p=d.findChildElement("HType");if(p)switch(p.innerText){case"NoHarmonic":t.harmonicType=fe.None;break;case"Natural":t.harmonicType=fe.Natural;break;case"Artificial":t.harmonicType=fe.Artificial;break;case"Pinch":t.harmonicType=fe.Pinch;break;case"Tap":t.harmonicType=fe.Tap;break;case"Semi":t.harmonicType=fe.Semi;break;case"Feedback":t.harmonicType=fe.Feedback;break}break;case"HarmonicFret":let g=d.findChildElement("HFret");g&&(t.harmonicValue=parseFloat(g.innerText));break;case"Muted":d.findChildElement("Enable")&&(t.isDead=!0);break;case"PalmMuted":d.findChildElement("Enable")&&(t.isPalmMute=!0);break;case"Octave":t.octave=parseInt(d.findChildElement("Number").innerText),t.tone===-1&&(t.tone=0);break;case"Tone":t.tone=parseInt(d.findChildElement("Step").innerText);break;case"ConcertPitch":this.parseConcertPitch(d,t);break;case"Bended":r=!0;break;case"BendOriginValue":n||(n=new G(0,0)),n.value=this.toBendValue(parseFloat(d.findChildElement("Float").innerText));break;case"BendOriginOffset":n||(n=new G(0,0)),n.offset=this.toBendOffset(parseFloat(d.findChildElement("Float").innerText));break;case"BendMiddleValue":a=this.toBendValue(parseFloat(d.findChildElement("Float").innerText));break;case"BendMiddleOffset1":o=this.toBendOffset(parseFloat(d.findChildElement("Float").innerText));break;case"BendMiddleOffset2":l=this.toBendOffset(parseFloat(d.findChildElement("Float").innerText));break;case"BendDestinationValue":u||(u=new G(G.MaxPosition,0)),u.value=this.toBendValue(parseFloat(d.findChildElement("Float").innerText));break;case"BendDestinationOffset":u||(u=new G(0,0)),u.offset=this.toBendOffset(parseFloat(d.findChildElement("Float").innerText));break;case"HopoOrigin":d.findChildElement("Enable")&&(t.isHammerPullOrigin=!0);break;case"HopoDestination":break;case"LeftHandTapped":t.isLeftHandTapped=!0;break;case"Slide":let b=parseInt(d.findChildElement("Flags").innerText);b&1?t.slideOutType=xe.Shift:b&2?t.slideOutType=xe.Legato:b&4?t.slideOutType=xe.OutDown:b&8&&(t.slideOutType=xe.OutUp),b&16?t.slideInType=ii.IntoFromBelow:b&32&&(t.slideInType=ii.IntoFromAbove),b&64?t.slideOutType=xe.PickSlideDown:b&128&&(t.slideOutType=xe.PickSlideUp);break}break}r&&(n||(n=new G(0,0)),u||(u=new G(G.MaxPosition,0)),t.addBendPoint(n),o&&a&&t.addBendPoint(new G(o,a)),l&&a&&t.addBendPoint(new G(l,a)),!o&&!l&&a&&t.addBendPoint(new G(G.MaxPosition/2|0,a)),t.addBendPoint(u)),h!==-1&&c!==-1&&(t.percussionArticulation=Lt.articulationFromElementVariation(h,c))}parseConcertPitch(e,t){const s=e.findChildElement("Pitch");if(s){for(let r of s.childNodes)if(r.nodeType===O.Element)switch(r.localName){case"Accidental":switch(r.innerText){case"x":t.accidentalMode=At.ForceDoubleSharp;break;case"#":t.accidentalMode=At.ForceSharp;break;case"b":t.accidentalMode=At.ForceFlat;break;case"bb":t.accidentalMode=At.ForceDoubleFlat;break}break}}}toBendValue(e){return e*js.BendPointValueFactor|0}toBendOffset(e){return e*js.BendPointPositionFactor}parseRhythms(e){for(let t of e.childNodes)if(t.nodeType===O.Element)switch(t.localName){case"Rhythm":this.parseRhythm(t);break}}parseRhythm(e){let t=new XR,s=e.getAttribute("id");t.id=s;for(let r of e.childNodes)if(r.nodeType===O.Element)switch(r.localName){case"NoteValue":switch(r.innerText){case"Long":t.value=N.QuadrupleWhole;break;case"DoubleWhole":t.value=N.DoubleWhole;break;case"Whole":t.value=N.Whole;break;case"Half":t.value=N.Half;break;case"Quarter":t.value=N.Quarter;break;case"Eighth":t.value=N.Eighth;break;case"16th":t.value=N.Sixteenth;break;case"32nd":t.value=N.ThirtySecond;break;case"64th":t.value=N.SixtyFourth;break;case"128th":t.value=N.OneHundredTwentyEighth;break;case"256th":t.value=N.TwoHundredFiftySixth;break}break;case"PrimaryTuplet":t.tupletNumerator=parseInt(r.getAttribute("num")),t.tupletDenominator=parseInt(r.getAttribute("den"));break;case"AugmentationDot":t.dots=parseInt(r.getAttribute("count"));break}this._rhythmById.set(s,t)}buildModel(){for(let e=0,t=this._masterBars.length;e<t;e++){let s=this._masterBars[e];this.score.addMasterBar(s)}for(let e of this._tracksMapping){if(!e)continue;let t=this._tracksById.get(e);this.score.addTrack(t)}for(let e of this._barsOfMasterBar){let t=0;for(let s=0,r=0;s<e.length&&r<this.score.tracks.length;s++){let n=e[s];if(n!==js.InvalidId){let a=this._barsById.get(n),o=this.score.tracks[r],l=o.staves[t];if(l.addBar(a),this._voicesOfBar.has(n))for(let u of this._voicesOfBar.get(n))if(u!==js.InvalidId){let h=this._voiceById.get(u);if(a.addVoice(h),this._beatsOfVoice.has(u)){for(let c of this._beatsOfVoice.get(u))if(c!==js.InvalidId){let d=D0.clone(this._beatById.get(c));h.addBeat(d);let f=this._rhythmOfBeat.get(c),p=this._rhythmById.get(f);if(d.duration=p.value,d.dots=p.dots,d.tupletNumerator=p.tupletNumerator,d.tupletDenominator=p.tupletDenominator,this._notesOfBeat.has(c)){for(let g of this._notesOfBeat.get(c))if(g!==js.InvalidId){const b=b_.clone(this._noteById.get(g));l.isPercussion?(b.fret=-1,b.string=-1):b.percussionArticulation=-1,d.addNote(b),this._tappedNotes.has(g)&&(d.tap=!0)}}}}}else{let h=new Wr;a.addVoice(h);let c=new xi;c.isEmpty=!0,c.duration=N.Quarter,h.addBeat(c)}t===o.staves.length-1?(r++,t=0):t++}else r++}}for(let e of this._tracksMapping){if(!e)continue;let t=this._tracksById.get(e),s=!1;for(const r of t.staves)if(r.isPercussion){s=!0;break}if(s||(t.percussionArticulations=[]),this._automationsPerTrackIdAndBarIndex.has(e)){const r=this._automationsPerTrackIdAndBarIndex.get(e);for(const[n,a]of r)if(t.staves.length>0&&n<t.staves[0].bars.length){const o=t.staves[0].bars[n];if(o.voices.length>0&&o.voices[0].beats.length>0){const l=o.voices[0].beats[0];for(const u of a)l.automations.push(u)}}}}for(const[e,t]of this._masterTrackAutomations){let s=this.score.masterBars[e];for(let r=0,n=t.length;r<n;r++){let a=t[r];a.type===jt.Tempo&&(e===0&&(this.score.tempo=a.value|0,a.text&&(this.score.tempoLabel=a.text)),s.tempoAutomations.push(a))}}}}js.InvalidId="-1";js.BendPointPositionFactor=G.MaxPosition/100;js.BendPointValueFactor=1/25;class zf{constructor(){this.isMultiRest=!1,this.trackViewGroups=[]}}class Fb{constructor(){this.showNumbered=!1,this.showSlash=!1,this.showStandardNotation=!1,this.showTablature=!1}}class k_{apply(e){if(this.scoreViews.length>0){let t=0;for(let s of this.scoreViews[0].trackViewGroups){if(t<e.tracks.length){const r=e.tracks[t];for(const n of r.staves)n.showTablature=s.showTablature,n.showStandardNotation=s.showStandardNotation,n.showSlash=s.showSlash,n.showNumbered=s.showNumbered}t++}}}constructor(e){this.scoreViews=[];let t=si.fromBuffer(e);const s=L.readInt32BE(t);for(let r=0;r<s;r++){const n=new zf;this.scoreViews.push(n),n.isMultiRest=We.gpReadBool(t);const a=L.readInt32BE(t);for(let o=0;o<a;o++){let l=t.readByte();l===0&&(l=1);let u=new Fb;u.showStandardNotation=(l&1)!==0,u.showTablature=(l&2)!==0,u.showSlash=(l&4)!==0,u.showNumbered=(l&8)!==0,n.trackViewGroups.push(u)}}}static writeForScore(e){const t=si.withCapacity(128),s=[new zf];for(const r of e.tracks){const n=new Fb;n.showStandardNotation=r.staves[0].showStandardNotation,n.showTablature=r.staves[0].showTablature,n.showSlash=r.staves[0].showSlash,n.showNumbered=r.staves[0].showNumbered,s[0].trackViewGroups.push(n);const a=new zf;a.trackViewGroups.push(n),s.push(a)}L.writeInt32BE(t,s.length);for(const r of s){t.writeByte(r.isMultiRest?1:0),L.writeInt32BE(t,r.trackViewGroups.length);for(const n of r.trackViewGroups){let a=0;n.showStandardNotation&&(a=a|1),n.showTablature&&(a=a|2),n.showSlash&&(a=a|4),n.showNumbered&&(a=a|8),t.writeByte(a)}}return L.writeInt32BE(t,1),t.toArray()}}class R0{}class Gh extends R0{constructor(e){super(),this.n=e}}class na extends R0{constructor(e,t){super(),this.left=e,this.right=t}}class Rg extends R0{constructor(e,t){super(),this.n=e,this.table=t}}class ai{static make(e,t,s,r){let n=[],a=[];if(r>32)throw new Vt("Invalid huffman");for(let u=0;u<r;u++)n.push(0),a.push(0);for(let u=0;u<s;u++){let h=e[u+t];if(h>=r)throw new Vt("Invalid huffman");n[h]++}let o=0;for(let u=1;u<r-1;u++)o=o+n[u]<<1,a[u]=o;let l=new Map;for(let u=0;u<s;u++){let h=e[u+t];if(h!==0){let c=a[h-1];a[h-1]=c+1,l.set(c<<5|h,u)}}return ai.treeCompress(new na(ai.treeMake(l,r,0,1),ai.treeMake(l,r,1,1)))}static treeMake(e,t,s,r){if(r>t)throw new Vt("Invalid huffman");let n=s<<5|r;return e.has(n)?new Gh(e.get(n)):(s=s<<1,r+=1,new na(ai.treeMake(e,t,s,r),ai.treeMake(e,t,s|1,r)))}static treeCompress(e){let t=ai.treeDepth(e);if(t===0)return e;if(t===1){if(e instanceof na)return new na(ai.treeCompress(e.left),ai.treeCompress(e.right));throw new Vt("assert")}let s=1<<t,r=[];for(let n=0;n<s;n++)r.push(new Gh(-1));return ai.treeWalk(r,0,0,t,e),new Rg(t,r)}static treeWalk(e,t,s,r,n){n instanceof na&&r>0?(ai.treeWalk(e,t,s+1,r-1,n.left),ai.treeWalk(e,t|1<<s,s+1,r-1,n.right)):e[t]=ai.treeCompress(n)}static treeDepth(e){if(e instanceof Gh)return 0;if(e instanceof Rg)throw new Vt("assert");if(e instanceof na){let t=ai.treeDepth(e.left),s=ai.treeDepth(e.right);return 1+(t<s?t:s)}return 0}}var Mt;(function(i){i[i.Head=0]="Head",i[i.Block=1]="Block",i[i.CData=2]="CData",i[i.Flat=3]="Flat",i[i.Crc=4]="Crc",i[i.Dist=5]="Dist",i[i.DistOne=6]="DistOne",i[i.Done=7]="Done"})(Mt||(Mt={}));class nr{constructor(){this.buffer=new Uint8Array(nr.BufferSize),this.pos=0}slide(){let e=new Uint8Array(nr.BufferSize);this.pos-=nr.Size,e.set(this.buffer.subarray(nr.Size,nr.Size+this.pos),0),this.buffer=e}addBytes(e,t,s){this.pos+s>nr.BufferSize&&this.slide(),this.buffer.set(e.subarray(t,t+s),this.pos),this.pos+=s}addByte(e){this.pos===nr.BufferSize&&this.slide(),this.buffer[this.pos]=e,this.pos++}getLastChar(){return this.buffer[this.pos-1]}available(){return this.pos}}nr.Size=32768;nr.BufferSize=65536;class Hi{static buildFixedHuffman(){let e=[];for(let t=0;t<288;t++)e.push(t<=143?8:t<=255?9:t<=279?7:8);return ai.make(e,0,288,10)}constructor(e){this._nbits=0,this._bits=0,this._state=Mt.Block,this._isFinal=!1,this._huffman=Hi._fixedHuffman,this._huffdist=null,this._len=0,this._dist=0,this._needed=0,this._output=null,this._outpos=0,this._lengths=[],this._window=new nr,this._input=e;for(let t=0;t<19;t++)this._lengths.push(-1)}readBytes(e,t,s){if(this._needed=s,this._outpos=t,this._output=e,s>0)for(;this.inflateLoop(););return s-this._needed}inflateLoop(){switch(this._state){case Mt.Head:let e=this._input.readByte();if((e&15)!==8)throw new Vt("Invalid data");let s=this._input.readByte(),r=(s&32)!==0;if(((e<<8)+s)%31!==0)throw new Vt("Invalid data");if(r)throw new Vt("Unsupported dictionary");return this._state=Mt.Block,!0;case Mt.Crc:return this._state=Mt.Done,!0;case Mt.Done:return!1;case Mt.Block:switch(this._isFinal=this.getBit(),this.getBits(2)){case 0:if(this._len=L.readUInt16LE(this._input),L.readUInt16LE(this._input)!==65535-this._len)throw new Vt("Invalid data");this._state=Mt.Flat;let o=this.inflateLoop();return this.resetBits(),o;case 1:return this._huffman=Hi._fixedHuffman,this._huffdist=null,this._state=Mt.CData,!0;case 2:let l=this.getBits(5)+257,u=this.getBits(5)+1,h=this.getBits(4)+4;for(let d=0;d<h;d++)this._lengths[Hi.CodeLengthsPos[d]]=this.getBits(3);for(let d=h;d<19;d++)this._lengths[Hi.CodeLengthsPos[d]]=0;this._huffman=ai.make(this._lengths,0,19,8);let c=[];for(let d=0;d<l+u;d++)c.push(0);return this.inflateLengths(c,l+u),this._huffdist=ai.make(c,l,u,16),this._huffman=ai.make(c,0,l,16),this._state=Mt.CData,!0;default:throw new Vt("Invalid data")}case Mt.Flat:{let a=this._len<this._needed?this._len:this._needed,o=L.readByteArray(this._input,a);return this._len-=a,this.addBytes(o,0,a),this._len===0&&(this._state=this._isFinal?Mt.Crc:Mt.Block),this._needed>0}case Mt.DistOne:{let a=this._len<this._needed?this._len:this._needed;return this.addDistOne(a),this._len-=a,this._len===0&&(this._state=Mt.CData),this._needed>0}case Mt.Dist:for(;this._len>0&&this._needed>0;){let a=this._len<this._dist?this._len:this._dist,o=this._needed<a?this._needed:a;this.addDist(this._dist,o),this._len-=o}return this._len===0&&(this._state=Mt.CData),this._needed>0;case Mt.CData:let n=this.applyHuffman(this._huffman);if(n<256)return this.addByte(n),this._needed>0;if(n===256)return this._state=this._isFinal?Mt.Crc:Mt.Block,!0;{n=n-257&255;let a=Hi.LenExtraBitsTbl[n];if(a===-1)throw new Vt("Invalid data");this._len=Hi.LenBaseValTbl[n]+this.getBits(a);let o=this._huffdist,l=o?this.applyHuffman(o):this.getRevBits(5);if(a=Hi.DistExtraBitsTbl[l],a===-1)throw new Vt("Invalid data");if(this._dist=Hi.DistBaseValTbl[l]+this.getBits(a),this._dist>this._window.available())throw new Vt("Invalid data");return this._state=this._dist===1?Mt.DistOne:Mt.Dist,!0}}return!1}addDistOne(e){let t=this._window.getLastChar();for(let s=0;s<e;s++)this.addByte(t)}addByte(e){this._window.addByte(e),this._output[this._outpos]=e,this._needed--,this._outpos++}addDist(e,t){this.addBytes(this._window.buffer,this._window.pos-e,t)}getBit(){this._nbits===0&&(this._nbits=8,this._bits=this._input.readByte());let e=(this._bits&1)===1;return this._nbits--,this._bits=this._bits>>1,e}getBits(e){for(;this._nbits<e;)this._bits=this._bits|this._input.readByte()<<this._nbits,this._nbits+=8;let t=this._bits&(1<<e)-1;return this._nbits-=e,this._bits=this._bits>>e,t}getRevBits(e){return e===0?0:this.getBit()?1<<e-1|this.getRevBits(e-1):this.getRevBits(e-1)}resetBits(){this._bits=0,this._nbits=0}addBytes(e,t,s){this._window.addBytes(e,t,s),this._output.set(e.subarray(t,t+s),this._outpos),this._needed-=s,this._outpos+=s}inflateLengths(e,t){let s=0,r=0;for(;s<t;){let n=this.applyHuffman(this._huffman);switch(n){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:case 10:case 11:case 12:case 13:case 14:case 15:r=n,e[s]=n,s++;break;case 16:let a=s+3+this.getBits(2);if(a>t)throw new Vt("Invalid data");for(;s<a;)e[s]=r,s++;break;case 17:if(s+=3+this.getBits(3),s>t)throw new Vt("Invalid data");break;case 18:if(s+=11+this.getBits(7),s>t)throw new Vt("Invalid data");break;default:throw new Vt("Invalid data")}}}applyHuffman(e){if(e instanceof Gh)return e.n;if(e instanceof na)return this.applyHuffman(this.getBit()?e.right:e.left);if(e instanceof Rg)return this.applyHuffman(e.table[this.getBits(e.n)]);throw new Vt("Invalid data")}}Hi.LenExtraBitsTbl=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,-1,-1];Hi.LenBaseValTbl=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258];Hi.DistExtraBitsTbl=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,-1,-1];Hi.DistBaseValTbl=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577];Hi.CodeLengthsPos=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];Hi._fixedHuffman=Hi.buildFixedHuffman();class en{constructor(e,t){this.fullName=e;let s=e.lastIndexOf("/");this.fileName=s===-1||s===e.length-1?this.fullName:e.substr(s+1),this.data=t}}en.OptionalDataDescriptorSignature=134695760;en.CompressionMethodDeflate=8;en.LocalFileHeaderSignature=67324752;en.CentralFileHeaderSignature=33639248;en.EndOfCentralDirSignature=101010256;class O0{constructor(e){this._readable=e}read(){let e=[];for(;;){let t=this.readEntry();if(!t)break;e.push(t)}return e}readEntry(){let e=this._readable;if(L.readInt32LE(e)!==en.LocalFileHeaderSignature)return null;L.readUInt16LE(e);let s=L.readUInt16LE(e),r=L.readUInt16LE(e),n=r!==0;if(n&&r!==en.CompressionMethodDeflate)return null;L.readInt16LE(this._readable),L.readInt16LE(this._readable),L.readInt32LE(e),L.readInt32LE(e);let a=L.readInt32LE(e),o=L.readInt16LE(e),l=L.readInt16LE(e),u=L.toString(L.readByteArray(e,o),"utf-8");e.skip(l);let h;if(n){let c=si.empty(),d=new Hi(this._readable),f=new Uint8Array(65536);for(;;){let p=d.readBytes(f,0,f.length);if(c.write(f,0,p),p<f.length)break}h=c.toArray()}else h=L.readByteArray(this._readable,a);return s&8&&(L.readInt32LE(this._readable)===en.OptionalDataDescriptorSignature&&L.readInt32LE(this._readable),L.readInt32LE(this._readable),L.readInt32LE(this._readable)),new en(u,h)}}class JR{constructor(){this.trackViewGroups=[]}}class qR{constructor(){this.isVisible=!1}}var Og;(function(i){i[i.PageVertical=0]="PageVertical",i[i.PageGrid=1]="PageGrid",i[i.PageParchment=2]="PageParchment",i[i.ScreenVertical=3]="ScreenVertical",i[i.ScreenHorizontal=4]="ScreenHorizontal",i[i.PageHorizontal=5]="PageHorizontal"})(Og||(Og={}));class x_{constructor(e,t){this.zoomLevel=4,this.view=Og.PageVertical,this.muiltiVoiceCursor=!1,this.scoreViews=[];const s=si.fromBuffer(t);this.zoomLevel=L.readInt32BE(s),this.view=s.readByte(),this.muiltiVoiceCursor=s.readByte()!=0;const r=e.scoreViews.length;for(let n=0;n<r;n++){const a=new JR;this.scoreViews.push(a);const o=e.scoreViews[n];for(let l=0;l<o.trackViewGroups.length;l++){const u=new qR;u.isVisible=s.readByte()!=0,a.trackViewGroups.push(u)}}}apply(e){if(this.scoreViews.length>0){let t=0;for(let s of this.scoreViews[0].trackViewGroups){if(t<e.tracks.length){const r=e.tracks[t];r.isVisibleOnMultiTrack=s.isVisible}t++}}}static writeForScore(e){const t=si.withCapacity(128);L.writeInt32BE(t,4),t.writeByte(0);const s=e.tracks.length>0&&e.tracks[0].staves[0].bars[0].isMultiVoice;t.writeByte(s?255:0);for(const r of e.tracks)t.writeByte(r.isVisibleOnMultiTrack?255:0);for(const r of e.tracks)t.writeByte(255);return t.toArray()}}class KR extends Qo{get name(){return"Guitar Pro 7-8"}constructor(){super()}readScore(){I.debug(this.name,"Loading ZIP entries");let e=new O0(this.data),t;try{t=e.read()}catch(h){throw new yt("No Zip archive",h)}I.debug(this.name,"Zip entries loaded");let s=null,r=null,n=null,a=null;for(let h of t)switch(h.fileName){case"score.gpif":s=L.toString(h.data,this.settings.importer.encoding);break;case"BinaryStylesheet":r=h.data;break;case"PartConfiguration":n=h.data;break;case"LayoutConfiguration":a=h.data;break}if(!s)throw new yt("No score.gpif found in zip archive");I.debug(this.name,"Start Parsing score.gpif");let o=new js;o.parseXml(s,this.settings),I.debug(this.name,"score.gpif parsed");let l=o.score;r&&(I.debug(this.name,"Start Parsing BinaryStylesheet"),new Fd(r).apply(l),I.debug(this.name,"BinaryStylesheet parsed"));let u=null;return n&&(I.debug(this.name,"Start Parsing Part Configuration"),u=new k_(n),u.apply(l),I.debug(this.name,"Part Configuration parsed")),a&&u!=null&&(I.debug(this.name,"Start Parsing Layout Configuration"),new x_(u,a).apply(l),I.debug(this.name,"Layout Configuration parsed")),l}}class uu extends ni{constructor(){super(ri.Format,"Unexpected end of data within reader"),Object.setPrototypeOf(this,uu.prototype)}}class hu{constructor(e){this._currentByte=0,this._position=hu.ByteSize,this._source=e}readByte(){return this.readBits(8)}readBytes(e){const t=new Uint8Array(e);for(let s=0;s<e;s++)t[s]=this.readByte()&255;return t}readBits(e){let t=0,s=e-1;for(;s>=0;)t=t|this.readBit()<<s,s--;return t}readBitsReversed(e){let t=0;for(let s=0;s<e;s++)t=t|this.readBit()<<s;return t}readBit(){if(this._position>=8){if(this._currentByte=this._source.readByte(),this._currentByte===-1)throw new uu;this._position=0}const e=this._currentByte>>hu.ByteSize-this._position-1&1;return this._position++,e}readAll(){let e=si.empty();try{for(;;)e.writeByte(this.readByte()&255)}catch(t){if(!(t instanceof uu))throw t}return e.toArray()}}hu.ByteSize=8;class ZR{constructor(){this.fileName="",this.fileSize=0,this.data=null}}class F0{constructor(){this.files=[],this.files=[],this.fileFilter=e=>!0}load(e){let t=new hu(e);this.readBlock(t)}readHeader(e){return this.getString(e.readBytes(4),0,4)}decompress(e,t=!1){let s=si.empty(),r,n=this.getInteger(e.readBytes(4),0);try{for(;s.length<n;)if(e.readBits(1)===1){let c=e.readBits(4),d=e.readBitsReversed(c),f=e.readBitsReversed(c),p=s.length-d,g=Math.min(d,f);r=s.getBuffer(),s.write(r,p,g)}else{let c=e.readBitsReversed(2);for(let d=0;d<c;d++)s.writeByte(e.readByte())}}catch(h){if(!(h instanceof uu))throw h}r=s.getBuffer();let a=t?4:0,o=s.length-a,l=new Uint8Array(o),u=o;return l.set(r.subarray(a,a+u),0),l}readBlock(e){let t=this.readHeader(e);if(t==="BCFZ")this.readUncompressedBlock(this.decompress(e,!0));else if(t==="BCFS")this.readUncompressedBlock(e.readAll());else throw new yt("Unsupported format")}readUncompressedBlock(e){let t=4096,s=t;for(;s+3<e.length;){if(this.getInteger(e,s)===2){let n=new ZR;n.fileName=this.getString(e,s+4,127),n.fileSize=this.getInteger(e,s+140);let a=!this.fileFilter||this.fileFilter(n.fileName);a&&this.files.push(n);let o=s+148,l=0,u=0,h=a?si.withCapacity(n.fileSize):null;for(;l=this.getInteger(e,o+4*u++),l!==0;)s=l*t,a&&h.write(e,s,t);if(a){n.data=new Uint8Array(Math.min(n.fileSize,h.length));let c=h.toArray();n.data.set(c.subarray(0,0+n.data.length),0)}}s+=t}}getString(e,t,s){let r="";for(let n=0;n<s;n++){let a=e[t+n]&255;if(a===0)break;r+=String.fromCharCode(a)}return r}getInteger(e,t){return e[t+3]<<24|e[t+2]<<16|e[t+1]<<8|e[t]}}F0.HeaderBcFs="BCFS";F0.HeaderBcFz="BCFZ";class eO extends Qo{get name(){return"Guitar Pro 6"}constructor(){super()}readScore(){I.debug(this.name,"Loading GPX filesystem");let e=new F0;e.fileFilter=u=>u.endsWith("score.gpif")||u.endsWith("BinaryStylesheet")||u.endsWith("PartConfiguration")||u.endsWith("LayoutConfiguration"),e.load(this.data),I.debug(this.name,"GPX filesystem loaded");let t=null,s=null,r=null,n=null;for(let u of e.files)switch(u.fileName){case"score.gpif":t=L.toString(u.data,this.settings.importer.encoding);break;case"BinaryStylesheet":s=u.data;break;case"PartConfiguration":r=u.data;break;case"LayoutConfiguration":n=u.data;break}if(!t)throw new yt("No score.gpif found in GPX");I.debug(this.name,"Start Parsing score.gpif");let a=new js;a.parseXml(t,this.settings),I.debug(this.name,"score.gpif parsed");let o=a.score;s&&(I.debug(this.name,"Start Parsing BinaryStylesheet"),new Fd(s).apply(o),I.debug(this.name,"BinaryStylesheet parsed"));let l=null;return r&&(I.debug(this.name,"Start Parsing Part Configuration"),l=new k_(r),l.apply(o),I.debug(this.name,"Part Configuration parsed")),n&&l!=null&&(I.debug(this.name,"Start Parsing Layout Configuration"),new x_(l,n).apply(o),I.debug(this.name,"Layout Configuration parsed")),o}}class tO extends Qo{get name(){return"MusicXML"}constructor(){super(),this._currentPartGroup=null,this._trackFirstMeasureNumber=0,this._maxVoices=0,this._currentDirection=null,this._currentChord=null,this._divisionsPerQuarterNote=0,this._voiceOfStaff=new Map,this._isBeamContinue=!1,this._previousBeatWasPulled=!1,this._previousBeat=null}readScore(){this._trackById=new Map,this._partGroups=new Map,this._tieStarts=[],this._tieStartIds=new Map,this._slurStarts=new Map;let e=this.extractMusicXml(),t=new Ac;try{t.parse(e)}catch{throw new yt("Unsupported format")}return this._score=new Fa,this._score.tempo=120,this.parseDom(t),this.settings.importer.mergePartGroupsInMusicXml&&this.mergePartGroups(),this._score.finish(this.settings),this._score.rebuildRepeatGroups(),this._score}extractMusicXml(){const e=new O0(this.data);let t;try{t=e.read()}catch{t=[]}if(t.length===0)return this.data.reset(),L.toString(this.data.readAll(),this.settings.importer.encoding);const s=t.find(u=>u.fullName==="META-INF/container.xml");if(!s)throw new yt("No compressed MusicXML");const r=new Ac;try{r.parse(L.toString(s.data,this.settings.importer.encoding))}catch(u){throw new yt("Malformed container.xml, could not parse as XML",u)}let n=r.firstElement;if(!n||n.localName!=="container")throw new yt("Malformed container.xml, root element not 'container'");const a=n.findChildElement("rootfiles");if(!a)throw new yt("Malformed container.xml, 'container/rootfiles' not found");let o="";for(const u of a.childNodes)if(u.nodeType==O.Element&&u.localName==="rootfile"){o=u.getAttribute("full-path");break}if(!o)throw new yt("Unsupported compressed MusicXML, missing rootfile");const l=t.find(u=>u.fullName===o);if(!l)throw new yt(`Malformed container.xml, '${o}' not contained in zip`);return L.toString(l.data,this.settings.importer.encoding)}mergePartGroups(){let e=!1;for(const t of this._partGroups.values())t.length>1&&(this.mergeGroup(t),e=!0);if(e)for(let t=0;t<this._score.tracks.length;t++)this._score.tracks[t].index=t}mergeGroup(e){let t=e[0];for(let s=1;s<e.length;s++){let r=e[s];for(let a of r.staves)t.addStaff(a);let n=this._score.tracks.indexOf(r);this._score.tracks.splice(n,1)}}parseDom(e){let t=e.firstElement;if(!t)throw new yt("Unsupported format");switch(t.localName){case"score-partwise":this.parsePartwise(t);break;case"score-timewise":break;default:throw new yt("Unsupported format")}}parsePartwise(e){for(let t of e.childNodes)if(t.nodeType===O.Element)switch(t.localName){case"work":this.parseWork(t);break;case"movement-title":this._score.title=t.innerText;break;case"identification":this.parseIdentification(t);break;case"part-list":this.parsePartList(t);break;case"part":this.parsePart(t);break}}parseWork(e){for(let t of e.childNodes)if(t.nodeType===O.Element)switch(t.localName){case"work-title":this._score.title=t.innerText;break}}parsePart(e){let t=e.getAttribute("id");if(!this._trackById.has(t))if(this._trackById.size===1){for(const[n,a]of this._trackById)(a.staves.length===0||a.staves[0].bars.length===0)&&(t=n);if(!this._trackById.has(t))return}else return;let s=this._trackById.get(t),r=!0;this._maxVoices=0;for(let n of e.childNodes)if(n.nodeType===O.Element)switch(n.localName){case"measure":this.parseMeasure(n,s,r)&&(r=!1);break}for(let n of s.staves)for(let a of n.bars)this.ensureVoices(a)}parseMeasure(e,t,s){if(e.getAttribute("implicit")==="yes"&&e.getElementsByTagName("note",!1).length===0)return!1;let r=0;if(s)this._divisionsPerQuarterNote=0,this._trackFirstMeasureNumber=parseInt(e.getAttribute("number")),this._trackFirstMeasureNumber||(this._trackFirstMeasureNumber=0),r=0;else{if(r=parseInt(e.getAttribute("number")),!r)return!1;r-=this._trackFirstMeasureNumber}if(s){let l=e.getElementsByTagName("attributes",!1);if(l.length>0){let u=l[0].getElementsByTagName("staves",!1);if(u.length>0){let h=parseInt(u[0].innerText);t.ensureStaveCount(h)}}}let n=new Array(t.staves.length),a=null;for(let l=t.staves[0].bars.length;l<=r;l++)for(let u=0;u<t.staves.length;u++){let h=new Sn;if(n[u]=h,t.staves[u].bars.length>0){let c=t.staves[u].bars[t.staves[u].bars.length-1];h.clef=c.clef}a=this.getOrCreateMasterBar(r),t.staves[u].addBar(h),this.ensureVoices(h)}let o=new Map;if(a){let l=!1;for(let u of e.childNodes)if(u.nodeType===O.Element)switch(u.localName){case"note":this.parseNoteBeat(u,n);break;case"forward":this.parseForward(u,n);break;case"direction":this.parseDirection(u,a);break;case"attributes":l||(this.parseAttributes(u,n,a,t),l=!0);break;case"harmony":this.parseHarmony(u,t,o);break;case"sound":break;case"barline":this.parseBarline(u,a);break}}return!0}ensureVoices(e){for(;e.voices.length<this._maxVoices;){let t=new Wr;e.addVoice(t);let s=new xi;s.isEmpty=!0,s.chordId=this._currentChord,t.addBeat(s)}}getOrCreateBeat(e,t,s){let r=0,n=e.getElementsByTagName("voice",!1);n.length>0&&(r=parseInt(n[0].innerText)-1);let a=this._previousBeatWasPulled;this._previousBeatWasPulled=!1;let o=e.getElementsByTagName("staff",!1),l=1;if(o.length>0){l=parseInt(o[0].innerText),(this._isBeamContinue||a)&&this._previousBeat.voice.bar.staff.index!==l-1&&(l=this._previousBeat.voice.bar.staff.index+1,this._previousBeatWasPulled=!0);let d=t[0].staff.track.index+"-"+l;this._voiceOfStaff.has(d)||this._voiceOfStaff.set(d,r)}l--;let u;l<0?u=t[0]:l>=t.length?u=t[t.length-1]:u=t[l];let h,c=this.getOrCreateVoice(u,r);return s&&c.beats.length>0||c.beats.length===1&&c.isEmpty?h=c.beats[c.beats.length-1]:(h=new xi,h.isEmpty=!1,c.addBeat(h)),this._isBeamContinue=!1,this._previousBeat=h,h}parseForward(e,t){let s=this.getOrCreateBeat(e,t,!1),n=parseInt(e.findChildElement("duration").innerText)*N.Quarter/this._divisionsPerQuarterNote,a=[N.SixtyFourth,N.ThirtySecond,N.Sixteenth,N.Eighth,N.Quarter,N.Half,N.Whole];for(let o of a)if(n>=o){s.duration=o,n-=o;break}s.isEmpty=!1}parseStaffDetails(e,t){for(let s of e.childNodes)if(s.nodeType===O.Element)switch(s.localName){case"staff-lines":for(let r of t.staves)r.stringTuning.tunings=new Array(parseInt(s.innerText)).fill(0);break;case"staff-tuning":this.parseStaffTuning(s,t);break}for(let s of t.staves)this.isEmptyTuning(s.tuning)&&(s.stringTuning.tunings=[])}parseStaffTuning(e,t){let s=parseInt(e.getAttribute("line")),r="C",n="",a=0;for(let l of e.childNodes)if(l.nodeType===O.Element)switch(l.localName){case"tuning-step":r=l.innerText;break;case"tuning-alter":a=parseInt(l.innerText);break;case"tuning-octave":n=l.innerText;break}let o=et.getTuningForText(r+n)+a;for(let l of t.staves)l.tuning[l.tuning.length-s]=o}parseHarmony(e,t,s){let r=new Qn;for(let a of e.childNodes)if(a.nodeType===O.Element)switch(a.localName){case"root":r.name=this.parseHarmonyRoot(a);break;case"kind":r.name=r.name+this.parseHarmonyKind(a);break;case"frame":this.parseHarmonyFrame(a,r);break}this._currentChord=et.newGuid();const n=r.uniqueId;s.has(n)&&(r.showDiagram=!1);for(let a of t.staves)a.addChord(this._currentChord,r);s.set(n,r)}parseHarmonyRoot(e){let t="",s="";for(let r of e.childNodes)if(r.nodeType===O.Element)switch(r.localName){case"root-step":t=r.innerText;break;case"root-alter":switch(parseInt(e.innerText)){case-2:s="bb";break;case-1:s="b";break;case 0:s="";break;case 1:s="#";break;case 2:s="##";break}break}return t+s}parseHarmonyKind(e){const t=e.getAttribute("text");let s="";if(t)s=t;else switch(e.innerText){case"major":s="";break;case"minor":s="m";break;case"augmented":s="+";break;case"diminished":s="○";break;case"dominant":s="7";break;case"major-seventh":s="7M";break;case"minor-seventh":s="m7";break;case"diminished-seventh":s="○7";break;case"augmented-seventh":s="+7";break;case"half-diminished":s="⍉";break;case"major-minor":s="mMaj";break;case"major-sixth":s="maj6";break;case"minor-sixth":s="m6";break;case"dominant-ninth":s="9";break;case"major-ninth":s="maj9";break;case"minor-ninth":s="m9";break;case"dominant-11th":s="11";break;case"major-11th":s="maj11";break;case"minor-11th":s="m11";break;case"dominant-13th":s="13";break;case"major-13th":s="maj13";break;case"minor-13th":s="m13";break;case"suspended-second":s="sus2";break;case"suspended-fourth":s="sus4";break}return s}parseHarmonyFrame(e,t){for(let s of e.childNodes)if(s.nodeType===O.Element)switch(s.localName){case"frame-strings":const r=parseInt(s.innerText);t.strings=new Array(r);for(let o=0;o<r;o++)t.strings[o]=-1;break;case"first-fret":t.firstFret=parseInt(s.innerText);break;case"frame-note":let n=null,a=null;for(let o of s.childNodes)switch(o.localName){case"string":n=parseInt(o.innerText);break;case"fret":a=parseInt(o.innerText),n&&a>=0&&(t.strings[n-1]=a);break;case"barre":n&&a&&o.getAttribute("type")==="start"&&t.barreFrets.push(a);break}break}}parseBarline(e,t){for(let s of e.childNodes)if(s.nodeType===O.Element)switch(s.localName){case"repeat":this.parseRepeat(s,t);break;case"ending":this.parseEnding(s,t);break}}parseEnding(e,t){let s=parseInt(e.getAttribute("number"));s>0&&(--s,t.alternateEndings=t.alternateEndings|1<<s&255)}parseRepeat(e,t){let s=e.getAttribute("direction"),r=parseInt(e.getAttribute("times"));(r<0||isNaN(r))&&(r=2),s==="backward"?t.repeatCount=r:s==="forward"&&(t.isRepeatStart=!0)}parseNoteBeat(e,t){let s=e.getElementsByTagName("chord",!1).length>0,r=this.getOrCreateBeat(e,t,s);!r.chordId&&this._currentChord&&(r.chordId=this._currentChord,this._currentChord=null),this._currentDirection&&(r.text=this._currentDirection,this._currentDirection=null);let n=new Ss;r.voice.isEmpty=!1,r.isEmpty=!1,r.addNote(n),r.dots=0;let a=!1;for(let o of e.childNodes)if(o.nodeType===O.Element)switch(o.localName){case"grace":r.graceType=he.BeforeBeat,r.duration=N.ThirtySecond;break;case"duration":if(r.isRest&&!a)switch(parseInt(o.innerText)){case 1:r.duration=N.Whole;break;case 2:r.duration=N.Half;break;case 4:r.duration=N.Quarter;break;case 8:r.duration=N.Eighth;break;case 16:r.duration=N.Sixteenth;break;case 32:r.duration=N.ThirtySecond;break;case 64:r.duration=N.SixtyFourth;break;default:r.duration=N.Quarter;break}break;case"tie":this.parseTied(o,n);break;case"cue":break;case"instrument":break;case"type":r.duration=this.getDuration(o.innerText),r.graceType!==he.None&&r.duration<N.Sixteenth&&(r.duration=N.Eighth);break;case"dot":r.dots++;break;case"accidental":this.parseAccidental(o,n);break;case"time-modification":this.parseTimeModification(o,r);break;case"stem":break;case"notehead":o.getAttribute("parentheses")==="yes"&&(n.isGhost=!0);break;case"beam":o.innerText==="continue"&&(this._isBeamContinue=!0);break;case"notations":this.parseNotations(o,r,n);break;case"lyric":this.parseLyric(o,r);break;case"pitch":this.parsePitch(o,n);break;case"unpitched":this.parseUnpitched(o,n);break;case"rest":a=o.getAttribute("measure")==="yes",r.isEmpty=!1,r.notes=[],r.duration=N.Whole;break}if(n.isStringed){for(let o=0;o<r.notes.length;o++)if(r.notes[o].string===n.string&&r.notes[o]!==n){r.removeNote(n);break}}}getDuration(e){switch(e){case"256th":case"128th":case"64th":return N.SixtyFourth;case"32nd":return N.ThirtySecond;case"16th":return N.Sixteenth;case"eighth":return N.Eighth;case"quarter":return N.Quarter;case"half":return N.Half;case"long":case"breve":case"whole":return N.Whole}return N.Quarter}parseLyric(e,t){for(let s of e.childNodes)if(s.nodeType===O.Element)switch(s.localName){case"text":t.text?t.text+=" "+s.innerText:t.text=s.innerText;break}}parseAccidental(e,t){switch(e.innerText){case"sharp":t.accidentalMode=At.ForceSharp;break;case"natural":t.accidentalMode=At.ForceNatural;break;case"flat":t.accidentalMode=At.ForceFlat;break}}parseTied(e,t){if(e.getAttribute("type")==="start")this._tieStartIds.has(t.id)||(this._tieStartIds.set(t.id,!0),this._tieStarts.push(t));else if(e.getAttribute("type")==="stop"&&this._tieStarts.length>0&&!t.isTieDestination){const s=this._tieStarts[0];s.beat.voice.index===t.beat.voice.index&&s.beat.voice.bar.staff.index===t.beat.voice.bar.staff.index&&s.beat.voice.bar.staff.track.index===t.beat.voice.bar.staff.track.index&&(t.isTieDestination=!0,t.tieOrigin=this._tieStarts[0]),this._tieStarts.splice(0,1),this._tieStartIds.delete(t.id)}}parseNotations(e,t,s){for(let r of e.childNodes)if(r.nodeType===O.Element)switch(r.localName){case"articulations":this.parseArticulations(r,s);break;case"tied":this.parseTied(r,s);break;case"slide":case"glissando":r.getAttribute("type")==="start"&&(s.slideOutType=xe.Shift);break;case"dynamics":this.parseDynamics(r,t);break;case"technical":this.parseTechnical(r,s);break;case"ornaments":this.parseOrnaments(r,s);break;case"slur":let n=r.getAttribute("number");switch(n||(n="1"),n=t.voice.bar.staff.index+"_"+n,r.getAttribute("type")){case"start":this._slurStarts.set(n,s);break;case"stop":if(this._slurStarts.has(n)){s.isSlurDestination=!0;let a=this._slurStarts.get(n);a.slurDestination=s,s.slurOrigin=a}break}break}}parseOrnaments(e,t){for(let s of e.childNodes)if(s.nodeType===O.Element)switch(s.localName){case"tremolo":switch(parseInt(s.innerText)){case 1:t.beat.tremoloSpeed=N.Eighth;break;case 2:t.beat.tremoloSpeed=N.Sixteenth;break;case 3:t.beat.tremoloSpeed=N.ThirtySecond;break}break}}parseTechnical(e,t){let s=[];for(let r of e.childNodes)if(r.nodeType===O.Element)switch(r.localName){case"string":t.string=parseInt(r.innerText),t.string!==-2147483648&&(t.string=t.beat.voice.bar.staff.tuning.length-t.string+1);break;case"fret":t.fret=parseInt(r.innerText);break;case"down-bow":t.beat.pickStroke=fi.Down;break;case"up-bow":t.beat.pickStroke=fi.Up;break;case"bend":s.push(r);break}s.length>0&&this.parseBends(s,t),(t.string===-2147483648||t.fret===-2147483648)&&(t.string=-1,t.fret=-1)}parseBends(e,t){let s=G.MaxPosition/e.length,r=0,n=0,a=!0;for(let o of e){let l=o.findChildElement("bend-alter");if(l){let u=Math.round(Math.abs(parseFloat(l.innerText))*2);o.findChildElement("pre-bend")?a?(r+=u,t.addBendPoint(new G(n,r)),n+=s,t.addBendPoint(new G(n,r)),a=!1):n+=s:o.findChildElement("release")?(a&&(r+=u),t.addBendPoint(new G(n,r)),n+=s,r-=u,t.addBendPoint(new G(n,r)),a=!1):(t.addBendPoint(new G(n,r)),r+=u,n+=s,t.addBendPoint(new G(n,r)),a=!1)}}}parseArticulations(e,t){for(let s of e.childNodes)switch(s.localName){case"accent":t.accentuated=_t.Normal;break;case"strong-accent":t.accentuated=_t.Heavy;break;case"staccato":case"detached-legato":t.isStaccato=!0;break;case"tenuto":t.accentuated=_t.Tenuto;break}}parseDynamics(e,t){for(let s of e.childNodes)if(s.nodeType===O.Element)switch(s.localName){case"p":t.dynamics=Me.P;break;case"pp":t.dynamics=Me.PP;break;case"ppp":t.dynamics=Me.PPP;break;case"f":t.dynamics=Me.F;break;case"ff":t.dynamics=Me.FF;break;case"fff":t.dynamics=Me.FFF;break;case"mp":t.dynamics=Me.MP;break;case"mf":t.dynamics=Me.MF;break}}parseTimeModification(e,t){for(let s of e.childNodes)if(s.nodeType===O.Element)switch(s.localName){case"actual-notes":t.tupletNumerator=parseInt(s.innerText);break;case"normal-notes":t.tupletDenominator=parseInt(s.innerText);break}}parseUnpitched(e,t){let s="",r=0,n=0;for(let o of e.childNodes)if(o.nodeType===O.Element)switch(o.localName){case"display-step":s=o.innerText;break;case"display-alter":r=parseInt(o.innerText);break;case"display-octave":n=parseInt(o.innerText);break}let a=n*12+et.getToneForText(s)+r;t.octave=a/12|0,t.tone=a-t.octave*12}parsePitch(e,t){let s="",r=0,n=0;for(let o of e.childNodes)if(o.nodeType===O.Element)switch(o.localName){case"step":s=o.innerText;break;case"alter":r=parseFloat(o.innerText),isNaN(r)&&(r=0);break;case"octave":n=parseInt(o.innerText)+1;break}let a=n*12+et.getToneForText(s)+(r|0);t.octave=a/12|0,t.tone=a-t.octave*12}getOrCreateVoice(e,t){if(t<e.voices.length)return e.voices[t];for(let s=e.voices.length;s<=t;s++)e.addVoice(new Wr);return this._maxVoices=Math.max(this._maxVoices,e.voices.length),e.voices[t]}parseDirection(e,t){for(let s of e.childNodes)if(s.nodeType===O.Element)switch(s.localName){case"sound":let r=s.getAttribute("tempo");if(r){let a=new vi;a.isLinear=!0,a.type=jt.Tempo,a.value=parseInt(r),t.tempoAutomations.push(a),t.index===0&&(t.score.tempo=a.value)}break;case"direction-type":let n=s.firstElement;switch(n.localName){case"words":this._currentDirection=n.innerText;break;case"metronome":this.parseMetronome(n,t);break}break}}parseMetronome(e,t){let s=N.Quarter,r=120;for(let a of e.childNodes)if(a.nodeType===O.Element)switch(a.localName){case"beat-unit":s=this.getDuration(a.innerText);break;case"per-minute":r=parseInt(a.innerText);break}let n=new vi;n.type=jt.Tempo,n.value=r*(s/4)|0,this.hasSameTempo(t,n)||(t.tempoAutomations.push(n),t.index===0&&(t.score.tempo=n.value))}hasSameTempo(e,t){for(const s of e.tempoAutomations)if(t.ratioPosition===s.ratioPosition&&t.value==s.value)return!0;return!1}parseAttributes(e,t,s,r){let n=0,a=!1;for(let o of e.childNodes)if(o.nodeType===O.Element)switch(o.localName){case"divisions":this._divisionsPerQuarterNote=parseInt(o.innerText);break;case"key":this.parseKey(o,s);break;case"time":this.parseTime(o,s),a=!0;break;case"clef":n=parseInt(o.getAttribute("number")),isNaN(n)&&(n=1),this.parseClef(o,t[n-1]);break;case"staff-details":this.parseStaffDetails(o,r);break;case"transpose":this.parseTranspose(o,r);break}a||(s.timeSignatureCommon=!0)}parseTranspose(e,t){let s=0;for(let r of e.childNodes)if(r.nodeType===O.Element)switch(r.localName){case"chromatic":s+=parseInt(r.innerText);break;case"octave-change":s+=parseInt(r.innerText)*12;break}for(let r of t.staves)r.transpositionPitch=s}parseClef(e,t){let s="s",r=0;for(let n of e.childNodes)if(n.nodeType===O.Element)switch(n.localName){case"sign":s=n.innerText.toLowerCase();break;case"line":r=parseInt(n.innerText);break;case"clef-octave-change":switch(parseInt(n.innerText)){case-2:t.clefOttava=Ue._15mb;break;case-1:t.clefOttava=Ue._8vb;break;case 1:t.clefOttava=Ue._8va;break;case 2:t.clefOttava=Ue._15mb;break}break}switch(s){case"g":t.clef=ve.G2;break;case"f":t.clef=ve.F4;break;case"c":r===3?t.clef=ve.C3:t.clef=ve.C4;break;case"percussion":t.clef=ve.Neutral,t.staff.isPercussion=!0;break;case"tab":t.clef=ve.G2,t.staff.showTablature=!0;break;default:t.clef=ve.G2;break}}parseTime(e,t){e.getAttribute("symbol")==="common"&&(t.timeSignatureCommon=!0);let s=!1,r=!1;for(let n of e.childNodes)if(n.nodeType===O.Element){let a=n.innerText;switch(n.localName){case"beats":s||(a.indexOf("+")===-1?t.timeSignatureNumerator=parseInt(a):t.timeSignatureNumerator=4,s=!0);break;case"beat-type":r||(a.indexOf("+")===-1?t.timeSignatureDenominator=parseInt(a):t.timeSignatureDenominator=4,r=!0);break}}}parseKey(e,t){let s=-2147483648,r="";for(let n of e.childNodes)if(n.nodeType===O.Element)switch(n.localName){case"fifths":s=parseInt(n.innerText);break;case"key-step":break;case"key-alter":break;case"mode":r=n.innerText;break}-7<=s&&s<=7?t.keySignature=s:t.keySignature=Le.C,r==="minor"?t.keySignatureType=wr.Minor:t.keySignatureType=wr.Major}getOrCreateMasterBar(e){if(e<this._score.masterBars.length)return this._score.masterBars[e];for(let t=this._score.masterBars.length;t<=e;t++){let s=new gn;if(this._score.masterBars.length>0){let r=this._score.masterBars[this._score.masterBars.length-1];s.timeSignatureDenominator=r.timeSignatureDenominator,s.timeSignatureNumerator=r.timeSignatureNumerator,s.keySignature=r.keySignature,s.keySignatureType=r.keySignatureType}this._score.addMasterBar(s)}return this._score.masterBars[e]}parseIdentification(e){for(let t of e.childNodes)if(t.nodeType===O.Element)switch(t.localName){case"creator":t.getAttribute("type")==="composer"&&(this._score.music=t.innerText);break;case"rights":this._score.copyright&&(this._score.copyright+=`
`),this._score.copyright+=t.innerText;break}}parsePartList(e){for(let t of e.childNodes)if(t.nodeType===O.Element)switch(t.localName){case"part-group":this.parsePartGroup(t);break;case"score-part":this.parseScorePart(t);break}}parsePartGroup(e){switch(e.getAttribute("type")){case"start":this._currentPartGroup=e.getAttribute("number"),this._partGroups.set(this._currentPartGroup,[]);break;case"stop":this._currentPartGroup=null;break}}parseScorePart(e){let t=e.getAttribute("id"),s=new Va;s.ensureStaveCount(1);let r=s.staves[0];r.showStandardNotation=!0,this._trackById.set(t,s),this._score.addTrack(s),this._currentPartGroup&&this._partGroups.get(this._currentPartGroup).push(s);for(let n of e.childNodes)if(n.nodeType===O.Element)switch(n.localName){case"part-name":s.name=n.innerText;break;case"part-abbreviation":s.shortName=n.innerText;break;case"midi-instrument":this.parseMidiInstrument(n,s);break}this.isEmptyTuning(s.staves[0].tuning)&&(s.staves[0].stringTuning.tunings=[])}isEmptyTuning(e){if(!e)return!0;for(let t=0;t<e.length;t++)if(e[t]!==0)return!1;return!0}parseMidiInstrument(e,t){for(let s of e.childNodes)if(s.nodeType===O.Element)switch(s.localName){case"midi-channel":t.playbackInfo.primaryChannel=parseInt(s.innerText);break;case"midi-program":t.playbackInfo.program=parseInt(s.innerText);break;case"volume":t.playbackInfo.volume=Math.floor(parseInt(s.innerText)/100*16);break;case"pan":t.playbackInfo.balance=Math.max(0,Math.min(16,Math.floor((parseInt(s.innerText)+90)/180*16)));break}}}var Vo;(function(i){i[i.SingleTrackMultiChannel=0]="SingleTrackMultiChannel",i[i.MultiTrack=1]="MultiTrack"})(Vo||(Vo={}));class __{constructor(){this.events=[]}addEvent(e){if(this.events.length===0||e.tick>=this.events[this.events.length-1].tick)this.events.push(e);else{let t=this.events.length;for(;t>0&&this.events[t-1].tick>e.tick;)t--;this.events.splice(t,0,e)}}writeTo(e){let t=si.empty(),s=0;for(let a of this.events){let o=a.tick-s;Un.writeVariableInt(t,o),a.writeTo(t),s=a.tick}const r=new Uint8Array([77,84,114,107]);e.write(r,0,r.length);let n=t.toArray();L.writeInt32BE(e,n.length),e.write(n,0,n.length)}}class Un{constructor(){this.format=Vo.SingleTrackMultiChannel,this.division=ke.QuarterTime,this.tracks=[]}get events(){if(this.tracks.length==1)return this.tracks[0].events;{const e=[];for(const t of this.tracks)this.events.push(...t.events);return e.sort((t,s)=>t.tick-s.tick),e}}ensureTracks(e){for(;this.tracks.length<e;)this.tracks.push(new __)}addEvent(e){this.format==Vo.SingleTrackMultiChannel?(this.ensureTracks(1),this.tracks[0].addEvent(e)):(this.ensureTracks(e.track+1),this.tracks[e.track].addEvent(e))}toBinary(){let e=si.empty();return this.writeTo(e),e.toArray()}writeTo(e){let t=new Uint8Array([77,84,104,100]);e.write(t,0,t.length),L.writeInt32BE(e,6),L.writeInt16BE(e,this.format),L.writeInt16BE(e,this.tracks.length),L.writeInt16BE(e,this.division);for(const s of this.tracks)s.writeTo(e)}static writeVariableInt(e,t){let s=new Uint8Array(4),r=0;do s[r++]=t&127,t>>=7;while(t>0);for(;r>0;)r--,r>0?e.writeByte(s[r]|128):e.writeByte(s[r])}}var Fe;(function(i){i[i.TimeSignature=88]="TimeSignature",i[i.NoteOn=128]="NoteOn",i[i.NoteOff=144]="NoteOff",i[i.ControlChange=176]="ControlChange",i[i.ProgramChange=192]="ProgramChange",i[i.TempoChange=81]="TempoChange",i[i.PitchBend=224]="PitchBend",i[i.PerNotePitchBend=96]="PerNotePitchBend",i[i.EndOfTrack=47]="EndOfTrack",i[i.AlphaTabRest=241]="AlphaTabRest",i[i.AlphaTabMetronome=242]="AlphaTabMetronome",i[i.SystemExclusive=240]="SystemExclusive",i[i.SystemExclusive2=247]="SystemExclusive2",i[i.Meta=255]="Meta"})(Fe||(Fe={}));class wn{constructor(e,t,s){this.track=e,this.tick=t,this.type=s}get command(){return this.type}get message(){return 0}get data1(){return 0}get data2(){return 0}}class T_ extends wn{constructor(e,t,s,r,n,a){super(e,t,Fe.TimeSignature),this.track=e,this.tick=t,this.numerator=s,this.denominatorIndex=r,this.midiClocksPerMetronomeClick=n,this.thirtySecondNodesInQuarter=a}writeTo(e){e.writeByte(255),e.writeByte(88),Un.writeVariableInt(e,4),e.writeByte(this.numerator&255),e.writeByte(this.denominatorIndex&255),e.writeByte(this.midiClocksPerMetronomeClick&255),e.writeByte(this.thirtySecondNodesInQuarter&255)}}class mn extends wn{constructor(e,t,s){super(e,t,s)}writeTo(e){e.writeByte(240);const t=si.withCapacity(16);t.writeByte(mn.AlphaTabManufacturerId),this.writeEventData(t),t.writeByte(247),Un.writeVariableInt(e,t.length),t.copyTo(e)}}mn.AlphaTabManufacturerId=125;mn.MetronomeEventId=0;mn.RestEventId=1;class N_ extends mn{constructor(e,t,s,r,n){super(e,t,Fe.AlphaTabMetronome),this.isMetronome=!0,this.metronomeNumerator=s,this.metronomeDurationInMilliseconds=n,this.metronomeDurationInTicks=r}writeEventData(e){e.writeByte(mn.MetronomeEventId),e.writeByte(this.metronomeNumerator),L.writeInt32LE(e,this.metronomeDurationInTicks),L.writeInt32LE(e,this.metronomeDurationInMilliseconds)}}class B_ extends mn{constructor(e,t,s){super(e,t,Fe.AlphaTabRest),this.channel=s}writeEventData(e){e.writeByte(mn.RestEventId),e.writeByte(this.channel)}}class C_ extends wn{constructor(e,t,s,r,n,a){super(e,t,s),this.channel=r,this.noteKey=n,this.noteVelocity=a}get data1(){return this.noteKey}get data2(){return this.noteVelocity}}class P_ extends C_{constructor(e,t,s,r,n){super(e,t,Fe.NoteOn,s,r,n)}writeTo(e){e.writeByte(this.channel&15|144),e.writeByte(this.noteKey&255),e.writeByte(this.noteVelocity&255)}}class M_ extends C_{constructor(e,t,s,r,n){super(e,t,Fe.NoteOff,s,r,n)}writeTo(e){e.writeByte(this.channel&15|128),e.writeByte(this.noteKey&255),e.writeByte(this.noteVelocity&255)}}class E_ extends wn{constructor(e,t,s,r,n){super(e,t,Fe.ControlChange),this.channel=s,this.controller=r,this.value=n}writeTo(e){e.writeByte(this.channel&15|176),e.writeByte(this.controller&255),e.writeByte(this.value&255)}get data1(){return this.controller}get data2(){return this.value}}class L_ extends wn{constructor(e,t,s,r){super(e,t,Fe.ProgramChange),this.channel=s,this.program=r}writeTo(e){e.writeByte(this.channel&15|192),e.writeByte(this.program&255)}get data1(){return this.program}}class D_ extends wn{constructor(e,t){super(0,e,Fe.TempoChange),this.microSecondsPerQuarterNote=t}writeTo(e){e.writeByte(255),e.writeByte(81),e.writeByte(3),e.writeByte(this.microSecondsPerQuarterNote>>16&255),e.writeByte(this.microSecondsPerQuarterNote>>8&255),e.writeByte(this.microSecondsPerQuarterNote&255)}}class A_ extends wn{constructor(e,t,s,r){super(e,t,Fe.PitchBend),this.channel=s,this.value=r}writeTo(e){e.writeByte(this.channel&15|224),e.writeByte(this.value&127),e.writeByte(this.value>>7&127)}get data1(){return this.value&127}get data2(){return this.value>>7&127}}class I_ extends wn{constructor(e,t,s,r,n){super(e,t,Fe.PerNotePitchBend),this.channel=s,this.noteKey=r,this.value=n}writeTo(e){throw new ni(ri.General,"Note Bend (Midi2.0) events cannot be exported to SMF1.0")}}class R_ extends wn{constructor(e,t){super(e,t,Fe.EndOfTrack)}writeTo(e){e.writeByte(255),e.writeByte(47),e.writeByte(0)}}class El{constructor(e,t){this.time=0,this.eventIndex=e,this.event=t,this.isMetronome=this.event.type==Fe.AlphaTabMetronome}static newMetronomeEvent(e,t,s,r,n){const a=new N_(0,t,s,r,n);return new El(e,a)}}class Ne{}Ne.DefaultChannelCount=17;Ne.MetronomeChannel=Ne.DefaultChannelCount-1;Ne.AudioChannels=2;Ne.MinVolume=0;Ne.MinProgram=0;Ne.MaxProgram=127;Ne.MinPlaybackSpeed=.125;Ne.MaxPlaybackSpeed=8;Ne.MaxPitchWheel=16384;Ne.MaxPitchWheel20=4294967296;Ne.DefaultPitchWheel=Ne.MaxPitchWheel/2;Ne.MicroBufferCount=32;Ne.MicroBufferSize=64;class Vb{constructor(e,t,s){this.bpm=e,this.ticks=t,this.time=s}}class Wf{constructor(){this.tempoChanges=[],this.firstProgramEventPerChannel=new Map,this.firstTimeSignatureNumerator=0,this.firstTimeSignatureDenominator=0,this.synthData=[],this.division=ke.QuarterTime,this.eventIndex=0,this.currentTime=0,this.playbackRange=null,this.playbackRangeStartTime=0,this.playbackRangeEndTime=0,this.endTick=0,this.endTime=0}}class iO{get isPlayingMain(){return this._currentState==this._mainState}get isPlayingOneTimeMidi(){return this._currentState==this._oneTimeState}get isPlayingCountIn(){return this._currentState==this._countInState}constructor(e){this._oneTimeState=null,this._countInState=null,this.isLooping=!1,this.playbackSpeed=1,this._synthesizer=e,this._mainState=new Wf,this._currentState=this._mainState}get mainPlaybackRange(){return this._mainState.playbackRange}set mainPlaybackRange(e){this._mainState.playbackRange=e,e&&(this._mainState.playbackRangeStartTime=this.tickPositionToTimePositionWithSpeed(this._mainState,e.startTick,1),this._mainState.playbackRangeEndTime=this.tickPositionToTimePositionWithSpeed(this._mainState,e.endTick,1))}get currentTime(){return this._currentState.currentTime/this.playbackSpeed}get currentEndTick(){return this._currentState.endTick}get currentEndTime(){return this._currentState.endTime/this.playbackSpeed}mainSeek(e){if(e*=this.playbackSpeed,this.mainPlaybackRange&&(e<this._mainState.playbackRangeStartTime?e=this._mainState.playbackRangeStartTime:e>this._mainState.playbackRangeEndTime&&(e=this._mainState.playbackRangeEndTime)),e>this._mainState.currentTime)this.mainSilentProcess(e-this._mainState.currentTime);else if(e<this._mainState.currentTime){if(this._mainState.currentTime=0,this._mainState.eventIndex=0,this.isPlayingMain){let t=this._synthesizer.metronomeVolume;this._synthesizer.noteOffAll(!0),this._synthesizer.resetSoft(),this._synthesizer.setupMetronomeChannel(t)}this.mainSilentProcess(e)}}mainSilentProcess(e){if(e<=0)return;let t=Date.now(),s=this._mainState.currentTime+e;if(this.isPlayingMain)for(;this._mainState.currentTime<s;)this.fillMidiEventQueueLimited(s-this._mainState.currentTime)&&this._synthesizer.synthesizeSilent(Ne.MicroBufferSize);this._mainState.currentTime=s;let r=Date.now()-t;I.debug("Sequencer","Silent seek finished in "+r+"ms (main)")}loadOneTimeMidi(e){this._oneTimeState=this.createStateFromFile(e),this._currentState=this._oneTimeState}loadMidi(e){this._mainState=this.createStateFromFile(e),this._currentState=this._mainState}createStateFromFile(e){const t=new Wf;t.tempoChanges=[],t.division=e.division,t.eventIndex=0,t.currentTime=0,t.synthData=[];let s=120,r=0,n=0,a=0,o=0,l=0,u=0,h=0,c=0;for(let d of e.events){let f=new El(t.synthData.length,d);t.synthData.push(f);let p=d.tick-c;if(r+=p,n+=p*(6e4/(s*e.division)),f.time=n,c=d.tick,o>0)for(;u<r;){let g=El.newMetronomeEvent(t.synthData.length,u,Math.floor(u/o)%a,o,l);t.synthData.push(g),g.time=h,u+=o,h+=l}if(d.type===Fe.TempoChange)s=6e7/d.microSecondsPerQuarterNote,t.tempoChanges.push(new Vb(s,r,n)),l=o*(6e4/(s*e.division));else if(d.type===Fe.TimeSignature){let g=d,b=Math.pow(2,g.denominatorIndex);a=g.numerator,o=t.division*(4/b)|0,l=o*(6e4/(s*e.division)),t.firstTimeSignatureDenominator===0&&(t.firstTimeSignatureNumerator=g.numerator,t.firstTimeSignatureDenominator=b)}else if(d.type===Fe.ProgramChange){let g=d.channel;t.firstProgramEventPerChannel.has(g)||t.firstProgramEventPerChannel.set(g,f)}}return t.synthData.sort((d,f)=>d.time>f.time?1:d.time<f.time?-1:d.eventIndex-f.eventIndex),t.endTime=n,t.endTick=r,t}fillMidiEventQueue(){return this.fillMidiEventQueueLimited(-1)}fillMidiEventQueueLimited(e){let t=Ne.MicroBufferSize/this._synthesizer.outSampleRate*1e3*this.playbackSpeed,s=this.internalEndTime;e>0&&(e<t&&(t=e),s=Math.min(this.internalEndTime,this._currentState.currentTime+e));let r=!1;for(this._currentState.currentTime+=t;this._currentState.eventIndex<this._currentState.synthData.length&&this._currentState.synthData[this._currentState.eventIndex].time<this._currentState.currentTime&&this._currentState.currentTime<s;)this._synthesizer.dispatchEvent(this._currentState.synthData[this._currentState.eventIndex]),this._currentState.eventIndex++,r=!0;return r}mainTickPositionToTimePosition(e){return this.tickPositionToTimePositionWithSpeed(this._mainState,e,this.playbackSpeed)}mainTimePositionToTickPosition(e){return this.timePositionToTickPositionWithSpeed(this._mainState,e,this.playbackSpeed)}currentTimePositionToTickPosition(e){return this.timePositionToTickPositionWithSpeed(this._currentState,e,this.playbackSpeed)}tickPositionToTimePositionWithSpeed(e,t,s){let r=0,n=120,a=0;for(const o of e.tempoChanges){if(t<o.ticks)break;r=o.time,n=o.bpm,a=o.ticks}return t-=a,r+=t*(6e4/(n*e.division)),r/s}timePositionToTickPositionWithSpeed(e,t,s){t*=s;let r=0,n=120,a=0;for(const o of e.tempoChanges){if(t<o.time)break;r=o.ticks,n=o.bpm,a=o.time}return t-=a,r+=t/(6e4/(n*e.division))|0,r+1}get internalEndTime(){return this.isPlayingMain?this.mainPlaybackRange?this._currentState.playbackRangeEndTime:this._currentState.endTime:this._currentState.endTime}get isFinished(){return this._currentState.currentTime>=this.internalEndTime}stop(){this.isPlayingMain&&this.mainPlaybackRange?this._currentState.currentTime=this.mainPlaybackRange.startTick:this._currentState.currentTime=0,this._currentState.eventIndex=0}resetOneTimeMidi(){this._oneTimeState=null,this._currentState=this._mainState}resetCountIn(){this._countInState=null,this._currentState=this._mainState}startCountIn(){this.generateCountInMidi(),this._currentState=this._countInState,this.stop(),this._synthesizer.noteOffAll(!0)}generateCountInMidi(){const e=new Wf;e.division=this._mainState.division;let t=120,s=4,r=4;this._mainState.eventIndex===0?(t=this._mainState.tempoChanges[0].bpm,s=this._mainState.firstTimeSignatureNumerator,r=this._mainState.firstTimeSignatureDenominator):(t=this._synthesizer.currentTempo,s=this._synthesizer.timeSignatureNumerator,r=this._synthesizer.timeSignatureDenominator),e.tempoChanges.push(new Vb(t,0,0));let n=e.division*(4/r)|0,a=n*(6e4/(t*this._mainState.division)),o=0,l=0;for(let u=0;u<s;u++){let h=El.newMetronomeEvent(e.synthData.length,o,u,n,a);e.synthData.push(h),h.time=l,o+=n,l+=a}e.synthData.sort((u,h)=>u.time>h.time?1:u.time<h.time?-1:u.eventIndex-h.eventIndex),e.endTime=l,e.endTick=o,this._countInState=e}}var zt;(function(i){i[i.Paused=0]="Paused",i[i.Playing=1]="Playing"})(zt||(zt={}));class Ll{constructor(e,t){this.state=e,this.stopped=t}}class cu{constructor(e,t,s,r,n){this.currentTime=e,this.endTime=t,this.currentTick=s,this.endTick=r,this.isSeek=n}}class xs{constructor(){this.id="",this.size=0}static load(e,t,s){if(e&&xs.HeaderSize>e.size||s.position+xs.HeaderSize>=s.length||(t.id=L.read8BitStringLength(s,4),t.id.charCodeAt(0)<=32||t.id.charCodeAt(0)>=122)||(t.size=L.readUInt32LE(s),e&&xs.HeaderSize+t.size>e.size))return!1;e&&(e.size-=xs.HeaderSize+t.size);let r=t.id==="RIFF",n=t.id==="LIST";return r&&e?!1:!r&&!n?!0:(t.id=L.read8BitStringLength(s,4),t.id.charCodeAt(0)<=32||t.id.charCodeAt(0)>=122?!1:(t.size-=4,!0))}}xs.HeaderSize=8;class V0{constructor(){this.phdrs=[],this.pbags=[],this.pmods=[],this.pgens=[],this.insts=[],this.ibags=[],this.imods=[],this.igens=[],this.sHdrs=[],this.fontSamples=new Float32Array(0)}load(e){const t=new xs,s=new xs;if(!xs.load(null,t,e)||t.id!=="sfbk")throw new Vt("Soundfont is not a valid Soundfont2 file");for(;xs.load(t,s,e);){let r=new xs;if(s.id==="pdta")for(;xs.load(s,r,e);)switch(r.id){case"phdr":for(let n=0,a=r.size/Gg.SizeInFile|0;n<a;n++)this.phdrs.push(new Gg(e));break;case"pbag":for(let n=0,a=r.size/Wg.SizeInFile|0;n<a;n++)this.pbags.push(new Wg(e));break;case"pmod":for(let n=0,a=r.size/jg.SizeInFile|0;n<a;n++)this.pmods.push(new jg(e));break;case"pgen":for(let n=0,a=r.size/ls.SizeInFile|0;n<a;n++)this.pgens.push(new ls(e));break;case"inst":for(let n=0,a=r.size/zg.SizeInFile|0;n<a;n++)this.insts.push(new zg(e));break;case"ibag":for(let n=0,a=r.size/Fg.SizeInFile|0;n<a;n++)this.ibags.push(new Fg(e));break;case"imod":for(let n=0,a=r.size/Vg.SizeInFile|0;n<a;n++)this.imods.push(new Vg(e));break;case"igen":for(let n=0,a=r.size/Hg.SizeInFile|0;n<a;n++)this.igens.push(new Hg(e));break;case"shdr":for(let n=0,a=r.size/Ug.SizeInFile|0;n<a;n++)this.sHdrs.push(new Ug(e));break;default:e.position+=r.size;break}else if(s.id==="sdta")for(;xs.load(s,r,e);)switch(r.id){case"smpl":this.fontSamples=V0.loadSamples(r,e);break;default:e.position+=r.size;break}else e.position+=s.size}}static loadSamples(e,t){let s=e.size/2|0;const r=new Float32Array(s);let n=0;const a=new Uint8Array(16*1024);for(;s>0;){let o=Math.min(s,a.length/2|0);t.read(a,0,o*2);for(let l=0;l<o;l++){const u=Ce.int32ToInt16(a[l*2+1]<<8|a[l*2]);r[n+l]=u/32767}s-=o,n+=o}return r}}class Fg{constructor(e){this.instGenNdx=L.readUInt16LE(e),this.instModNdx=L.readUInt16LE(e)}}Fg.SizeInFile=4;class Vg{constructor(e){this.modSrcOper=L.readUInt16LE(e),this.modDestOper=L.readUInt16LE(e),this.modAmount=L.readInt16LE(e),this.modAmtSrcOper=L.readUInt16LE(e),this.modTransOper=L.readUInt16LE(e)}}Vg.SizeInFile=10;class Hg{constructor(e){this.genOper=L.readUInt16LE(e),this.genAmount=new O_(e)}}Hg.SizeInFile=4;class zg{constructor(e){this.instName=L.read8BitStringLength(e,20),this.instBagNdx=L.readUInt16LE(e)}}zg.SizeInFile=22;class Wg{constructor(e){this.genNdx=L.readUInt16LE(e),this.modNdx=L.readUInt16LE(e)}}Wg.SizeInFile=4;class ls{constructor(e){this.genOper=L.readUInt16LE(e),this.genAmount=new O_(e)}}ls.SizeInFile=4;ls.GenInstrument=41;ls.GenKeyRange=43;ls.GenVelRange=44;ls.GenSampleId=53;class Gg{constructor(e){this.presetName=L.read8BitStringLength(e,20),this.preset=L.readUInt16LE(e),this.bank=L.readUInt16LE(e),this.presetBagNdx=L.readUInt16LE(e),this.library=L.readUInt32LE(e),this.genre=L.readUInt32LE(e),this.morphology=L.readUInt32LE(e)}}Gg.SizeInFile=38;class jg{constructor(e){this.modSrcOper=L.readUInt16LE(e),this.modDestOper=L.readUInt16LE(e),this.modAmount=L.readUInt16LE(e),this.modAmtSrcOper=L.readUInt16LE(e),this.modTransOper=L.readUInt16LE(e)}}jg.SizeInFile=10;class Ug{constructor(e){this.sampleName=L.read8BitStringLength(e,20),this.start=L.readUInt32LE(e),this.end=L.readUInt32LE(e),this.startLoop=L.readUInt32LE(e),this.endLoop=L.readUInt32LE(e),this.sampleRate=L.readUInt32LE(e),this.originalPitch=e.readByte(),this.pitchCorrection=L.readSInt8(e),this.sampleLink=L.readUInt16LE(e),this.sampleType=L.readUInt16LE(e)}}Ug.SizeInFile=46;class O_{get shortAmount(){return Ce.uint16ToInt16(this.wordAmount)}get lowByteAmount(){return this.wordAmount&255}get highByteAmount(){return(this.wordAmount&65280)>>8&255}constructor(e){this.wordAmount=L.readUInt16LE(e)}}class sO{constructor(){this.presetIndex=0,this.bank=0,this.pitchWheel=0,this.perNotePitchWheel=new Map,this.midiPan=0,this.midiVolume=0,this.midiExpression=0,this.midiRpn=0,this.midiData=0,this.panOffset=0,this.gainDb=0,this.pitchRange=0,this.tuning=0,this.mixVolume=0,this.mute=!1,this.solo=!1}}class rO{constructor(){this.activeChannel=0,this.channelList=[]}setupVoice(e,t){const s=this.channelList[this.activeChannel],r=t.region.pan+s.panOffset;t.playingChannel=this.activeChannel,t.mixVolume=s.mixVolume,t.noteGainDb+=s.gainDb,t.updatePitchRatio(s,e.outSampleRate),r<=-.5?(t.panFactorLeft=1,t.panFactorRight=0):r>=.5?(t.panFactorLeft=0,t.panFactorRight=1):(t.panFactorLeft=Math.sqrt(.5-r),t.panFactorRight=Math.sqrt(.5+r))}}var Xr;(function(i){i[i.None=0]="None",i[i.Continuous=1]="Continuous",i[i.Sustain=2]="Sustain"})(Xr||(Xr={}));var ca;(function(i){i[i.StereoInterleaved=0]="StereoInterleaved",i[i.StereoUnweaved=1]="StereoUnweaved",i[i.Mono=2]="Mono"})(ca||(ca={}));class nO{constructor(){this.name="",this.presetNumber=0,this.bank=0,this.regions=null,this.fontSamples=null}}class Nt{static timecents2Secs(e){return Math.pow(2,e/1200)}static decibelsToGain(e){return e>-100?Math.pow(10,e*.05):0}static gainToDecibels(e){return e<=1e-5?-100:20*Math.log10(e)}static cents2Hertz(e){return 8.176*Math.pow(2,e/1200)}static clamp(e,t,s){return e<=t?t:e>=s?s:e}}class yl{constructor(e){this.delay=0,this.attack=0,this.hold=0,this.decay=0,this.sustain=0,this.release=0,this.keynumToHold=0,this.keynumToDecay=0,e&&(this.delay=e.delay,this.attack=e.attack,this.hold=e.hold,this.decay=e.decay,this.sustain=e.sustain,this.release=e.release,this.keynumToHold=e.keynumToHold,this.keynumToDecay=e.keynumToDecay)}clear(){this.delay=0,this.attack=0,this.hold=0,this.decay=0,this.sustain=0,this.release=0,this.keynumToHold=0,this.keynumToDecay=0}envToSecs(e){this.delay=this.delay<-11950?0:Nt.timecents2Secs(this.delay),this.attack=this.attack<-11950?0:Nt.timecents2Secs(this.attack),this.release=this.release<-11950?0:Nt.timecents2Secs(this.release),this.keynumToHold===0&&(this.hold=this.hold<-11950?0:Nt.timecents2Secs(this.hold)),this.keynumToDecay===0&&(this.decay=this.decay<-11950?0:Nt.timecents2Secs(this.decay)),this.sustain<0?this.sustain=0:e?this.sustain=Nt.decibelsToGain(-this.sustain/10):this.sustain=1-this.sustain/1e3}}var Re;(function(i){i[i.StartAddrsOffset=0]="StartAddrsOffset",i[i.EndAddrsOffset=1]="EndAddrsOffset",i[i.StartloopAddrsOffset=2]="StartloopAddrsOffset",i[i.EndloopAddrsOffset=3]="EndloopAddrsOffset",i[i.StartAddrsCoarseOffset=4]="StartAddrsCoarseOffset",i[i.ModLfoToPitch=5]="ModLfoToPitch",i[i.VibLfoToPitch=6]="VibLfoToPitch",i[i.ModEnvToPitch=7]="ModEnvToPitch",i[i.InitialFilterFc=8]="InitialFilterFc",i[i.InitialFilterQ=9]="InitialFilterQ",i[i.ModLfoToFilterFc=10]="ModLfoToFilterFc",i[i.ModEnvToFilterFc=11]="ModEnvToFilterFc",i[i.EndAddrsCoarseOffset=12]="EndAddrsCoarseOffset",i[i.ModLfoToVolume=13]="ModLfoToVolume",i[i.Unused1=14]="Unused1",i[i.ChorusEffectsSend=15]="ChorusEffectsSend",i[i.ReverbEffectsSend=16]="ReverbEffectsSend",i[i.Pan=17]="Pan",i[i.Unused2=18]="Unused2",i[i.Unused3=19]="Unused3",i[i.Unused4=20]="Unused4",i[i.DelayModLFO=21]="DelayModLFO",i[i.FreqModLFO=22]="FreqModLFO",i[i.DelayVibLFO=23]="DelayVibLFO",i[i.FreqVibLFO=24]="FreqVibLFO",i[i.DelayModEnv=25]="DelayModEnv",i[i.AttackModEnv=26]="AttackModEnv",i[i.HoldModEnv=27]="HoldModEnv",i[i.DecayModEnv=28]="DecayModEnv",i[i.SustainModEnv=29]="SustainModEnv",i[i.ReleaseModEnv=30]="ReleaseModEnv",i[i.KeynumToModEnvHold=31]="KeynumToModEnvHold",i[i.KeynumToModEnvDecay=32]="KeynumToModEnvDecay",i[i.DelayVolEnv=33]="DelayVolEnv",i[i.AttackVolEnv=34]="AttackVolEnv",i[i.HoldVolEnv=35]="HoldVolEnv",i[i.DecayVolEnv=36]="DecayVolEnv",i[i.SustainVolEnv=37]="SustainVolEnv",i[i.ReleaseVolEnv=38]="ReleaseVolEnv",i[i.KeynumToVolEnvHold=39]="KeynumToVolEnvHold",i[i.KeynumToVolEnvDecay=40]="KeynumToVolEnvDecay",i[i.Instrument=41]="Instrument",i[i.Reserved1=42]="Reserved1",i[i.KeyRange=43]="KeyRange",i[i.VelRange=44]="VelRange",i[i.StartloopAddrsCoarseOffset=45]="StartloopAddrsCoarseOffset",i[i.Keynum=46]="Keynum",i[i.Velocity=47]="Velocity",i[i.InitialAttenuation=48]="InitialAttenuation",i[i.Reserved2=49]="Reserved2",i[i.EndloopAddrsCoarseOffset=50]="EndloopAddrsCoarseOffset",i[i.CoarseTune=51]="CoarseTune",i[i.FineTune=52]="FineTune",i[i.SampleID=53]="SampleID",i[i.SampleModes=54]="SampleModes",i[i.Reserved3=55]="Reserved3",i[i.ScaleTuning=56]="ScaleTuning",i[i.ExclusiveClass=57]="ExclusiveClass",i[i.OverridingRootKey=58]="OverridingRootKey",i[i.Unused5=59]="Unused5",i[i.EndOper=60]="EndOper"})(Re||(Re={}));class Qa{constructor(e){this.loopMode=Xr.None,this.sampleRate=0,this.loKey=0,this.hiKey=0,this.loVel=0,this.hiVel=0,this.group=0,this.offset=0,this.end=0,this.loopStart=0,this.loopEnd=0,this.transpose=0,this.tune=0,this.pitchKeyCenter=0,this.pitchKeyTrack=0,this.attenuation=0,this.pan=0,this.ampEnv=new yl,this.modEnv=new yl,this.initialFilterQ=0,this.initialFilterFc=0,this.modEnvToPitch=0,this.modEnvToFilterFc=0,this.modLfoToFilterFc=0,this.modLfoToVolume=0,this.delayModLFO=0,this.freqModLFO=0,this.modLfoToPitch=0,this.delayVibLFO=0,this.freqVibLFO=0,this.vibLfoToPitch=0,e&&(this.loopMode=e.loopMode,this.sampleRate=e.sampleRate,this.loKey=e.loKey,this.hiKey=e.hiKey,this.loVel=e.loVel,this.hiVel=e.hiVel,this.group=e.group,this.offset=e.offset,this.end=e.end,this.loopStart=e.loopStart,this.loopEnd=e.loopEnd,this.transpose=e.transpose,this.tune=e.tune,this.pitchKeyCenter=e.pitchKeyCenter,this.pitchKeyTrack=e.pitchKeyTrack,this.attenuation=e.attenuation,this.pan=e.pan,this.ampEnv=new yl(e.ampEnv),this.modEnv=new yl(e.modEnv),this.initialFilterQ=e.initialFilterQ,this.initialFilterFc=e.initialFilterFc,this.modEnvToPitch=e.modEnvToPitch,this.modEnvToFilterFc=e.modEnvToFilterFc,this.modLfoToFilterFc=e.modLfoToFilterFc,this.modLfoToVolume=e.modLfoToVolume,this.delayModLFO=e.delayModLFO,this.freqModLFO=e.freqModLFO,this.modLfoToPitch=e.modLfoToPitch,this.delayVibLFO=e.delayVibLFO,this.freqVibLFO=e.freqVibLFO,this.vibLfoToPitch=e.vibLfoToPitch)}clear(e){this.loopMode=Xr.None,this.sampleRate=0,this.loKey=0,this.hiKey=0,this.loVel=0,this.hiVel=0,this.group=0,this.offset=0,this.end=0,this.loopStart=0,this.loopEnd=0,this.transpose=0,this.tune=0,this.pitchKeyCenter=0,this.pitchKeyTrack=0,this.attenuation=0,this.pan=0,this.ampEnv.clear(),this.modEnv.clear(),this.initialFilterQ=0,this.initialFilterFc=0,this.modEnvToPitch=0,this.modEnvToFilterFc=0,this.modLfoToFilterFc=0,this.modLfoToVolume=0,this.delayModLFO=0,this.freqModLFO=0,this.modLfoToPitch=0,this.delayVibLFO=0,this.freqVibLFO=0,this.vibLfoToPitch=0,this.hiKey=127,this.hiVel=127,this.pitchKeyCenter=60,!e&&(this.pitchKeyTrack=100,this.pitchKeyCenter=-1,this.ampEnv.delay=-12e3,this.ampEnv.attack=-12e3,this.ampEnv.hold=-12e3,this.ampEnv.decay=-12e3,this.ampEnv.release=-12e3,this.modEnv.delay=-12e3,this.modEnv.attack=-12e3,this.modEnv.hold=-12e3,this.modEnv.decay=-12e3,this.modEnv.release=-12e3,this.initialFilterFc=13500,this.delayModLFO=-12e3,this.delayVibLFO=-12e3)}operator(e,t){switch(e){case Re.StartAddrsOffset:this.offset+=Ce.int16ToUint32(t.shortAmount);break;case Re.EndAddrsOffset:this.end+=Ce.int16ToUint32(t.shortAmount);break;case Re.StartloopAddrsOffset:this.loopStart+=Ce.int16ToUint32(t.shortAmount);break;case Re.EndloopAddrsOffset:this.loopEnd+=Ce.int16ToUint32(t.shortAmount);break;case Re.StartAddrsCoarseOffset:this.offset+=Ce.int16ToUint32(t.shortAmount)*32768;break;case Re.ModLfoToPitch:this.modLfoToPitch=t.shortAmount;break;case Re.VibLfoToPitch:this.vibLfoToPitch=t.shortAmount;break;case Re.ModEnvToPitch:this.modEnvToPitch=t.shortAmount;break;case Re.InitialFilterFc:this.initialFilterFc=t.shortAmount;break;case Re.InitialFilterQ:this.initialFilterQ=t.shortAmount;break;case Re.ModLfoToFilterFc:this.modLfoToFilterFc=t.shortAmount;break;case Re.ModEnvToFilterFc:this.modEnvToFilterFc=t.shortAmount;break;case Re.EndAddrsCoarseOffset:this.end+=Ce.int16ToUint32(t.shortAmount)*32768;break;case Re.ModLfoToVolume:this.modLfoToVolume=t.shortAmount;break;case Re.Pan:this.pan=t.shortAmount/1e3;break;case Re.DelayModLFO:this.delayModLFO=t.shortAmount;break;case Re.FreqModLFO:this.freqModLFO=t.shortAmount;break;case Re.DelayVibLFO:this.delayVibLFO=t.shortAmount;break;case Re.FreqVibLFO:this.freqVibLFO=t.shortAmount;break;case Re.DelayModEnv:this.modEnv.delay=t.shortAmount;break;case Re.AttackModEnv:this.modEnv.attack=t.shortAmount;break;case Re.HoldModEnv:this.modEnv.hold=t.shortAmount;break;case Re.DecayModEnv:this.modEnv.decay=t.shortAmount;break;case Re.SustainModEnv:this.modEnv.sustain=t.shortAmount;break;case Re.ReleaseModEnv:this.modEnv.release=t.shortAmount;break;case Re.KeynumToModEnvHold:this.modEnv.keynumToHold=t.shortAmount;break;case Re.KeynumToModEnvDecay:this.modEnv.keynumToDecay=t.shortAmount;break;case Re.DelayVolEnv:this.ampEnv.delay=t.shortAmount;break;case Re.AttackVolEnv:this.ampEnv.attack=t.shortAmount;break;case Re.HoldVolEnv:this.ampEnv.hold=t.shortAmount;break;case Re.DecayVolEnv:this.ampEnv.decay=t.shortAmount;break;case Re.SustainVolEnv:this.ampEnv.sustain=t.shortAmount;break;case Re.ReleaseVolEnv:this.ampEnv.release=t.shortAmount;break;case Re.KeynumToVolEnvHold:this.ampEnv.keynumToHold=t.shortAmount;break;case Re.KeynumToVolEnvDecay:this.ampEnv.keynumToDecay=t.shortAmount;break;case Re.KeyRange:this.loKey=t.lowByteAmount,this.hiKey=t.highByteAmount;break;case Re.VelRange:this.loVel=t.lowByteAmount,this.hiVel=t.highByteAmount;break;case Re.StartloopAddrsCoarseOffset:this.loopStart+=Ce.int16ToUint32(t.shortAmount)*32768;break;case Re.InitialAttenuation:this.attenuation+=t.shortAmount*.1;break;case Re.EndloopAddrsCoarseOffset:this.loopEnd+=Ce.int16ToUint32(t.shortAmount)*32768;break;case Re.CoarseTune:this.transpose+=t.shortAmount;break;case Re.FineTune:this.tune+=t.shortAmount;break;case Re.SampleModes:this.loopMode=(t.wordAmount&3)===3?Xr.Sustain:(t.wordAmount&3)===1?Xr.Continuous:Xr.None;break;case Re.ScaleTuning:this.pitchKeyTrack=t.shortAmount;break;case Re.ExclusiveClass:this.group=t.wordAmount;break;case Re.OverridingRootKey:this.pitchKeyCenter=t.shortAmount;break}}}var st;(function(i){i[i.None=0]="None",i[i.Delay=1]="Delay",i[i.Attack=2]="Attack",i[i.Hold=3]="Hold",i[i.Decay=4]="Decay",i[i.Sustain=5]="Sustain",i[i.Release=6]="Release",i[i.Done=7]="Done"})(st||(st={}));class du{constructor(){this.level=0,this.slope=0,this.samplesUntilNextSegment=0,this.segment=st.None,this.midiVelocity=0,this.parameters=null,this.segmentIsExponential=!1,this.isAmpEnv=!1}nextSegment(e,t){if(this.parameters)for(;;)switch(e){case st.None:if(this.samplesUntilNextSegment=this.parameters.delay*t|0,this.samplesUntilNextSegment>0){this.segment=st.Delay,this.segmentIsExponential=!1,this.level=0,this.slope=0;return}e=st.Delay;break;case st.Delay:if(this.samplesUntilNextSegment=this.parameters.attack*t|0,this.samplesUntilNextSegment>0){this.isAmpEnv||(this.samplesUntilNextSegment=this.parameters.attack*((145-this.midiVelocity)/144)*t|0),this.segment=st.Attack,this.segmentIsExponential=!1,this.level=0,this.slope=1/this.samplesUntilNextSegment;return}e=st.Attack;break;case st.Attack:if(this.samplesUntilNextSegment=this.parameters.hold*t|0,this.samplesUntilNextSegment>0){this.segment=st.Hold,this.segmentIsExponential=!1,this.level=1,this.slope=0;return}e=st.Hold;break;case st.Hold:if(this.samplesUntilNextSegment=this.parameters.decay*t|0,this.samplesUntilNextSegment>0){if(this.segment=st.Decay,this.level=1,this.isAmpEnv){let s=-9.226/this.samplesUntilNextSegment;this.slope=Math.exp(s),this.segmentIsExponential=!0,this.parameters.sustain>0&&(this.samplesUntilNextSegment=Math.log(this.parameters.sustain)/s|0)}else this.slope=-1/this.samplesUntilNextSegment,this.samplesUntilNextSegment=this.parameters.decay*(1-this.parameters.sustain)*t|0,this.segmentIsExponential=!1;return}e=st.Decay;break;case st.Decay:this.segment=st.Sustain,this.level=this.parameters.sustain,this.slope=0,this.samplesUntilNextSegment=2147483647,this.segmentIsExponential=!1;return;case st.Sustain:if(this.segment=st.Release,this.samplesUntilNextSegment=(this.parameters.release<=0?du.FastReleaseTime:this.parameters.release)*t|0,this.isAmpEnv){let s=-9.226/this.samplesUntilNextSegment;this.slope=Math.exp(s),this.segmentIsExponential=!0}else this.slope=-this.level/this.samplesUntilNextSegment,this.segmentIsExponential=!1;return;default:this.segment=st.Done,this.segmentIsExponential=!1,this.level=0,this.slope=0,this.samplesUntilNextSegment=134217727;return}}setup(e,t,s,r,n){this.parameters=new yl(e),this.parameters.keynumToHold>0&&(this.parameters.hold+=this.parameters.keynumToHold*(60-t),this.parameters.hold=this.parameters.hold<-1e4?0:Nt.timecents2Secs(this.parameters.hold)),this.parameters.keynumToDecay>0&&(this.parameters.decay+=this.parameters.keynumToDecay*(60-t),this.parameters.decay=this.parameters.decay<-1e4?0:Nt.timecents2Secs(this.parameters.decay)),this.midiVelocity=s|0,this.isAmpEnv=r,this.nextSegment(st.None,n)}process(e,t){this.slope>0&&(this.segmentIsExponential?this.level*=Math.pow(this.slope,e):this.level+=this.slope*e),this.samplesUntilNextSegment-=e,this.samplesUntilNextSegment<=0&&this.nextSegment(this.segment,t)}}du.FastReleaseTime=.01;class Hb{constructor(){this.samplesUntil=0,this.level=0,this.delta=0}setup(e,t,s){this.samplesUntil=e*s|0,this.delta=4*Nt.cents2Hertz(t)/s,this.level=0}process(e){if(this.samplesUntil>e){this.samplesUntil-=e;return}this.level+=this.delta*e,this.level>1?(this.delta=-this.delta,this.level=2-this.level):this.level<-1&&(this.delta=-this.delta,this.level=-2-this.level)}}class zb{constructor(e){this.qInv=0,this.a0=0,this.a1=0,this.b1=0,this.b2=0,this.z1=0,this.z2=0,this.active=!1,e&&(this.qInv=e.qInv,this.a0=e.a0,this.a1=e.a1,this.b1=e.b1,this.b2=e.b2,this.z1=e.z1,this.z2=e.z2,this.active=e.active)}setup(e){let t=Math.tan(Math.PI*e),s=t*t,r=1/(1+t*this.qInv+s);this.a0=s*r,this.a1=2*this.a0,this.b1=2*(s-1)*r,this.b2=(1-t*this.qInv+s)*r}process(e){let t=e*this.a0+this.z1;return this.z1=e*this.a1+this.z2-this.b1*t,this.z2=e*this.a0-this.b2*t,t}}class fu{constructor(){this.playingPreset=0,this.playingKey=0,this.playingChannel=0,this.region=null,this.pitchInputTimecents=0,this.pitchOutputFactor=0,this.sourceSamplePosition=0,this.noteGainDb=0,this.panFactorLeft=0,this.panFactorRight=0,this.playIndex=0,this.loopStart=0,this.loopEnd=0,this.ampEnv=new du,this.modEnv=new du,this.lowPass=new zb,this.modLfo=new Hb,this.vibLfo=new Hb,this.mixVolume=0,this.mute=!1}updatePitchRatio(e,t){let s=e.pitchWheel;e.perNotePitchWheel.has(this.playingKey)&&(s+=e.perNotePitchWheel.get(this.playingKey)-8192);const r=s===8192?e.tuning:s/16383*e.pitchRange*2-e.pitchRange+e.tuning;this.calcPitchRatio(r,t)}calcPitchRatio(e,t){if(!this.region)return;const s=this.playingKey+this.region.transpose+this.region.tune/100;let r=this.region.pitchKeyCenter+(s-this.region.pitchKeyCenter)*(this.region.pitchKeyTrack/100);e!==0&&(r+=e),this.pitchInputTimecents=r*100,this.pitchOutputFactor=this.region.sampleRate/(Nt.timecents2Secs(this.region.pitchKeyCenter*100)*t)}end(e){this.region&&(this.ampEnv.nextSegment(st.Sustain,e),this.modEnv.nextSegment(st.Sustain,e),this.region.loopMode===Xr.Sustain&&(this.loopEnd=this.loopStart))}endQuick(e){this.ampEnv.parameters.release=0,this.ampEnv.nextSegment(st.Sustain,e),this.modEnv.parameters.release=0,this.modEnv.nextSegment(st.Sustain,e)}render(e,t,s,r,n){if(!this.region)return;let a=this.region,l=e.presets[this.playingPreset].fontSamples,u=0,h=e.outputMode===ca.StereoUnweaved?r:-1,c=a.modEnvToPitch!==0||a.modEnvToFilterFc!==0,d=this.modLfo.delta>0&&(a.modLfoToPitch!==0||a.modLfoToFilterFc!==0||a.modLfoToVolume!==0),f=this.vibLfo.delta>0&&a.vibLfoToPitch!==0,p=this.loopStart<this.loopEnd,g=this.loopStart,b=this.loopEnd,m=a.end,y=b+1,w=this.sourceSamplePosition,x=new zb(this.lowPass),k=a.modLfoToFilterFc!==0||a.modEnvToFilterFc!==0,_=0,T=0,C=0,W=0,z=a.modLfoToPitch!==0||a.modEnvToPitch!==0||a.vibLfoToPitch!==0,te=0,E=0,U=0,re=0,K=a.modLfoToVolume!==0,ae=0,ie=0;for(k?(_=e.outSampleRate,T=a.initialFilterFc,C=a.modLfoToFilterFc,W=a.modEnvToFilterFc):(_=0,T=0,C=0,W=0),z?(te=0,E=a.modLfoToPitch,U=a.vibLfoToPitch,re=a.modEnvToPitch):(te=Nt.timecents2Secs(this.pitchInputTimecents)*this.pitchOutputFactor,E=0,U=0,re=0),K?ie=a.modLfoToVolume*.1:(ae=Nt.decibelsToGain(this.noteGainDb),ie=0);r>0;){let A,Y,le=0,pe=r>fu.RenderEffectSampleBlock?fu.RenderEffectSampleBlock:r;if(r-=pe,k){let oe=T+this.modLfo.level*C+this.modEnv.level*W;x.active=oe<=13500,x.active&&x.setup(Nt.cents2Hertz(oe)/_)}switch(z&&(te=Nt.timecents2Secs(this.pitchInputTimecents+(this.modLfo.level*E+this.vibLfo.level*U+this.modEnv.level*re))*this.pitchOutputFactor),K&&(ae=Nt.decibelsToGain(this.noteGainDb+this.modLfo.level*ie)),A=ae*this.ampEnv.level,n?A=0:A*=this.mixVolume,this.ampEnv.process(pe,e.outSampleRate),c&&this.modEnv.process(pe,e.outSampleRate),d&&this.modLfo.process(pe),f&&this.vibLfo.process(pe),e.outputMode){case ca.StereoInterleaved:for(Y=A*this.panFactorLeft,le=A*this.panFactorRight;pe-- >0&&w<m;){let oe=w|0,ze=oe>=b&&p?g:oe+1,Ye=w-oe,Ie=l[oe]*(1-Ye)+l[ze]*Ye;x.active&&(Ie=x.process(Ie)),t[s+u]+=Ie*Y,u++,t[s+u]+=Ie*le,u++,w+=te,w>=y&&p&&(w-=b-g+1)}break;case ca.StereoUnweaved:for(Y=A*this.panFactorLeft,le=A*this.panFactorRight;pe-- >0&&w<m;){let oe=w|0,ze=oe>=b&&p?g:oe+1,Ye=w-oe,Ie=l[oe]*(1-Ye)+l[ze]*Ye;x.active&&(Ie=x.process(Ie)),t[s+u]+=Ie*Y,u++,t[s+h]+=Ie*le,h++,w+=te,w>=y&&p&&(w-=b-g+1)}break;case ca.Mono:for(;pe-- >0&&w<m;){let oe=w|0,ze=oe>=b&&p?g:oe+1,Ye=w-oe,Ie=l[oe]*(1-Ye)+l[ze]*Ye;x.active&&(Ie=x.process(Ie)),t[s+u]=Ie*A,u++,w+=te,w>=y&&p&&(w-=b-g+1)}break}if(w>=m||this.ampEnv.segment===st.Done){this.kill();return}}this.sourceSamplePosition=w,(x.active||k)&&(this.lowPass=x)}kill(){this.playingPreset=-1}}fu.RenderEffectSampleBlock=Ne.MicroBufferSize;class $g{constructor(){this._items=[],this._position=0,this.isEmpty=!0}clear(){this._items=[],this._position=0,this.isEmpty=!0}enqueue(e){this.isEmpty=!1,this._items.push(e)}peek(){return this._items[this._position]}dequeue(){const e=this._items[this._position];return this._position++,this._position>=this._items.length/2&&(this._items=this._items.slice(this._position),this._position=0),this.isEmpty=this._items.length==0,e}toArray(){const e=this._items.slice(this._position);return e.reverse(),e}}var Ke;(function(i){i[i.BankSelectCoarse=0]="BankSelectCoarse",i[i.ModulationCoarse=1]="ModulationCoarse",i[i.DataEntryCoarse=6]="DataEntryCoarse",i[i.VolumeCoarse=7]="VolumeCoarse",i[i.PanCoarse=10]="PanCoarse",i[i.ExpressionControllerCoarse=11]="ExpressionControllerCoarse",i[i.BankSelectFine=32]="BankSelectFine",i[i.ModulationFine=33]="ModulationFine",i[i.DataEntryFine=38]="DataEntryFine",i[i.VolumeFine=39]="VolumeFine",i[i.PanFine=42]="PanFine",i[i.ExpressionControllerFine=43]="ExpressionControllerFine",i[i.HoldPedal=64]="HoldPedal",i[i.LegatoPedal=68]="LegatoPedal",i[i.NonRegisteredParameterFine=98]="NonRegisteredParameterFine",i[i.NonRegisteredParameterCourse=99]="NonRegisteredParameterCourse",i[i.RegisteredParameterFine=100]="RegisteredParameterFine",i[i.RegisteredParameterCourse=101]="RegisteredParameterCourse",i[i.AllSoundOff=120]="AllSoundOff",i[i.ResetControllers=121]="ResetControllers",i[i.AllNotesOff=123]="AllNotesOff"})(Ke||(Ke={}));class aO{constructor(e){this._midiEventQueue=new $g,this._mutedChannels=new Map,this._soloChannels=new Map,this._isAnySolo=!1,this._transpositionPitches=new Map,this._liveTranspositionPitches=new Map,this.currentTempo=0,this.timeSignatureNumerator=0,this.timeSignatureDenominator=0,this.presets=null,this._voices=[],this._channels=null,this._voicePlayIndex=0,this.outputMode=ca.StereoInterleaved,this.outSampleRate=0,this.globalGainDb=0,this.outSampleRate=e}synthesize(e,t,s){return this.fillWorkingBuffer(e,t,s)}synthesizeSilent(e){this.fillWorkingBuffer(null,0,e)}channelGetMixVolume(e){return this._channels&&e<this._channels.channelList.length?this._channels.channelList[e].mixVolume:1}channelSetMixVolume(e,t){let s=this.channelInit(e);for(let r of this._voices)r.playingChannel===e&&r.playingPreset!==-1&&(r.mixVolume=t);s.mixVolume=t}channelSetMute(e,t){t?this._mutedChannels.set(e,!0):this._mutedChannels.delete(e)}channelSetSolo(e,t){t?this._soloChannels.set(e,!0):this._soloChannels.delete(e),this._isAnySolo=this._soloChannels.size>0}resetChannelStates(){this._mutedChannels=new Map,this._soloChannels=new Map,this._liveTranspositionPitches=new Map,this.applyTranspositionPitches(new Map),this._isAnySolo=!1}setChannelTranspositionPitch(e,t){let s=0;this._liveTranspositionPitches.has(e)&&(s=this._liveTranspositionPitches.get(e)),t===0?this._liveTranspositionPitches.delete(e):this._liveTranspositionPitches.set(e,t);for(const r of this._voices)if(r.playingChannel===e&&r.playingChannel!==9){let n=0;n-=s,n+=t,r.playingKey+=n,this._channels&&r.updatePitchRatio(this._channels.channelList[r.playingChannel],this.outSampleRate)}}applyTranspositionPitches(e){const t=this._transpositionPitches;for(const s of this._voices)if(s.playingChannel>=0&&s.playingChannel!==9){let r=0;t.has(s.playingChannel)&&(r-=t.get(s.playingChannel)),e.has(s.playingChannel)&&(r+=e.get(s.playingChannel)),s.playingKey+=r,this._channels&&s.updatePitchRatio(this._channels.channelList[s.playingChannel],this.outSampleRate)}this._transpositionPitches=e}dispatchEvent(e){this._midiEventQueue.enqueue(e)}fillWorkingBuffer(e,t,s){const r=this._isAnySolo,n=[];for(;!this._midiEventQueue.isEmpty;){let a=this._midiEventQueue.dequeue();a.isMetronome&&this.metronomeVolume>0?(this.channelNoteOff(Ne.MetronomeChannel,33),this.channelNoteOn(Ne.MetronomeChannel,33,95/127)):a.event&&this.processMidiMessage(a.event),n.push(a)}for(const a of this._voices)if(a.playingPreset!==-1){const o=a.playingChannel,l=this._mutedChannels.has(o)||r&&o!=Ne.MetronomeChannel&&!this._soloChannels.has(o);e?a.render(this,e,t,s,l):a.kill()}return n}processMidiMessage(e){switch(I.debug("MIdi","Processing Midi message "+Fe[e.type]+"/"+e.tick),e.type){case Fe.TimeSignature:const s=e;this.timeSignatureNumerator=s.numerator,this.timeSignatureDenominator=Math.pow(2,s.denominatorIndex);break;case Fe.NoteOn:const r=e;this.channelNoteOn(r.channel,r.noteKey,r.noteVelocity/127);break;case Fe.NoteOff:const n=e;this.channelNoteOff(n.channel,n.noteKey);break;case Fe.ControlChange:const a=e;this.channelMidiControl(a.channel,a.controller,a.value);break;case Fe.ProgramChange:const o=e;this.channelSetPresetNumber(o.channel,o.program,o.channel===9);break;case Fe.TempoChange:const l=e;this.currentTempo=6e7/l.microSecondsPerQuarterNote;break;case Fe.PitchBend:const u=e;this.channelSetPitchWheel(u.channel,u.value);break;case Fe.PerNotePitchBend:const h=e;let c=h.value;c=c*Ne.MaxPitchWheel/Ne.MaxPitchWheel20,this.channelSetPerNotePitchWheel(h.channel,h.noteKey,c);break}}get metronomeVolume(){return this.channelGetMixVolume(Ne.MetronomeChannel)}set metronomeVolume(e){this.setupMetronomeChannel(e)}setupMetronomeChannel(e){this.channelSetMixVolume(Ne.MetronomeChannel,e),e>0&&(this.channelSetVolume(Ne.MetronomeChannel,1),this.channelSetPresetNumber(Ne.MetronomeChannel,0,!0))}get masterVolume(){return Nt.decibelsToGain(this.globalGainDb)}set masterVolume(e){var t=Nt.gainToDecibels(e);const s=t-this.globalGainDb;if(s!==0){for(const r of this._voices)r.playingPreset!==-1&&(r.noteGainDb+=s);this.globalGainDb=t}}resetSoft(){for(const e of this._voices)e.playingPreset!==-1&&(e.ampEnv.segment<st.Release||e.ampEnv.parameters.release!==0)&&e.endQuick(this.outSampleRate);if(this._channels)for(const e of this._channels.channelList)e.presetIndex=0,e.bank=0,e.pitchWheel=8192,e.midiPan=8192,e.perNotePitchWheel.clear(),e.midiVolume=16383,e.midiExpression=16383,e.midiRpn=65535,e.midiData=0,e.panOffset=0,e.gainDb=0,e.pitchRange=2,e.tuning=0}get presetCount(){var e;return((e=this.presets)==null?void 0:e.length)??0}reset(){for(let e of this._voices)e.playingPreset!==-1&&(e.ampEnv.segment<st.Release||e.ampEnv.parameters.release!==0)&&e.endQuick(this.outSampleRate);this._channels=null}setOutput(e,t,s){this.outputMode=e,this.outSampleRate=t>=1?t:44100,this.globalGainDb=s}noteOn(e,t,s){if(!this.presets)return;const r=s*127|0;if(e<0||e>=this.presets.length)return;if(s<=0){this.noteOff(e,t);return}const n=this._voicePlayIndex++;for(const a of this.presets[e].regions){if(t<a.loKey||t>a.hiKey||r<a.loVel||r>a.hiVel)continue;let o=null;if(a.group!==0)for(const h of this._voices)h.playingPreset===e&&h.region.group===a.group?h.endQuick(this.outSampleRate):h.playingPreset===-1&&!o&&(o=h);else for(let h of this._voices)h.playingPreset===-1&&(o=h);if(!o){for(let h=0;h<4;h++){const c=new fu;c.playingPreset=-1,this._voices.push(c)}o=this._voices[this._voices.length-4]}o.region=a,o.playingPreset=e,o.playingKey=t,o.playIndex=n,o.noteGainDb=this.globalGainDb-a.attenuation-Nt.gainToDecibels(1/s),this._channels?this._channels.setupVoice(this,o):(o.calcPitchRatio(0,this.outSampleRate),o.panFactorLeft=Math.sqrt(.5-a.pan),o.panFactorRight=Math.sqrt(.5+a.pan)),o.sourceSamplePosition=a.offset;const l=a.loopMode!==Xr.None&&a.loopStart<a.loopEnd;o.loopStart=l?a.loopStart:0,o.loopEnd=l?a.loopEnd:0,o.ampEnv.setup(a.ampEnv,t,r,!0,this.outSampleRate),o.modEnv.setup(a.modEnv,t,r,!1,this.outSampleRate);const u=a.initialFilterQ/10;o.lowPass.qInv=1/Math.pow(10,u/20),o.lowPass.z1=0,o.lowPass.z2=0,o.lowPass.active=a.initialFilterFc<=13500,o.lowPass.active&&o.lowPass.setup(Nt.cents2Hertz(a.initialFilterFc)/this.outSampleRate),o.modLfo.setup(a.delayModLFO,a.freqModLFO,this.outSampleRate),o.vibLfo.setup(a.delayVibLFO,a.freqVibLFO,this.outSampleRate)}}bankNoteOn(e,t,s,r){let n=this.getPresetIndex(e,t);return n===-1?!1:(this.noteOn(n,s,r),!0)}noteOff(e,t){let s=null,r=null,n=[];for(let a of this._voices)a.playingPreset!==e||a.playingKey!==t||a.ampEnv.segment>=st.Release||(!s||a.playIndex<s.playIndex?(s=a,r=a,n.push(a)):a.playIndex===s.playIndex&&(r=a,n.push(a)));if(s)for(const a of n)a!==s&&a!==r&&(a.playIndex!==s.playIndex||a.playingPreset!==e||a.playingKey!==t||a.ampEnv.segment>=st.Release)||a.end(this.outSampleRate)}bankNoteOff(e,t,s){const r=this.getPresetIndex(e,t);return r===-1?!1:(this.noteOff(r,s),!0)}noteOffAll(e){for(const t of this._voices)t.playingPreset!==-1&&(e?t.endQuick(this.outSampleRate):t.ampEnv.segment<st.Release&&t.end(this.outSampleRate))}get activeVoiceCount(){let e=0;for(const t of this._voices)t.playingPreset!==-1&&e++;return e}channelInit(e){if(this._channels&&e<this._channels.channelList.length)return this._channels.channelList[e];this._channels||(this._channels=new rO);for(let t=this._channels.channelList.length;t<=e;t++){let s=new sO;s.presetIndex=0,s.bank=0,s.pitchWheel=8192,s.midiPan=8192,s.midiVolume=16383,s.midiExpression=16383,s.midiRpn=65535,s.midiData=0,s.panOffset=0,s.gainDb=0,s.pitchRange=2,s.tuning=0,s.mixVolume=1,this._channels.channelList.push(s)}return this._channels.channelList[e]}getPresetIndex(e,t){if(!this.presets)return-1;for(let s=this.presets.length-1;s>=0;s--){let r=this.presets[s];if(r.presetNumber===t&&r.bank===e)return s}return-1}getPresetName(e){return this.presets?e<0||e>=this.presets.length?null:this.presets[e].name:null}bankGetPresetName(e,t){return this.getPresetName(this.getPresetIndex(e,t))}channelNoteOn(e,t,s){!this._channels||e>this._channels.channelList.length||(this._transpositionPitches.has(e)&&(t+=this._transpositionPitches.get(e)),this._liveTranspositionPitches.has(e)&&(t+=this._liveTranspositionPitches.get(e)),this._channels.activeChannel=e,this.noteOn(this._channels.channelList[e].presetIndex,t,s))}channelNoteOff(e,t){this._transpositionPitches.has(e)&&(t+=this._transpositionPitches.get(e)),this._liveTranspositionPitches.has(e)&&(t+=this._liveTranspositionPitches.get(e));const s=[];let r=null,n=null;for(const o of this._voices)o.playingPreset===-1||o.playingChannel!==e||o.playingKey!==t||o.ampEnv.segment>=st.Release||(!r||o.playIndex<r.playIndex?(r=o,n=o,s.push(o)):o.playIndex===r.playIndex&&(n=o,s.push(o)));if(this.channelInit(e).perNotePitchWheel.delete(t),!!r)for(const o of s)o!==r&&o!==n&&(o.playIndex!==r.playIndex||o.playingPreset===-1||o.playingChannel!==e||o.playingKey!==t||o.ampEnv.segment>=st.Release)||o.end(this.outSampleRate)}channelNoteOffAll(e){this.channelInit(e).perNotePitchWheel.clear();for(const s of this._voices)s.playingPreset!==-1&&s.playingChannel===e&&s.ampEnv.segment<st.Release&&s.end(this.outSampleRate)}channelSoundsOffAll(e){this.channelInit(e).perNotePitchWheel.clear();for(let s of this._voices)s.playingPreset!==-1&&s.playingChannel===e&&(s.ampEnv.segment<st.Release||s.ampEnv.parameters.release===0)&&s.endQuick(this.outSampleRate)}channelSetPresetIndex(e,t){this.channelInit(e).presetIndex=Ce.int32ToUint16(t)}channelSetPresetNumber(e,t,s=!1){const r=this.channelInit(e);let n=0;return s?(n=this.getPresetIndex(128|r.bank&32767,t),n===-1&&(n=this.getPresetIndex(128,t)),n===-1&&(n=this.getPresetIndex(128,0)),n===-1&&(n=this.getPresetIndex(r.bank&2047,t))):n=this.getPresetIndex(r.bank&2047,t),r.presetIndex=n,n!==-1}channelSetBank(e,t){this.channelInit(e).bank=Ce.int32ToUint16(t)}channelSetBankPreset(e,t,s){const r=this.channelInit(e),n=this.getPresetIndex(t,s);return n===-1?!1:(r.presetIndex=Ce.int32ToUint16(n),r.bank=Ce.int32ToUint16(t),!0)}channelSetPan(e,t){for(const s of this._voices)if(s.playingChannel===e&&s.playingPreset!==-1){let r=s.region.pan+t-.5;r<=-.5?(s.panFactorLeft=1,s.panFactorRight=0):r>=.5?(s.panFactorLeft=0,s.panFactorRight=1):(s.panFactorLeft=Math.sqrt(.5-r),s.panFactorRight=Math.sqrt(.5+r))}this.channelInit(e).panOffset=t-.5}channelSetVolume(e,t){const s=this.channelInit(e),r=Nt.gainToDecibels(t),n=r-s.gainDb;if(n!==0){for(const a of this._voices)a.playingChannel===e&&a.playingPreset!==-1&&(a.noteGainDb+=n);s.gainDb=r}}channelSetPitchWheel(e,t){const s=this.channelInit(e);s.pitchWheel!==t&&(s.pitchWheel=Ce.int32ToUint16(t),this.channelApplyPitch(e,s))}channelSetPerNotePitchWheel(e,t,s){this._transpositionPitches.has(e)&&(t+=this._transpositionPitches.get(e)),this._liveTranspositionPitches.has(e)&&(t+=this._liveTranspositionPitches.get(e));const r=this.channelInit(e);r.perNotePitchWheel.has(t)&&r.perNotePitchWheel.get(t)===s||(r.perNotePitchWheel.set(t,s),this.channelApplyPitch(e,r,t))}channelApplyPitch(e,t,s=-1){for(const r of this._voices)r.playingChannel===e&&r.playingPreset!==-1&&(s==-1||r.playingKey===s)&&r.updatePitchRatio(t,this.outSampleRate)}channelSetPitchRange(e,t){const s=this.channelInit(e);s.pitchRange!==t&&(s.pitchRange=t,s.pitchWheel!==8192&&this.channelApplyPitch(e,s))}channelSetTuning(e,t){const s=this.channelInit(e);s.tuning!==t&&(s.tuning=t,this.channelApplyPitch(e,s))}channelMidiControl(e,t,s){let r=this.channelInit(e);switch(t){case Ke.DataEntryFine:r.midiData=Ce.int32ToUint16(r.midiData&16256|s),r.midiRpn===0?this.channelSetPitchRange(e,(r.midiData>>7)+.01*(r.midiData&127)):r.midiRpn===1?this.channelSetTuning(e,(r.tuning|0)+(r.midiData-8192)/8192):r.midiRpn===2&&this.channelSetTuning(e,s-64+(r.tuning-(r.tuning|0)));return;case Ke.VolumeCoarse:r.midiVolume=Ce.int32ToUint16(r.midiVolume&127|s<<7),this.channelSetVolume(e,Math.pow(r.midiVolume/16383*(r.midiExpression/16383),3));return;case Ke.VolumeFine:r.midiVolume=Ce.int32ToUint16(r.midiVolume&16256|s),this.channelSetVolume(e,Math.pow(r.midiVolume/16383*(r.midiExpression/16383),3));return;case Ke.ExpressionControllerCoarse:r.midiExpression=Ce.int32ToUint16(r.midiExpression&127|s<<7),this.channelSetVolume(e,Math.pow(r.midiVolume/16383*(r.midiExpression/16383),3));return;case Ke.ExpressionControllerFine:r.midiExpression=Ce.int32ToUint16(r.midiExpression&16256|s),this.channelSetVolume(e,Math.pow(r.midiVolume/16383*(r.midiExpression/16383),3));return;case Ke.PanCoarse:r.midiPan=Ce.int32ToUint16(r.midiPan&127|s<<7),this.channelSetPan(e,r.midiPan/16383);return;case Ke.PanFine:r.midiPan=Ce.int32ToUint16(r.midiPan&16256|s),this.channelSetPan(e,r.midiPan/16383);return;case Ke.DataEntryCoarse:r.midiData=Ce.int32ToUint16(r.midiData&127|s<<7),r.midiRpn===0?this.channelSetPitchRange(e,(r.midiData>>7)+.01*(r.midiData&127)):r.midiRpn===1?this.channelSetTuning(e,(r.tuning|0)+(r.midiData-8192)/8192):r.midiRpn===2&&t===Ke.DataEntryCoarse&&this.channelSetTuning(e,s-64+(r.tuning-(r.tuning|0)));return;case Ke.BankSelectCoarse:r.bank=Ce.int32ToUint16(32768|s);return;case Ke.BankSelectFine:r.bank=Ce.int32ToUint16((r.bank&32768?(r.bank&127)<<7:0)|s);return;case Ke.RegisteredParameterCourse:r.midiRpn=Ce.int32ToUint16((r.midiRpn===65535?0:r.midiRpn)&127|s<<7);return;case Ke.RegisteredParameterFine:r.midiRpn=Ce.int32ToUint16((r.midiRpn===65535?0:r.midiRpn)&16256|s);return;case Ke.NonRegisteredParameterFine:r.midiRpn=65535;return;case Ke.NonRegisteredParameterCourse:r.midiRpn=65535;return;case Ke.AllSoundOff:this.channelSoundsOffAll(e);return;case Ke.AllNotesOff:this.channelNoteOffAll(e);return;case Ke.ResetControllers:r.midiVolume=16383,r.midiExpression=16383,r.midiPan=8192,r.bank=0,this.channelSetVolume(e,1),this.channelSetPan(e,.5),this.channelSetPitchRange(e,2);return}}channelGetPresetIndex(e){return this._channels&&e<this._channels.channelList.length?this._channels.channelList[e].presetIndex:0}channelGetPresetBank(e){return this._channels&&e<this._channels.channelList.length?this._channels.channelList[e].bank&32767:0}channelGetPan(e){return this._channels&&e<this._channels.channelList.length?this._channels.channelList[e].panOffset-.5:.5}channelGetVolume(e){return this._channels&&e<this._channels.channelList.length?Nt.decibelsToGain(this._channels.channelList[e].gainDb):1}channelGetPitchWheel(e){return this._channels&&e<this._channels.channelList.length?this._channels.channelList[e].pitchWheel:8192}channelGetPitchRange(e){return this._channels&&e<this._channels.channelList.length?this._channels.channelList[e].pitchRange:2}channelGetTuning(e){return this._channels&&e<this._channels.channelList.length?this._channels.channelList[e].tuning:0}resetPresets(){this.presets=[]}loadPresets(e,t){const s=[];for(let r=0;r<e.phdrs.length-1;r++){const n=e.phdrs[r];let a=0;const o=new nO;s.push(o),o.name=n.presetName,o.bank=n.bank,o.presetNumber=n.preset,o.fontSamples=e.fontSamples;let l=0;for(let h=n.presetBagNdx;h<e.phdrs[r+1].presetBagNdx;h++){const c=e.pbags[h];let d=0,f=127,p=0,g=127;for(let b=c.genNdx;b<e.pbags[h+1].genNdx;b++){let m=e.pgens[b];if(m.genOper===ls.GenKeyRange){d=m.genAmount.lowByteAmount,f=m.genAmount.highByteAmount;continue}if(m.genOper===ls.GenVelRange){p=m.genAmount.lowByteAmount,g=m.genAmount.highByteAmount;continue}if(m.genOper!==ls.GenInstrument||m.genAmount.wordAmount>=e.insts.length)continue;let y=e.insts[m.genAmount.wordAmount];for(let w=y.instBagNdx;w<e.insts[m.genAmount.wordAmount+1].instBagNdx;w++){let x=e.ibags[w],k=0,_=127,T=0,C=127;for(let W=x.instGenNdx;W<e.ibags[w+1].instGenNdx;W++){let z=e.igens[W];if(z.genOper===ls.GenKeyRange){k=z.genAmount.lowByteAmount,_=z.genAmount.highByteAmount;continue}if(z.genOper===ls.GenVelRange){T=z.genAmount.lowByteAmount,C=z.genAmount.highByteAmount;continue}z.genOper===53&&_>=d&&k<=f&&C>=p&&T<=g&&l++}}}}o.regions=new Array(l);let u=new Qa;u.clear(!0);for(let h=n.presetBagNdx;h<e.phdrs[r+1].presetBagNdx;h++){const c=e.pbags[h],d=new Qa(u);let f=!1;for(let p=c.genNdx;p<e.pbags[h+1].genNdx;p++){const g=e.pgens[p];if(g.genOper===ls.GenInstrument){let b=g.genAmount.wordAmount;if(b>=e.insts.length)continue;let m=new Qa;m.clear(!1);let y=e.insts[b];for(let w=y.instBagNdx;w<e.insts[b+1].instBagNdx;w++){let x=e.ibags[w],k=new Qa(m),_=!1;for(let T=x.instGenNdx;T<e.ibags[w+1].instGenNdx;T++){let C=e.igens[T];if(C.genOper===ls.GenSampleId){if(k.hiKey<d.loKey||k.loKey>d.hiKey||k.hiVel<d.loVel||k.loVel>d.hiVel)continue;d.loKey>k.loKey&&(k.loKey=d.loKey),d.hiKey<k.hiKey&&(k.hiKey=d.hiKey),d.loVel>k.loVel&&(k.loVel=d.loVel),d.hiVel<k.hiVel&&(k.hiVel=d.hiVel),k.offset+=d.offset,k.end+=d.end,k.loopStart+=d.loopStart,k.loopEnd+=d.loopEnd,k.transpose+=d.transpose,k.tune+=d.tune,k.pitchKeyTrack+=d.pitchKeyTrack,k.attenuation+=d.attenuation,k.pan+=d.pan,k.ampEnv.delay+=d.ampEnv.delay,k.ampEnv.attack+=d.ampEnv.attack,k.ampEnv.hold+=d.ampEnv.hold,k.ampEnv.decay+=d.ampEnv.decay,k.ampEnv.sustain+=d.ampEnv.sustain,k.ampEnv.release+=d.ampEnv.release,k.modEnv.delay+=d.modEnv.delay,k.modEnv.attack+=d.modEnv.attack,k.modEnv.hold+=d.modEnv.hold,k.modEnv.decay+=d.modEnv.decay,k.modEnv.sustain+=d.modEnv.sustain,k.modEnv.release+=d.modEnv.release,k.initialFilterQ+=d.initialFilterQ,k.initialFilterFc+=d.initialFilterFc,k.modEnvToPitch+=d.modEnvToPitch,k.modEnvToFilterFc+=d.modEnvToFilterFc,k.delayModLFO+=d.delayModLFO,k.freqModLFO+=d.freqModLFO,k.modLfoToPitch+=d.modLfoToPitch,k.modLfoToFilterFc+=d.modLfoToFilterFc,k.modLfoToVolume+=d.modLfoToVolume,k.delayVibLFO+=d.delayVibLFO,k.freqVibLFO+=d.freqVibLFO,k.vibLfoToPitch+=d.vibLfoToPitch,k.ampEnv.envToSecs(!0),k.modEnv.envToSecs(!1),k.delayModLFO=k.delayModLFO<-11950?0:Nt.timecents2Secs(k.delayModLFO),k.delayVibLFO=k.delayVibLFO<-11950?0:Nt.timecents2Secs(k.delayVibLFO),k.pan<-.5?k.pan=-.5:k.pan>.5&&(k.pan=.5),(k.initialFilterQ<1500||k.initialFilterQ>13500)&&(k.initialFilterQ=0);let W=e.sHdrs[C.genAmount.wordAmount];k.offset+=W.start,k.end+=W.end,k.loopStart+=W.startLoop,k.loopEnd+=W.endLoop,W.endLoop>0&&(k.loopEnd-=1),k.pitchKeyCenter===-1&&(k.pitchKeyCenter=W.originalPitch),k.tune+=W.pitchCorrection,k.sampleRate=W.sampleRate,k.end!==0&&k.end<o.fontSamples.length?k.end++:k.end=o.fontSamples.length,o.regions[a]=new Qa(k),a++,_=!0}else k.operator(C.genOper,C.genAmount)}x===e.ibags[y.instBagNdx]&&!_&&(m=new Qa(k))}f=!0}else d.operator(g.genOper,g.genAmount)}c===e.pbags[n.presetBagNdx]&&!f&&(u=d)}}if(!t||!this.presets)this.presets=s;else for(const r of s)this.presets.push(r)}}class Jt{constructor(){this._listeners=[]}on(e){this._listeners.push(e)}off(e){this._listeners=this._listeners.filter(t=>t!==e)}trigger(){for(const e of this._listeners)e()}}class He{constructor(){this._listeners=[]}on(e){this._listeners.push(e)}off(e){this._listeners=this._listeners.filter(t=>t!==e)}trigger(e){for(const t of this._listeners)t(e)}}class H0{constructor(e){this.events=e}}class z0{constructor(e){this.playbackRange=e}}class F_{get isReadyForPlayback(){return this.isReady&&this._isSoundFontLoaded&&this._isMidiLoaded}get logLevel(){return I.logLevel}set logLevel(e){I.logLevel=e}get masterVolume(){return this._synthesizer.masterVolume}set masterVolume(e){e=Math.max(e,Ne.MinVolume),this._synthesizer.masterVolume=e}get metronomeVolume(){return this._metronomeVolume}set metronomeVolume(e){e=Math.max(e,Ne.MinVolume),this._metronomeVolume=e,this._synthesizer.metronomeVolume=e}get countInVolume(){return this._countInVolume}set countInVolume(e){e=Math.max(e,Ne.MinVolume),this._countInVolume=e}get midiEventsPlayedFilter(){return Array.from(this._midiEventsPlayedFilter)}set midiEventsPlayedFilter(e){this._midiEventsPlayedFilter=new Set(e)}get playbackSpeed(){return this._sequencer.playbackSpeed}set playbackSpeed(e){e=Nt.clamp(e,Ne.MinPlaybackSpeed,Ne.MaxPlaybackSpeed);let t=this._sequencer.playbackSpeed;this._sequencer.playbackSpeed=e,this.timePosition=this.timePosition*(t/e)}get tickPosition(){return this._tickPosition}set tickPosition(e){this.timePosition=this._sequencer.mainTickPositionToTimePosition(e)}get timePosition(){return this._timePosition}set timePosition(e){I.debug("AlphaSynth",`Seeking to position ${e}ms (main)`),this._sequencer.mainSeek(e),this.updateTimePosition(e,!0),this._sequencer.isPlayingMain&&(this._notPlayedSamples=0,this.output.resetSamples())}get playbackRange(){return this._sequencer.mainPlaybackRange}set playbackRange(e){this._sequencer.mainPlaybackRange=e,e&&(this.tickPosition=e.startTick),this.playbackRangeChanged.trigger(new z0(e))}get isLooping(){return this._sequencer.isLooping}set isLooping(e){this._sequencer.isLooping=e}destroy(){I.debug("AlphaSynth","Destroying player"),this.stop(),this.output.destroy()}constructor(e,t){this._isSoundFontLoaded=!1,this._isMidiLoaded=!1,this._tickPosition=0,this._timePosition=0,this._metronomeVolume=0,this._countInVolume=0,this._playedEventsQueue=new $g,this._midiEventsPlayedFilter=new Set,this._notPlayedSamples=0,this._synthStopping=!1,this.isReady=!1,this.state=zt.Paused,this.ready=new Jt,this.readyForPlayback=new Jt,this.finished=new Jt,this.soundFontLoaded=new Jt,this.soundFontLoadFailed=new He,this.midiLoaded=new He,this.midiLoadFailed=new He,this.stateChanged=new He,this.positionChanged=new He,this.midiEventsPlayed=new He,this.playbackRangeChanged=new He,I.debug("AlphaSynth","Initializing player"),this.state=zt.Paused,I.debug("AlphaSynth","Creating output"),this.output=e,I.debug("AlphaSynth","Creating synthesizer"),this._synthesizer=new aO(this.output.sampleRate),this._sequencer=new iO(this._synthesizer),I.debug("AlphaSynth","Opening output"),this.output.ready.on(()=>{this.isReady=!0,this.ready.trigger(),this.checkReadyForPlayback()}),this.output.sampleRequest.on(()=>{if(this.state==zt.Playing&&(!this._sequencer.isFinished||this._synthesizer.activeVoiceCount>0)){let s=new Float32Array(Ne.MicroBufferSize*Ne.MicroBufferCount*Ne.AudioChannels),r=0;for(let n=0;n<Ne.MicroBufferCount;n++){this._sequencer.fillMidiEventQueue();const a=this._synthesizer.synthesize(s,r,Ne.MicroBufferSize);r+=Ne.MicroBufferSize*Ne.AudioChannels;for(const o of a)this._midiEventsPlayedFilter.has(o.event.type)&&this._playedEventsQueue.enqueue(o);if(this._sequencer.isFinished)break}r<s.length&&(s=s.subarray(0,r)),this._notPlayedSamples+=s.length,this.output.addSamples(s)}else{let s=new Float32Array(0);this.output.addSamples(s)}}),this.output.samplesPlayed.on(this.onSamplesPlayed.bind(this)),this.output.open(t)}play(){return this.state!==zt.Paused||!this._isMidiLoaded?!1:(this.output.activate(),this.playInternal(),this._countInVolume>0&&(I.debug("AlphaSynth","Starting countin"),this._sequencer.startCountIn(),this._synthesizer.setupMetronomeChannel(this._countInVolume),this.updateTimePosition(0,!0)),this.output.play(),!0)}playInternal(){this._sequencer.isPlayingOneTimeMidi&&(I.debug("AlphaSynth","Cancelling one time midi"),this.stopOneTimeMidi()),I.debug("AlphaSynth","Starting playback"),this._synthesizer.setupMetronomeChannel(this.metronomeVolume),this._synthStopping=!1,this.state=zt.Playing,this.stateChanged.trigger(new Ll(this.state,!1))}pause(){this.state===zt.Paused||!this._isMidiLoaded||(I.debug("AlphaSynth","Pausing playback"),this.state=zt.Paused,this.stateChanged.trigger(new Ll(this.state,!1)),this.output.pause(),this._synthesizer.noteOffAll(!1))}playPause(){this.state!==zt.Paused||!this._isMidiLoaded?this.pause():this.play()}stop(){this._isMidiLoaded&&(I.debug("AlphaSynth","Stopping playback"),this.state=zt.Paused,this.output.pause(),this._notPlayedSamples=0,this._sequencer.stop(),this._synthesizer.noteOffAll(!0),this.tickPosition=this._sequencer.mainPlaybackRange?this._sequencer.mainPlaybackRange.startTick:0,this.stateChanged.trigger(new Ll(this.state,!0)))}playOneTimeMidiFile(e){this._sequencer.isPlayingOneTimeMidi?this.stopOneTimeMidi():this.pause(),this._sequencer.loadOneTimeMidi(e),this._synthesizer.noteOffAll(!0),this.updateTimePosition(0,!0),this._notPlayedSamples=0,this.output.resetSamples(),this.output.play()}resetSoundFonts(){this.stop(),this._synthesizer.resetPresets(),this._isSoundFontLoaded=!1,this.soundFontLoaded.trigger()}loadSoundFont(e,t){this.pause();let s=si.fromBuffer(e);try{I.debug("AlphaSynth","Loading soundfont from bytes");let r=new V0;r.load(s),this._synthesizer.loadPresets(r,t),this._isSoundFontLoaded=!0,this.soundFontLoaded.trigger(),I.debug("AlphaSynth","soundFont successfully loaded"),this.checkReadyForPlayback()}catch(r){I.error("AlphaSynth","Could not load soundfont from bytes "+r),this.soundFontLoadFailed.trigger(r)}}checkReadyForPlayback(){this.isReadyForPlayback&&(this._synthesizer.setupMetronomeChannel(this.metronomeVolume),this.readyForPlayback.trigger())}loadMidiFile(e){this.stop();try{I.debug("AlphaSynth","Loading midi from model"),this._sequencer.loadMidi(e),this._isMidiLoaded=!0,this.midiLoaded.trigger(new cu(0,this._sequencer.currentEndTime,0,this._sequencer.currentEndTick,!1)),I.debug("AlphaSynth","Midi successfully loaded"),this.checkReadyForPlayback(),this.tickPosition=0}catch(t){I.error("AlphaSynth","Could not load midi from model "+t),this.midiLoadFailed.trigger(t)}}applyTranspositionPitches(e){this._synthesizer.applyTranspositionPitches(e)}setChannelTranspositionPitch(e,t){this._synthesizer.setChannelTranspositionPitch(e,t)}setChannelMute(e,t){this._synthesizer.channelSetMute(e,t)}resetChannelStates(){this._synthesizer.resetChannelStates()}setChannelSolo(e,t){this._synthesizer.channelSetSolo(e,t)}setChannelVolume(e,t){t=Math.max(t,Ne.MinVolume),this._synthesizer.channelSetMixVolume(e,t)}onSamplesPlayed(e){if(e===0)return;let t=e/this._synthesizer.outSampleRate*1e3;this._notPlayedSamples-=e*Ne.AudioChannels,this.updateTimePosition(this._timePosition+t,!1),this.checkForFinish()}checkForFinish(){let e=0,t=0;this.playbackRange&&this._sequencer.isPlayingMain?(e=this.playbackRange.startTick,t=this.playbackRange.endTick):t=this._sequencer.currentEndTick,this._tickPosition>=t&&this._notPlayedSamples<=0&&(this._notPlayedSamples=0,this._sequencer.isPlayingCountIn?(I.debug("AlphaSynth","Finished playback (count-in)"),this._sequencer.resetCountIn(),this.timePosition=this._sequencer.currentTime,this.playInternal(),this.output.resetSamples()):this._sequencer.isPlayingOneTimeMidi?(I.debug("AlphaSynth","Finished playback (one time)"),this.output.resetSamples(),this.state=zt.Paused,this.stopOneTimeMidi()):this.isLooping?(I.debug("AlphaSynth","Finished playback (main looping)"),this.finished.trigger(),this.tickPosition=e,this._synthStopping=!1):this._synthesizer.activeVoiceCount>0?this._synthStopping||(this._synthesizer.noteOffAll(!0),this._synthStopping=!0):(this._synthStopping=!1,I.debug("AlphaSynth","Finished playback (main)"),this.finished.trigger(),this.stop()))}stopOneTimeMidi(){this.output.pause(),this._synthesizer.noteOffAll(!0),this._sequencer.resetOneTimeMidi(),this.timePosition=this._sequencer.currentTime}updateTimePosition(e,t){let s=e;this._timePosition=s;let r=this._sequencer.currentTimePositionToTickPosition(s);this._tickPosition=r;const n=this._sequencer.currentEndTime,a=this._sequencer.currentEndTick;s>n&&(s=n,r=a);const o=this._sequencer.isPlayingMain?"main":this._sequencer.isPlayingCountIn?"count-in":"one-time";if(I.debug("AlphaSynth",`Position changed: (time: ${s}/${n}, tick: ${r}/${a}, Active Voices: ${this._synthesizer.activeVoiceCount} (${o})`),this._sequencer.isPlayingMain&&this.positionChanged.trigger(new cu(s,n,r,a,t)),t)this._playedEventsQueue.clear();else{const l=new $g;for(;!this._playedEventsQueue.isEmpty&&this._playedEventsQueue.peek().time<s;){const u=this._playedEventsQueue.dequeue();l.enqueue(u.event)}l.isEmpty||this.midiEventsPlayed.trigger(new H0(l.toArray()))}}}class ${static parseEnum(e,t){switch(typeof e){case"string":const s=parseInt(e);return isNaN(s)?t[Object.keys(t).find(r=>r.toLowerCase()===e.toLowerCase())]:s;case"number":return e;case"undefined":case"object":return null}throw new ni(ri.Format,`Could not parse enum value '${e}'`)}static forEach(e,t){if(e instanceof Map)e.forEach(t);else if(typeof e=="object")for(const s in e)t(e[s],s)}static getValue(e,t){return e instanceof Map?e.get(t):typeof e=="object"?e[t]:null}}class oO{constructor(e,t,s){this.text=e,this.startPos=t,this.endPos=s}}class po{constructor(e){this.style="normal",this.variant="normal",this.weight="normal",this.stretch="normal",this.lineHeight="normal",this.size="1rem",this.families=[],this.parseOnlyFamilies=!1,this._currentTokenIndex=-1,this._input="",this._currentToken=null,this._input=e,this._tokens=this.splitToTokens(e)}splitToTokens(e){const t=[];let s=0;for(;s<e.length;){let r=s;for(;r<e.length&&e.charAt(r)!==" ";)r++;r>s&&t.push(new oO(e.substring(s,r),s,r)),s=r+1}return t}parse(){var e;if(this.reset(),this._tokens.length===1)switch((e=this._currentToken)==null?void 0:e.text){case"caption":case"icon":case"menu":case"message-box":case"small-caption":case"status-bar":case"inherit":return}this.parseOnlyFamilies||(this.fontStyleVariantWeight(),this.fontSizeLineHeight()),this.fontFamily()}static parseFamilies(e){const t=new po(e);return t.parseOnlyFamilies=!0,t.parse(),t.families}fontFamily(){if(!this._currentToken){if(this.parseOnlyFamilies)return;throw new Error("Missing font list")}const e=this._input.substr(this._currentToken.startPos).trim();let t=0;for(;t<e.length;){let s=e.charAt(t);if(s===" "||s==",")t++;else if(s==='"'||s==="'"){const r=this.findEndOfQuote(e,t+1,s);this.families.push(e.substring(t+1,r).split("\\"+s).join(s)),t=r+1}else{const r=this.findEndOfQuote(e,t+1,",");this.families.push(e.substring(t,r).trim()),t=r+1}}}findEndOfQuote(e,t,s){let r=!1;for(;t<e.length;){const n=e.charAt(t);if(!r&&n===s)return t;!r&&n==="\\"?r=!0:r=!1,t+=1}return e.length}fontSizeLineHeight(){if(!this._currentToken)throw new Error("Missing font size");const e=this._currentToken.text.split("/");if(e.length>=3)throw new Error(`Invalid font size '${this._currentToken}' specified`);if(this.nextToken(),e.length>=2)if(e[1]==="/"){if(!this._currentToken)throw new Error("Missing line-height after font size");this.lineHeight=this._currentToken.text,this.nextToken()}else this.size=e[0],this.lineHeight=e[1];else if(e.length>=1){if(this.size=e[0],this._currentToken&&this._currentToken.text.indexOf("/")===0)if(this._currentToken.text==="/"){if(this.nextToken(),!this._currentToken)throw new Error("Missing line-height after font size");this.lineHeight=this._currentToken.text,this.nextToken()}else this.lineHeight=this._currentToken.text.substr(1),this.nextToken()}else throw new Error("Missing font size")}nextToken(){this._currentTokenIndex++,this._currentTokenIndex<this._tokens.length?this._currentToken=this._tokens[this._currentTokenIndex]:this._currentToken=null}fontStyleVariantWeight(){let e=!1,t=!1,s=!1,r=3,n=[];for(;;){if(!this._currentToken)return;let a=this._currentToken.text;switch(a){case"normal":case"inherit":n.push(a),r--,this.nextToken();break;case"italic":case"oblique":this.style=a,e=!0,r--,this.nextToken();break;case"small-caps":this.variant=a,t=!0,r--,this.nextToken();break;case"bold":case"bolder":case"lighter":case"100":case"200":case"300":case"400":case"500":case"600":case"700":case"800":case"900":this.weight=a,s=!0,r--,this.nextToken();break;default:return}if(r===0)break}for(;n.length>0;){const a=n.pop();s?t?e||(this.style=a):this.variant=a:this.weight=a}}reset(){this._currentTokenIndex=-1,this.nextToken()}static quoteFont(e){return e.indexOf(" ")===-1?e:`"${e.replaceAll('"','\\"')}"`}}var gt;(function(i){i[i.Plain=0]="Plain",i[i.Italic=1]="Italic"})(gt||(gt={}));var hs;(function(i){i[i.Regular=0]="Regular",i[i.Bold=1]="Bold"})(hs||(hs={}));class Be{reset(){this._cssScale=0,this._css=this.toCssString()}get family(){return this._families[0]}set family(e){this.families=po.parseFamilies(e)}get families(){return this._families}set families(e){this._families=e,this.reset()}get size(){return this._size}set size(e){this._size=e,this.reset()}get style(){return this._style}set style(e){this._style=e,this.reset()}get weight(){return this._weight}set weight(e){this._weight=e,this.reset()}get isBold(){return this.weight===hs.Bold}get isItalic(){return this.style===gt.Italic}constructor(e,t,s=gt.Plain,r=hs.Regular){this._cssScale=0,this._families=po.parseFamilies(e),this._size=t,this._style=s,this._weight=r,this._css=this.toCssString()}static withFamilyList(e,t,s=gt.Plain,r=hs.Regular){const n=new Be("",t,s,r);return n.families=e,n}toCssString(e=1){if(!this._css||!(Math.abs(e-this._cssScale)<.01)){let t="";this.isBold&&(t+="bold "),this.isItalic&&(t+="italic "),t+=this.size*e,t+="px ",t+=this.families.map(s=>po.quoteFont(s)).join(", "),this._css=t,this._cssScale=e}return this._css}static fromJson(e){if(e instanceof Be)return e;switch(typeof e){case"undefined":return null;case"object":{const t=e;let s=t.get("families"),r=t.get("size"),n=$.parseEnum(t.get("style"),gt),a=$.parseEnum(t.get("weight"),hs);return Be.withFamilyList(s,r,n,a)}case"string":{const t=new po(e);t.parse();let s=t.families,r=t.size.toLowerCase(),n=0;switch(r){case"xx-small":n=7;break;case"x-small":n=10;break;case"small":case"smaller":n=13;break;case"medium":n=16;break;case"large":case"larger":n=18;break;case"x-large":n=24;break;case"xx-large":n=32;break;default:try{r.endsWith("em")?n=parseFloat(r.substr(0,r.length-2))*16:r.endsWith("pt")?n=parseFloat(r.substr(0,r.length-2))*16/12:r.endsWith("px")?n=parseFloat(r.substr(0,r.length-2)):n=12}catch{n=12}break}let a=gt.Plain;t.style==="italic"&&(a=gt.Italic);let o=hs.Regular;switch(t.weight.toLowerCase()){case"normal":case"lighter":break;default:o=hs.Bold;break}return Be.withFamilyList(s,n,a,o)}default:return null}}static toJson(e){const t=new Map;return t.set("families",e.families),t.set("size",e.size),t.set("style",e.style),t.set("weight",e.weight),t}}class Ni{constructor(){this.copyrightFont=new Be(Ni.sansFont,12,gt.Plain,hs.Bold),this.titleFont=new Be(Ni.serifFont,32,gt.Plain),this.subTitleFont=new Be(Ni.serifFont,20,gt.Plain),this.wordsFont=new Be(Ni.serifFont,15,gt.Plain),this.effectFont=new Be(Ni.serifFont,12,gt.Italic),this.fretboardNumberFont=new Be(Ni.sansFont,11,gt.Plain),this.numberedNotationFont=new Be(Ni.sansFont,16,gt.Plain),this.numberedNotationGraceFont=new Be(Ni.sansFont,14,gt.Plain),this.tablatureFont=new Be(Ni.sansFont,13,gt.Plain),this.graceFont=new Be(Ni.sansFont,11,gt.Plain),this.staffLineColor=new Je(165,165,165,255),this.barSeparatorColor=new Je(34,34,17,255),this.barNumberFont=new Be(Ni.sansFont,11,gt.Plain),this.barNumberColor=new Je(200,0,0,255),this.fingeringFont=new Be(Ni.serifFont,14,gt.Plain),this.inlineFingeringFont=new Be(Ni.serifFont,12,gt.Plain),this.markerFont=new Be(Ni.serifFont,14,gt.Plain,hs.Bold),this.mainGlyphColor=new Je(0,0,0,255),this.secondaryGlyphColor=new Je(0,0,0,100),this.scoreInfoColor=new Je(0,0,0,255)}}Ni.sansFont="Arial, sans-serif";Ni.serifFont="Georgia, serif";var Jn;(function(i){i[i.Automatic=0]="Automatic",i[i.UseModelLayout=1]="UseModelLayout"})(Jn||(Jn={}));class lO{constructor(){this.scale=1,this.stretchForce=1,this.layoutMode=rn.Page,this.staveProfile=Yr.Default,this.barsPerRow=-1,this.startBar=1,this.barCount=-1,this.barCountPerPartial=10,this.justifyLastSystem=!1,this.resources=new Ni,this.padding=[35,35],this.firstSystemPaddingTop=5,this.systemPaddingTop=10,this.systemPaddingBottom=20,this.lastSystemPaddingBottom=0,this.systemLabelPaddingLeft=0,this.systemLabelPaddingRight=5,this.accoladeBarPaddingRight=3,this.notationStaffPaddingTop=5,this.notationStaffPaddingBottom=5,this.effectStaffPaddingTop=0,this.effectStaffPaddingBottom=0,this.systemsLayoutMode=Jn.Automatic}}class uO{constructor(){this.encoding="utf-8",this.mergePartGroupsInMusicXml=!1,this.beatTextAsLyrics=!1}}var Qr;(function(i){i[i.Off=0]="Off",i[i.Continuous=1]="Continuous",i[i.OffScreen=2]="OffScreen"})(Qr||(Qr={}));class hO{constructor(){this.noteWideLength=480,this.noteWideAmplitude=2,this.noteSlightLength=480,this.noteSlightAmplitude=2,this.beatWideLength=240,this.beatWideAmplitude=3,this.beatSlightLength=240,this.beatSlightAmplitude=3}}class cO{constructor(){this.simpleSlidePitchOffset=6,this.simpleSlideDurationRatio=.25,this.shiftSlideDurationRatio=.5}}var pu;(function(i){i[i.WebAudioAudioWorklets=0]="WebAudioAudioWorklets",i[i.WebAudioScriptProcessor=1]="WebAudioScriptProcessor"})(pu||(pu={}));class dO{constructor(){this.soundFont=null,this.scrollElement="html,body",this.outputMode=pu.WebAudioAudioWorklets,this.enablePlayer=!1,this.enableCursor=!0,this.enableAnimatedBeatCursor=!0,this.enableElementHighlighting=!0,this.enableUserInteraction=!0,this.scrollOffsetX=0,this.scrollOffsetY=0,this.scrollMode=Qr.Continuous,this.scrollSpeed=300,this.nativeBrowserSmoothScroll=!0,this.songBookBendDuration=75,this.songBookDipDuration=150,this.vibrato=new hO,this.slide=new cO,this.playTripletFeel=!0,this.bufferTimeInMilliseconds=500}}class Gf{static fromJson(e,t){t&&$.forEach(t,(s,r)=>this.setProperty(e,r.toLowerCase(),s))}static toJson(e){if(!e)return null;const t=new Map;return t.set("scriptfile",e.scriptFile),t.set("fontdirectory",e.fontDirectory),t.set("file",e.file),t.set("tex",e.tex),t.set("tracks",e.tracks),t.set("enablelazyloading",e.enableLazyLoading),t.set("engine",e.engine),t.set("loglevel",e.logLevel),t.set("useworkers",e.useWorkers),t.set("includenotebounds",e.includeNoteBounds),t}static setProperty(e,t,s){switch(t){case"scriptfile":return e.scriptFile=s,!0;case"fontdirectory":return e.fontDirectory=s,!0;case"file":return e.file=s,!0;case"tex":return e.tex=s,!0;case"tracks":return e.tracks=s,!0;case"enablelazyloading":return e.enableLazyLoading=s,!0;case"engine":return e.engine=s,!0;case"loglevel":return e.logLevel=$.parseEnum(s,ur),!0;case"useworkers":return e.useWorkers=s,!0;case"includenotebounds":return e.includeNoteBounds=s,!0}return!1}}class jf{static fromJson(e,t){t&&$.forEach(t,(s,r)=>this.setProperty(e,r.toLowerCase(),s))}static toJson(e){if(!e)return null;const t=new Map;return t.set("copyrightfont",Be.toJson(e.copyrightFont)),t.set("titlefont",Be.toJson(e.titleFont)),t.set("subtitlefont",Be.toJson(e.subTitleFont)),t.set("wordsfont",Be.toJson(e.wordsFont)),t.set("effectfont",Be.toJson(e.effectFont)),t.set("fretboardnumberfont",Be.toJson(e.fretboardNumberFont)),t.set("numberednotationfont",Be.toJson(e.numberedNotationFont)),t.set("numberednotationgracefont",Be.toJson(e.numberedNotationGraceFont)),t.set("tablaturefont",Be.toJson(e.tablatureFont)),t.set("gracefont",Be.toJson(e.graceFont)),t.set("stafflinecolor",Je.toJson(e.staffLineColor)),t.set("barseparatorcolor",Je.toJson(e.barSeparatorColor)),t.set("barnumberfont",Be.toJson(e.barNumberFont)),t.set("barnumbercolor",Je.toJson(e.barNumberColor)),t.set("fingeringfont",Be.toJson(e.fingeringFont)),t.set("inlinefingeringfont",Be.toJson(e.inlineFingeringFont)),t.set("markerfont",Be.toJson(e.markerFont)),t.set("mainglyphcolor",Je.toJson(e.mainGlyphColor)),t.set("secondaryglyphcolor",Je.toJson(e.secondaryGlyphColor)),t.set("scoreinfocolor",Je.toJson(e.scoreInfoColor)),t}static setProperty(e,t,s){switch(t){case"copyrightfont":return e.copyrightFont=Be.fromJson(s),!0;case"titlefont":return e.titleFont=Be.fromJson(s),!0;case"subtitlefont":return e.subTitleFont=Be.fromJson(s),!0;case"wordsfont":return e.wordsFont=Be.fromJson(s),!0;case"effectfont":return e.effectFont=Be.fromJson(s),!0;case"fretboardnumberfont":return e.fretboardNumberFont=Be.fromJson(s),!0;case"numberednotationfont":return e.numberedNotationFont=Be.fromJson(s),!0;case"numberednotationgracefont":return e.numberedNotationGraceFont=Be.fromJson(s),!0;case"tablaturefont":return e.tablatureFont=Be.fromJson(s),!0;case"gracefont":return e.graceFont=Be.fromJson(s),!0;case"stafflinecolor":return e.staffLineColor=Je.fromJson(s),!0;case"barseparatorcolor":return e.barSeparatorColor=Je.fromJson(s),!0;case"barnumberfont":return e.barNumberFont=Be.fromJson(s),!0;case"barnumbercolor":return e.barNumberColor=Je.fromJson(s),!0;case"fingeringfont":return e.fingeringFont=Be.fromJson(s),!0;case"inlinefingeringfont":return e.inlineFingeringFont=Be.fromJson(s),!0;case"markerfont":return e.markerFont=Be.fromJson(s),!0;case"mainglyphcolor":return e.mainGlyphColor=Je.fromJson(s),!0;case"secondaryglyphcolor":return e.secondaryGlyphColor=Je.fromJson(s),!0;case"scoreinfocolor":return e.scoreInfoColor=Je.fromJson(s),!0}return!1}}class Uf{static fromJson(e,t){t&&$.forEach(t,(s,r)=>this.setProperty(e,r.toLowerCase(),s))}static toJson(e){if(!e)return null;const t=new Map;return t.set("scale",e.scale),t.set("stretchforce",e.stretchForce),t.set("layoutmode",e.layoutMode),t.set("staveprofile",e.staveProfile),t.set("barsperrow",e.barsPerRow),t.set("startbar",e.startBar),t.set("barcount",e.barCount),t.set("barcountperpartial",e.barCountPerPartial),t.set("justifylastsystem",e.justifyLastSystem),t.set("resources",jf.toJson(e.resources)),t.set("padding",e.padding),t.set("firstsystempaddingtop",e.firstSystemPaddingTop),t.set("systempaddingtop",e.systemPaddingTop),t.set("systempaddingbottom",e.systemPaddingBottom),t.set("lastsystempaddingbottom",e.lastSystemPaddingBottom),t.set("systemlabelpaddingleft",e.systemLabelPaddingLeft),t.set("systemlabelpaddingright",e.systemLabelPaddingRight),t.set("accoladebarpaddingright",e.accoladeBarPaddingRight),t.set("notationstaffpaddingtop",e.notationStaffPaddingTop),t.set("notationstaffpaddingbottom",e.notationStaffPaddingBottom),t.set("effectstaffpaddingtop",e.effectStaffPaddingTop),t.set("effectstaffpaddingbottom",e.effectStaffPaddingBottom),t.set("systemslayoutmode",e.systemsLayoutMode),t}static setProperty(e,t,s){switch(t){case"scale":return e.scale=s,!0;case"stretchforce":return e.stretchForce=s,!0;case"layoutmode":return e.layoutMode=$.parseEnum(s,rn),!0;case"staveprofile":return e.staveProfile=$.parseEnum(s,Yr),!0;case"barsperrow":return e.barsPerRow=s,!0;case"startbar":return e.startBar=s,!0;case"barcount":return e.barCount=s,!0;case"barcountperpartial":return e.barCountPerPartial=s,!0;case"justifylastsystem":return e.justifyLastSystem=s,!0;case"padding":return e.padding=s,!0;case"firstsystempaddingtop":return e.firstSystemPaddingTop=s,!0;case"systempaddingtop":return e.systemPaddingTop=s,!0;case"systempaddingbottom":return e.systemPaddingBottom=s,!0;case"lastsystempaddingbottom":return e.lastSystemPaddingBottom=s,!0;case"systemlabelpaddingleft":return e.systemLabelPaddingLeft=s,!0;case"systemlabelpaddingright":return e.systemLabelPaddingRight=s,!0;case"accoladebarpaddingright":return e.accoladeBarPaddingRight=s,!0;case"notationstaffpaddingtop":return e.notationStaffPaddingTop=s,!0;case"notationstaffpaddingbottom":return e.notationStaffPaddingBottom=s,!0;case"effectstaffpaddingtop":return e.effectStaffPaddingTop=s,!0;case"effectstaffpaddingbottom":return e.effectStaffPaddingBottom=s,!0;case"systemslayoutmode":return e.systemsLayoutMode=$.parseEnum(s,Jn),!0}if(["resources"].indexOf(t)>=0)return jf.fromJson(e.resources,s),!0;for(const r of["resources"])if(t.indexOf(r)===0&&jf.setProperty(e.resources,t.substring(r.length),s))return!0;return!1}}class $f{static fromJson(e,t){t&&$.forEach(t,(s,r)=>this.setProperty(e,r.toLowerCase(),s))}static toJson(e){if(!e)return null;const t=new Map;t.set("notationmode",e.notationMode),t.set("fingeringmode",e.fingeringMode);{const s=new Map;t.set("elements",s);for(const[r,n]of e.elements)s.set(r.toString(),n)}return t.set("rhythmmode",e.rhythmMode),t.set("rhythmheight",e.rhythmHeight),t.set("transpositionpitches",e.transpositionPitches),t.set("displaytranspositionpitches",e.displayTranspositionPitches),t.set("smallgracetabnotes",e.smallGraceTabNotes),t.set("extendbendarrowsontiednotes",e.extendBendArrowsOnTiedNotes),t.set("extendlineeffectstobeatend",e.extendLineEffectsToBeatEnd),t.set("slurheight",e.slurHeight),t}static setProperty(e,t,s){switch(t){case"notationmode":return e.notationMode=$.parseEnum(s,Qt),!0;case"fingeringmode":return e.fingeringMode=$.parseEnum(s,Sr),!0;case"elements":return e.elements=new Map,$.forEach(s,(r,n)=>{e.elements.set($.parseEnum(n,me),r)}),!0;case"rhythmmode":return e.rhythmMode=$.parseEnum(s,Zr),!0;case"rhythmheight":return e.rhythmHeight=s,!0;case"transpositionpitches":return e.transpositionPitches=s,!0;case"displaytranspositionpitches":return e.displayTranspositionPitches=s,!0;case"smallgracetabnotes":return e.smallGraceTabNotes=s,!0;case"extendbendarrowsontiednotes":return e.extendBendArrowsOnTiedNotes=s,!0;case"extendlineeffectstobeatend":return e.extendLineEffectsToBeatEnd=s,!0;case"slurheight":return e.slurHeight=s,!0}return!1}}class Yf{static fromJson(e,t){t&&$.forEach(t,(s,r)=>this.setProperty(e,r.toLowerCase(),s))}static toJson(e){if(!e)return null;const t=new Map;return t.set("encoding",e.encoding),t.set("mergepartgroupsinmusicxml",e.mergePartGroupsInMusicXml),t.set("beattextaslyrics",e.beatTextAsLyrics),t}static setProperty(e,t,s){switch(t){case"encoding":return e.encoding=s,!0;case"mergepartgroupsinmusicxml":return e.mergePartGroupsInMusicXml=s,!0;case"beattextaslyrics":return e.beatTextAsLyrics=s,!0}return!1}}class Xf{static fromJson(e,t){t&&$.forEach(t,(s,r)=>this.setProperty(e,r.toLowerCase(),s))}static toJson(e){if(!e)return null;const t=new Map;return t.set("notewidelength",e.noteWideLength),t.set("notewideamplitude",e.noteWideAmplitude),t.set("noteslightlength",e.noteSlightLength),t.set("noteslightamplitude",e.noteSlightAmplitude),t.set("beatwidelength",e.beatWideLength),t.set("beatwideamplitude",e.beatWideAmplitude),t.set("beatslightlength",e.beatSlightLength),t.set("beatslightamplitude",e.beatSlightAmplitude),t}static setProperty(e,t,s){switch(t){case"notewidelength":return e.noteWideLength=s,!0;case"notewideamplitude":return e.noteWideAmplitude=s,!0;case"noteslightlength":return e.noteSlightLength=s,!0;case"noteslightamplitude":return e.noteSlightAmplitude=s,!0;case"beatwidelength":return e.beatWideLength=s,!0;case"beatwideamplitude":return e.beatWideAmplitude=s,!0;case"beatslightlength":return e.beatSlightLength=s,!0;case"beatslightamplitude":return e.beatSlightAmplitude=s,!0}return!1}}class Qf{static fromJson(e,t){t&&$.forEach(t,(s,r)=>this.setProperty(e,r.toLowerCase(),s))}static toJson(e){if(!e)return null;const t=new Map;return t.set("simpleslidepitchoffset",e.simpleSlidePitchOffset),t.set("simpleslidedurationratio",e.simpleSlideDurationRatio),t.set("shiftslidedurationratio",e.shiftSlideDurationRatio),t}static setProperty(e,t,s){switch(t){case"simpleslidepitchoffset":return e.simpleSlidePitchOffset=s,!0;case"simpleslidedurationratio":return e.simpleSlideDurationRatio=s,!0;case"shiftslidedurationratio":return e.shiftSlideDurationRatio=s,!0}return!1}}class Jf{static fromJson(e,t){t&&$.forEach(t,(s,r)=>this.setProperty(e,r.toLowerCase(),s))}static toJson(e){if(!e)return null;const t=new Map;return t.set("soundfont",e.soundFont),t.set("outputmode",e.outputMode),t.set("enableplayer",e.enablePlayer),t.set("enablecursor",e.enableCursor),t.set("enableanimatedbeatcursor",e.enableAnimatedBeatCursor),t.set("enableelementhighlighting",e.enableElementHighlighting),t.set("enableuserinteraction",e.enableUserInteraction),t.set("scrolloffsetx",e.scrollOffsetX),t.set("scrolloffsety",e.scrollOffsetY),t.set("scrollmode",e.scrollMode),t.set("scrollspeed",e.scrollSpeed),t.set("nativebrowsersmoothscroll",e.nativeBrowserSmoothScroll),t.set("songbookbendduration",e.songBookBendDuration),t.set("songbookdipduration",e.songBookDipDuration),t.set("vibrato",Xf.toJson(e.vibrato)),t.set("slide",Qf.toJson(e.slide)),t.set("playtripletfeel",e.playTripletFeel),t.set("buffertimeinmilliseconds",e.bufferTimeInMilliseconds),t}static setProperty(e,t,s){switch(t){case"soundfont":return e.soundFont=s,!0;case"scrollelement":return e.scrollElement=s,!0;case"outputmode":return e.outputMode=$.parseEnum(s,pu),!0;case"enableplayer":return e.enablePlayer=s,!0;case"enablecursor":return e.enableCursor=s,!0;case"enableanimatedbeatcursor":return e.enableAnimatedBeatCursor=s,!0;case"enableelementhighlighting":return e.enableElementHighlighting=s,!0;case"enableuserinteraction":return e.enableUserInteraction=s,!0;case"scrolloffsetx":return e.scrollOffsetX=s,!0;case"scrolloffsety":return e.scrollOffsetY=s,!0;case"scrollmode":return e.scrollMode=$.parseEnum(s,Qr),!0;case"scrollspeed":return e.scrollSpeed=s,!0;case"nativebrowsersmoothscroll":return e.nativeBrowserSmoothScroll=s,!0;case"songbookbendduration":return e.songBookBendDuration=s,!0;case"songbookdipduration":return e.songBookDipDuration=s,!0;case"playtripletfeel":return e.playTripletFeel=s,!0;case"buffertimeinmilliseconds":return e.bufferTimeInMilliseconds=s,!0}if(["vibrato"].indexOf(t)>=0)return Xf.fromJson(e.vibrato,s),!0;for(const r of["vibrato"])if(t.indexOf(r)===0&&Xf.setProperty(e.vibrato,t.substring(r.length),s))return!0;if(["slide"].indexOf(t)>=0)return Qf.fromJson(e.slide,s),!0;for(const r of["slide"])if(t.indexOf(r)===0&&Qf.setProperty(e.slide,t.substring(r.length),s))return!0;return!1}}class Ho{static fromJson(e,t){t&&$.forEach(t,(s,r)=>this.setProperty(e,r.toLowerCase(),s))}static toJson(e){if(!e)return null;const t=new Map;return t.set("core",Gf.toJson(e.core)),t.set("display",Uf.toJson(e.display)),t.set("notation",$f.toJson(e.notation)),t.set("importer",Yf.toJson(e.importer)),t.set("player",Jf.toJson(e.player)),t}static setProperty(e,t,s){if(["core",""].indexOf(t)>=0)return Gf.fromJson(e.core,s),!0;for(const r of["core",""])if(t.indexOf(r)===0&&Gf.setProperty(e.core,t.substring(r.length),s))return!0;if(["display",""].indexOf(t)>=0)return Uf.fromJson(e.display,s),!0;for(const r of["display",""])if(t.indexOf(r)===0&&Uf.setProperty(e.display,t.substring(r.length),s))return!0;if(["notation"].indexOf(t)>=0)return $f.fromJson(e.notation,s),!0;for(const r of["notation"])if(t.indexOf(r)===0&&$f.setProperty(e.notation,t.substring(r.length),s))return!0;if(["importer"].indexOf(t)>=0)return Yf.fromJson(e.importer,s),!0;for(const r of["importer"])if(t.indexOf(r)===0&&Yf.setProperty(e.importer,t.substring(r.length),s))return!0;if(["player"].indexOf(t)>=0)return Jf.fromJson(e.player,s),!0;for(const r of["player"])if(t.indexOf(r)===0&&Jf.setProperty(e.player,t.substring(r.length),s))return!0;return!1}}let gu=class V_{constructor(){this.core=new iT,this.display=new lO,this.notation=new lu,this.importer=new uO,this.player=new dO}setSongBookModeSettings(){this.notation.notationMode=Qt.SongBook,this.notation.smallGraceTabNotes=!1,this.notation.fingeringMode=Sr.SingleNoteEffectBand,this.notation.extendBendArrowsOnTiedNotes=!1,this.notation.elements.set(me.ParenthesisOnTiedBends,!1),this.notation.elements.set(me.TabNotesOnTiedBends,!1),this.notation.elements.set(me.ZerosOnDiveWhammys,!0)}static get songBook(){let e=new V_;return e.setSongBookModeSettings(),e}fillFromJson(e){Ho.fromJson(this,e)}};class Wb{static fromJson(e,t){t&&$.forEach(t,(s,r)=>this.setProperty(e,r,s))}static toJson(e){if(!e)return null;const t=new Map;return t.set("marker",e.marker),t.set("text",e.text),t}static setProperty(e,t,s){switch(t){case"marker":return e.marker=s,!0;case"text":return e.text=s,!0}return!1}}class Ic{static fromJson(e,t){t&&$.forEach(t,(s,r)=>this.setProperty(e,r,s))}static toJson(e){if(!e)return null;const t=new Map;return t.set("islinear",e.isLinear),t.set("type",e.type),t.set("value",e.value),t.set("ratioposition",e.ratioPosition),t.set("text",e.text),t}static setProperty(e,t,s){switch(t){case"islinear":return e.isLinear=s,!0;case"type":return e.type=$.parseEnum(s,jt),!0;case"value":return e.value=s,!0;case"ratioposition":return e.ratioPosition=s,!0;case"text":return e.text=s,!0}return!1}}class Gb{static fromJson(e,t){t&&$.forEach(t,(s,r)=>this.setProperty(e,r,s))}static toJson(e){if(!e)return null;const t=new Map;return t.set("type",e.type),t.set("length",e.length),t}static setProperty(e,t,s){switch(t){case"type":return e.type=$.parseEnum(s,yr),!0;case"length":return e.length=s,!0}return!1}}class jb{static fromJson(e,t){t&&$.forEach(t,(s,r)=>this.setProperty(e,r,s))}static toJson(e){if(!e)return null;const t=new Map;if(t.set("alternateendings",e.alternateEndings),t.set("keysignature",e.keySignature),t.set("keysignaturetype",e.keySignatureType),t.set("isdoublebar",e.isDoubleBar),t.set("isrepeatstart",e.isRepeatStart),t.set("repeatcount",e.repeatCount),t.set("timesignaturenumerator",e.timeSignatureNumerator),t.set("timesignaturedenominator",e.timeSignatureDenominator),t.set("timesignaturecommon",e.timeSignatureCommon),t.set("isfreetime",e.isFreeTime),t.set("tripletfeel",e.tripletFeel),t.set("section",Wb.toJson(e.section)),t.set("tempoautomations",e.tempoAutomations.map(s=>Ic.toJson(s))),e.fermata!==null){const s=new Map;t.set("fermata",s);for(const[r,n]of e.fermata)s.set(r.toString(),Gb.toJson(n))}return t.set("start",e.start),t.set("isanacrusis",e.isAnacrusis),t.set("displayscale",e.displayScale),t.set("displaywidth",e.displayWidth),t}static setProperty(e,t,s){switch(t){case"alternateendings":return e.alternateEndings=s,!0;case"keysignature":return e.keySignature=$.parseEnum(s,Le),!0;case"keysignaturetype":return e.keySignatureType=$.parseEnum(s,wr),!0;case"isdoublebar":return e.isDoubleBar=s,!0;case"isrepeatstart":return e.isRepeatStart=s,!0;case"repeatcount":return e.repeatCount=s,!0;case"timesignaturenumerator":return e.timeSignatureNumerator=s,!0;case"timesignaturedenominator":return e.timeSignatureDenominator=s,!0;case"timesignaturecommon":return e.timeSignatureCommon=s,!0;case"isfreetime":return e.isFreeTime=s,!0;case"tripletfeel":return e.tripletFeel=$.parseEnum(s,Pe),!0;case"tempoautomations":e.tempoAutomations=[];for(const r of s){const n=new vi;Ic.fromJson(n,r),e.tempoAutomations.push(n)}return!0;case"fermata":return e.fermata=new Map,$.forEach(s,(r,n)=>{const a=new A0;Gb.fromJson(a,r),e.addFermata(parseInt(n),a)}),!0;case"start":return e.start=s,!0;case"isanacrusis":return e.isAnacrusis=s,!0;case"displayscale":return e.displayScale=s,!0;case"displaywidth":return e.displayWidth=s,!0}return["section"].indexOf(t)>=0?(s?(e.section=new Od,Wb.fromJson(e.section,s)):e.section=null,!0):!1}}class Rc{static fromJson(e,t){t&&$.forEach(t,(s,r)=>this.setProperty(e,r,s))}static toJson(e){if(!e)return null;const t=new Map;return t.set("offset",e.offset),t.set("value",e.value),t}static setProperty(e,t,s){switch(t){case"offset":return e.offset=s,!0;case"value":return e.value=s,!0}return!1}}class Ub{static fromJson(e,t){t&&$.forEach(t,(s,r)=>this.setProperty(e,r,s))}static toJson(e){var s;if(!e)return null;const t=new Map;return t.set("id",e.id),t.set("accentuated",e.accentuated),t.set("bendtype",e.bendType),t.set("bendstyle",e.bendStyle),t.set("iscontinuedbend",e.isContinuedBend),e.bendPoints!==null&&t.set("bendpoints",(s=e.bendPoints)==null?void 0:s.map(r=>Rc.toJson(r))),t.set("fret",e.fret),t.set("string",e.string),t.set("showstringnumber",e.showStringNumber),t.set("octave",e.octave),t.set("tone",e.tone),t.set("percussionarticulation",e.percussionArticulation),t.set("isvisible",e.isVisible),t.set("islefthandtapped",e.isLeftHandTapped),t.set("ishammerpullorigin",e.isHammerPullOrigin),t.set("isslurdestination",e.isSlurDestination),t.set("harmonictype",e.harmonicType),t.set("harmonicvalue",e.harmonicValue),t.set("isghost",e.isGhost),t.set("isletring",e.isLetRing),t.set("ispalmmute",e.isPalmMute),t.set("isdead",e.isDead),t.set("isstaccato",e.isStaccato),t.set("slideintype",e.slideInType),t.set("slideouttype",e.slideOutType),t.set("vibrato",e.vibrato),t.set("istiedestination",e.isTieDestination),t.set("lefthandfinger",e.leftHandFinger),t.set("righthandfinger",e.rightHandFinger),t.set("isfingering",e.isFingering),t.set("trillvalue",e.trillValue),t.set("trillspeed",e.trillSpeed),t.set("durationpercent",e.durationPercent),t.set("accidentalmode",e.accidentalMode),t.set("dynamics",e.dynamics),e.toJson(t),t}static setProperty(e,t,s){switch(t){case"id":return e.id=s,!0;case"accentuated":return e.accentuated=$.parseEnum(s,_t),!0;case"bendtype":return e.bendType=$.parseEnum(s,se),!0;case"bendstyle":return e.bendStyle=$.parseEnum(s,qe),!0;case"iscontinuedbend":return e.isContinuedBend=s,!0;case"bendpoints":if(s){e.bendPoints=[];for(const r of s){const n=new G;Rc.fromJson(n,r),e.addBendPoint(n)}}return!0;case"fret":return e.fret=s,!0;case"string":return e.string=s,!0;case"showstringnumber":return e.showStringNumber=s,!0;case"octave":return e.octave=s,!0;case"tone":return e.tone=s,!0;case"percussionarticulation":return e.percussionArticulation=s,!0;case"isvisible":return e.isVisible=s,!0;case"islefthandtapped":return e.isLeftHandTapped=s,!0;case"ishammerpullorigin":return e.isHammerPullOrigin=s,!0;case"isslurdestination":return e.isSlurDestination=s,!0;case"harmonictype":return e.harmonicType=$.parseEnum(s,fe),!0;case"harmonicvalue":return e.harmonicValue=s,!0;case"isghost":return e.isGhost=s,!0;case"isletring":return e.isLetRing=s,!0;case"ispalmmute":return e.isPalmMute=s,!0;case"isdead":return e.isDead=s,!0;case"isstaccato":return e.isStaccato=s,!0;case"slideintype":return e.slideInType=$.parseEnum(s,ii),!0;case"slideouttype":return e.slideOutType=$.parseEnum(s,xe),!0;case"vibrato":return e.vibrato=$.parseEnum(s,Ge),!0;case"istiedestination":return e.isTieDestination=s,!0;case"lefthandfinger":return e.leftHandFinger=$.parseEnum(s,Te),!0;case"righthandfinger":return e.rightHandFinger=$.parseEnum(s,Te),!0;case"isfingering":return e.isFingering=s,!0;case"trillvalue":return e.trillValue=s,!0;case"trillspeed":return e.trillSpeed=$.parseEnum(s,N),!0;case"durationpercent":return e.durationPercent=s,!0;case"accidentalmode":return e.accidentalMode=$.parseEnum(s,At),!0;case"dynamics":return e.dynamics=$.parseEnum(s,Me),!0}return e.setProperty(t,s)}}class $b{static fromJson(e,t){t&&$.forEach(t,(s,r)=>this.setProperty(e,r,s))}static toJson(e){var s;if(!e)return null;const t=new Map;return t.set("id",e.id),t.set("notes",e.notes.map(r=>Ub.toJson(r))),t.set("isempty",e.isEmpty),t.set("whammystyle",e.whammyStyle),t.set("ottava",e.ottava),t.set("islegatoorigin",e.isLegatoOrigin),t.set("duration",e.duration),t.set("automations",e.automations.map(r=>Ic.toJson(r))),t.set("dots",e.dots),t.set("fadein",e.fadeIn),t.set("lyrics",e.lyrics),t.set("hasrasgueado",e.hasRasgueado),t.set("pop",e.pop),t.set("slap",e.slap),t.set("tap",e.tap),t.set("text",e.text),t.set("slashed",e.slashed),t.set("brushtype",e.brushType),t.set("brushduration",e.brushDuration),t.set("tupletdenominator",e.tupletDenominator),t.set("tupletnumerator",e.tupletNumerator),t.set("iscontinuedwhammy",e.isContinuedWhammy),t.set("whammybartype",e.whammyBarType),e.whammyBarPoints!==null&&t.set("whammybarpoints",(s=e.whammyBarPoints)==null?void 0:s.map(r=>Rc.toJson(r))),t.set("vibrato",e.vibrato),t.set("chordid",e.chordId),t.set("gracetype",e.graceType),t.set("pickstroke",e.pickStroke),t.set("tremolospeed",e.tremoloSpeed),t.set("crescendo",e.crescendo),t.set("displaystart",e.displayStart),t.set("playbackstart",e.playbackStart),t.set("displayduration",e.displayDuration),t.set("playbackduration",e.playbackDuration),t.set("dynamics",e.dynamics),t.set("invertbeamdirection",e.invertBeamDirection),t.set("preferredbeamdirection",e.preferredBeamDirection),t.set("beamingmode",e.beamingMode),t}static setProperty(e,t,s){switch(t){case"id":return e.id=s,!0;case"notes":e.notes=[];for(const r of s){const n=new Ss;Ub.fromJson(n,r),e.addNote(n)}return!0;case"isempty":return e.isEmpty=s,!0;case"whammystyle":return e.whammyStyle=$.parseEnum(s,qe),!0;case"ottava":return e.ottava=$.parseEnum(s,Ue),!0;case"islegatoorigin":return e.isLegatoOrigin=s,!0;case"duration":return e.duration=$.parseEnum(s,N),!0;case"automations":e.automations=[];for(const r of s){const n=new vi;Ic.fromJson(n,r),e.automations.push(n)}return!0;case"dots":return e.dots=s,!0;case"fadein":return e.fadeIn=s,!0;case"lyrics":return e.lyrics=s,!0;case"hasrasgueado":return e.hasRasgueado=s,!0;case"pop":return e.pop=s,!0;case"slap":return e.slap=s,!0;case"tap":return e.tap=s,!0;case"text":return e.text=s,!0;case"slashed":return e.slashed=s,!0;case"brushtype":return e.brushType=$.parseEnum(s,ut),!0;case"brushduration":return e.brushDuration=s,!0;case"tupletdenominator":return e.tupletDenominator=s,!0;case"tupletnumerator":return e.tupletNumerator=s,!0;case"iscontinuedwhammy":return e.isContinuedWhammy=s,!0;case"whammybartype":return e.whammyBarType=$.parseEnum(s,je),!0;case"whammybarpoints":if(s){e.whammyBarPoints=[];for(const r of s){const n=new G;Rc.fromJson(n,r),e.addWhammyBarPoint(n)}}return!0;case"vibrato":return e.vibrato=$.parseEnum(s,Ge),!0;case"chordid":return e.chordId=s,!0;case"gracetype":return e.graceType=$.parseEnum(s,he),!0;case"pickstroke":return e.pickStroke=$.parseEnum(s,fi),!0;case"tremolospeed":return e.tremoloSpeed=$.parseEnum(s,N),!0;case"crescendo":return e.crescendo=$.parseEnum(s,ss),!0;case"displaystart":return e.displayStart=s,!0;case"playbackstart":return e.playbackStart=s,!0;case"displayduration":return e.displayDuration=s,!0;case"playbackduration":return e.playbackDuration=s,!0;case"dynamics":return e.dynamics=$.parseEnum(s,Me),!0;case"invertbeamdirection":return e.invertBeamDirection=s,!0;case"preferredbeamdirection":return e.preferredBeamDirection=$.parseEnum(s,R),!0;case"beamingmode":return e.beamingMode=$.parseEnum(s,cr),!0}return!1}}class Yb{static fromJson(e,t){t&&$.forEach(t,(s,r)=>this.setProperty(e,r,s))}static toJson(e){if(!e)return null;const t=new Map;return t.set("id",e.id),t.set("beats",e.beats.map(s=>$b.toJson(s))),t.set("isempty",e.isEmpty),t}static setProperty(e,t,s){switch(t){case"id":return e.id=s,!0;case"beats":e.beats=[];for(const r of s){const n=new xi;$b.fromJson(n,r),e.addBeat(n)}return!0;case"isempty":return e.isEmpty=s,!0}return!1}}class Xb{static fromJson(e,t){t&&$.forEach(t,(s,r)=>this.setProperty(e,r,s))}static toJson(e){if(!e)return null;const t=new Map;return t.set("id",e.id),t.set("clef",e.clef),t.set("clefottava",e.clefOttava),t.set("voices",e.voices.map(s=>Yb.toJson(s))),t.set("similemark",e.simileMark),t.set("displayscale",e.displayScale),t.set("displaywidth",e.displayWidth),t}static setProperty(e,t,s){switch(t){case"id":return e.id=s,!0;case"clef":return e.clef=$.parseEnum(s,ve),!0;case"clefottava":return e.clefOttava=$.parseEnum(s,Ue),!0;case"voices":e.voices=[];for(const r of s){const n=new Wr;Yb.fromJson(n,r),e.addVoice(n)}return!0;case"similemark":return e.simileMark=$.parseEnum(s,Es),!0;case"displayscale":return e.displayScale=s,!0;case"displaywidth":return e.displayWidth=s,!0}return!1}}class Qb{static fromJson(e,t){t&&$.forEach(t,(s,r)=>this.setProperty(e,r,s))}static toJson(e){if(!e)return null;const t=new Map;return t.set("name",e.name),t.set("firstfret",e.firstFret),t.set("strings",e.strings),t.set("barrefrets",e.barreFrets),t.set("showname",e.showName),t.set("showdiagram",e.showDiagram),t.set("showfingering",e.showFingering),t}static setProperty(e,t,s){switch(t){case"name":return e.name=s,!0;case"firstfret":return e.firstFret=s,!0;case"strings":return e.strings=s,!0;case"barrefrets":return e.barreFrets=s,!0;case"showname":return e.showName=s,!0;case"showdiagram":return e.showDiagram=s,!0;case"showfingering":return e.showFingering=s,!0}return!1}}class Jb{static fromJson(e,t){t&&$.forEach(t,(s,r)=>this.setProperty(e,r,s))}static toJson(e){if(!e)return null;const t=new Map;return t.set("isstandard",e.isStandard),t.set("name",e.name),t.set("tunings",e.tunings),t}static setProperty(e,t,s){switch(t){case"isstandard":return e.isStandard=s,!0;case"name":return e.name=s,!0;case"tunings":return e.tunings=s,!0}return!1}}class qb{static fromJson(e,t){t&&$.forEach(t,(s,r)=>this.setProperty(e,r,s))}static toJson(e){if(!e)return null;const t=new Map;if(t.set("bars",e.bars.map(s=>Xb.toJson(s))),e.chords!==null){const s=new Map;t.set("chords",s);for(const[r,n]of e.chords)s.set(r.toString(),Qb.toJson(n))}return t.set("capo",e.capo),t.set("transpositionpitch",e.transpositionPitch),t.set("displaytranspositionpitch",e.displayTranspositionPitch),t.set("stringtuning",Jb.toJson(e.stringTuning)),t.set("showslash",e.showSlash),t.set("shownumbered",e.showNumbered),t.set("showtablature",e.showTablature),t.set("showstandardnotation",e.showStandardNotation),t.set("ispercussion",e.isPercussion),t.set("standardnotationlinecount",e.standardNotationLineCount),t}static setProperty(e,t,s){switch(t){case"bars":e.bars=[];for(const r of s){const n=new Sn;Xb.fromJson(n,r),e.addBar(n)}return!0;case"chords":return e.chords=new Map,$.forEach(s,(r,n)=>{const a=new Qn;Qb.fromJson(a,r),e.addChord(n,a)}),!0;case"capo":return e.capo=s,!0;case"transpositionpitch":return e.transpositionPitch=s,!0;case"displaytranspositionpitch":return e.displayTranspositionPitch=s,!0;case"showslash":return e.showSlash=s,!0;case"shownumbered":return e.showNumbered=s,!0;case"showtablature":return e.showTablature=s,!0;case"showstandardnotation":return e.showStandardNotation=s,!0;case"ispercussion":return e.isPercussion=s,!0;case"standardnotationlinecount":return e.standardNotationLineCount=s,!0}return["stringtuning"].indexOf(t)>=0?(Jb.fromJson(e.stringTuning,s),!0):!1}}class Kb{static fromJson(e,t){t&&$.forEach(t,(s,r)=>this.setProperty(e,r,s))}static toJson(e){if(!e)return null;const t=new Map;return t.set("volume",e.volume),t.set("balance",e.balance),t.set("port",e.port),t.set("program",e.program),t.set("primarychannel",e.primaryChannel),t.set("secondarychannel",e.secondaryChannel),t.set("ismute",e.isMute),t.set("issolo",e.isSolo),t}static setProperty(e,t,s){switch(t){case"volume":return e.volume=s,!0;case"balance":return e.balance=s,!0;case"port":return e.port=s,!0;case"program":return e.program=s,!0;case"primarychannel":return e.primaryChannel=s,!0;case"secondarychannel":return e.secondaryChannel=s,!0;case"ismute":return e.isMute=s,!0;case"issolo":return e.isSolo=s,!0}return!1}}class Zb{static fromJson(e,t){t&&$.forEach(t,(s,r)=>this.setProperty(e,r,s))}static toJson(e){if(!e)return null;const t=new Map;return t.set("elementtype",e.elementType),t.set("staffline",e.staffLine),t.set("noteheaddefault",e.noteHeadDefault),t.set("noteheadhalf",e.noteHeadHalf),t.set("noteheadwhole",e.noteHeadWhole),t.set("techniquesymbol",e.techniqueSymbol),t.set("techniquesymbolplacement",e.techniqueSymbolPlacement),t.set("outputmidinumber",e.outputMidiNumber),t}static setProperty(e,t,s){switch(t){case"elementtype":return e.elementType=s,!0;case"staffline":return e.staffLine=s,!0;case"noteheaddefault":return e.noteHeadDefault=$.parseEnum(s,S),!0;case"noteheadhalf":return e.noteHeadHalf=$.parseEnum(s,S),!0;case"noteheadwhole":return e.noteHeadWhole=$.parseEnum(s,S),!0;case"techniquesymbol":return e.techniqueSymbol=$.parseEnum(s,S),!0;case"techniquesymbolplacement":return e.techniqueSymbolPlacement=$.parseEnum(s,we),!0;case"outputmidinumber":return e.outputMidiNumber=s,!0}return!1}}class eS{static fromJson(e,t){t&&$.forEach(t,(s,r)=>this.setProperty(e,r,s))}static toJson(e){if(!e)return null;const t=new Map;return t.set("staves",e.staves.map(s=>qb.toJson(s))),t.set("playbackinfo",Kb.toJson(e.playbackInfo)),t.set("color",Je.toJson(e.color)),t.set("name",e.name),t.set("isvisibleonmultitrack",e.isVisibleOnMultiTrack),t.set("shortname",e.shortName),t.set("defaultsystemslayout",e.defaultSystemsLayout),t.set("systemslayout",e.systemsLayout),t.set("percussionarticulations",e.percussionArticulations.map(s=>Zb.toJson(s))),t}static setProperty(e,t,s){switch(t){case"staves":e.staves=[];for(const r of s){const n=new w_;qb.fromJson(n,r),e.addStaff(n)}return!0;case"color":return e.color=Je.fromJson(s),!0;case"name":return e.name=s,!0;case"isvisibleonmultitrack":return e.isVisibleOnMultiTrack=s,!0;case"shortname":return e.shortName=s,!0;case"defaultsystemslayout":return e.defaultSystemsLayout=s,!0;case"systemslayout":return e.systemsLayout=s,!0;case"percussionarticulations":e.percussionArticulations=[];for(const r of s){const n=new Q;Zb.fromJson(n,r),e.percussionArticulations.push(n)}return!0}return["playbackinfo"].indexOf(t)>=0?(Kb.fromJson(e.playbackInfo,s),!0):!1}}class tS{static fromJson(e,t){t&&$.forEach(t,(s,r)=>this.setProperty(e,r,s))}static toJson(e){if(!e)return null;const t=new Map;return t.set("hidedynamics",e.hideDynamics),t}static setProperty(e,t,s){switch(t){case"hidedynamics":return e.hideDynamics=s,!0}return!1}}class iS{static fromJson(e,t){t&&$.forEach(t,(s,r)=>this.setProperty(e,r,s))}static toJson(e){if(!e)return null;const t=new Map;return t.set("album",e.album),t.set("artist",e.artist),t.set("copyright",e.copyright),t.set("instructions",e.instructions),t.set("music",e.music),t.set("notices",e.notices),t.set("subtitle",e.subTitle),t.set("title",e.title),t.set("words",e.words),t.set("tab",e.tab),t.set("tempo",e.tempo),t.set("tempolabel",e.tempoLabel),t.set("masterbars",e.masterBars.map(s=>jb.toJson(s))),t.set("tracks",e.tracks.map(s=>eS.toJson(s))),t.set("defaultsystemslayout",e.defaultSystemsLayout),t.set("systemslayout",e.systemsLayout),t.set("stylesheet",tS.toJson(e.stylesheet)),t}static setProperty(e,t,s){switch(t){case"album":return e.album=s,!0;case"artist":return e.artist=s,!0;case"copyright":return e.copyright=s,!0;case"instructions":return e.instructions=s,!0;case"music":return e.music=s,!0;case"notices":return e.notices=s,!0;case"subtitle":return e.subTitle=s,!0;case"title":return e.title=s,!0;case"words":return e.words=s,!0;case"tab":return e.tab=s,!0;case"tempo":return e.tempo=s,!0;case"tempolabel":return e.tempoLabel=s,!0;case"masterbars":e.masterBars=[];for(const r of s){const n=new gn;jb.fromJson(n,r),e.addMasterBar(n)}return!0;case"tracks":e.tracks=[];for(const r of s){const n=new Va;eS.fromJson(n,r),e.addTrack(n)}return!0;case"defaultsystemslayout":return e.defaultSystemsLayout=s,!0;case"systemslayout":return e.systemsLayout=s,!0}return["stylesheet"].indexOf(t)>=0?(tS.fromJson(e.stylesheet,s),!0):!1}}class Dt{static jsonReplacer(e,t){if(t instanceof Map){if("fromEntries"in Object)return Object.fromEntries(t);{const s={};for(const[r,n]of t)s[r]=n;return s}}else if(ArrayBuffer.isView(t))return Array.apply([],[t]);return t}static scoreToJson(e){let t=Dt.scoreToJsObject(e);return JSON.stringify(t,Dt.jsonReplacer)}static jsonToScore(e,t){return Dt.jsObjectToScore(JSON.parse(e),t)}static scoreToJsObject(e){return iS.toJson(e)}static jsObjectToScore(e,t){let s=new Fa;return iS.fromJson(s,e),s.finish(t??new gu),s}static settingsToJson(e){let t=Dt.settingsToJsObject(e);return JSON.stringify(t,Dt.jsonReplacer)}static jsonToSettings(e){return Dt.jsObjectToSettings(JSON.parse(e))}static settingsToJsObject(e){return Ho.toJson(e)}static jsObjectToSettings(e){let t=new gu;return Ho.fromJson(t,e),t}static jsObjectToMidiFile(e){let t=new Un;return $.forEach(e,(s,r)=>{switch(r){case"division":t.division=s;break;case"tracks":for(let n of s){let a=Dt.jsObjectToMidiTrack(n);t.tracks.push(a)}break}}),t}static jsObjectToMidiTrack(e){let t=new __;return $.forEach(e,(s,r)=>{switch(r){case"events":for(let n of s){let a=Dt.jsObjectToMidiEvent(n);t.events.push(a)}break}}),t}static jsObjectToMidiEvent(e){let t=$.getValue(e,"track"),s=$.getValue(e,"tick"),r=$.getValue(e,"type");switch(r){case Fe.TimeSignature:return new T_(t,s,$.getValue(e,"numerator"),$.getValue(e,"denominatorIndex"),$.getValue(e,"midiClocksPerMetronomeClick"),$.getValue(e,"thirdySecondNodesInQuarter"));case Fe.AlphaTabRest:return new B_(t,s,$.getValue(e,"channel"));case Fe.AlphaTabMetronome:return new N_(t,s,$.getValue(e,"metronomeNumerator"),$.getValue(e,"metronomeDurationInTicks"),$.getValue(e,"metronomeDurationInMilliseconds"));case Fe.NoteOn:return new P_(t,s,$.getValue(e,"channel"),$.getValue(e,"noteKey"),$.getValue(e,"noteVelocity"));case Fe.NoteOff:return new M_(t,s,$.getValue(e,"channel"),$.getValue(e,"noteKey"),$.getValue(e,"noteVelocity"));case Fe.ControlChange:return new E_(t,s,$.getValue(e,"channel"),$.getValue(e,"controller"),$.getValue(e,"value"));case Fe.ProgramChange:return new L_(t,s,$.getValue(e,"channel"),$.getValue(e,"program"));case Fe.TempoChange:return new D_(s,$.getValue(e,"microSecondsPerQuarterNote"));case Fe.PitchBend:return new A_(t,s,$.getValue(e,"channel"),$.getValue(e,"value"));case Fe.PerNotePitchBend:return new I_(t,s,$.getValue(e,"channel"),$.getValue(e,"noteKey"),$.getValue(e,"value"));case Fe.EndOfTrack:return new R_(t,s)}throw new ni(ri.Format,"Unknown Midi Event type: "+r)}static midiFileToJsObject(e){const t=new Map;t.set("division",e.division);const s=[];for(let r of e.tracks)s.push(Dt.midiTrackToJsObject(r));return t.set("tracks",s),t}static midiTrackToJsObject(e){const t=new Map,s=[];for(let r of e.events)s.push(Dt.midiEventToJsObject(r));return t.set("events",s),t}static midiEventToJsObject(e){const t=new Map;switch(t.set("track",e.track),t.set("tick",e.tick),t.set("type",e.type),e.type){case Fe.TimeSignature:t.set("numerator",e.numerator),t.set("denominatorIndex",e.denominatorIndex),t.set("midiClocksPerMetronomeClick",e.midiClocksPerMetronomeClick),t.set("thirdySecondNodesInQuarter",e.thirtySecondNodesInQuarter);break;case Fe.AlphaTabRest:t.set("channel",e.channel);break;case Fe.AlphaTabMetronome:t.set("metronomeNumerator",e.metronomeNumerator),t.set("metronomeDurationInMilliseconds",e.metronomeDurationInMilliseconds),t.set("metronomeDurationInTicks",e.metronomeDurationInTicks);break;case Fe.NoteOn:case Fe.NoteOff:t.set("channel",e.channel),t.set("noteKey",e.noteKey),t.set("noteVelocity",e.noteVelocity);break;case Fe.ControlChange:t.set("channel",e.channel),t.set("controller",e.controller),t.set("value",e.value);break;case Fe.ProgramChange:t.set("channel",e.channel),t.set("program",e.program);break;case Fe.TempoChange:t.set("microSecondsPerQuarterNote",e.microSecondsPerQuarterNote);break;case Fe.PitchBend:t.set("channel",e.channel),t.set("value",e.value);break;case Fe.PerNotePitchBend:t.set("channel",e.channel),t.set("noteKey",e.noteKey),t.set("value",e.value);break;case Fe.EndOfTrack:break}return t}}class ht{constructor(){this.ready=new Jt,this.samplesPlayed=new He,this.sampleRequest=new Jt}get sampleRate(){return ht.preferredSampleRate}open(){I.debug("AlphaSynth","Initializing synth worker"),this._worker=D.globalThis,this._worker.addEventListener("message",this.handleMessage.bind(this)),this.ready.trigger()}destroy(){this._worker.postMessage({cmd:"alphaSynth.output.destroy"})}handleMessage(e){let t=e.data;switch(t.cmd){case ht.CmdOutputSampleRequest:this.sampleRequest.trigger();break;case ht.CmdOutputSamplesPlayed:this.samplesPlayed.trigger(t.samples);break}}addSamples(e){this._worker.postMessage({cmd:"alphaSynth.output.addSamples",samples:e})}play(){this._worker.postMessage({cmd:"alphaSynth.output.play"})}pause(){this._worker.postMessage({cmd:"alphaSynth.output.pause"})}resetSamples(){this._worker.postMessage({cmd:"alphaSynth.output.resetSamples"})}activate(){}}ht.CmdOutputPrefix="alphaSynth.output.";ht.CmdOutputAddSamples=ht.CmdOutputPrefix+"addSamples";ht.CmdOutputPlay=ht.CmdOutputPrefix+"play";ht.CmdOutputPause=ht.CmdOutputPrefix+"pause";ht.CmdOutputResetSamples=ht.CmdOutputPrefix+"resetSamples";ht.CmdOutputStop=ht.CmdOutputPrefix+"stop";ht.CmdOutputSampleRequest=ht.CmdOutputPrefix+"sampleRequest";ht.CmdOutputSamplesPlayed=ht.CmdOutputPrefix+"samplesPlayed";ht.preferredSampleRate=0;class W0{constructor(e,t){this._main=e,this._main.addEventListener("message",this.handleMessage.bind(this)),this._player=new F_(new ht,t),this._player.positionChanged.on(this.onPositionChanged.bind(this)),this._player.stateChanged.on(this.onPlayerStateChanged.bind(this)),this._player.finished.on(this.onFinished.bind(this)),this._player.soundFontLoaded.on(this.onSoundFontLoaded.bind(this)),this._player.soundFontLoadFailed.on(this.onSoundFontLoadFailed.bind(this)),this._player.soundFontLoadFailed.on(this.onSoundFontLoadFailed.bind(this)),this._player.midiLoaded.on(this.onMidiLoaded.bind(this)),this._player.midiLoadFailed.on(this.onMidiLoadFailed.bind(this)),this._player.readyForPlayback.on(this.onReadyForPlayback.bind(this)),this._player.midiEventsPlayed.on(this.onMidiEventsPlayed.bind(this)),this._player.playbackRangeChanged.on(this.onPlaybackRangeChanged.bind(this)),this._main.postMessage({cmd:"alphaSynth.ready"})}static init(){let e=D.globalThis;e.addEventListener("message",t=>{let s=t.data;switch(s.cmd){case"alphaSynth.initialize":ht.preferredSampleRate=s.sampleRate,I.logLevel=s.logLevel,D.globalThis.alphaSynthWebWorker=new W0(e,s.bufferTimeInMilliseconds);break}})}handleMessage(e){let t=e.data;switch(t.cmd){case"alphaSynth.setLogLevel":I.logLevel=t.value;break;case"alphaSynth.setMasterVolume":this._player.masterVolume=t.value;break;case"alphaSynth.setMetronomeVolume":this._player.metronomeVolume=t.value;break;case"alphaSynth.setPlaybackSpeed":this._player.playbackSpeed=t.value;break;case"alphaSynth.setTickPosition":this._player.tickPosition=t.value;break;case"alphaSynth.setTimePosition":this._player.timePosition=t.value;break;case"alphaSynth.setPlaybackRange":this._player.playbackRange=t.value;break;case"alphaSynth.setIsLooping":this._player.isLooping=t.value;break;case"alphaSynth.setCountInVolume":this._player.countInVolume=t.value;break;case"alphaSynth.setMidiEventsPlayedFilter":this._player.midiEventsPlayedFilter=t.value;break;case"alphaSynth.play":this._player.play();break;case"alphaSynth.pause":this._player.pause();break;case"alphaSynth.playPause":this._player.playPause();break;case"alphaSynth.stop":this._player.stop();break;case"alphaSynth.playOneTimeMidiFile":this._player.playOneTimeMidiFile(Dt.jsObjectToMidiFile(t.midi));break;case"alphaSynth.loadSoundFontBytes":this._player.loadSoundFont(t.data,t.append);break;case"alphaSynth.resetSoundFonts":this._player.resetSoundFonts();break;case"alphaSynth.loadMidi":this._player.loadMidiFile(Dt.jsObjectToMidiFile(t.midi));break;case"alphaSynth.setChannelMute":this._player.setChannelMute(t.channel,t.mute);break;case"alphaSynth.setChannelTranspositionPitch":this._player.setChannelTranspositionPitch(t.channel,t.semitones);break;case"alphaSynth.setChannelSolo":this._player.setChannelSolo(t.channel,t.solo);break;case"alphaSynth.setChannelVolume":this._player.setChannelVolume(t.channel,t.volume);break;case"alphaSynth.resetChannelStates":this._player.resetChannelStates();break;case"alphaSynth.destroy":this._player.destroy(),this._main.postMessage({cmd:"alphaSynth.destroyed"});break;case"alphaSynth.applyTranspositionPitches":this._player.applyTranspositionPitches(new Map(JSON.parse(t.transpositionPitches)));break}}onPositionChanged(e){this._main.postMessage({cmd:"alphaSynth.positionChanged",currentTime:e.currentTime,endTime:e.endTime,currentTick:e.currentTick,endTick:e.endTick,isSeek:e.isSeek})}onPlayerStateChanged(e){this._main.postMessage({cmd:"alphaSynth.playerStateChanged",state:e.state,stopped:e.stopped})}onFinished(){this._main.postMessage({cmd:"alphaSynth.finished"})}onSoundFontLoaded(){this._main.postMessage({cmd:"alphaSynth.soundFontLoaded"})}onSoundFontLoadFailed(e){this._main.postMessage({cmd:"alphaSynth.soundFontLoadFailed",error:this.serializeException(e)})}serializeException(e){let t=JSON.parse(JSON.stringify(e));return e.message&&(t.message=e.message),e.stack&&(t.stack=e.stack),e.constructor&&e.constructor.name&&(t.type=e.constructor.name),t}onMidiLoaded(e){this._main.postMessage({cmd:"alphaSynth.midiLoaded",currentTime:e.currentTime,endTime:e.endTime,currentTick:e.currentTick,endTick:e.endTick,isSeek:e.isSeek})}onMidiLoadFailed(e){this._main.postMessage({cmd:"alphaSynth.midiLoaded",error:this.serializeException(e)})}onReadyForPlayback(){this._main.postMessage({cmd:"alphaSynth.readyForPlayback"})}onMidiEventsPlayed(e){this._main.postMessage({cmd:"alphaSynth.midiEventsPlayed",events:e.events.map(Dt.midiEventToJsObject)})}onPlaybackRangeChanged(e){this._main.postMessage({cmd:"alphaSynth.playbackRangeChanged",playbackRange:e.playbackRange})}}var cs;(function(i){i[i.Browser=0]="Browser",i[i.NodeJs=1]="NodeJs",i[i.BrowserModule=2]="BrowserModule"})(cs||(cs={}));class sS{constructor(e,t){this.characterWidths=e,this.fontSizeToHeight=t}}class Ci{static generateFontLookup(e){if(!Ci.FontSizeLookupTables.has(e))if(!D.isRunningInWorker&&D.webPlatform!=cs.NodeJs){let s=document.createElement("canvas").getContext("2d");const r=11;s.font=`${r}px ${e}`;const n=[];let a="";for(let d=Ci.ControlChars;d<255;d++){let f=String.fromCharCode(d);a+=f;const p=s.measureText(f);n.push(p.width)}const o=s.measureText(a+"ÄÖÜÁÈ"),l=0-Math.abs(o.fontBoundingBoxAscent),h=0+Math.abs(o.fontBoundingBoxDescent)-l,c=new sS(new Uint8Array(n),h/r);Ci.FontSizeLookupTables.set(e,c)}else{const t=new sS(new Uint8Array([8]),1.2);Ci.FontSizeLookupTables.set(e,t)}}static measureString(e,t,s,r,n){let a,o=11,l=t[0];for(let c=0;c<t.length;c++)if(Ci.FontSizeLookupTables.has(t[c])){l=t[c];break}Ci.FontSizeLookupTables.has(l)||Ci.generateFontLookup(l),a=Ci.FontSizeLookupTables.get(l);let u=1;r===gt.Italic&&(u*=1.1),n===hs.Bold&&(u*=1.1);let h=0;for(let c=0;c<e.length;c++){let d=Math.min(a.characterWidths.length-1,e.charCodeAt(c)-Ci.ControlChars);d>=0&&(h+=a.characterWidths[d]*s/o)}return u*=1.07,new Rd(h*u,s*a.fontSizeToHeight)}}Ci.FontSizeLookupTables=new Map;Ci.ControlChars=32;class da{constructor(){this.id=et.newGuid(),this.x=0,this.y=0,this.width=0,this.height=0,this.totalWidth=0,this.totalHeight=0,this.firstMasterBarIndex=-1,this.lastMasterBarIndex=-1,this.renderResult=null}}class H_{constructor(){this.beats=[]}addBeat(e){e.barBounds=this,this.beats.push(e),this.masterBarBounds.addBeat(e)}findBeatAtPos(e){let t=null;for(let s of this.beats)if(!t||s.realBounds.x<e)t=s;else if(s.realBounds.x>e)break;return t}finish(){this.beats.sort((e,t)=>e.realBounds.x-t.realBounds.x)}}class z_{constructor(){this.notes=null}addNote(e){this.notes||(this.notes=[]),e.beatBounds=this,this.notes.push(e)}findNoteAtPos(e,t){const s=this.notes;if(!s)return null;for(let r of s){let n=r.noteHeadBounds.y+r.noteHeadBounds.h,a=r.noteHeadBounds.x+r.noteHeadBounds.w;if(r.noteHeadBounds.x<=e&&r.noteHeadBounds.y<=t&&e<=a&&t<=n)return r.note}return null}}class W_{constructor(){this.index=0,this.isFirstOfLine=!1,this.bars=[],this.staffSystemBounds=null}get staveGroupBounds(){return this.staffSystemBounds}addBar(e){e.masterBarBounds=this,this.bars.push(e)}findBeatAtPos(e,t){let s=null,r=1e7;for(let n of this.bars){let a=n.findBeatAtPos(e);if(a&&(!s||s.realBounds.x<a.realBounds.x)){const o=Math.abs(a.realBounds.x-e);(!s||o<r)&&(s=a)}}return s?s.beat:null}finish(){this.bars.sort((e,t)=>e.realBounds.y<t.realBounds.y?-1:e.realBounds.y>t.realBounds.y?1:e.realBounds.x<t.realBounds.x?-1:e.realBounds.x>t.realBounds.x?1:0);for(const e of this.bars)e.finish()}addBeat(e){this.staffSystemBounds.boundsLookup.addBeat(e)}}class Ru{}class G_{constructor(){this.index=0,this.bars=[]}finish(){for(let e of this.bars)e.finish()}addBar(e){this.boundsLookup.addMasterBar(e),e.staffSystemBounds=this,this.bars.push(e)}findBarAtPos(e){let t=null;for(let s of this.bars)if(!t||s.realBounds.x<e)t=s;else if(e>s.realBounds.x+s.realBounds.w)break;return t}}class mu{constructor(){this._beatLookup=new Map,this._masterBarLookup=new Map,this._currentStaffSystem=null,this.staffSystems=[],this.isFinished=!1}toJson(){let e={},t=[];e.staffSystems=t;for(let s of this.staffSystems){let r={};r.visualBounds=this.boundsToJson(s.visualBounds),r.realBounds=this.boundsToJson(s.realBounds),r.bars=[];for(let n of s.bars){let a={};a.lineAlignedBounds=this.boundsToJson(n.lineAlignedBounds),a.visualBounds=this.boundsToJson(n.visualBounds),a.realBounds=this.boundsToJson(n.realBounds),a.index=n.index,a.bars=[];for(let o of n.bars){let l={};l.visualBounds=this.boundsToJson(o.visualBounds),l.realBounds=this.boundsToJson(o.realBounds),l.beats=[];for(let u of o.beats){let h={};h.visualBounds=this.boundsToJson(u.visualBounds),h.realBounds=this.boundsToJson(u.realBounds);let c=h;if(c.beatIndex=u.beat.index,c.voiceIndex=u.beat.voice.index,c.barIndex=u.beat.voice.bar.index,c.staffIndex=u.beat.voice.bar.staff.index,c.trackIndex=u.beat.voice.bar.staff.track.index,u.notes){let d=h.notes=[];for(let f of u.notes){let p={},g=p;g.index=f.note.index,p.noteHeadBounds=this.boundsToJson(f.noteHeadBounds),d.push(p)}}l.beats.push(h)}a.bars.push(l)}r.bars.push(a)}t.push(r)}return e}static fromJson(e,t){let s=new mu,r=e.staffSystems;for(let n of r){let a=new G_;a.visualBounds=n.visualBounds,a.realBounds=n.realBounds,s.addStaffSystem(a);for(let o of n.bars){let l=new W_;l.index=o.index,l.isFirstOfLine=o.isFirstOfLine,l.lineAlignedBounds=o.lineAlignedBounds,l.visualBounds=o.visualBounds,l.realBounds=o.realBounds,a.addBar(l);for(let u of o.bars){let h=new H_;h.visualBounds=u.visualBounds,h.realBounds=u.realBounds,l.addBar(h);for(let c of u.beats){let d=new z_;d.visualBounds=c.visualBounds,d.realBounds=c.realBounds;let f=c;if(d.beat=t.tracks[f.trackIndex].staves[f.staffIndex].bars[f.barIndex].voices[f.voiceIndex].beats[f.beatIndex],c.notes){d.notes=[];for(let p of c.notes){let g=new Ru,b=p;g.note=d.beat.notes[b.index],g.noteHeadBounds=p.noteHeadBounds,d.addNote(g)}}h.addBeat(d)}}}}return s}boundsToJson(e){let t={};return t.x=e.x,t.y=e.y,t.w=e.w,t.h=e.h,t}finish(){for(let e of this.staffSystems)e.finish();this.isFinished=!0}addStaffSystem(e){e.index=this.staffSystems.length,e.boundsLookup=this,this.staffSystems.push(e),this._currentStaffSystem=e}addMasterBar(e){e.staffSystemBounds?this._masterBarLookup.set(e.index,e):(e.staffSystemBounds=this._currentStaffSystem,this._masterBarLookup.set(e.index,e),this._currentStaffSystem.addBar(e))}addBeat(e){var t;this._beatLookup.has(e.beat.id)||this._beatLookup.set(e.beat.id,[]),(t=this._beatLookup.get(e.beat.id))==null||t.push(e)}findMasterBarByIndex(e){return this._masterBarLookup.has(e)?this._masterBarLookup.get(e):null}findMasterBar(e){let t=e.index;return this._masterBarLookup.has(t)?this._masterBarLookup.get(t):null}findBeat(e){const t=this.findBeats(e);return t?t[0]:null}findBeats(e){let t=e.id;return this._beatLookup.has(t)?this._beatLookup.get(t):null}getBeatAtPos(e,t){let s=0,r=this.staffSystems.length-1,n=-1;for(;s<=r;){let l=(r+s)/2|0,u=this.staffSystems[l];if(t>=u.realBounds.y&&t<=u.realBounds.y+u.realBounds.h){n=l;break}t<u.realBounds.y?r=l-1:s=l+1}if(n===-1)return null;let o=this.staffSystems[n].findBarAtPos(e);return o?o.findBeatAtPos(e,t):null}getNoteAtPos(e,t,s){const r=this.findBeats(e);if(r)for(const n of r){const a=n.findNoteAtPos(t,s);if(a)return a}return null}}class j_{constructor(e){this._currentLayoutMode=rn.Page,this._currentRenderEngine=null,this._renderedTracks=null,this.canvas=null,this.score=null,this.tracks=null,this.layout=null,this.boundsLookup=null,this.width=0,this.preRender=new He,this.renderFinished=new He,this.partialRenderFinished=new He,this.partialLayoutFinished=new He,this.postRenderFinished=new Jt,this.error=new He,this.settings=e,this.recreateCanvas(),this.recreateLayout()}destroy(){var e;this.score=null,(e=this.canvas)==null||e.destroy(),this.canvas=null,this.layout=null,this.boundsLookup=null,this.tracks=null}recreateCanvas(){var e;return this._currentRenderEngine!==this.settings.core.engine?((e=this.canvas)==null||e.destroy(),this.canvas=D.getRenderEngineFactory(this.settings.core.engine).createCanvas(),this._currentRenderEngine=this.settings.core.engine,!0):!1}recreateLayout(){return!this.layout||this._currentLayoutMode!==this.settings.display.layoutMode?(this.layout=D.getLayoutEngineFactory(this.settings.display.layoutMode).createLayout(this),this._currentLayoutMode=this.settings.display.layoutMode,!0):!1}renderScore(e,t){try{this.score=e;let s=null;if(e!=null&&t!=null){if(!t)s=e.tracks.slice(0);else{s=[];for(let r of t)r>=0&&r<e.tracks.length&&s.push(e.tracks[r])}s.length===0&&e.tracks.length>0&&s.push(e.tracks[0])}this.tracks=s,this.render()}catch(s){this.error.trigger(s)}}renderTracks(e){e.length===0?this.score=null:this.score=e[0].score,this.tracks=e,this.render()}updateSettings(e){this.settings=e}renderResult(e){try{const t=this.layout;t?(I.debug("Rendering","Request render of lazy partial "+e),t.renderLazyPartial(e)):I.warning("Rendering","Request render of lazy partial "+e+" ignored, no layout exists")}catch(t){this.error.trigger(t)}}render(){if(this.width===0){I.warning("Rendering","AlphaTab skipped rendering because of width=0 (element invisible)",null);return}if(this.boundsLookup=new mu,this.recreateCanvas(),this.canvas.lineWidth=this.settings.display.scale,this.canvas.settings=this.settings,!this.tracks||this.tracks.length===0||!this.score)I.debug("Rendering","Clearing rendered tracks because no score or tracks are set"),this.preRender.trigger(!1),this._renderedTracks=null,this.onRenderFinished(),this.postRenderFinished.trigger(),I.debug("Rendering","Clearing finished");else{I.debug("Rendering","Rendering "+this.tracks.length+" tracks");for(let e=0;e<this.tracks.length;e++){let t=this.tracks[e];I.debug("Rendering","Track "+e+": "+t.name)}this.preRender.trigger(!1),this.recreateLayout(),this.layoutAndRender(),I.debug("Rendering","Rendering finished")}}resizeRender(){this.recreateLayout()||this.recreateCanvas()||this._renderedTracks!==this.tracks||!this.tracks?(I.debug("Rendering","Starting full rerendering due to layout or canvas change",null),this.render()):this.layout.supportsResize?(I.debug("Rendering","Starting optimized rerendering for resize"),this.boundsLookup=new mu,this.preRender.trigger(!0),this.canvas.settings=this.settings,this.layout.resize(),this.onRenderFinished(),this.postRenderFinished.trigger()):I.debug("Rendering","Current layout does not support dynamic resizing, nothing was done",null),I.debug("Rendering","Resize finished")}layoutAndRender(){I.debug("Rendering","Rendering at scale "+this.settings.display.scale+" with layout "+this.layout.name,null),this.layout.layoutAndRender(),this._renderedTracks=this.tracks,this.onRenderFinished(),this.postRenderFinished.trigger()}onRenderFinished(){var t;(t=this.boundsLookup)==null||t.finish();const e=new da;e.totalHeight=this.layout.height,e.totalWidth=this.layout.width,e.renderResult=this.canvas.onRenderFinished(),this.renderFinished.trigger(e)}}class G0{constructor(e){this._main=e,this._main.addEventListener("message",this.handleMessage.bind(this),!1)}static init(){D.globalThis.alphaTabWebWorker=new G0(D.globalThis)}handleMessage(e){let t=e.data;switch(t?t.cmd:""){case"alphaTab.initialize":let r=Dt.jsObjectToSettings(t.settings);I.logLevel=r.core.logLevel,this._renderer=new j_(r),this._renderer.partialRenderFinished.on(a=>{this._main.postMessage({cmd:"alphaTab.partialRenderFinished",result:a})}),this._renderer.partialLayoutFinished.on(a=>{this._main.postMessage({cmd:"alphaTab.partialLayoutFinished",result:a})}),this._renderer.renderFinished.on(a=>{this._main.postMessage({cmd:"alphaTab.renderFinished",result:a})}),this._renderer.postRenderFinished.on(()=>{var a;this._main.postMessage({cmd:"alphaTab.postRenderFinished",boundsLookup:((a=this._renderer.boundsLookup)==null?void 0:a.toJson())??null})}),this._renderer.preRender.on(a=>{this._main.postMessage({cmd:"alphaTab.preRender",resize:a})}),this._renderer.error.on(this.error.bind(this));break;case"alphaTab.invalidate":this._renderer.render();break;case"alphaTab.resizeRender":this._renderer.resizeRender();break;case"alphaTab.renderResult":this._renderer.renderResult(t.resultId);break;case"alphaTab.setWidth":this._renderer.width=t.width;break;case"alphaTab.renderScore":this.updateFontSizes(t.fontSizes);let n=t.score==null?null:Dt.jsObjectToScore(t.score,this._renderer.settings);this.renderMultiple(n,t.trackIndexes);break;case"alphaTab.updateSettings":this.updateSettings(t.settings);break}}updateFontSizes(e){if(!(e instanceof Map)){const t=e;e=new Map;for(const s in t)e.set(s,t[s])}if(e){Ci.FontSizeLookupTables||(Ci.FontSizeLookupTables=new Map);for(let[t,s]of e)Ci.FontSizeLookupTables.set(t,s)}}updateSettings(e){Ho.fromJson(this._renderer.settings,e)}renderMultiple(e,t){try{this._renderer.renderScore(e,t)}catch(s){this.error(s)}}error(e){I.error("Worker","An unexpected error occurred in worker",e),this._main.postMessage({cmd:"alphaTab.error",error:e})}}class fO{constructor(){this._canvas=null,this._color=new Je(0,0,0,255),this._font=new Be("Arial",10,gt.Plain),this._lineWidth=0;let e=document.createElement("span");e.classList.add("at"),document.body.appendChild(e);let t=window.getComputedStyle(e),s=t.fontFamily;(s.startsWith('"')||s.startsWith("'"))&&(s=s.substr(1,s.length-2)),this._musicFont=new Be(s,parseFloat(t.fontSize),gt.Plain),this._measureCanvas=document.createElement("canvas"),this._measureCanvas.width=10,this._measureCanvas.height=10,this._measureCanvas.style.width="10px",this._measureCanvas.style.height="10px",this._measureContext=this._measureCanvas.getContext("2d"),this._measureContext.textBaseline="hanging"}destroy(){}onRenderFinished(){return null}beginRender(e,t){this._canvas=document.createElement("canvas"),this._canvas.width=e*D.HighDpiFactor|0,this._canvas.height=t*D.HighDpiFactor|0,this._canvas.style.width=e+"px",this._canvas.style.height=t+"px",this._context=this._canvas.getContext("2d"),this._context.textBaseline="hanging",this._context.scale(D.HighDpiFactor,D.HighDpiFactor),this._context.lineWidth=this._lineWidth}endRender(){let e=this._canvas;return this._canvas=null,e}get color(){return this._color}set color(e){this._color.rgba!==e.rgba&&(this._color=e,this._context.strokeStyle=e.rgba,this._context.fillStyle=e.rgba)}get lineWidth(){return this._lineWidth}set lineWidth(e){this._lineWidth=e,this._context&&(this._context.lineWidth=e)}fillRect(e,t,s,r){s>0&&this._context.fillRect(e|0,t|0,s,r)}strokeRect(e,t,s,r){this._context.strokeRect(e|0,t|0,s,r)}beginPath(){this._context.beginPath()}closePath(){this._context.closePath()}moveTo(e,t){this._context.moveTo(e,t)}lineTo(e,t){this._context.lineTo(e,t)}quadraticCurveTo(e,t,s,r){this._context.quadraticCurveTo(e,t,s,r)}bezierCurveTo(e,t,s,r,n,a){this._context.bezierCurveTo(e,t,s,r,n,a)}fillCircle(e,t,s){this._context.beginPath(),this._context.arc(e,t,s,0,Math.PI*2,!0),this.fill()}strokeCircle(e,t,s){this._context.beginPath(),this._context.arc(e,t,s,0,Math.PI*2,!0),this.stroke()}fill(){this._context.fill(),this._context.beginPath()}stroke(){this._context.stroke(),this._context.beginPath()}get font(){return this._font}set font(e){this._font=e,this._context&&(this._context.font=e.toCssString(this.settings.display.scale)),this._measureContext.font=e.toCssString(this.settings.display.scale)}get textAlign(){switch(this._context.textAlign){case"left":return de.Left;case"center":return de.Center;case"right":return de.Right;default:return de.Left}}set textAlign(e){switch(e){case de.Left:this._context.textAlign="left";break;case de.Center:this._context.textAlign="center";break;case de.Right:this._context.textAlign="right";break}}get textBaseline(){switch(this._context.textBaseline){case"hanging":return we.Top;case"middle":return we.Middle;case"bottom":return we.Bottom;default:return we.Top}}set textBaseline(e){switch(e){case we.Top:this._context.textBaseline="hanging";break;case we.Middle:this._context.textBaseline="middle";break;case we.Bottom:this._context.textBaseline="bottom";break}}beginGroup(e){}endGroup(){}fillText(e,t,s){this._context.fillText(e,t,s)}measureText(e){const t=this._measureContext.measureText(e);return new Rd(t.width,t.actualBoundingBoxDescent-t.actualBoundingBoxAscent)}fillMusicFontSymbol(e,t,s,r,n=!1){r!==S.None&&this.fillMusicFontSymbolText(e,t,s,String.fromCharCode(r),n)}fillMusicFontSymbols(e,t,s,r,n=!1){let a="";for(let o of r)o!==S.None&&(a+=String.fromCharCode(o));this.fillMusicFontSymbolText(e,t,s,a,n)}fillMusicFontSymbolText(e,t,s,r,n=!1){let a=this._context.textAlign,o=this._context.textBaseline,l=this._context.font;this._context.font=this._musicFont.toCssString(s),this._context.textBaseline="middle",n?this._context.textAlign="center":this._context.textAlign="left",this._context.fillText(r,e,t),this._context.textBaseline=o,this._context.font=l,this._context.textAlign=a}beginRotate(e,t,s){this._context.save(),this._context.translate(e,t),this._context.rotate(s*Math.PI/180)}endRotate(){this._context.restore()}}class Lr{constructor(e,t=!1){this._midiFile=e,this._smf1Mode=t}addTimeSignature(e,t,s){let r=0,n=s;for(;n=n>>1,n>0;)r++;this._midiFile.addEvent(new T_(0,e,t,r,48,8))}addRest(e,t,s){this._smf1Mode||this._midiFile.addEvent(new B_(e,t,s))}addNote(e,t,s,r,n,a){this._midiFile.addEvent(new P_(e,t,a,Lr.fixValue(r),Lr.fixValue(n))),this._midiFile.addEvent(new M_(e,t+s,a,Lr.fixValue(r),Lr.fixValue(n)))}static fixValue(e){return e>127?127:e<0?0:e}addControlChange(e,t,s,r,n){this._midiFile.addEvent(new E_(e,t,s,r,Lr.fixValue(n)))}addProgramChange(e,t,s,r){this._midiFile.addEvent(new L_(e,t,s,r))}addTempo(e,t){const s=6e7/t|0;this._midiFile.addEvent(new D_(e,s))}addBend(e,t,s,r){r>=Ne.MaxPitchWheel?r=Ne.MaxPitchWheel:r=Math.floor(r),this._midiFile.addEvent(new A_(e,t,s,r))}addNoteBend(e,t,s,r,n){this._smf1Mode?this.addBend(e,t,s,n):(n=n*Ne.MaxPitchWheel20/Ne.MaxPitchWheel,this._midiFile.addEvent(new I_(e,t,s,r,n)))}finishTrack(e,t){(this._midiFile.format==Vo.MultiTrack||e==0)&&this._midiFile.addEvent(new R_(e,t))}}class pO{constructor(e,t){this.closingIndex=0,this.group=e,this.opening=t,e.closings=e.closings.sort((s,r)=>s.index-r.index),this.iterations=e.closings.map(s=>0)}}class gO{get finished(){return this.index>=this._score.masterBars.length}constructor(e){this._repeatStack=[],this._groupsOnStack=new Set,this._previousAlternateEndings=0,this.shouldPlay=!0,this.index=0,this.currentTick=0,this._score=e}processCurrent(){const e=this._score.masterBars[this.index];let t=e.alternateEndings;if(t===0&&(t=this._previousAlternateEndings),e===e.repeatGroup.opening&&e.repeatGroup.isClosed&&!this._groupsOnStack.has(e.repeatGroup)){const s=new pO(e.repeatGroup,e);this._repeatStack.push(s),this._groupsOnStack.add(e.repeatGroup),this._previousAlternateEndings=0,t=e.alternateEndings}if(this._repeatStack.length===0||t===0)this.shouldPlay=!0;else{const s=this._repeatStack[this._repeatStack.length-1],r=s.iterations[s.closingIndex];this._previousAlternateEndings=t,t&1<<r?this.shouldPlay=!0:this.shouldPlay=!1}this.shouldPlay&&(this.currentTick+=e.calculateDuration())}moveNext(){const t=this._score.masterBars[this.index].repeatCount-1;if(this._repeatStack.length>0&&t>0){const s=this._repeatStack[this._repeatStack.length-1];if(s.iterations[s.closingIndex]<t){this.index=s.opening.index,s.iterations[s.closingIndex]++;for(let n=0;n<s.closingIndex;n++)s.iterations[n]=0;s.closingIndex=0,this._previousAlternateEndings=0}else s.closingIndex<s.group.closings.length-1?(s.closingIndex++,this.index++):(this._repeatStack.pop(),this._groupsOnStack.delete(s.group),this.index++)}else this.index++}}class mO{constructor(e,t){this.beat=e,this.playbackStart=t}}class Hs{get duration(){return this.end-this.start}constructor(e,t){this._highlightedBeats=new Map,this.highlightedBeats=[],this.nextBeat=null,this.previousBeat=null,this.start=e,this.end=t}highlightBeat(e,t){e.isEmpty&&!e.voice.isEmpty||this._highlightedBeats.has(e.id)||(this._highlightedBeats.set(e.id,!0),this.highlightedBeats.push(new mO(e,t)))}getVisibleBeatAtStart(e){for(const t of this.highlightedBeats)if(t.playbackStart==this.start&&e.has(t.beat.voice.bar.staff.track.index))return t.beat;return null}}class gh{constructor(e,t){this.tick=e,this.tempo=t}}class U_{constructor(){this.start=0,this.end=0,this.tempoChanges=[],this.firstBeat=null,this.lastBeat=null,this.nextMasterBar=null,this.previousMasterBar=null}get tempo(){return this.tempoChanges[0].tempo}insertAfter(e,t){this.firstBeat==null||e==null||this.lastBeat==null?(this.firstBeat=t,this.lastBeat=t):(t.nextBeat=e.nextBeat,t.previousBeat=e,e.nextBeat&&(e.nextBeat.previousBeat=t),e.nextBeat=t,e==this.lastBeat&&(this.lastBeat=t))}insertBefore(e,t){this.firstBeat==null||e==null||this.lastBeat==null?(this.firstBeat=t,this.lastBeat=t):(t.previousBeat=e.previousBeat,t.nextBeat=e,e.previousBeat&&(e.previousBeat.nextBeat=t),e.previousBeat=t,e==this.firstBeat&&(this.firstBeat=t))}addBeat(e,t,s,r){const n=s+r;if(this.firstBeat==null){const a=new Hs(s,n);a.highlightBeat(e,t),this.insertAfter(this.firstBeat,a)}else if(s>=this.lastBeat.end){const a=new Hs(this.lastBeat.end,n);a.highlightBeat(e,t),this.insertAfter(this.lastBeat,a)}else{let a=null;if(s<this.firstBeat.start)a=this.firstBeat;else{let o=this.firstBeat;for(;o!=null;){if(s>=o.start&&s<o.end){a=o;break}o=o.nextBeat}if(a===null)throw new ni(ri.General,"Error on building lookup, unknown variant")}if(s<a.start)if(n==a.start){const o=new Hs(s,a.start);o.highlightBeat(e,t),this.insertBefore(this.firstBeat,o)}else if(n<a.end){const o=new Hs(s,a.start);o.highlightBeat(e,t),this.insertBefore(a,o);const l=new Hs(a.start,n);for(const u of a.highlightedBeats)l.highlightBeat(u.beat,u.playbackStart);l.highlightBeat(e,t),this.insertBefore(a,l),a.start=n}else if(n==a.end){const o=new Hs(s,a.start);o.highlightBeat(e,t),a.highlightBeat(e,t),this.insertBefore(a,o)}else{const o=new Hs(s,a.start);o.highlightBeat(e,t),a.highlightBeat(e,t),this.insertBefore(a,o),this.addBeat(e,t,a.end,n-a.end)}else if(s>a.start)if(n==a.end){const o=new Hs(a.start,s);for(const l of a.highlightedBeats)o.highlightBeat(l.beat,l.playbackStart);a.start=s,a.highlightBeat(e,t),this.insertBefore(a,o)}else if(n<a.end){const o=new Hs(a.start,s);this.insertBefore(a,o);const l=new Hs(s,n);this.insertBefore(a,l);for(const u of a.highlightedBeats)o.highlightBeat(u.beat,u.playbackStart),l.highlightBeat(u.beat,u.playbackStart);l.highlightBeat(e,t),a.start=n}else{const o=new Hs(a.start,s);for(const l of a.highlightedBeats)o.highlightBeat(l.beat,l.playbackStart);a.start=s,a.highlightBeat(e,t),this.insertBefore(a,o),this.addBeat(e,t,a.end,n-a.end)}else if(n===a.end)a.highlightBeat(e,t);else if(n<a.end){const o=new Hs(a.start,n);for(const l of a.highlightedBeats)o.highlightBeat(l.beat,l.playbackStart);o.highlightBeat(e,t),a.start=n,this.insertBefore(a,o)}else a.highlightBeat(e,t),this.addBeat(e,t,a.end,n-a.end)}}}class yO{get start(){return this.masterBar.start+this.beatLookup.start}get end(){return this.start+this.tickDuration}constructor(e){this.nextBeat=null,this.tickDuration=0,this.duration=0,this.masterBar=e}calculateDuration(){if(this.masterBar.tempoChanges.length===1)this.duration=ke.ticksToMillis(this.tickDuration,this.masterBar.tempoChanges[0].tempo);else{let e=0,t=this.start,s=this.masterBar.tempoChanges[0].tempo;const r=this.end;for(const n of this.masterBar.tempoChanges)if(n.tick<t)s=n.tempo;else{if(n.tick>r)break;e+=ke.ticksToMillis(n.tick-t,s),s=n.tempo,t=n.tick}r>t&&(e+=ke.ticksToMillis(r-t,s)),this.duration=e}}}class bO{constructor(){this._currentMasterBar=null,this.masterBarLookup=new Map,this.masterBars=[]}findBeat(e,t,s=null){let r=null;return s&&(r=this.findBeatFast(e,s,t)),r||(r=this.findBeatSlow(e,s,t,!1)),r}findBeatFast(e,t,s){if(s>=t.start&&s<t.end)return t;if(t.nextBeat&&s>=t.nextBeat.start&&s<t.nextBeat.end){const r=t.nextBeat;return this.fillNextBeat(r,e),r}return null}fillNextBeat(e,t){e.nextBeat=this.findBeatInMasterBar(e.masterBar,e.beatLookup.nextBeat,e.end,t,!1,!0),e.nextBeat==null&&(e.nextBeat=this.findBeatSlow(t,e,e.end,!0)),e.nextBeat&&(e.tickDuration=e.nextBeat.start-e.start,e.calculateDuration()),e.nextBeat||(e.tickDuration=e.masterBar.end-e.start,e.calculateDuration())}findBeatSlow(e,t,s,r){let n=null;if(t!=null&&(t.masterBar.start<=s&&t.masterBar.end>s?n=t.masterBar:t.masterBar.nextMasterBar&&t.masterBar.nextMasterBar.start<=s&&t.masterBar.nextMasterBar.end>s&&(n=t.masterBar.nextMasterBar)),n||(n=this.findMasterBar(s)),!n)return null;for(;n;){if(n.firstBeat){let a=this.findBeatInMasterBar(n,n.firstBeat,s,e,!0,r);if(a)return a}n=n.nextMasterBar}return null}findBeatInMasterBar(e,t,s,r,n,a){if(!t)return null;let o=null,l=null;const u=s-e.start;for(;t!=null&&l==null;){if(t.start<=u&&u<t.end){if(o=t,l=t.getVisibleBeatAtStart(r),!l)if(a){let c=e;for(;c!=null&&l==null;){for(;t!=null;){if(l=t.getVisibleBeatAtStart(r),l){o=t,e=c;break}t=t.nextBeat}(!l||!o)&&(c=c.nextMasterBar,t=(c==null?void 0:c.firstBeat)??null)}}else{let c=e;for(;c!=null&&l==null;){for(;t!=null;){if(l=t.getVisibleBeatAtStart(r),l){o=t,e=c;break}t=t.previousBeat}(!l||!o)&&(c=c.previousMasterBar,t=(c==null?void 0:c.firstBeat)??null)}}}else if(t.end>u)break;t=(t==null?void 0:t.nextBeat)??null}return l==null?null:this.createResult(e,o,l,n,r)}createResult(e,t,s,r,n){const a=new yO(e);return a.beat=s,a.beatLookup=t,a.tickDuration=t.end-t.start,r&&this.fillNextBeat(a,n),a.calculateDuration(),a}findMasterBar(e){const t=this.masterBars;let s=0,r=t.length-1;for(;s<=r;){const n=(r+s)/2|0,a=t[n];if(e>=a.start&&e<a.end)return a;e<a.start?r=n-1:s=n+1}return null}getMasterBar(e){if(!this.masterBarLookup.has(e.index)){const t=new U_;return t.masterBar=e,t}return this.masterBarLookup.get(e.index)}getMasterBarStart(e){return this.masterBarLookup.has(e.index)?this.masterBarLookup.get(e.index).start:0}getBeatStart(e){return this.masterBarLookup.has(e.voice.bar.index)?this.masterBarLookup.get(e.voice.bar.index).start+e.playbackStart:0}addMasterBar(e){this.masterBars.push(e),this._currentMasterBar&&(e.previousMasterBar=this._currentMasterBar,this._currentMasterBar.nextMasterBar=e),this._currentMasterBar=e,this.masterBarLookup.has(e.masterBar.index)||this.masterBarLookup.set(e.masterBar.index,e)}addBeat(e,t,s){const r=this._currentMasterBar;if(r)if(t<0&&r.previousMasterBar){const n=r.previousMasterBar.end-r.previousMasterBar.start,a=n+t,o=a+s;if(r.previousMasterBar.addBeat(e,a,a,s),o>n){const l=s+t;r.addBeat(e,t,0,l)}}else r.addBeat(e,t,t,s)}}class SO{constructor(){this.noteOnly=0,this.untilTieOrSlideEnd=0,this.letRingEnd=0}}class wO{constructor(){this.firstBeatDuration=0,this.secondBeatStartOffset=0,this.secondBeatDuration=0}}class Xe{constructor(e,t,s){this._programsPerChannel=new Map,this.tickLookup=new bO,this.applyTranspositionPitches=!0,this.transpositionPitches=new Map,this._currentTripletFeel=null,this.vibratoResolution=16,this._score=e,this._settings=t||new gu,this._handler=s}generate(){this.transpositionPitches.clear();for(const r of this._score.tracks)this.generateTrack(r);I.debug("Midi","Begin midi generation");const e=new gO(this._score);let t=null,s=this._score.tempo;for(;!e.finished;){const r=e.index,n=this._score.masterBars[r],a=e.currentTick;if(e.processCurrent(),e.shouldPlay){this.generateMasterBar(n,t,a,s),n.tempoAutomations.length>0&&(s=n.tempoAutomations[0].value);for(const o of this._score.tracks)for(const l of o.staves)r<l.bars.length&&this.generateBar(l.bars[r],a,s);n.tempoAutomations.length>0&&(s=n.tempoAutomations[n.tempoAutomations.length-1].value)}e.moveNext(),t=n}for(const r of this._score.tracks)this._handler.finishTrack(r.index,e.currentTick);I.debug("Midi","Midi generation done")}generateTrack(e){this.generateChannel(e,e.playbackInfo.primaryChannel,e.playbackInfo),e.playbackInfo.primaryChannel!==e.playbackInfo.secondaryChannel&&this.generateChannel(e,e.playbackInfo.secondaryChannel,e.playbackInfo)}addProgramChange(e,t,s,r){(!this._programsPerChannel.has(s)||this._programsPerChannel.get(s)!==r)&&(this._handler.addProgramChange(e.index,t,s,r),this._programsPerChannel.set(s,r))}static buildTranspositionPitches(e,t){const s=new Map;for(const r of e.tracks){const n=r.index<t.notation.transpositionPitches.length?t.notation.transpositionPitches[r.index]:0;s.set(r.playbackInfo.primaryChannel,n),s.set(r.playbackInfo.secondaryChannel,n)}return s}generateChannel(e,t,s){const r=e.index<this._settings.notation.transpositionPitches.length?this._settings.notation.transpositionPitches[e.index]:0;this.transpositionPitches.set(t,r);let n=Xe.toChannelShort(s.volume),a=Xe.toChannelShort(s.balance);this._handler.addControlChange(e.index,0,t,Ke.VolumeCoarse,n),this._handler.addControlChange(e.index,0,t,Ke.PanCoarse,a),this._handler.addControlChange(e.index,0,t,Ke.ExpressionControllerCoarse,127),this._handler.addControlChange(e.index,0,t,Ke.RegisteredParameterFine,0),this._handler.addControlChange(e.index,0,t,Ke.RegisteredParameterCourse,0),this._handler.addControlChange(e.index,0,t,Ke.DataEntryFine,0),this._handler.addControlChange(e.index,0,t,Ke.DataEntryCoarse,Xe.PitchBendRangeInSemitones),this.addProgramChange(e,0,t,s.program)}static toChannelShort(e){const t=Math.max(-32768,Math.min(32767,e*8-1));return Math.max(t,-1)+1}generateMasterBar(e,t,s,r){(!t||t.timeSignatureDenominator!==e.timeSignatureDenominator||t.timeSignatureNumerator!==e.timeSignatureNumerator)&&this._handler.addTimeSignature(s,e.timeSignatureNumerator,e.timeSignatureDenominator);const n=e.calculateDuration(),a=new U_;if(e.tempoAutomations.length>0){e.tempoAutomations[0].ratioPosition>0&&a.tempoChanges.push(new gh(s,r));for(const o of e.tempoAutomations){const l=s+n*o.ratioPosition;this._handler.addTempo(l,o.value),a.tempoChanges.push(new gh(l,o.value))}}else t?a.tempoChanges.push(new gh(s,r)):(this._handler.addTempo(s,e.score.tempo),a.tempoChanges.push(new gh(s,e.score.tempo)));a.masterBar=e,a.start=s,a.end=a.start+n,this.tickLookup.addMasterBar(a)}generateBar(e,t,s){let r=this.getPlaybackBar(e);for(const n of r.voices)this.generateVoice(n,t,e,s)}getPlaybackBar(e){switch(e.simileMark){case Es.Simple:e.previousBar&&(e=this.getPlaybackBar(e.previousBar));break;case Es.FirstOfDouble:e.previousBar&&e.previousBar.previousBar&&(e=this.getPlaybackBar(e.previousBar.previousBar));break;case Es.SecondOfDouble:e.previousBar&&e.previousBar.previousBar&&(e=this.getPlaybackBar(e.previousBar.previousBar));break}return e}generateVoice(e,t,s,r){if(e.isEmpty&&(!e.bar.isEmpty||e.index!==0))return;const n=s.masterBar.tempoAutomations.slice();let a=r;const o=s.masterBar.calculateDuration();for(const l of e.beats){const u=l.playbackStart/o;for(;n.length>0&&n[0].ratioPosition<=u;)a=n.shift().value;this.generateBeat(l,t,s,a)}}generateBeat(e,t,s,r){let n=e.playbackStart,a=e.playbackDuration;const o=e.voice.bar.masterBar.calculateDuration();e.voice.bar.isEmpty?a=o:e.voice.bar.masterBar.tripletFeel!==Pe.NoTripletFeel&&this._settings.player.playTripletFeel&&(this._currentTripletFeel?(n-=this._currentTripletFeel.secondBeatStartOffset,a=this._currentTripletFeel.secondBeatDuration,this._currentTripletFeel=null):(this._currentTripletFeel=Xe.calculateTripletFeelInfo(n,a,e),this._currentTripletFeel&&(a=this._currentTripletFeel.firstBeatDuration))),s===e.voice.bar?this.tickLookup.addBeat(e,n,a):this.tickLookup.addBeat(e,0,a);const l=e.voice.bar.staff.track;for(const u of e.automations)this.generateNonTempoAutomation(e,u,t);if(e.isRest)this._handler.addRest(l.index,t+n,l.playbackInfo.primaryChannel);else{let u=this.getBrushInfo(e);for(const h of e.notes)this.generateNote(h,t+n,a,r,u)}if(e.vibrato!==Ge.None){let u=240,h=3;switch(e.vibrato){case Ge.Slight:u=this._settings.player.vibrato.beatSlightLength,h=this._settings.player.vibrato.beatSlightAmplitude;break;case Ge.Wide:u=this._settings.player.vibrato.beatWideLength,h=this._settings.player.vibrato.beatWideAmplitude;break}this.generateVibratorWithParams(t+n,e.playbackDuration,u,h,(c,d)=>{this._handler.addBend(e.voice.bar.staff.track.index,c,l.playbackInfo.secondaryChannel,d)})}}static calculateTripletFeelInfo(e,t,s){let r;switch(s.voice.bar.masterBar.tripletFeel){case Pe.Triplet8th:case Pe.Dotted8th:case Pe.Scottish8th:r=N.Eighth;break;case Pe.Triplet16th:case Pe.Dotted16th:case Pe.Scottish16th:r=N.Sixteenth;break;default:return null}const n=ke.toTicks(r);if(t!==n||e%n!==0||!s.nextBeat||s.nextBeat.voice!==s.voice||s.playbackDuration!==n)return null;const a=new wO;switch(s.voice.bar.masterBar.tripletFeel){case Pe.Triplet8th:a.firstBeatDuration=ke.applyTuplet(ke.toTicks(N.Quarter),3,2),a.secondBeatDuration=ke.applyTuplet(ke.toTicks(N.Eighth),3,2);break;case Pe.Dotted8th:a.firstBeatDuration=ke.applyDot(ke.toTicks(N.Eighth),!1),a.secondBeatDuration=ke.toTicks(N.Sixteenth);break;case Pe.Scottish8th:a.firstBeatDuration=ke.toTicks(N.Sixteenth),a.secondBeatDuration=ke.applyDot(ke.toTicks(N.Eighth),!1);break;case Pe.Triplet16th:a.firstBeatDuration=ke.applyTuplet(ke.toTicks(N.Eighth),3,2),a.secondBeatDuration=ke.applyTuplet(ke.toTicks(N.Sixteenth),3,2);break;case Pe.Dotted16th:a.firstBeatDuration=ke.applyDot(ke.toTicks(N.Sixteenth),!1),a.secondBeatDuration=ke.toTicks(N.ThirtySecond);break;case Pe.Scottish16th:a.firstBeatDuration=ke.toTicks(N.ThirtySecond),a.secondBeatDuration=ke.applyDot(ke.toTicks(N.Sixteenth),!1);break}return a.secondBeatStartOffset=t-a.firstBeatDuration,a}generateNote(e,t,s,r,n){const a=e.beat.voice.bar.staff.track,o=e.beat.voice.bar.staff;let l=e.calculateRealValue(this.applyTranspositionPitches,!0);if(e.isPercussion){const g=Lt.getArticulation(e);g&&(l=g.outputMidiNumber)}const u=e.isStringed&&e.string<=n.length?n[e.string-1]:0,h=t+u,c=this.getNoteDuration(e,s,r);c.untilTieOrSlideEnd-=u,c.noteOnly-=u,c.letRingEnd-=u;const d=Xe.getNoteVelocity(e),f=e.hasBend||e.beat.hasWhammyBar||e.beat.vibrato!==Ge.None?a.playbackInfo.secondaryChannel:a.playbackInfo.primaryChannel;let p=0;if(e.hasBend?p=Xe.getPitchWheel(e.bendPoints[0].value):e.beat.hasWhammyBar?p=Xe.getPitchWheel(e.beat.whammyBarPoints[0].value):e.isTieDestination||e.slideOrigin&&e.slideOrigin.slideOutType===xe.Legato?p=-1:p=Xe.getPitchWheel(0),p>=0&&this._handler.addNoteBend(a.index,h,f,l,p),e.beat.fadeIn&&this.generateFadeIn(e,h,c),e.isTrill&&!o.isPercussion){this.generateTrill(e,h,c,l,d,f);return}if(e.beat.isTremolo){this.generateTremoloPicking(e,h,c,l,d,f);return}if(e.hasBend?this.generateBend(e,h,c,l,f,r):e.beat.hasWhammyBar&&e.index===0?this.generateWhammy(e.beat,h,c,f,r):e.slideInType!==ii.None||e.slideOutType!==xe.None?this.generateSlide(e,h,c,l,f,r):(e.vibrato!==Ge.None||e.isTieDestination&&e.tieOrigin.vibrato!==Ge.None)&&this.generateVibrato(e,h,c,l,f),!e.isTieDestination&&(!e.slideOrigin||e.slideOrigin.slideOutType!==xe.Legato)){let g=Math.max(c.untilTieOrSlideEnd,c.letRingEnd);this._handler.addNote(a.index,h,g,l,d,f)}}getNoteDuration(e,t,s){const r=new SO;if(r.noteOnly=t,r.untilTieOrSlideEnd=t,r.letRingEnd=t,e.isDead)return r.noteOnly=this.applyStaticDuration(Xe.DefaultDurationDead,t,s),r.untilTieOrSlideEnd=r.noteOnly,r.letRingEnd=r.noteOnly,r;if(e.isPalmMute)return r.noteOnly=this.applyStaticDuration(Xe.DefaultDurationPalmMute,t,s),r.untilTieOrSlideEnd=r.noteOnly,r.letRingEnd=r.noteOnly,r;if(e.isStaccato)return r.noteOnly=t/2|0,r.untilTieOrSlideEnd=r.noteOnly,r.letRingEnd=r.noteOnly,r;if(e.isTieOrigin){const n=e.tieDestination;if(n)if(e.isTieDestination){const a=this.getNoteDuration(n,n.beat.playbackDuration,s);r.untilTieOrSlideEnd=t+a.untilTieOrSlideEnd}else{const a=e.beat.absolutePlaybackStart,o=this.getNoteDuration(n,n.beat.playbackDuration,s),l=n.beat.absolutePlaybackStart+o.untilTieOrSlideEnd;r.untilTieOrSlideEnd=l-a}}else if(e.slideOutType===xe.Legato){const n=e.slideTarget;if(n){const a=e.beat.absolutePlaybackStart,o=this.getNoteDuration(n,n.beat.playbackDuration,s),l=n.beat.absolutePlaybackStart+o.untilTieOrSlideEnd;r.untilTieOrSlideEnd=l-a}}if(e.isLetRing&&this._settings.notation.notationMode===Qt.GuitarPro){let n=e.beat,a=0;const o=e.beat.voice.bar.masterBar.calculateDuration();for(;n.nextBeat;){let l=n.nextBeat;if(l.isRest||e.isStringed&&l.hasNoteOnString(e.string))break;if(n=n.nextBeat,a=n.absolutePlaybackStart-e.beat.absolutePlaybackStart+n.playbackDuration,a>o){a=o;break}}n===e.beat?r.letRingEnd=t:r.letRingEnd=a}else r.letRingEnd=r.untilTieOrSlideEnd;return r}applyStaticDuration(e,t,s){const r=s*e/G.MaxPosition|0;return Math.min(r,t)}static getNoteVelocity(e){let t=e.dynamics;switch(!e.beat.voice.bar.staff.isPercussion&&e.hammerPullOrigin&&t--,e.isGhost&&t--,e.accentuated){case _t.Normal:t++;break;case _t.Heavy:t+=2;break}return ke.dynamicToVelocity(t)}generateFadeIn(e,t,s){const r=e.beat.voice.bar.staff.track,a=Xe.toChannelShort(r.playbackInfo.volume)/s.noteOnly,o=120,l=s.noteOnly/o|0,u=t+s.noteOnly;for(let h=l-1;h>=0;h--){const c=u-h*o,d=(c-t)*a;h===l-1&&(this._handler.addControlChange(r.index,t,r.playbackInfo.primaryChannel,Ke.VolumeCoarse,d),this._handler.addControlChange(r.index,t,r.playbackInfo.secondaryChannel,Ke.VolumeCoarse,d)),this._handler.addControlChange(r.index,c,r.playbackInfo.primaryChannel,Ke.VolumeCoarse,d),this._handler.addControlChange(r.index,c,r.playbackInfo.secondaryChannel,Ke.VolumeCoarse,d)}}generateVibrato(e,t,s,r,n){let a=0,o=0;switch(e.vibrato!==Ge.None?e.vibrato:e.isTieDestination?e.tieOrigin.vibrato:Ge.Slight){case Ge.Slight:a=this._settings.player.vibrato.noteSlightLength,o=this._settings.player.vibrato.noteSlightAmplitude;break;case Ge.Wide:a=this._settings.player.vibrato.noteWideLength,o=this._settings.player.vibrato.noteWideAmplitude;break;default:return}const u=e.beat.voice.bar.staff.track;this.generateVibratorWithParams(t,s.noteOnly,a,o,(h,c)=>{this._handler.addNoteBend(u.index,h,n,r,c)})}generateVibratorWithParams(e,t,s,r,n){const a=this.vibratoResolution,o=s/2|0;e+=s;const l=e+t;for(;e<l;){let u=0;const h=e+s<l?s:l-e;for(;u<h;){let c=r*Math.sin(u*Math.PI/o);n(e+u|0,Xe.getPitchWheel(c)),u+=a}e+=s}}static getPitchWheel(e){return Ne.DefaultPitchWheel+e/2*Xe.PitchValuePerSemitone}generateSlide(e,t,s,r,n,a){let o=e.slideOutType===xe.Legato?s.noteOnly:s.untilTieOrSlideEnd,l=[],u=e.beat.voice.bar.staff.track;const h=this._settings.player.slide.simpleSlidePitchOffset,c=Math.floor(G.MaxPosition*this._settings.player.slide.simpleSlideDurationRatio),d=Math.floor(G.MaxPosition*this._settings.player.slide.shiftSlideDurationRatio);switch(e.slideInType){case ii.IntoFromAbove:l.push(new G(0,h)),l.push(new G(c,0));break;case ii.IntoFromBelow:l.push(new G(0,-h)),l.push(new G(c,0));break}switch(e.slideOutType){case xe.Legato:case xe.Shift:l.push(new G(d,0));const f=(e.slideTarget.calculateRealValue(this.applyTranspositionPitches,!0)-e.calculateRealValue(this.applyTranspositionPitches,!0))*2;l.push(new G(G.MaxPosition,f));break;case xe.OutDown:l.push(new G(G.MaxPosition-c,0)),l.push(new G(G.MaxPosition,-h));break;case xe.OutUp:l.push(new G(G.MaxPosition-c,0)),l.push(new G(G.MaxPosition,h));break}this.generateWhammyOrBend(t,o,l,a,(f,p)=>{this._handler.addNoteBend(u.index,f,n,r,p)})}generateBend(e,t,s,r,n,a){let o=e.bendPoints,l=e.beat.voice.bar.staff.track;const u=(p,g)=>{this._handler.addNoteBend(l.index,p,n,r,g)};let h=null,c;if(e.isTieOrigin&&this._settings.notation.extendBendArrowsOnTiedNotes){let p=e;for(;p.isTieOrigin&&!p.tieDestination.hasBend;)p=p.tieDestination;c=p.beat.absolutePlaybackStart-e.beat.absolutePlaybackStart+this.getNoteDuration(p,p.beat.playbackDuration,a).noteOnly}else if(e.isTieOrigin&&e.beat.graceType!==he.None){switch(e.tieDestination.bendType){case se.Bend:case se.BendRelease:case se.PrebendBend:h=e.tieDestination.bendPoints[1].value;break;case se.Prebend:case se.PrebendRelease:h=e.tieDestination.bendPoints[0].value;break}c=Math.max(s.noteOnly,ke.millisToTicks(this._settings.player.songBookBendDuration,a))}else c=s.noteOnly;o[0].value>0&&!e.isContinuedBend&&t>0&&t--;const d=Math.min(c,ke.millisToTicks(this._settings.player.songBookBendDuration,a));let f=[];switch(e.bendType){case se.Custom:f=o;break;case se.Bend:case se.Release:switch(e.bendStyle){case qe.Default:f=o;break;case qe.Gradual:f.push(new G(0,e.bendPoints[0].value)),(!h||h<e.bendPoints[1].value)&&(h=e.bendPoints[1].value),f.push(new G(G.MaxPosition,h));break;case qe.Fast:(!h||h<e.bendPoints[1].value)&&(h=e.bendPoints[1].value),e.beat.graceType===he.BendGrace?this.generateSongBookWhammyOrBend(t,c,!0,[e.bendPoints[0].value,h],d,a,u):this.generateSongBookWhammyOrBend(t,c,!1,[e.bendPoints[0].value,h],d,a,u);return}break;case se.BendRelease:switch(e.bendStyle){case qe.Default:f=o;break;case qe.Gradual:f.push(new G(0,e.bendPoints[0].value)),f.push(new G(G.MaxPosition/2|0,e.bendPoints[1].value)),f.push(new G(G.MaxPosition,e.bendPoints[2].value));break;case qe.Fast:this.generateSongBookWhammyOrBend(t,c,!1,[e.bendPoints[0].value,e.bendPoints[1].value,e.bendPoints[2].value],d,a,u);return}break;case se.Hold:f=o;break;case se.Prebend:f=o;break;case se.PrebendBend:switch(e.bendStyle){case qe.Default:f=o;break;case qe.Gradual:f.push(new G(0,e.bendPoints[0].value)),f.push(new G(G.MaxPosition,e.bendPoints[1].value));break;case qe.Fast:const p=Xe.getPitchWheel(e.bendPoints[0].value);u(t,p|0),(!h||h<e.bendPoints[1].value)&&(h=e.bendPoints[1].value),this.generateSongBookWhammyOrBend(t,c,!1,[e.bendPoints[0].value,h],d,a,u);return}break;case se.PrebendRelease:switch(e.bendStyle){case qe.Default:f=o;break;case qe.Gradual:f.push(new G(0,e.bendPoints[0].value)),f.push(new G(G.MaxPosition,e.bendPoints[1].value));break;case qe.Fast:const p=Xe.getPitchWheel(e.bendPoints[0].value);u(t,p|0),this.generateSongBookWhammyOrBend(t,c,!1,[e.bendPoints[0].value,e.bendPoints[1].value],d,a,u);return}break}this.generateWhammyOrBend(t,c,f,a,u)}generateSongBookWhammyOrBend(e,t,s,r,n,a,o){const l=s?e:e+t-n,u=n/(r.length-1);for(let h=0;h<r.length-1;h++){const c=Xe.getPitchWheel(r[h]),d=Xe.getPitchWheel(r[h+1]),f=l+u*h;this.generateBendValues(f,u,c,d,a,o)}}generateWhammy(e,t,s,r,n){const a=e.whammyBarPoints,o=e.voice.bar.staff.track,l=s.noteOnly;a[0].value>0&&!e.isContinuedWhammy&&t--;const u=(c,d)=>{this._handler.addBend(o.index,c,r,d)};let h=[];switch(e.whammyBarType){case je.Custom:h=a;break;case je.Dive:switch(e.whammyStyle){case qe.Default:h=a;break;case qe.Gradual:h.push(new G(0,a[0].value)),h.push(new G(G.MaxPosition,a[1].value));break;case qe.Fast:const c=Math.min(l,ke.millisToTicks(this._settings.player.songBookBendDuration,n));this.generateSongBookWhammyOrBend(t,l,!1,[a[0].value,a[1].value],c,n,u);return}break;case je.Dip:switch(e.whammyStyle){case qe.Default:h=a;break;case qe.Gradual:h.push(new G(0,a[0].value)),h.push(new G(G.MaxPosition/2|0,a[1].value)),h.push(new G(G.MaxPosition,a[2].value));break;case qe.Fast:const c=Math.min(l,ke.millisToTicks(this._settings.player.songBookDipDuration,n));this.generateSongBookWhammyOrBend(t,l,!0,[a[0].value,a[1].value,a[2].value],c,n,u);return}break;case je.Hold:h=a;break;case je.Predive:h=a;break;case je.PrediveDive:switch(e.whammyStyle){case qe.Default:h=a;break;case qe.Gradual:h.push(new G(0,a[0].value)),h.push(new G(G.MaxPosition/2|0,a[0].value)),h.push(new G(G.MaxPosition,a[1].value));break;case qe.Fast:const c=Xe.getPitchWheel(a[0].value);this._handler.addBend(o.index,t,r,c|0);const d=Math.min(l,ke.millisToTicks(this._settings.player.songBookBendDuration,n));this.generateSongBookWhammyOrBend(t,l,!1,[a[0].value,a[1].value],d,n,u);return}break}this.generateWhammyOrBend(t,l,h,n,u)}generateWhammyOrBend(e,t,s,r,n){const a=t/G.MaxPosition;for(let o=0;o<s.length-1;o++){const l=s[o],u=s[o+1],h=Xe.getPitchWheel(l.value),c=Xe.getPitchWheel(u.value),d=a*(u.offset-l.offset),f=e+a*l.offset;this.generateBendValues(f,d,h,c,r,n)}}generateBendValues(e,t,s,r,n,a){const o=ke.ticksToMillis(t,n),l=Math.abs(r-s)/Xe.PitchValuePerSemitone,u=Math.max(Xe.MinBreakpointsPerSemitone*l,o/Xe.MillisecondsPerBreakpoint),h=t/u,c=(r-s)/u;for(let d=0;d<u;d++)a(e|0,Math.round(s)),s+=c,e+=h;s<r&&a(e|0,r)}generateTrill(e,t,s,r,n,a){const o=e.beat.voice.bar.staff.track,l=e.stringTuning+e.trillFret;let u=ke.toTicks(e.trillSpeed),h=!0,c=t,d=t+s.untilTieOrSlideEnd;for(;c+10<d;)c+u>=d&&(u=d-c),this._handler.addNote(o.index,c,u,h?l:r,n,a),h=!h,c+=u}generateTremoloPicking(e,t,s,r,n,a){const o=e.beat.voice.bar.staff.track;let l=ke.toTicks(e.beat.tremoloSpeed),u=t;const h=t+s.untilTieOrSlideEnd;for(;u+10<h;)u+l>=h&&(l=h-u),this._handler.addNote(o.index,u,l,r,n,a),u+=l}getBrushInfo(e){const t=new Int32Array(e.voice.bar.staff.tuning.length);if(e.brushType!==ut.None){let s=0,r=0;for(const n of e.notes)n.isTieDestination||(s|=1<<n.string-1,r++);if(e.notes.length>0){let n=0;const a=e.brushDuration/(r-1)|0;for(let o=0;o<e.voice.bar.staff.tuning.length;o++){let l=e.brushType===ut.ArpeggioDown||e.brushType===ut.BrushDown?o:t.length-1-o;s&1<<l&&(t[l]=n,n+=a)}}}return t}generateNonTempoAutomation(e,t,s){switch(t.type){case jt.Instrument:this.addProgramChange(e.voice.bar.staff.track,e.playbackStart+s,e.voice.bar.staff.track.playbackInfo.primaryChannel,(t.value|0)&255),this.addProgramChange(e.voice.bar.staff.track,e.playbackStart+s,e.voice.bar.staff.track.playbackInfo.secondaryChannel,(t.value|0)&255);break;case jt.Balance:let r=Xe.toChannelShort(t.value);this._handler.addControlChange(e.voice.bar.staff.track.index,e.playbackStart+s,e.voice.bar.staff.track.playbackInfo.primaryChannel,Ke.PanCoarse,r),this._handler.addControlChange(e.voice.bar.staff.track.index,e.playbackStart+s,e.voice.bar.staff.track.playbackInfo.secondaryChannel,Ke.PanCoarse,r);break;case jt.Volume:let n=Xe.toChannelShort(t.value);this._handler.addControlChange(e.voice.bar.staff.track.index,e.playbackStart+s,e.voice.bar.staff.track.playbackInfo.primaryChannel,Ke.VolumeCoarse,n),this._handler.addControlChange(e.voice.bar.staff.track.index,e.playbackStart+s,e.voice.bar.staff.track.playbackInfo.secondaryChannel,Ke.VolumeCoarse,n);break}}prepareSingleBeat(e){let t=-1,s=-1,r=e;for(;r&&(t===-1||s===-1);){for(const h of e.automations)switch(h.type){case jt.Instrument:s=h.value;break;case jt.Tempo:t=h.value;break}r=r.previousBeat}const n=e.voice.bar.staff.track,a=e.voice.bar.masterBar;t===-1&&(t=a.score.tempo);const o=e.playbackStart/a.calculateDuration();for(const h of a.tempoAutomations)if(h.ratioPosition<=o)t=h.value;else break;s===-1&&(s=n.playbackInfo.program);const l=n.playbackInfo.volume;this.generateTrack(n),this._handler.addTimeSignature(0,a.timeSignatureNumerator,a.timeSignatureDenominator),this._handler.addTempo(0,t);let u=Xe.toChannelShort(l);return this._handler.addControlChange(0,0,n.playbackInfo.primaryChannel,Ke.VolumeCoarse,u),this._handler.addControlChange(0,0,n.playbackInfo.secondaryChannel,Ke.VolumeCoarse,u),t}generateSingleBeat(e){const t=this.prepareSingleBeat(e);this.generateBeat(e,-e.playbackStart,e.voice.bar,t)}generateSingleNote(e){const t=this.prepareSingleBeat(e.beat);this.generateNote(e,0,e.beat.playbackDuration,t,new Int32Array(e.beat.voice.bar.staff.tuning.length))}}Xe.DefaultDurationDead=30;Xe.DefaultDurationPalmMute=80;Xe.PitchBendRangeInSemitones=8*2;Xe.PitchValuePerSemitone=Ne.DefaultPitchWheel/Xe.PitchBendRangeInSemitones;Xe.MinBreakpointsPerSemitone=6;Xe.MillisecondsPerBreakpoint=150;class $_{constructor(){this.startTick=0,this.endTick=0}}class vt{constructor(e,t){this.width=0,this.height=0,this.x=e,this.y=t}get scale(){return this.renderer.scale}doLayout(){}paint(e,t,s){}}class vs extends vt{constructor(e=0,t=0){super(e,t),this.beat=null,this.nextGlyph=null,this.previousGlyph=null}}class Rt extends vs{constructor(e,t,s,r){super(e,t),this.glyphScale=0,this.glyphScale=s,this.symbol=r}paint(e,t,s){s.fillMusicFontSymbol(e+this.x,t+this.y,this.glyphScale*this.scale,this.symbol,!1)}}class Se extends Rt{constructor(e,t,s,r){super(e,t,r?Se.GraceScale:1,Se.getSymbol(s)),this._isGrace=r,this._duration=s}paint(e,t,s){let r=this._isGrace?this.scale:0;s.fillMusicFontSymbol(e+this.x,t+this.y+r,this.glyphScale*this.scale,this.symbol,!1)}doLayout(){let e=(this._isGrace?Se.GraceScale:1)*this.scale;switch(this._duration){case N.QuadrupleWhole:this.width=14*e;break;case N.DoubleWhole:this.width=14*(this._isGrace?Se.GraceScale:1)*this.scale;break;case N.Whole:this.width=14*(this._isGrace?Se.GraceScale:1)*this.scale;break;default:this.width=Se.QuarterNoteHeadWidth*(this._isGrace?Se.GraceScale:1)*this.scale;break}this.height=Se.NoteHeadHeight*e}static getSymbol(e){switch(e){case N.QuadrupleWhole:return S.NoteheadDoubleWholeSquare;case N.DoubleWhole:return S.NoteheadDoubleWhole;case N.Whole:return S.NoteheadWhole;case N.Half:return S.NoteheadHalf;default:return S.NoteheadBlack}}}Se.GraceScale=.75;Se.NoteHeadHeight=8;Se.QuarterNoteHeadWidth=9;class Ou extends Rt{constructor(e,t,s,r,n){super(e,t,n?Se.GraceScale:1,Ou.getSymbol(s,r,n))}doLayout(){this.width=0}static getSymbol(e,t,s){if(s&&(e=N.Eighth),t===R.Up)switch(e){case N.Eighth:return S.FlagEighthUp;case N.Sixteenth:return S.FlagSixteenthUp;case N.ThirtySecond:return S.FlagThirtySecondUp;case N.SixtyFourth:return S.FlagSixtyFourthUp;case N.OneHundredTwentyEighth:return S.FlagOneHundredTwentyEighthUp;case N.TwoHundredFiftySixth:return S.FlagTwoHundredFiftySixthUp;default:return S.FlagEighthUp}switch(e){case N.Eighth:return S.FlagEighthDown;case N.Sixteenth:return S.FlagSixteenthDown;case N.ThirtySecond:return S.FlagThirtySecondDown;case N.SixtyFourth:return S.FlagSixtyFourthDown;case N.OneHundredTwentyEighth:return S.FlagOneHundredTwentyEighthDown;case N.TwoHundredFiftySixth:return S.FlagOneHundredTwentyEighthDown;default:return S.FlagEighthDown}}}Ou.FlagWidth=11;class Cs extends vt{get onTimeX(){return this.onNotes.x+this.onNotes.centerX}constructor(e,t){super(0,0),this.ties=[],this.minWidth=0,this.beat=e,this.ties=[],this.voiceContainer=t}addTie(e){e.renderer=this.renderer,this.ties.push(e)}drawBeamHelperAsFlags(e){return e.hasFlag(!1,void 0)}registerLayoutingInfo(e){let t=this.preNotes.computedWidth+this.onNotes.centerX;this.beat.graceGroup&&!this.beat.graceGroup.isComplete&&(t+=Cs.GraceBeatPadding*this.renderer.scale);let s=this.onNotes.computedWidth-this.onNotes.centerX;const r=this.renderer.helpers.getBeamingHelperForBeat(this.beat);(r&&this.drawBeamHelperAsFlags(r)||this.beat.graceType!==he.None)&&(s+=Ou.FlagWidth*this.scale*(this.beat.graceType!==he.None?Se.GraceScale:1));for(const n of this.ties)s+=n.width;this.beat.graceType!==he.None&&(s+=Cs.GraceBeatPadding*this.renderer.scale),e.addBeatSpring(this.beat,t,s),e.setPreBeatSize(this.beat,this.preNotes.computedWidth),e.setOnBeatSize(this.beat,this.onNotes.computedWidth),e.setBeatCenterX(this.beat,this.onNotes.centerX)}applyLayoutingInfo(e){let t=e.getBeatCenterX(this.beat)-this.onNotes.centerX;this.beat.graceGroup&&!this.beat.graceGroup.isComplete&&(t+=Cs.GraceBeatPadding*this.renderer.scale),this.preNotes.x=t,this.preNotes.width=e.getPreBeatSize(this.beat),this.onNotes.width=e.getOnBeatSize(this.beat),this.onNotes.x=this.preNotes.x+this.preNotes.width,this.onNotes.updateBeamingHelper(),this.updateWidth()}doLayout(){this.preNotes.x=0,this.preNotes.renderer=this.renderer,this.preNotes.container=this,this.preNotes.doLayout(),this.onNotes.x=this.preNotes.x+this.preNotes.width,this.onNotes.renderer=this.renderer,this.onNotes.container=this,this.onNotes.doLayout();let e=this.beat.notes.length-1;for(;e>=0;)this.createTies(this.beat.notes[e--]);this.renderer.registerTies(this.ties),this.updateWidth()}updateWidth(){if(this.minWidth=this.preNotes.width+this.onNotes.width,!this.beat.isRest)if(this.onNotes.beamingHelper.beats.length===1)this.beat.duration>=N.Eighth&&(this.minWidth+=20*this.scale);else switch(this.beat.duration){case N.OneHundredTwentyEighth:case N.TwoHundredFiftySixth:this.minWidth+=10*this.scale;break}let e=0;for(let t of this.ties)t.width>e&&(e=t.width);this.minWidth+=e,this.width=this.minWidth}scaleToWidth(e){this.onNotes.updateBeamingHelper(),this.width=e}createTies(e){}static getGroupId(e){return"b"+e.id}paint(e,t,s){if(this.beat.voice.isEmpty||this.preNotes.isEmpty&&this.onNotes.isEmpty&&this.ties.length===0)return;s.beginGroup(Cs.getGroupId(this.beat)),this.preNotes.paint(e+this.x,t+this.y,s),this.onNotes.paint(e+this.x,t+this.y,s);let n=e-this.voiceContainer.x-this.renderer.x,a=t-this.voiceContainer.y-this.renderer.y;for(let o=0,l=this.ties.length;o<l;o++){let u=this.ties[o];u.renderer=this.renderer,u.paint(n,a,s)}s.endGroup()}buildBoundingsLookup(e,t,s,r){let n=new z_;n.beat=this.beat,n.visualBounds=new Wi,n.visualBounds.x=t+this.x+this.onNotes.x,n.visualBounds.y=e.visualBounds.y,n.visualBounds.w=this.onNotes.width,n.visualBounds.h=e.visualBounds.h,n.realBounds=new Wi,n.realBounds.x=t+this.x,n.realBounds.y=e.realBounds.y,n.realBounds.w=this.width,n.realBounds.h=e.realBounds.h,r&&(n.visualBounds.x=t+this.x,n.realBounds.x=n.visualBounds.x),e.addBeat(n),this.renderer.settings.core.includeNoteBounds&&this.onNotes.buildBoundingsLookup(n,t+this.x,s+this.y)}}Cs.GraceBeatPadding=3;class rS{constructor(){this.oldWidth=0,this.newWidth=0,this.settings=null}core(){return this.settings&&this.causeIssue()?this.settings.core:new iT}causeIssue(){return this.settings=null,!0}}class Y_{constructor(e){this.activeBeats=e}}class mh{constructor(e){this.bounds=null,this.beat=e}}class vO{constructor(e,t){this._startTime=0,this._trackIndexes=null,this._trackIndexLookup=null,this._isDestroyed=!1,this.score=null,this.tracks=[],this._tickCache=null,this.player=null,this._cursorWrapper=null,this._barCursor=null,this._beatCursor=null,this._selectionWrapper=null,this._previousTick=0,this._playerState=zt.Paused,this._currentBeat=null,this._currentBarBounds=null,this._previousStateForCursor=zt.Paused,this._previousCursorCache=null,this._lastScroll=0,this.playedBeatChanged=new He,this.activeBeatsChanged=new He,this._beatMouseDown=!1,this._noteMouseDown=!1,this._selectionStart=null,this._selectionEnd=null,this.beatMouseDown=new He,this.beatMouseMove=new He,this.beatMouseUp=new He,this.noteMouseDown=new He,this.noteMouseMove=new He,this.noteMouseUp=new He,this.scoreLoaded=new He,this.resize=new He,this.renderStarted=new He,this.renderFinished=new He,this.postRenderFinished=new Jt,this.error=new He,this.playerReady=new Jt,this.playerFinished=new Jt,this.soundFontLoaded=new Jt,this.midiLoad=new He,this.midiLoaded=new He,this.playerStateChanged=new He,this.playerPositionChanged=new He,this.midiEventsPlayed=new He,this.playbackRangeChanged=new He,this.settingsUpdated=new Jt,this.uiFacade=e,this.container=e.rootContainer,e.initialize(this,t),I.logLevel=this.settings.core.logLevel,this.canvasElement=e.createCanvasElement(),this.container.appendChild(this.canvasElement),this.settings.core.useWorkers&&this.uiFacade.areWorkersSupported&&D.getRenderEngineFactory(this.settings.core.engine).supportsWorkers?this.renderer=this.uiFacade.createWorkerRenderer():this.renderer=new j_(this.settings),this.container.resize.on(D.throttle(()=>{this._isDestroyed||this.container.width!==this.renderer.width&&this.triggerResize()},e.resizeThrottle));let s=new rS;s.oldWidth=this.renderer.width,s.newWidth=this.container.width|0,s.settings=this.settings,this.onResize(s),this.renderer.preRender.on(this.onRenderStarted.bind(this)),this.renderer.renderFinished.on(r=>{this.onRenderFinished(r)}),this.renderer.postRenderFinished.on(()=>{let r=Date.now()-this._startTime;I.debug("rendering","Rendering completed in "+r+"ms"),this.onPostRenderFinished()}),this.renderer.preRender.on(r=>{this._startTime=Date.now()}),this.renderer.partialLayoutFinished.on(this.appendRenderResult.bind(this)),this.renderer.partialRenderFinished.on(this.updateRenderResult.bind(this)),this.renderer.renderFinished.on(r=>{this.appendRenderResult(r),this.appendRenderResult(null)}),this.renderer.error.on(this.onError.bind(this)),this.settings.player.enablePlayer&&this.setupPlayer(),this.setupClickHandling(),this.uiFacade.beginInvoke(()=>{this.uiFacade.initialRender()})}destroy(){this._isDestroyed=!0,this.player&&this.player.destroy(),this.uiFacade.destroy(),this.renderer.destroy()}updateSettings(){var t;const e=this.score;e&&et.applyPitchOffsets(this.settings,e),this.renderer.updateSettings(this.settings),this.settings.player.enablePlayer?(this.setupPlayer(),e&&((t=this.player)==null||t.applyTranspositionPitches(Xe.buildTranspositionPitches(e,this.settings)))):this.destroyPlayer(),this.onSettingsUpdated()}load(e,t){try{return this.uiFacade.load(e,s=>{this.renderScore(s,t)},s=>{this.onError(s)})}catch(s){return this.onError(s),!1}}renderScore(e,t){let s=[];if(!t)e.tracks.length>0&&s.push(e.tracks[0]);else if(t.length===0)e.tracks.length>0&&s.push(e.tracks[0]);else if(t.length===1&&t[0]===-1)for(let r of e.tracks)s.push(r);else for(let r of t)r>=0&&r<=e.tracks.length&&s.push(e.tracks[r]);this.internalRenderTracks(e,s)}renderTracks(e){if(e.length>0){let t=e[0].score;for(let s of e)if(s.score!==t){this.onError(new ni(ri.General,"All rendered tracks must belong to the same score."));return}this.internalRenderTracks(t,e)}}internalRenderTracks(e,t){if(et.applyPitchOffsets(this.settings,e),e!==this.score){this.score=e,this.tracks=t,this._trackIndexes=[];for(let s of t)this._trackIndexes.push(s.index);this._trackIndexLookup=new Set(this._trackIndexes),this.onScoreLoaded(e),this.loadMidiForScore(),this.render()}else{this.tracks=t,this._trackIndexes=[];for(let s of t)this._trackIndexes.push(s.index);this._trackIndexLookup=new Set(this._trackIndexes),this.render()}}triggerResize(){if(!this.container.isVisible)I.warning("Rendering","AlphaTab container was invisible while autosizing, waiting for element to become visible",null),this.uiFacade.rootContainerBecameVisible.on(()=>{I.debug("Rendering","AlphaTab container became visible, doing autosizing",null),this.triggerResize()});else{let e=new rS;e.oldWidth=this.renderer.width,e.newWidth=this.container.width,e.settings=this.settings,this.onResize(e),this.renderer.updateSettings(this.settings),this.renderer.width=this.container.width,this.renderer.resizeRender()}}appendRenderResult(e){e?(this.canvasElement.width=e.totalWidth,this.canvasElement.height=e.totalHeight,this._cursorWrapper&&(this._cursorWrapper.width=e.totalWidth,this._cursorWrapper.height=e.totalHeight),(e.width>0||e.height>0)&&this.uiFacade.beginAppendRenderResults(e)):this.uiFacade.beginAppendRenderResults(e)}updateRenderResult(e){e&&e.renderResult&&this.uiFacade.beginUpdateRenderResults(e)}tex(e,t){try{let s=new Ti;s.logErrors=!0,s.initFromString(e,this.settings);let r=s.readScore();this.renderScore(r,t)}catch(s){this.onError(s)}}loadSoundFont(e,t=!1){return this.player?this.uiFacade.loadSoundFont(e,t):!1}resetSoundFonts(){this.player&&this.player.resetSoundFonts()}render(){this.renderer&&(this.uiFacade.canRender?(this.renderer.width=this.container.width,this.renderer.renderScore(this.score,this._trackIndexes)):this.uiFacade.canRenderChanged.on(()=>this.render()))}get tickCache(){return this._tickCache}get isReadyForPlayback(){return this.player?this.player.isReadyForPlayback:!1}get playerState(){return this.player?this.player.state:zt.Paused}get masterVolume(){return this.player?this.player.masterVolume:0}set masterVolume(e){this.player&&(this.player.masterVolume=e)}get metronomeVolume(){return this.player?this.player.metronomeVolume:0}set metronomeVolume(e){this.player&&(this.player.metronomeVolume=e)}get countInVolume(){return this.player?this.player.countInVolume:0}set countInVolume(e){this.player&&(this.player.countInVolume=e)}get midiEventsPlayedFilter(){return this.player?this.player.midiEventsPlayedFilter:[]}set midiEventsPlayedFilter(e){this.player&&(this.player.midiEventsPlayedFilter=e)}get tickPosition(){return this.player?this.player.tickPosition:0}set tickPosition(e){this.player&&(this.player.tickPosition=e)}get timePosition(){return this.player?this.player.timePosition:0}set timePosition(e){this.player&&(this.player.timePosition=e)}get playbackRange(){return this.player?this.player.playbackRange:null}set playbackRange(e){this.player&&(this.player.playbackRange=e,this.settings.player.enableCursor&&this.updateSelectionCursor(e))}get playbackSpeed(){return this.player?this.player.playbackSpeed:0}set playbackSpeed(e){this.player&&(this.player.playbackSpeed=e)}get isLooping(){return this.player?this.player.isLooping:!1}set isLooping(e){this.player&&(this.player.isLooping=e)}destroyPlayer(){this.player&&(this.player.destroy(),this.player=null,this._previousTick=0,this._playerState=zt.Paused,this.destroyCursors())}setupPlayer(){this.updateCursors(),!this.player&&(this.player=this.uiFacade.createWorkerPlayer(),this.player&&(this.player.ready.on(()=>{this.loadMidiForScore()}),this.player.readyForPlayback.on(()=>{if(this.onPlayerReady(),this.tracks)for(let e of this.tracks){let t=e.playbackInfo.volume/16;this.player.setChannelVolume(e.playbackInfo.primaryChannel,t),this.player.setChannelVolume(e.playbackInfo.secondaryChannel,t)}}),this.player.soundFontLoaded.on(this.onSoundFontLoaded.bind(this)),this.player.soundFontLoadFailed.on(e=>{this.onError(e)}),this.player.midiLoaded.on(this.onMidiLoaded.bind(this)),this.player.midiLoadFailed.on(e=>{this.onError(e)}),this.player.stateChanged.on(this.onPlayerStateChanged.bind(this)),this.player.positionChanged.on(this.onPlayerPositionChanged.bind(this)),this.player.midiEventsPlayed.on(this.onMidiEventsPlayed.bind(this)),this.player.playbackRangeChanged.on(this.onPlaybackRangeChanged.bind(this)),this.player.finished.on(this.onPlayerFinished.bind(this)),this.setupPlayerEvents()))}loadMidiForScore(){if(!this.player||!this.score||!this.player.isReady)return;I.debug("AlphaTab","Generating Midi");let e=new Un,t=new Lr(e),s=new Xe(this.score,this.settings,t);s.applyTranspositionPitches=!1,s.generate(),this._tickCache=s.tickLookup,this.onMidiLoad(e),this.player.loadMidiFile(e),this.player.applyTranspositionPitches(s.transpositionPitches)}changeTrackVolume(e,t){if(this.player)for(let s of e)this.player.setChannelVolume(s.playbackInfo.primaryChannel,t),this.player.setChannelVolume(s.playbackInfo.secondaryChannel,t)}changeTrackSolo(e,t){if(this.player)for(let s of e)this.player.setChannelSolo(s.playbackInfo.primaryChannel,t),this.player.setChannelSolo(s.playbackInfo.secondaryChannel,t)}changeTrackMute(e,t){if(this.player)for(let s of e)this.player.setChannelMute(s.playbackInfo.primaryChannel,t),this.player.setChannelMute(s.playbackInfo.secondaryChannel,t)}changeTrackTranspositionPitch(e,t){if(this.player)for(let s of e)this.player.setChannelTranspositionPitch(s.playbackInfo.primaryChannel,t),this.player.setChannelTranspositionPitch(s.playbackInfo.secondaryChannel,t)}play(){return this.player?this.player.play():!1}pause(){this.player&&this.player.pause()}playPause(){this.player&&this.player.playPause()}stop(){this.player&&this.player.stop()}playBeat(e){if(!this.player)return;let t=new Un,s=new Lr(t);new Xe(e.voice.bar.staff.track.score,this.settings,s).generateSingleBeat(e),this.player.playOneTimeMidiFile(t)}playNote(e){if(!this.player)return;let t=new Un,s=new Lr(t);new Xe(e.beat.voice.bar.staff.track.score,this.settings,s).generateSingleNote(e),this.player.playOneTimeMidiFile(t)}destroyCursors(){this._cursorWrapper&&(this.uiFacade.destroyCursors(),this._cursorWrapper=null,this._barCursor=null,this._beatCursor=null,this._selectionWrapper=null)}updateCursors(){if(this.settings.player.enableCursor&&!this._cursorWrapper){let e=this.uiFacade.createCursors();e&&(this._cursorWrapper=e.cursorWrapper,this._barCursor=e.barCursor,this._beatCursor=e.beatCursor,this._selectionWrapper=e.selectionWrapper),this._currentBeat!==null&&this.cursorUpdateBeat(this._currentBeat,!1,this._previousTick>10,!0)}else!this.settings.player.enableCursor&&this._cursorWrapper&&this.destroyCursors()}setupPlayerEvents(){this._previousTick=0,this._playerState=zt.Paused,this.renderer.postRenderFinished.on(()=>{this._currentBeat=null,this.cursorUpdateTick(this._previousTick,!1,this._previousTick>10)}),this.player&&(this.player.positionChanged.on(e=>{this._previousTick=e.currentTick,this.uiFacade.beginInvoke(()=>{this.cursorUpdateTick(e.currentTick,!1)})}),this.player.stateChanged.on(e=>{if(this._playerState=e.state,!e.stopped&&e.state===zt.Paused){let t=this._currentBeat,s=this._tickCache;t&&s&&(this.player.tickPosition=s.getBeatStart(t.beat))}}))}cursorUpdateTick(e,t,s=!1){let r=this._tickCache;if(r){let n=this._trackIndexLookup;if(n!=null&&n.size>0){let a=r.findBeat(n,e,this._currentBeat);a&&this.cursorUpdateBeat(a,t,s)}}}cursorUpdateBeat(e,t,s,r=!1){var p;const n=e.beat,a=((p=e.nextBeat)==null?void 0:p.beat)??null,o=e.duration,l=e.beatLookup.highlightedBeats;if(!n)return;let u=this.renderer.boundsLookup;if(!u)return;let h=this._currentBeat,c=this._previousCursorCache,d=this._previousStateForCursor;if(!r&&n===(h==null?void 0:h.beat)&&u===c&&d===this._playerState)return;let f=u.findBeat(n);f&&(this._currentBeat=e,this._previousCursorCache=u,this._previousStateForCursor=this._playerState,this.uiFacade.beginInvoke(()=>{this.internalCursorUpdateBeat(n,a,o,t,l,u,f,s)}))}scrollToCursor(){const e=this._currentBarBounds;e&&this.internalScrollToCursor(e)}internalScrollToCursor(e){let t=this.uiFacade.getScrollContainer(),s=D.getLayoutEngineFactory(this.settings.display.layoutMode).vertical,r=this.settings.player.scrollMode;if(s){let n=e.realBounds.y+this.settings.player.scrollOffsetY;if(n!==this._lastScroll)switch(this._lastScroll=n,r){case Qr.Continuous:let a=this.uiFacade.getOffset(t,this.container);this.uiFacade.scrollToY(t,a.y+n,this.settings.player.scrollSpeed);break;case Qr.OffScreen:let o=t.scrollTop+this.uiFacade.getOffset(null,t).h;if(e.visualBounds.y+e.visualBounds.h>=o||e.visualBounds.y<t.scrollTop){let l=e.realBounds.y+this.settings.player.scrollOffsetY;this.uiFacade.scrollToY(t,l,this.settings.player.scrollSpeed)}break}}else{let n=e.visualBounds.x;if(n!==this._lastScroll)switch(this._lastScroll=n,r){case Qr.Continuous:let a=e.realBounds.x+this.settings.player.scrollOffsetX;this._lastScroll=e.visualBounds.x,this.uiFacade.scrollToX(t,a,this.settings.player.scrollSpeed);break;case Qr.OffScreen:let o=t.scrollLeft+this.uiFacade.getOffset(null,t).w;if(e.visualBounds.x+e.visualBounds.w>=o||e.visualBounds.x<t.scrollLeft){let l=e.realBounds.x+this.settings.player.scrollOffsetX;this._lastScroll=e.visualBounds.x,this.uiFacade.scrollToX(t,l,this.settings.player.scrollSpeed)}break}}}internalCursorUpdateBeat(e,t,s,r,n,a,o,l){const u=this._barCursor,h=this._beatCursor;let c=o.barBounds.masterBarBounds,d=c.visualBounds;this._currentBarBounds=c,u&&u.setBounds(d.x,d.y,d.w,d.h),h&&(this.settings.player.enableAnimatedBeatCursor&&h.stopAnimation(),h.setBounds(o.visualBounds.x,d.y,1,d.h)),this.settings.player.enableElementHighlighting&&this.uiFacade.removeHighlights();let f=!1;if(this._playerState===zt.Playing&&!r){if(this.settings.player.enableElementHighlighting)for(let p of n){let g=Cs.getGroupId(p.beat);this.uiFacade.highlightElements(g,e.voice.bar.index)}if(this.settings.player.enableAnimatedBeatCursor){let p=c.visualBounds.x+c.visualBounds.w;if(t){let g=a.findBeat(t);g&&g.barBounds.masterBarBounds.staffSystemBounds===c.staffSystemBounds&&(p=g.visualBounds.x)}this.uiFacade.beginInvoke(()=>{h&&h.transitionToX(s/this.playbackSpeed,p)})}l=!r,f=!0}l&&!this._beatMouseDown&&this.settings.player.scrollMode!==Qr.Off&&this.internalScrollToCursor(c),f&&(this.onPlayedBeatChanged(e),this.onActiveBeatsChanged(new Y_(n.map(p=>p.beat))))}onPlayedBeatChanged(e){this._isDestroyed||(this.playedBeatChanged.trigger(e),this.uiFacade.triggerEvent(this.container,"playedBeatChanged",e))}onActiveBeatsChanged(e){this._isDestroyed||(this.activeBeatsChanged.trigger(e),this.uiFacade.triggerEvent(this.container,"activeBeatsChanged",e))}onBeatMouseDown(e,t){this._isDestroyed||(this.settings.player.enablePlayer&&this.settings.player.enableCursor&&this.settings.player.enableUserInteraction&&(this._selectionStart=new mh(t),this._selectionEnd=null),this._beatMouseDown=!0,this.beatMouseDown.trigger(t),this.uiFacade.triggerEvent(this.container,"beatMouseDown",t,e))}onNoteMouseDown(e,t){this._isDestroyed||(this._noteMouseDown=!0,this.noteMouseDown.trigger(t),this.uiFacade.triggerEvent(this.container,"noteMouseDown",t,e))}onBeatMouseMove(e,t){this._isDestroyed||(this.settings.player.enableUserInteraction&&(!this._selectionEnd||this._selectionEnd.beat!==t)&&(this._selectionEnd=new mh(t),this.cursorSelectRange(this._selectionStart,this._selectionEnd)),this.beatMouseMove.trigger(t),this.uiFacade.triggerEvent(this.container,"beatMouseMove",t,e))}onNoteMouseMove(e,t){this._isDestroyed||(this.noteMouseMove.trigger(t),this.uiFacade.triggerEvent(this.container,"noteMouseMove",t,e))}onBeatMouseUp(e,t){var s,r;if(!this._isDestroyed){if(this.settings.player.enablePlayer&&this.settings.player.enableCursor&&this.settings.player.enableUserInteraction){if(this._selectionEnd){let n=((s=this._tickCache)==null?void 0:s.getBeatStart(this._selectionStart.beat))??this._selectionStart.beat.absolutePlaybackStart;if((((r=this._tickCache)==null?void 0:r.getBeatStart(this._selectionEnd.beat))??this._selectionEnd.beat.absolutePlaybackStart)<n){let o=this._selectionStart;this._selectionStart=this._selectionEnd,this._selectionEnd=o}}if(this._selectionStart&&this._tickCache){let n=this._tickCache,a=n.getMasterBarStart(this._selectionStart.beat.voice.bar.masterBar);if(this._currentBeat=null,this._playerState===zt.Paused&&this.cursorUpdateTick(this._tickCache.getBeatStart(this._selectionStart.beat),!1),this.tickPosition=a+this._selectionStart.beat.playbackStart,this._selectionEnd&&this._selectionStart.beat!==this._selectionEnd.beat){let o=n.getMasterBarStart(this._selectionEnd.beat.voice.bar.masterBar),l=new $_;l.startTick=a+this._selectionStart.beat.playbackStart,l.endTick=o+this._selectionEnd.beat.playbackStart+this._selectionEnd.beat.playbackDuration-50,this.playbackRange=l}else this._selectionStart=null,this.playbackRange=null,this.cursorSelectRange(this._selectionStart,this._selectionEnd)}}this.beatMouseUp.trigger(t),this.uiFacade.triggerEvent(this.container,"beatMouseUp",t,e),this._beatMouseDown=!1}}onNoteMouseUp(e,t){this._isDestroyed||(this.noteMouseUp.trigger(t),this.uiFacade.triggerEvent(this.container,"noteMouseUp",t,e),this._noteMouseDown=!1)}updateSelectionCursor(e){if(this._tickCache)if(e){const t=this._tickCache.findBeat(this._trackIndexLookup,e.startTick),s=this._tickCache.findBeat(this._trackIndexLookup,e.endTick);if(t&&s){const r=new mh(t.beat),n=new mh(s.beat);this.cursorSelectRange(r,n)}}else this.cursorSelectRange(null,null)}setupClickHandling(){this.canvasElement.mouseDown.on(e=>{var n,a;if(!e.isLeftMouseButton)return;this.settings.player.enableUserInteraction&&e.preventDefault();let t=e.getX(this.canvasElement),s=e.getY(this.canvasElement),r=((n=this.renderer.boundsLookup)==null?void 0:n.getBeatAtPos(t,s))??null;if(r&&(this.onBeatMouseDown(e,r),this.settings.core.includeNoteBounds)){const o=(a=this.renderer.boundsLookup)==null?void 0:a.getNoteAtPos(r,t,s);o&&this.onNoteMouseDown(e,o)}}),this.canvasElement.mouseMove.on(e=>{var n,a;if(!this._beatMouseDown)return;let t=e.getX(this.canvasElement),s=e.getY(this.canvasElement),r=((n=this.renderer.boundsLookup)==null?void 0:n.getBeatAtPos(t,s))??null;if(r&&(this.onBeatMouseMove(e,r),this._noteMouseDown)){const o=(a=this.renderer.boundsLookup)==null?void 0:a.getNoteAtPos(r,t,s);o&&this.onNoteMouseMove(e,o)}}),this.canvasElement.mouseUp.on(e=>{var n,a;if(!this._beatMouseDown)return;this.settings.player.enableUserInteraction&&e.preventDefault();let t=e.getX(this.canvasElement),s=e.getY(this.canvasElement),r=((n=this.renderer.boundsLookup)==null?void 0:n.getBeatAtPos(t,s))??null;if(this.onBeatMouseUp(e,r),this._noteMouseDown)if(r){const o=((a=this.renderer.boundsLookup)==null?void 0:a.getNoteAtPos(r,t,s))??null;this.onNoteMouseUp(e,o)}else this.onNoteMouseUp(e,null)}),this.renderer.postRenderFinished.on(()=>{!this._selectionStart||!this.settings.player.enablePlayer||!this.settings.player.enableCursor||!this.settings.player.enableUserInteraction||this.cursorSelectRange(this._selectionStart,this._selectionEnd)})}cursorSelectRange(e,t){var u,h;let s=this.renderer.boundsLookup;if(!s)return;let r=this._selectionWrapper;if(!r||(r.clear(),!e||!t||e.beat===t.beat))return;e.bounds||(e.bounds=s.findBeat(e.beat)),t.bounds||(t.bounds=s.findBeat(t.beat));let n=((u=this._tickCache)==null?void 0:u.getBeatStart(e.beat))??e.beat.absolutePlaybackStart;if((((h=this._tickCache)==null?void 0:h.getBeatStart(t.beat))??t.beat.absolutePlaybackStart)<n){let c=e;e=t,t=c}let o=e.bounds.realBounds.x,l=t.bounds.realBounds.x+t.bounds.realBounds.w;if(t.beat.index===t.beat.voice.beats.length-1&&(l=t.bounds.barBounds.masterBarBounds.realBounds.x+t.bounds.barBounds.masterBarBounds.realBounds.w),e.bounds.barBounds.masterBarBounds.staffSystemBounds!==t.bounds.barBounds.masterBarBounds.staffSystemBounds){let c=e.bounds.barBounds.masterBarBounds.staffSystemBounds.visualBounds.x,d=e.bounds.barBounds.masterBarBounds.staffSystemBounds.visualBounds.x+e.bounds.barBounds.masterBarBounds.staffSystemBounds.visualBounds.w,f=this.uiFacade.createSelectionElement();f.setBounds(o,e.bounds.barBounds.masterBarBounds.visualBounds.y,d-o,e.bounds.barBounds.masterBarBounds.visualBounds.h),r.appendChild(f);let p=e.bounds.barBounds.masterBarBounds.staffSystemBounds.index+1,g=t.bounds.barBounds.masterBarBounds.staffSystemBounds.index;for(let m=p;m<g;m++){let y=s.staffSystems[m],w=this.uiFacade.createSelectionElement();w.setBounds(c,y.visualBounds.y,d-c,y.visualBounds.h),r.appendChild(w)}let b=this.uiFacade.createSelectionElement();b.setBounds(c,t.bounds.barBounds.masterBarBounds.visualBounds.y,l-c,t.bounds.barBounds.masterBarBounds.visualBounds.h),r.appendChild(b)}else{let c=this.uiFacade.createSelectionElement();c.setBounds(o,e.bounds.barBounds.masterBarBounds.visualBounds.y,l-o,e.bounds.barBounds.masterBarBounds.visualBounds.h),r.appendChild(c)}}onScoreLoaded(e){this._isDestroyed||(this.scoreLoaded.trigger(e),this.uiFacade.triggerEvent(this.container,"scoreLoaded",e))}onResize(e){this._isDestroyed||(this.resize.trigger(e),this.uiFacade.triggerEvent(this.container,"resize",e))}onRenderStarted(e){this._isDestroyed||(this.renderStarted.trigger(e),this.uiFacade.triggerEvent(this.container,"renderStarted",e))}onRenderFinished(e){this._isDestroyed||(this.renderFinished.trigger(e),this.uiFacade.triggerEvent(this.container,"renderFinished",e))}onPostRenderFinished(){this._isDestroyed||(this.postRenderFinished.trigger(),this.uiFacade.triggerEvent(this.container,"postRenderFinished",null))}onError(e){this._isDestroyed||(I.error("API","An unexpected error occurred",e),this.error.trigger(e),this.uiFacade.triggerEvent(this.container,"error",e))}onPlayerReady(){this._isDestroyed||(this.playerReady.trigger(),this.uiFacade.triggerEvent(this.container,"playerReady",null))}onPlayerFinished(){this._isDestroyed||(this.playerFinished.trigger(),this.uiFacade.triggerEvent(this.container,"playerFinished",null))}onSoundFontLoaded(){this._isDestroyed||(this.soundFontLoaded.trigger(),this.uiFacade.triggerEvent(this.container,"soundFontLoaded",null))}onMidiLoad(e){this._isDestroyed||(this.midiLoad.trigger(e),this.uiFacade.triggerEvent(this.container,"midiLoad",e))}onMidiLoaded(e){this._isDestroyed||(this.midiLoaded.trigger(e),this.uiFacade.triggerEvent(this.container,"midiFileLoaded",e))}onPlayerStateChanged(e){this._isDestroyed||(this.playerStateChanged.trigger(e),this.uiFacade.triggerEvent(this.container,"playerStateChanged",e))}onPlayerPositionChanged(e){this._isDestroyed||this.score!==null&&this.tracks.length>0&&(this.playerPositionChanged.trigger(e),this.uiFacade.triggerEvent(this.container,"playerPositionChanged",e))}onMidiEventsPlayed(e){this._isDestroyed||(this.midiEventsPlayed.trigger(e),this.uiFacade.triggerEvent(this.container,"midiEventsPlayed",e))}onPlaybackRangeChanged(e){this._isDestroyed||(this.playbackRangeChanged.trigger(e),this.uiFacade.triggerEvent(this.container,"playbackRangeChanged",e))}onSettingsUpdated(){this._isDestroyed||(this.settingsUpdated.trigger(),this.uiFacade.triggerEvent(this.container,"settingsUpdated",null))}}class $r extends ni{constructor(e,t){super(ri.General,e),this.xhr=t,Object.setPrototypeOf(this,$r.prototype)}}class go{static loadScoreAsync(e,t,s,r){let n=new XMLHttpRequest;n.open("GET",e,!0,null,null),n.responseType="arraybuffer",n.onreadystatechange=()=>{if(n.readyState===XMLHttpRequest.DONE){let a=n.response;if(n.status===200||n.status===0&&a)try{let o=n.response,l=new Uint8Array(o),u=go.loadScoreFromBytes(l,r);t(u)}catch(o){s(o)}else n.status===0?s(new $r(`You are offline!!
 Please Check Your Network.`,n)):n.status===404?s(new $r("Requested URL not found.",n)):n.status===500?s(new $r("Internel Server Error.",n)):n.statusText==="parsererror"?s(new $r(`Error.
Parsing JSON Request failed.`,n)):n.statusText==="timeout"?s(new $r("Request Time out.",n)):s(new $r("Unknow Error: "+n.responseText,n))}},n.send()}static loadScoreFromBytes(e,t){t||(t=new gu);let s=D.buildImporters();I.debug("ScoreLoader",`Loading score from ${e.length} bytes using ${s.length} importers`);let r=null,n=si.fromBuffer(e);for(let a of s){n.reset();try{I.debug("ScoreLoader","Importing using importer "+a.name),a.init(n,t),r=a.readScore(),I.debug("ScoreLoader","Score imported using "+a.name);break}catch(o){if(o instanceof yt)I.debug("ScoreLoader",a.name+" does not support the file");else throw I.error("ScoreLoader","Score import failed due to unexpected error: ",o),o}}if(r)return r;throw new yt("No compatible importer found for file")}}class qf{get isLeftMouseButton(){return this.mouseEvent.button===0}getX(e){let t=e.element,r=t.getBoundingClientRect().left+t.ownerDocument.defaultView.pageXOffset;return this.mouseEvent.pageX-r}getY(e){let t=e.element,r=t.getBoundingClientRect().top+t.ownerDocument.defaultView.pageYOffset;return this.mouseEvent.pageY-r}preventDefault(){this.mouseEvent.preventDefault()}constructor(e){this.mouseEvent=e}}class Dr{get width(){return this.element.offsetWidth}set width(e){this.element.style.width=e+"px"}get scrollLeft(){return this.element.scrollLeft}set scrollLeft(e){this.element.scrollTop=e}get scrollTop(){return this.element.scrollLeft}set scrollTop(e){this.element.scrollTop=e}get height(){return this.element.offsetHeight}set height(e){e>=0?this.element.style.height=e+"px":this.element.style.height="100%"}get isVisible(){return!!this.element.offsetWidth||!!this.element.offsetHeight||!!this.element.getClientRects().length}constructor(e){this._resizeListeners=0,this.lastBounds=new Wi,this.element=e,this.mouseDown={on:t=>{this.element.addEventListener("mousedown",s=>{t(new qf(s))},!0)},off:t=>{}},this.mouseUp={on:t=>{this.element.addEventListener("mouseup",s=>{t(new qf(s))},!0)},off:t=>{}},this.mouseMove={on:t=>{this.element.addEventListener("mousemove",s=>{t(new qf(s))},!0)},off:t=>{}},this.resize={on:t=>{this._resizeListeners===0&&Dr.resizeObserver.value.observe(this.element),this.element.addEventListener("resize",t,!0),this._resizeListeners++},off:t=>{this.element.removeEventListener("resize",t,!0),this._resizeListeners--,this._resizeListeners<=0&&(this._resizeListeners=0,Dr.resizeObserver.value.unobserve(this.element))}}}stopAnimation(){this.element.style.transition="none"}transitionToX(e,t){this.element.style.transition=`transform ${e}ms linear`,this.setBounds(t,NaN,NaN,NaN)}setBounds(e,t,s,r){isNaN(e)&&(e=this.lastBounds.x),isNaN(t)&&(t=this.lastBounds.y),isNaN(s)&&(s=this.lastBounds.w),isNaN(r)&&(r=this.lastBounds.h),this.element.style.transform=`translate(${e}px, ${t}px) scale(${s}, ${r})`,this.element.style.transformOrigin="top left",this.lastBounds.x=e,this.lastBounds.y=t,this.lastBounds.w=s,this.lastBounds.h=r}appendChild(e){this.element.appendChild(e.element)}clear(){this.element.innerHTML=""}}Dr.resizeObserver=new m_(()=>new ResizeObserver(i=>{for(const e of i){let t=new CustomEvent("resize",{detail:e});e.target.dispatchEvent(t)}}));class X_{constructor(e){this._isStarted=!1,this.isFontLoaded=!1,this.fontLoaded=new He,this._originalFamilies=e,this._families=e}checkForFontAvailability(){if(D.isRunningInWorker){this.isFontLoaded=!1;return}if(this._isStarted)return;this._isStarted=!0;let e=0,t=window.setInterval(()=>{I.warning("Rendering",`Could not load font '${this._families[0]}' within ${(e+1)*5} seconds`,null),this._families.length>1?(this._families.shift(),e=0):e++},5e3);I.debug("Font",`Start checking for font availablility: ${this._families.join(", ")}`);let s=a=>{this._families.length>1?(I.debug("Font",`[${this._families[0]}] Loading Failed, switching to ${this._families[1]}`,a),this._families.shift(),window.setTimeout(()=>{n()},0)):(I.error("Font",`[${this._originalFamilies.join(",")}] Loading Failed, rendering cannot start`,a),window.clearInterval(t))},r=a=>{I.debug("Font",`[${a}] Font API signaled available`),this.isFontLoaded=!0,window.clearInterval(t),this.fontLoaded.trigger(this._families[0])},n=async()=>{for(const a of this._families)if(await this.isFontAvailable(a,!1)){r(a);return}try{await document.fonts.load(`1em ${this._families[0]}`)}catch(a){s(a)}return I.debug("Font",`[${this._families[0]}] Font API signaled loaded`),await this.isFontAvailable(this._families[0],!0)?r(this._families[0]):s("Font not available"),!0};document.fonts.ready.then(()=>{n()})}isFontAvailable(e,t){return new Promise(s=>{const r="1em "+e;if(document.fonts.check(r))s(!0);else if(t){I.debug("Font",`Font ${e} not available, creating test element to trigger load`);const n=document.createElement("div");n.style.font=r,n.style.opacity="0",n.style.position="absolute",n.style.top="0",n.style.left="0",n.innerText=`Trigger ${e} load`,document.body.appendChild(n),setTimeout(()=>{document.body.removeChild(n),document.fonts.check(r)?s(!0):s(!1)},200)}else s(!1)})}}class j0{constructor(e){this._writePosition=0,this._readPosition=0,this.count=0,this._buffer=new Float32Array(e)}clear(){this._readPosition=0,this._writePosition=0,this.count=0,this._buffer=new Float32Array(this._buffer.length)}write(e,t,s){let r=0;s>this._buffer.length-this.count&&(s=this._buffer.length-this.count);const n=Math.min(this._buffer.length-this._writePosition,s);return this._buffer.set(e.subarray(t,t+n),this._writePosition),this._writePosition+=n,this._writePosition%=this._buffer.length,r+=n,r<s&&(this._buffer.set(e.subarray(t+r,t+r+s-r),this._writePosition),this._writePosition+=s-r,r=s),this.count+=r,r}read(e,t,s){s>this.count&&(s=this.count);let r=0;const n=Math.min(this._buffer.length-this._readPosition,s);return e.set(this._buffer.subarray(this._readPosition,this._readPosition+n),t),r+=n,this._readPosition+=n,this._readPosition%=this._buffer.length,r<s&&(e.set(this._buffer.subarray(this._readPosition,this._readPosition+s-r),t+r),this._readPosition+=s-r,r=s),this.count-=r,r}}class Ns{constructor(){this._context=null,this._buffer=null,this._source=null,this.ready=new Jt,this.samplesPlayed=new He,this.sampleRequest=new Jt}get sampleRate(){return this._context?this._context.sampleRate:Ns.PreferredSampleRate}activate(e){this._context||(this._context=this.createAudioContext()),(this._context.state==="suspended"||this._context.state==="interrupted")&&(I.debug("WebAudio","Audio Context is suspended, trying resume"),this._context.resume().then(()=>{var t,s;I.debug("WebAudio",`Audio Context resume success: state=${(t=this._context)==null?void 0:t.state}, sampleRate:${(s=this._context)==null?void 0:s.sampleRate}`),e&&e()},t=>{var s,r;I.warning("WebAudio",`Audio Context resume failed: state=${(s=this._context)==null?void 0:s.state}, sampleRate:${(r=this._context)==null?void 0:r.sampleRate}, reason=${t}`)}))}patchIosSampleRate(){let e=navigator.userAgent;if(e.indexOf("iPhone")!==-1||e.indexOf("iPad")!==-1){let t=this.createAudioContext(),s=t.createBuffer(1,1,Ns.PreferredSampleRate),r=t.createBufferSource();r.buffer=s,r.connect(t.destination),r.start(0),r.disconnect(0),t.close()}}createAudioContext(){if("AudioContext"in D.globalThis)return new AudioContext;if("webkitAudioContext"in D.globalThis)return new webkitAudioContext;throw new ni(ri.General,"AudioContext not found")}open(e){this.patchIosSampleRate(),this._context=this.createAudioContext(),this._context.state==="suspended"&&this.registerResumeHandler()}registerResumeHandler(){this._resumeHandler=(()=>{this.activate(()=>{this.unregisterResumeHandler()})}).bind(this),document.body.addEventListener("touchend",this._resumeHandler,!1),document.body.addEventListener("click",this._resumeHandler,!1)}unregisterResumeHandler(){const e=this._resumeHandler;e&&(document.body.removeEventListener("touchend",e,!1),document.body.removeEventListener("click",e,!1))}play(){let e=this._context;this.activate(),this._buffer=e.createBuffer(2,Ns.BufferSize,e.sampleRate),this._source=e.createBufferSource(),this._source.buffer=this._buffer,this._source.loop=!0}pause(){this._source&&(this._source.stop(0),this._source.disconnect()),this._source=null}destroy(){var e;this.pause(),(e=this._context)==null||e.close(),this._context=null,this.unregisterResumeHandler()}onSamplesPlayed(e){this.samplesPlayed.trigger(e)}onSampleRequest(){this.sampleRequest.trigger()}onReady(){this.ready.trigger()}}Ns.BufferSize=4096;Ns.PreferredSampleRate=44100;class Q_ extends Ns{constructor(){super(...arguments),this._audioNode=null,this._bufferCount=0,this._requestedBufferCount=0,this._outputBuffer=new Float32Array(0)}open(e){super.open(e),this._bufferCount=Math.floor(e*this.sampleRate/1e3/Ns.BufferSize),this._circularBuffer=new j0(Ns.BufferSize*this._bufferCount),this.onReady()}play(){super.play();let e=this._context;this._audioNode=e.createScriptProcessor(4096,0,2),this._audioNode.onaudioprocess=this.generateSound.bind(this),this._circularBuffer.clear(),this.requestBuffers(),this._source=e.createBufferSource(),this._source.buffer=this._buffer,this._source.loop=!0,this._source.connect(this._audioNode,0,0),this._source.start(0),this._audioNode.connect(e.destination,0,0)}pause(){super.pause(),this._audioNode&&this._audioNode.disconnect(0),this._audioNode=null}addSamples(e){this._circularBuffer.write(e,0,e.length),this._requestedBufferCount--}resetSamples(){this._circularBuffer.clear()}requestBuffers(){const e=this._bufferCount/2|0;let t=e*Ns.BufferSize;if(this._circularBuffer.count+this._requestedBufferCount*Ns.BufferSize<t){for(let r=0;r<e;r++)this.onSampleRequest();this._requestedBufferCount+=e}}generateSound(e){let t=e.outputBuffer.getChannelData(0),s=e.outputBuffer.getChannelData(1),r=t.length+s.length,n=this._outputBuffer;n.length!==r&&(n=new Float32Array(r),this._outputBuffer=n);const a=this._circularBuffer.read(n,0,Math.min(n.length,this._circularBuffer.count));let o=0;const l=Math.min(t.length,a);for(let u=0;u<l;u++)t[u]=n[o++],s[u]=n[o++];if(a<t.length)for(let u=a;u<t.length;u++)t[u]=0,s[u]=0;this.onSamplesPlayed(a/Ne.AudioChannels),this.requestBuffers()}}class kO{constructor(e,t){this.loaded=e,this.total=t}}class Yg{get isReady(){return this._workerIsReady&&this._outputIsReady}get isReadyForPlayback(){return this._workerIsReadyForPlayback}get state(){return this._state}get logLevel(){return I.logLevel}set logLevel(e){I.logLevel=e,this._synth.postMessage({cmd:"alphaSynth.setLogLevel",value:e})}get masterVolume(){return this._masterVolume}set masterVolume(e){e=Math.max(e,Ne.MinVolume),this._masterVolume=e,this._synth.postMessage({cmd:"alphaSynth.setMasterVolume",value:e})}get metronomeVolume(){return this._metronomeVolume}set metronomeVolume(e){e=Math.max(e,Ne.MinVolume),this._metronomeVolume=e,this._synth.postMessage({cmd:"alphaSynth.setMetronomeVolume",value:e})}get countInVolume(){return this._countInVolume}set countInVolume(e){e=Math.max(e,Ne.MinVolume),this._countInVolume=e,this._synth.postMessage({cmd:"alphaSynth.setCountInVolume",value:e})}get midiEventsPlayedFilter(){return this._midiEventsPlayedFilter}set midiEventsPlayedFilter(e){this._midiEventsPlayedFilter=e,this._synth.postMessage({cmd:"alphaSynth.setMidiEventsPlayedFilter",value:e})}get playbackSpeed(){return this._playbackSpeed}set playbackSpeed(e){e=Nt.clamp(e,Ne.MinPlaybackSpeed,Ne.MaxPlaybackSpeed),this._playbackSpeed=e,this._synth.postMessage({cmd:"alphaSynth.setPlaybackSpeed",value:e})}get tickPosition(){return this._tickPosition}set tickPosition(e){e<0&&(e=0),this._tickPosition=e,this._synth.postMessage({cmd:"alphaSynth.setTickPosition",value:e})}get timePosition(){return this._timePosition}set timePosition(e){e<0&&(e=0),this._timePosition=e,this._synth.postMessage({cmd:"alphaSynth.setTimePosition",value:e})}get isLooping(){return this._isLooping}set isLooping(e){this._isLooping=e,this._synth.postMessage({cmd:"alphaSynth.setIsLooping",value:e})}get playbackRange(){return this._playbackRange}set playbackRange(e){e&&(e.startTick<0&&(e.startTick=0),e.endTick<0&&(e.endTick=0)),this._playbackRange=e,this._synth.postMessage({cmd:"alphaSynth.setPlaybackRange",value:e})}constructor(e,t){this._workerIsReadyForPlayback=!1,this._workerIsReady=!1,this._outputIsReady=!1,this._state=zt.Paused,this._masterVolume=0,this._metronomeVolume=0,this._countInVolume=0,this._playbackSpeed=0,this._tickPosition=0,this._timePosition=0,this._isLooping=!1,this._playbackRange=null,this._midiEventsPlayedFilter=[],this.ready=new Jt,this.readyForPlayback=new Jt,this.finished=new Jt,this.soundFontLoaded=new Jt,this.soundFontLoadFailed=new He,this.midiLoaded=new He,this.midiLoadFailed=new He,this.stateChanged=new He,this.positionChanged=new He,this.midiEventsPlayed=new He,this.playbackRangeChanged=new He,this._workerIsReadyForPlayback=!1,this._workerIsReady=!1,this._outputIsReady=!1,this._state=zt.Paused,this._masterVolume=0,this._metronomeVolume=0,this._playbackSpeed=0,this._tickPosition=0,this._timePosition=0,this._isLooping=!1,this._playbackRange=null,this._output=e,this._output.ready.on(this.onOutputReady.bind(this)),this._output.samplesPlayed.on(this.onOutputSamplesPlayed.bind(this)),this._output.sampleRequest.on(this.onOutputSampleRequest.bind(this)),this._output.open(t.player.bufferTimeInMilliseconds);try{this._synth=D.createWebWorker(t)}catch(s){I.error("AlphaSynth","Failed to create WebWorker: "+s)}this._synth.addEventListener("message",this.handleWorkerMessage.bind(this),!1),this._synth.postMessage({cmd:"alphaSynth.initialize",sampleRate:this._output.sampleRate,logLevel:t.core.logLevel,bufferTimeInMilliseconds:t.player.bufferTimeInMilliseconds}),this.masterVolume=1,this.playbackSpeed=1,this.metronomeVolume=0}destroy(){this._synth.postMessage({cmd:"alphaSynth.destroy"})}play(){return this._output.activate(),this._synth.postMessage({cmd:"alphaSynth.play"}),!0}pause(){this._synth.postMessage({cmd:"alphaSynth.pause"})}playPause(){this._output.activate(),this._synth.postMessage({cmd:"alphaSynth.playPause"})}stop(){this._synth.postMessage({cmd:"alphaSynth.stop"})}playOneTimeMidiFile(e){this._synth.postMessage({cmd:"alphaSynth.playOneTimeMidiFile",midi:Dt.midiFileToJsObject(e)})}loadSoundFont(e,t){this._synth.postMessage({cmd:"alphaSynth.loadSoundFontBytes",data:e,append:t})}loadSoundFontFromUrl(e,t,s){I.debug("AlphaSynth",`Start loading Soundfont from url ${e}`);let r=new XMLHttpRequest;r.open("GET",e,!0,null,null),r.responseType="arraybuffer",r.onload=n=>{let a=new Uint8Array(r.response);this.loadSoundFont(a,t)},r.onerror=n=>{I.error("AlphaSynth","Loading failed: "+n.message),this.soundFontLoadFailed.trigger(new $r(n.message,r))},r.onprogress=n=>{I.debug("AlphaSynth",`Soundfont downloading: ${n.loaded}/${n.total} bytes`),s(new kO(n.loaded,n.total))},r.send()}resetSoundFonts(){this._synth.postMessage({cmd:"alphaSynth.resetSoundFonts"})}loadMidiFile(e){this._synth.postMessage({cmd:"alphaSynth.loadMidi",midi:Dt.midiFileToJsObject(e)})}applyTranspositionPitches(e){this._synth.postMessage({cmd:"alphaSynth.applyTranspositionPitches",transpositionPitches:JSON.stringify(Array.from(e.entries()))})}setChannelTranspositionPitch(e,t){this._synth.postMessage({cmd:"alphaSynth.setChannelTranspositionPitch",channel:e,semitones:t})}setChannelMute(e,t){this._synth.postMessage({cmd:"alphaSynth.setChannelMute",channel:e,mute:t})}resetChannelStates(){this._synth.postMessage({cmd:"alphaSynth.resetChannelStates"})}setChannelSolo(e,t){this._synth.postMessage({cmd:"alphaSynth.setChannelSolo",channel:e,solo:t})}setChannelVolume(e,t){t=Math.max(t,Ne.MinVolume),this._synth.postMessage({cmd:"alphaSynth.setChannelVolume",channel:e,volume:t})}handleWorkerMessage(e){let t=e.data;switch(t.cmd){case"alphaSynth.ready":this._workerIsReady=!0,this.checkReady();break;case"alphaSynth.destroyed":this._synth.terminate();break;case"alphaSynth.readyForPlayback":this._workerIsReadyForPlayback=!0,this.checkReadyForPlayback();break;case"alphaSynth.positionChanged":this._timePosition=t.currentTime,this._tickPosition=t.currentTick,this.positionChanged.trigger(new cu(t.currentTime,t.endTime,t.currentTick,t.endTick,t.isSeek));break;case"alphaSynth.midiEventsPlayed":this.midiEventsPlayed.trigger(new H0(t.events.map(Dt.jsObjectToMidiEvent)));break;case"alphaSynth.playerStateChanged":this._state=t.state,this.stateChanged.trigger(new Ll(t.state,t.stopped));break;case"alphaSynth.playbackRangeChanged":this._playbackRange=t.playbackRange,this.playbackRangeChanged.trigger(new z0(this._playbackRange));break;case"alphaSynth.finished":this.finished.trigger();break;case"alphaSynth.soundFontLoaded":this.soundFontLoaded.trigger();break;case"alphaSynth.soundFontLoadFailed":this.soundFontLoadFailed.trigger(t.error);break;case"alphaSynth.midiLoaded":this.checkReadyForPlayback(),this.midiLoaded.trigger(new cu(t.currentTime,t.endTime,t.currentTick,t.endTick,t.isSeek));break;case"alphaSynth.midiLoadFailed":this.checkReadyForPlayback(),this.midiLoadFailed.trigger(t.error);break;case"alphaSynth.output.addSamples":this._output.addSamples(t.samples);break;case"alphaSynth.output.play":this._output.play();break;case"alphaSynth.output.pause":this._output.pause();break;case"alphaSynth.output.destroy":this._output.destroy();break;case"alphaSynth.output.resetSamples":this._output.resetSamples();break}}checkReady(){this.isReady&&this.ready.trigger()}checkReadyForPlayback(){this.isReadyForPlayback&&this.readyForPlayback.trigger()}onOutputSampleRequest(){this._synth.postMessage({cmd:"alphaSynth.output.sampleRequest"})}onOutputSamplesPlayed(e){this._synth.postMessage({cmd:"alphaSynth.output.samplesPlayed",samples:e})}onOutputReady(){this._outputIsReady=!0,this.checkReady()}}class xO{constructor(e,t){this._width=0,this.boundsLookup=null,this.preRender=new He,this.partialRenderFinished=new He,this.partialLayoutFinished=new He,this.renderFinished=new He,this.postRenderFinished=new Jt,this.error=new He,this._api=e;try{this._worker=D.createWebWorker(t)}catch(s){I.error("Rendering",`Failed to create WebWorker: ${s}`);return}this._worker.postMessage({cmd:"alphaTab.initialize",settings:this.serializeSettingsForWorker(t)}),this._worker.addEventListener("message",this.handleWorkerMessage.bind(this))}destroy(){this._worker.terminate()}updateSettings(e){this._worker.postMessage({cmd:"alphaTab.updateSettings",settings:this.serializeSettingsForWorker(e)})}serializeSettingsForWorker(e){const t=Dt.settingsToJsObject(e);return t.delete("player"),t}render(){this._worker.postMessage({cmd:"alphaTab.render"})}resizeRender(){this._worker.postMessage({cmd:"alphaTab.resizeRender"})}renderResult(e){this._worker.postMessage({cmd:"alphaTab.renderResult",resultId:e})}get width(){return this._width}set width(e){this._width=e,this._worker.postMessage({cmd:"alphaTab.setWidth",width:e})}handleWorkerMessage(e){let t=e.data;switch(t.cmd){case"alphaTab.preRender":this.preRender.trigger(t.resize);break;case"alphaTab.partialRenderFinished":this.partialRenderFinished.trigger(t.result);break;case"alphaTab.partialLayoutFinished":this.partialLayoutFinished.trigger(t.result);break;case"alphaTab.renderFinished":this.renderFinished.trigger(t.result);break;case"alphaTab.postRenderFinished":this.boundsLookup=mu.fromJson(t.boundsLookup,this._api.score),this.boundsLookup.finish(),this.postRenderFinished.trigger();break;case"alphaTab.error":this.error.trigger(t.error);break}}renderScore(e,t){let s=e==null?null:Dt.scoreToJsObject(e);this._worker.postMessage({cmd:"alphaTab.renderScore",score:s,trackIndexes:t,fontSizes:Ci.FontSizeLookupTables})}}class _O{constructor(e,t,s,r){this.cursorWrapper=e,this.barCursor=t,this.beatCursor=s,this.selectionWrapper=r}}class yu{static init(){var e;yu._isRegistered||(yu._isRegistered=!0,registerProcessor("alphatab",(e=class extends AudioWorkletProcessor{constructor(s){super(s),this._outputBuffer=new Float32Array(0),this._bufferCount=0,this._requestedBufferCount=0,this._isStopped=!1,I.debug("WebAudio","creating processor"),this._bufferCount=Math.floor(s.processorOptions.bufferTimeInMilliseconds*sampleRate/1e3/e.BufferSize),this._circularBuffer=new j0(e.BufferSize*this._bufferCount),this.port.onmessage=this.handleMessage.bind(this)}handleMessage(s){let r=s.data;switch(r.cmd){case ht.CmdOutputAddSamples:const a=r.samples;this._circularBuffer.write(a,0,a.length),this._requestedBufferCount--;break;case ht.CmdOutputResetSamples:this._circularBuffer.clear();break;case ht.CmdOutputStop:this._isStopped=!0;break}}process(s,r,n){if(r.length!==1&&r[0].length!==2)return!1;let a=r[0][0],o=r[0][1];if(!a||!o)return!0;let l=a.length+o.length,u=this._outputBuffer;u.length!==l&&(u=new Float32Array(l),this._outputBuffer=u);const h=this._circularBuffer.read(u,0,Math.min(u.length,this._circularBuffer.count));let c=0;const d=Math.min(a.length,h);for(let f=0;f<d;f++)a[f]=u[c++],o[f]=u[c++];if(h<a.length)for(let f=h;f<a.length;f++)a[f]=0,o[f]=0;return this.port.postMessage({cmd:ht.CmdOutputSamplesPlayed,samples:h/Ne.AudioChannels}),this.requestBuffers(),this._circularBuffer.count>0||!this._isStopped}requestBuffers(){const s=this._bufferCount/2|0;let r=s*e.BufferSize;if(this._circularBuffer.count+this._requestedBufferCount*e.BufferSize<r){for(let a=0;a<s;a++)this.port.postMessage({cmd:ht.CmdOutputSampleRequest});this._requestedBufferCount+=s}}},e.BufferSize=4096,e)))}}yu._isRegistered=!1;class J_ extends Ns{constructor(e){super(),this._worklet=null,this._bufferTimeInMilliseconds=0,this._settings=e}open(e){super.open(e),this._bufferTimeInMilliseconds=e,this.onReady()}play(){super.play();let e=this._context;D.createAudioWorklet(e,this._settings).then(()=>{this._worklet=new AudioWorkletNode(e,"alphatab",{numberOfOutputs:1,outputChannelCount:[2],processorOptions:{bufferTimeInMilliseconds:this._bufferTimeInMilliseconds}}),this._worklet.port.onmessage=this.handleMessage.bind(this),this._source.connect(this._worklet),this._source.start(0),this._worklet.connect(e.destination)},t=>{I.error("WebAudio",`Audio Worklet creation failed: reason=${t}`)})}handleMessage(e){let t=e.data;switch(t.cmd){case ht.CmdOutputSamplesPlayed:this.onSamplesPlayed(t.samples);break;case ht.CmdOutputSampleRequest:this.onSampleRequest();break}}pause(){super.pause(),this._worklet&&(this._worklet.port.postMessage({cmd:ht.CmdOutputStop}),this._worklet.port.onmessage=null,this._worklet.disconnect()),this._worklet=null}addSamples(e){var t;(t=this._worklet)==null||t.port.postMessage({cmd:ht.CmdOutputAddSamples,samples:e})}resetSamples(){var e;(e=this._worklet)==null||e.port.postMessage({cmd:ht.CmdOutputResetSamples})}}class TO extends Dr{constructor(e,t,s){super(e),this._xscale=t,this._yscale=s}get width(){return this.element.offsetWidth/this._xscale}set width(e){this.element.style.width=e*this._xscale+"px"}get height(){return this.element.offsetHeight/this._yscale}set height(e){e>=0?this.element.style.height=e*this._yscale+"px":this.element.style.height="100%"}setBounds(e,t,s,r){isNaN(e)&&(e=this.lastBounds.x),isNaN(t)&&(t=this.lastBounds.y),isNaN(s)?s=this.lastBounds.w:s=s/this._xscale,isNaN(r)?r=this.lastBounds.h:r=r/this._yscale,this.element.style.transform=`translate(${e}px, ${t}px) scale(${s}, ${r})`,this.element.style.transformOrigin="top left",this.lastBounds.x=e,this.lastBounds.y=t,this.lastBounds.w=s,this.lastBounds.h=r}}var Br;(function(i){i[i.LayoutDone=0]="LayoutDone",i[i.RenderRequested=1]="RenderRequested",i[i.RenderDone=2]="RenderDone",i[i.Detached=3]="Detached"})(Br||(Br={}));class NO{get resizeThrottle(){return 10}get canRender(){return this.areAllFontsLoaded()}areAllFontsLoaded(){if(D.bravuraFontChecker.checkForFontAvailability(),!D.bravuraFontChecker.isFontLoaded)return!1;let e=!1;for(const t of this._fontCheckers.values())t.isFontLoaded||(e=!0);return e?!1:(I.debug("Font","All fonts loaded: "+this._fontCheckers.size),!0)}onFontLoaded(e){Ci.generateFontLookup(e),this.areAllFontsLoaded()&&this.canRenderChanged.trigger()}constructor(e){if(this._fontCheckers=new Map,this._contents=null,this._file=null,this._totalResultCount=0,this._initialTrackIndexes=null,this._barToElementLookup=new Map,this._resultIdToElementLookup=new Map,this.rootContainerBecameVisible=new Jt,this.canRenderChanged=new Jt,this._highlightedElements=[],this._scrollContainer=null,D.webPlatform!==cs.Browser&&D.webPlatform!==cs.BrowserModule)throw new ni(ri.General,"Usage of AlphaTabApi is only possible in browser environments. For usage in node use the Low Level APIs");e.classList.add("alphaTab"),this.rootContainer=new Dr(e),this.areWorkersSupported="Worker"in window,D.bravuraFontChecker.fontLoaded.on(this.onFontLoaded.bind(this)),this._intersectionObserver=new IntersectionObserver(this.onElementVisibilityChanged.bind(this),{threshold:[0,.01,1]}),this._intersectionObserver.observe(e)}onElementVisibilityChanged(e){for(const t of e){const s=t.target;if(s===this.rootContainer.element)t.isIntersecting&&(this.rootContainerBecameVisible.trigger(),this._intersectionObserver.unobserve(this.rootContainer.element));else if("layoutResultId"in s&&this._api.settings.core.enableLazyLoading){const r=s;t.isIntersecting?r.renderedResultId!==r.layoutResultId?this._resultIdToElementLookup.has(r.layoutResultId)?r.resultState!==Br.RenderRequested&&(r.resultState=Br.RenderRequested,this._api.renderer.renderResult(r.layoutResultId)):s.replaceChildren():r.resultState===Br.Detached&&(s.replaceChildren(...r.renderedResult),r.resultState=Br.RenderDone):r.resultState===Br.RenderDone&&(r.resultState=Br.Detached,r.replaceChildren())}}}createWorkerRenderer(){return new xO(this._api,this._api.settings)}initialize(e,t){this._api=e;let s;t instanceof gu?s=t:s=Dt.jsObjectToSettings(t);let r=this.getDataAttributes();Ho.fromJson(s,r),s.notation.notationMode===Qt.SongBook&&s.setSongBookModeSettings(),e.settings=s,this.setupFontCheckers(s),this._initialTrackIndexes=this.parseTracks(s.core.tracks),this._contents="";let n=e.container;s.core.tex&&(this._contents=n.element.innerHTML,n.element.innerHTML=""),this.createStyleElement(s),this._file=s.core.file}setupFontCheckers(e){this.registerFontChecker(e.display.resources.copyrightFont),this.registerFontChecker(e.display.resources.effectFont),this.registerFontChecker(e.display.resources.fingeringFont),this.registerFontChecker(e.display.resources.graceFont),this.registerFontChecker(e.display.resources.markerFont),this.registerFontChecker(e.display.resources.tablatureFont),this.registerFontChecker(e.display.resources.titleFont),this.registerFontChecker(e.display.resources.wordsFont),this.registerFontChecker(e.display.resources.barNumberFont),this.registerFontChecker(e.display.resources.fretboardNumberFont),this.registerFontChecker(e.display.resources.subTitleFont)}registerFontChecker(e){if(!this._fontCheckers.has(e.families.join(", "))){let t=new X_(e.families);this._fontCheckers.set(e.families.join(", "),t),t.fontLoaded.on(this.onFontLoaded.bind(this)),t.checkForFontAvailability()}}destroy(){this.rootContainer.element.innerHTML=""}createCanvasElement(){let e=document.createElement("div");return e.className="at-surface",e.style.fontSize="0",e.style.overflow="hidden",e.style.lineHeight="0",e.style.position="relative",new Dr(e)}triggerEvent(e,t,s=null,r){let n=e.element;t="alphaTab."+t;let a=document.createEvent("CustomEvent"),o=r?r.mouseEvent:null;if(a.initCustomEvent(t,!1,!1,s),o&&(a.originalEvent=o),n.dispatchEvent(a),window&&"jQuery"in window){let l=window.jQuery,u=[];u.push(s),o&&u.push(o),l(n).trigger(t,u)}}load(e,t,s){if(e instanceof Fa)return t(e),!0;if(e instanceof ArrayBuffer){let r=new Uint8Array(e);return t(go.loadScoreFromBytes(r,this._api.settings)),!0}return e instanceof Uint8Array?(t(go.loadScoreFromBytes(e,this._api.settings)),!0):typeof e=="string"?(go.loadScoreAsync(e,t,s,this._api.settings),!0):!1}loadSoundFont(e,t){return this._api.player?e instanceof ArrayBuffer?(this._api.player.loadSoundFont(new Uint8Array(e),t),!0):e instanceof Uint8Array?(this._api.player.loadSoundFont(e,t),!0):typeof e=="string"?(this._api.loadSoundFontFromUrl(e,t),!0):!1:!1}initialRender(){this._api.renderer.preRender.on(t=>{this._totalResultCount=0,this._resultIdToElementLookup.clear(),this._barToElementLookup.clear()});const e=()=>{this._api.renderer.width=this.rootContainer.width|0,this._api.renderer.updateSettings(this._api.settings),this._contents?(this._api.tex(this._contents,this._initialTrackIndexes??void 0),this._initialTrackIndexes=null):this._file&&go.loadScoreAsync(this._file,t=>{this._api.renderScore(t,this._initialTrackIndexes??void 0),this._initialTrackIndexes=null},t=>{this._api.onError(t)},this._api.settings)};this.rootContainer.isVisible?e():this.rootContainerBecameVisible.on(e)}createStyleElement(e){let t=this._api.container.element.ownerDocument;D.createStyleElement(t,e.core.fontDirectory)}parseTracks(e){if(!e)return[];let t=[];if(typeof e=="string")try{if(e==="all")return[-1];e=JSON.parse(e)}catch{e=[0]}if(typeof e=="number")t.push(e);else if("length"in e){let s=e.length,r=e;for(let n=0;n<s;n++){let a=r[n],o=0;typeof a=="number"?o=a:"index"in a?o=a.index:o=parseInt(a.toString()),(o>=0||o===-1)&&t.push(o)}}else"index"in e&&t.push(e.index);return t}getDataAttributes(){let e=new Map,t=this._api.container.element;if(t.dataset)for(let s of Object.keys(t.dataset)){let r=t.dataset[s];try{r=JSON.parse(r)}catch{r===""&&(r=null)}e.set(s,r)}else for(let s=0;s<t.attributes.length;s++){let r=t.attributes.item(s),n=r.nodeName;if(n.startsWith("data-")){let a=n.substr(5).split("-"),o=a[0];for(let u=1;u<a.length;u++)o+=a[u].substr(0,1).toUpperCase()+a[u].substr(1);let l=r.nodeValue;try{l=JSON.parse(l)}catch{l===""&&(l=null)}e.set(o,l)}}return e}beginUpdateRenderResults(e){if(!this._resultIdToElementLookup.has(e.id))return;const t=this._resultIdToElementLookup.get(e.id),s=e.renderResult;typeof s=="string"?t.innerHTML=s:"nodeType"in s&&t.replaceChildren(s),t.resultState=Br.RenderDone,t.renderedResultId=e.id,t.renderedResult=Array.from(t.children)}beginAppendRenderResults(e){const t=this._api.canvasElement.element;if(e){let s;this._totalResultCount<t.childElementCount?s=t.childNodes.item(this._totalResultCount):(s=document.createElement("div"),t.appendChild(s)),s.style.zIndex="1",s.style.position="absolute",s.style.left=e.x+"px",s.style.top=e.y+"px",s.style.width=e.width+"px",s.style.height=e.height+"px",s.style.display="inline-block",s.layoutResultId=e.id,s.resultState=Br.LayoutDone,delete s.renderedResultId,delete s.renderedResult,this._resultIdToElementLookup.set(e.id,s);for(let r=e.firstMasterBarIndex;r<=e.lastMasterBarIndex;r++)r>=0&&this._barToElementLookup.set(r,s);this._api.settings.core.enableLazyLoading&&(this._intersectionObserver.unobserve(s),this._intersectionObserver.observe(s)),this._totalResultCount++}else for(;t.childElementCount>this._totalResultCount;)this._api.settings.core.enableLazyLoading&&this._intersectionObserver.unobserve(t.lastChild),t.removeChild(t.lastElementChild)}createWorkerPlayer(){let e=null,t="ScriptProcessorNode"in window;return window.isSecureContext&&"AudioWorkletNode"in window&&this._api.settings.player.outputMode===pu.WebAudioAudioWorklets?(I.debug("Player","Will use webworkers for synthesizing and web audio api with worklets for playback"),e=new Yg(new J_(this._api.settings),this._api.settings)):t&&(I.debug("Player","Will use webworkers for synthesizing and web audio api with ScriptProcessor for playback"),e=new Yg(new Q_,this._api.settings)),e?e.ready.on(()=>{this._api.settings.player.soundFont&&this._api.loadSoundFontFromUrl(this._api.settings.player.soundFont,!1)}):I.error("Player","Player requires webworkers and web audio api, browser unsupported",null),e}beginInvoke(e){window.requestAnimationFrame(()=>{e()})}highlightElements(e,t){const s=this._barToElementLookup.get(t);if(s){let r=s.getElementsByClassName(e);for(let n=0;n<r.length;n++)r.item(n).classList.add("at-highlight"),this._highlightedElements.push(r.item(n))}}removeHighlights(){const e=this._highlightedElements;if(e){for(const t of e)t.classList.remove("at-highlight");this._highlightedElements=[]}}destroyCursors(){let e=this._api.container.element,t=e.querySelector(".at-cursors");e.removeChild(t)}createCursors(){let e=this._api.container.element,t=document.createElement("div");t.classList.add("at-cursors");let s=document.createElement("div");s.classList.add("at-selection");const r=this.createScalingElement(),n=this.createScalingElement();let a=r.element;a.classList.add("at-cursor-bar");let o=n.element;return o.classList.add("at-cursor-beat"),e.style.position="relative",e.style.textAlign="left",t.style.position="absolute",t.style.zIndex="1000",t.style.display="inline",t.style.pointerEvents="none",s.style.position="absolute",a.style.position="absolute",a.style.left="0",a.style.top="0",a.style.willChange="transform",r.width=1,r.height=1,r.setBounds(0,0,1,1),o.style.position="absolute",o.style.transition="all 0s linear",o.style.left="0",o.style.top="0",o.style.willChange="transform",n.width=3,n.height=1,n.setBounds(0,0,1,1),e.insertBefore(t,e.firstChild),t.appendChild(s),t.appendChild(a),t.appendChild(o),new _O(new Dr(t),r,n,new Dr(s))}getOffset(e,t){let s=t.element,r=s.getBoundingClientRect(),n=r.top+s.ownerDocument.defaultView.pageYOffset,a=r.left+s.ownerDocument.defaultView.pageXOffset;if(e){let l=e.element,u=l.nodeName.toLowerCase();if(u!=="html"&&u!=="body"){let h=this.getOffset(null,e);n=n+l.scrollTop-h.y,a=a+l.scrollLeft-h.x}}let o=new Wi;return o.x=a,o.y=n,o.w=r.width,o.h=r.height,o}getScrollContainer(){if(this._scrollContainer)return this._scrollContainer;let e=typeof this._api.settings.player.scrollElement=="string"?document.querySelector(this._api.settings.player.scrollElement):this._api.settings.player.scrollElement,t=e.nodeName.toLowerCase();return(t==="html"||t==="body")&&("scrollingElement"in document?e=document.scrollingElement:navigator.userAgent.indexOf("WebKit")!==-1?e=document.body:e=document.documentElement),this._scrollContainer=new Dr(e),this._scrollContainer}createSelectionElement(){return this.createScalingElement()}createScalingElement(){const e=document.createElement("div");e.style.position="absolute";const t=new TO(e,100,100);return t.width=1,t.height=1,t.setBounds(0,0,1,1),t}scrollToY(e,t,s){this.internalScrollToY(e.element,t,s)}scrollToX(e,t,s){this.internalScrollToX(e.element,t,s)}internalScrollToY(e,t,s){if(this._api.settings.player.nativeBrowserSmoothScroll)e.scrollTo({top:t,behavior:"smooth"});else{let r=e.scrollTop,n=t-r,a=0,o=l=>{a===0&&(a=l);let u=l-a,h=Math.min(u/s,1);e.scrollTop=r+n*h|0,u<s&&window.requestAnimationFrame(o)};window.requestAnimationFrame(o)}}internalScrollToX(e,t,s){if(this._api.settings.player.nativeBrowserSmoothScroll)e.scrollTo({left:t,behavior:"smooth"});else{let r=e.scrollLeft,n=t-r,a=0,o=l=>{a===0&&(a=l);let u=l-a,h=Math.min(u/s,1);e.scrollLeft=r+n*h|0,u<s&&window.requestAnimationFrame(o)};window.requestAnimationFrame(o)}}}class Vd extends vO{constructor(e,t){super(new NO(e),t),this.soundFontLoad=new He}tex(e,t){let s=this.uiFacade;super.tex(e,s.parseTracks(t))}print(e,t=null){let s=window.open("","","width=0,height=0"),r=s.document.createElement("div");e?r.style.width=e:this.settings.display.layoutMode===rn.Horizontal?r.style.width="297mm":r.style.width="210mm",s.document.write(`
        <!DOCTYPE html>
        <html>
          <head>
            <style>
            .at-surface {
                width: auto !important;
                height: auto !important;
            }
            .at-surface > div {
                position: relative!important;
                left: auto !important;
                top: auto !important;
                break-inside: avoid;
            }
            </style>
          </head>
          <body></body>
        </html>
        `);const n=this.score;n&&(n.artist&&n.title?s.document.title=`${n.title} - ${n.artist}`:n.title&&(s.document.title=`${n.title}`)),s.document.body.appendChild(r);let a=typeof window.screenLeft<"u"?window.screenLeft:window.left,o=typeof window.screenTop<"u"?window.screenTop:window.top,l="innerWidth"in window?window.innerWidth:"clientWidth"in document.documentElement?document.documentElement.clientWidth:window.screen.width,u="innerHeight"in window?window.innerHeight:"clientHeight"in document.documentElement?document.documentElement.clientHeight:window.screen.height,h=r.offsetWidth+50,c=window.innerHeight,d=(l/2|0)-(h/2|0)+a,f=(u/2|0)-(c/2|0)+o;s.resizeTo(h,c),s.moveTo(d,f),s.focus();let p=Dt.jsObjectToSettings(Dt.settingsToJsObject(this.settings));p.core.enableLazyLoading=!1,p.core.useWorkers=!0,p.core.file=null,p.core.tracks=null,p.player.enableCursor=!1,p.player.enablePlayer=!1,p.player.enableElementHighlighting=!1,p.player.enableUserInteraction=!1,p.player.soundFont=null,p.display.scale=.8,p.display.stretchForce=.8,Ho.fromJson(p,t);let g=new Vd(r,p);s.onunload=()=>{g.destroy()},g.renderer.postRenderFinished.on(()=>{s.print()}),g.renderTracks(this.tracks)}downloadMidi(e=Vo.SingleTrackMultiChannel){if(!this.score)return;let t=new Un;t.format=e;let s=new Lr(t,!0);new Xe(this.score,this.settings,s).generate();let n=t.toBinary(),a=this.score.title?`${this.score.title}.mid`:"File.mid",o=document.createElement("a");o.download=a;let l=new Blob([n],{type:"audio/midi"}),u=URL.createObjectURL(l);o.href=u,o.style.display="none",document.body.appendChild(o),o.click(),document.body.removeChild(o)}changeTrackMute(e,t){let s=this.trackIndexesToTracks(this.uiFacade.parseTracks(e));super.changeTrackMute(s,t)}changeTrackSolo(e,t){let s=this.trackIndexesToTracks(this.uiFacade.parseTracks(e));super.changeTrackSolo(s,t)}changeTrackVolume(e,t){let s=this.trackIndexesToTracks(this.uiFacade.parseTracks(e));super.changeTrackVolume(s,t)}trackIndexesToTracks(e){if(!this.score)return[];let t=[];if(e.length===1&&e[0]===-1)for(let s of this.score.tracks)t.push(s);else for(let s of e)s>=0&&s<this.score.tracks.length&&t.push(this.score.tracks[s]);return t}loadSoundFontFromUrl(e,t){this.player&&this.player.loadSoundFontFromUrl(e,t,s=>{this.soundFontLoad.trigger(s),this.uiFacade.triggerEvent(this.container,"soundFontLoad",s)})}}class nS{constructor(){this._initListeners=[]}exec(e,t,s){if(typeof t!="string"&&(s=[t],t="init"),t.charCodeAt(0)===95||t==="exec")return null;let r=new jQuery(e),n=r.data("alphaTab");if(t==="destroy"&&!n)return null;if(t!=="init"&&!n)throw new Error("alphaTab not initialized");let a=this[t];if(a){let o=[r,n].concat(s);return a.apply(this,o)}else return I.error("Api","Method '"+t+"' does not exist on jQuery.alphaTab"),null}init(e,t,s){if(!t){t=new Vd(e[0],s),e.data("alphaTab",t);for(let r of this._initListeners)r(e,t,s)}}destroy(e,t){e.removeData("alphaTab"),t.destroy()}print(e,t,s,r){t.print(s,r)}load(e,t,s,r){return t.load(s,r)}render(e,t){t.render()}renderScore(e,t,s,r){t.renderScore(s,r)}renderTracks(e,t,s){t.renderTracks(s)}invalidate(e,t){t.render()}tex(e,t,s,r){t.tex(s,r)}muteTrack(e,t,s,r){t.changeTrackMute(s,r)}soloTrack(e,t,s,r){t.changeTrackSolo(s,r)}trackVolume(e,t,s,r){t.changeTrackVolume(s,r)}loadSoundFont(e,t,s,r){t.loadSoundFont(s,r)}resetSoundFonts(e,t){t.resetSoundFonts()}pause(e,t){t.pause()}play(e,t){return t.play()}playPause(e,t){t.playPause()}stop(e,t){t.stop()}api(e,t){return t}player(e,t){return t.player}isReadyForPlayback(e,t){return t.isReadyForPlayback}playerState(e,t){return t.playerState}masterVolume(e,t,s){return typeof s=="number"&&(t.masterVolume=s),t.masterVolume}metronomeVolume(e,t,s){return typeof s=="number"&&(t.metronomeVolume=s),t.metronomeVolume}countInVolume(e,t,s){return typeof s=="number"&&(t.countInVolume=s),t.countInVolume}midiEventsPlayedFilter(e,t,s){return Array.isArray(s)&&(t.midiEventsPlayedFilter=s),t.midiEventsPlayedFilter}playbackSpeed(e,t,s){return typeof s=="number"&&(t.playbackSpeed=s),t.playbackSpeed}tickPosition(e,t,s){return typeof s=="number"&&(t.tickPosition=s),t.tickPosition}timePosition(e,t,s){return typeof s=="number"&&(t.timePosition=s),t.timePosition}loop(e,t,s){return typeof s=="boolean"&&(t.isLooping=s),t.isLooping}renderer(e,t){return t.renderer}score(e,t){return t.score}settings(e,t){return t.settings}tracks(e,t){return t.tracks}_oninit(e){this._initListeners.push(e)}static restore(e){new jQuery(e).empty().removeData("alphaTab")}}class U0{constructor(){this.buffer="",this._currentPath="",this._currentPathIsEmpty=!0,this.color=new Je(255,255,255,255),this.lineWidth=1,this.font=new Be("Arial",10,gt.Plain),this.textAlign=de.Left,this.textBaseline=we.Top}destroy(){}beginRender(e,t){this.buffer=`<svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="${e|0}px" height="${t|0}px" class="at-surface-svg">
`,this._currentPath="",this._currentPathIsEmpty=!0,this.textBaseline=we.Top}beginGroup(e){this.buffer+=`<g class="${e}">`}endGroup(){this.buffer+="</g>"}endRender(){return this.buffer+="</svg>",this.buffer}fillRect(e,t,s,r){s>0&&(this.buffer+=`<rect x="${e|0}" y="${t|0}" width="${s}" height="${r}" fill="${this.color.rgba}" />
`)}strokeRect(e,t,s,r){this.buffer+=`<rect x="${e|0}" y="${t|0}" width="${s}" height="${r}" stroke="${this.color.rgba}"`,this.lineWidth!==1&&(this.buffer+=` stroke-width="${this.lineWidth}"`),this.buffer+=` fill="transparent" />
`}beginPath(){}closePath(){this._currentPath+=" z"}moveTo(e,t){this._currentPath+=` M${e},${t}`}lineTo(e,t){this._currentPathIsEmpty=!1,this._currentPath+=` L${e},${t}`}quadraticCurveTo(e,t,s,r){this._currentPathIsEmpty=!1,this._currentPath+=` Q${e},${t},${s},${r}`}bezierCurveTo(e,t,s,r,n,a){this._currentPathIsEmpty=!1,this._currentPath+=` C${e},${t},${s},${r},${n},${a}`}fillCircle(e,t,s){this._currentPathIsEmpty=!1,this._currentPath+=` M${e-s},${t} A1,1 0 0,0 ${e+s},${t} A1,1 0 0,0 ${e-s},${t} z`,this.fill()}strokeCircle(e,t,s){this._currentPathIsEmpty=!1,this._currentPath+=` M${e-s},${t} A1,1 0 0,0 ${e+s},${t} A1,1 0 0,0 ${e-s},${t} z`,this.stroke()}fill(){this._currentPathIsEmpty||(this.buffer+=`<path d="${this._currentPath}"`,this.color.rgba!=="#000000"&&(this.buffer+=` fill="${this.color.rgba}"`),this.buffer+=' style="stroke: none"/>'),this._currentPath="",this._currentPathIsEmpty=!0}stroke(){if(!this._currentPathIsEmpty){let e=`<path d="${this._currentPath}" stroke="${this.color.rgba}"`;this.lineWidth!==1&&(e+=` stroke-width="${this.lineWidth}"`),e+=' style="fill: none" />',this.buffer+=e}this._currentPath="",this._currentPathIsEmpty=!0}fillText(e,t,s){if(e==="")return;let r=`<text x="${t|0}" y="${s|0}" style="stroke: none; font:${this.font.toCssString(this.settings.display.scale)}; ${this.getSvgBaseLine()}"`;this.color.rgba!=="#000000"&&(r+=` fill="${this.color.rgba}"`),this.textAlign!==de.Left&&(r+=` text-anchor="${this.getSvgTextAlignment(this.textAlign)}"`),r+=`>${U0.escapeText(e)}</text>`,this.buffer+=r}static escapeText(e){return e.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}getSvgTextAlignment(e){switch(e){case de.Left:return"start";case de.Center:return"middle";case de.Right:return"end"}return""}getSvgBaseLine(){switch(this.textBaseline){case we.Top:return"dominant-baseline: hanging";case we.Bottom:return"dominant-baseline: bottom";default:return""}}measureText(e){return e?Ci.measureString(e,this.font.families,this.font.size,this.font.style,this.font.weight):new Rd(0,0)}onRenderFinished(){return null}beginRotate(e,t,s){this.buffer+='<g transform="translate('+e+" ,"+t+") rotate( "+s+')">'}endRotate(){this.buffer+="</g>"}}class BO extends U0{constructor(){super()}fillMusicFontSymbol(e,t,s,r,n){r!==S.None&&this.fillMusicFontSymbolText(e,t,s,`&#${r};`,n)}fillMusicFontSymbols(e,t,s,r,n){let a="";for(let o of r)o!==S.None&&(a+=`&#${o};`);this.fillMusicFontSymbolText(e,t,s,a,n)}fillMusicFontSymbolText(e,t,s,r,n){this.buffer+=`<g transform="translate(${e} ${t})" class="at" ><text`,s!==1?this.buffer+=` style="font-size: ${s*100}%; stroke:none"`:this.buffer+=' style="stroke:none"',this.color.rgba!=="#000000"&&(this.buffer+=` fill="${this.color.rgba}"`),n&&(this.buffer+=' text-anchor="'+this.getSvgTextAlignment(de.Center)+'"'),this.buffer+=`>${r}</text></g>`}}class Fu{constructor(){this.isInAccolade=!0,this.isRelevantForBoundsLookup=!0,this.hideOnMultiTrack=!1,this.hideOnPercussionTrack=!1}canCreate(e,t){return!this.hideOnPercussionTrack||!t.isPercussion}}var _e;(function(i){i[i.PreNotes=0]="PreNotes",i[i.OnNotes=1]="OnNotes",i[i.MiddleNotes=2]="MiddleNotes",i[i.Stem=3]="Stem",i[i.PostNotes=4]="PostNotes",i[i.EndBeat=5]="EndBeat"})(_e||(_e={}));class qs extends vt{get isEmpty(){return!this.glyphs||this.glyphs.length===0}constructor(e,t){super(e,t),this.glyphs=null}doLayout(){if(!this.glyphs||this.glyphs.length===0){this.width=0;return}let e=0;for(let t=0,s=this.glyphs.length;t<s;t++){let r=this.glyphs[t];r.renderer=this.renderer,r.doLayout(),e=Math.max(e,r.width)}this.width=e}addGlyph(e){this.glyphs||(this.glyphs=[]),this.renderer&&(e.renderer=this.renderer),this.glyphs.push(e)}paint(e,t,s){let r=this.glyphs;if(!(!r||r.length===0))for(let n of r)n.paint(e+this.x,t+this.y,s)}}class ll extends qs{constructor(){super(0,0),this.glyphs=[]}addGlyph(e){e.x=this.glyphs.length===0?0:this.glyphs[this.glyphs.length-1].x+this.glyphs[this.glyphs.length-1].width,e.renderer=this.renderer,e.doLayout(),this.width=e.x+e.width,super.addGlyph(e)}}class q_ extends qs{constructor(e,t,s){super(e,t),this.voice=s,this.beatGlyphs=[],this.tupletGroups=[]}scaleToWidth(e){const t=this.renderer.scale;let s=this.renderer.layoutingInfo.spaceToForce(e/t);this.scaleToForce(s)}scaleToForce(e){const t=this.renderer.scale;this.width=this.renderer.layoutingInfo.calculateVoiceWidth(e)*t;let s=this.renderer.layoutingInfo.buildOnTimePositions(e),r=this.beatGlyphs;for(let n=0,a=r.length;n<a;n++){let o=r[n];switch(o.beat.graceType){case he.None:o.x=s.get(o.beat.absoluteDisplayStart)*t-o.onTimeX;break;default:const l=o.beat.graceGroup.beats[0].absoluteDisplayStart,u=o.beat.graceGroup.id;if(o.beat.graceGroup.isComplete&&s.has(l)){o.x=s.get(l)*t-o.onTimeX;let h=this.renderer.layoutingInfo.allGraceRods.get(u);const c=o.beat.graceGroup.beats[o.beat.graceGroup.beats.length-1].nextBeat,d=c?this.renderer.layoutingInfo.getPreBeatSize(c)+Cs.GraceBeatPadding*this.renderer.scale:0;o.x-=d,o.x-=h[o.beat.graceIndex].postSpringWidth,o.x+=h[o.beat.graceIndex].graceBeatWidth;const f=h[o.beat.graceGroup.beats.length-1];o.x-=f.graceBeatWidth}else{let h=this.renderer.layoutingInfo.incompleteGraceRods.get(u);const c=h[o.beat.graceIndex].postSpringWidth-h[o.beat.graceIndex].preSpringWidth;n>0?o.beat.graceIndex===0?o.x=r[n-1].x+r[n-1].width:o.x=r[n-1].x+h[o.beat.graceIndex-1].postSpringWidth-h[o.beat.graceIndex-1].preSpringWidth-c:o.x=-c}break}if(n>0){let l=o.x-r[n-1].x;r[n-1].scaleToWidth(l)}if(n===a-1){let l=this.width-r[r.length-1].x;o.scaleToWidth(l)}}}registerLayoutingInfo(e){e.updateVoiceSize(this.width);let t=this.beatGlyphs;for(let s of t)s.registerLayoutingInfo(e)}applyLayoutingInfo(e){let t=this.beatGlyphs;for(let s of t)s.applyLayoutingInfo(e);this.scaleToForce(Math.max(this.renderer.settings.display.stretchForce,e.minStretchForce))}addGlyph(e){let t=e;e.x=this.beatGlyphs.length===0?0:this.beatGlyphs[this.beatGlyphs.length-1].x+this.beatGlyphs[this.beatGlyphs.length-1].width,e.renderer=this.renderer,e.doLayout(),this.beatGlyphs.push(t),this.width=e.x+e.width,t.beat.hasTuplet&&t.beat.tupletGroup.beats[0].id===t.beat.id&&this.tupletGroups.push(t.beat.tupletGroup)}doLayout(){}paint(e,t,s){s.color=this.voice.index===0?this.renderer.resources.mainGlyphColor:this.renderer.resources.secondaryGlyphColor;for(let r=0,n=this.beatGlyphs.length;r<n;r++)this.beatGlyphs[r].paint(e+this.x,t+this.y,s)}}q_.KeySizeBeat="Beat";var ue;(function(i){i[i.None=0]="None",i[i.Natural=1]="Natural",i[i.Sharp=2]="Sharp",i[i.Flat=3]="Flat",i[i.NaturalQuarterNoteUp=4]="NaturalQuarterNoteUp",i[i.SharpQuarterNoteUp=5]="SharpQuarterNoteUp",i[i.FlatQuarterNoteUp=6]="FlatQuarterNoteUp",i[i.DoubleSharp=7]="DoubleSharp",i[i.DoubleFlat=8]="DoubleFlat"})(ue||(ue={}));class CO{constructor(){this.maxLine=-1e3,this.minLine=-1e3}}class mt{constructor(e){this._registeredAccidentals=new Map,this._appliedScoreLines=new Map,this._appliedScoreLinesByValue=new Map,this._notesByValue=new Map,this._beatLines=new Map,this.maxLineBeat=null,this.minLineBeat=null,this.maxLine=-1e3,this.minLine=-1e3,this._barRenderer=e,this._bar=e.bar}static getPercussionLine(e,t){var s;return t<e.staff.track.percussionArticulations.length?e.staff.track.percussionArticulations[t].staffLine:((s=Lt.getArticulationByValue(t))==null?void 0:s.staffLine)??0}static getNoteValue(e){if(e.isPercussion)return e.percussionArticulation;let t=e.displayValue;switch(e.accidentalMode){case At.ForceDoubleFlat:t+=2;break;case At.ForceDoubleSharp:t-=2;break;case At.ForceFlat:t+=1;break;case At.ForceSharp:t-=1;break}return t}applyAccidental(e){const t=mt.getNoteValue(e);let s=e.hasQuarterToneOffset;return this.getAccidental(t,s,e.beat,!1,e)}applyAccidentalForValue(e,t,s,r){return this.getAccidental(t,s,e,r,null)}static computeLineWithoutAccidentals(e,t){let s=0;const r=mt.getNoteValue(t);return e.staff.isPercussion?s=mt.getPercussionLine(e,r):s=mt.calculateNoteLine(e,r),s}static computeAccidental(e,t,s,r,n=null){let o=e+7,l=s%12,u=o<7?ue.Flat:ue.Sharp,h=mt.KeySignatureLookup[o][l],c=mt.AccidentalNotes[l],d=ue.None;if(r)switch(d=c?u:ue.Natural,d){case ue.Natural:d=ue.NaturalQuarterNoteUp;break;case ue.Sharp:d=ue.SharpQuarterNoteUp;break;case ue.Flat:d=ue.FlatQuarterNoteUp;break}else{switch(t){case At.ForceSharp:d=ue.Sharp;break;case At.ForceDoubleSharp:d=ue.DoubleSharp;break;case At.ForceFlat:d=ue.Flat;break;case At.ForceDoubleFlat:d=ue.DoubleFlat;break;default:c?d=u:h&&(d=ue.Natural);break}d!==ue.None?n!=null?n===d&&(d=ue.None):h&&d===u&&(d=ue.None):n!==null&&(n===ue.Natural?d=ue.None:d=ue.Natural)}return d}getAccidental(e,t,s,r,n=null){let a=0,o=ue.None;if(this._bar.staff.isPercussion)a=mt.getPercussionLine(this._bar,e);else{const l=n?n.accidentalMode:At.Default;a=mt.calculateNoteLine(this._bar,e);const u=this._registeredAccidentals.has(a)?this._registeredAccidentals.get(a):null;o=mt.computeAccidental(this._bar.masterBar.keySignature,l,e,t,u);let h=!1;switch(o){case ue.NaturalQuarterNoteUp:case ue.SharpQuarterNoteUp:case ue.FlatQuarterNoteUp:break;default:if(n&&n.isTieDestination&&n.beat.index===0){const c=this._barRenderer.previousRenderer;c&&c.accidentalHelper.getNoteLine(n.tieOrigin)===a&&(h=!0)}h?o=ue.None:o!==ue.None&&this._registeredAccidentals.set(a,o);break}}return n?(this._appliedScoreLines.set(n.id,a),this._notesByValue.set(e,n)):this._appliedScoreLinesByValue.set(e,a),(this.minLine===-1e3||this.minLine<a)&&(this.minLine=a,this.minLineBeat=s),(this.maxLine===-1e3||this.maxLine>a)&&(this.maxLine=a,this.maxLineBeat=s),r||this.registerLine(s,a),o}registerLine(e,t){let s;this._beatLines.has(e.id)?s=this._beatLines.get(e.id):(s=new CO,this._beatLines.set(e.id,s)),(s.minLine===-1e3||t<s.minLine)&&(s.minLine=t),(s.minLine===-1e3||t>s.maxLine)&&(s.maxLine=t)}getMaxLine(e){return this._beatLines.has(e.id)?this._beatLines.get(e.id).maxLine:0}getMinLine(e){return this._beatLines.has(e.id)?this._beatLines.get(e.id).minLine:0}static calculateNoteLine(e,t){let s=t,r=e.masterBar.keySignature,n=e.clef,a=s%12,o=(s/12|0)-1,l=mt.OctaveSteps[n];l-=o*mt.StepsPerOctave;let u=et.keySignatureIsSharp(r)||et.keySignatureIsNatural(r)?mt.SharpNoteSteps:mt.FlatNoteSteps;return l-=u[a],l}getNoteLine(e){return this._appliedScoreLines.get(e.id)}getNoteLineForValue(e,t=!1){return this._appliedScoreLinesByValue.has(e)?this._appliedScoreLinesByValue.get(e):t&&this._notesByValue.has(e)?this.getNoteLine(this._notesByValue.get(e)):0}}mt.KeySignatureLookup=[[!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0],[!0,!0,!0,!0,!0,!1,!0,!0,!0,!0,!0,!0],[!1,!0,!0,!0,!0,!1,!0,!0,!0,!0,!0,!0],[!1,!0,!0,!0,!0,!1,!1,!1,!0,!0,!0,!0],[!1,!1,!1,!0,!0,!1,!1,!1,!0,!0,!0,!0],[!1,!1,!1,!0,!0,!1,!1,!1,!1,!1,!0,!0],[!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!0,!0],[!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1],[!1,!1,!1,!1,!1,!0,!0,!1,!1,!1,!1,!1],[!0,!0,!1,!1,!1,!0,!0,!1,!1,!1,!1,!1],[!0,!0,!1,!1,!1,!0,!0,!0,!0,!1,!1,!1],[!0,!0,!0,!0,!1,!0,!0,!0,!0,!1,!1,!1],[!0,!0,!0,!0,!1,!0,!0,!0,!0,!0,!0,!1],[!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!1],[!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0]];mt.AccidentalNotes=[!1,!0,!1,!0,!1,!1,!0,!1,!0,!1,!0,!1];mt.StepsPerOctave=7;mt.OctaveSteps=[38,32,30,26,38];mt.SharpNoteSteps=[0,0,1,1,2,3,3,4,4,5,5,6];mt.FlatNoteSteps=[0,1,1,2,2,3,4,4,5,5,6,6];class PO{constructor(){this.staffId="",this.up=0,this.down=0}}class MO{constructor(){this.startBeat=null,this.startX=0,this.startY=0,this.endBeat=null,this.endX=0,this.endY=0}calcY(e){return this.startX===this.endX?this.startY:(this.endY-this.startY)/(this.endX-this.startX)*(e-this.startX)+this.startY}}class dr{get isRestBeamHelper(){return this.beats.length===1&&this.beats[0].isRest}hasLine(e,t){return e&&this.beatHasLine(t)||!e&&this.beats.length===1&&this.beatHasLine(t)}beatHasLine(e){return e.duration>N.Whole}hasFlag(e,t){return e&&this.beatHasFlag(t)||!e&&this.beats.length===1&&this.beatHasFlag(this.beats[0])}beatHasFlag(e){return!e.isRest&&(e.duration>N.Quarter||e.graceType!==he.None)}constructor(e,t){this._beatLineXPositions=new Map,this._firstNonRestBeat=null,this._lastNonRestBeat=null,this.voice=null,this.beats=[],this.shortestDuration=N.QuadrupleWhole,this.hasTuplet=!1,this.slashBeats=[],this._firstBeatLowestNoteCompareValue=-1,this._firstBeatHighestNoteCompareValue=-1,this._lastBeatLowestNoteCompareValue=-1,this._lastBeatHighestNoteCompareValue=-1,this.lowestNoteInHelper=null,this._lowestNoteCompareValueInHelper=-1,this.highestNoteInHelper=null,this._highestNoteCompareValueInHelper=-1,this.invertBeamDirection=!1,this.preferredBeamDirection=null,this.isGrace=!1,this.minRestLine=null,this.beatOfMinRestLine=null,this.maxRestLine=null,this.beatOfMaxRestLine=null,this.direction=R.Up,this.drawingInfos=new Map,this._staff=e,this._renderer=t,this.beats=[]}getBeatLineX(e,t){return t=t??this.direction,this.hasBeatLineX(e)?t===R.Up?this._beatLineXPositions.get(e.index).up:this._beatLineXPositions.get(e.index).down:0}hasBeatLineX(e){return this._beatLineXPositions.has(e.index)}registerBeatLineX(e,t,s,r){let n=this.getOrCreateBeatPositions(t);n.staffId=e,n.up=s,n.down=r;for(const a of this.drawingInfos.values())a.startBeat==t?a.startX=this.getBeatLineX(t):a.endBeat==t&&(a.endX=this.getBeatLineX(t))}getOrCreateBeatPositions(e){return this._beatLineXPositions.has(e.index)||this._beatLineXPositions.set(e.index,new PO),this._beatLineXPositions.get(e.index)}finish(){this.direction=this.calculateDirection()}calculateDirection(){let e=null;if(this.voice?this.preferredBeamDirection!==null?e=this.preferredBeamDirection:this.voice.index>0?e=this.invert(R.Down):this.voice.bar.isMultiVoice?e=this.invert(R.Up):this.beats[0].graceType!==he.None&&(e=this.invert(R.Up)):e=R.Up,this.highestNoteInHelper&&this.lowestNoteInHelper){let t=this._renderer.getNoteY(this.highestNoteInHelper,q.Center),s=this._renderer.getNoteY(this.lowestNoteInHelper,q.Center);if(e===null){const r=(t+s)/2;e=this.invert(this._renderer.middleYPosition<r?R.Up:R.Down)}this._renderer.completeBeamingHelper(this)}else e=this.invert(R.Up),this._renderer.completeBeamingHelper(this);return e}static computeLineHeightsForRest(e){switch(e){case N.QuadrupleWhole:return[2,2];case N.DoubleWhole:return[2,2];case N.Whole:return[0,1];case N.Half:return[1,0];case N.Quarter:return[3,3];case N.Eighth:return[2,2];case N.Sixteenth:return[2,4];case N.ThirtySecond:return[4,4];case N.SixtyFourth:return[4,6];case N.OneHundredTwentyEighth:return[6,6];case N.TwoHundredFiftySixth:return[6,8]}return[0,0]}applyRest(e,t){if(this._lastNonRestBeat&&e.index>=this._lastNonRestBeat.index||this._firstNonRestBeat&&e.index<=this._firstNonRestBeat.index)return;let s=t,r=t;const n=dr.computeLineHeightsForRest(e.duration);s-=n[0],r+=n[1];const a=this.minRestLine,o=this.maxRestLine;(a===null||a>s)&&(this.minRestLine=s,this.beatOfMinRestLine=e),(o===null||o<r)&&(this.maxRestLine=r,this.beatOfMaxRestLine=e)}invert(e){if(!this.invertBeamDirection)return e;switch(e){case R.Down:return R.Up;default:return R.Down}}checkBeat(e){e.invertBeamDirection&&(this.invertBeamDirection=!0),this.voice||(this.voice=e.voice);let t=!1;if(this.beats.length===0)t=!0;else switch(this.beats[this.beats.length-1].beamingMode){case cr.Auto:t=dr.canJoin(this.beats[this.beats.length-1],e);break;case cr.ForceSplitToNext:t=!1;break;case cr.ForceMergeWithNext:t=!0;break}return t&&(this.preferredBeamDirection==null&&e.preferredBeamDirection!==null&&(this.preferredBeamDirection=e.preferredBeamDirection),e.hasTuplet&&(this.hasTuplet=!0),e.graceType!==he.None&&(this.isGrace=!0),e.isRest?this.beats.length===0&&this.beats.push(e):(this.isRestBeamHelper&&(this.beats=[]),this.beats.push(e),this.checkNote(e.minNote),this.checkNote(e.maxNote),this.shortestDuration<e.duration&&(this.shortestDuration=e.duration),this._firstNonRestBeat||(this._firstNonRestBeat=e),this._lastNonRestBeat=e),e.slashed&&this.slashBeats.push(e)),t}checkNote(e){if(!e)return;let t,s;this.voice&&e.isPercussion?(t=-mt.getPercussionLine(this.voice.bar,mt.getNoteValue(e)),s=t):(t=mt.getNoteValue(e),s=t,e.harmonicType!==fe.None&&e.harmonicType!==fe.Natural&&(s=e.realValue-this._staff.displayTranspositionPitch)),this.beats.length===1&&this.beats[0]===e.beat&&((this._firstBeatLowestNoteCompareValue===-1||t<this._firstBeatLowestNoteCompareValue)&&(this._firstBeatLowestNoteCompareValue=t),(this._firstBeatHighestNoteCompareValue===-1||s>this._firstBeatHighestNoteCompareValue)&&(this._firstBeatHighestNoteCompareValue=s)),(this._lastBeatLowestNoteCompareValue===-1||t<this._lastBeatLowestNoteCompareValue)&&(this._lastBeatLowestNoteCompareValue=t),(this._lastBeatHighestNoteCompareValue===-1||s>this._lastBeatHighestNoteCompareValue)&&(this._lastBeatHighestNoteCompareValue=s),(!this.lowestNoteInHelper||t<this._lowestNoteCompareValueInHelper)&&(this.lowestNoteInHelper=e,this._lowestNoteCompareValueInHelper=t),(!this.highestNoteInHelper||s>this._highestNoteCompareValueInHelper)&&(this.highestNoteInHelper=e,this._highestNoteCompareValueInHelper=s)}static canJoin(e,t){if(!e||!t||e.graceType!==t.graceType||e.graceType===he.BendGrace||t.graceType===he.BendGrace)return!1;if(e.graceType!==he.None&&t.graceType!==he.None)return!0;let s=e.voice.bar,r=t.voice.bar;if(s!==r)return!1;let n=e.playbackStart,a=t.playbackStart;if(!dr.canJoinDuration(e.duration)||!dr.canJoinDuration(t.duration))return n===a;if(e.tupletGroup!==t.tupletGroup)return!1;if(e.hasTuplet&&t.hasTuplet&&e.tupletGroup===t.tupletGroup&&e.tupletGroup.isFull)return!0;let o=ke.QuarterTime;switch(s.masterBar.timeSignatureDenominator){case 8:s.masterBar.timeSignatureNumerator%3===0&&(o+=ke.QuarterTime/2|0);break}let l=(o+n)/o|0|0,u=(o+a)/o|0|0;return l===u}static canJoinDuration(e){switch(e){case N.Whole:case N.Half:case N.Quarter:return!1;default:return!0}}static isFullBarJoin(e,t,s){return et.getIndex(e.duration)-2-s>0&&et.getIndex(t.duration)-2-s>0}get beatOfLowestNote(){return this.lowestNoteInHelper.beat}get beatOfHighestNote(){return this.highestNoteInHelper.beat}isPositionFrom(e,t){return this._beatLineXPositions.has(t.index)?this._beatLineXPositions.get(t.index).staffId===e||!this._beatLineXPositions.get(t.index).staffId:!0}}class EO{constructor(e,t){this.topY=0,this.bottomY=0,this.topY=e,this.bottomY=t}}class LO{constructor(e){this.topY=-1e3,this.bottomY=-1e3,this.slots=[],this.beat=e}addSlot(e,t){if(this.slots.push(new EO(e,t)),this.topY===-1e3)this.topY=e,this.bottomY=t;else{const s=Math.min(e,t),r=Math.max(e,t);s<this.topY&&(this.topY=s),r>this.bottomY&&(this.bottomY=r)}}}class DO{constructor(){this.reservedLayoutAreasByDisplayTime=new Map,this.restDurationsByDisplayTime=new Map}getBeatMinMaxY(){let e=-1e3,t=-1e3;for(const s of this.reservedLayoutAreasByDisplayTime.values())e===-1e3?(e=s.topY,t=s.bottomY):(e>s.topY&&(e=s.topY),t<s.bottomY&&(t=s.bottomY));return e===-1e3?[0,0]:[e,t]}reserveBeatSlot(e,t,s){t!=s&&(this.reservedLayoutAreasByDisplayTime.has(e.displayStart)||this.reservedLayoutAreasByDisplayTime.set(e.displayStart,new LO(e)),this.reservedLayoutAreasByDisplayTime.get(e.displayStart).addSlot(t,s),e.isRest&&this.registerRest(e))}registerRest(e){this.restDurationsByDisplayTime.has(e.displayStart)||this.restDurationsByDisplayTime.set(e.displayStart,new Map),this.restDurationsByDisplayTime.get(e.displayStart).has(e.playbackDuration)||this.restDurationsByDisplayTime.get(e.displayStart).set(e.playbackDuration,e.id)}applyRestCollisionOffset(e,t,s){if(e.voice.index>0&&this.reservedLayoutAreasByDisplayTime.has(e.playbackStart)){const r=dr.computeLineHeightsForRest(e.duration).map(h=>h*s);let n=t-r[0],a=t+r[1],o=n;const l=this.reservedLayoutAreasByDisplayTime.get(e.playbackStart);let u=!1;for(const h of l.slots)if(n>=h.topY&&n<=h.bottomY||a>=h.topY&&a<=h.bottomY){u=!0;break}if(u){e.voice.index==1?o=l.topY-r[1]-r[0]:o=l.bottomY;let h=o+r[0]+r[1];const c=s*2;let d=Math.ceil(Math.abs(o-n)/c);return l.addSlot(o,h),o<n?d*-c:d*c}}return 0}}class AO{constructor(e){this.beamHelpers=[],this.beamHelperLookup=[],this.preferredBeamDirection=null,this._renderer=e,this.collisionHelper=new DO}initialize(){var e=this._renderer,t=this._renderer.bar;let s=null,r=null;for(let n=0,a=t.voices.length;n<a;n++){let o=t.voices[n];this.beamHelpers.push([]),this.beamHelperLookup.push(new Map);for(let l=0,u=o.beats.length;l<u;l++){let h=o.beats[l],c;h.graceType!==he.None?c=r:(c=s,r=null),(!c||!c.checkBeat(h))&&(c&&c.finish(),c=new dr(t.staff,e),c.preferredBeamDirection=this.preferredBeamDirection,c.checkBeat(h),h.graceType!==he.None?r=c:s=c,this.beamHelpers[o.index].push(c)),this.beamHelperLookup[o.index].set(h.index,c)}s&&s.finish(),r&&r.finish(),s=null,r=null}}getBeamingHelperForBeat(e){return this.beamHelperLookup[e.voice.index].get(e.index)}}class oi extends vs{constructor(e,t,s){super(e,t),this._textRow=0,this._fretRow=0,this._firstFretSpacing=0,this._chord=s}doLayout(){super.doLayout();const e=this.scale;let t=this.renderer.resources;this._textRow=t.effectFont.size*1.5*e,this._fretRow=t.effectFont.size*1.5*e,this._chord.firstFret>1?this._firstFretSpacing=oi.FretSpacing*e:this._firstFretSpacing=0,this.height=this._textRow+this._fretRow+(oi.Frets-1)*oi.FretSpacing*e+2*oi.Padding*e,this.width=this._firstFretSpacing+(this._chord.staff.tuning.length-1)*oi.StringSpacing*e+2*oi.Padding*e}paint(e,t,s){e+=this.x+oi.Padding*this.scale+this._firstFretSpacing,t+=this.y;let r=this.width-2*oi.Padding*this.scale+this.scale-this._firstFretSpacing,n=oi.StringSpacing*this.scale,a=oi.FretSpacing*this.scale,o=this.renderer.resources,l=oi.CircleRadius*this.scale,u=s.textAlign,h=s.textBaseline;s.font=o.effectFont,s.textAlign=de.Center,s.textBaseline=we.Top,this._chord.showName&&s.fillText(this._chord.name,e+this.width/2,t+o.effectFont.size/2),t+=this._textRow,e+=n/2,s.font=o.fretboardNumberFont,s.textBaseline=we.Middle;for(let d=0;d<this._chord.staff.tuning.length;d++){let f=e+d*n,p=t+this._fretRow/2,g=this._chord.strings[this._chord.staff.tuning.length-d-1];g<0?s.fillMusicFontSymbol(f,p,this.scale,S.FretboardX,!0):g===0?s.fillMusicFontSymbol(f,p,this.scale,S.FretboardO,!0):(g-=this._chord.firstFret-1,s.fillText(g.toString(),f,p))}t+=this._fretRow;for(let d=0;d<this._chord.staff.tuning.length;d++){let f=e+d*n;s.fillRect(f,t,1,a*oi.Frets+this.scale)}this._chord.firstFret>1&&(s.textAlign=de.Left,s.fillText(this._chord.firstFret.toString(),e-this._firstFretSpacing,t+a/2)),s.fillRect(e,t-this.scale,r,2*this.scale);for(let d=0;d<=oi.Frets;d++){let f=t+d*a;s.fillRect(e,f,r,this.scale)}let c=new Map;for(let d of this._chord.barreFrets){let f=[-1,-1];c.set(d-this._chord.firstFret,f)}for(let d=0;d<this._chord.strings.length;d++){let f=this._chord.strings[d];if(f>0){if(f-=this._chord.firstFret,c.has(f)){let b=c.get(f);(b[0]===-1||d<b[0])&&(b[0]=d),(b[1]===-1||d>b[1])&&(b[1]=d)}let p=t+f*a+a/2+.5*this.scale,g=e+(this._chord.strings.length-d-1)*n;s.fillCircle(g,p,l)}}for(const[d,f]of c){let p=t+d*a+a/2+.5*this.scale,g=e+(this._chord.strings.length-f[1]-1)*n,b=e+(this._chord.strings.length-f[0]-1)*n;s.fillRect(g,p-l,b-g,l*2)}s.textAlign=u,s.textBaseline=h}}oi.Padding=5;oi.Frets=5;oi.CircleRadius=2.5;oi.StringSpacing=10;oi.FretSpacing=12;class aS extends qs{constructor(e,t,s=de.Center){super(e,t),this._glyphWidth=0,this.glyphs=[],this._align=s}doLayout(){let e=0;switch(this._align){case de.Left:e=0;break;case de.Center:e=(this.width-this._glyphWidth)/2;break;case de.Right:e=this.width-this._glyphWidth;break}for(let t of this.glyphs)t.x=e,e+=t.width}addGlyphToRow(e){this.glyphs.push(e),this._glyphWidth+=e.width,e.height>this.height&&(this.height=e.height)}}class Vu extends qs{constructor(e,t,s=de.Center){super(e,t),this._rows=[],this.height=0,this.glyphs=[],this._align=s}doLayout(){let e=0,t=0,s=Vu.Padding*this.scale;this._rows=[];let r=new aS(e,t,this._align);r.width=this.width;for(let n of this.glyphs)e+n.width<this.width?(r.addGlyphToRow(n),e+=n.width):(r.isEmpty||(r.doLayout(),this._rows.push(r),t+=r.height+s),e=0,r=new aS(e,t,this._align),r.width=this.width,r.addGlyphToRow(n),e+=n.width);r.isEmpty||(r.doLayout(),this._rows.push(r),t+=r.height+s),this.height=t}paint(e,t,s){for(let r of this._rows)r.paint(e+this.x,t+this.y,s)}}Vu.Padding=3;class IO extends Vu{constructor(e,t){super(e,t)}addChord(e){if(e.strings.length>0){let t=new oi(0,0,e);t.renderer=this.renderer,t.doLayout(),this.glyphs.push(t)}}}class ui extends vs{constructor(e,t,s,r,n=de.Left,a=null){super(e,t),this._lineHeights=null,this._lines=s.split(`
`),this.font=r,this.textAlign=n,this.textBaseline=a}doLayout(){super.doLayout(),this._lineHeights=[];const e=this.renderer.scoreRenderer.canvas;for(const t of this._lines){e.font=this.font;const s=e.measureText(t),r=s.height*this.scale;this._lineHeights.push(r),this.height+=r,this.width=Math.max(this.width,s.width)}}paint(e,t,s){let r=s.color;s.color=r,s.font=this.font;let n=s.textAlign,a=s.textBaseline;s.textAlign=this.textAlign,this.textBaseline!==null&&(s.textBaseline=this.textBaseline);let o=t+this.y;for(let l=0;l<this._lines.length;l++)s.fillText(this._lines[l],e+this.x,o),o+=this._lineHeights[l];s.textAlign=n,s.textBaseline=a}}class RO{get staveId(){return this._factory.staffId}constructor(e,t,s){this._sharedLayoutData=new Map,this.barRenderers=[],this.x=0,this.y=0,this.height=0,this.index=0,this.staffIndex=0,this.trackIndex=0,this.staveTop=0,this.topSpacing=0,this.bottomSpacing=0,this.staveBottom=0,this.isFirstInAccolade=!1,this.isLastInAccolade=!1,this._factory=s,this.trackIndex=e,this.modelStaff=t}getSharedLayoutData(e,t){return this._sharedLayoutData.has(e)?this._sharedLayoutData.get(e):t}setSharedLayoutData(e,t){this._sharedLayoutData.set(e,t)}get isInAccolade(){return this._factory.isInAccolade}get isRelevantForBoundsLookup(){return this._factory.isRelevantForBoundsLookup}registerStaffTop(e){this.staveTop=e}registerStaffBottom(e){this.staveBottom=e}addBarRenderer(e){e.staff=this,e.index=this.barRenderers.length,e.reLayout(),this.barRenderers.push(e),this.system.layout.registerBarRenderer(this.staveId,e)}addBar(e,t){let s;e?s=this._factory.create(this.system.layout.renderer,e):s=new pt(this.system.layout.renderer,e),s.staff=this,s.index=this.barRenderers.length,s.layoutingInfo=t,s.doLayout(),s.registerLayoutingInfo();const r=s.barDisplayWidth;r>0&&this.system.layout.systemsLayoutMode==fs.FromModelWithWidths&&(s.width=r),this.barRenderers.push(s),e&&this.system.layout.registerBarRenderer(this.staveId,s)}revertLastBar(){let e=this.barRenderers[this.barRenderers.length-1];this.barRenderers.splice(this.barRenderers.length-1,1),this.system.layout.unregisterBarRenderer(this.staveId,e);for(const t of this.barRenderers)t.applyLayoutingInfo();return e}scaleToWidth(e){this._sharedLayoutData=new Map;let t=this.topOverflow,s=0;switch(this.system.layout.systemsLayoutMode){case fs.Automatic:let n=(e-this.system.computedWidth)/this.barRenderers.length;for(const o of this.barRenderers){o.x=s,o.y=this.topSpacing+t;let l=o.computedWidth+n;o.scaleToWidth(l),s+=o.width}break;case fs.FromModelWithScale:e-=this.system.accoladeWidth;const a=this.system.totalBarDisplayScale;for(const o of this.barRenderers){o.x=s,o.y=this.topSpacing+t;const l=o.barDisplayScale*e/a;o.scaleToWidth(l),s+=o.width}break;case fs.FromModelWithWidths:for(const o of this.barRenderers){o.x=s,o.y=this.topSpacing+t;const l=o.barDisplayWidth;l>0?o.scaleToWidth(l):o.scaleToWidth(o.computedWidth),s+=o.width}break}}get topOverflow(){let e=0;for(let t=0,s=this.barRenderers.length;t<s;t++){let r=this.barRenderers[t];r.topOverflow>e&&(e=r.topOverflow)}return e}get bottomOverflow(){let e=0;for(let t=0,s=this.barRenderers.length;t<s;t++){let r=this.barRenderers[t];r.bottomOverflow>e&&(e=r.bottomOverflow)}return e}finalizeStaff(){const e=this.system.layout.renderer.settings;this.topSpacing=this._factory.getStaffPaddingTop(this)*e.display.scale,this.bottomSpacing=this._factory.getStaffPaddingBottom(this)*e.display.scale,this.height=0;let t=!1,s=this.topOverflow;for(let r=0;r<this.barRenderers.length;r++)this.barRenderers[r].y=this.topSpacing+s,this.height=Math.max(this.height,this.barRenderers[r].height),this.barRenderers[r].finalizeRenderer()&&(t=!0);if(t){s=this.topOverflow;for(let r=0;r<this.barRenderers.length;r++)this.barRenderers[r].y=this.topSpacing+s,this.height=Math.max(this.height,this.barRenderers[r].height),this.barRenderers[r].finalizeRenderer()}this.height>0&&(this.height+=this.topSpacing+s+this.bottomOverflow+this.bottomSpacing)}paint(e,t,s,r,n){if(!(this.height===0||n===0))for(let a=r,o=Math.min(r+n,this.barRenderers.length);a<o;a++)this.barRenderers[a].paint(e+this.x,t+this.y,s)}}class oS{constructor(){this.timePosition=0,this.longestDuration=0,this.smallestDuration=0,this.force=0,this.springConstant=0,this.preBeatWidth=0,this.graceBeatWidth=0,this.postSpringWidth=0,this.allDurations=new Set}get springWidth(){return this.preSpringWidth+this.postSpringWidth}get preSpringWidth(){return this.preBeatWidth+this.graceBeatWidth}}class zo{constructor(){this._timeSortedSprings=[],this._xMin=0,this._minTime=-1,this._onTimePositionsForce=0,this._onTimePositions=new Map,this._incompleteGraceRodsWidth=0,this.version=0,this.preBeatSizes=new Map,this.onBeatSizes=new Map,this.onBeatCenterX=new Map,this.preBeatSize=0,this.postBeatSize=0,this.voiceSize=0,this.minStretchForce=0,this.totalSpringConstant=0,this.incompleteGraceRods=new Map,this.allGraceRods=new Map,this.springs=new Map,this.height=0}updateVoiceSize(e){e>this.voiceSize&&(this.voiceSize=e,this.version++)}setPreBeatSize(e,t){(!this.preBeatSizes.has(e.id)||this.preBeatSizes.get(e.id)<t)&&(this.preBeatSizes.set(e.id,t),this.version++)}getPreBeatSize(e){return this.preBeatSizes.has(e.id)?this.preBeatSizes.get(e.id):0}setOnBeatSize(e,t){(!this.onBeatSizes.has(e.id)||this.onBeatSizes.get(e.id)<t)&&(this.onBeatSizes.set(e.id,t),this.version++)}getOnBeatSize(e){return this.onBeatSizes.has(e.id)?this.onBeatSizes.get(e.id):0}getBeatCenterX(e){return this.onBeatCenterX.has(e.id)?this.onBeatCenterX.get(e.id):0}setBeatCenterX(e,t){(!this.onBeatCenterX.has(e.id)||this.onBeatCenterX.get(e.id)<t)&&(this.onBeatCenterX.set(e.id,t),this.version++)}updateMinStretchForce(e){this.minStretchForce<e&&(this.minStretchForce=e)}addSpring(e,t,s,r,n){this.version++;let a;if(this.springs.has(e))a=this.springs.get(e),a.postSpringWidth<n&&(a.postSpringWidth=n),a.graceBeatWidth<s&&(a.graceBeatWidth=s),a.preBeatWidth<r&&(a.preBeatWidth=r),t<a.smallestDuration&&(a.smallestDuration=t),t>a.longestDuration&&(a.longestDuration=t),a.allDurations.add(t);else{if(a=new oS,a.timePosition=e,a.allDurations.add(t),this._timeSortedSprings.length>0){let u=this._timeSortedSprings[this._timeSortedSprings.length-1];for(const h of u.allDurations)u.timePosition+h}a.longestDuration=t,a.postSpringWidth=n,a.graceBeatWidth=s,a.preBeatWidth=r,this.springs.set(e,a);let o=this._timeSortedSprings,l=o.length-1;for(;l>0&&o[l].timePosition>e;)l--;this._timeSortedSprings.splice(l+1,0,a)}return(this._minTime===-1||this._minTime>e)&&(this._minTime=e),a}addBeatSpring(e,t,s){let r=e.absoluteDisplayStart;if(e.graceType!==he.None){const n=e.graceGroup.id;this.allGraceRods.has(n)||this.allGraceRods.set(n,new Array(e.graceGroup.beats.length)),!e.graceGroup.isComplete&&!this.incompleteGraceRods.has(n)&&this.incompleteGraceRods.set(n,new Array(e.graceGroup.beats.length));let a=this.allGraceRods.get(n)[e.graceIndex];if(a)a.postSpringWidth<s&&(a.postSpringWidth=s),a.preBeatWidth<t&&(a.preBeatWidth=t);else{const o=new oS;o.timePosition=r,o.postSpringWidth=s,o.preBeatWidth=t,e.graceGroup.isComplete||(this.incompleteGraceRods.get(n)[e.graceIndex]=o),this.allGraceRods.get(n)[e.graceIndex]=o}}else{let n=0;if(e.graceGroup&&this.allGraceRods.has(e.graceGroup.id))for(const a of this.allGraceRods.get(e.graceGroup.id))n+=a.springWidth;this.addSpring(r,e.displayDuration,n,t,s)}}finish(){for(const[e,t]of this.allGraceRods){let s=0;if(this.incompleteGraceRods.has(e))for(const r of t)s+=r.preBeatWidth,r.graceBeatWidth=s,s+=r.postSpringWidth;else for(let r=t.length-1;r>=0;r--)t[r].graceBeatWidth=s,s-=t[r].preBeatWidth+t[r].postSpringWidth}this._incompleteGraceRodsWidth=0;for(const e of this.incompleteGraceRods.values())for(const t of e)this._incompleteGraceRodsWidth+=t.preBeatWidth+t.postSpringWidth;this.calculateSpringConstants(),this.version++}calculateSpringConstants(){this._xMin=0;let e=this.springs;for(const r of e.values())r.springWidth<this._xMin&&(this._xMin=r.springWidth);let t=0,s=this._timeSortedSprings;if(s.length===0){this.totalSpringConstant=-1,this.minStretchForce=-1;return}for(let r=0;r<s.length;r++){let n=s[r],a=0;if(r===s.length-1)a=n.longestDuration;else{let o=s[r+1];a=Math.abs(o.timePosition-n.timePosition)}n.springConstant=this.calculateSpringConstant(n,a),t+=1/n.springConstant}this.totalSpringConstant=1/t,this.minStretchForce=0;for(let r=0;r<s.length;r++){let n=s[r],a=0;if(r===s.length-1)a=n.postSpringWidth;else{let l=s[r+1];a=n.postSpringWidth+l.preSpringWidth}r===0&&(a+=n.preSpringWidth);let o=a*n.springConstant;this.updateMinStretchForce(o)}}paint(e,t,s){}calculateSpringConstant(e,t){t<=0&&(t=ke.toTicks(N.SixtyFourth)),e.smallestDuration===0&&(e.smallestDuration=t);let s=e.smallestDuration,r=1+.85*Math.log2(t/zo.MinDuration);return s/t*(1/(r*zo.MinDurationWidth))}spaceToForce(e){return this.totalSpringConstant!==-1?(this._timeSortedSprings.length>0&&(e-=this._timeSortedSprings[0].preSpringWidth),e-=this._incompleteGraceRodsWidth,Math.max(e,0)*this.totalSpringConstant):-1}calculateVoiceWidth(e){let t=0;return this.totalSpringConstant!==-1&&(t=this.calculateWidth(e,this.totalSpringConstant)),this._timeSortedSprings.length>0&&(t+=this._timeSortedSprings[0].preSpringWidth),t+=this._incompleteGraceRodsWidth,t}calculateWidth(e,t){return e/t}buildOnTimePositions(e){if(this.totalSpringConstant===-1)return new Map;if(et.isAlmostEqualTo(this._onTimePositionsForce,e)&&this._onTimePositions)return this._onTimePositions;this._onTimePositionsForce=e;let t=new Map;this._onTimePositions=t;let s=this._timeSortedSprings;if(s.length===0)return t;let r=s[0].preSpringWidth;for(let n=0;n<s.length;n++)t.set(s[n].timePosition,r),r+=this.calculateWidth(e,s[n].springConstant);return t}}zo.MinDuration=30;zo.MinDurationWidth=7;class OO{constructor(){this.width=0,this.isLinkedToPrevious=!1,this.canWrap=!0,this.renderers=[]}}class FO{constructor(e,t){this.staves=[],this.stavesRelevantForBoundsLookup=[],this.firstStaffInAccolade=null,this.lastStaffInAccolade=null,this.staffSystem=e,this.track=t}addStaff(e){this.staves.push(e),e.isRelevantForBoundsLookup&&this.stavesRelevantForBoundsLookup.push(e)}}class bu{constructor(e){this._allStaves=[],this._firstStaffInAccolade=null,this._lastStaffInAccolade=null,this._accoladeSpacingCalculated=!1,this.x=0,this.y=0,this.index=0,this.accoladeWidth=0,this.isFull=!1,this.width=0,this.computedWidth=0,this.totalBarDisplayScale=0,this.isLast=!1,this.masterBarsRenderers=[],this.staves=[],this.layout=e,this.topPadding=e.renderer.settings.display.systemPaddingTop,this.bottomPadding=e.renderer.settings.display.systemPaddingBottom}get firstBarIndex(){return this.masterBarsRenderers[0].masterBar.index}get lastBarIndex(){return this.masterBarsRenderers[this.masterBarsRenderers.length-1].masterBar.index}addMasterBarRenderers(e,t){if(e.length===0)return null;this.masterBarsRenderers.push(t),this.calculateAccoladeSpacing(e),t.layoutingInfo.preBeatSize=0;let s=0;for(let r=0,n=this.staves.length;r<n;r++){let a=this.staves[r];for(let o=0,l=a.staves.length;o<l;o++){let u=a.staves[o],h=t.renderers[s++];u.addBarRenderer(h)}}return this.updateWidthFromLastBar(),t}addBars(e,t){if(e.length===0)return null;let s=new OO;s.layoutingInfo=new zo,s.masterBar=e[0].score.masterBars[t],this.masterBarsRenderers.push(s),this.calculateAccoladeSpacing(e);let r=s.layoutingInfo;for(let n of this.staves)for(let a of n.staves){let o=n.track.staves[a.modelStaff.index].bars[t];a.addBar(o,r);let l=a.barRenderers[a.barRenderers.length-1];s.renderers.push(l),l.isLinkedToPrevious&&(s.isLinkedToPrevious=!0),l.canWrap||(s.canWrap=!1)}return r.finish(),s.width=this.updateWidthFromLastBar(),s}revertLastBar(){if(this.masterBarsRenderers.length>1){let e=this.masterBarsRenderers[this.masterBarsRenderers.length-1];this.masterBarsRenderers.splice(this.masterBarsRenderers.length-1,1);let t=0,s=0;for(let r=0,n=this._allStaves.length;r<n;r++){let o=this._allStaves[r].revertLastBar();const l=o.computedWidth;l>t&&(t=l);const u=o.barDisplayScale;u>s&&(s=u)}return this.width-=t,this.computedWidth-=t,this.totalBarDisplayScale-=s,e}return null}updateWidthFromLastBar(){let e=0,t=0;for(let s=0,r=this._allStaves.length;s<r;s++){let n=this._allStaves[s];const a=n.barRenderers[n.barRenderers.length-1];a.applyLayoutingInfo(),a.computedWidth>e&&(e=a.computedWidth);const o=a.barDisplayScale;o>t&&(t=o)}return this.width+=e,this.computedWidth+=e,this.totalBarDisplayScale+=t,e}calculateAccoladeSpacing(e){const t=this.layout.renderer.settings;if(!this._accoladeSpacingCalculated){if(this._accoladeSpacingCalculated=!0,this.index===0&&this.layout.renderer.settings.notation.isNotationElementVisible(me.TrackNames)){let s=this.layout.renderer.canvas,r=t.display.resources.effectFont;s.font=r;for(let n of e)this.accoladeWidth=Math.ceil(Math.max(this.accoladeWidth,s.measureText(n.shortName).width));this.accoladeWidth*=this.layout.scale,this.accoladeWidth+=t.display.systemLabelPaddingLeft*this.layout.scale,this.accoladeWidth+=t.display.systemLabelPaddingRight*this.layout.scale}else this.accoladeWidth=0;this.accoladeWidth+=bu.AccoladeBarSize*this.layout.scale,this.accoladeWidth+=t.display.accoladeBarPaddingRight*this.layout.scale,this.width+=this.accoladeWidth,this.computedWidth+=this.accoladeWidth}}getStaffTrackGroup(e){for(let t=0,s=this.staves.length;t<s;t++){let r=this.staves[t];if(r.track===e)return r}return null}addStaff(e,t){let s=this.getStaffTrackGroup(e);s||(s=new FO(this,e),this.staves.push(s)),t.staffTrackGroup=s,t.system=this,t.index=this._allStaves.length,this._allStaves.push(t),s.addStaff(t),t.isInAccolade&&(this._firstStaffInAccolade||(this._firstStaffInAccolade=t,t.isFirstInAccolade=!0),s.firstStaffInAccolade||(s.firstStaffInAccolade=t),this._lastStaffInAccolade||(this._lastStaffInAccolade=t,t.isLastInAccolade=!0),this._lastStaffInAccolade&&(this._lastStaffInAccolade.isLastInAccolade=!1),this._lastStaffInAccolade=t,this._lastStaffInAccolade.isLastInAccolade=!0,s.lastStaffInAccolade=t)}get height(){return this._allStaves.length===0?0:this._allStaves[this._allStaves.length-1].y+this._allStaves[this._allStaves.length-1].height+this.topPadding+this.bottomPadding}scaleToWidth(e){for(let t=0,s=this._allStaves.length;t<s;t++)this._allStaves[t].scaleToWidth(e);this.width=e}paint(e,t,s){t+=this.topPadding,this.paintPartial(e+this.x,t+this.y,s,0,this.masterBarsRenderers.length)}paintPartial(e,t,s,r,n){for(let o=0,l=this._allStaves.length;o<l;o++)this._allStaves[o].paint(e,t,s,r,n);let a=this.layout.renderer.settings.display.resources;if(this.staves.length>0&&r===0){if(s.color=a.barSeparatorColor,this._firstStaffInAccolade&&this._lastStaffInAccolade){let l=t+this._firstStaffInAccolade.y+this._firstStaffInAccolade.staveTop+this._firstStaffInAccolade.topSpacing+this._firstStaffInAccolade.topOverflow,u=t+this._lastStaffInAccolade.y+this._lastStaffInAccolade.topSpacing+this._lastStaffInAccolade.topOverflow+this._lastStaffInAccolade.staveBottom,h=e+this._firstStaffInAccolade.x;s.beginPath(),s.moveTo(h,l),s.lineTo(h,u),s.stroke()}s.font=a.effectFont;const o=this.layout.renderer.settings;for(let l=0,u=this.staves.length;l<u;l++){let h=this.staves[l];if(h.firstStaffInAccolade&&h.lastStaffInAccolade){let c=t+h.firstStaffInAccolade.y+h.firstStaffInAccolade.staveTop+h.firstStaffInAccolade.topSpacing+h.firstStaffInAccolade.topOverflow,d=t+h.lastStaffInAccolade.y+h.lastStaffInAccolade.topSpacing+h.lastStaffInAccolade.topOverflow+h.lastStaffInAccolade.staveBottom;const f=this.index===0&&this.layout.renderer.settings.notation.isNotationElementVisible(me.TrackNames);let p=e+h.firstStaffInAccolade.x,g=bu.AccoladeBarSize*this.layout.scale,b=o.display.accoladeBarPaddingRight*this.layout.scale,m=c-g*4,y=d+g*4;f&&s.fillText(h.track.shortName,e+o.display.systemLabelPaddingLeft*this.layout.scale,c),s.fillRect(p-b-g,m,g,y-m);let w=p-b-g,x=p+g*2;s.beginPath(),s.moveTo(w,m),s.bezierCurveTo(w,m,w,m,x,m-g),s.bezierCurveTo(p,m+g,w,m+g,w,m+g),s.closePath(),s.fill(),s.beginPath(),s.moveTo(w,y),s.bezierCurveTo(w,y,p,y,x,y+g),s.bezierCurveTo(p,y-g,w,y-g,w,y-g),s.closePath(),s.fill()}}}}finalizeSystem(){const e=this.layout.renderer.settings;this.index===0&&(this.topPadding=e.display.firstSystemPaddingTop*e.display.scale),this.isLast&&(this.bottomPadding=e.display.lastSystemPaddingBottom*e.display.scale);let t=0;for(let s of this._allStaves)s.x=this.accoladeWidth,s.y=t,s.finalizeStaff(),t+=s.height}buildBoundingsLookup(e,t){if(this.layout.renderer.boundsLookup.isFinished||!this._firstStaffInAccolade||!this._lastStaffInAccolade)return;t+=this.topPadding;let s=this._allStaves[this._allStaves.length-1],r=t+this.y+this._firstStaffInAccolade.y,n=t+this.y+this._lastStaffInAccolade.y+this._lastStaffInAccolade.height,a=t+this.y+this._allStaves[0].y,o=t+this.y+s.y+s.height,l=t+this.y+this._firstStaffInAccolade.y+this._firstStaffInAccolade.topSpacing+this._firstStaffInAccolade.topOverflow+(this._firstStaffInAccolade.barRenderers.length>0?this._firstStaffInAccolade.barRenderers[0].topPadding:0),u=t+this.y+s.y+s.height-s.bottomSpacing-s.bottomOverflow-(s.barRenderers.length>0?s.barRenderers[0].bottomPadding:0),h=n-r,c=u-l,d=o-a,f=this.x+this._firstStaffInAccolade.x,p=new G_;p.visualBounds=new Wi,p.visualBounds.x=e,p.visualBounds.y=t+this.y,p.visualBounds.w=this.width,p.visualBounds.h=this.height-this.topPadding-this.bottomPadding,p.realBounds=new Wi,p.realBounds.x=e,p.realBounds.y=t+this.y,p.realBounds.w=this.width,p.realBounds.h=this.height,this.layout.renderer.boundsLookup.addStaffSystem(p);let g=new Map;for(let b=0;b<this.staves.length;b++)for(let m of this.staves[b].stavesRelevantForBoundsLookup)for(let y of m.barRenderers){let w;g.has(y.bar.masterBar.index)?w=g.get(y.bar.masterBar.index):(w=new W_,w.index=y.bar.masterBar.index,w.isFirstOfLine=y.isFirstOfLine,w.realBounds=new Wi,w.realBounds.x=f+y.x,w.realBounds.y=a,w.realBounds.w=y.width,w.realBounds.h=d,w.visualBounds=new Wi,w.visualBounds.x=f+y.x,w.visualBounds.y=r,w.visualBounds.w=y.width,w.visualBounds.h=h,w.lineAlignedBounds=new Wi,w.lineAlignedBounds.x=f+y.x,w.lineAlignedBounds.y=l,w.lineAlignedBounds.w=y.width,w.lineAlignedBounds.h=c,this.layout.renderer.boundsLookup.addMasterBar(w),g.set(w.index,w)),y.buildBoundingsLookup(w,f,t+this.y+m.y)}}getBarX(e){if(!this._firstStaffInAccolade||this.layout.renderer.tracks.length===0)return 0;let t=this.layout.renderer.tracks[0].staves[0].bars[e];return this.layout.getRendererForBar(this._firstStaffInAccolade.staveId,t).x}}bu.AccoladeBarSize=3;class hr extends qs{constructor(e,t,s,r){super(e,t),this._tuning=s,this._trackLabel=r,this.glyphs=[]}doLayout(){if(!(this.glyphs.length>0)){this.createGlyphs(this._tuning);for(const e of this.glyphs)e.renderer=this.renderer,e.doLayout()}}paint(e,t,s){s.textBaseline=we.Middle,super.paint(e,t,s)}createGlyphs(e){const t=this.renderer.scale,s=this.renderer.resources;this.height=0;const r=15*t;if(this._trackLabel.length>0){const o=new ui(0,this.height,this._trackLabel,s.effectFont,de.Left);o.renderer=this.renderer,o.doLayout(),this.height+=o.height,o.y+=o.height/2,this.addGlyph(o)}const n=new ui(0,this.height,e.name,s.effectFont,de.Left);n.renderer=this.renderer,n.doLayout(),this.height+=n.height,n.y+=n.height/2,this.addGlyph(n);const a=64*t;if(this.renderer.scoreRenderer.canvas.font=s.effectFont,this.width=Math.max(this.renderer.scoreRenderer.canvas.measureText(this._trackLabel).width*t,Math.max(this.renderer.scoreRenderer.canvas.measureText(e.name).width*t,2*a)),!e.isStandard){this.height+=r;const o=hr.CircleNumberScale,l=hr.CircleNumberHeight*o*t;let u=Math.ceil(e.tunings.length/2)|0,h=0,c=this.height;for(let d=0,f=e.tunings.length;d<f;d++){const p=S.GuitarString0+(d+1);this.addGlyph(new Rt(h,c+l/2.5,o,p));const g="= "+H.getTextForTuning(e.tunings[d],!1);this.addGlyph(new ui(h+l+1*t,c,g,s.effectFont,de.Left)),c+=r,d===u-1&&(c=this.height,h+=a)}this.height+=u*r}this.width+=15*t}}hr.CircleNumberHeight=20;hr.CircleNumberScale=.7;class VO extends Vu{constructor(e,t){super(e,t,de.Left)}addTuning(e,t){if(e.tunings.length>0){let s=new hr(0,0,e,t);s.renderer=this.renderer,s.doLayout(),this.glyphs.push(s)}}}class HO{constructor(e,t){this.args=e,this.renderCallback=t}}var fs;(function(i){i[i.Automatic=0]="Automatic",i[i.FromModelWithScale=1]="FromModelWithScale",i[i.FromModelWithWidths=2]="FromModelWithWidths"})(fs||(fs={}));class K_{constructor(e){this._barRendererLookup=new Map,this.width=0,this.height=0,this.scoreInfoGlyphs=new Map,this.chordDiagrams=null,this.tuningGlyph=null,this.systemsLayoutMode=fs.Automatic,this._lazyPartials=new Map,this.firstBarIndex=0,this.lastBarIndex=0,this.renderer=e}resize(){this._lazyPartials.clear(),this.doResize()}layoutAndRender(){this._lazyPartials.clear();let e=this.renderer.score,t=this.renderer.settings.display.startBar;t--,t=Math.min(e.masterBars.length-1,Math.max(0,t)),this.firstBarIndex=t;let s=this.renderer.settings.display.barCount;s<0&&(s=e.masterBars.length),s=t+s-1,s=Math.min(e.masterBars.length-1,Math.max(0,s)),this.lastBarIndex=s,this.createScoreInfoGlyphs(),this.doLayoutAndRender()}registerPartial(e,t){e.height!=0&&(this.renderer.settings.core.enableLazyLoading?(this._lazyPartials.set(e.id,new HO(e,t)),this.renderer.partialLayoutFinished.trigger(e)):(this.renderer.partialLayoutFinished.trigger(e),this.internalRenderLazyPartial(e,t)))}internalRenderLazyPartial(e,t){const s=this.renderer.canvas;s.beginRender(e.width,e.height),t(s),e.renderResult=s.endRender(),this.renderer.partialRenderFinished.trigger(e)}renderLazyPartial(e){if(this._lazyPartials.has(e)){const t=this._lazyPartials.get(e);this.internalRenderLazyPartial(t.args,t.renderCallback)}}createScoreInfoGlyphs(){I.debug("ScoreLayout","Creating score info glyphs");let e=this.renderer.settings.notation,t=this.renderer.score,s=this.renderer.settings.display.resources;this.scoreInfoGlyphs=new Map,t.title&&e.isNotationElementVisible(me.ScoreTitle)&&this.scoreInfoGlyphs.set(me.ScoreTitle,new ui(0,0,t.title,s.titleFont,de.Center)),t.subTitle&&e.isNotationElementVisible(me.ScoreSubTitle)&&this.scoreInfoGlyphs.set(me.ScoreSubTitle,new ui(0,0,t.subTitle,s.subTitleFont,de.Center)),t.artist&&e.isNotationElementVisible(me.ScoreArtist)&&this.scoreInfoGlyphs.set(me.ScoreArtist,new ui(0,0,t.artist,s.subTitleFont,de.Center)),t.album&&e.isNotationElementVisible(me.ScoreAlbum)&&this.scoreInfoGlyphs.set(me.ScoreAlbum,new ui(0,0,t.album,s.subTitleFont,de.Center)),t.music&&t.music===t.words&&e.isNotationElementVisible(me.ScoreWordsAndMusic)?this.scoreInfoGlyphs.set(me.ScoreWordsAndMusic,new ui(0,0,"Music and Words by "+t.words,s.wordsFont,de.Center)):(t.music&&e.isNotationElementVisible(me.ScoreMusic)&&this.scoreInfoGlyphs.set(me.ScoreMusic,new ui(0,0,"Music by "+t.music,s.wordsFont,de.Right)),t.words&&e.isNotationElementVisible(me.ScoreWords)&&this.scoreInfoGlyphs.set(me.ScoreWords,new ui(0,0,"Words by "+t.words,s.wordsFont,de.Left)));const r=new pt(this.renderer,this.renderer.tracks[0].staves[0].bars[0]);for(const[n,a]of this.scoreInfoGlyphs)a.renderer=r,a.doLayout();if(e.isNotationElementVisible(me.GuitarTuning)){let n=[];for(let a of this.renderer.tracks)for(let o of a.staves)if(!o.isPercussion&&o.isStringed&&o.tuning.length>0&&o.showTablature){n.push(o);break}if(n.length>0){this.tuningGlyph=new VO(0,0),this.tuningGlyph.renderer=r;for(const a of n)this.tuningGlyph.addTuning(a.stringTuning,n.length>1?a.track.name:"")}}if(e.isNotationElementVisible(me.ChordDiagrams)){this.chordDiagrams=new IO(0,0),this.chordDiagrams.renderer=r;let n=new Set;for(let a of this.renderer.tracks)for(let o of a.staves){const l=o.chords;if(l)for(const[,u]of l)n.has(u.uniqueId)||u.showDiagram&&(n.add(u.uniqueId),this.chordDiagrams.addChord(u))}}}get scale(){return this.renderer.settings.display.scale}createEmptyStaffSystem(){let e=new bu(this);for(let t=0;t<this.renderer.tracks.length;t++){let s=this.renderer.tracks[t];for(let r=0;r<s.staves.length;r++){let n=s.staves[r],a=D.staveProfiles.get(this.renderer.settings.display.staveProfile);for(let o of a)o.canCreate(s,n)&&e.addStaff(s,new RO(t,n,o))}}return e}registerBarRenderer(e,t){this._barRendererLookup.has(e)||this._barRendererLookup.set(e,new Map),this._barRendererLookup.get(e).set(t.bar.id,t)}unregisterBarRenderer(e,t){this._barRendererLookup.has(e)&&this._barRendererLookup.get(e).delete(t.bar.id)}getRendererForBar(e,t){let s=t.id;return this._barRendererLookup.has(e)&&this._barRendererLookup.get(e).has(s)?this._barRendererLookup.get(e).get(s):null}layoutAndRenderAnnotation(e){let t="rendered by alphaTab",s=this.renderer.settings.display.resources,r=12*this.renderer.settings.display.scale,n=Math.floor(r);const a=new da,o=Be.withFamilyList(s.copyrightFont.families,r,gt.Plain,hs.Bold);this.renderer.canvas.font=o;const l=D.getLayoutEngineFactory(this.renderer.settings.display.layoutMode).vertical;return a.width=this.renderer.canvas.measureText(t).width,a.height=n,a.x=l?(this.width-a.width)/2:this.firstBarX,a.y=e,a.totalWidth=this.width,a.totalHeight=e+n,a.firstMasterBarIndex=-1,a.lastMasterBarIndex=-1,this.registerPartial(a,u=>{u.color=s.mainGlyphColor,u.font=o,u.textAlign=de.Left,u.textBaseline=we.Top,u.fillText(t,0,0)}),e+n}}var q;(function(i){i[i.TopWithStem=0]="TopWithStem",i[i.Top=1]="Top",i[i.Center=2]="Center",i[i.Bottom=3]="Bottom",i[i.BottomWithStem=4]="BottomWithStem"})(q||(q={}));var Ze;(function(i){i[i.Left=0]="Left",i[i.Center=1]="Center",i[i.Right=2]="Right"})(Ze||(Ze={}));class pt{get nextRenderer(){return!this.bar||!this.bar.nextBar?null:this.scoreRenderer.layout.getRendererForBar(this.staff.staveId,this.bar.nextBar)}get previousRenderer(){return!this.bar||!this.bar.previousBar?null:this.scoreRenderer.layout.getRendererForBar(this.staff.staveId,this.bar.previousBar)}constructor(e,t){this._preBeatGlyphs=new ll,this._voiceContainers=new Map,this._postBeatGlyphs=new ll,this._ties=[],this.x=0,this.y=0,this.width=0,this.computedWidth=0,this.height=0,this.index=0,this.topOverflow=0,this.bottomOverflow=0,this.isLinkedToPrevious=!1,this.canWrap=!0,this._wasFirstOfLine=!1,this._appliedLayoutingInfo=0,this.isFinalized=!1,this.topPadding=0,this.bottomPadding=0,this.scoreRenderer=e,this.bar=t,t&&(this.helpers=new AO(this))}registerTies(e){this._ties.push(...e)}get middleYPosition(){return 0}registerOverflowTop(e){return e>this.topOverflow?(this.topOverflow=e,!0):!1}registerOverflowBottom(e){return e>this.bottomOverflow?(this.bottomOverflow=e,!0):!1}scaleToWidth(e){let t=e-this._preBeatGlyphs.width-this._postBeatGlyphs.width;for(const s of this._voiceContainers.values())s.scaleToWidth(t);this._postBeatGlyphs.x=this._preBeatGlyphs.x+this._preBeatGlyphs.width+t,this.width=e}get resources(){return this.settings.display.resources}get settings(){return this.scoreRenderer.settings}get scale(){return this.settings.display.scale}get barDisplayScale(){return this.staff.system.staves.length>1?this.bar.masterBar.displayScale:this.bar.displayScale}get barDisplayWidth(){return this.staff.system.staves.length>1?this.bar.masterBar.displayWidth:this.bar.displayWidth}get isFirstOfLine(){return this.index===0}get isLast(){return!this.bar||this.bar.index===this.scoreRenderer.layout.lastBarIndex}registerLayoutingInfo(){let e=this.layoutingInfo,t=this._preBeatGlyphs.width;e.preBeatSize<t&&(e.preBeatSize=t);for(const r of this._voiceContainers.values())r.registerLayoutingInfo(e),r.x+r.width;let s=this._postBeatGlyphs.width;e.postBeatSize<s&&(e.postBeatSize=s)}applyLayoutingInfo(){if(this._appliedLayoutingInfo>=this.layoutingInfo.version)return!1;this._appliedLayoutingInfo=this.layoutingInfo.version,this._preBeatGlyphs.width=this.layoutingInfo.preBeatSize;let e=this._preBeatGlyphs.x+this._preBeatGlyphs.width;for(const s of this._voiceContainers.values()){s.x=this._preBeatGlyphs.x+this._preBeatGlyphs.width,s.applyLayoutingInfo(this.layoutingInfo);let r=s.x+s.width;e<r&&(e=r)}this._postBeatGlyphs.x=Math.floor(e),this._postBeatGlyphs.width=this.layoutingInfo.postBeatSize,this.width=Math.ceil(this._postBeatGlyphs.x+this._postBeatGlyphs.width),this.computedWidth=this.width;const t=this.barDisplayWidth;return t>0&&this.scoreRenderer.layout.systemsLayoutMode==fs.FromModelWithWidths&&(this.width=t,this.computedWidth=t),!0}finalizeRenderer(){this.isFinalized=!0;let e=!1;const t=this.y-this.staff.topSpacing,s=this.y+this.height+this.staff.bottomSpacing;for(const r of this._ties)if(r.doLayout(),r.height>0){const n=r.y+r.height-s;n>0&&this.registerOverflowBottom(n)&&(e=!0);const a=r.y-t;a<0&&this.registerOverflowTop(a*-1)&&(e=!0)}return e}doLayout(){if(this.bar){this.helpers.initialize(),this._ties=[],this._preBeatGlyphs=new ll,this._preBeatGlyphs.renderer=this,this._voiceContainers.clear(),this._postBeatGlyphs=new ll,this._postBeatGlyphs.renderer=this;for(let e=0;e<this.bar.voices.length;e++){let t=this.bar.voices[e];if(this.hasVoiceContainer(t)){let s=new q_(0,0,t);s.renderer=this,this._voiceContainers.set(this.bar.voices[e].index,s)}}this.bar.simileMark===Es.SecondOfDouble&&(this.canWrap=!1),this.createPreBeatGlyphs(),this.createBeatGlyphs(),this.createPostBeatGlyphs(),this.updateSizes();for(const e of this.helpers.beamHelpers)for(const t of e)t.finish();this.computedWidth=this.width}}hasVoiceContainer(e){return!e.isEmpty||e.index===0}updateSizes(){this.staff.registerStaffTop(this.topPadding),this.staff.registerStaffBottom(this.height-this.bottomPadding);let e=this._voiceContainers,t=this.beatGlyphsStart,s=t;for(const r of e.values()){r.x=t,r.doLayout();let n=r.x+r.width;s<n&&(s=n)}this._postBeatGlyphs.x=Math.floor(s),this.width=Math.ceil(this._postBeatGlyphs.x+this._postBeatGlyphs.width),this.height+=this.layoutingInfo.height*this.scale}addPreBeatGlyph(e){e.renderer=this,this._preBeatGlyphs.addGlyph(e)}addBeatGlyph(e){e.renderer=this,e.preNotes.renderer=this,e.onNotes.renderer=this,e.onNotes.beamingHelper=this.helpers.beamHelperLookup[e.beat.voice.index].get(e.beat.index),this.getVoiceContainer(e.beat.voice).addGlyph(e)}getVoiceContainer(e){return this._voiceContainers.has(e.index)?this._voiceContainers.get(e.index):void 0}getBeatContainer(e){var t,s;return(s=(t=this.getVoiceContainer(e.voice))==null?void 0:t.beatGlyphs)==null?void 0:s[e.index]}getPreNotesGlyphForBeat(e){var t;return(t=this.getBeatContainer(e))==null?void 0:t.preNotes}getOnNotesGlyphForBeat(e){var t;return(t=this.getBeatContainer(e))==null?void 0:t.onNotes}paint(e,t,s){this.paintBackground(e,t,s),s.color=this.resources.mainGlyphColor,this._preBeatGlyphs.paint(e+this.x,t+this.y,s);for(const r of this._voiceContainers.values())s.color=r.voice.index===0?this.resources.mainGlyphColor:this.resources.secondaryGlyphColor,r.paint(e+this.x,t+this.y,s);s.color=this.resources.mainGlyphColor,this._postBeatGlyphs.paint(e+this.x,t+this.y,s)}paintBackground(e,t,s){this.layoutingInfo.paint(e+this.x+this._preBeatGlyphs.x+this._preBeatGlyphs.width,t+this.y+this.height,s)}buildBoundingsLookup(e,t,s){let r=new H_;r.bar=this.bar,r.visualBounds=new Wi,r.visualBounds.x=t+this.x,r.visualBounds.y=s+this.y+this.topPadding,r.visualBounds.w=this.width,r.visualBounds.h=this.height-this.topPadding-this.bottomPadding,r.realBounds=new Wi,r.realBounds.x=t+this.x,r.realBounds.y=s+this.y,r.realBounds.w=this.width,r.realBounds.h=this.height,e.addBar(r);for(const[n,a]of this._voiceContainers){let o=this.bar.isEmpty&&n===0;if(!a.voice.isEmpty||o)for(let l=0,u=a.beatGlyphs.length;l<u;l++)a.beatGlyphs[l].buildBoundingsLookup(r,t+this.x+a.x,s+this.y+a.y,o)}}addPostBeatGlyph(e){this._postBeatGlyphs.addGlyph(e)}createPreBeatGlyphs(){this._wasFirstOfLine=this.isFirstOfLine}createBeatGlyphs(){for(const e of this.bar.voices)this.hasVoiceContainer(e)&&this.createVoiceGlyphs(e)}createVoiceGlyphs(e){}createPostBeatGlyphs(){}get beatGlyphsStart(){return this._preBeatGlyphs.x+this._preBeatGlyphs.width}get postBeatGlyphsStart(){return this._postBeatGlyphs.x}getBeatX(e,t=_e.PreNotes){let s=this.getBeatContainer(e);if(s)switch(t){case _e.PreNotes:return s.voiceContainer.x+s.x;case _e.OnNotes:return s.voiceContainer.x+s.x+s.onNotes.x;case _e.MiddleNotes:return s.voiceContainer.x+s.x+s.onTimeX;case _e.Stem:const r=s.onNotes.beamingHelper?s.onNotes.beamingHelper.getBeatLineX(e):s.onNotes.x+s.onNotes.width/2;return s.voiceContainer.x+r;case _e.PostNotes:return s.voiceContainer.x+s.x+s.onNotes.x+s.onNotes.width;case _e.EndBeat:return s.voiceContainer.x+s.x+s.width}return 0}getNoteX(e,t){let s=this.getBeatContainer(e.beat);return s?s.voiceContainer.x+s.x+s.onNotes.x+s.onNotes.getNoteX(e,t):0}getNoteY(e,t){let s=this.getOnNotesGlyphForBeat(e.beat);return s?s.getNoteY(e,t):NaN}reLayout(){(this._wasFirstOfLine&&!this.isFirstOfLine||!this._wasFirstOfLine&&this.isFirstOfLine)&&(this._preBeatGlyphs=new ll,this._preBeatGlyphs.renderer=this,this.createPreBeatGlyphs()),this.updateSizes(),this.registerLayoutingInfo()}paintSimileMark(e,t,s){switch(this.bar.simileMark){case Es.Simple:s.fillMusicFontSymbol(e+this.x+(this.width-20*this.scale)/2,t+this.y+this.height/2,1,S.Repeat1Bar,!1);break;case Es.SecondOfDouble:s.fillMusicFontSymbol(e+this.x-28*this.scale/2,t+this.y+this.height/2,1,S.Repeat2Bars,!1);break}}completeBeamingHelper(e){}getBeatDirection(e){return this.helpers.getBeamingHelperForBeat(e).direction}}pt.RawLineSpacing=8;pt.StemWidth=.12*pt.RawLineSpacing;pt.StaffLineThickness=.13*pt.RawLineSpacing;pt.BeamThickness=.5*pt.RawLineSpacing;pt.BeamSpacing=.25*pt.RawLineSpacing;var Ve;(function(i){i[i.SinglePreBeat=0]="SinglePreBeat",i[i.SingleOnBeat=1]="SingleOnBeat",i[i.SingleOnBeatToEnd=2]="SingleOnBeatToEnd",i[i.GroupedOnBeat=3]="GroupedOnBeat",i[i.GroupedOnBeatToEnd=4]="GroupedOnBeatToEnd",i[i.FullBar=5]="FullBar"})(Ve||(Ve={}));class zO extends vt{constructor(e,t){super(0,0),this._uniqueEffectGlyphs=[],this._effectGlyphs=[],this.isEmpty=!0,this.previousBand=null,this.isLinkedToPrevious=!1,this.firstBeat=null,this.lastBeat=null,this.height=0,this.originalHeight=0,this.slot=null,this.voice=e,this.info=t}doLayout(){super.doLayout();for(let e=0;e<this.renderer.bar.voices.length;e++)this._effectGlyphs.push(new Map),this._uniqueEffectGlyphs.push([])}createGlyph(e){if(e.voice===this.voice&&this.info.shouldCreateGlyph(this.renderer.settings,e)&&(!this.info.hideOnMultiTrack||this.renderer.staff.trackIndex===0)){if(this.isEmpty=!1,(!this.firstBeat||e.isBefore(this.firstBeat))&&(this.firstBeat=e),!this.lastBeat||e.isAfter(this.lastBeat))switch(this.lastBeat=e,this.info.sizingMode){case Ve.SingleOnBeatToEnd:case Ve.GroupedOnBeatToEnd:this.lastBeat.nextBeat&&(this.lastBeat=this.lastBeat.nextBeat);break}let t=this.createOrResizeGlyph(this.info.sizingMode,e);t.height>this.height&&(this.height=t.height,this.originalHeight=t.height)}}resetHeight(){this.height=this.originalHeight}createOrResizeGlyph(e,t){let s;switch(e){case Ve.FullBar:return s=this.info.createNewGlyph(this.renderer,t),s.renderer=this.renderer,s.beat=t,s.doLayout(),this._effectGlyphs[t.voice.index].set(t.index,s),this._uniqueEffectGlyphs[t.voice.index].push(s),s;case Ve.SinglePreBeat:case Ve.SingleOnBeat:case Ve.SingleOnBeatToEnd:return s=this.info.createNewGlyph(this.renderer,t),s.renderer=this.renderer,s.beat=t,s.doLayout(),this._effectGlyphs[t.voice.index].set(t.index,s),this._uniqueEffectGlyphs[t.voice.index].push(s),s;case Ve.GroupedOnBeat:case Ve.GroupedOnBeatToEnd:let r=e===Ve.GroupedOnBeat?Ve.SingleOnBeat:Ve.SingleOnBeatToEnd;if(t.index>0||this.renderer.index>0){let n=t.previousBeat;if(this.info.shouldCreateGlyph(this.renderer.settings,n)){let a=null;if(t.index>0&&this._effectGlyphs[t.voice.index].has(n.index))a=this._effectGlyphs[t.voice.index].get(n.index);else if(this.renderer.index>0){let u=this.renderer.previousRenderer.getBand(n.voice,this.info.effectId);if(u){let h=u._effectGlyphs[n.voice.index];h.has(n.index)&&(a=h.get(n.index))}}let o=this.createOrResizeGlyph(r,t);return a&&this.info.canExpand(n,t)&&(a.nextGlyph=o,o.previousGlyph=a,this.isLinkedToPrevious=!0),o}return this.createOrResizeGlyph(r,t)}return this.createOrResizeGlyph(r,t);default:return this.createOrResizeGlyph(Ve.SingleOnBeat,t)}}paint(e,t,s){super.paint(e,t,s);for(let r=0,n=this._uniqueEffectGlyphs.length;r<n;r++){let a=this._uniqueEffectGlyphs[r];for(let o=0,l=a.length;o<l;o++)a[o].paint(e+this.x,t+this.y,s)}}alignGlyphs(){for(let e=0;e<this._effectGlyphs.length;e++)for(const t of this._effectGlyphs[e].keys())this.alignGlyph(this.info.sizingMode,this.renderer.bar.voices[e].beats[t])}alignGlyph(e,t){let s=this._effectGlyphs[t.voice.index].get(t.index),r,n=this.renderer.getBeatContainer(t);switch(e){case Ve.SinglePreBeat:r=n.preNotes,s.x=this.renderer.beatGlyphsStart+r.x+n.x,s.width=r.width;break;case Ve.SingleOnBeat:case Ve.GroupedOnBeat:r=n.onNotes,s.x=this.renderer.beatGlyphsStart+r.x+n.x,s.width=r.width;break;case Ve.SingleOnBeatToEnd:case Ve.GroupedOnBeatToEnd:r=n.onNotes,s.x=this.renderer.beatGlyphsStart+r.x+n.x,n.beat.isLastOfVoice?s.width=this.renderer.width-s.x:s.width=n.width-n.preNotes.width-n.preNotes.x;break;case Ve.FullBar:s.width=this.renderer.width;break}}}class WO{constructor(){this.uniqueEffectId=null,this.y=0,this.height=0,this.firstBeat=null,this.lastBeat=null}}class GO{constructor(){this.bands=[],this.shared=new WO}update(e){e.info.canShareBand||(this.shared.uniqueEffectId=e.info.effectId),e.slot=this,this.bands.push(e),e.height>this.shared.height&&(this.shared.height=e.height),(!this.shared.firstBeat||e.firstBeat.isBefore(this.shared.firstBeat))&&(this.shared.firstBeat=e.firstBeat),(!this.shared.lastBeat||e.lastBeat.isAfter(this.shared.lastBeat))&&(this.shared.lastBeat=e.lastBeat)}canBeUsed(e){return(!this.shared.uniqueEffectId&&e.info.canShareBand||e.info.effectId===this.shared.uniqueEffectId)&&(!this.shared.firstBeat||this.shared.lastBeat.isBefore(e.firstBeat)||this.shared.lastBeat.isBefore(this.shared.firstBeat))}}class jO{constructor(){this.slots=[],this._effectSlot=new Map}getOrCreateSlot(e){if(this._effectSlot.has(e.info.effectId)){let s=this._effectSlot.get(e.info.effectId);if(s.canBeUsed(e))return s}for(let s of this.slots)if(s.canBeUsed(e))return s;let t=new GO;return this.slots.push(t),t}register(e){let t=this.getOrCreateSlot(e);t.update(e),this._effectSlot.set(e.info.effectId,t)}}class Ha extends qs{constructor(){super(0,0),this.computedWidth=0}doLayout(){let e=0;if(this.glyphs)for(let t=0,s=this.glyphs.length;t<s;t++){let r=this.glyphs[t];r.x=e,r.renderer=this.renderer,r.doLayout(),e+=r.width}this.width=e,this.computedWidth=e}noteLoop(e){for(let t=this.container.beat.notes.length-1;t>=0;t--)e(this.container.beat.notes[t])}}class za extends Ha{constructor(){super(...arguments),this.centerX=0}updateBeamingHelper(){}buildBoundingsLookup(e,t,s){}getNoteX(e,t){return 0}getNoteY(e,t){return 0}}class UO extends pt{constructor(e,t,s){super(e,t),this._bands=[],this._bandLookup=new Map,this.sizingInfo=null,this._infos=s}updateSizes(){this.topOverflow=0,this.bottomOverflow=0,this.topPadding=0,this.bottomPadding=0,this.updateHeight(),super.updateSizes()}finalizeRenderer(){let e=super.finalizeRenderer();return this.updateHeight()&&(e=!0),e}updateHeight(){if(!this.sizingInfo)return!1;let e=0;for(let t of this.sizingInfo.slots){t.shared.y=e;for(let s of t.bands)s.y=e,s.height=t.shared.height;e+=t.shared.height}return e!==this.height?(this.height=e,!0):!1}applyLayoutingInfo(){const e=!super.applyLayoutingInfo();if(this.index>0){let t=this.previousRenderer;this.sizingInfo=t.sizingInfo}else this.sizingInfo=new jO;for(let t of this._bands)t.resetHeight(),t.alignGlyphs(),t.isEmpty||this.sizingInfo.register(t);return this.updateHeight(),e}scaleToWidth(e){super.scaleToWidth(e);for(let t of this._bands)t.alignGlyphs()}createBeatGlyphs(){this._bands=[],this._bandLookup=new Map;for(let e of this.bar.voices)if(this.hasVoiceContainer(e))for(let t of this._infos){let s=new zO(e,t);s.renderer=this,s.doLayout(),this._bands.push(s),this._bandLookup.set(e.index+"."+t.effectId,s)}for(let e of this.bar.voices)this.hasVoiceContainer(e)&&this.createVoiceGlyphs(e);for(let e of this._bands)e.isLinkedToPrevious&&(this.isLinkedToPrevious=!0)}createVoiceGlyphs(e){for(let t of e.beats){let s=new Cs(t,this.getVoiceContainer(e));s.preNotes=new Ha,s.onNotes=new za,this.addBeatGlyph(s);for(let r of this._bands)r.createGlyph(t)}}paint(e,t,s){this.paintBackground(e,t,s);for(let r of this._bands)s.color=r.voice.index===0?this.resources.mainGlyphColor:this.resources.secondaryGlyphColor,r.isEmpty||r.paint(e+this.x,t+this.y,s)}getBand(e,t){let s=e.index+"."+t;return this._bandLookup.has(s)?this._bandLookup.get(s):null}}class Ja extends Fu{get staffId(){return this._staffId}getStaffPaddingTop(e){return e.system.layout.renderer.settings.display.effectStaffPaddingTop}getStaffPaddingBottom(e){return e.system.layout.renderer.settings.display.effectStaffPaddingBottom}constructor(e,t,s=null){super(),this.infos=t,this._staffId=e,this.isInAccolade=!1,this.isRelevantForBoundsLookup=!1,this.shouldShow=s}canCreate(e,t){const s=this.shouldShow;return super.canCreate(e,t)&&(!s||s(e,t))}create(e,t){return new UO(e,t,this.infos.filter(s=>e.settings.notation.isNotationElementVisible(s.notationElement)))}}class Su extends vs{constructor(e,t,s){super(e,t),this._endingsString="",this._endings=[];for(let r=0;r<gn.MaxAlternateEndings;r++)s&1<<r&&this._endings.push(r)}doLayout(){super.doLayout(),this.height=this.renderer.resources.wordsFont.size+(Su.Padding*this.scale+2);let e="";for(let t=0,s=this._endings.length;t<s;t++)e+=this._endings[t]+1,e+=". ";this._endingsString=e}paint(e,t,s){super.paint(e,t,s);let r=s.textBaseline;if(s.textBaseline=we.Top,this._endings.length>0){let n=this.renderer.resources;s.font=n.wordsFont,s.moveTo(e+this.x,t+this.y+this.height),s.lineTo(e+this.x,t+this.y),s.lineTo(e+this.x+this.width,t+this.y),s.stroke(),s.fillText(this._endingsString,e+this.x+Su.Padding*this.scale,t+this.y*this.scale)}s.textBaseline=r}}Su.Padding=3;class Zt{get effectId(){return this.notationElement.toString()}}class $O extends Zt{get notationElement(){return me.EffectAlternateEndings}get hideOnMultiTrack(){return!0}get canShareBand(){return!1}get sizingMode(){return Ve.FullBar}shouldCreateGlyph(e,t){return t.voice.index===0&&t.index===0&&t.voice.bar.masterBar.alternateEndings!==0}createNewGlyph(e,t){return new Su(0,0,t.voice.bar.masterBar.alternateEndings)}canExpand(e,t){return!0}}class YO extends Zt{get notationElement(){return me.EffectCapo}get hideOnMultiTrack(){return!1}get canShareBand(){return!1}get sizingMode(){return Ve.SingleOnBeat}shouldCreateGlyph(e,t){return t.index===0&&t.voice.bar.index===0&&t.voice.bar.staff.capo!==0}createNewGlyph(e,t){return new ui(0,0,"Capo. fret "+t.voice.bar.staff.capo,e.resources.effectFont,de.Left)}canExpand(e,t){return!1}}class XO extends Zt{get notationElement(){return me.EffectChordNames}get hideOnMultiTrack(){return!1}get canShareBand(){return!0}get sizingMode(){return Ve.SingleOnBeat}shouldCreateGlyph(e,t){return t.hasChord}createNewGlyph(e,t){return new ui(0,0,t.chord.name,e.resources.effectFont,de.Center)}canExpand(e,t){return!1}}class Hu extends vs{constructor(e){super(),this.forceGroupedRendering=!1,this.endOnBarLine=!1,this.endPosition=e}get isLinkedWithPrevious(){return!!this.previousGlyph&&this.previousGlyph.renderer.staff.system===this.renderer.staff.system}get isLinkedWithNext(){return!!this.nextGlyph&&this.nextGlyph.renderer.isFinalized&&this.nextGlyph.renderer.staff.system===this.renderer.staff.system}paint(e,t,s){if(this.isLinkedWithPrevious)return;if(!this.isLinkedWithNext&&!this.forceGroupedRendering){this.paintNonGrouped(e,t,s);return}let r;if(!this.isLinkedWithNext&&this.forceGroupedRendering)r=this;else for(r=this.nextGlyph;r.isLinkedWithNext;)r=r.nextGlyph;let n=r.renderer,a=r.beat,o=this.endPosition,l=e-this.renderer.x,u=this.calculateEndX(n,a,l,o);this.paintGrouped(e,t,u,s)}calculateEndX(e,t,s,r){return t?s+e.x+e.getBeatX(t,r):s+e.x+this.x+this.width}paintNonGrouped(e,t,s){let r=e-this.renderer.x,n=this.calculateEndX(this.renderer,this.beat,r,this.endPosition);this.paintGrouped(e,t,n,s)}}class wu extends Hu{constructor(e,t,s){super(_e.EndBeat),this._crescendo=ss.None,this._crescendo=s,this.x=e,this.y=t}doLayout(){super.doLayout(),this.height=17*this.scale}paintGrouped(e,t,s,r){let n=e+this.x,a=this.height*this.scale;r.beginPath(),this._crescendo===ss.Crescendo?(s-=wu.Padding*this.scale,r.moveTo(s,t+this.y),r.lineTo(n,t+this.y+a/2),r.lineTo(s,t+this.y+a)):(s-=wu.Padding*this.scale,r.moveTo(n,t+this.y),r.lineTo(s,t+this.y+a/2),r.lineTo(n,t+this.y+a)),r.stroke()}}wu.Padding=Se.QuarterNoteHeadWidth/2|0;class QO extends Zt{get notationElement(){return me.EffectCrescendo}get hideOnMultiTrack(){return!1}get canShareBand(){return!0}get sizingMode(){return Ve.GroupedOnBeatToEnd}shouldCreateGlyph(e,t){return t.crescendo!==ss.None}createNewGlyph(e,t){return new wu(0,0,t.crescendo)}canExpand(e,t){return e.crescendo===t.crescendo}}class $0 extends Rt{constructor(e,t,s){super(e,t,.6,$0.getSymbol(s))}doLayout(){super.doLayout(),this.height=17*this.scale,this.y+=this.height/2}static getSymbol(e){switch(e){case Me.PPP:return S.DynamicPPP;case Me.PP:return S.DynamicPP;case Me.P:return S.DynamicPiano;case Me.MP:return S.DynamicMP;case Me.MF:return S.DynamicMF;case Me.F:return S.DynamicForte;case Me.FF:return S.DynamicFF;case Me.FFF:return S.DynamicFFF;default:return S.None}}}class JO extends Zt{get notationElement(){return me.EffectDynamics}get hideOnMultiTrack(){return!1}get canShareBand(){return!1}get sizingMode(){return Ve.SingleOnBeat}shouldCreateGlyph(e,t){return this.internalShouldCreateGlyph(t)}internalShouldCreateGlyph(e){if(e.voice.bar.staff.track.score.stylesheet.hideDynamics||e.isEmpty||e.voice.isEmpty||e.isRest||e.graceType!==he.None)return!1;let t=this.getPreviousDynamicsBeat(e),s=e.voice.index===0&&!t||e.dynamics!==(t==null?void 0:t.dynamics);if(s&&e.voice.index>0){for(let r of e.voice.bar.voices)if(r.index<e.voice.index){let n=r.getBeatAtPlaybackStart(e.playbackStart);n&&e.dynamics===n.dynamics&&this.internalShouldCreateGlyph(n)&&(s=!1)}}return s}getPreviousDynamicsBeat(e){let t=e.previousBeat;for(;t!=null;){if(!t.isRest&&t.graceType===he.None)return t;t=t.previousBeat}return null}createNewGlyph(e,t){return new $0(0,0,t.dynamics)}canExpand(e,t){return!0}}class qO extends vs{doLayout(){super.doLayout(),this.height=17*this.scale}paint(e,t,s){let r=6*this.scale,n=Math.max(this.width,14*this.scale),a=this.height/2;s.beginPath(),s.moveTo(e+this.x,t+this.y+a),s.quadraticCurveTo(e+this.x+n/2,t+this.y+a,e+this.x+n,t+this.y+a-r),s.moveTo(e+this.x,t+this.y+a),s.quadraticCurveTo(e+this.x+n/2,t+this.y+a,e+this.x+n,t+this.y+a+r),s.stroke()}}class KO extends Zt{get notationElement(){return me.EffectFadeIn}get hideOnMultiTrack(){return!1}get canShareBand(){return!0}get sizingMode(){return Ve.SingleOnBeat}shouldCreateGlyph(e,t){return t.fadeIn}createNewGlyph(e,t){return new qO}canExpand(e,t){return!0}}class Y0 extends Rt{constructor(e,t,s){super(e,t,1,Y0.getSymbol(s))}static getSymbol(e){switch(e){case yr.Short:return S.FermataShortAbove;case yr.Medium:return S.FermataAbove;case yr.Long:return S.FermataLongAbove;default:return S.None}}doLayout(){this.width=23*this.scale,this.height=12*this.scale}paint(e,t,s){super.paint(e-this.width/2,t+this.height,s)}}class ZO extends Zt{get notationElement(){return me.EffectFermata}get hideOnMultiTrack(){return!1}get canShareBand(){return!1}get sizingMode(){return Ve.SingleOnBeat}shouldCreateGlyph(e,t){return t.voice.index===0&&!!t.fermata}createNewGlyph(e,t){return new Y0(0,0,t.fermata.type)}canExpand(e,t){return!0}}class e4 extends Zt{get notationElement(){return me.EffectFingering}get hideOnMultiTrack(){return!1}get canShareBand(){return!0}get sizingMode(){return Ve.SingleOnBeat}shouldCreateGlyph(e,t){return t.voice.index!==0||t.isRest||e.notation.fingeringMode!==Sr.SingleNoteEffectBand&&e.notation.fingeringMode!==Sr.SingleNoteEffectBandForcePiano||t.notes.length!==1?!1:t.notes[0].isFingering}createNewGlyph(e,t){let s=Te.Unknown,r=!1,n=t.notes[0];n.leftHandFinger!==Te.Unknown?(s=n.leftHandFinger,r=!0):n.rightHandFinger!==Te.Unknown&&(s=n.rightHandFinger);let a=et.fingerToString(e.settings,t,s,r)??"";return new ui(0,0,a,e.resources.fingeringFont,de.Left)}canExpand(e,t){return!0}}class Wa extends Zt{constructor(){super(...arguments),this.lastCreateInfo=null}shouldCreateGlyph(e,t){this.lastCreateInfo=[];for(let s=0,r=t.notes.length;s<r;s++){let n=t.notes[s];this.shouldCreateGlyphForNote(n)&&this.lastCreateInfo.push(n)}return this.lastCreateInfo.length>0}get hideOnMultiTrack(){return!1}get canShareBand(){return!0}canExpand(e,t){return!0}}class vn extends Hu{constructor(e){super(_e.OnNotes),this._label=e}doLayout(){this.renderer.settings.notation.extendLineEffectsToBeatEnd&&(this.endPosition=_e.EndBeat,this.forceGroupedRendering=!0),super.doLayout(),this.height=this.renderer.resources.effectFont.size}paintNonGrouped(e,t,s){let r=this.renderer.resources;s.font=r.effectFont;let n=s.textAlign;s.textAlign=de.Center,s.fillText(this._label,e+this.x,t+this.y),s.textAlign=n}paintGrouped(e,t,s,r){this.paintNonGrouped(e,t,r);let n=3*this.scale,a=r.measureText(this._label).width,o=e+this.x+a/2+n,l=t+this.y+4*this.scale,u=8*this.scale;if(s>o){let h=o;for(;h<s;)r.beginPath(),r.moveTo(h,l|0),r.lineTo(Math.min(h+u,s),l|0),h+=u+n,r.stroke();r.beginPath(),r.moveTo(s,l-5*this.scale|0),r.lineTo(s,l+5*this.scale|0),r.stroke()}}}vn.LineSpacing=3;vn.LineTopPadding=4;vn.LineTopOffset=5;vn.LineSize=8;class En extends Wa{get effectId(){return this._effectId}get notationElement(){return me.EffectHarmonics}constructor(e){switch(super(),this._beat=null,this._harmonicType=e,e){case fe.None:this._effectId="harmonics-none";break;case fe.Natural:this._effectId="harmonics-natural";break;case fe.Artificial:this._effectId="harmonics-artificial";break;case fe.Pinch:this._effectId="harmonics-pinch";break;case fe.Tap:this._effectId="harmonics-tap";break;case fe.Semi:this._effectId="harmonics-semi";break;case fe.Feedback:this._effectId="harmonics-feedback";break;default:this._effectId="";break}}shouldCreateGlyphForNote(e){return!e.isHarmonic||e.harmonicType!==this._harmonicType?!1:(e.beat!==this._beat&&(this._beat=e.beat),!0)}get sizingMode(){return Ve.GroupedOnBeat}createNewGlyph(e,t){return new vn(En.harmonicToString(this._harmonicType))}static harmonicToString(e){switch(e){case fe.Natural:return"N.H.";case fe.Artificial:return"A.H.";case fe.Pinch:return"P.H.";case fe.Tap:return"T.H.";case fe.Semi:return"S.H.";case fe.Feedback:return"Fdbk."}return""}}class t4 extends Zt{get notationElement(){return me.EffectLetRing}get canShareBand(){return!1}get hideOnMultiTrack(){return!1}shouldCreateGlyph(e,t){return t.isLetRing}get sizingMode(){return Ve.GroupedOnBeat}createNewGlyph(e,t){return new vn("LetRing")}canExpand(e,t){return!0}}class i4 extends vs{constructor(e,t,s,r,n=de.Center){super(e,t),this._lines=s,this.font=r,this.textAlign=n}doLayout(){super.doLayout(),this.height=this.font.size*this._lines.length}paint(e,t,s){s.font=this.font;let r=s.textAlign;s.textAlign=this.textAlign;for(let n=0;n<this._lines.length;n++)this._lines[n]&&s.fillText(this._lines[n],e+this.x,t+this.y+n*this.font.size);s.textAlign=r}}class s4 extends Zt{get notationElement(){return me.EffectLyrics}get hideOnMultiTrack(){return!1}get canShareBand(){return!1}get sizingMode(){return Ve.SingleOnBeat}shouldCreateGlyph(e,t){return!!t.lyrics}createNewGlyph(e,t){return new i4(0,0,t.lyrics,e.resources.effectFont,de.Center)}canExpand(e,t){return!0}}class r4 extends Zt{get notationElement(){return me.EffectMarker}get hideOnMultiTrack(){return!0}get canShareBand(){return!0}get sizingMode(){return Ve.SinglePreBeat}shouldCreateGlyph(e,t){return t.voice.bar.staff.index===0&&t.voice.index===0&&t.index===0&&t.voice.bar.masterBar.isSectionStart}createNewGlyph(e,t){return new ui(0,0,t.voice.bar.masterBar.section.marker?"["+t.voice.bar.masterBar.section.marker+"] "+t.voice.bar.masterBar.section.text:t.voice.bar.masterBar.section.text,e.resources.markerFont,de.Left)}canExpand(e,t){return!0}}class n4 extends Hu{constructor(e,t){super(_e.PostNotes),this._ottava=e,this._aboveStaff=t}doLayout(){super.doLayout(),this.height=13*this.scale}paintNonGrouped(e,t,s){this.paintOttava(e,t,s)}paintOttava(e,t,s){let r=0;switch(this._ottava){case Ue._15ma:r=37*this.scale,s.fillMusicFontSymbol(e+this.x-r/2,t+this.y+this.height,.8,S.QuindicesimaAlta,!1);break;case Ue._8va:r=26*this.scale,s.fillMusicFontSymbol(e+this.x-r/2,t+this.y+this.height,.8,S.OttavaAlta,!1);break;case Ue._8vb:r=23*this.scale,s.fillMusicFontSymbol(e+this.x-r/2,t+this.y+this.height,.8,S.OttavaBassaVb,!1);break;case Ue._15mb:r=36*this.scale,s.fillMusicFontSymbols(e+this.x-r/2,t+this.y+this.height,.8,[S.Quindicesima,S.OctaveBaselineM,S.OctaveBaselineB],!1);break}return r/2}paintGrouped(e,t,s,r){let n=this.paintOttava(e,t,r),a=3*this.scale,o=e+this.x+n+a,l=t+this.y;l+=this._aboveStaff?2*this.scale:this.height-2*this.scale;let u=8*this.scale;if(s>o){let h=o;for(;h<s;)r.beginPath(),r.moveTo(h,l|0),r.lineTo(Math.min(h+u,s),l|0),h+=u+a,r.stroke();r.beginPath(),this._aboveStaff?(r.moveTo(s,l),r.lineTo(s,t+this.y+this.height)):(r.moveTo(s,l),r.lineTo(s,t+this.y)),r.stroke()}}}class lS extends Zt{get effectId(){return"ottavia-"+(this._aboveStaff?"above":"below")}get notationElement(){return me.EffectOttavia}get hideOnMultiTrack(){return!1}get canShareBand(){return!0}get sizingMode(){return Ve.GroupedOnBeat}constructor(e){super(),this._aboveStaff=e}shouldCreateGlyph(e,t){switch(t.ottava){case Ue._15ma:return this._aboveStaff;case Ue._8va:return this._aboveStaff;case Ue._8vb:return!this._aboveStaff;case Ue._15mb:return!this._aboveStaff}return!1}createNewGlyph(e,t){return new n4(t.ottava,this._aboveStaff)}canExpand(e,t){return e.ottava===t.ottava}}class a4 extends Wa{get notationElement(){return me.EffectPalmMute}shouldCreateGlyphForNote(e){return e.isPalmMute}get sizingMode(){return Ve.GroupedOnBeat}createNewGlyph(e,t){return new vn("P.M.")}constructor(){super()}}class o4 extends Wa{get notationElement(){return me.EffectPickSlide}shouldCreateGlyphForNote(e){return e.slideOutType===xe.PickSlideDown||e.slideOutType===xe.PickSlideUp}get sizingMode(){return Ve.GroupedOnBeat}createNewGlyph(e,t){return new vn("P.S.")}constructor(){super()}}class vu extends Rt{constructor(e,t,s){super(e,t,Se.GraceScale,vu.getSymbol(s))}doLayout(){this.width=9*this.scale,this.height=13*this.scale}paint(e,t,s){super.paint(e,t+this.height,s)}static getSymbol(e){switch(e){case fi.Up:return S.StringsUpBow;case fi.Down:return S.StringsDownBow;default:return S.None}}}class l4 extends Zt{get notationElement(){return me.EffectPickStroke}get hideOnMultiTrack(){return!1}get canShareBand(){return!0}get sizingMode(){return Ve.SingleOnBeat}shouldCreateGlyph(e,t){return t.pickStroke!==fi.None}createNewGlyph(e,t){return new vu(0,0,t.pickStroke)}canExpand(e,t){return!0}}class Z_ extends Hu{constructor(e){super(_e.EndBeat),this._stepSize=0,this._type=e}doLayout(){switch(super.doLayout(),this._type){case Ge.Slight:this._stepSize=12*this.scale;break;case Ge.Wide:this._stepSize=23*this.scale;break}this.height=18*this.scale}paintGrouped(e,t,s,r){let n=e+this.x,a=s-n,o=Math.max(1,a/this._stepSize);r.beginPath(),r.moveTo(n,t+this.y);for(let l=0;l<o;l++)r.lineTo(n+this._stepSize/2,t+this.y+this.height),r.lineTo(n+this._stepSize,t+this.y),n+=this._stepSize;r.stroke()}}class uS extends Zt{get notationElement(){return me.EffectSlightBeatVibrato}get hideOnMultiTrack(){return!1}get canShareBand(){return!0}get sizingMode(){return Ve.GroupedOnBeatToEnd}shouldCreateGlyph(e,t){return t.vibrato===Ge.Slight}createNewGlyph(e,t){return new Z_(Ge.Slight)}canExpand(e,t){return!0}}class Ma extends Hu{constructor(e,t,s,r=1.2,n=!1){super(_e.EndBeat),this._scale=0,this._symbol=S.None,this._symbolSize=0,this._type=s,this._scale=r,this.x=e,this.y=t,this._partialWaves=n}doLayout(){super.doLayout();let e=0;switch(this._type){case Ge.Slight:this._symbol=S.WiggleTrill,this._symbolSize=9*this._scale,e=6*this._scale;break;case Ge.Wide:this._symbol=S.WiggleVibratoMediumFast,this._symbolSize=10*this._scale,e=10*this._scale;break}this.height=e*this.scale}paintGrouped(e,t,s,r){let n=e+this.x,a=s-n,o=this._symbolSize*this.scale,l=a/o;this._partialWaves||(l=Math.floor(l)),l<1&&(l=1);let u=0;for(let h=0;h<l;h++)r.fillMusicFontSymbol(e+this.x+u,t+this.y+this.height*2,this._scale*this.scale,this._symbol,!1),u+=o}}class hS extends Wa{get notationElement(){return me.EffectSlightNoteVibrato}shouldCreateGlyphForNote(e){return e.vibrato===Ge.Slight||e.isTieDestination&&e.tieOrigin.vibrato===Ge.Slight}get sizingMode(){return Ve.GroupedOnBeatToEnd}createNewGlyph(e,t){return new Ma(0,0,Ge.Slight,1.2)}constructor(){super()}}class u4 extends Zt{get notationElement(){return me.EffectTap}get hideOnMultiTrack(){return!1}get canShareBand(){return!0}get sizingMode(){return Ve.SingleOnBeat}shouldCreateGlyph(e,t){return t.slap||t.pop||t.tap}createNewGlyph(e,t){let s=e.resources;return t.slap?new ui(0,0,"S",s.effectFont,de.Left):t.pop?new ui(0,0,"P",s.effectFont,de.Left):new ui(0,0,"T",s.effectFont,de.Left)}canExpand(e,t){return!0}}class h4 extends vs{constructor(e){super(0,0),this.tempoAutomations=e}doLayout(){super.doLayout(),this.height=25*this.scale}paint(e,t,s){const r=e+this.x,n=e+this.renderer.postBeatGlyphsStart;for(const a of this.tempoAutomations){const o=e+this.x+(n-r)*a.ratioPosition,l=this.renderer.resources;s.font=l.markerFont,s.fillMusicFontSymbol(o,t+this.y+this.height*.8,this.scale*Se.GraceScale,S.NoteQuarterUp,!1),s.textBaseline=we.Top,s.fillText("= "+a.value.toString(),o+this.height/2,t+this.y+s.font.size/2)}}}class c4 extends Zt{get notationElement(){return me.EffectTempo}get hideOnMultiTrack(){return!0}get canShareBand(){return!1}get sizingMode(){return Ve.SinglePreBeat}shouldCreateGlyph(e,t){return t.voice.bar.staff.index===0&&t.voice.index===0&&t.index===0&&t.voice.bar.masterBar.tempoAutomations.length>0}createNewGlyph(e,t){return new h4(t.voice.bar.masterBar.tempoAutomations)}canExpand(e,t){return!0}}class d4 extends Zt{get notationElement(){return me.EffectText}get hideOnMultiTrack(){return!1}get canShareBand(){return!1}get sizingMode(){return Ve.SingleOnBeat}shouldCreateGlyph(e,t){return!!t.text}createNewGlyph(e,t){return new ui(0,0,t.text,e.resources.effectFont,de.Left)}canExpand(e,t){return!0}}class f4 extends vs{constructor(e,t){super(e,t)}doLayout(){super.doLayout(),this.height=this.renderer.resources.markerFont.size*this.scale}paint(e,t,s){let r=this.renderer.resources;s.font=r.markerFont;let n=s.measureText("tr").width;s.fillText("tr",e+this.x,t+this.y);let a=n+3*this.scale,o=this.width-a,l=1.2,u=11*this.scale*l,h=Math.max(1,(o-a)/u),c=a,d=t+this.y+this.height*1.2;for(let f=0;f<h;f++)s.fillMusicFontSymbol(e+this.x+c,d,l,S.WiggleTrill,!1),c+=u}}class cS extends Wa{get notationElement(){return me.EffectTrill}shouldCreateGlyphForNote(e){return e.isTrill}get sizingMode(){return Ve.SingleOnBeat}createNewGlyph(e,t){return new f4(0,0)}}var wt;(function(i){i[i.Full=0]="Full",i[i.PartialLeft=1]="PartialLeft",i[i.PartialRight=2]="PartialRight"})(wt||(wt={}));class Qe extends vs{constructor(e){super(0,0),this._tripletFeel=e}doLayout(){super.doLayout(),this.height=25*this.scale}paint(e,t,s){e+=this.x,t+=this.y;let r=t+this.height*Se.GraceScale;s.font=this.renderer.resources.effectFont,s.fillText("(",e,t+this.height*.3);let n=e+10*this.scale,a=e+40*this.scale;switch(this._tripletFeel){case Pe.NoTripletFeel:this.renderBarNote(n,r,Qe.NoteScale,s,[wt.Full]),this.renderBarNote(a,r,Qe.NoteScale,s,[wt.Full]);break;case Pe.Triplet8th:this.renderBarNote(n,r,Qe.NoteScale,s,[wt.Full]),s.fillMusicFontSymbol(a,r,Qe.NoteScale,S.NoteQuarterUp,!1),s.fillMusicFontSymbol(a+Qe.NoteSeparation*this.scale,r,Qe.NoteScale,S.NoteEighthUp,!1),this.renderTriplet(a,t,s);break;case Pe.Triplet16th:this.renderBarNote(n,r,Qe.NoteScale,s,[wt.Full,wt.Full]),this.renderBarNote(a,r,Qe.NoteScale,s,[wt.Full,wt.PartialRight]),this.renderTriplet(a,t,s);break;case Pe.Dotted8th:this.renderBarNote(n,r,Qe.NoteScale,s,[wt.Full]),this.renderBarNote(a,r,Qe.NoteScale,s,[wt.Full,wt.PartialRight]),s.fillCircle(a+9*this.scale,r,this.scale);break;case Pe.Dotted16th:this.renderBarNote(n,r,Qe.NoteScale,s,[wt.Full,wt.Full]),this.renderBarNote(a,r,Qe.NoteScale,s,[wt.Full,wt.Full,wt.PartialRight]),s.fillCircle(a+9*this.scale,r,this.scale);break;case Pe.Scottish8th:this.renderBarNote(n,r,Qe.NoteScale,s,[wt.Full]),this.renderBarNote(a,r,Qe.NoteScale,s,[wt.Full,wt.PartialLeft]),s.fillCircle(a+Qe.NoteSeparation*this.scale+8*this.scale,r,this.scale);break;case Pe.Scottish16th:this.renderBarNote(n,r,Qe.NoteScale,s,[wt.Full,wt.Full]),this.renderBarNote(a,r,Qe.NoteScale,s,[wt.Full,wt.Full,wt.PartialLeft]),s.fillCircle(a+Qe.NoteSeparation*this.scale+8*this.scale,r,this.scale);break}s.fillText("=",e+30*this.scale,t+5*this.scale),s.fillText(")",e+65*this.scale,t+this.height*.3)}renderBarNote(e,t,s,r,n){r.fillMusicFontSymbol(e,t,s,S.NoteQuarterUp,!1);let a=Qe.NoteSeparation/2*this.scale;for(let o=0;o<n.length;o++)switch(n[o]){case wt.Full:r.fillRect(e+4*this.scale,t-Qe.NoteHeight*this.scale+Qe.BarSeparation*this.scale*o,Qe.NoteSeparation*this.scale,Qe.BarHeight*this.scale);break;case wt.PartialLeft:r.fillRect(e+4*this.scale,t-Qe.NoteHeight*this.scale+Qe.BarSeparation*this.scale*o,a,Qe.BarHeight*this.scale);break;case wt.PartialRight:r.fillRect(e+4*this.scale+a,t-Qe.NoteHeight*this.scale+Qe.BarSeparation*this.scale*o,a,Qe.BarHeight*this.scale);break}r.fillMusicFontSymbol(e+Qe.NoteSeparation*this.scale,t,s,S.NoteQuarterUp,!1)}renderTriplet(e,t,s){t+=2*this.scale;let r=this.renderer.resources.effectFont;s.font=Be.withFamilyList(r.families,r.size*.8,r.style);let n=e+Qe.NoteSeparation*this.scale+3*this.scale;s.beginPath(),s.moveTo(e,t+3*this.scale),s.lineTo(e,t),s.lineTo(e+5*this.scale,t),s.moveTo(n+5*this.scale,t+3*this.scale),s.lineTo(n+5*this.scale,t),s.lineTo(n,t),s.stroke(),s.fillText("3",e+7*this.scale,t-10*this.scale),s.font=r}}Qe.NoteScale=.4;Qe.NoteHeight=12;Qe.NoteSeparation=12;Qe.BarHeight=2;Qe.BarSeparation=3;class p4 extends Zt{get notationElement(){return me.EffectTripletFeel}get hideOnMultiTrack(){return!0}get canShareBand(){return!1}get sizingMode(){return Ve.SinglePreBeat}shouldCreateGlyph(e,t){return t.index===0&&(t.voice.bar.masterBar.index===0&&t.voice.bar.masterBar.tripletFeel!==Pe.NoTripletFeel||t.voice.bar.masterBar.index>0&&t.voice.bar.masterBar.tripletFeel!==t.voice.bar.masterBar.previousMasterBar.tripletFeel)}createNewGlyph(e,t){return new Qe(t.voice.bar.masterBar.tripletFeel)}canExpand(e,t){return!0}}class g4 extends Zt{get notationElement(){return me.EffectWhammyBar}get hideOnMultiTrack(){return!1}get canShareBand(){return!1}get sizingMode(){return Ve.GroupedOnBeat}shouldCreateGlyph(e,t){return t.hasWhammyBar}createNewGlyph(e,t){return new vn("w/bar")}canExpand(e,t){return!0}}class dS extends Zt{get notationElement(){return me.EffectWideBeatVibrato}get hideOnMultiTrack(){return!1}get canShareBand(){return!0}get sizingMode(){return Ve.GroupedOnBeatToEnd}shouldCreateGlyph(e,t){return t.vibrato===Ge.Wide}createNewGlyph(e,t){return new Z_(Ge.Wide)}canExpand(e,t){return!0}}class fS extends Wa{get notationElement(){return me.EffectWideNoteVibrato}shouldCreateGlyphForNote(e){return e.vibrato===Ge.Wide||e.isTieDestination&&e.tieOrigin.vibrato===Ge.Wide}get sizingMode(){return Ve.GroupedOnBeatToEnd}createNewGlyph(e,t){return new Ma(0,0,Ge.Wide,1.2)}}class pS{constructor(){this.x=0,this.width=0,this.masterBars=[]}}class m4 extends K_{get name(){return"HorizontalScreen"}constructor(e){super(e),this._system=null,this._pagePadding=null}get supportsResize(){return!1}get firstBarX(){let e=this._pagePadding[0];return this._system&&(e+=this._system.accoladeWidth),e}doResize(){}doLayoutAndRender(){switch(this._pagePadding=this.renderer.settings.display.padding,this.renderer.settings.display.systemsLayoutMode){case Jn.Automatic:this.systemsLayoutMode=fs.Automatic;break;case Jn.UseModelLayout:this.systemsLayoutMode=fs.FromModelWithWidths;break}this._pagePadding||(this._pagePadding=[0,0,0,0]),this._pagePadding.length===1?this._pagePadding=[this._pagePadding[0],this._pagePadding[0],this._pagePadding[0],this._pagePadding[0]]:this._pagePadding.length===2&&(this._pagePadding=[this._pagePadding[0],this._pagePadding[1],this._pagePadding[0],this._pagePadding[1]]);let e=this.renderer.score,t=this.renderer.settings.display.startBar;t--,t=Math.min(e.masterBars.length-1,Math.max(0,t));let s=t,r=this.renderer.settings.display.barCount;r<=0&&(r=e.masterBars.length),r=t+r-1,r=Math.min(e.masterBars.length-1,Math.max(0,r)),this._system=this.createEmptyStaffSystem(),this._system.isLast=!0,this._system.x=this._pagePadding[0],this._system.y=this._pagePadding[1];let n=this.renderer.settings.display.barCountPerPartial,a=[],o=new pS,l=0;for(;s<=r;){let h=this._system.addBars(this.renderer.tracks,s);if(h)if(o.masterBars.length===0&&h.isLinkedToPrevious&&a.length>0){let c=a[a.length-1];c.masterBars.push(e.masterBars[s]),c.width+=h.width,l+=h.width,o.x+=l}else o.masterBars.push(e.masterBars[s]),o.width+=h.width,o.masterBars.length>=n&&(a.length===0&&(o.width+=this._system.accoladeWidth+this._pagePadding[0]),l+=o.width,a.push(o),I.debug(this.name,"Finished partial from bar "+o.masterBars[0].index+" to "+o.masterBars[o.masterBars.length-1].index,null),o=new pS,o.x=l);s++}o.masterBars.length>0&&(a.length===0&&(o.width+=this._system.accoladeWidth+this._pagePadding[0]),a.push(o),I.debug(this.name,"Finished partial from bar "+o.masterBars[0].index+" to "+o.masterBars[o.masterBars.length-1].index,null)),this.finalizeStaffSystem(),this.height=Math.floor(this._system.y+this._system.height),this.width=this._system.x+this._system.width+this._pagePadding[2],s=0;let u=0;for(let h=0;h<a.length;h++){const c=a[h],d=new da;d.x=u,d.y=0,d.totalWidth=this.width,d.totalHeight=this.height,d.width=c.width,d.height=this.height,d.firstMasterBarIndex=c.masterBars[0].index,d.lastMasterBarIndex=c.masterBars[c.masterBars.length-1].index,u+=c.width;const f=s,p=h;this._system.buildBoundingsLookup(0,0),this.registerPartial(d,g=>{let b=this._system.getBarX(c.masterBars[0].index)+this._system.accoladeWidth;p===0&&(b-=this._system.x+this._system.accoladeWidth),g.color=this.renderer.settings.display.resources.mainGlyphColor,g.textAlign=de.Left,I.debug(this.name,"Rendering partial from bar "+c.masterBars[0].index+" to "+c.masterBars[c.masterBars.length-1].index,null),this._system.paintPartial(-b,this._system.y,g,f,c.masterBars.length)}),s+=c.masterBars.length}this.height=this.layoutAndRenderAnnotation(this.height)+this._pagePadding[3]}finalizeStaffSystem(){this._system.scaleToWidth(this._system.width),this._system.finalizeSystem()}}class y4 extends K_{get name(){return"PageView"}constructor(e){super(e),this._systems=[],this._allMasterBarRenderers=[],this._barsFromPreviousSystem=[],this._pagePadding=null}doLayoutAndRender(){switch(this.renderer.settings.display.systemsLayoutMode){case Jn.Automatic:this.systemsLayoutMode=fs.Automatic;break;case Jn.UseModelLayout:this.systemsLayoutMode=fs.FromModelWithScale;break}this._pagePadding=this.renderer.settings.display.padding,this._pagePadding||(this._pagePadding=[0,0,0,0]),this._pagePadding.length===1?this._pagePadding=[this._pagePadding[0],this._pagePadding[0],this._pagePadding[0],this._pagePadding[0]]:this._pagePadding.length===2&&(this._pagePadding=[this._pagePadding[0],this._pagePadding[1],this._pagePadding[0],this._pagePadding[1]]);let e=this._pagePadding[1];this.width=this.renderer.width,this._allMasterBarRenderers=[],e=this.layoutAndRenderScoreInfo(e,-1),e=this.layoutAndRenderTunings(e,-1),e=this.layoutAndRenderChordDiagrams(e,-1),e=this.layoutAndRenderScore(e),e=this.layoutAndRenderAnnotation(e),this.height=e+this._pagePadding[3]}get supportsResize(){return!0}get firstBarX(){let e=this._pagePadding[0];return this._systems.length>0&&(e+=this._systems[0].accoladeWidth),e}doResize(){let e=this._pagePadding[1];this.width=this.renderer.width;let t=this.height;e=this.layoutAndRenderScoreInfo(e,t),e=this.layoutAndRenderTunings(e,t),e=this.layoutAndRenderChordDiagrams(e,t),e=this.resizeAndRenderScore(e,t),e=this.layoutAndRenderAnnotation(e),this.height=e+this._pagePadding[3]}layoutAndRenderTunings(e,t=-1){if(!this.tuningGlyph)return e;let s=this.renderer.settings.display.resources;this.tuningGlyph.x=this._pagePadding[0],this.tuningGlyph.width=this.width,this.tuningGlyph.doLayout();let r=this.tuningGlyph.height;const n=new da;return n.x=0,n.y=e,n.width=this.width,n.height=r,n.totalWidth=this.width,n.totalHeight=t<0?e+n.height:t,this.registerPartial(n,a=>{a.color=s.scoreInfoColor,a.textAlign=de.Center,this.tuningGlyph.paint(0,0,a)}),e+r}layoutAndRenderChordDiagrams(e,t=-1){if(!this.chordDiagrams)return e;const s=this.renderer.settings.display.resources;this.chordDiagrams.width=this.width,this.chordDiagrams.doLayout();const r=Math.floor(this.chordDiagrams.height),n=new da;return n.x=0,n.y=e,n.width=this.width,n.height=r,n.totalWidth=this.width,n.totalHeight=t<0?e+r:t,this.registerPartial(n,a=>{a.color=s.scoreInfoColor,a.textAlign=de.Center,this.chordDiagrams.paint(0,0,a)}),e+r}layoutAndRenderScoreInfo(e,t=-1){I.debug(this.name,"Layouting score info");const s=new da;s.x=0,s.y=e;let r=0,n=this.scale,a=this.renderer.settings.display.resources,o=[me.ScoreTitle,me.ScoreSubTitle,me.ScoreArtist,me.ScoreAlbum,me.ScoreWordsAndMusic];for(let h=0;h<o.length;h++)if(this.scoreInfoGlyphs.has(o[h])){let c=this.scoreInfoGlyphs.get(o[h]);c.x=this.width/2,c.y=r,c.textAlign=de.Center,r+=c.font.size*n}let l=!1,u=0;if(this.scoreInfoGlyphs.has(me.ScoreMusic)){let h=this.scoreInfoGlyphs.get(me.ScoreMusic);h.x=this.width-this._pagePadding[2],h.y=r,h.textAlign=de.Right,l=!0,u=h.font.size*n}if(this.scoreInfoGlyphs.has(me.ScoreWords)){let h=this.scoreInfoGlyphs.get(me.ScoreWords);h.x=this._pagePadding[0],h.y=r,h.textAlign=de.Left,l=!0,u=h.font.size*n}return l&&(r+=u),this.scoreInfoGlyphs.size>0&&(r=Math.floor(r+17*this.scale),s.width=this.width,s.height=r,s.totalWidth=this.width,s.totalHeight=t<0?e+s.height:t,this.registerPartial(s,h=>{h.color=a.scoreInfoColor,h.textAlign=de.Center;for(const c of this.scoreInfoGlyphs.values())c.paint(0,0,h)})),e+r}resizeAndRenderScore(e,t){if(this.renderer.settings.display.barsPerRow>0||this.systemsLayoutMode==fs.FromModelWithScale)for(let r=0;r<this._systems.length;r++){let n=this._systems[r];this.fitSystem(n),e+=this.paintSystem(n,t)}else{this._systems=[];let r=0,n=this.maxWidth,a=this.createEmptyStaffSystem();for(a.index=this._systems.length,a.x=this._pagePadding[0],a.y=e;r<this._allMasterBarRenderers.length;){let o=this._allMasterBarRenderers[r];if(a.width+o.width<=n||a.masterBarsRenderers.length===0)a.addMasterBarRenderers(this.renderer.tracks,o),r++;else{for(;o&&!o.canWrap&&a.masterBarsRenderers.length>1;)o=a.revertLastBar(),r--;a.isFull=!0,a.isLast=this.lastBarIndex===a.lastBarIndex,this._systems.push(a),this.fitSystem(a),e+=this.paintSystem(a,t),a=this.createEmptyStaffSystem(),a.index=this._systems.length,a.x=this._pagePadding[0],a.y=e}}a.isLast=this.lastBarIndex===a.lastBarIndex,this.fitSystem(a),e+=this.paintSystem(a,t)}return e}layoutAndRenderScore(e){let s=this.firstBarIndex,r=this.lastBarIndex;for(this._systems=[];s<=r;){let n=this.createStaffSystem(s,r);this._systems.push(n),n.x=this._pagePadding[0],n.y=e,s=n.lastBarIndex+1,this.fitSystem(n),I.debug(this.name,"Rendering partial from bar "+n.firstBarIndex+" to "+n.lastBarIndex,null),e+=this.paintSystem(n,e)}return e}paintSystem(e,t){let s=Math.floor(e.height);const r=new da;return r.x=0,r.y=e.y,r.totalWidth=this.width,r.totalHeight=t,r.width=this.width,r.height=s,r.firstMasterBarIndex=e.firstBarIndex,r.lastMasterBarIndex=e.lastBarIndex,e.buildBoundingsLookup(0,0),this.registerPartial(r,n=>{this.renderer.canvas.color=this.renderer.settings.display.resources.mainGlyphColor,this.renderer.canvas.textAlign=de.Left,e.paint(0,-r.y,n)}),t+=s,s}fitSystem(e){e.isFull||e.width>this.maxWidth||this.renderer.settings.display.justifyLastSystem?e.scaleToWidth(this.maxWidth):e.scaleToWidth(e.width),e.finalizeSystem()}getBarsPerSystem(e){let t=this.renderer.settings.display.barsPerRow;if(this.systemsLayoutMode==fs.FromModelWithScale){let s,r;this.renderer.tracks.length>1?(s=this.renderer.score.defaultSystemsLayout,r=this.renderer.score.systemsLayout):(s=this.renderer.tracks[0].defaultSystemsLayout,r=this.renderer.tracks[0].systemsLayout),t=e<r.length?r[e]:s}return t}createStaffSystem(e,t){let s=this.createEmptyStaffSystem();s.index=this._systems.length;let r=this.getBarsPerSystem(s.index),n=this.maxWidth,a=t+1,o=e;for(;o<a;){if(this._barsFromPreviousSystem.length>0)for(let u of this._barsFromPreviousSystem)s.addMasterBarRenderers(this.renderer.tracks,u),o=u.masterBar.index;else{let u=s.addBars(this.renderer.tracks,o);u&&this._allMasterBarRenderers.push(u)}this._barsFromPreviousSystem=[];let l=!1;if((r===-1&&s.width>=n&&s.masterBarsRenderers.length!==0||s.masterBarsRenderers.length===r+1)&&(l=!0),l){let u=s.revertLastBar();if(u)for(this._barsFromPreviousSystem.push(u);u&&!u.canWrap&&s.masterBarsRenderers.length>1;)u=s.revertLastBar(),u&&this._barsFromPreviousSystem.push(u);return s.isFull=!0,s.isLast=!1,this._barsFromPreviousSystem.reverse(),s}s.x=0,o++}return s.isLast=t===s.lastBarIndex,s}get maxWidth(){return this.renderer.width-this._pagePadding[0]-this._pagePadding[2]}}class Hr extends Rt{constructor(e,t,s,r){super(e,t,r,Hr.getMusicSymbol(s)),this._accidentalType=s}static getMusicSymbol(e){switch(e){case ue.Natural:return S.AccidentalNatural;case ue.Sharp:return S.AccidentalSharp;case ue.Flat:return S.AccidentalFlat;case ue.NaturalQuarterNoteUp:return S.AccidentalQuarterToneNaturalArrowUp;case ue.SharpQuarterNoteUp:return S.AccidentalQuarterToneSharpArrowUp;case ue.FlatQuarterNoteUp:return S.AccidentalQuarterToneFlatArrowUp;case ue.DoubleSharp:return S.AccidentalDoubleSharp;case ue.DoubleFlat:return S.AccidentalDoubleFlat}return S.None}doLayout(){switch(this._accidentalType){case ue.DoubleFlat:this.width=18;break;default:this.width=8;break}this.width=this.width*this.glyphScale*this.scale}}class X0 extends Rt{constructor(e,t,s,r){super(e,t,1,X0.getSymbol(s)),this._clef=s,this._clefOttava=r}doLayout(){switch(this._clef){case ve.Neutral:this.width=15*this.scale;break;case ve.C3:case ve.C4:case ve.F4:case ve.G2:this.width=28*this.scale;break}}static getSymbol(e){switch(e){case ve.Neutral:return S.UnpitchedPercussionClef1;case ve.C3:return S.CClef;case ve.C4:return S.CClef;case ve.F4:return S.FClef;case ve.G2:return S.GClef;default:return S.None}}paint(e,t,s){super.paint(e,t,s);let r,n=!1;switch(this._clefOttava){case Ue._15ma:r=new Rt(-4*this.scale,0,.5,S.Quindicesima),n=!0;break;case Ue._8va:r=new Rt(-2*this.scale,0,.5,S.Ottava),n=!0;break;case Ue._8vb:r=new Rt(-6*this.scale,0,.5,S.Ottava);break;case Ue._15mb:r=new Rt(-8*this.scale,0,.5,S.Quindicesima);break;default:return}let a=0,o=0;switch(this._clef){case ve.Neutral:a=n?-12:15,o=0;break;case ve.C3:a=n?-19:27,o=0;break;case ve.C4:a=n?-19:27,o=0;break;case ve.F4:a=n?-9:27,o=-4;break;case ve.G2:a=n?-37:30,o=0;break;default:return}r.renderer=this.renderer,r.doLayout();let l=this.width/2;r.paint(e+this.x+l+o*this.scale,t+this.y+a*this.scale,s)}}class Dl extends vs{constructor(e,t,s){super(e,t),this._note=s}static getSymbol(e,t){switch(e){case _t.None:return S.None;case _t.Normal:return t?S.ArticAccentAbove:S.ArticAccentBelow;case _t.Heavy:return t?S.ArticMarcatoAbove:S.ArticMarcatoBelow;case _t.Tenuto:return t?S.ArticTenutoAbove:S.ArticTenutoBelow;default:return S.None}}doLayout(){this.width=9*this.scale,this.height=9*this.scale}paint(e,t,s){const r=this.renderer.getBeatDirection(this._note.beat),n=Dl.getSymbol(this._note.accentuated,r==R.Down),a=2*this.scale,o=r==R.Up?t+this.y:t+this.y+this.height-a;s.fillMusicFontSymbol(e+this.x-2*this.scale,o,this.scale,n,!1)}}class ku extends vt{constructor(e,t,s){super(e,t),this._size=0,this._size=s}doLayout(){this.width=this._size+3*this.scale}paint(e,t,s){s.fillCircle(e+this.x,t+this.y,this._size)}}class b4 extends Rt{constructor(e,t,s){super(e,t,s?Se.GraceScale:1,S.NoteheadXOrnate),this._isGrace=s}doLayout(){this.width=9*(this._isGrace?Se.GraceScale:1)*this.scale,this.height=Se.NoteHeadHeight*this.scale}}class Oc extends Rt{constructor(e,t,s,r){super(e,t,r?Se.GraceScale:1,Oc.getSymbol(s)),this._isGrace=r}static getSymbol(e){switch(e){case N.QuadrupleWhole:case N.DoubleWhole:case N.Whole:case N.Half:return S.NoteheadDiamondWhiteWide;default:return S.NoteheadDiamondBlackWide}}doLayout(){this.width=9*(this._isGrace?Se.GraceScale:1)*this.scale,this.height=Se.NoteHeadHeight*this.scale}}class Gt extends vt{constructor(e,t,s){super(0,0),this.yOffset=0,this.startNoteRenderer=null,this.endNoteRenderer=null,this.tieDirection=R.Up,this._startX=0,this._startY=0,this._endX=0,this._endY=0,this._tieHeight=0,this._shouldDraw=!1,this.startBeat=e,this.endBeat=t,this.forEnd=s}doLayout(){if(this.width=0,!this.endBeat){this._shouldDraw=!1;return}let e=this.renderer.scoreRenderer.layout.getRendererForBar(this.renderer.staff.staveId,this.startBeat.voice.bar);this.startNoteRenderer=e;let t=this.renderer.scoreRenderer.layout.getRendererForBar(this.renderer.staff.staveId,this.endBeat.voice.bar);this.endNoteRenderer=t,this._startX=0,this._endX=0,this._startY=0,this._endY=0,this.height=0,this._shouldDraw=!1,this.tieDirection=e?this.getBeamDirection(this.startBeat,e):this.getBeamDirection(this.endBeat,t),!this.forEnd&&e?(e!==t?(this._startX=e.x+this.getStartX(),this._startY=e.y+this.getStartY()+this.yOffset,!t||e.staff!==t.staff?(this._endX=e.x+e.width,this._endY=this._startY):(this._endX=t.x+this.getEndX(),this._endY=t.y+this.getEndY()+this.yOffset)):(this._startX=e.x+this.getStartX(),this._endX=t.x+this.getEndX(),this._startY=e.y+this.getStartY()+this.yOffset,this._endY=t.y+this.getEndY()+this.yOffset),this._shouldDraw=!0):(!e||e.staff!==t.staff)&&(this._startX=t.x,this._endX=t.x+this.getEndX(),this._startY=t.y+this.getEndY()+this.yOffset,this._endY=this._startY,this._shouldDraw=!0),this._shouldDraw&&(this.y=Math.min(this._startY,this._endY),this.shouldDrawBendSlur()?this._tieHeight=0:(this._tieHeight=this.getTieHeight(this._startX,this._startY,this._endX,this._endY),this.height=Gt.calculateActualTieHeight(this.renderer.scale,this._startX,this._startY,this._endX,this._endY,this.tieDirection===R.Down,this._tieHeight,4).h),this.tieDirection===R.Up&&(this.y-=this.height))}paint(e,t,s){this._shouldDraw&&(this.shouldDrawBendSlur()?Gt.drawBendSlur(s,e+this._startX,t+this._startY,e+this._endX,t+this._endY,this.tieDirection===R.Down,this.scale):Gt.paintTie(s,this.scale,e+this._startX,t+this._startY,e+this._endX,t+this._endY,this.tieDirection===R.Down,this._tieHeight,4))}shouldDrawBendSlur(){return!1}getTieHeight(e,t,s,r){return 22}getBeamDirection(e,t){return R.Down}getStartY(){return 0}getEndY(){return 0}getStartX(){return 0}getEndX(){return 0}static calculateActualTieHeight(e,t,s,r,n,a,o,l){const u=Gt.computeBezierControlPoints(e,t,s,r,n,a,o,l);t=u[0],s=u[1];const h=u[2],c=u[3];r=u[6],n=u[7];const d=(t-h)/(t-2*h+r),f=Gt.calculateExtrema(t,s,h,c,r,n,d),p=f.length>0?Math.min(t,r,f[0]):Math.min(t,r),g=f.length>0?Math.max(t,r,f[0]):Math.max(t,r),b=(s-c)/(s-2*c+n),m=Gt.calculateExtrema(t,s,h,c,r,n,b),y=m.length>0?Math.min(s,n,m[1]):Math.min(s,n),w=m.length>0?Math.max(s,n,m[1]):Math.max(s,n),x=new Wi;return x.x=p,x.y=y,x.w=g-p,x.h=w-y,x}static calculateExtrema(e,t,s,r,n,a,o){if(o<=0||1<=o)return[];const l=e+(s-e)*o,u=t+(r-t)*o,h=s+(n-s)*o,c=r+(a-r)*o;return[l+(h-l)*o,u+(c-u)*o]}static computeBezierControlPoints(e,t,s,r,n,a,o,l){if(t===r&&s===n)return[];if(r<t){let y=t;t=r,r=y,y=s,s=n,n=y}o*=e,l*=e;let u=n-s,h=r-t,c=Math.sqrt(u*u+h*h);a?u*=-1:h*=-1,u/=c,h/=c;let d=(r+t)/2,f=(n+s)/2,p=d+o*u,g=f+o*h,b=d+(o-l)*u,m=f+(o-l)*h;return[t,s,p,g,b,m,r,n]}static paintTie(e,t,s,r,n,a,o=!1,l=22,u=4){const h=Gt.computeBezierControlPoints(t,s,r,n,a,o,l,u);e.beginPath(),e.moveTo(h[0],h[1]),e.quadraticCurveTo(h[2],h[3],h[6],h[7]),e.quadraticCurveTo(h[4],h[5],h[0],h[1]),e.closePath(),e.fill()}static drawBendSlur(e,t,s,r,n,a,o,l){let u=n-s,h=r-t,c=Math.sqrt(u*u+h*h);a?u*=-1:h*=-1,u/=c,h/=c;let d=(r+t)/2,f=(n+s)/2,p=Gt.BendSlurHeight*o;r-t<20&&(p/=2);let g=d+p*u,b=f+p*h;if(e.beginPath(),e.moveTo(t,s),e.lineTo(g,b),e.lineTo(r,n),e.stroke(),l){let m=e.measureText(l).width,y=a?0:-e.font.size;e.fillText(l,g-m/2,b+y)}}}Gt.BendSlurHeight=11;class Wo extends vt{constructor(e){super(0,0),this._isOpen=e}doLayout(){super.doLayout(),this.width=Wo.Size*this.scale}paint(e,t,s){this._isOpen?Gt.paintTie(s,this.scale,e+this.x+this.width,t+this.y+this.height,e+this.x+this.width,t+this.y,!1,6,3):Gt.paintTie(s,this.scale,e+this.x,t+this.y,e+this.x,t+this.y+this.height,!1,6,3)}}Wo.Size=6;class S4{constructor(e,t){this.line=0,this.line=e,this.isGhost=t}}class Fc extends vt{constructor(e){super(0,0),this._infos=[],this._glyphs=[],this.isEmpty=!0,this._isOpen=e}addParenthesis(e){let t=this.renderer,s=t.getNoteLine(e),r=e.isGhost||this.isTiedBend(e)&&t.settings.notation.isNotationElementVisible(me.ParenthesisOnTiedBends);this.addParenthesisOnLine(s,r)}addParenthesisOnLine(e,t){let s=new S4(e,t);this._infos.push(s),t&&(this.isEmpty=!1)}isTiedBend(e){return e.isTieDestination?e.tieOrigin.hasBend?!0:this.isTiedBend(e.tieOrigin):!1}doLayout(){let e=this.renderer;this._infos.sort((r,n)=>r.line-n.line);let t=null,s=e.getScoreHeight(1);for(let r=0,n=this._infos.length;r<n;r++){let a;if(!this._infos[r].isGhost)t=null;else if(!t)a=new Wo(this._isOpen),a.renderer=this.renderer,a.y=e.getScoreY(this._infos[r].line)-s,a.height=s*2,a.doLayout(),this._glyphs.push(a),t=a;else{let o=e.getScoreY(this._infos[r].line)+s;t.height=o-t.y}}this.width=this._glyphs.length>0?this._glyphs[0].width:0}paint(e,t,s){super.paint(e,t,s);for(let r of this._glyphs)r.paint(e+this.x,t+this.y,s)}}class w4{constructor(e,t){this.line=0,this.glyph=e,this.line=t}}class eT extends vt{constructor(){super(0,0),this._infos=[],this._noteHeadPadding=0,this.minNote=null,this.maxNote=null,this.spacingChanged=new Jt,this.upLineX=0,this.downLineX=0,this.displacedX=0,this.noteStartX=0}add(e,t){let s=new w4(e,t);this._infos.push(s),(!this.minNote||this.minNote.line>s.line)&&(this.minNote=s),(!this.maxNote||this.maxNote.line<s.line)&&(this.maxNote=s)}get hasTopOverflow(){return!!this.minNote&&this.minNote.line<=0}get hasBottomOverflow(){return!!this.maxNote&&this.maxNote.line>8}doLayout(){this._infos.sort((o,l)=>l.line-o.line);let e=0,t=!1,s=0,r=!1,n=this.direction,a=0;for(let o=0,l=this._infos.length;o<l;o++){let u=this._infos[o].glyph;u.renderer=this.renderer,u.doLayout();let h=!1;o===0?e=u.width:Math.abs(s-this._infos[o].line)<=1?t?t=!1:(h=!0,u.x=e,r=!0,t=!0):t=!1,n===R.Down?u.x=h?0:e:u.x=h?e:0,u.x+=this.noteStartX,s=this._infos[o].line,a=Math.max(a,u.x+u.width)}r?(this._noteHeadPadding=0,this.upLineX=e,this.downLineX=e):(this._noteHeadPadding=n===R.Down?-e:0,a+=this._noteHeadPadding,this.upLineX=a,this.downLineX=0),this.displacedX=e,this.width=a}paint(e,t,s){e+=this.x,t+=this.y;let r=this.renderer,n=3*this.scale,a=this.width-this.noteStartX+n*2;if(this.hasTopOverflow){let u=s.color;s.color=r.resources.staffLineColor;let h=-2;for(;h>=this.minNote.line;){let c=t+r.getScoreY(h);s.fillRect(e-n+this.noteStartX,c,a,this.scale),h-=2}s.color=u}if(this.hasBottomOverflow){let u=s.color;s.color=r.resources.staffLineColor;let h=10;for(;h<=this.maxNote.line;){let c=t+r.getScoreY(h);s.fillRect(e-n+this.noteStartX,c,a,this.scale),h+=2}s.color=u}let o=this._infos,l=e+this._noteHeadPadding;for(let u of o)u.glyph.renderer=this.renderer,u.glyph.paint(l,t,s)}}class Hd extends Rt{constructor(e,t,s){super(e,t,1,Hd.getSymbol(s))}doLayout(){this.width=12*this.scale}static getSymbol(e){switch(e){case N.ThirtySecond:return S.Tremolo3;case N.Sixteenth:return S.Tremolo2;case N.Eighth:return S.Tremolo1;default:return S.None}}}class v4 extends eT{constructor(){super(),this._noteGlyphLookup=new Map,this._notes=[],this._tremoloPicking=null,this.aboveBeatEffects=new Map,this.belowBeatEffects=new Map}get direction(){return this.beamingHelper.direction}getNoteX(e,t){if(this._noteGlyphLookup.has(e.id)){let s=this._noteGlyphLookup.get(e.id),r=this.x+s.x+this._noteHeadPadding;switch(t){case Ze.Left:break;case Ze.Center:r+=s.width/2;break;case Ze.Right:r+=s.width;break}return r}return 0}getNoteY(e,t){if(this._noteGlyphLookup.has(e.id)){const s=this._noteGlyphLookup.get(e.id);let r=this.y+s.y;switch(t){case q.TopWithStem:r-=this.renderer.getStemSize(this.beamingHelper);break;case q.Top:r-=s.height/2;break;case q.Center:break;case q.Bottom:r+=s.height/2;break;case q.BottomWithStem:r+=this.renderer.getStemSize(this.beamingHelper);break}return r}return 0}addNoteGlyph(e,t,s){super.add(e,s),this._noteGlyphLookup.set(t.id,e),this._notes.push(t)}updateBeamingHelper(e){this.beamingHelper&&this.beamingHelper.registerBeatLineX("score",this.beat,e+this.x+this.upLineX,e+this.x+this.downLineX)}doLayout(){super.doLayout();let e=this.renderer,t=this.direction,s=0,r=0,n=1,a=-n;this.direction===R.Up?(r=e.getScoreY(this.minNote.line),s=e.getScoreY(this.maxNote.line-2)):(r=e.getScoreY(this.minNote.line-1),s=e.getScoreY(this.maxNote.line+1),a*=-1,n*=-1);let o=null,l=null;for(const u of this.aboveBeatEffects.values())u.renderer=this.renderer,u.doLayout(),s+=a*u.height,u.y=s,(o===null||o>s)&&(o=s),(l===null||l<s)&&(l=s);for(const u of this.belowBeatEffects.values())u.renderer=this.renderer,u.doLayout(),r+=n*u.height,u.y=r,(o===null||o>r)&&(o=r),(l===null||l<r)&&(l=r);if(o!==null&&e.registerBeatEffectOverflows(o,l??0),this.beat.isTremolo){let u=0,h=t===R.Up?this.minNote:this.maxNote,c=t===R.Up?this.displacedX:0,d=this.beat.tremoloSpeed;switch(d){case N.ThirtySecond:u=t===R.Up?-15:15;break;case N.Sixteenth:u=t===R.Up?-12:15;break;case N.Eighth:u=t===R.Up?-10:10;break;default:u=t===R.Up?-10:15;break}this.beat.duration<N.Half&&(c=this.width/2),this._tremoloPicking=new Hd(c,h.glyph.y+u*this.scale,d),this._tremoloPicking.renderer=this.renderer,this._tremoloPicking.doLayout()}}buildBoundingsLookup(e,t,s){for(let r of this._notes)if(this._noteGlyphLookup.has(r.id)){let n=this._noteGlyphLookup.get(r.id),a=new Ru;a.note=r,a.noteHeadBounds=new Wi,a.noteHeadBounds.x=t+this.x+this._noteHeadPadding+n.x,a.noteHeadBounds.y=s+this.y+n.y-n.height/2,a.noteHeadBounds.w=n.width,a.noteHeadBounds.h=n.height,e.addNote(a)}}paint(e,t,s){for(const r of this.aboveBeatEffects.values())r.paint(e+this.x+2*this.scale,t+this.y,s);for(const r of this.belowBeatEffects.values())r.paint(e+this.x+2*this.scale,t+this.y,s);super.paint(e,t,s),this._tremoloPicking&&this._tremoloPicking.paint(e,t,s)}}class Ea extends Rt{constructor(e,t,s){super(e,t,1,Ea.getSymbol(s)),this._duration=s}static getSymbol(e){switch(e){case N.QuadrupleWhole:return S.RestLonga;case N.DoubleWhole:return S.RestDoubleWhole;case N.Whole:return S.RestWhole;case N.Half:return S.RestHalf;case N.Quarter:return S.RestQuarter;case N.Eighth:return S.RestEighth;case N.Sixteenth:return S.RestSixteenth;case N.ThirtySecond:return S.RestThirtySecond;case N.SixtyFourth:return S.RestSixtyFourth;case N.OneHundredTwentyEighth:return S.RestOneHundredTwentyEighth;case N.TwoHundredFiftySixth:return S.RestTwoHundredFiftySixth;default:return S.None}}static getSize(e){switch(e){case N.QuadrupleWhole:case N.DoubleWhole:case N.Whole:case N.Half:case N.Quarter:case N.Eighth:case N.Sixteenth:return 9;case N.ThirtySecond:return 12;case N.SixtyFourth:return 14;case N.OneHundredTwentyEighth:case N.TwoHundredFiftySixth:return 20}return 10}doLayout(){this.width=Ea.getSize(this._duration)*this.scale}updateBeamingHelper(e){this.beamingHelper&&this.beamingHelper.registerBeatLineX("score",this.beat,e+this.x+this.width/2,e+this.x+this.width/2)}}class gS{constructor(){this.x=0,this.y=-3e3,this.width=0}}class Q0 extends qs{constructor(){super(0,0)}doLayout(){if(!this.glyphs||this.glyphs.length===0){this.width=0;return}this.glyphs.sort((s,r)=>s.y<r.y?-1:s.y>r.y?1:0);let e=[];e.push(new gS);let t=21*this.scale;for(let s=0,r=this.glyphs.length;s<r;s++){let n=this.glyphs[s];n.renderer=this.renderer,n.doLayout();let a=0;for(;e[a].y>n.y;)a++,a===e.length&&e.push(new gS);n.x=a,e[a].y=n.y+t,e[a].width<n.width&&(e[a].width=n.width)}this.width=0;for(const s of e)this.width+=s.width,s.x=this.width;for(let s=0,r=this.glyphs.length;s<r;s++){let n=this.glyphs[s];const a=e[n.x];n.x=this.width-a.x}}}class ts extends eT{get direction(){return R.Up}constructor(e,t=!1){super(),this._showParenthesis=!1,this._noteValueLookup=new Map,this._accidentals=new Q0,this._preNoteParenthesis=null,this._postNoteParenthesis=null,this.isEmpty=!0,this.noteHeadOffset=0,this._beat=e,this._showParenthesis=t,t&&(this._preNoteParenthesis=new Fc(!0),this._postNoteParenthesis=new Fc(!1))}containsNoteValue(e){return this._noteValueLookup.has(e)}getNoteValueY(e){return this._noteValueLookup.has(e)?this.y+this._noteValueLookup.get(e).y:0}addGlyph(e,t=!1){let s=this.renderer,r=new Se(0,0,N.Quarter,!0),n=s.accidentalHelper.applyAccidentalForValue(this._beat,e,t,!0),a=s.accidentalHelper.getNoteLineForValue(e,!1);if(r.y=s.getScoreY(a),this._showParenthesis&&(this._preNoteParenthesis.renderer=this.renderer,this._postNoteParenthesis.renderer=this.renderer,this._preNoteParenthesis.addParenthesisOnLine(a,!0),this._postNoteParenthesis.addParenthesisOnLine(a,!0)),n!==ue.None){let o=new Hr(0,r.y,n,Se.GraceScale);o.renderer=this.renderer,this._accidentals.renderer=this.renderer,this._accidentals.addGlyph(o)}this._noteValueLookup.set(e,r),this.add(r,a),this.isEmpty=!1}doLayout(){let e=0;this._showParenthesis&&(this._preNoteParenthesis.x=e,this._preNoteParenthesis.renderer=this.renderer,this._preNoteParenthesis.doLayout(),e+=this._preNoteParenthesis.width+ts.ElementPadding*this.scale),this._accidentals.isEmpty||(e+=this._accidentals.width+ts.ElementPadding*this.scale,this._accidentals.x=e,this._accidentals.renderer=this.renderer,this._accidentals.doLayout(),e+=this._accidentals.width+ts.ElementPadding*this.scale),this.noteStartX=e,super.doLayout(),this.noteHeadOffset=this.noteStartX+(this.width-this.noteStartX)/2,this._showParenthesis&&(this._postNoteParenthesis.x=this.width+ts.ElementPadding*this.scale,this._postNoteParenthesis.renderer=this.renderer,this._postNoteParenthesis.doLayout(),this.width+=this._postNoteParenthesis.width+ts.ElementPadding*this.scale)}paint(e,t,s){this._accidentals.isEmpty||this._accidentals.paint(e+this.x,t+this.y,s),this._showParenthesis&&(this._preNoteParenthesis.paint(e+this.x,t+this.y,s),this._postNoteParenthesis.paint(e+this.x,t+this.y,s)),super.paint(e,t,s)}}ts.ElementPadding=2;class J0 extends vt{constructor(){super(...arguments),this.BendNoteHeads=[]}drawBendSlur(e,t,s,r,n,a,o,l){Gt.drawBendSlur(e,t,s,r,n,a,o,l)}doLayout(){super.doLayout(),this.width=0;for(let e of this.BendNoteHeads)e.doLayout(),this.width+=e.width+10*this.scale}getTieDirection(e,t){switch(t.getBeatDirection(e)){case R.Up:return R.Down;default:return R.Up}}}J0.EndPadding=(10/2|0)+3;class Nn extends G{constructor(e=0,t=0){super(e,t),this.lineValue=0,this.lineValue=t}}class Us extends vt{constructor(){super(0,0),this._notes=[],this._renderPoints=new Map,this._preBendMinValue=-1,this._bendMiddleMinValue=-1,this._bendEndMinValue=-1,this._bendEndContinuedMinValue=-1,this._releaseMinValue=-1,this._releaseContinuedMinValue=-1,this._maxBendValue=-1}addBends(e){this._notes.push(e);let t=this.createRenderingPoints(e);this._renderPoints.set(e.id,t),(this._maxBendValue===-1||this._maxBendValue<e.maxBendPoint.value)&&(this._maxBendValue=e.maxBendPoint.value);let s=0;switch(e.bendType){case se.Bend:s=t[1].value,e.isTieOrigin?(this._bendEndContinuedMinValue===-1||s<this._bendEndContinuedMinValue)&&(this._bendEndContinuedMinValue=s):(this._bendEndMinValue===-1||s<this._bendEndMinValue)&&(this._bendEndMinValue=s);break;case se.Release:s=t[1].value,e.isTieOrigin?(this._releaseContinuedMinValue===-1||s<this._releaseContinuedMinValue)&&(this._releaseContinuedMinValue=s):s>0&&(this._releaseMinValue===-1||s<this._releaseMinValue)&&(this._releaseMinValue=s);break;case se.BendRelease:s=t[1].value,(this._bendMiddleMinValue===-1||s<this._bendMiddleMinValue)&&(this._bendMiddleMinValue=s),s=t[2].value,e.isTieOrigin?(this._releaseContinuedMinValue===-1||s<this._releaseContinuedMinValue)&&(this._releaseContinuedMinValue=s):s>0&&(this._releaseMinValue===-1||s<this._releaseMinValue)&&(this._releaseMinValue=s);break;case se.Prebend:s=t[0].value,(this._preBendMinValue===-1||s<this._preBendMinValue)&&(this._preBendMinValue=s);break;case se.PrebendBend:s=t[0].value,(this._preBendMinValue===-1||s<this._preBendMinValue)&&(this._preBendMinValue=s),s=t[1].value,e.isTieOrigin?(this._bendEndContinuedMinValue===-1||s<this._bendEndContinuedMinValue)&&(this._bendEndContinuedMinValue=s):(this._bendEndMinValue===-1||s<this._bendEndMinValue)&&(this._bendEndMinValue=s);break;case se.PrebendRelease:s=t[0].value,(this._preBendMinValue===-1||s<this._preBendMinValue)&&(this._preBendMinValue=s),s=t[1].value,e.isTieOrigin?(this._releaseContinuedMinValue===-1||s<this._releaseContinuedMinValue)&&(this._releaseContinuedMinValue=s):s>0&&(this._releaseMinValue===-1||s<this._releaseMinValue)&&(this._releaseMinValue=s);break}}doLayout(){super.doLayout();let e=this._maxBendValue*Us.BendValueHeight*this.scale;this.renderer.registerOverflowTop(e);let t=0;for(let s of this._notes){let r=this._renderPoints.get(s.id);switch(s.bendType){case se.Bend:r[1].lineValue=s.isTieOrigin?this._bendEndContinuedMinValue:this._bendEndMinValue;break;case se.Release:t=s.isTieOrigin?this._releaseContinuedMinValue:this._releaseMinValue,t>=0&&(r[1].lineValue=t);break;case se.BendRelease:r[1].lineValue=this._bendMiddleMinValue,t=s.isTieOrigin?this._releaseContinuedMinValue:this._releaseMinValue,t>=0&&(r[2].lineValue=t);break;case se.Prebend:r[0].lineValue=this._preBendMinValue;break;case se.PrebendBend:r[0].lineValue=this._preBendMinValue,r[1].lineValue=s.isTieOrigin?this._bendEndContinuedMinValue:this._bendEndMinValue;break;case se.PrebendRelease:r[0].lineValue=this._preBendMinValue,t=s.isTieOrigin?this._releaseContinuedMinValue:this._releaseMinValue,t>=0&&(r[1].lineValue=t);break}}this.width=0,this._notes.sort((s,r)=>s.isStringed?s.string-r.string:s.realValue-r.realValue)}createRenderingPoints(e){let t=[];switch(e.bendType){case se.Custom:for(let s of e.bendPoints)t.push(new Nn(s.offset,s.value));break;case se.BendRelease:t.push(new Nn(0,e.bendPoints[0].value)),t.push(new Nn(G.MaxPosition/2|0,e.bendPoints[1].value)),t.push(new Nn(G.MaxPosition,e.bendPoints[3].value));break;case se.Bend:case se.Hold:case se.Prebend:case se.PrebendBend:case se.PrebendRelease:case se.Release:t.push(new Nn(0,e.bendPoints[0].value)),t.push(new Nn(G.MaxPosition,e.bendPoints[1].value));break}return t}paint(e,t,s){let r=s.color;this._notes.length>1&&(s.color=this.renderer.resources.secondaryGlyphColor);for(let n of this._notes){let a=this._renderPoints.get(n.id),o=this.renderer,l=n,u=!1,h=null,c=!1,d=n.bendStyle===qe.Gradual?"grad.":"",f=null;for(;l.isTieOrigin;){let w=l.tieDestination;if(h=this.renderer.scoreRenderer.layout.getRendererForBar(this.renderer.staff.staveId,w.beat.voice.bar),!h||o.staff!==h.staff)break;if(l=w,u=!0,l.hasBend||!this.renderer.settings.notation.extendBendArrowsOnTiedNotes){c=!0;break}}f=l.beat,h=this.renderer.scoreRenderer.layout.getRendererForBar(this.renderer.staff.staveId,f.voice.bar),f.isLastOfVoice&&!l.hasBend&&this.renderer.settings.notation.extendBendArrowsOnTiedNotes&&(f=null);let p=0,g=0,b=t+o.y;p=e+o.x,a[0].value>0||n.isContinuedBend?p+=o.getBeatX(n.beat,_e.MiddleNotes):p+=o.getNoteX(n,Ze.Right),!f||f.isLastOfVoice&&!c?g=e+h.x+h.postBeatGlyphsStart:c||!f.nextBeat?g=e+h.x+h.getBeatX(f,_e.MiddleNotes):n.bendType===se.Hold?g=e+h.x+h.getBeatX(f.nextBeat,_e.OnNotes):g=e+h.x+h.getBeatX(f.nextBeat,_e.PreNotes),u||(g-=Us.ArrowSize*this.scale);let y=(g-p)/G.MaxPosition;s.beginPath();for(let w=0,x=a.length-1;w<x;w++){let k=a[w],_=a[w+1];w===0&&k.value!==0&&!n.isTieDestination&&this.paintBend(n,new Nn(0,0),k,p,b,y,d,s),n.bendType!==se.Prebend?(w===0&&(p+=2*this.scale),this.paintBend(n,k,_,p,b,y,d,s)):n.isTieOrigin&&n.tieDestination.hasBend&&(_=new Nn(G.MaxPosition,k.value),_.lineValue=k.lineValue,this.paintBend(n,k,_,p,b,y,d,s))}s.color=r}}paintBend(e,t,s,r,n,a,o,l){let u=this.renderer,h=this.renderer.resources,c=u.lineOffset/2,d=r+a*t.offset,f=Us.BendValueHeight*this.scale,p=n-f*t.lineValue;t.value===0?s.offset===t.offset?p+=u.getNoteY(e.beat.maxStringNote,q.Top):p+=u.getNoteY(e,q.Center):p+=c;let g=r+a*s.offset,b=n-f*s.lineValue;s.lineValue===0?b+=u.getNoteY(e,q.Center):b+=c;let m=0,y=Us.ArrowSize*this.scale;if(s.value>t.value?(b+y>p&&(b=p-y),l.beginPath(),l.moveTo(g,b),l.lineTo(g-y*.5,b+y),l.lineTo(g+y*.5,b+y),l.closePath(),l.fill(),m=y):s.value!==t.value&&(b<p&&(b=p+y),l.beginPath(),l.moveTo(g,b),l.lineTo(g-y*.5,b-y),l.lineTo(g+y*.5,b-y),l.closePath(),l.fill(),m=-y),l.stroke(),t.value===s.value){if(t.lineValue>0){let w=g,x=Us.DashSize*this.scale,k=d+x;if((w-d)/(x*2)<1)l.moveTo(w,p),l.lineTo(d,p);else for(;w>k;)l.moveTo(w,p),l.lineTo(w-x,p),w-=x*2;l.stroke()}}else g>d?(l.moveTo(d,p),l.bezierCurveTo((d+g)/2,p,g,p,g,b+m),l.stroke()):(l.moveTo(d,p),l.lineTo(g,b),l.stroke());if(o&&t.offset<s.offset){l.font=h.graceFont;let w=l.measureText(o).width,x=0,k=0;if(p>b){let _=Math.abs(p-b);x=_>l.font.size*1.3?p-_/2:p,k=(d+g-w)/2}else x=p,k=g-w;l.fillText(o,k,x)}if(s.value!==0&&t.value!==s.value){let w=s.value,x=s.value>t.value;w=Math.abs(w);let k="";if(w===4)k="full",w-=4;else if(w>=4||w<=-4){let _=w/4|0;k+=_,w-=_*4}if(w>0&&(k+=Us.getFractionSign(w)),k!==""){b=n-f*s.value;let _=b;x||(_=p+Math.abs(b-p)*1/3),l.font=h.tablatureFont;let T=l.measureText(k).width,C=_-h.tablatureFont.size*.5-2*this.scale,W=g-T/2;l.fillText(k,W,C)}}}static getFractionSign(e){switch(e){case 1:return"¼";case 2:return"½";case 3:return"¾";default:return e+"/ 4"}}}Us.ArrowSize=6;Us.DashSize=3;Us.BendValueHeight=6;class _s extends vt{constructor(e){super(0,0),this._isSimpleDip=!1,this._beat=e,this._renderPoints=this.createRenderingPoints(e)}createRenderingPoints(e){if(e.whammyBarType===je.Custom)return e.whammyBarPoints;let t=[];switch(e.whammyBarType){case je.Dive:case je.Hold:case je.PrediveDive:case je.Predive:t.push(new G(0,e.whammyBarPoints[0].value)),t.push(new G(G.MaxPosition,e.whammyBarPoints[1].value));break;case je.Dip:t.push(new G(0,e.whammyBarPoints[0].value)),t.push(new G(G.MaxPosition/2|0,e.whammyBarPoints[1].value)),t.push(new G(G.MaxPosition,e.whammyBarPoints[e.whammyBarPoints.length-1].value));break}return t}doLayout(){super.doLayout(),this._isSimpleDip=this.renderer.settings.notation.notationMode===Qt.SongBook&&this._beat.whammyBarType===je.Dip;let e=null,t=null,s=this._beat;for(;s&&s.hasWhammyBar;)(!e||e.value>s.minWhammyPoint.value)&&(e=s.minWhammyPoint),(!t||t.value<s.maxWhammyPoint.value)&&(t=s.maxWhammyPoint),s=s.nextBeat;let r=t.value>0?Math.abs(this.getOffset(t.value)):0;(r>0||this._beat.whammyBarPoints[0].value!==0||this.renderer.settings.notation.isNotationElementVisible(me.ZerosOnDiveWhammys))&&(r+=this.renderer.resources.tablatureFont.size*2);let n=e.value<0?Math.abs(this.getOffset(e.value)):0;this.renderer.registerOverflowTop(r+n);let a=this.renderer.staff.getSharedLayoutData(_s.TopOffsetSharedDataKey,-1);r>a&&this.renderer.staff.setSharedLayoutData(_s.TopOffsetSharedDataKey,r)}getOffset(e){if(e===0)return 0;let t=_s.PerHalfSize*this.scale+Math.log2(Math.abs(e)/2)*_s.PerHalfSize*this.scale;return e<0&&(t=-t),t}paint(e,t,s){let r=this.renderer,n=this._beat.nextBeat,a=null,o=_e.PreNotes;n&&(a=this.renderer.scoreRenderer.layout.getRendererForBar(this.renderer.staff.staveId,n.voice.bar),!a||a.staff!==r.staff||a!==r&&!n.hasWhammyBar?(n=null,a=null):o=n.hasWhammyBar&&(r.settings.notation.notationMode!==Qt.SongBook||n.whammyBarType!==je.Dip)?_e.MiddleNotes:_e.PreNotes);let l=0,u=0;this._isSimpleDip?(l=e+r.x+r.getBeatX(this._beat,_e.OnNotes)-2*this.scale,u=e+r.x+r.getBeatX(this._beat,_e.PostNotes)+2*this.scale):(l=e+r.x+r.getBeatX(this._beat,_e.MiddleNotes),u=a?e+a.x+a.getBeatX(n,o):e+r.x+r.width-2*this.scale);let h=s.textAlign;if(s.textAlign=de.Center,this._renderPoints.length>=2){let c=(u-l)/G.MaxPosition;s.beginPath();let d=t+this.renderer.staff.getSharedLayoutData(_s.TopOffsetSharedDataKey,0),f=this._beat.whammyStyle===qe.Gradual?"grad.":"";for(let p=0,g=this._renderPoints.length-1;p<g;p++){let b=this._renderPoints[p],m=this._renderPoints[p+1],y=p<g-2?this._renderPoints[p+2]:null,w=p===0;p===0&&b.value!==0&&!this._beat.isContinuedWhammy&&(this.paintWhammy(!1,new G(0,0),b,m,l,d,c,s),w=!1),this.paintWhammy(w,b,m,y,l,d,c,s,f),f=""}s.stroke()}s.textAlign=h}paintWhammy(e,t,s,r,n,a,o,l,u){let h=n+o*t.offset,c=n+o*s.offset,d=a-this.getOffset(t.value),f=a-this.getOffset(s.value);if(t.offset===s.offset){let b=_s.DashSize*this.scale;if(Math.abs(f-d)/(b*2)<1)l.moveTo(h,d),l.lineTo(c,f);else{let y=Math.max(d,f),w=Math.min(d,f);for(;y>w;)l.moveTo(h,w),l.lineTo(h,w+b),w+=b*2}l.stroke()}else if(t.value===s.value){let b=_s.DashSize*this.scale;if(Math.abs(c-h)/(b*2)<1)l.moveTo(h,d),l.lineTo(c,f);else{let y=Math.max(h,c),w=Math.min(h,c);for(;y>w;)l.moveTo(y,d),l.lineTo(y-b,d),y-=b*2}l.stroke()}else l.moveTo(h,d),l.lineTo(c,f);let p=this.renderer.resources;if(e&&!this._beat.isContinuedWhammy&&!this._isSimpleDip){let b=d;b-=p.tablatureFont.size+2*this.scale,this.renderer.settings.notation.isNotationElementVisible(me.ZerosOnDiveWhammys)&&l.fillText("0",h,b),u&&(b-=p.tablatureFont.size+2*this.scale,l.fillText(u,h,b))}let g=Math.abs(s.value);if((g!==0||this.renderer.settings.notation.isNotationElementVisible(me.ZerosOnDiveWhammys)&&!this._isSimpleDip)&&t.value!==s.value){let b="";if(s.value<0&&(b+="-"),g>=4){let w=g/4|0;b+=w,g-=w*4}else g===0&&(b+="0");g>0&&(b+=Us.getFractionSign(g));let m=0;this._isSimpleDip?m=Math.min(d,f)-p.tablatureFont.size-2*this.scale:(m=t.offset===s.offset?Math.min(d,f):f,m-=p.tablatureFont.size+2*this.scale,r&&r.value>s.value&&(m-=2*this.scale));let y=c;l.fillText(b,y,m)}}}_s.TopOffsetSharedDataKey="tab.whammy.topoffset";_s.PerHalfSize=6;_s.DashSize=3;class ba extends J0{constructor(e){super(0,0),this._beat=e}doLayout(){let e=this.renderer.settings.notation.notationMode;switch(this._beat.whammyBarType){case je.None:case je.Custom:case je.Hold:return;case je.Dive:case je.PrediveDive:{let t=new ts(this._beat,!1);t.renderer=this.renderer;let s=this._beat.whammyBarPoints[this._beat.whammyBarPoints.length-1];for(let r of this._beat.notes)r.isTieOrigin||t.addGlyph(this.getBendNoteValue(r,s),s.value%2!==0);t.doLayout(),this.BendNoteHeads.push(t)}break;case je.Dip:if(e===Qt.SongBook){let t=this.renderer.resources;this.renderer.simpleWhammyOverflow=t.tablatureFont.size*1.5+ba.SimpleDipHeight*this.scale+ba.SimpleDipPadding*this.scale}else{let t=new ts(this._beat,!1);if(t.renderer=this.renderer,this.renderer.settings.notation.notationMode===Qt.GuitarPro){let r=this._beat.whammyBarPoints[1];for(let n of this._beat.notes)t.addGlyph(this.getBendNoteValue(n,this._beat.whammyBarPoints[1]),r.value%2!==0)}t.doLayout(),this.BendNoteHeads.push(t);let s=new ts(this._beat,!1);if(s.renderer=this.renderer,this.renderer.settings.notation.notationMode===Qt.GuitarPro){let r=this._beat.whammyBarPoints[this._beat.whammyBarPoints.length-1];for(let n of this._beat.notes)s.addGlyph(this.getBendNoteValue(n,r),r.value%2!==0)}s.doLayout(),this.BendNoteHeads.push(s)}break;case je.Predive:break}super.doLayout()}paint(e,t,s){let r=this._beat;switch(r.whammyBarType){case je.None:case je.Custom:return}let n=this.renderer.settings.notation.notationMode,a=this.renderer.scoreRenderer.layout.getRendererForBar(this.renderer.staff.staveId,r.voice.bar),o=e+a.x+a.getBeatX(r,_e.MiddleNotes),l=this.getTieDirection(r,a),u=this._beat.notes.length===1?l:R.Up,h=s.textAlign;for(let c=0;c<r.notes.length;c++){let d=r.notes[c],f=t+a.y;c>0&&c>=(this._beat.notes.length/2|0)&&(u=R.Down),u===R.Down?f+=a.getNoteY(d,q.Bottom):f+=a.getNoteY(d,q.Top);let p=e+a.x;r.isLastOfVoice?p+=a.width:p+=a.getBeatX(r,_e.EndBeat),p-=8*this.scale;let g=r.whammyStyle===qe.Gradual&&c===0?"grad.":"",b=null;d.isTieOrigin&&(b=this.renderer.scoreRenderer.layout.getRendererForBar(this.renderer.staff.staveId,d.tieDestination.beat.voice.bar),b&&b.staff===a.staff?p=e+b.x+b.getBeatX(d.tieDestination.beat,_e.MiddleNotes):b=null);let m=Se.NoteHeadHeight*this.scale*Se.GraceScale*.5;u===R.Up&&(m=-m);let y=r.whammyBarPoints.length>0?this.getBendNoteValue(d,r.whammyBarPoints[r.whammyBarPoints.length-1]):0,w=0,x=!1;switch(this.BendNoteHeads.length>0&&this.BendNoteHeads[0].containsNoteValue(y)?(w=this.BendNoteHeads[0].getNoteValueY(y)+m,x=!0):b&&(d.isTieOrigin&&d.tieDestination.beat.hasWhammyBar||d.beat.isContinuedWhammy)?(w=t+b.y+b.getNoteY(d.tieDestination,q.Top),x=!0,u===R.Down&&(w+=Se.NoteHeadHeight*this.scale)):d.isTieOrigin&&(b?w=t+b.y+b.getNoteY(d.tieDestination,q.Top):w=f,u===R.Down&&(w+=Se.NoteHeadHeight*this.scale)),r.whammyBarType){case je.Hold:d.isTieOrigin&&Gt.paintTie(s,this.scale,o,f,p,w,l===R.Down,22,4);break;case je.Dive:c===0&&(this.BendNoteHeads[0].x=p-this.BendNoteHeads[0].noteHeadOffset,this.BendNoteHeads[0].y=t+a.y,this.BendNoteHeads[0].paint(0,0,s),this.BendNoteHeads[0].containsNoteValue(y)&&(w+=this.BendNoteHeads[0].y)),x?this.drawBendSlur(s,o,f,p,w,u===R.Down,this.scale,g):d.isTieOrigin&&Gt.paintTie(s,this.scale,o,f,p,w,l===R.Down,22,4);break;case je.Dip:if(n===Qt.SongBook){if(c===0){let T=e+a.x+a.getBeatX(this._beat,_e.OnNotes)-2*this.scale,C=e+a.x+a.getBeatX(this._beat,_e.PostNotes)+2*this.scale,W=(T+C)/2,z=((this._beat.whammyBarPoints[1].value-this._beat.whammyBarPoints[0].value)/4|0).toString();s.font=this.renderer.resources.tablatureFont,s.fillText(z,W,t+this.y);let te=t+this.y+s.font.size+2*this.scale,E=te+ba.SimpleDipHeight*this.scale;this._beat.whammyBarPoints[1].value>this._beat.whammyBarPoints[0].value?(s.moveTo(T,E),s.lineTo(W,te),s.lineTo(C,E)):(s.moveTo(T,te),s.lineTo(W,E),s.lineTo(C,te)),s.stroke()}d.isTieOrigin&&Gt.paintTie(s,this.scale,o,f,p,w,l===R.Down,22,4)}else{let T=(o+p)/2;this.BendNoteHeads[0].x=T-this.BendNoteHeads[0].noteHeadOffset,this.BendNoteHeads[0].y=t+a.y,this.BendNoteHeads[0].paint(0,0,s);let C=this.getBendNoteValue(d,r.whammyBarPoints[1]),W=this.BendNoteHeads[0].getNoteValueY(C)+m;this.drawBendSlur(s,o,f,T,W,u===R.Down,this.scale,g),this.BendNoteHeads[1].x=p-this.BendNoteHeads[1].noteHeadOffset,this.BendNoteHeads[1].y=t+a.y,this.BendNoteHeads[1].paint(0,0,s),w=this.BendNoteHeads[1].getNoteValueY(y)+m,this.drawBendSlur(s,T,W,p,w,u===R.Down,this.scale,g)}break;case je.PrediveDive:case je.Predive:let k=e+a.x+a.getBeatX(d.beat,_e.PreNotes);k+=a.getPreNotesGlyphForBeat(d.beat).prebendNoteHeadOffset;let _=t+a.y+a.getScoreY(a.accidentalHelper.getNoteLineForValue(d.displayValue-(d.beat.whammyBarPoints[0].value/2|0),!1))+m;this.drawBendSlur(s,k,_,o,f,u===R.Down,this.scale,g),this.BendNoteHeads.length>0&&(this.BendNoteHeads[0].x=p-this.BendNoteHeads[0].noteHeadOffset,this.BendNoteHeads[0].y=t+a.y,this.BendNoteHeads[0].paint(0,0,s),this.drawBendSlur(s,o,f,p,w,u===R.Down,this.scale,g));break}}s.textAlign=h}getBendNoteValue(e,t){return e.displayValueWithoutBend+(t.value/2|0)}}ba.SimpleDipHeight=_s.PerHalfSize*2;ba.SimpleDipPadding=2;class ei extends vt{constructor(e,t,s){super(e,t),this.width=s}}class k4 extends Rt{constructor(e,t,s,r,n){super(e,t,n?Se.GraceScale:1,s.getSymbol(r)),this._isGrace=n,this._articulation=s}paint(e,t,s){let r=this._isGrace?this.scale:0;s.fillMusicFontSymbol(e+this.x,t+this.y+r,this.glyphScale*this.scale,this.symbol,!1),this._articulation.techniqueSymbol!==S.None&&this._articulation.techniqueSymbolPlacement===we.Middle&&s.fillMusicFontSymbol(e+this.x,t+this.y+r,this.glyphScale*this.scale,this._articulation.techniqueSymbol,!1)}doLayout(){let e=(this._isGrace?Se.GraceScale:1)*this.scale;switch(this.symbol){case S.NoteheadWhole:this.width=14;break;case S.NoteheadCircleX:case S.NoteheadDiamondWhite:this.width=9;break;case S.NoteheadHeavyXHat:case S.NoteheadHeavyX:this.width=13;break;default:this.width=10;break}this.width=this.width*(this._isGrace?Se.GraceScale:1)*this.scale,this.height=Se.NoteHeadHeight*e}}class mS extends Rt{constructor(e,t){super(e,t,Se.GraceScale,S.ArticStaccatoAbove)}doLayout(){this.width=Se.QuarterNoteHeadWidth*this.scale,this.height=7*this.scale}paint(e,t,s){super.paint(e+3*this.scale,t+5*this.scale,s)}}class x4 extends Rt{constructor(e,t){super(e,t,.5,S.PictEdgeOfCymbal)}doLayout(){this.width=22*this.scale,this.height=15*this.scale}paint(e,t,s){super.paint(e-3*this.scale,t+this.height,s)}}class _4 extends Rt{constructor(e,t){super(e,t,Se.GraceScale,S.GuitarGolpe)}doLayout(){this.width=9*this.scale,this.height=10*this.scale}paint(e,t,s){super.paint(e,t+this.height,s)}}class T4 extends vs{constructor(){super(...arguments),this._strings=new Set}addString(e){this._strings.add(e)}doLayout(){const e=hr.CircleNumberHeight*hr.CircleNumberScale*this.scale;this.height=(e+3)*this._strings.size,this.width=e}paint(e,t,s){const r=this.renderer.bar.staff.tuning.length;let n=0;const a=hr.CircleNumberHeight*hr.CircleNumberScale*this.scale;for(const o of this._strings){const l=r-o,u=S.GuitarString1+l;s.fillMusicFontSymbol(e+this.x+Se.NoteHeadHeight/2,t+this.y+a+n,hr.CircleNumberScale,u,!0),n+=a+3*this.scale}}}class ci extends vs{constructor(e,t,s,r){super(e,t),this.beatEffects=new Map,this._isGrace=r,this._duration=s,this._symbol=ci.getSymbol(s)}paint(e,t,s){let r=this._isGrace?this.scale:0;const n=this._isGrace?Se.GraceScale:1;s.fillMusicFontSymbol(e+this.x,t+this.y+r,n*this.scale,this._symbol,!1);for(const a of this.beatEffects.values())a.paint(e+this.x,t+this.y,s)}doLayout(){const e=(this._isGrace?Se.GraceScale:1)*this.scale;switch(this._duration){case N.QuadrupleWhole:case N.DoubleWhole:case N.Whole:this.width=ci.WholeNoteHeadWidth*e;break;case N.Half:this.width=ci.HalfNoteHeadWidth*e;break;default:this.width=ci.QuarterNoteHeadWidth*e;break}this.height=ci.NoteHeadHeight*e;let t=7*this.scale,s=ci.NoteHeadHeight*this.scale;for(const r of this.beatEffects.values())r.y+=s,r.x+=this.width/2,r.renderer=this.renderer,s+=t,r.doLayout()}static getSymbol(e){switch(e){case N.QuadrupleWhole:case N.DoubleWhole:case N.Whole:return S.NoteheadSlashWhiteWhole;case N.Half:return S.NoteheadSlashWhiteHalf;default:return S.NoteheadSlashVerticalEnds}}updateBeamingHelper(e){this.beamingHelper&&this.beamingHelper.registerBeatLineX("slash",this.beat,e+this.x+this.width,e+this.x)}}ci.NoteHeadHeight=17;ci.QuarterNoteHeadWidth=12;ci.HalfNoteHeadWidth=25;ci.WholeNoteHeadWidth=32;class N4 extends za{constructor(){super(...arguments),this._collisionOffset=-1e3,this._skipPaint=!1,this.slash=null,this.noteHeads=null,this.restGlyph=null}getNoteX(e,t){return this.noteHeads?this.noteHeads.getNoteX(e,t):0}buildBoundingsLookup(e,t,s){this.noteHeads&&this.noteHeads.buildBoundingsLookup(e,t+this.x,s+this.y)}getNoteY(e,t){return this.noteHeads?this.noteHeads.getNoteY(e,t):0}updateBeamingHelper(){if(this.noteHeads)this.noteHeads.updateBeamingHelper(this.container.x+this.x);else if(this.restGlyph){if(this.restGlyph.updateBeamingHelper(this.container.x+this.x),this.renderer.bar.isMultiVoice&&this._collisionOffset===-1e3){this._collisionOffset=this.renderer.helpers.collisionHelper.applyRestCollisionOffset(this.container.beat,this.restGlyph.y,this.renderer.getScoreHeight(1)),this.y+=this._collisionOffset;const e=this.renderer.helpers.collisionHelper.restDurationsByDisplayTime;e.has(this.container.beat.playbackStart)&&e.get(this.container.beat.playbackStart).has(this.container.beat.playbackDuration)&&e.get(this.container.beat.playbackStart).get(this.container.beat.playbackDuration)!==this.container.beat.id&&(this._skipPaint=!0)}}else this.slash&&this.slash.updateBeamingHelper(this.container.x+this.x)}paint(e,t,s){this._skipPaint||super.paint(e,t,s)}doLayout(){let e=this.renderer;if(!this.container.beat.isEmpty)if(this.container.beat.isRest){let t=Math.ceil((this.renderer.bar.staff.standardNotationLineCount-1)/2)*2;this.container.beat.duration===N.Whole&&this.renderer.bar.staff.standardNotationLineCount!==1&&this.renderer.bar.staff.standardNotationLineCount!==3&&(t-=2);const s=new Ea(0,e.getScoreY(t),this.container.beat.duration);if(this.restGlyph=s,s.beat=this.container.beat,s.beamingHelper=this.beamingHelper,this.addGlyph(s),this.renderer.bar.isMultiVoice)if(this.container.beat.voice.index===0){const r=dr.computeLineHeightsForRest(this.container.beat.duration);let n=s.y-e.getScoreHeight(r[0]),a=s.y+e.getScoreHeight(r[1]);this.renderer.helpers.collisionHelper.reserveBeatSlot(this.container.beat,n,a)}else this.renderer.helpers.collisionHelper.registerRest(this.container.beat);if(this.beamingHelper&&this.beamingHelper.applyRest(this.container.beat,t),this.container.beat.dots>0){this.addGlyph(new ei(0,0,5*this.scale));for(let r=0;r<this.container.beat.dots;r++){let n=new qs(0,0);n.renderer=this.renderer,this.createBeatDot(t,n),this.addGlyph(n)}}}else{if(this.container.beat.slashed){const t=this.container.beat.graceType!==he.None,s=(e.heightLineCount-1)/2,r=e.getLineY(s),n=new ci(0,r,this.container.beat.duration,t);this.slash=n,n.beat=this.container.beat,n.beamingHelper=this.beamingHelper,this.addGlyph(n)}else{const t=new v4;this.noteHeads=t,t.beat=this.container.beat,t.beamingHelper=this.beamingHelper;let s=new Fc(!1);s.renderer=this.renderer;for(let r of this.container.beat.notes)r.isVisible&&(this.createNoteGlyph(r),s.addParenthesis(r));this.addGlyph(t),s.isEmpty||(this.addGlyph(new ei(0,0,4*(this.container.beat.graceType!==he.None?Se.GraceScale:1)*this.scale)),this.addGlyph(s))}if(this.container.beat.hasWhammyBar){let t=new ba(this.container.beat);t.renderer=this.renderer,t.doLayout(),this.container.ties.push(t)}if(this.container.beat.dots>0){this.addGlyph(new ei(0,0,5*this.scale));for(let t=0;t<this.container.beat.dots;t++){let s=new qs(0,0);s.renderer=this.renderer;for(let r of this.container.beat.notes)this.createBeatDot(e.getNoteLine(r),s);this.addGlyph(s)}}}super.doLayout(),this.container.beat.isEmpty?this.centerX=this.width/2:this.restGlyph?this.centerX=this.restGlyph.x+this.restGlyph.width/2:this.noteHeads?this.centerX=this.noteHeads.x+this.noteHeads.width/2:this.slash&&(this.centerX=this.slash.x+this.slash.width/2)}createBeatDot(e,t){let s=this.renderer;t.addGlyph(new ku(0,s.getScoreY(e),1.5*this.scale))}createNoteHeadGlyph(e){let t=this.container.beat.graceType!==he.None;if(e.beat.voice.bar.staff.isPercussion){const s=Lt.getArticulation(e);if(s)return new k4(0,0,s,e.beat.duration,t);I.warning("Rendering",`No articulation found for percussion instrument ${e.percussionArticulation}`)}return e.isDead?new b4(0,0,t):e.beat.graceType===he.BendGrace?new Se(0,0,N.Quarter,!0):e.harmonicType===fe.Natural?new Oc(0,0,e.beat.duration,t):new Se(0,0,e.beat.duration,t)}createNoteGlyph(e){if(e.beat.graceType===he.BendGrace&&!e.hasBend)return;let t=this.renderer,s=this.createNoteHeadGlyph(e),r=t.getNoteLine(e);if(s.y=t.getScoreY(r),this.noteHeads.addNoteGlyph(s,e,r),e.harmonicType!==fe.None&&e.harmonicType!==fe.Natural){let a=e.displayValue+e.harmonicPitch;s=new Oc(0,0,e.beat.duration,this.container.beat.graceType!==he.None),r=t.accidentalHelper.getNoteLineForValue(a,!1),s.y=t.getScoreY(r),this.noteHeads.addNoteGlyph(s,e,r)}const n=this.noteHeads.belowBeatEffects;if(e.isStaccato&&!n.has("Staccato")&&n.set("Staccato",new mS(0,0)),e.accentuated===_t.Normal&&!n.has("Accent")&&n.set("Accent",new Dl(0,0,e)),e.accentuated===_t.Heavy&&!n.has("HAccent")&&n.set("HAccent",new Dl(0,0,e)),e.accentuated===_t.Tenuto&&!n.has("Tenuto")&&n.set("Tenuto",new Dl(0,0,e)),e.showStringNumber&&e.isStringed){let a;n.has("StringNumber")?a=n.get("StringNumber"):(a=new T4(0,0),n.set("StringNumber",a)),a.addString(e.string)}if(e.isPercussion){const a=Lt.getArticulation(e);if(a&&a.techniqueSymbolPlacement!==we.Middle){const o=a.techniqueSymbolPlacement===we.Top?this.noteHeads.aboveBeatEffects:this.noteHeads.belowBeatEffects;switch(a.techniqueSymbol){case S.PictEdgeOfCymbal:o.set("PictEdgeOfCymbal",new x4(0,0));break;case S.ArticStaccatoAbove:o.set("ArticStaccatoAbove",new mS(0,0));break;case S.StringsUpBow:o.set("StringsUpBow",new vu(0,0,fi.Up));break;case S.StringsDownBow:o.set("StringsDownBow",new vu(0,0,fi.Down));break;case S.GuitarGolpe:o.set("GuitarGolpe",new _4(0,0));break}}}}}class B4 extends vt{constructor(e){super(0,0),this._beat=e}doLayout(){this.width=this._beat.brushType===ut.ArpeggioUp||this._beat.brushType===ut.ArpeggioDown?10*this.scale:0}paint(e,t,s){if(this._beat.brushType===ut.ArpeggioUp||this._beat.brushType===ut.ArpeggioDown){let r=this.renderer,n=r.lineOffset,a=t+this.y+(r.getNoteY(this._beat.maxNote,q.Bottom)-n),o=t+this.y+r.getNoteY(this._beat.minNote,q.Top)+n,l=e+this.x+this.width/2,u=8*this.scale,h=new Ma(0,0,Ge.Slight,1.2,!0);h.renderer=this.renderer,h.doLayout();let c=-h.height/2;if(this._beat.brushType===ut.ArpeggioUp){let d=a+u,f=o-u;h.width=Math.abs(f-d),s.beginRotate(e+this.x+5*this.scale,f,-90),h.paint(0,c,s),s.endRotate(),s.beginPath(),s.moveTo(l,o),s.lineTo(l+u/2,o-u),s.lineTo(l-u/2,o-u),s.closePath(),s.fill()}else if(this._beat.brushType===ut.ArpeggioDown){let d=a+u,f=o;h.width=Math.abs(f-d),s.beginRotate(e+this.x+5*this.scale,d,90),h.paint(0,c,s),s.endRotate(),s.beginPath(),s.moveTo(l,a),s.lineTo(l+u/2,a+u),s.lineTo(l-u/2,a+u),s.closePath(),s.fill()}}}}class C4{constructor(e,t){this.line=0,this.line=e,this.text=t}}class P4 extends qs{constructor(){super(0,0),this._infos=new Map}get isEmpty(){return this._infos.size===0}addFingers(e){const t=this.renderer.settings;if(t.notation.fingeringMode!==Sr.ScoreDefault&&t.notation.fingeringMode!==Sr.ScoreForcePiano)return;const s=et.fingerToString(this.renderer.settings,e.beat,e.leftHandFinger,!0);s&&this.addFinger(e,s);const r=et.fingerToString(this.renderer.settings,e.beat,e.rightHandFinger,!1);r&&this.addFinger(e,r)}addFinger(e,t){let r=this.renderer.getNoteLine(e);if(this._infos.has(r)){const n=this._infos.get(r);n.text+=t}else{const n=new C4(r,t);this._infos.set(r,n)}}doLayout(){let e=this.renderer;for(const[t,s]of this._infos){const r=new ui(0,0,s.text,e.resources.inlineFingeringFont,de.Left,we.Middle);r.renderer=e,r.y=e.getScoreY(s.line),r.doLayout(),this.addGlyph(r),this.width=Math.max(this.width,r.width)}}}class M4 extends Ha{get prebendNoteHeadOffset(){return this._prebends?this._prebends.x+this._prebends.noteHeadOffset:0}doLayout(){if(!this.container.beat.isRest){let e=new Q0;e.renderer=this.renderer;let t=new P4;t.renderer=this.renderer;let s=new Fc(!0);s.renderer=this.renderer;const r=new ts(this.container.beat,!0);this._prebends=r,r.renderer=this.renderer;for(let n of this.container.beat.notes)if(n.isVisible){if(n.hasBend)switch(n.bendType){case se.PrebendBend:case se.Prebend:case se.PrebendRelease:r.addGlyph(n.displayValue-(n.bendPoints[0].value/2|0),!1);break}else if(n.beat.hasWhammyBar)switch(n.beat.whammyBarType){case je.PrediveDive:case je.Predive:this._prebends.addGlyph(n.displayValue-(n.beat.whammyBarPoints[0].value/2|0),!1);break}this.createAccidentalGlyph(n,e),s.addParenthesis(n),t.addFingers(n)}r.isEmpty||(this.addGlyph(r),this.addGlyph(new ei(0,0,4*(this.container.beat.graceType!==he.None?Se.GraceScale:1)*this.scale))),this.container.beat.brushType!==ut.None&&(this.addGlyph(new B4(this.container.beat)),this.addGlyph(new ei(0,0,4*this.scale))),t.isEmpty||(this.addGlyph(new ei(0,0,2*(this.container.beat.graceType!==he.None?Se.GraceScale:1)*this.scale)),this.addGlyph(t),this.addGlyph(new ei(0,0,2*(this.container.beat.graceType!==he.None?Se.GraceScale:1)*this.scale))),s.isEmpty||(this.addGlyph(s),this.addGlyph(new ei(0,0,4*(this.container.beat.graceType!==he.None?Se.GraceScale:1)*this.scale))),e.isEmpty||(this.accidentals=e,this.addGlyph(new ei(0,0,2*(this.container.beat.graceType!==he.None?Se.GraceScale:1)*this.scale)),this.addGlyph(e),this.addGlyph(new ei(0,0,2*(this.container.beat.graceType!==he.None?Se.GraceScale:1)*this.scale)))}super.doLayout()}createAccidentalGlyph(e,t){let s=this.renderer,r=s.accidentalHelper.applyAccidental(e),n=s.getNoteLine(e),a=this.container.beat.graceType!==he.None;const o=a?Se.GraceScale:1;if(r!==ue.None){let l=new Hr(0,s.getScoreY(n),r,o);l.renderer=this.renderer,t.addGlyph(l)}if(e.harmonicType!==fe.None&&e.harmonicType!==fe.Natural){let l=e.displayValue+e.harmonicPitch;r=s.accidentalHelper.applyAccidentalForValue(e.beat,l,a,!1),n=s.accidentalHelper.getNoteLineForValue(l,!1);let u=new Hr(0,s.getScoreY(n),r,o);u.renderer=this.renderer,t.addGlyph(u)}}constructor(){super(),this._prebends=null,this.accidentals=null}}class q0 extends Rt{constructor(e,t,s,r){super(e,t,r,q0.getSymbol(s)),this._digit=0,this._scale=0,this._digit=s,this._scale=r}doLayout(){this.width=this.getDigitWidth(this._digit)*this.scale*this._scale}getDigitWidth(e){switch(e){case 0:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:return 14;case 1:return 10;default:return 0}}static getSymbol(e){switch(e){case 0:return S.TimeSig0;case 1:return S.TimeSig1;case 2:return S.TimeSig2;case 3:return S.TimeSig3;case 4:return S.TimeSig4;case 5:return S.TimeSig5;case 6:return S.TimeSig6;case 7:return S.TimeSig7;case 8:return S.TimeSig8;case 9:return S.TimeSig9;default:return S.None}}}class jh extends qs{constructor(e,t,s,r=1){super(e,t),this._number=0,this._scale=0,this._number=s,this._scale=r}doLayout(){let e=this._number;for(;e>0;){let t=e%10,s=new q0(0,0,t,this._scale);this.addGlyph(s),e=e/10|0}if(this.glyphs){this.glyphs.reverse();let t=0;for(let s=0,r=this.glyphs.length;s<r;s++){let n=this.glyphs[s];n.x=t,n.y=0,n.renderer=this.renderer,n.doLayout(),t+=n.width}this.width=t}}}jh.numberHeight=18;class tT extends qs{constructor(e,t,s,r,n,a){super(e,t),this._numerator=0,this._denominator=0,this._numerator=s,this._denominator=r,this._isCommon=n,this._isFreeTime=a}doLayout(){let e=0;const t=jh.numberHeight*this.scale;if(this._isFreeTime){const s=new Wo(!0);s.renderer=this.renderer,s.y=-t,s.height=t*2,s.doLayout(),this.addGlyph(s),e+=s.width+10*this.scale}if(this._isCommon&&this._numerator===2&&this._denominator===2){let s=new Rt(e,0,this.commonScale,S.TimeSigCutCommon);s.width=14*this.scale,this.addGlyph(s),super.doLayout()}else if(this._isCommon&&this._numerator===4&&this._denominator===4){let s=new Rt(e,0,this.commonScale,S.TimeSigCommon);s.width=14*this.scale,this.addGlyph(s),super.doLayout()}else{let s=new jh(e,-t/2,this._numerator,this.numberScale),r=new jh(e,t/2,this._denominator,this.numberScale);this.addGlyph(s),this.addGlyph(r),super.doLayout();const n=this.width-e;s.x=e+(n-s.width)/2,r.x=e+(n-r.width)/2}if(this._isFreeTime){const s=new Wo(!1);s.renderer=this.renderer,s.x=this.width+13*this.scale,s.y=-t,s.height=t*2,s.doLayout(),this.addGlyph(s),this.width=s.x+s.width}}}class K0 extends tT{get commonScale(){return 1}get numberScale(){return 1}}class E4 extends J0{constructor(e){super(0,0),this._notes=[],this._endNoteGlyph=null,this._middleNoteGlyph=null,this._beat=e}addBends(e){if(this._notes.push(e),!e.isTieOrigin)switch(e.bendType){case se.Bend:case se.PrebendRelease:case se.PrebendBend:{let t=this._endNoteGlyph;t||(t=new ts(e.beat,!1),t.renderer=this.renderer,this._endNoteGlyph=t,this.BendNoteHeads.push(t));let s=e.bendPoints[e.bendPoints.length-1];t.addGlyph(this.getBendNoteValue(e,s),s.value%2!==0)}break;case se.Release:if(!e.isTieOrigin){let t=this._endNoteGlyph;t||(t=new ts(e.beat,!1),t.renderer=this.renderer,this._endNoteGlyph=t,this.BendNoteHeads.push(t));let s=e.bendPoints[e.bendPoints.length-1];t.addGlyph(this.getBendNoteValue(e,s),s.value%2!==0)}break;case se.BendRelease:{let t=this._middleNoteGlyph;t||(t=new ts(e.beat,!1),this._middleNoteGlyph=t,t.renderer=this.renderer,this.BendNoteHeads.push(t));let s=e.bendPoints[1];t.addGlyph(this.getBendNoteValue(e,e.bendPoints[1]),s.value%2!==0);let r=this._endNoteGlyph;r||(r=new ts(e.beat,!1),r.renderer=this.renderer,this._endNoteGlyph=r,this.BendNoteHeads.push(r));let n=e.bendPoints[e.bendPoints.length-1];r.addGlyph(this.getBendNoteValue(e,n),n.value%2!==0)}break}}paint(e,t,s){let r=this.renderer.scoreRenderer.layout.getRendererForBar(this.renderer.staff.staveId,this._beat.voice.bar),n=e+r.x+r.getBeatX(this._beat,_e.MiddleNotes),a=e+r.x;this._beat.isLastOfVoice?a+=r.postBeatGlyphsStart:a+=r.getBeatX(this._beat.nextBeat,_e.PreNotes),a-=8*this.scale;let o=(n+a)/2;this._middleNoteGlyph&&(this._middleNoteGlyph.x=o-this._middleNoteGlyph.noteHeadOffset,this._middleNoteGlyph.y=t+r.y,this._middleNoteGlyph.paint(0,0,s)),this._endNoteGlyph&&(this._endNoteGlyph.x=a-this._endNoteGlyph.noteHeadOffset,this._endNoteGlyph.y=t+r.y,this._endNoteGlyph.paint(0,0,s)),this._notes.sort((h,c)=>c.displayValue-h.displayValue);let l=this._beat.graceType===he.BendGrace?this._beat.nextBeat:this._beat,u=this._notes.length===1?this.getTieDirection(l,r):R.Up;for(let h=0;h<this._notes.length;h++){let c=this._notes[h];h>0&&h>=(this._notes.length/2|0)&&(u=R.Down);let d=t+r.y+r.getNoteY(c,q.Top),f=Se.NoteHeadHeight*this.scale*Se.GraceScale*.5;u===R.Down&&(d+=Se.NoteHeadHeight*this.scale);let p=c.bendStyle===qe.Gradual?"grad.":"";if(c.isTieOrigin){let g=c.tieDestination,b=g?this.renderer.scoreRenderer.layout.getRendererForBar(this.renderer.staff.staveId,g.beat.voice.bar):null;if(!b||b.staff!==r.staff){let m=e+r.x+r.width,y=c.tieDestination.realValue;r.accidentalHelper.applyAccidentalForValue(c.beat,y,!1,!0);let w=t+r.y+r.getScoreY(r.accidentalHelper.getNoteLineForValue(y,!1));c.bendType===se.Hold||c.bendType===se.Prebend?Gt.paintTie(s,this.scale,n,d,m,w,u===R.Down,22,4):this.drawBendSlur(s,n,d,m,w,u===R.Down,this.scale,p)}else{let m=e+b.x+b.getBeatX(g.beat,_e.MiddleNotes),y=t+b.y+b.getNoteY(g,q.Top);u===R.Down&&(y+=Se.NoteHeadHeight*this.scale),c.bendType===se.Hold||c.bendType===se.Prebend?Gt.paintTie(s,this.scale,n,d,m,y,u===R.Down,22,4):this.drawBendSlur(s,n,d,m,y,u===R.Down,this.scale,p)}switch(c.bendType){case se.Prebend:case se.PrebendBend:case se.PrebendRelease:let m=e+r.x+r.getBeatX(c.beat,_e.PreNotes);m+=r.getPreNotesGlyphForBeat(c.beat).prebendNoteHeadOffset;let y=t+r.y+r.getScoreY(r.accidentalHelper.getNoteLineForValue(c.displayValue-(c.bendPoints[0].value/2|0),!1))+f;this.drawBendSlur(s,m,y,n,d,u===R.Down,this.scale);break}}else{u===R.Up&&(f=-f);let g=0,b=0;switch(c.bendType){case se.Bend:g=this.getBendNoteValue(c,c.bendPoints[c.bendPoints.length-1]),b=this._endNoteGlyph.getNoteValueY(g)+f,this.drawBendSlur(s,n,d,a,b,u===R.Down,this.scale,p);break;case se.BendRelease:let m=this.getBendNoteValue(c,c.bendPoints[1]),y=this._middleNoteGlyph.getNoteValueY(m)+f;this.drawBendSlur(s,n,d,o,y,u===R.Down,this.scale,p),g=this.getBendNoteValue(c,c.bendPoints[c.bendPoints.length-1]),b=this._endNoteGlyph.getNoteValueY(g)+f,this.drawBendSlur(s,o,y,a,b,u===R.Down,this.scale,p);break;case se.Release:this.BendNoteHeads.length>0&&(g=this.getBendNoteValue(c,c.bendPoints[c.bendPoints.length-1]),b=this.BendNoteHeads[0].getNoteValueY(g)+f,this.drawBendSlur(s,n,d,a,b,u===R.Down,this.scale,p));break;case se.Prebend:case se.PrebendBend:case se.PrebendRelease:let w=e+r.x+r.getBeatX(c.beat,_e.PreNotes);w+=r.getPreNotesGlyphForBeat(c.beat).prebendNoteHeadOffset;let x=t+r.y+r.getScoreY(r.accidentalHelper.getNoteLineForValue(c.displayValue-(c.bendPoints[0].value/2|0),!1))+f;this.drawBendSlur(s,w,x,n,d,u===R.Down,this.scale),this.BendNoteHeads.length>0&&(g=this.getBendNoteValue(c,c.bendPoints[c.bendPoints.length-1]),b=this.BendNoteHeads[0].getNoteValueY(g)+f,this.drawBendSlur(s,n,d,a,b,u===R.Down,this.scale,p));break}}}}getBendNoteValue(e,t){return e.displayValueWithoutBend+(t.value/2|0)}}class Xg extends Gt{constructor(e,t,s=!1){super(e,t,s)}doLayout(){super.doLayout()}getBeamDirection(e,t){if(e.isRest)return R.Up;switch(t.getBeatDirection(e)){case R.Up:return R.Down;default:return R.Up}}getStartY(){if(this.startBeat.isRest)return this.startNoteRenderer.getScoreY(9);switch(this.tieDirection){case R.Up:return this.startNoteRenderer.getNoteY(this.startBeat.maxNote,q.Top);default:return this.startNoteRenderer.getNoteY(this.startBeat.minNote,q.Bottom)}}getEndY(){const e=this.endNoteRenderer;if(this.endBeat.isRest)switch(this.tieDirection){case R.Up:return e.getScoreY(9);default:return e.getScoreY(0)}const t=this.startNoteRenderer.getBeatDirection(this.startBeat),s=e.getBeatDirection(this.endBeat);if(t!==s&&this.startBeat.graceType===he.None)if(s===this.tieDirection)switch(this.tieDirection){case R.Up:return e.getNoteY(this.endBeat.maxNote,q.TopWithStem);default:return e.getNoteY(this.endBeat.minNote,q.BottomWithStem)}else switch(this.tieDirection){case R.Up:return e.getNoteY(this.endBeat.maxNote,q.BottomWithStem);default:return e.getNoteY(this.endBeat.minNote,q.TopWithStem)}switch(this.tieDirection){case R.Up:return e.getNoteY(this.endBeat.maxNote,q.Top);default:return e.getNoteY(this.endBeat.minNote,q.Bottom)}}getStartX(){return this.startNoteRenderer.getBeatX(this.startBeat,_e.MiddleNotes)}getEndX(){const e=this.endNoteRenderer.getBeatDirection(this.endBeat);return this.endNoteRenderer.getBeatX(this.endBeat,this.endBeat.duration>N.Whole&&e===this.tieDirection?_e.Stem:_e.MiddleNotes)}}class L4 extends vt{constructor(e,t,s,r){super(0,0),this._outType=t,this._inType=e,this._startNote=s,this._parent=r}doLayout(){this.width=0}paint(e,t,s){this.paintSlideIn(e,t,s),this.drawSlideOut(e,t,s)}paintSlideIn(e,t,s){let r=this.renderer,n=12*this.scale,a=e+r.x+r.getNoteX(this._startNote,Ze.Left)-2*this.scale,o=t+r.y+r.getNoteY(this._startNote,q.Center),l=a-n,u=t+r.y;switch(this._inType){case ii.IntoFromBelow:u+=r.getNoteY(this._startNote,q.Bottom);break;case ii.IntoFromAbove:u+=r.getNoteY(this._startNote,q.Top);break;default:return}let h=this.getAccidentalsWidth(r,this._startNote.beat);l-=h,a-=h,this.paintSlideLine(s,!1,l,a,u,o)}getAccidentalsWidth(e,t){let s=e.getPreNotesGlyphForBeat(t);return s&&s.accidentals?s.accidentals.width:0}drawSlideOut(e,t,s){let r=this.renderer,n=12*this.scale,a=1*this.scale,o=2*this.scale,l=0,u=0,h=0,c=0,d=!1;switch(this._outType){case xe.Shift:case xe.Legato:if(l=e+r.x+r.getBeatX(this._startNote.beat,_e.PostNotes),u=t+r.y+r.getNoteY(this._startNote,q.Center),this._startNote.slideTarget){let f=this.renderer.scoreRenderer.layout.getRendererForBar(this.renderer.staff.staveId,this._startNote.slideTarget.beat.voice.bar);!f||f.staff!==r.staff?(h=e+r.x+r.width,c=u):(h=e+f.x+f.getBeatX(this._startNote.slideTarget.beat,_e.PreNotes)-a,c=t+f.y+f.getNoteY(this._startNote.slideTarget,q.Center)),this._startNote.slideTarget.realValue>this._startNote.realValue?(u+=o,c-=o):(u-=o,c+=o)}else h=e+r.x+this._parent.x,c=u;break;case xe.OutUp:l=e+r.x+r.getNoteX(this._startNote,Ze.Right),u=t+r.y+r.getNoteY(this._startNote,q.Center),h=l+n,c=t+r.y+r.getNoteY(this._startNote,q.Top);break;case xe.OutDown:l=e+r.x+r.getNoteX(this._startNote,Ze.Right),u=t+r.y+r.getNoteY(this._startNote,q.Center),h=l+n,c=t+r.y+r.getNoteY(this._startNote,q.Bottom);break;case xe.PickSlideUp:l=e+r.x+r.getNoteX(this._startNote,Ze.Right),u=t+r.y+r.getNoteY(this._startNote,q.Center),c=t+r.y+r.getNoteY(this._startNote,q.Top),h=e+r.x+r.width,this._startNote.beat.nextBeat&&this._startNote.beat.nextBeat.voice===this._startNote.beat.voice&&(h=e+r.x+r.getBeatX(this._startNote.beat.nextBeat,_e.PreNotes)),d=!0;break;case xe.PickSlideDown:l=e+r.x+r.getNoteX(this._startNote,Ze.Right),u=t+r.y+r.getNoteY(this._startNote,q.Center),c=t+r.y+r.getNoteY(this._startNote,q.Bottom),h=e+r.x+r.width,this._startNote.beat.nextBeat&&this._startNote.beat.nextBeat.voice===this._startNote.beat.voice&&(h=e+r.x+r.getBeatX(this._startNote.beat.nextBeat,_e.PreNotes)),d=!0;break;default:return}this.paintSlideLine(s,d,l,h,u,c)}paintSlideLine(e,t,s,r,n,a){if(t){let o=new Ma(0,0,Ge.Slight,1.2);o.renderer=this.renderer,o.doLayout(),n-=o.height/2,a-=o.height/2;let l=r-s,u=a-n,h=Math.sqrt(Math.pow(u,2)+Math.pow(l,2));o.width=l;let c=Math.asin(u/h)*(180/Math.PI);e.beginRotate(s,n,c),o.paint(0,0,e),e.endRotate()}else e.beginPath(),e.moveTo(s,n),e.lineTo(r,a),e.stroke()}}class yh extends Xg{constructor(e,t,s=!1){super(e.beat,t.beat,s),this._startNote=e,this._endNote=t}getTieHeight(e,t,s,r){return Math.log2(s-e+1)*this.renderer.settings.notation.slurHeight}getStartY(){if(this.isStartCentered())switch(this.tieDirection){case R.Up:return this.startNoteRenderer.getNoteY(this._startNote,q.Top);default:return this.startNoteRenderer.getNoteY(this._startNote,q.Bottom)}return this.startNoteRenderer.getNoteY(this._startNote,q.Center)}getEndY(){if(this.isEndCentered())if(this.isEndOnStem())switch(this.tieDirection){case R.Up:return this.endNoteRenderer.getNoteY(this._endNote,q.TopWithStem);default:return this.endNoteRenderer.getNoteY(this._endNote,q.BottomWithStem)}else switch(this.tieDirection){case R.Up:return this.endNoteRenderer.getNoteY(this._endNote,q.Top);default:return this.endNoteRenderer.getNoteY(this._endNote,q.Bottom)}else return this.endNoteRenderer.getNoteY(this._endNote,q.Center)}isStartCentered(){return this._startNote===this._startNote.beat.maxNote&&this.tieDirection===R.Up||this._startNote===this._startNote.beat.minNote&&this.tieDirection===R.Down}isEndCentered(){return this._startNote.beat.graceType===he.None&&(this._endNote===this._endNote.beat.maxNote&&this.tieDirection===R.Up||this._endNote===this._endNote.beat.minNote&&this.tieDirection===R.Down)}isEndOnStem(){const e=this.endNoteRenderer,t=this.startNoteRenderer.getBeatDirection(this.startBeat),s=e.getBeatDirection(this.endBeat);return t!==s&&this.startBeat.graceType===he.None}getStartX(){return this.isStartCentered()?this.startNoteRenderer.getBeatX(this._startNote.beat,_e.MiddleNotes):this.startNoteRenderer.getNoteX(this._startNote,Ze.Right)}getEndX(){return this.isEndCentered()?this.isEndOnStem()?this.endNoteRenderer.getBeatX(this._endNote.beat,_e.Stem):this.endNoteRenderer.getNoteX(this._endNote,Ze.Center):this.endNoteRenderer.getBeatX(this._endNote.beat,_e.PreNotes)}}class yS extends Gt{constructor(e,t,s=!1){super(e?e.beat:null,t?t.beat:null,s),this.startNote=e,this.endNote=t}shouldDrawBendSlur(){return this.renderer.settings.notation.extendBendArrowsOnTiedNotes&&!!this.startNote.bendOrigin&&this.startNote.isTieOrigin}doLayout(){super.doLayout()}getBeamDirection(e,t){switch(t.getBeatDirection(e)){case R.Up:return R.Down;default:return R.Up}}getStartY(){if(this.startBeat.isRest)return this.startNoteRenderer.getScoreY(9);switch(this.tieDirection){case R.Up:return this.startNoteRenderer.getNoteY(this.startNote,q.Top);default:return this.startNoteRenderer.getNoteY(this.startNote,q.Bottom)}}getEndY(){const e=this.endNoteRenderer;if(this.endBeat.isRest)switch(this.tieDirection){case R.Up:return e.getScoreY(9);default:return e.getScoreY(0)}switch(this.tieDirection){case R.Up:return e.getNoteY(this.endNote,q.Top);default:return e.getNoteY(this.endNote,q.Bottom)}}getStartX(){return this.startNoteRenderer.getBeatX(this.startNote.beat,_e.PostNotes)}getEndX(){return this.endNoteRenderer.getBeatX(this.endNote.beat,_e.PreNotes)}}class D4 extends Cs{constructor(e,t){super(e,t),this._bend=null,this._effectSlur=null,this._effectEndSlur=null}doLayout(){if(this._effectSlur=null,this._effectEndSlur=null,super.doLayout(),this.beat.isLegatoOrigin){if(!this.beat.previousBeat||!this.beat.previousBeat.isLegatoOrigin){let e=this.beat.nextBeat;for(;e.nextBeat&&e.nextBeat.isLegatoDestination;)e=e.nextBeat;this.addTie(new Xg(this.beat,e,!1))}}else if(this.beat.isLegatoDestination&&!this.beat.isLegatoOrigin){let e=this.beat.previousBeat;for(;e.previousBeat&&e.previousBeat.isLegatoOrigin;)e=e.previousBeat;this.addTie(new Xg(e,this.beat,!0))}this._bend&&(this._bend.renderer=this.renderer,this._bend.doLayout(),this.updateWidth())}createTies(e){if(e.isVisible){if(e.isTieOrigin&&!e.hasBend&&!e.beat.hasWhammyBar&&e.beat.graceType!==he.BendGrace&&e.tieDestination&&e.tieDestination.isVisible){let t=new yS(e,e.tieDestination,!1);this.addTie(t)}if(e.isTieDestination&&!e.tieOrigin.hasBend&&!e.beat.hasWhammyBar){let t=new yS(e.tieOrigin,e,!0);this.addTie(t)}if(e.slideInType!==ii.None||e.slideOutType!==xe.None){let t=new L4(e.slideInType,e.slideOutType,e,this);this.addTie(t)}if(e.isSlurOrigin&&e.slurDestination&&e.slurDestination.isVisible){let t=new yh(e,e.slurDestination,!1);this.addTie(t)}if(e.isSlurDestination){let t=new yh(e.slurOrigin,e,!0);this.addTie(t)}if(!this._effectSlur&&e.isEffectSlurOrigin&&e.effectSlurDestination){const t=new yh(e,e.effectSlurDestination,!1);this._effectSlur=t,this.addTie(t)}if(!this._effectEndSlur&&e.beat.isEffectSlurDestination&&e.beat.effectSlurOrigin){let t=this.onNotes.beamingHelper.direction,s=t===R.Up?e.beat.effectSlurOrigin.minNote:e.beat.effectSlurOrigin.maxNote,r=t===R.Up?e.beat.minNote:e.beat.maxNote;const n=new yh(s,r,!0);this._effectEndSlur=n,this.addTie(n)}if(e.hasBend){if(!this._bend){const t=new E4(e.beat);this._bend=t,t.renderer=this.renderer,this.addTie(t)}this._bend.addBends(e)}}}}class A4 extends vt{constructor(e,t,s,r){super(e,t),this._dotOffset=0,this._circleSize=0,this._dotOffset=0,this._circleSize=0,this._dotOffset=r,this._circleSize=s}doLayout(){this.width=13*this.scale}paint(e,t,s){let r=4*this.scale,n=t+this.y+this.renderer.topPadding,a=t+this.y+this.renderer.height-this.renderer.bottomPadding,o=e+this.x+.5,l=a-n;s.fillRect(o,n,r,l),o+=r*2-.5,s.beginPath(),s.moveTo(o,n),s.lineTo(o,a),s.stroke(),o+=3*this.scale;let u=this._circleSize*this.scale,h=(n+a)/2;s.fillCircle(o,h-u*this._dotOffset,u),s.fillCircle(o,h+u*this._dotOffset,u)}}class zd extends vt{constructor(e,t){super(e,t)}doLayout(){this.renderer.isLast?this.width=15*this.scale:!this.renderer.nextRenderer||this.renderer.nextRenderer.staff!==this.renderer.staff||!this.renderer.nextRenderer.bar.masterBar.isRepeatStart?(this.width=2*this.scale,this.renderer.bar.masterBar.isDoubleBar&&(this.width+=2*this.scale)):this.width=2*this.scale}paint(e,t,s){let r=4*this.scale,n=t+this.y+this.renderer.topPadding,a=t+this.y+this.renderer.height-this.renderer.bottomPadding,o=e+this.x,l=a-n;if(this.renderer.isLast)s.fillRect(o+this.width-r-r,n,this.scale,l),s.fillRect(o+this.width-r,n,r,l);else if(!this.renderer.nextRenderer||this.renderer.nextRenderer.staff!==this.renderer.staff||!this.renderer.nextRenderer.bar.masterBar.isRepeatStart)if(this.renderer.bar.masterBar.isFreeTime){const u=zd.DashSize*this.scale,h=(o+this.width-this.scale|0)+.5,c=Math.ceil(l/2/u);if(s.beginPath(),c<1)s.moveTo(h,n),s.lineTo(h,a);else{let d=n;const p=(l-c*u)/(c-1);for(;d<a;)s.moveTo(h,d),s.lineTo(h,d+u),d+=u+p}s.stroke()}else s.fillRect(o+this.width-this.scale,n,this.scale,l),this.renderer.bar.masterBar.isDoubleBar&&s.fillRect(o+this.width-5*this.scale,n,this.scale,l)}}zd.DashSize=4;class I4 extends vt{constructor(e,t){super(e,t)}doLayout(){this.width=11*this.scale}paint(e,t,s){let r=4*this.scale,n=t+this.y+this.renderer.topPadding,a=t+this.y+this.renderer.height-this.renderer.bottomPadding,o=e+this.x,l=a-n,u=1.5*this.scale,h=(n+a)/2,c=3;s.fillCircle(o,h-u*c,u),s.fillCircle(o,h+u*c,u),o+=4*this.scale,s.beginPath(),s.moveTo(o,n),s.lineTo(o,a),s.stroke(),o+=3*this.scale+.5,s.fillRect(o,n,r,l)}}class R4 extends vt{constructor(e,t,s){super(e,t),this._count=0,this._count=0,this._count=s}doLayout(){this.width=0}paint(e,t,s){let r=this.renderer.resources,n=s.textAlign;s.font=r.barNumberFont,s.textAlign=de.Right;let a="x"+this._count,o=s.measureText(a).width/1.5;s.fillText(a,e+this.x-o,t+this.y),s.textAlign=n}}class O4 extends vt{constructor(e,t,s){super(e,t),this._number=0,this._number=s}doLayout(){this.renderer.scoreRenderer.canvas.font=this.renderer.resources.barNumberFont,this.width=this.renderer.scoreRenderer.canvas.measureText(this._number.toString()).width+5*this.scale}paint(e,t,s){if(!this.renderer.staff.isFirstInAccolade)return;let r=this.renderer.resources,n=s.color;const a=s.textBaseline;s.textBaseline=we.Top,s.color=r.barNumberColor,s.font=r.barNumberFont,s.fillText(this._number.toString(),e+this.x,t+this.y),s.color=n,s.textBaseline=a}}class qn extends pt{constructor(e,t){super(e,t),this.firstLineY=0,this._startSpacing=!1,this.tupletSize=0}get lineOffset(){return(this.lineSpacing+1)*this.scale}get tupletOffset(){return 10*this.scale}get topGlyphOverflow(){const e=this.resources;return(e.tablatureFont.size/2+e.tablatureFont.size*.2)*this.scale}get bottomGlyphOverflow(){const e=this.resources;return(e.tablatureFont.size/2+e.tablatureFont.size*.2)*this.scale}initLineBasedSizes(){this.topPadding=this.topGlyphOverflow,this.bottomPadding=this.bottomGlyphOverflow,this.height=this.lineOffset*(this.heightLineCount-1)+this.topPadding+this.bottomPadding}updateSizes(){this.initLineBasedSizes(),this.adjustSizes(),this.updateFirstLineY(),super.updateSizes()}adjustSizes(){}updateFirstLineY(){let e=this.lineOffset*(this.heightLineCount-1),t=(this.drawnLineCount-1)*this.lineOffset;this.firstLineY=this.topPadding+(e-t)/2}doLayout(){this.initLineBasedSizes(),this.updateFirstLineY(),this.tupletSize=15*this.scale+this.resources.effectFont.size*.3,super.doLayout()}getLineY(e){return this.firstLineY+this.getLineHeight(e)}getLineHeight(e){return this.lineOffset*e}paintBackground(e,t,s){super.paintBackground(e,t,s);const r=this.resources;s.color=r.staffLineColor;const n=[];for(let a=0,o=this.drawnLineCount;a<o;a++)n.push([]);this.collectSpaces(n);for(const a of n)a.sort((o,l)=>o[0]>l[0]?1:o[0]<l[0]?-1:0);for(let a=0;a<this.drawnLineCount;a++){const o=this.getLineY(a);let l=0;for(let u of n[a])s.fillRect(e+this.x+l,t+this.y+o|0,u[0]-l,this.scale*pt.StaffLineThickness),l=u[0]+u[1];s.fillRect(e+this.x+l,t+this.y+o|0,this.width-l,this.scale*pt.StaffLineThickness)}s.color=r.mainGlyphColor,this.paintSimileMark(e,t,s)}collectSpaces(e){}createStartSpacing(){this._startSpacing||(this.addPreBeatGlyph(new ei(0,0,2*this.scale)),this._startSpacing=!0)}paintTuplets(e,t,s,r=!1){for(const n of this.bar.voices)if(this.hasVoiceContainer(n)){const a=this.getVoiceContainer(n);for(const o of a.tupletGroups)this.paintTupletHelper(e+this.beatGlyphsStart,t,s,o,r)}}getTupletBeamDirection(e){return this.getBeamDirection(e)}paintTupletHelper(e,t,s,r,n){const a=this.resources;let o=s.textAlign,l=s.textBaseline;s.color=r.voice.index===0?this.resources.mainGlyphColor:this.resources.secondaryGlyphColor,s.textAlign=de.Center,s.textBaseline=we.Middle;let u,h=r.beats[0].tupletNumerator,c=r.beats[0].tupletDenominator;h===2&&c===3?u="2":h===3&&c===2?u="3":h===4&&c===6?u="4":h===5&&c===4?u="5":h===6&&c===4?u="6":h===7&&c===4?u="7":h===9&&c===8?u="9":h===10&&c===8?u="10":h===11&&c===8?u="11":h===12&&c===8?u="12":h===13&&c===8?u="13":u=h+":"+c;let d=this.tupletOffset,f=5*this.scale;if(r.beats.length===1||!r.isFull)for(const p of r.beats){let g=this.helpers.beamHelperLookup[r.voice.index].get(p.index);if(!g)continue;let b=this.getTupletBeamDirection(g),m=g.getBeatLineX(p),y=this.calculateBeamYWithDirection(g,m,b);b===R.Down?y+=d+f:y-=d+f,s.font=a.effectFont,s.fillText(u,e+this.x+m,t+this.y+y)}else{let p=r.beats[0],g=r.beats[r.beats.length-1],b=null,m=null;for(let oe=0;oe<r.beats.length;oe++)if(!r.beats[oe].isRest){b=r.beats[oe];break}for(let oe=r.beats.length-1;oe>=0;oe--)if(!r.beats[oe].isRest){m=r.beats[oe];break}let y=!1;b||(b=p,y=!0),m||(m=g);let w=this.helpers.beamHelperLookup[r.voice.index].get(p.index),x=this.helpers.beamHelperLookup[r.voice.index].get(g.index),k=w.getBeatLineX(p),_=x.getBeatLineX(g),T=this.helpers.beamHelperLookup[r.voice.index].get(b.index),C=this.helpers.beamHelperLookup[r.voice.index].get(m.index),W=this.getTupletBeamDirection(w),z=this.calculateBeamYWithDirection(T,k,W),te=this.calculateBeamYWithDirection(C,_,W);y&&(z=Math.max(z,te),te=z),s.font=a.effectFont;let E=s.measureText(u).width,U=3*this.scale,re=(k+_)/2,K=re-E/2-U,ae=re+E/2+U,ie=(te-z)/(_-k),A=z-ie*k,Y=ie*K+A,le=ie*re+A,pe=ie*ae+A;W===R.Down&&(d*=-1,f*=-1),s.beginPath(),s.moveTo(e+this.x+k,t+this.y+z-d|0),n?s.quadraticCurveTo(e+this.x+(K+k)/2,t+this.y+Y-d-f|0,e+this.x+K,t+this.y+Y-d-f|0):(s.lineTo(e+this.x+k,t+this.y+z-d-f|0),s.lineTo(e+this.x+K,t+this.y+Y-d-f|0)),s.stroke(),s.beginPath(),s.moveTo(e+this.x+ae,t+this.y+pe-d-f|0),n?s.quadraticCurveTo(e+this.x+(_+ae)/2,t+this.y+pe-d-f|0,e+this.x+_,t+this.y+te-d|0):(s.lineTo(e+this.x+_,t+this.y+te-d-f|0),s.lineTo(e+this.x+_,t+this.y+te-d|0)),s.stroke(),s.fillText(u,e+this.x+re,t+this.y+le-d-f)}s.textAlign=o,s.textBaseline=l}paintBeams(e,t,s){for(const r of this.helpers.beamHelpers)for(const n of r)this.paintBeamHelper(e+this.beatGlyphsStart,t,s,n)}drawBeamHelperAsFlags(e){return e.beats.length===1}paintBeamHelper(e,t,s,r){s.color=r.voice.index===0?this.resources.mainGlyphColor:this.resources.secondaryGlyphColor,r.isRestBeamHelper||(this.drawBeamHelperAsFlags(r)?this.paintFlag(e,t,s,r):this.paintBar(e,t,s,r))}shouldPaintFlag(e,t){return!(e.graceType===he.BendGrace||!t.hasBeatLineX(e)||e.graceType!==he.None&&this.settings.notation.notationMode===Qt.SongBook||e.duration===N.Whole||e.duration===N.DoubleWhole||e.duration===N.QuadrupleWhole)}paintFlag(e,t,s,r){for(const n of r.beats){if(!this.shouldPaintFlag(n,r))continue;let a=n.graceType!==he.None,o=a?Se.GraceScale:1,l=this.getFlagStemSize(r.shortestDuration),u=r.getBeatLineX(n),h=this.getBeamDirection(r),c=this.getFlagTopY(n,h),d=this.getFlagBottomY(n,h),f=0;if(h===R.Down?(d+=l*o,f=d):(c-=l*o,f=c),!!r.hasLine(!0,n)){if(this.paintBeamingStem(n,t+this.y,e+this.x+u,t+this.y+c,t+this.y+d,s),n.graceType===he.BeforeBeat){let p=15*this.scale,g=12*this.scale;s.beginPath(),h===R.Down?(s.moveTo(e+this.x+u-g/2,t+this.y+d-p),s.lineTo(e+this.x+u+g/2,t+this.y+d)):(s.moveTo(e+this.x+u-g/2,t+this.y+c+p),s.lineTo(e+this.x+u+g/2,t+this.y+c)),s.stroke()}if(r.hasFlag(!0,n)){let p=new Ou(u-this.scale/2,f,n.duration,h,a);p.renderer=this,p.doLayout(),p.paint(e+this.x,t+this.y,s)}}}}getFlagStemSize(e){let t=0;switch(e){case N.QuadrupleWhole:case N.Half:case N.Quarter:case N.Eighth:case N.Sixteenth:case N.ThirtySecond:case N.SixtyFourth:case N.OneHundredTwentyEighth:case N.TwoHundredFiftySixth:t=3;break;default:t=0;break}return this.getLineHeight(t)}calculateBeamY(e,t){return this.calculateBeamYWithDirection(e,t,this.getBeamDirection(e))}createPreBeatGlyphs(){super.createPreBeatGlyphs(),this.bar.masterBar.isRepeatStart&&this.addPreBeatGlyph(new A4(0,0,1.5,3)),this.createLinePreBeatGlyphs(),this.addPreBeatGlyph(new O4(0,this.getLineHeight(-.25),this.bar.index+1))}createPostBeatGlyphs(){super.createPostBeatGlyphs(),this.bar.masterBar.isRepeatEnd?(this.addPostBeatGlyph(new I4(this.x,0)),this.bar.masterBar.repeatCount>2&&this.addPostBeatGlyph(new R4(0,this.getLineHeight(-.25),this.bar.masterBar.repeatCount))):this.addPostBeatGlyph(new zd(0,0))}paintBar(e,t,s,r){for(let n=0,a=r.beats.length;n<a;n++){let o=r.beats[n];if(!r.hasBeatLineX(o))continue;let u=o.graceType!==he.None?Se.GraceScale:1,h=r.getBeatLineX(o),c=this.getBeamDirection(r),d=t+this.y+this.getBarLineStart(o,c),f=t+this.y+this.calculateBeamY(r,h);this.paintBeamingStem(o,t+this.y,e+this.x+h,d,f,s);let p=f;c===R.Down?p+=s.font.size*2:n!==0&&(p-=s.font.size*1.5);let g=6*this.scale*u,b=(pt.BeamSpacing+pt.BeamThickness)*this.scale*u,m=pt.BeamThickness*this.scale*u,y=et.getIndex(o.duration)-2,w=t+this.y;c===R.Down&&(b=-b,m=-m);for(let x=0;x<y;x++){let k=0,_=0,T=0,C=0,W=w+x*b;if(n<r.beats.length-1){if(dr.isFullBarJoin(o,r.beats[n+1],x))k=h,_=r.getBeatLineX(r.beats[n+1]);else if(n===0||!dr.isFullBarJoin(r.beats[n-1],o,x))k=h,_=k+g;else continue;T=W+this.calculateBeamY(r,k),C=W+this.calculateBeamY(r,_),qn.paintSingleBar(s,e+this.x+k,T,e+this.x+_,C,m)}else n>0&&!dr.isFullBarJoin(o,r.beats[n-1],x)&&(k=h-g,_=h,T=W+this.calculateBeamY(r,k),C=W+this.calculateBeamY(r,_),qn.paintSingleBar(s,e+this.x+k,T,e+this.x+_,C,m))}}}static paintSingleBar(e,t,s,r,n,a){e.beginPath(),e.moveTo(t,s),e.lineTo(r,n),e.lineTo(r,n+a),e.lineTo(t,s+a),e.closePath(),e.fill()}}class fr extends qn{constructor(e,t){super(e,t),this.simpleWhammyOverflow=0,this.beatEffectsMinY=null,this.beatEffectsMaxY=null,this.accidentalHelper=new mt(this)}get lineSpacing(){return pt.RawLineSpacing}get heightLineCount(){return 5}get drawnLineCount(){return this.bar.staff.standardNotationLineCount}registerBeatEffectOverflows(e,t){const s=this.beatEffectsMinY;(s==null||e<s)&&(this.beatEffectsMinY=e);const r=this.beatEffectsMaxY;(r==null||t>r)&&(this.beatEffectsMaxY=t)}getScoreY(e){return super.getLineY(e/2)}getScoreHeight(e){return super.getLineHeight(e/2)}doLayout(){if(super.doLayout(),!this.bar.isEmpty&&this.accidentalHelper.maxLineBeat){let e=this.getScoreY(-2),t=this.getScoreY(10),s=this.simpleWhammyOverflow;const r=this.beatEffectsMinY;if(r!==null){const h=e-r;h>0&&this.registerOverflowTop(h)}const n=this.beatEffectsMaxY;if(n!==null){const h=n-t;h>0&&this.registerOverflowBottom(h)}this.registerOverflowTop(s);let a=this.getScoreY(this.accidentalHelper.maxLine),o=this.helpers.getBeamingHelperForBeat(this.accidentalHelper.maxLineBeat);o.direction===R.Up&&(a-=this.getStemSize(o),o.hasTuplet&&(a-=this.tupletSize)),a<e&&this.registerOverflowTop(Math.abs(a)+s);let l=this.getScoreY(this.accidentalHelper.minLine),u=this.helpers.getBeamingHelperForBeat(this.accidentalHelper.minLineBeat);u.direction===R.Down&&(l+=this.getStemSize(u),u.hasTuplet&&(l+=this.tupletSize)),l>t&&this.registerOverflowBottom(Math.abs(l)-t)}}paint(e,t,s){super.paint(e,t,s),this.paintBeams(e,t,s),this.paintTuplets(e,t,s)}getSlashFlagY(e,t){let s=(this.heightLineCount-1)/2,r=0;switch(e){case N.QuadrupleWhole:case N.DoubleWhole:case N.Whole:r+=2;break;default:r+=1;break}return t==R.Down?s+=r:s-=r,this.getLineY(s)}getFlagTopY(e,t){return e.slashed?this.getSlashFlagY(e.duration,t):this.getScoreY(this.accidentalHelper.getMinLine(e))}getFlagBottomY(e,t){return e.slashed?this.getSlashFlagY(e.duration,t):this.getScoreY(this.accidentalHelper.getMaxLine(e))}getBeamDirection(e){return e.direction}getStemSize(e){let t=e.beats.length===1?this.getFlagStemSize(e.shortestDuration):this.getBarStemSize(e.shortestDuration);return e.isGrace&&(t=t*Se.GraceScale),t}getBarStemSize(e){let t=0;switch(e){case N.QuadrupleWhole:case N.Half:case N.Quarter:case N.Eighth:case N.Sixteenth:t=6;break;case N.ThirtySecond:t=8;break;case N.SixtyFourth:t=9;break;case N.OneHundredTwentyEighth:t=9;break;case N.TwoHundredFiftySixth:t=10;break;default:t=0;break}return this.getScoreHeight(t)}get middleYPosition(){return this.getScoreY(this.bar.staff.standardNotationLineCount-1)}getNoteY(e,t){if(e.beat.slashed){let r=(this.heightLineCount-1)/2;return this.getLineY(r)}let s=super.getNoteY(e,t);if(isNaN(s)){const r=mt.computeLineWithoutAccidentals(this.bar,e);s=this.getScoreY(r)}return s}applyLayoutingInfo(){const e=super.applyLayoutingInfo();if(e&&this.bar.isMultiVoice){let t=this.getScoreY(-2),s=this.getScoreY(10),r=this.helpers.collisionHelper.getBeatMinMaxY();r[0]<t&&this.registerOverflowTop(Math.abs(r[0])),r[1]>s&&this.registerOverflowBottom(Math.abs(r[1])-s)}return e}calculateBeamYWithDirection(e,t,s){let r=this.getStemSize(e);if(!e.drawingInfos.has(s)){let n=new MO;e.drawingInfos.set(s,n);const a=e.beats[0],o=e.beats[e.beats.length-1],l=e.isRestBeamHelper;n.startBeat=a,n.startX=e.getBeatLineX(a),l?n.startY=s===R.Up?this.getScoreY(e.minRestLine):this.getScoreY(e.maxRestLine):n.startY=s===R.Up?this.getFlagTopY(a,s)-r:this.getFlagBottomY(a,s)+r,n.endBeat=o,n.endX=e.getBeatLineX(o),l?n.endY=s===R.Up?this.getScoreY(e.minRestLine):this.getScoreY(e.maxRestLine):n.endY=s===R.Up?this.getFlagTopY(o,s)-r:this.getFlagBottomY(o,s)+r;let u=10*this.scale;if(s===R.Down&&n.startY>n.endY&&n.startY-n.endY>u&&(n.endY=n.startY-u),s===R.Down&&n.endY>n.startY&&n.endY-n.startY>u&&(n.startY=n.endY-u),s===R.Up&&n.startY<n.endY&&n.endY-n.startY>u&&(n.endY=n.startY+u),s===R.Up&&n.endY<n.startY&&n.startY-n.endY>u&&(n.startY=n.endY+u),e.beats.length>1){if(s===R.Up){let h=this.getScoreY(this.accidentalHelper.getMinLine(e.beatOfHighestNote))-r;const d=n.calcY(e.getBeatLineX(e.beatOfHighestNote))-h;d>0&&(n.startY-=d,n.endY-=d)}else{let h=this.getScoreY(this.accidentalHelper.getMaxLine(e.beatOfLowestNote))+r;const c=n.calcY(e.getBeatLineX(e.beatOfLowestNote)),d=h-c;d>0&&(n.startY+=d,n.endY+=d)}if(e.minRestLine!==null||e.maxRestLine!==null){const h=et.getIndex(e.shortestDuration)-2;let c=e.isGrace?Se.GraceScale:1,d=h*(pt.BeamSpacing+pt.BeamThickness)*this.scale*c;if(d+=pt.BeamSpacing,s===R.Up&&e.minRestLine!==null){let f=this.getScoreY(e.minRestLine)-d;const g=n.calcY(e.getBeatLineX(e.beatOfMinRestLine))-f;g>0&&(n.startY-=g,n.endY-=g)}else if(s===R.Down&&e.maxRestLine!==null){let f=this.getScoreY(e.maxRestLine)+d;const p=n.calcY(e.getBeatLineX(e.beatOfMaxRestLine)),g=f-p;g>0&&(n.startY+=g,n.endY+=g)}}if(e.slashBeats.length>0)for(const h of e.slashBeats){const c=n.calcY(e.getBeatLineX(h));let d=this.getSlashFlagY(h.duration,s);s===R.Up?d-=r:s===R.Down&&(d+=r);const f=d-c;f>0&&(n.startY+=f,n.endY+=f)}}}return e.drawingInfos.get(s).calcY(t)}getBarLineStart(e,t){return e.slashed?this.getSlashFlagY(e.duration,t):t===R.Up?this.getScoreY(this.accidentalHelper.getMaxLine(e)):this.getScoreY(this.accidentalHelper.getMinLine(e))}createLinePreBeatGlyphs(){if(this.isFirstOfLine||this.bar.clef!==this.bar.previousBar.clef||this.bar.clefOttava!==this.bar.previousBar.clefOttava){let e=0;switch(this.bar.clef){case ve.Neutral:e=this.bar.staff.standardNotationLineCount-1;break;case ve.F4:e=2;break;case ve.C3:e=4;break;case ve.C4:e=2;break;case ve.G2:e=6;break}this.createStartSpacing(),this.addPreBeatGlyph(new X0(0,this.getScoreY(e)+.5*pt.StaffLineThickness,this.bar.clef,this.bar.clefOttava))}(this.index===0&&this.bar.masterBar.keySignature!==Le.C||this.bar.previousBar&&this.bar.masterBar.keySignature!==this.bar.previousBar.masterBar.keySignature)&&(this.createStartSpacing(),this.createKeySignatureGlyphs()),(!this.bar.previousBar||this.bar.previousBar&&this.bar.masterBar.timeSignatureNumerator!==this.bar.previousBar.masterBar.timeSignatureNumerator||this.bar.previousBar&&this.bar.masterBar.timeSignatureDenominator!==this.bar.previousBar.masterBar.timeSignatureDenominator||this.bar.previousBar&&this.bar.masterBar.isFreeTime&&this.bar.masterBar.isFreeTime!==this.bar.previousBar.masterBar.isFreeTime)&&(this.createStartSpacing(),this.createTimeSignatureGlyphs())}createKeySignatureGlyphs(){let e=0,t=this.bar.masterBar.keySignature,s=this.bar.previousBar?this.bar.previousBar.masterBar.keySignature:0;switch(this.bar.clef){case ve.Neutral:e=0;break;case ve.G2:e=1;break;case ve.F4:e=3;break;case ve.C3:e=2;break;case ve.C4:e=0;break}let r=new Map,n=[];if(et.keySignatureIsSharp(t))for(let l=0;l<Math.abs(t);l++){let u=fr.SharpKsSteps[l]+e;n.push(new Hr(0,this.getScoreY(u),ue.Sharp,1)),r.set(u,!0)}else for(let l=0;l<Math.abs(t);l++){let u=fr.FlatKsSteps[l]+e;n.push(new Hr(0,this.getScoreY(u),ue.Flat,1)),r.set(u,!0)}let a=Math.abs(s),o=et.keySignatureIsSharp(s)?fr.SharpKsSteps:fr.FlatKsSteps;for(let l=0;l<a;l++){let u=o[l]+e;r.has(u)||this.addPreBeatGlyph(new Hr(0,this.getScoreY(o[l]+e),ue.Natural,1))}for(let l of n)this.addPreBeatGlyph(l)}createTimeSignatureGlyphs(){this.addPreBeatGlyph(new ei(0,0,5*this.scale));const e=this.bar.staff.standardNotationLineCount-1;this.addPreBeatGlyph(new K0(0,this.getScoreY(e),this.bar.masterBar.timeSignatureNumerator,this.bar.masterBar.timeSignatureDenominator,this.bar.masterBar.timeSignatureCommon,this.bar.masterBar.isFreeTime))}createVoiceGlyphs(e){for(const t of e.beats){let s=new D4(t,this.getVoiceContainer(e));s.preNotes=new M4,s.onNotes=new N4,this.addBeatGlyph(s)}}getNoteLine(e){return this.accidentalHelper.getNoteLine(e)}completeBeamingHelper(e){if(this.bar.isMultiVoice&&e.highestNoteInHelper&&e.lowestNoteInHelper){let t=this.getNoteY(e.highestNoteInHelper,q.Center),s=this.getNoteY(e.lowestNoteInHelper,q.Center),r=this.getStemSize(e);e.hasTuplet&&(r+=this.resources.effectFont.size*2),e.direction==R.Up?t-=r:s+=r;for(const n of e.beats)this.helpers.collisionHelper.reserveBeatSlot(n,t,s)}}paintBeamingStem(e,t,s,r,n,a){a.lineWidth=pt.StemWidth*this.scale,a.beginPath(),a.moveTo(s,r),a.lineTo(s,n),a.stroke(),a.lineWidth=this.scale}}fr.StaffId="score";fr.SharpKsSteps=[-1,2,-2,1,4,0,3];fr.FlatKsSteps=[3,0,4,1,5,2,6];class F4 extends Fu{get staffId(){return fr.StaffId}getStaffPaddingTop(e){return e.system.layout.renderer.settings.display.notationStaffPaddingTop}getStaffPaddingBottom(e){return e.system.layout.renderer.settings.display.notationStaffPaddingBottom}create(e,t){return new fr(e,t)}canCreate(e,t){return super.canCreate(e,t)&&t.showStandardNotation}constructor(){super()}}class V4 extends vt{constructor(e,t,s,r){super(0,0),this._inType=e,this._outType=t,this._startNote=s,this._parent=r}doLayout(){this.width=0}paint(e,t,s){this.paintSlideIn(e,t,s),this.paintSlideOut(e,t,s)}paintSlideIn(e,t,s){let r=this.renderer,n=12*this.scale,a=3*this.scale,o=0,l=0,u=0,h=0;switch(this._inType){case ii.IntoFromBelow:u=e+r.x+r.getNoteX(this._startNote,Ze.Left),h=t+r.y+r.getNoteY(this._startNote,q.Center),o=u-n,l=t+r.y+r.getNoteY(this._startNote,q.Center)+a;break;case ii.IntoFromAbove:u=e+r.x+r.getNoteX(this._startNote,Ze.Left),h=t+r.y+r.getNoteY(this._startNote,q.Center),o=u-n,l=t+r.y+r.getNoteY(this._startNote,q.Center)-a;break;default:return}this.paintSlideLine(s,!1,o,u,l,h)}paintSlideOut(e,t,s){let r=this.renderer,n=12*this.scale,a=3*this.scale,o=0,l=0,u=0,h=0,c=!1;const d=2*this.scale;switch(this._outType){case xe.Shift:case xe.Legato:if(o=e+r.x+r.getBeatX(this._startNote.beat,_e.PostNotes),l=t+r.y+r.getNoteY(this._startNote,q.Center),this._startNote.slideTarget){let f=this.renderer.scoreRenderer.layout.getRendererForBar(this.renderer.staff.staveId,this._startNote.slideTarget.beat.voice.bar);!f||f.staff!==r.staff?(u=e+r.x+r.width,h=l):(u=e+f.x+f.getBeatX(this._startNote.slideTarget.beat,_e.OnNotes)-d,h=t+f.y+f.getNoteY(this._startNote.slideTarget,q.Center)),this._startNote.slideTarget.fret>this._startNote.fret?(l+=a,h-=a):(l-=a,h+=a)}else u=e+r.x+this._parent.x,h=l;break;case xe.OutUp:o=e+r.x+r.getNoteX(this._startNote,Ze.Right),l=t+r.y+r.getNoteY(this._startNote,q.Center),u=o+n-d,h=t+r.y+r.getNoteY(this._startNote,q.Center)-a;break;case xe.OutDown:o=e+r.x+r.getNoteX(this._startNote,Ze.Right),l=t+r.y+r.getNoteY(this._startNote,q.Center),u=o+n-d,h=t+r.y+r.getNoteY(this._startNote,q.Center)+a;break;case xe.PickSlideDown:o=e+r.x+r.getNoteX(this._startNote,Ze.Right),l=t+r.y+r.getNoteY(this._startNote,q.Center),u=e+r.x+r.getBeatX(this._startNote.beat,_e.EndBeat),h=l+a*3,c=!0;break;case xe.PickSlideUp:o=e+r.x+r.getNoteX(this._startNote,Ze.Right),l=t+r.y+r.getNoteY(this._startNote,q.Center),u=e+r.x+r.getBeatX(this._startNote.beat,_e.EndBeat),h=l-a*3,c=!0;break;default:return}this.paintSlideLine(s,c,o,u,l,h)}paintSlideLine(e,t,s,r,n,a){if(t){let o=new Ma(0,0,Ge.Slight,1.2);o.renderer=this.renderer,o.doLayout(),n-=o.height/2,a-=o.height/2;let l=r-s,u=a-n,h=Math.sqrt(Math.pow(u,2)+Math.pow(l,2));o.width=l;let c=Math.asin(u/h)*(180/Math.PI);e.beginRotate(s,n,c),o.paint(0,0,e),e.endRotate()}else e.beginPath(),e.moveTo(s,n),e.lineTo(r,a),e.stroke()}}class nn extends Gt{constructor(e,t,s=!1){super(e.beat,t.beat,s),this.startNote=e,this.endNote=t}getTieHeight(e,t,s,r){return this.startNote===this.endNote?15:super.getTieHeight(e,t,s,r)}getBeamDirection(e,t){return this.startNote===this.endNote?R.Up:nn.getBeamDirectionForNote(this.startNote)}static getBeamDirectionForNote(e){return e.string>3?R.Up:R.Down}getStartY(){return this.startNote===this.endNote?this.startNoteRenderer.getNoteY(this.startNote,q.Center):this.tieDirection===R.Up?this.startNoteRenderer.getNoteY(this.startNote,q.Top):this.startNoteRenderer.getNoteY(this.startNote,q.Bottom)}getEndY(){return this.getStartY()}getStartX(){return this.startNote===this.endNote?this.getEndX()-20*this.scale:this.startNoteRenderer.getNoteX(this.startNote,Ze.Center)}getEndX(){return this.startNote===this.endNote?this.endNoteRenderer.getNoteX(this.endNote,Ze.Left):this.endNoteRenderer.getNoteX(this.endNote,Ze.Center)}}class bS extends nn{constructor(e,t,s,r=!1){super(e,t,r),this._direction=nn.getBeamDirectionForNote(e),this._forSlide=s}getTieHeight(e,t,s,r){return Math.log(s-e+1)*this.renderer.settings.notation.slurHeight}tryExpand(e,t,s,r){if(this._forSlide!==s||this.forEnd!==r||this.startNote.beat.id!==e.beat.id||this.endNote.beat.id!==t.beat.id||this._direction!==nn.getBeamDirectionForNote(e))return!1;switch(this._direction){case R.Up:e.realValue>this.startNote.realValue&&(this.startNote=e,this.startBeat=e.beat),t.realValue>this.endNote.realValue&&(this.endNote=t,this.endBeat=t.beat);break;case R.Down:e.realValue<this.startNote.realValue&&(this.startNote=e,this.startBeat=e.beat),t.realValue<this.endNote.realValue&&(this.endNote=t,this.endBeat=t.beat);break}return!0}paint(e,t,s){let r=this.renderer.scoreRenderer.layout.getRendererForBar(this.renderer.staff.staveId,this.startBeat.voice.bar),n=this.getBeamDirection(this.startBeat,r),a="tab.slur."+this.startNote.beat.id+"."+this.endNote.beat.id+"."+n,o=this.renderer;o.staff.getSharedLayoutData(a,!1)||(o.staff.setSharedLayoutData(a,!0),super.paint(e,t,s))}}class H4 extends Cs{constructor(e,t){super(e,t),this._bend=null,this._effectSlurs=[]}drawBeamHelperAsFlags(e){return e.hasFlag(this.renderer.drawBeamHelperAsFlags(e),this.beat)}doLayout(){this._effectSlurs=[],super.doLayout(),this._bend&&(this._bend.renderer=this.renderer,this._bend.doLayout(),this.updateWidth())}createTies(e){if(!e.isVisible)return;let t=this.renderer;if(e.isTieOrigin&&t.showTiedNotes&&e.tieDestination.isVisible){let s=new nn(e,e.tieDestination,!1);this.addTie(s)}if(e.isTieDestination&&t.showTiedNotes){let s=new nn(e.tieOrigin,e,!0);this.addTie(s)}if(e.isLeftHandTapped&&!e.isHammerPullDestination){let s=new nn(e,e,!1);this.addTie(s)}if(e.isEffectSlurOrigin&&e.effectSlurDestination){let s=!1;for(let r of this._effectSlurs)if(r.tryExpand(e,e.effectSlurDestination,!1,!1)){s=!0;break}if(!s){let r=new bS(e,e.effectSlurDestination,!1,!1);this._effectSlurs.push(r),this.addTie(r)}}if(e.isEffectSlurDestination&&e.effectSlurOrigin){let s=!1;for(let r of this._effectSlurs)if(r.tryExpand(e.effectSlurOrigin,e,!1,!0)){s=!0;break}if(!s){let r=new bS(e.effectSlurOrigin,e,!1,!0);this._effectSlurs.push(r),this.addTie(r)}}if(e.slideInType!==ii.None||e.slideOutType!==xe.None){let s=new V4(e.slideInType,e.slideOutType,e,this);this.addTie(s)}if(e.hasBend){if(!this._bend){const s=new Us;this._bend=s,s.renderer=this.renderer,this.addTie(s)}this._bend.addBends(e)}}}class z4 extends vt{constructor(e,t,s){super(e,t),this._noteString=null,this._trillNoteString=null,this._trillNoteStringWidth=0,this.isEmpty=!1,this.noteStringWidth=0,this._note=s}doLayout(){let e=this._note,t=e.fret-e.beat.voice.bar.staff.transpositionPitch;if(e.harmonicType===fe.Natural&&e.harmonicValue!==0&&(t=e.harmonicValue-e.beat.voice.bar.staff.transpositionPitch),e.isTieDestination)e.beat.index===0&&this.renderer.settings.notation.notationMode==Qt.GuitarPro||(e.bendType===se.Bend||e.bendType===se.BendRelease)&&this.renderer.settings.notation.isNotationElementVisible(me.TabNotesOnTiedBends)?this._noteString="("+(e.tieOrigin.fret-e.beat.voice.bar.staff.transpositionPitch).toString()+")":this._noteString="";else if(this._noteString=e.isDead?"x":t.toString(),e.isGhost)this._noteString="("+this._noteString+")";else if(e.harmonicType===fe.Natural){let s=this._noteString.indexOf(".");s>=0&&(this._noteString=this._noteString.substr(0,s+2)),this._noteString="<"+this._noteString+">"}if(e.isTrill)this._trillNoteString="("+(e.trillFret-e.beat.voice.bar.staff.transpositionPitch).toString()+")";else if(et.isAlmostEqualTo(e.harmonicValue,0))this._trillNoteString="";else switch(e.harmonicType){case fe.Artificial:case fe.Pinch:case fe.Tap:case fe.Semi:case fe.Feedback:let s=(t+e.harmonicValue).toString(),r=s.indexOf(".");r>=0&&(s=s.substr(0,r+2)),this._trillNoteString="<"+s+">";break;default:this._trillNoteString="";break}this.isEmpty=!this._noteString,this.isEmpty||(this.renderer.scoreRenderer.canvas.font=this.renderer.resources.tablatureFont,this.noteStringWidth=this.renderer.scoreRenderer.canvas.measureText(this._noteString).width*this.scale,this.width=this.noteStringWidth,this.height=this.renderer.scoreRenderer.canvas.font.size,this._trillNoteString&&(this.renderer.scoreRenderer.canvas.font=this.renderer.resources.graceFont,this._trillNoteStringWidth=3*this.scale+this.renderer.scoreRenderer.canvas.measureText(this._trillNoteString).width,this.width+=this._trillNoteStringWidth))}paint(e,t,s){if(this.isEmpty)return;let r=this.noteStringWidth+this._trillNoteStringWidth,n=e+this.x+(this.width-r)/2,a=this.renderer.scoreRenderer.canvas.font;this.renderer.scoreRenderer.canvas.font=this.renderer.resources.graceFont,s.fillText(this._trillNoteString,n+this.noteStringWidth+3*this.scale,t+this.y),this.renderer.scoreRenderer.canvas.font=a,s.fillText(this._noteString,n,t+this.y)}buildBoundingsLookup(e,t,s){let r=new Ru;r.note=this._note,r.noteHeadBounds=new Wi,r.noteHeadBounds.x=t+this.x,r.noteHeadBounds.y=s+this.y-this.height/2,r.noteHeadBounds.w=this.width,r.noteHeadBounds.h=this.height,e.addNote(r)}}class W4 extends vt{constructor(e,t,s){super(e,t),this._notes=[],this.minStringNote=null,this.beatEffects=new Map,this.notesPerString=new Map,this.noteStringWidth=0,this._isGrace=s}buildBoundingsLookup(e,t,s){for(const r of this._notes)r.buildBoundingsLookup(e,t+this.x,s+this.y)}getNoteX(e,t){if(this.notesPerString.has(e.string)){let s=this.notesPerString.get(e.string),r=this.x+s.x;switch(t){case Ze.Left:break;case Ze.Center:r+=s.noteStringWidth/2;break;case Ze.Right:r+=s.width;break}return r}return 0}getNoteY(e,t){if(this.notesPerString.has(e.string)){const s=this.notesPerString.get(e.string);let r=this.y+s.y;switch(t){case q.Top:case q.TopWithStem:r-=s.height/2+2*this.scale;break;case q.Center:break;case q.Bottom:case q.BottomWithStem:r+=s.height/2;break}return r}return 0}doLayout(){let e=0,t=0;for(let a=0,o=this._notes.length;a<o;a++){let l=this._notes[a];l.renderer=this.renderer,l.doLayout(),l.width>e&&(e=l.width),l.noteStringWidth>t&&(t=l.noteStringWidth)}this.noteStringWidth=t;let s=this.renderer.resources.tablatureFont.size,r=this.getNoteY(this.minStringNote,q.Center)+s/2,n=7*this.scale;for(const a of this.beatEffects.values())a.y+=r,a.x+=this.width/2,a.renderer=this.renderer,r+=n,a.doLayout();this.width=e}addNoteGlyph(e,t){this._notes.push(e),this.notesPerString.set(t.string,e),(!this.minStringNote||t.string<this.minStringNote.string)&&(this.minStringNote=t)}paint(e,t,s){e+=this.x,t+=this.y;let r=this.renderer.resources,n=s.textBaseline;s.textBaseline=we.Middle,s.font=this._isGrace?r.graceFont:r.tablatureFont;let a=this._notes,o=this.width;for(let l of a)l.renderer=this.renderer,l.width=o,l.paint(e,t,s);s.textBaseline=n;for(const l of this.beatEffects.values())l.paint(e,t,s)}updateBeamingHelper(e){this.beamingHelper&&this.beamingHelper.isPositionFrom("tab",this.beat)&&this.beamingHelper.registerBeatLineX("tab",this.beat,e+this.x+this.width/2,e+this.x+this.width/2)}}class G4 extends Rt{constructor(e,t,s,r){super(e,t,1,Ea.getSymbol(r)),this._isVisibleRest=s,this._duration=r}doLayout(){this._isVisibleRest?this.width=Ea.getSize(this._duration)*this.scale:this.width=10*this.scale}updateBeamingHelper(e){this.beamingHelper&&this.beamingHelper.isPositionFrom("tab",this.beat)&&this.beamingHelper.registerBeatLineX("tab",this.beat,e+this.x+this.width/2,e+this.x+this.width/2)}paint(e,t,s){this._isVisibleRest&&super.paint(e,t,s)}}class j4 extends za{constructor(){super(...arguments),this.slash=null,this.noteNumbers=null,this.restGlyph=null}getNoteX(e,t){return this.noteNumbers?this.noteNumbers.getNoteX(e,t):0}getNoteY(e,t){return this.noteNumbers?this.noteNumbers.getNoteY(e,t):0}buildBoundingsLookup(e,t,s){this.noteNumbers&&this.noteNumbers.buildBoundingsLookup(e,t+this.x,s+this.y)}doLayout(){let e=this.renderer;if(this.container.beat.isRest){let s=Math.floor((this.renderer.bar.staff.tuning.length-1)/2),r=e.getTabY(s);const n=new G4(0,r,e.showRests,this.container.beat.duration);if(this.restGlyph=n,n.beat=this.container.beat,n.beamingHelper=this.beamingHelper,this.addGlyph(n),this.container.beat.dots>0&&e.showRests){this.addGlyph(new ei(0,0,5*this.scale));for(let a=0;a<this.container.beat.dots;a++)this.addGlyph(new ku(0,r,1.5*this.scale))}}else{let s=this.renderer.settings.notation.smallGraceTabNotes&&this.container.beat.graceType!==he.None,r;if(this.container.beat.slashed&&!this.container.beat.notes.some(n=>n.isTieDestination)){const n=Math.floor((this.renderer.bar.staff.tuning.length-1)/2),a=e.getLineY(n),o=new ci(0,a,this.container.beat.duration,s);this.slash=o,o.beat=this.container.beat,o.beamingHelper=this.beamingHelper,this.addGlyph(o),r=o.beatEffects}else{const n=new W4(0,0,s);this.noteNumbers=n,n.beat=this.container.beat,n.beamingHelper=this.beamingHelper;for(let a of this.container.beat.notes)a.isVisible&&this.createNoteGlyph(a);this.addGlyph(n),r=n.beatEffects}if(this.container.beat.hasWhammyBar){let n=new _s(this.container.beat);n.renderer=this.renderer,n.doLayout(),this.container.ties.push(n)}if(this.container.beat.isTremolo&&!r.has("tremolo")){let n=0,a=this.container.beat.tremoloSpeed,o=5*this.scale;switch(a){case N.ThirtySecond:n=10;break;case N.Sixteenth:n=5;break;case N.Eighth:n=0;break}this.container.beat.duration<N.Half&&(o=0),r.set("tremolo",new Hd(o,n*this.scale,a))}if(this.container.beat.dots>0&&e.settings.notation.rhythmMode!==Zr.Hidden){this.addGlyph(new ei(0,0,5*this.scale));for(let n=0;n<this.container.beat.dots;n++)this.addGlyph(new ku(0,e.lineOffset*e.bar.staff.tuning.length+e.settings.notation.rhythmHeight*e.scale,1.5*this.scale))}}if(!this.glyphs)return;let t=0;for(let s=0,r=this.glyphs.length;s<r;s++){let n=this.glyphs[s];n.x=t,n.renderer=this.renderer,n.doLayout(),t+=n.width}this.width=t,this.computedWidth=t,this.container.beat.isEmpty?this.centerX=this.width/2:this.restGlyph?this.centerX=this.restGlyph.x+this.restGlyph.width/2:this.noteNumbers?this.centerX=this.noteNumbers.x+this.noteNumbers.noteStringWidth/2:this.slash&&(this.centerX=this.slash.x+this.slash.width/2)}updateBeamingHelper(){this.noteNumbers?this.noteNumbers.updateBeamingHelper(this.container.x+this.x):this.restGlyph?this.restGlyph.updateBeamingHelper(this.container.x+this.x):this.slash&&this.slash.updateBeamingHelper(this.container.x+this.x)}createNoteGlyph(e){let t=this.renderer,s=new z4(0,0,e),r=e.beat.voice.bar.staff.tuning.length-e.string;s.y=t.getTabY(r),s.renderer=this.renderer,s.doLayout(),this.noteNumbers.addNoteGlyph(s,e);let n=s.y-s.height/2,a=n+s.height;this.renderer.helpers.collisionHelper.reserveBeatSlot(this.container.beat,n,a)}}class U4 extends vt{constructor(e){super(0,0),this._beat=e}doLayout(){this.width=10*this.scale}paint(e,t,s){let r=this.renderer,n=t+this.x+r.getNoteY(this._beat.maxStringNote,q.Top),a=t+this.y+r.getNoteY(this._beat.minStringNote,q.Bottom),o=e+this.x+this.width/2|0,l=8*this.scale;if(this._beat.brushType!==ut.None){if(this._beat.brushType===ut.BrushUp||this._beat.brushType===ut.BrushDown)s.beginPath(),s.moveTo(o,n),s.lineTo(o,a),s.stroke();else if(this._beat.brushType===ut.ArpeggioUp){let u=new Ma(0,0,Ge.Slight,1.2,!0);u.renderer=this.renderer,u.doLayout();let h=n,c=a-l;u.width=Math.abs(c-h),s.beginRotate(e+this.x+4*this.scale,c,-90),u.paint(0,-u.height/2,s),s.endRotate()}else if(this._beat.brushType===ut.ArpeggioDown){let u=new Ma(0,0,Ge.Slight,1.2,!0);u.renderer=this.renderer,u.doLayout();let h=n+l,c=a;u.width=Math.abs(c-h),s.beginRotate(e+this.x+4*this.scale,h,90),u.paint(0,-u.height/2,s),s.endRotate()}this._beat.brushType===ut.BrushUp||this._beat.brushType===ut.ArpeggioUp?(s.beginPath(),s.moveTo(o,a),s.lineTo(o+l/2,a-l),s.lineTo(o-l/2,a-l),s.closePath(),s.fill()):(s.beginPath(),s.moveTo(o,n),s.lineTo(o+l/2,n+l),s.lineTo(o-l/2,n+l),s.closePath(),s.fill())}}}class $4 extends Ha{doLayout(){this.container.beat.brushType!==ut.None&&!this.container.beat.isRest&&(this.addGlyph(new U4(this.container.beat)),this.addGlyph(new ei(0,0,4*this.scale))),super.doLayout()}constructor(){super()}}class Y4 extends vt{constructor(e,t){super(e,t)}doLayout(){this.width=28*this.scale}paint(e,t,s){let r=this.renderer.bar.staff.tuning.length,n=r<=4?S.FourStringTabClef:S.SixStringTabClef,a=r<=4?r/4.5:r/6.5;s.fillMusicFontSymbol(e+this.x+5*this.scale,t+this.y,a*this.scale,n,!1)}}class X4 extends tT{get commonScale(){return 1}get numberScale(){return this.renderer.bar.staff.tuning.length<=4?Se.GraceScale:1}}class La extends qn{constructor(e,t){super(e,t),this._hasTuplets=!1,this.showTimeSignature=!1,this.showRests=!1,this.showTiedNotes=!1,t.staff.showStandardNotation||(this.showTimeSignature=!0,this.showRests=!0,this.showTiedNotes=!0)}get lineSpacing(){return La.TabLineSpacing}get heightLineCount(){return this.bar.staff.tuning.length}get drawnLineCount(){return this.bar.staff.tuning.length}getTabY(e){return super.getLineY(e)}getTabHeight(e){return super.getLineHeight(e)}collectSpaces(e){const t=this.scale;for(let s of this.bar.voices)if(this.hasVoiceContainer(s)){let r=this.getVoiceContainer(s);for(let n of r.beatGlyphs){let a=n.onNotes,o=a.noteNumbers;if(o)for(const[l,u]of o.notesPerString)u.isEmpty||e[this.bar.staff.tuning.length-l].push(new Float32Array([r.x+n.x+a.x+o.x,o.width+t]))}}}adjustSizes(){this.settings.notation.rhythmMode!==Zr.Hidden&&(this.height+=this.settings.notation.rhythmHeight*this.settings.display.scale,this.bottomPadding+=this.settings.notation.rhythmHeight*this.settings.display.scale)}doLayout(){if(super.doLayout(),this.settings.notation.rhythmMode!==Zr.Hidden){this._hasTuplets=!1;for(let e of this.bar.voices)if(this.hasVoiceContainer(e)&&this.getVoiceContainer(e).tupletGroups.length>0){this._hasTuplets=!0;break}this._hasTuplets&&this.registerOverflowBottom(this.tupletSize)}}createLinePreBeatGlyphs(){if(this.isFirstOfLine){let e=(this.bar.staff.tuning.length-1)/2;this.addPreBeatGlyph(new Y4(5*this.scale,this.getTabY(e)))}this.showTimeSignature&&(!this.bar.previousBar||this.bar.previousBar&&this.bar.masterBar.timeSignatureNumerator!==this.bar.previousBar.masterBar.timeSignatureNumerator||this.bar.previousBar&&this.bar.masterBar.timeSignatureDenominator!==this.bar.previousBar.masterBar.timeSignatureDenominator||this.bar.previousBar&&this.bar.masterBar.isFreeTime&&this.bar.masterBar.isFreeTime!==this.bar.previousBar.masterBar.isFreeTime)&&(this.createStartSpacing(),this.createTimeSignatureGlyphs())}createTimeSignatureGlyphs(){this.addPreBeatGlyph(new ei(0,0,5*this.scale));const e=(this.bar.staff.tuning.length+1)/2-1;this.addPreBeatGlyph(new X4(0,this.getTabY(e),this.bar.masterBar.timeSignatureNumerator,this.bar.masterBar.timeSignatureDenominator,this.bar.masterBar.timeSignatureCommon,this.bar.masterBar.isFreeTime))}createVoiceGlyphs(e){for(const t of e.beats){let s=new H4(t,this.getVoiceContainer(e));s.preNotes=new $4,s.onNotes=new j4,this.addBeatGlyph(s)}}paint(e,t,s){super.paint(e,t,s),this.settings.notation.rhythmMode!==Zr.Hidden&&(this.paintBeams(e,t,s),this.paintTuplets(e,t,s))}drawBeamHelperAsFlags(e){return super.drawBeamHelperAsFlags(e)||this.settings.notation.rhythmMode===Zr.ShowWithBeams}getFlagTopY(e,t){const s=this.getOnNotesGlyphForBeat(e);return!s.noteNumbers||e.duration===N.Half?this.height-this.settings.notation.rhythmHeight*this.settings.display.scale-this.tupletSize:s.noteNumbers.getNoteY(s.noteNumbers.minStringNote,q.Bottom)}getFlagBottomY(e,t){return this.getFlagAndBarPos()}getFlagStemSize(e){return 0}getBarLineStart(e,t){let s=this.getOnNotesGlyphForBeat(e);return!s.noteNumbers||e.duration===N.Half?this.height-this.settings.notation.rhythmHeight*this.settings.display.scale-this.tupletSize:s.noteNumbers.getNoteY(s.noteNumbers.minStringNote,q.Bottom)+this.lineOffset/2}getBeamDirection(e){return R.Down}getFlagAndBarPos(){return this.height-(this._hasTuplets?this.tupletSize/2:0)}calculateBeamYWithDirection(e,t,s){return this.getFlagAndBarPos()}shouldPaintFlag(e,t){return!super.shouldPaintFlag(e,t)||e.graceType!==he.None?!1:this.drawBeamHelperAsFlags(t)}paintBeamingStem(e,t,s,r,n,a){if(n<r){const u=n;n=r,r=u}a.lineWidth=pt.StemWidth*this.scale,a.beginPath();let o=[];this.helpers.collisionHelper.reservedLayoutAreasByDisplayTime.has(e.displayStart)&&(o=this.helpers.collisionHelper.reservedLayoutAreasByDisplayTime.get(e.displayStart).slots.slice(),o.sort((u,h)=>u.topY-h.topY));let l=n;for(;l>r;){a.moveTo(s,l);let u=r;if(o.length>0&&o[o.length-1].bottomY>u){const h=o.pop();u=t+h.bottomY,a.lineTo(s,u),l=t+h.topY}else{a.lineTo(s,u);break}}a.stroke(),a.lineWidth=this.scale}}La.StaffId="tab";La.TabLineSpacing=10;class Kf extends Fu{get staffId(){return La.StaffId}getStaffPaddingTop(e){return e.system.layout.renderer.settings.display.notationStaffPaddingTop}getStaffPaddingBottom(e){return e.system.layout.renderer.settings.display.notationStaffPaddingBottom}constructor(){super(),this.showTimeSignature=null,this.showRests=null,this.showTiedNotes=null,this.hideOnPercussionTrack=!0}canCreate(e,t){return t.showTablature&&t.tuning.length>0&&super.canCreate(e,t)}create(e,t){let s=new La(e,t);return this.showRests!==null&&(s.showRests=this.showRests),this.showTimeSignature!==null&&(s.showTimeSignature=this.showTimeSignature),this.showTiedNotes!==null&&(s.showTiedNotes=this.showTiedNotes),s}}class xu extends vs{constructor(){super(0,0)}doLayout(){super.doLayout();const e=this.renderer.resources.effectFont;this.height=e.size+xu.Padding*this.scale}paint(e,t,s){let r=this.renderer.resources;s.font=r.effectFont;let n=s.textAlign;s.textAlign=de.Center,s.fillText("T",e+this.x,t+this.y+s.font.size/2),s.textAlign=n,s.strokeCircle(e+this.x,t+this.y+s.font.size/2+(xu.Padding-1)*this.scale,s.font.size/1.6)}}xu.Padding=4;class SS extends Wa{get notationElement(){return me.EffectTap}get sizingMode(){return Ve.SingleOnBeat}shouldCreateGlyphForNote(e){return e.isLeftHandTapped}createNewGlyph(e,t){return new xu}}class kn{constructor(){this.noteRange=1,this.x=0,this.y=0}}var fa;(function(i){i[i.None=0]="None",i[i.Rectangle=1]="Rectangle",i[i.Ellipse=2]="Ellipse",i[i.Circle=3]="Circle"})(fa||(fa={}));class Zf extends kn{constructor(){super(...arguments),this.align=de.Left,this.frame=fa.None,this.text="",this.fontFace="",this.weight=0,this.height=0}}class wS extends kn{constructor(){super(...arguments),this.chord=new Qn}}class vS extends kn{}class kS extends kn{}class Q4 extends kn{constructor(){super(...arguments),this.number=0}}class xS extends kn{constructor(){super(...arguments),this.decrescendo=!1}}class ep extends kn{constructor(){super(...arguments),this.allNumbers=!1,this.firstNumber=0,this.lastNumber=0}}class J4 extends kn{constructor(){super(...arguments),this.octave=1}}class q4 extends kn{}class K4{constructor(){this.defaultClef=ve.G2,this.description="",this.percussion=!1,this.instrument=0,this.volume=0,this.transpose=0,this.index=0}}class Z4{constructor(){this.from=0,this.to=0,this.curly=!1}}class eF{constructor(){this.currentBarIndex=-1,this.currentBarComplete=!0,this.currentBarDuration=0,this.currentPosition=0,this.voiceStemDir=null,this.repeatCount=0,this.repeatEnd=null}}class Vc{constructor(){this._trackChannel=0,this._beamingMode=cr.Auto,this._isFirstSystem=!0,this._staffLookup=new Map,this._brackets=[],this._staffLayoutLookup=new Map,this._staffLayouts=[],this._timeSignature=new gn,this._voiceStates=new Map}parseXml(e,t){this._galleryObjects=new Map,this._tieStarts=[],this._tieStartIds=new Map,this._voiceCounts=new Map,this._slurs=new Map,this._crescendo=new Map,this._isFirstSystem=!0;let s=new Ac;try{s.parse(e)}catch(r){throw new yt("Could not parse XML",r)}this.parseDom(s),this.consolidate(),this.score.finish(t)}consolidate(){for(const e of this.score.tracks){const t=this._voiceCounts.get(e.index);for(const s of e.staves){for(;s.bars.length<this.score.masterBars.length;)this.addNewBar(s);for(const r of s.bars){for(;r.voices.length<t;)r.addVoice(new Wr);for(const n of r.voices)if(n.beats.length===0){const a=new xi;a.isEmpty=!0,n.addBeat(a)}}}}Vc.applyEffectRange(this._slurs,(e,t)=>{t.isLegatoOrigin=!0}),Vc.applyEffectRange(this._crescendo,(e,t)=>{t.crescendo=e.decrescendo?ss.Decrescendo:ss.Crescendo})}static applyEffectRange(e,t){for(const[s,r]of e){const n=r.noteRange;let a=s;for(let o=0;o<n;o++)if(t(r,a),a.index+1<a.voice.beats.length)a=a.voice.beats[a.index+1];else if(a.voice.bar.index+1<a.voice.bar.staff.bars.length)a=a.voice.bar.staff.bars[a.voice.bar.index+1].voices[a.voice.index].beats[0];else break}}parseDom(e){let t=e.firstElement;if(!t)throw new yt("No valid XML");if(t.localName==="score"){this.score=new Fa,this.score.tempo=120;for(let s of t.childNodes)if(s.nodeType===O.Element)switch(s.localName){case"info":this.parseInfo(s);break;case"layout":this.parseLayout(s);break;case"gallery":this.parseGallery(s);break;case"pageObjects":this.parsePageObjects(s);break;case"systems":this.parseSystems(s);break}}else throw new yt('Root node of XML was not "score"')}parseLayout(e){for(let n of e.childNodes)if(n.nodeType===O.Element)switch(n.localName){case"staves":this.parseLayoutStaves(n);break;case"brackets":this.parseBrackets(n);break}const t=this._brackets.filter(n=>!!n.curly);t.sort((n,a)=>n.from-a.from);let s=0,r=null;for(let n=0;n<this._staffLayouts.length;n++){const a=this._staffLayouts[n];for(;s<t.length&&n>t[s].to;)s++;r&&s<t.length&&n>t[s].from&&n<=t[s].to?r.ensureStaveCount(r.staves.length+1):(r=new Va,r.ensureStaveCount(1),r.name=a.description,r.playbackInfo.volume=Math.floor(a.volume/128*16),r.playbackInfo.program=a.instrument,a.percussion?(r.playbackInfo.primaryChannel=9,r.playbackInfo.secondaryChannel=9):(r.playbackInfo.primaryChannel=this._trackChannel++,r.playbackInfo.secondaryChannel=this._trackChannel++),this.score.addTrack(r));const o=r.staves[r.staves.length-1];o.isPercussion=a.percussion,o.transpositionPitch=a.transpose,o.displayTranspositionPitch=0,o.showTablature=!1,this._staffLookup.set(a.index,o)}}parseBrackets(e){for(let t of e.childNodes)if(t.nodeType===O.Element)switch(t.localName){case"bracket":this.parseBracket(t);break}}parseBracket(e){const t=new Z4;t.from=parseInt(e.getAttribute("from")),t.to=parseInt(e.getAttribute("to")),e.attributes.has("curly")&&(t.curly=e.attributes.get("curly")==="true"),this._brackets.push(t)}parseLayoutStaves(e){for(let t of e.childNodes)if(t.nodeType===O.Element)switch(t.localName){case"staffLayout":this.parseStaffLayout(t);break}}parseStaffLayout(e){const t=new K4;t.description=e.getAttribute("description");for(let s of e.childNodes)if(s.nodeType===O.Element)switch(s.localName){case"notation":s.attributes.has("defaultClef")&&(t.defaultClef=this.parseClef(s.attributes.get("defaultClef")));break;case"sound":s.attributes.has("percussion")&&(t.percussion=s.attributes.get("percussion")==="true"),s.attributes.has("instr")&&(t.instrument=parseInt(s.attributes.get("instr"))),s.attributes.has("volume")&&(t.volume=parseInt(s.attributes.get("volume"))),s.attributes.has("transpose")&&(t.transpose=parseInt(s.attributes.get("transpose")));break}this._staffLayoutLookup.set(t.description,t),t.index=this._staffLayouts.length,this._staffLayouts.push(t)}parseClef(e){switch(e){case"treble":return ve.G2;case"bass":return ve.F4;case"alto":return ve.C4;case"tenor":return ve.C4}return ve.G2}parseClefOttava(e){return e.endsWith("-")?Ue._8vb:e.endsWith("+")?Ue._8va:Ue.Regular}parseSystems(e){for(let t of e.childNodes)if(t.nodeType===O.Element)switch(t.localName){case"system":this.parseSystem(t);break}}parseSystem(e){e.attributes.has("tempo")&&this.score.masterBars.length===0&&(this.score.tempo=parseInt(e.attributes.get("tempo"))),e.getAttribute("beamGrouping")==="0"&&(this._beamingMode=cr.ForceSplitToNext);for(let t of e.childNodes)if(t.nodeType===O.Element)switch(t.localName){case"staves":this.parseStaves(e,t);break}this._isFirstSystem=!1}parseStaves(e,t){let s=this.score.masterBars.length;for(let r of t.childNodes)if(r.nodeType===O.Element)switch(r.localName){case"staff":this.parseStaff(e,s,r);break}}parseStaff(e,t,s){const r=s.getAttribute("layout");this._currentStaffLayout=this._staffLayoutLookup.get(r),this._timeSignature.timeSignatureNumerator=4,this._timeSignature.timeSignatureDenominator=4,this._timeSignature.timeSignatureCommon=!1,this.parseTime(s.getAttribute("defaultTime"));const n=this._staffLookup.get(this._currentStaffLayout.index);for(;n.bars.length<t;)this.addNewBar(n);for(let a of s.childNodes)if(a.nodeType===O.Element)switch(a.localName){case"voices":this.parseVoices(r,n,e,t,a);break}}parseTime(e){switch(e){case"allaBreve":case"C":this._timeSignature.timeSignatureNumerator=2,this._timeSignature.timeSignatureDenominator=2,this._timeSignature.timeSignatureCommon=!0;break;case"longAllaBreve":this._timeSignature.timeSignatureNumerator=4,this._timeSignature.timeSignatureDenominator=4,this._timeSignature.timeSignatureCommon=!0;break;default:if(e.indexOf("/")>0){const t=e.split("/");this._timeSignature.timeSignatureNumerator=parseInt(t[0]),this._timeSignature.timeSignatureDenominator=parseInt(t[1]),this._timeSignature.timeSignatureCommon=!1}break}}parseVoices(e,t,s,r,n){let a=0;for(let o of n.childNodes)if(o.nodeType===O.Element)switch(o.localName){case"voice":this.parseVoice(e,t,s,a,r,o),a++;break}}getOrCreateBar(e,t){return t<e.bars.length?e.bars[t]:this.addNewBar(e)}addNewBar(e){let t=new Sn;if(e.bars.length>0?(t.clef=e.bars[e.bars.length-1].clef,t.clefOttava=e.bars[e.bars.length-1].clefOttava):t.clef=this._currentStaffLayout.defaultClef,e.addBar(t),e.bars.length>this.score.masterBars.length){let s=new gn;this.score.addMasterBar(s),s.index>0&&(s.keySignature=s.previousMasterBar.keySignature,s.keySignatureType=s.previousMasterBar.keySignatureType,s.tripletFeel=s.previousMasterBar.tripletFeel),s.timeSignatureDenominator=this._timeSignature.timeSignatureDenominator,s.timeSignatureNumerator=this._timeSignature.timeSignatureNumerator,s.timeSignatureCommon=this._timeSignature.timeSignatureCommon}return t}newBar(e,t){this._currentVoiceState.currentBarIndex++,this._currentBar=this.getOrCreateBar(e,this._currentVoiceState.currentBarIndex),this._currentVoiceState.currentBarDuration=this._currentBar.masterBar.calculateDuration(!1),this._currentVoiceState.currentBarComplete=!1,this._currentVoiceState.currentPosition=0,this.ensureVoice(e,t)}parseVoice(e,t,s,r,n,a){const o=e+"_"+r;if(this._currentVoiceState&&!this._currentVoiceState.currentBarComplete&&(this._currentBar.masterBar.isAnacrusis=!0),this._voiceStates.has(o)?(this._currentVoiceState=this._voiceStates.get(o),this._currentBar=this.getOrCreateBar(t,this._currentVoiceState.currentBarIndex),this.ensureVoice(t,r)):(this._currentVoiceState=new eF,this._currentVoiceState.currentBarIndex=n-1,this._voiceStates.set(o,this._currentVoiceState),this.newBar(t,r)),a.attributes.has("stemDir"))switch(a.attributes.get("stemDir")){case"up":this._currentVoiceState.voiceStemDir=R.Up;break;case"down":this._currentVoiceState.voiceStemDir=R.Down;break;default:this._currentVoiceState.voiceStemDir=null;break}else this._currentVoiceState.voiceStemDir=null;const l=a.findChildElement("noteObjects");if(s.attributes.has("tempo")){const u=new vi;u.isLinear=!0,u.type=jt.Tempo,u.value=parseInt(s.attributes.get("tempo")),u.ratioPosition=this._currentVoiceState.currentPosition/this._currentVoiceState.currentBarDuration,this._currentBar.masterBar.tempoAutomations.push(u)}if(l){for(let u of l.childNodes)if(u.nodeType===O.Element)switch(this._currentVoiceState.currentBarComplete&&u.localName!=="barline"&&this.newBar(t,r),u.localName){case"clefSign":this._currentBar.clef=this.parseClef(u.getAttribute("clef")),this._currentBar.clefOttava=this.parseClefOttava(u.getAttribute("clef"));break;case"keySign":this._currentBar.masterBar.keySignature=parseInt(u.getAttribute("fifths"));break;case"timeSign":this.parseTime(u.getAttribute("time")),this._currentBar.masterBar.timeSignatureDenominator=this._timeSignature.timeSignatureDenominator,this._currentBar.masterBar.timeSignatureNumerator=this._timeSignature.timeSignatureNumerator,this._currentBar.masterBar.timeSignatureCommon=this._timeSignature.timeSignatureCommon,this._currentVoiceState.currentPosition=0,this._currentVoiceState.currentBarDuration=this._currentBar.masterBar.calculateDuration(!1);break;case"barline":switch(u.getAttribute("type")){case"double":this._currentBar.masterBar.isDoubleBar=!0,this._currentVoiceState.currentBarComplete||(this._currentBar.masterBar.isAnacrusis=!0),this._currentVoiceState.currentBarComplete=!0;break;case"end":this._currentVoiceState.currentBarComplete||(this._currentBar.masterBar.isAnacrusis=!0);break;case"repEnd":this._currentVoiceState.repeatEnd=this._currentBar.masterBar,this._currentBar.masterBar.repeatCount<this._currentVoiceState.repeatCount&&(this._currentBar.masterBar.repeatCount=this._currentVoiceState.repeatCount),this.parseBarDrawObject(u),this._currentVoiceState.currentBarComplete||(this._currentBar.masterBar.isAnacrusis=!0),this._currentVoiceState.currentBarComplete=!0;break;case"repBegin":this.newBar(t,r),this._currentBar.masterBar.isRepeatStart=!0,this._currentVoiceState.repeatEnd=null,this._currentVoiceState.repeatCount=0;break;case"repEndBegin":this._currentVoiceState.repeatEnd=this._currentBar.masterBar,this._currentBar.masterBar.repeatCount<this._currentVoiceState.repeatCount&&(this._currentBar.masterBar.repeatCount=this._currentVoiceState.repeatCount),this.parseBarDrawObject(u),this.newBar(t,r),this._currentBar.masterBar.isRepeatStart=!0;break;case"dashed":this._currentVoiceState.currentBarComplete||(this._currentBar.masterBar.isAnacrusis=!0),this._currentVoiceState.currentBarComplete=!0;break;default:this._currentVoiceState.currentBarComplete||(this._currentBar.masterBar.isAnacrusis=!0),this._currentVoiceState.currentBarComplete=!0;break}break;case"chord":let h=new xi;this.initFromPreviousBeat(h,this._currentVoice),h.beamingMode=this._beamingMode,this._currentVoiceState.voiceStemDir&&(h.preferredBeamDirection=this._currentVoiceState.voiceStemDir),this.parseDuration(this._currentBar,h,u.findChildElement("duration")),h.updateDurations(),this._currentVoiceState.currentPosition+=h.playbackDuration,this._currentVoice.addBeat(h),this.parseChord(h,u),this._currentVoiceState.currentPosition>=this._currentVoiceState.currentBarDuration&&(this._currentVoiceState.currentBarComplete=!0);break;case"rest":const c=this.parseRestDurations(this._currentBar,u.findChildElement("duration"));c&&(this.initFromPreviousBeat(c,this._currentVoice),c.updateDurations(),this._currentVoiceState.currentPosition+=c.playbackDuration,this._currentVoice.addBeat(c),this._currentVoiceState.currentPosition>=this._currentVoiceState.currentBarDuration&&(this._currentVoiceState.currentBarComplete=!0));break}}}initFromPreviousBeat(e,t){let s=this.getLastBeat(t);s&&(e.dynamics=s.dynamics)}getLastBeat(e){if(e.beats.length>0)return e.beats[e.beats.length-1];if(e.bar.index>0){const t=e.bar.staff.bars[e.bar.index-1];if(e.index<t.voices.length){const s=t.voices[e.index];return this.getLastBeat(s)}}return null}ensureVoice(e,t){for(;this._currentBar.voices.length<t+1;)this._currentBar.addVoice(new Wr);(!this._voiceCounts.has(e.track.index)||this._voiceCounts.get(e.track.index)<this._currentBar.voices.length)&&this._voiceCounts.set(e.track.index,this._currentBar.voices.length),this._currentVoice=this._currentBar.voices[t]}parseChord(e,t){const s=new Ss;for(let r of t.childNodes)if(r.nodeType===O.Element)switch(r.localName){case"stem":switch(r.getAttribute("dir")){case"up":e.preferredBeamDirection=R.Up;break;case"down":e.preferredBeamDirection=R.Down;break}break;case"articulation":switch(r.getAttribute("type")){case"staccato":s.isStaccato=!0;break;case"normalAccent":s.accentuated=_t.Normal;break;case"strongAccent":s.accentuated=_t.Heavy;break}break;case"lyric":this.parseLyric(e,r);break;case"drawObjects":this.parseBeatDrawObject(e,r);break;case"heads":this.parseHeads(e,s,r);break;case"beam":switch(r.getAttribute("group")){case"force":e.beamingMode=cr.ForceMergeWithNext;break;case"divide":e.beamingMode=cr.ForceSplitToNext;break}break}}parseHeads(e,t,s){for(let r of s.childNodes)if(r.nodeType===O.Element)switch(r.localName){case"head":this.parseHead(e,t,r);break}}parseHead(e,t,s){const r=new Ss,n=et.parseTuning(s.getAttribute("pitch"));r.octave=n.octave-1,r.tone=n.noteValue,r.isStaccato=t.isStaccato,r.accentuated=t.accentuated,e.addNote(r);for(let a of s.childNodes)if(a.nodeType===O.Element)switch(a.localName){case"alter":a.attributes.has("step")&&(r.tone+=parseInt(a.attributes.get("step")));break;case"tie":a.attributes.has("begin")?this._tieStartIds.has(r.id)||(this._tieStartIds.set(r.id,!0),this._tieStarts.push(r)):a.attributes.has("end")&&this._tieStarts.length>0&&!r.isTieDestination&&(r.isTieDestination=!0,r.tieOrigin=this._tieStarts[0],this._tieStarts.splice(0,1),this._tieStartIds.delete(r.id));break}}parseBeatDrawObject(e,t){for(let s of t.childNodes)if(s.nodeType===O.Element)switch(s.localName){case"drawObj":const r=this.parseDrawObj(s);if(r){if(r instanceof Zf)r.fontFace.startsWith("capella")?r.text==="u"?(e.fermata=new A0,e.fermata.type=yr.Medium):r.text==="f"?e.dynamics=Me.F:r.text==="j"&&(e.dynamics=Me.MF):this._isFirstSystem&&this.score.title===""&&r.align===de.Center&&r.height>16&&r.weight>400?this.score.title=r.text:this._isFirstSystem&&this.score.artist===""&&r.align===de.Center&&r.y<0?this.score.artist=r.text:this._isFirstSystem&&this.score.music===""&&r.align===de.Right&&r.y<0?this.score.music=r.text:r.text.startsWith("by capella")||(e.text=r.text);else if(!(r instanceof wS))if(r instanceof kS)e.vibrato=Ge.Slight;else if(r instanceof xS)e.crescendo=r.decrescendo?ss.Decrescendo:ss.Crescendo,r.noteRange++,this._crescendo.set(e,r);else if(r instanceof vS){const n=r;this._slurs.set(e,n)}else r instanceof ep&&this.applyVolta(r)}break}}parseBarDrawObject(e){for(let t of e.childNodes)if(t.nodeType===O.Element)switch(t.localName){case"drawObj":const s=this.parseDrawObj(t);s&&s instanceof ep&&this.applyVolta(s);break}}applyVolta(e){if(e.lastNumber>0?(this._currentVoiceState.repeatCount=e.lastNumber,this._currentVoiceState.repeatEnd&&this._currentVoiceState.repeatEnd.repeatCount<this._currentVoiceState.repeatCount&&(this._currentVoiceState.repeatEnd.repeatCount=this._currentVoiceState.repeatCount)):e.firstNumber>0&&(this._currentVoiceState.repeatCount=e.firstNumber,this._currentVoiceState.repeatEnd&&this._currentVoiceState.repeatEnd.repeatCount<this._currentVoiceState.repeatCount&&(this._currentVoiceState.repeatEnd.repeatCount=this._currentVoiceState.repeatCount)),e.lastNumber>0&&e.firstNumber>0){let t=0;for(let s=e.firstNumber;s<=e.lastNumber;s++)t=t|1<<s-1;this._currentBar.masterBar.alternateEndings=t}else e.lastNumber>0?this._currentBar.masterBar.alternateEndings=1<<e.lastNumber-1:e.firstNumber>0&&(this._currentBar.masterBar.alternateEndings=1<<e.firstNumber-1)}parseLyric(e,t){for(let s of t.childNodes)if(s.nodeType===O.Element)switch(s.localName){case"verse":e.lyrics||(e.lyrics=[]);let r=s.innerText;s.getAttribute("hyphen")==="true"&&(r+="-"),e.lyrics.push(r);break}}parseRestDurations(e,t){const s=t.getAttribute("base");if(s.indexOf("/")!==-1){let n=new xi;return n.beamingMode=this._beamingMode,this.parseDuration(e,n,t),n}if(parseInt(s)===1){let n=new xi;return n.beamingMode=this._beamingMode,n.duration=N.Whole,n}else return I.warning("Importer","Multi-Bar rests are not supported"),null}parseDurationValue(e){switch(e){case"2/1":return N.DoubleWhole;case"1/1":return N.Whole;case"1/2":return N.Half;case"1/4":return N.Quarter;case"1/8":return N.Eighth;case"1/16":return N.Sixteenth;case"1/32":return N.ThirtySecond;case"1/64":return N.SixtyFourth;case"1/128":return N.OneHundredTwentyEighth;default:return I.warning("Importer","Unsupported duration"),N.Quarter}}parseDuration(e,t,s){const r=s.getAttribute("base");t.duration=this.parseDurationValue(r),s.attributes.has("dots")&&(t.dots=parseInt(s.attributes.get("dots")));const n=s.findChildElement("tuplet");if(n){t.tupletNumerator=parseInt(n.getAttribute("count"));const a=n.getAttribute("tripartite")==="true"?3:1,o=n.getAttribute("prolong")==="true"?0:1;let l=0;for(;a*Math.pow(2,l+o)<t.tupletNumerator;)l++;t.tupletDenominator=a*Math.pow(2,l)}}parsePageObjects(e){for(let t of e.childNodes)if(t.nodeType===O.Element)switch(t.localName){case"drawObj":const s=this.parseDrawObj(t);if(s&&s instanceof Zf)switch(s.align){case de.Center:this.score.title?this.score.subTitle||(this.score.subTitle=t.innerText):this.score.title=t.innerText;break;case de.Right:this.score.artist||(this.score.artist=t.innerText);break}break}}parseGallery(e){for(let t of e.childNodes)if(t.nodeType===O.Element)switch(t.localName){case"drawObj":const s=this.parseDrawObj(t);s&&this._galleryObjects.set(t.getAttribute("name"),s);break}}parseDrawObj(e){let t=null,s=1;for(let r of e.childNodes)if(r.nodeType===O.Element)switch(r.localName){case"text":t=this.parseText(r);break;case"guitar":t=this.parseGuitar(r);break;case"slur":t=this.parseSlur(r);break;case"wavyLine":t=this.parseWavyLine(r);break;case"bracket":t=this.parseTupletBracket(r);break;case"wedge":t=this.parseWedge(r);break;case"volta":t=this.parseVolta(r);break;case"octaveClef":t=this.parseOctaveClef(r);break;case"trill":t=this.parseTrill(r);break;case"basic":r.attributes.has("noteRange")&&(s=parseInt(r.attributes.get("noteRange")));break}return t&&(t.noteRange=s),t}parseTrill(e){return new q4}parseOctaveClef(e){const t=new J4;return e.attributes.has("octave")&&(t.octave=parseInt(e.attributes.get("octave"))),t}parseVolta(e){const t=new ep;return t.allNumbers=e.attributes.get("allNumbers")==="true",e.attributes.has("firstNumber")&&(t.firstNumber=parseInt(e.attributes.get("firstNumber"))),e.attributes.has("lastNumber")&&(t.lastNumber=parseInt(e.attributes.get("lastNumber"))),t}parseWedge(e){const t=new xS;return t.decrescendo=e.attributes.get("decrescendo")==="true",t}parseTupletBracket(e){const t=new Q4;return e.attributes.has("number")&&(t.number=parseInt(e.attributes.get("number"))),t}parseWavyLine(e){return new kS}parseSlur(e){return new vS}parseGuitar(e){const t=new wS,s=e.innerText.trim();for(let r=0;r<s.length;r++)s.charAt(r)==="/"?t.chord.strings.push(0):t.chord.strings.push(parseInt(s.charAt(r)));return t}parseText(e){const t=new Zf;switch(e.attributes.has("x")&&(t.x=parseFloat(e.attributes.get("x"))),e.attributes.has("x")&&(t.y=parseFloat(e.attributes.get("y"))),e.getAttribute("align")){case"left":t.align=de.Left;break;case"center":t.align=de.Center;break;case"right":t.align=de.Right;break}switch(e.getAttribute("frame")){case"rectangle":t.frame=fa.Rectangle;break;case"ellipse":t.frame=fa.Ellipse;break;case"circle":t.frame=fa.Circle;break;case"none":t.frame=fa.None;break}if(e.firstElement){for(let s of e.childNodes)if(s.nodeType===O.Element)switch(s.localName){case"font":t.fontFace=s.getAttribute("face"),s.attributes.has("weight")&&(t.weight=parseInt(s.attributes.get("weight"))),s.attributes.has("height")&&(t.height=parseInt(s.attributes.get("height")));break;case"content":t.text=s.innerText;break}}else t.text=e.innerText;return t}parseInfo(e){for(let t of e.childNodes)if(t.nodeType===O.Element)switch(t.localName){case"author":this.score.tab=t.firstChild.innerText;break;case"comment":this.score.notices=t.firstChild.innerText;break}}}class tF extends Qo{get name(){return"Capella"}constructor(){super()}readScore(){I.debug(this.name,"Loading ZIP entries");let e=new O0(this.data),t,s=null;if(t=e.read(),I.debug(this.name,"Zip entries loaded"),t.length>0)for(let r of t)switch(r.fileName){case"score.xml":s=L.toString(r.data,this.settings.importer.encoding);break}else this.data.reset(),s=L.toString(this.data.readAll(),this.settings.importer.encoding);if(!s)throw new yt("No valid capella file");I.debug(this.name,"Start Parsing score.xml");try{let r=new Vc;return r.parseXml(s,this.settings),I.debug(this.name,"score.xml parsed"),r.score}catch(r){throw new yt("Failed to parse CapXML",r)}}}class iF{constructor(e){this._targets=new Set,this._callback=e,window.addEventListener("resize",this.onWindowResize.bind(this),!1)}observe(e){this._targets.add(e)}unobserve(e){this._targets.delete(e)}disconnect(){this._targets.clear()}onWindowResize(){const e=[];for(const t of this._targets)e.push({target:t,contentRect:void 0,borderBoxSize:void 0,contentBoxSize:[],devicePixelContentBoxSize:[]});this._callback(e,this)}}class sF{constructor(e){this._elements=[];let t=null;const s=this._check.bind(this);this._check=()=>{t||(t=setTimeout(()=>{s(),t=null},100))},this._callback=e,window.addEventListener("resize",this._check,!0),document.addEventListener("scroll",this._check,!0)}observe(e){this._elements.indexOf(e)>=0||(this._elements.push(e),this._check())}unobserve(e){this._elements=this._elements.filter(t=>t!=e)}_check(){const e=[];this._elements.forEach(t=>{const s=t.getBoundingClientRect();s.top+s.height>=0&&s.top<=window.innerHeight&&s.left+s.width>=0&&s.left<=window.innerWidth&&e.push({target:t,isIntersecting:!0})}),e.length&&this._callback(e,this)}}function _S(i,e,t){if(e!=null){if(typeof e!="object"&&typeof e!="function")throw new TypeError("Object expected.");var s,r;if(s===void 0){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");s=e[Symbol.dispose]}if(typeof s!="function")throw new TypeError("Object not disposable.");r&&(s=function(){try{r.call(this)}catch(n){return Promise.reject(n)}}),i.stack.push({value:e,dispose:s,async:t})}return e}var rF=typeof SuppressedError=="function"?SuppressedError:function(i,e,t){var s=new Error(t);return s.name="SuppressedError",s.error=i,s.suppressed=e,s};function TS(i){function e(n){i.error=i.hasError?new rF(n,i.error,"An error was suppressed during disposal."):n,i.hasError=!0}var t,s=0;function r(){for(;t=i.stack.pop();)try{if(!t.async&&s===1)return s=0,i.stack.push(t),Promise.resolve().then(r);if(t.dispose){var n=t.dispose.call(t.value);if(t.async)return s|=2,Promise.resolve(n).then(r,function(a){return e(a),r()})}else s|=1}catch(a){e(a)}if(s===1)return i.hasError?Promise.reject(i.error):Promise.resolve();if(i.hasError)throw i.error}return r()}class lt{static enable(e,t){lt.alphaSkia=t,lt.initializeMusicFont(lt.alphaSkia.AlphaSkiaTypeface.register(e))}static initializeMusicFont(e){lt.musicFont=e}static registerFont(e,t){const s=lt.alphaSkia.AlphaSkiaTypeface.register(e.buffer);t||(t=Be.withFamilyList([s.familyName],12,s.isItalic?gt.Italic:gt.Plain,s.isBold?hs.Bold:hs.Regular));for(const r of t.families)this.customTypeFaces.set(lt.customTypefaceKey(r,t.isBold,t.isItalic),s);return t}static customTypefaceKey(e,t,s){return e.toLowerCase()+"_"+t+"_"+s}getTypeFace(){if(this._typeFaceCache!=this.font.toCssString(this.settings.display.scale)){if(this._typeFaceIsSystem){const t={stack:[],error:void 0,hasError:!1};try{const s=_S(t,this._typeFace,!1)}catch(s){t.error=s,t.hasError=!0}finally{TS(t)}}for(const t of this.font.families){var e=lt.customTypefaceKey(t,this.font.isBold,this.font.isItalic);lt.customTypeFaces.has(e)?(this._typeFaceIsSystem=!1,this._typeFace=lt.customTypeFaces.get(e)):(this._typeFaceIsSystem=!0,this._typeFace=lt.alphaSkia.AlphaSkiaTypeface.create(t,this.font.isBold,this.font.isItalic))}this._typeFaceCache=this.font.toCssString(this.settings.display.scale)}return this._typeFace}constructor(){this._color=new Je(0,0,0,0),this._lineWidth=0,this._typeFaceCache="",this._typeFaceIsSystem=!1,this._typeFace=null,this.font=new Be("Arial",10,gt.Plain),this.textAlign=de.Left,this.textBaseline=we.Top,this._canvas=new lt.alphaSkia.AlphaSkiaCanvas,this.color=new Je(0,0,0,255)}destroy(){const e={stack:[],error:void 0,hasError:!1};try{const t=_S(e,this._canvas,!1)}catch(t){e.error=t,e.hasError=!0}finally{TS(e)}}onRenderFinished(){return null}beginRender(e,t){this._canvas.beginRender(e,t,D.HighDpiFactor)}endRender(){return this._canvas.endRender()}get color(){return this._color}set color(e){this._color.rgba!==e.rgba&&(this._color=e,this._canvas.color=lt.alphaSkia.AlphaSkiaCanvas.rgbaToColor(e.r,e.g,e.b,e.a))}get lineWidth(){return this._lineWidth}set lineWidth(e){this._lineWidth=e,this._canvas.lineWidth=e}fillRect(e,t,s,r){s>0&&this._canvas.fillRect(e|0,t|0,s,r)}strokeRect(e,t,s,r){this._canvas.strokeRect(e|0,t|0,s,r)}beginPath(){this._canvas.beginPath()}closePath(){this._canvas.closePath()}moveTo(e,t){this._canvas.moveTo(e,t)}lineTo(e,t){this._canvas.lineTo(e,t)}quadraticCurveTo(e,t,s,r){this._canvas.quadraticCurveTo(e,t,s,r)}bezierCurveTo(e,t,s,r,n,a){this._canvas.bezierCurveTo(e,t,s,r,n,a)}fillCircle(e,t,s){this._canvas.fillCircle(e,t,s)}strokeCircle(e,t,s){this._canvas.strokeCircle(e,t,s)}fill(){this._canvas.fill()}stroke(){this._canvas.stroke()}beginGroup(e){}endGroup(){}fillText(e,t,s){if(e.length==0)return;let r=lt.alphaSkia.AlphaSkiaTextAlign.Left;switch(this.textAlign){case de.Left:r=lt.alphaSkia.AlphaSkiaTextAlign.Left;break;case de.Center:r=lt.alphaSkia.AlphaSkiaTextAlign.Center;break;case de.Right:r=lt.alphaSkia.AlphaSkiaTextAlign.Right;break}let n=lt.alphaSkia.AlphaSkiaTextBaseline.Top;switch(this.textBaseline){case we.Top:n=lt.alphaSkia.AlphaSkiaTextBaseline.Top;break;case we.Middle:n=lt.alphaSkia.AlphaSkiaTextBaseline.Middle;break;case we.Bottom:n=lt.alphaSkia.AlphaSkiaTextBaseline.Bottom;break}this._canvas.fillText(e,this.getTypeFace(),this.font.size*this.settings.display.scale,t,s,r,n)}measureText(e){return new Rd(this._canvas.measureText(e,this.getTypeFace(),this.font.size*this.settings.display.scale),this.font.size*lt.FontSizeToLineHeight)}fillMusicFontSymbol(e,t,s,r,n){r!==S.None&&this.fillMusicFontSymbolText(e,t,s,String.fromCharCode(r),n)}fillMusicFontSymbols(e,t,s,r,n){let a="";for(let o of r)o!==S.None&&(a+=String.fromCharCode(o));this.fillMusicFontSymbolText(e,t,s,a,n)}fillMusicFontSymbolText(e,t,s,r,n){this._canvas.fillText(r,lt.musicFont,D.MusicFontSize*this.settings.display.scale*s,e,t,n?lt.alphaSkia.AlphaSkiaTextAlign.Center:lt.alphaSkia.AlphaSkiaTextAlign.Left,lt.alphaSkia.AlphaSkiaTextBaseline.Alphabetic)}beginRotate(e,t,s){this._canvas.beginRotate(e,t,s)}endRotate(){this._canvas.endRotate()}}lt.musicFont=null;lt.customTypeFaces=new Map;lt.FontSizeToLineHeight=1.2;class NS extends Gt{constructor(e,t,s=!1){super(e.beat,t.beat,s),this.startNote=e,this.endNote=t}getTieHeight(e,t,s,r){return this.startNote===this.endNote?15:super.getTieHeight(e,t,s,r)}getBeamDirection(e,t){return R.Down}static getBeamDirectionForNote(e){return R.Down}getStartY(){return this.startNoteRenderer.getNoteY(this.startNote,q.Center)}getEndY(){return this.getStartY()}getStartX(){return this.startNote===this.endNote?this.getEndX()-20*this.scale:this.startNoteRenderer.getNoteX(this.startNote,Ze.Right)}getEndX(){return this.endNoteRenderer.getNoteX(this.endNote,Ze.Left)}}class nF extends Cs{constructor(e,t){super(e,t),this._tiedNoteTie=null}createTies(e){if(e.isVisible){if(!this._tiedNoteTie&&e.isTieOrigin&&e.tieDestination.isVisible){let t=new NS(e,e.tieDestination,!1);this._tiedNoteTie=t,this.addTie(t)}if(!this._tiedNoteTie&&e.isTieDestination){let t=new NS(e.tieOrigin,e,!0);this._tiedNoteTie=t,this.addTie(t)}}}}class aF extends Ea{constructor(e,t,s){super(e,t,s)}updateBeamingHelper(e){this.beamingHelper&&this.beamingHelper.registerBeatLineX("slash",this.beat,e+this.x+this.width/2,e+this.x+this.width/2)}}class oF extends za{constructor(){super(...arguments),this.noteHeads=null,this.restGlyph=null}getNoteX(e,t){if(this.noteHeads){let s=this.noteHeads.x;switch(t){case Ze.Left:break;case Ze.Center:s+=this.noteHeads.width/2;break;case Ze.Right:s+=this.noteHeads.width;break}return s}return 0}buildBoundingsLookup(e,t,s){if(this.noteHeads&&this.container.beat.notes.length>0){const r=new Ru;r.note=this.container.beat.notes[0],r.noteHeadBounds=new Wi,r.noteHeadBounds.x=t+this.x+this.noteHeads.x,r.noteHeadBounds.y=s+this.y+this.noteHeads.y-this.noteHeads.height/2,r.noteHeadBounds.w=this.width,r.noteHeadBounds.h=this.height,e.addNote(r)}}getNoteY(e,t){if(this.noteHeads){let s=this.y+this.noteHeads.y;switch(t){case q.Top:case q.TopWithStem:s-=this.noteHeads.height/2+2*this.scale;break;case q.Center:break;case q.Bottom:case q.BottomWithStem:s+=this.noteHeads.height/2;break}return s}return 0}updateBeamingHelper(){this.noteHeads?this.noteHeads.updateBeamingHelper(this.container.x+this.x):this.restGlyph&&this.restGlyph.updateBeamingHelper(this.container.x+this.x)}doLayout(){let e=this.renderer;const t=e.getNoteLine(),s=e.getLineY(t);if(!this.container.beat.isEmpty)if(this.container.beat.isRest){const r=new aF(0,s,this.container.beat.duration);this.restGlyph=r,r.beat=this.container.beat,r.beamingHelper=this.beamingHelper,this.addGlyph(r),this.beamingHelper&&this.beamingHelper.applyRest(this.container.beat,0)}else{const r=this.container.beat.graceType!==he.None,n=new ci(0,s,this.container.beat.duration,r);this.noteHeads=n,n.beat=this.container.beat,n.beamingHelper=this.beamingHelper,this.addGlyph(n)}if(this.container.beat.dots>0){this.addGlyph(new ei(0,0,5*this.scale));for(let r=0;r<this.container.beat.dots;r++)this.addGlyph(new ku(0,e.getLineY(e.getNoteLine())-e.getLineHeight(.5),1.5*this.scale))}super.doLayout(),this.container.beat.isEmpty?this.centerX=this.width/2:this.container.beat.isRest?this.centerX=this.restGlyph.x+this.restGlyph.width/2:this.centerX=this.noteHeads.x+this.noteHeads.width/2}}class Hc extends qn{constructor(e,t){super(e,t),this.simpleWhammyOverflow=0,this._isOnlySlash=!t.staff.showTablature&&!t.staff.showStandardNotation,this.helpers.preferredBeamDirection=R.Up}get lineSpacing(){return pt.RawLineSpacing}get heightLineCount(){return 5}get drawnLineCount(){return 1}get bottomGlyphOverflow(){return 0}paint(e,t,s){super.paint(e,t,s),this.paintBeams(e,t,s),this.paintTuplets(e,t,s)}doLayout(){super.doLayout();let e=!1;for(let t of this.bar.voices)if(this.hasVoiceContainer(t)&&this.getVoiceContainer(t).tupletGroups.length>0){e=!0;break}e&&this.registerOverflowTop(this.tupletSize)}getNoteLine(){return 0}getFlagTopY(e,t){return this.getLineY(0)-ci.NoteHeadHeight/2*this.scale}getFlagBottomY(e,t){return this.getLineY(0)-ci.NoteHeadHeight/2*this.scale}getBeamDirection(e){return R.Up}getNoteY(e,t){let s=super.getNoteY(e,t);return isNaN(s)&&(s=this.getLineY(0)),s}calculateBeamYWithDirection(e,t,s){return this.getLineY(0)-this.getFlagStemSize(e.shortestDuration)}getBarLineStart(e,t){return this.getLineY(0)-ci.NoteHeadHeight/2*this.scale}createLinePreBeatGlyphs(){this._isOnlySlash&&(!this.bar.previousBar||this.bar.previousBar&&this.bar.masterBar.timeSignatureNumerator!==this.bar.previousBar.masterBar.timeSignatureNumerator||this.bar.previousBar&&this.bar.masterBar.timeSignatureDenominator!==this.bar.previousBar.masterBar.timeSignatureDenominator||this.bar.previousBar&&this.bar.masterBar.isFreeTime&&this.bar.masterBar.isFreeTime!==this.bar.previousBar.masterBar.isFreeTime)&&(this.createStartSpacing(),this.createTimeSignatureGlyphs())}createTimeSignatureGlyphs(){this.addPreBeatGlyph(new ei(0,0,5*this.scale));const e=this.bar.masterBar;this.addPreBeatGlyph(new K0(0,this.getLineY(0),e.timeSignatureNumerator,e.timeSignatureDenominator,e.timeSignatureCommon,e.isFreeTime&&(e.previousMasterBar==null||e.isFreeTime!==e.previousMasterBar.isFreeTime)))}createVoiceGlyphs(e){for(const t of e.beats){let s=new nF(t,this.getVoiceContainer(e));s.preNotes=new Ha,s.onNotes=e.index==0?new oF:new za,this.addBeatGlyph(s)}}paintBeamingStem(e,t,s,r,n,a){a.lineWidth=pt.StemWidth*this.scale,a.beginPath(),a.moveTo(s,r),a.lineTo(s,n),a.stroke(),a.lineWidth=this.scale}}Hc.StaffId="slash";class lF extends Fu{get staffId(){return Hc.StaffId}getStaffPaddingTop(e){return e.system.layout.renderer.settings.display.notationStaffPaddingTop}getStaffPaddingBottom(e){return e.system.layout.renderer.settings.display.notationStaffPaddingBottom}create(e,t){return new Hc(e,t)}canCreate(e,t){return super.canCreate(e,t)&&t.showSlash}constructor(){super()}}class tp extends Gt{constructor(e,t,s=!1){super(e?e.beat:null,t?t.beat:null,s),this.startNote=e,this.endNote=t}shouldDrawBendSlur(){return this.renderer.settings.notation.extendBendArrowsOnTiedNotes&&!!this.startNote.bendOrigin&&this.startNote.isTieOrigin}doLayout(){super.doLayout()}getBeamDirection(e,t){return R.Up}getStartY(){return this.startNoteRenderer.getNoteY(this.startNote,q.Top)}getEndY(){return this.getStartY()}getStartX(){return this.startNote===this.endNote?this.getEndX()-20*this.scale:this.startNoteRenderer.getNoteX(this.startNote,Ze.Center)}getEndX(){return this.startNote===this.endNote?this.endNoteRenderer.getNoteX(this.endNote,Ze.Left):this.endNoteRenderer.getNoteX(this.endNote,Ze.Center)}}class BS extends nn{constructor(e,t,s,r=!1){super(e,t,r),this._direction=R.Up,this._forSlide=s}getTieHeight(e,t,s,r){return Math.log(s-e+1)*this.renderer.settings.notation.slurHeight}tryExpand(e,t,s,r){if(this._forSlide!==s||this.forEnd!==r||this.startNote.beat.id!==e.beat.id||this.endNote.beat.id!==t.beat.id)return!1;switch(this._direction){case R.Up:e.realValue>this.startNote.realValue&&(this.startNote=e,this.startBeat=e.beat),t.realValue>this.endNote.realValue&&(this.endNote=t,this.endBeat=t.beat);break;case R.Down:e.realValue<this.startNote.realValue&&(this.startNote=e,this.startBeat=e.beat),t.realValue<this.endNote.realValue&&(this.endNote=t,this.endBeat=t.beat);break}return!0}paint(e,t,s){let r=this.renderer.scoreRenderer.layout.getRendererForBar(this.renderer.staff.staveId,this.startBeat.voice.bar),n=this.getBeamDirection(this.startBeat,r),a="numbered.slur."+this.startNote.beat.id+"."+this.endNote.beat.id+"."+n,o=this.renderer;o.staff.getSharedLayoutData(a,!1)||(o.staff.setSharedLayoutData(a,!0),super.paint(e,t,s))}}class uF extends Cs{constructor(e,t){super(e,t),this._effectSlurs=[]}createTies(e){if(e.isVisible){if(e.isTieOrigin&&e.tieDestination.isVisible){let t=new tp(e,e.tieDestination,!1);this.addTie(t)}if(e.isTieDestination){let t=new tp(e.tieOrigin,e,!0);this.addTie(t)}if(e.isLeftHandTapped&&!e.isHammerPullDestination){let t=new tp(e,e,!1);this.addTie(t)}if(e.isEffectSlurOrigin&&e.effectSlurDestination){let t=!1;for(let s of this._effectSlurs)if(s.tryExpand(e,e.effectSlurDestination,!1,!1)){t=!0;break}if(!t){let s=new BS(e,e.effectSlurDestination,!1,!1);this._effectSlurs.push(s),this.addTie(s)}}if(e.isEffectSlurDestination&&e.effectSlurOrigin){let t=!1;for(let s of this._effectSlurs)if(s.tryExpand(e.effectSlurOrigin,e,!1,!0)){t=!0;break}if(!t){let s=new BS(e.effectSlurOrigin,e,!1,!0);this._effectSlurs.push(s),this.addTie(s)}}}}}class Go extends vt{constructor(e,t,s,r){super(e,t),this._isGrace=r,this._number=s}paint(e,t,s){const r=this.renderer.resources;s.font=this._isGrace?r.numberedNotationGraceFont:r.numberedNotationFont,s.textBaseline=we.Middle,s.textAlign=de.Left,s.fillText(this._number.toString(),e+this.x,t+this.y)}doLayout(){const e=(this._isGrace?Se.GraceScale:1)*this.scale;this.width=Go.NoteHeadWidth*e,this.height=Go.NoteHeadHeight*e}}Go.NoteHeadHeight=17;Go.NoteHeadWidth=12;class _u extends vt{doLayout(){this.width=(14+_u.Padding)*this.scale,this.height=yi.BarSize*this.scale}paint(e,t,s){const r=_u.Padding*this.scale;s.fillRect(e+this.x,t+this.y,this.width-r,this.height)}}_u.Padding=3;class hF extends Ha{constructor(){super(...arguments),this.isNaturalizeAccidental=!1,this.accidental=ue.None}doLayout(){if(!this.container.beat.isRest&&!this.container.beat.isEmpty){let e=new Q0;if(e.renderer=this.renderer,this.container.beat.notes.length>0){const t=this.container.beat.notes[0],s=t?t.accidentalMode:At.Default,r=mt.getNoteValue(t);let n=mt.computeAccidental(this.renderer.bar.masterBar.keySignature,s,r,t.hasQuarterToneOffset);if(n==ue.Natural&&(n=this.renderer.bar.masterBar.keySignature+7<7?ue.Sharp:ue.Flat,this.isNaturalizeAccidental=!0),n!==ue.None){this.accidental=n;let a=this.renderer,o=new Hr(0,a.getLineY(0),n,t.beat.graceType!==he.None?Se.GraceScale*Se.GraceScale:Se.GraceScale);o.renderer=this.renderer,e.addGlyph(o),this.addGlyph(e),this.addGlyph(new ei(0,0,4*this.scale))}}}super.doLayout()}}class jo extends za{constructor(){super(...arguments),this.noteHeads=null,this.octaveDots=0}getNoteX(e,t){if(this.noteHeads){let s=this.noteHeads.x;switch(t){case Ze.Left:break;case Ze.Center:s+=this.noteHeads.width/2;break;case Ze.Right:s+=this.noteHeads.width;break}return s}return 0}buildBoundingsLookup(e,t,s){if(this.noteHeads&&this.container.beat.notes.length>0){const r=new Ru;r.note=this.container.beat.notes[0],r.noteHeadBounds=new Wi,r.noteHeadBounds.x=t+this.x+this.noteHeads.x,r.noteHeadBounds.y=s+this.y+this.noteHeads.y-this.noteHeads.height/2,r.noteHeadBounds.w=this.width,r.noteHeadBounds.h=this.height,e.addNote(r)}}getNoteY(e,t){if(this.noteHeads){let s=this.y+this.noteHeads.y;switch(t){case q.Top:case q.TopWithStem:s-=this.noteHeads.height/2+2*this.scale;break;case q.Center:break;case q.Bottom:case q.BottomWithStem:s+=this.noteHeads.height/2;break}return s}return 0}updateBeamingHelper(){this.beamingHelper&&this.noteHeads&&this.beamingHelper.registerBeatLineX("numbered",this.container.beat,this.container.x+this.x+this.noteHeads.x,this.container.x+this.x+this.noteHeads.x+this.noteHeads.width)}doLayout(){let e=this.renderer;e.shortestDuration<this.container.beat.duration&&(e.shortestDuration=this.container.beat.duration);const t=e.getLineY(e.getNoteLine());if(!this.container.beat.isEmpty){let s="0";if(this.container.beat.notes.length>0){const l=this.renderer.bar.masterBar.keySignatureType,u=this.renderer.bar.masterBar.keySignature,h=u+7,d=(l===wr.Minor?jo.MinorKeySignatureOneValues:jo.MajorKeySignatureOneValues)[h],f=this.container.beat.notes[0];if(f.isDead)s="X";else{let p=f.displayValue-d,g=p<0?(p%12+12)%12:p%12,b=p<0?(Math.abs(p)+12)/12|0:p/12|0;p<0&&(b*=-1),this.octaveDots=b,e.registerOctave(b);let y=(et.keySignatureIsSharp(u)||et.keySignatureIsNatural(u)?mt.FlatNoteSteps:mt.SharpNoteSteps)[g]+1;mt.AccidentalNotes[g]&&!this.container.preNotes.isNaturalizeAccidental&&(h<7?y++:y--),s=y.toString()}}const r=this.container.beat.graceType!==he.None,n=new Go(0,t,s,r);if(this.noteHeads=n,this.addGlyph(n),this.container.beat.dots>0&&this.container.beat.duration>=N.Quarter){this.addGlyph(new ei(0,0,5*this.scale));for(let l=0;l<this.container.beat.dots;l++){const u=new ku(0,e.getLineY(0),1.5*this.scale);u.renderer=this.renderer,this.addGlyph(u)}}let a=0;switch(this.container.beat.duration){case N.QuadrupleWhole:a=16;break;case N.DoubleWhole:a=8;break;case N.Whole:a=4;break;case N.Half:a=2;break}let o=a;for(let l=0;l<this.container.beat.dots;l++)o=o/2|0,a+=o;for(let l=0;l<a-1;l++){const u=new _u(0,e.getLineY(0));u.renderer=this.renderer,this.addGlyph(u)}}super.doLayout(),this.container.beat.isEmpty?this.centerX=this.width/2:this.centerX=this.noteHeads.x+this.noteHeads.width/2}}jo.MajorKeySignatureOneValues=[59,66,61,68,63,58,65,60,67,62,69,64,71,66,61];jo.MinorKeySignatureOneValues=[71,66,73,68,63,70,65,72,67,74,69,64,71,66,73];class cF extends vt{constructor(e,t,s,r){super(e,t),this._text="",this._accidental=ue.None,this._accidentalOffset=0,this._keySignature=s,this._keySignatureType=r}doLayout(){super.doLayout();const e="1 = ";let t="",s=ue.None;switch(this._keySignatureType){case wr.Major:switch(this._keySignature){case Le.Cb:t="  C",s=ue.Flat;break;case Le.Gb:t="  G",s=ue.Flat;break;case Le.Db:t="  D",s=ue.Flat;break;case Le.Ab:t="  A",s=ue.Flat;break;case Le.Eb:t="  E",s=ue.Flat;break;case Le.Bb:t="  B",s=ue.Flat;break;case Le.F:t="F";break;case Le.C:t="C",s=ue.None;break;case Le.G:t="G",s=ue.None;break;case Le.D:t="D",s=ue.None;break;case Le.A:t="A",s=ue.None;break;case Le.E:t="E",s=ue.None;break;case Le.B:t="B",s=ue.None;break;case Le.FSharp:t="  F",s=ue.Sharp;break;case Le.CSharp:t="  C",s=ue.Sharp;break}break;case wr.Minor:switch(this._keySignature){case Le.Cb:t="  a",s=ue.Flat;break;case Le.Gb:t="  e",s=ue.Flat;break;case Le.Db:t="  b",s=ue.Flat;break;case Le.Ab:t="f",s=ue.None;break;case Le.Eb:t="c",s=ue.None;break;case Le.Bb:t="g",s=ue.None;break;case Le.F:t="d";break;case Le.C:t="a",s=ue.None;break;case Le.G:t="e",s=ue.None;break;case Le.D:t="b",s=ue.None;break;case Le.A:t="  f",s=ue.Sharp;break;case Le.E:t="  c",s=ue.Sharp;break;case Le.B:t="  g",s=ue.Sharp;break;case Le.FSharp:t="  d",s=ue.Sharp;break;case Le.CSharp:t="  a",s=ue.Sharp;break}break}this._text=e+t,this._accidental=s;const r=this.renderer.scoreRenderer.canvas,n=this.renderer.resources;r.font=n.numberedNotationFont,this._accidentalOffset=r.measureText(e).width,this.width=r.measureText(e+t).width}paint(e,t,s){const r=this.renderer.resources;s.font=r.numberedNotationFont,s.textBaseline=we.Middle,s.fillText(this._text,e+this.x,t+this.y),this._accidental!=ue.None&&s.fillMusicFontSymbol(e+this.x+this._accidentalOffset,t+this.y,.7,Hr.getMusicSymbol(this._accidental),!1)}}class yi extends qn{registerOctave(e){this.lowestOctave===null?(this.lowestOctave=e,this.highestOctave=e):(e<this.lowestOctave&&(this.lowestOctave=e),e>this.highestOctave&&(this.highestOctave=e))}constructor(e,t){super(e,t),this.simpleWhammyOverflow=0,this.shortestDuration=N.QuadrupleWhole,this.lowestOctave=null,this.highestOctave=null,this._isOnlyNumbered=!t.staff.showSlash&&!t.staff.showTablature&&!t.staff.showStandardNotation}get lineSpacing(){return pt.RawLineSpacing}get heightLineCount(){return 5}get drawnLineCount(){return 0}get bottomGlyphOverflow(){return 0}paint(e,t,s){super.paint(e,t,s),this.paintBeams(e,t,s),this.paintTuplets(e,t,s,!0)}doLayout(){super.doLayout();let e=!1;for(let t of this.bar.voices)if(this.hasVoiceContainer(t)&&this.getVoiceContainer(t).tupletGroups.length>0){e=!0;break}if(e&&this.registerOverflowTop(this.tupletSize),!this.bar.isEmpty){let t=et.getIndex(this.shortestDuration)-2;if(t>0){let r=yi.BarSpacing*this.scale,n=yi.BarSize*this.scale,a=(t-1)*r+n,o=0;const l=this.lowestOctave;l!==null&&(o=(Math.abs(l)*yi.DotSpacing+yi.DotSize)*this.scale),this.registerOverflowBottom(a+o)}const s=this.highestOctave;if(s!==null){const r=(Math.abs(s)*yi.DotSpacing+yi.DotSize)*this.scale;this.registerOverflowTop(r)}}}paintFlag(e,t,s,r){this.paintBar(e,t,s,r)}paintBar(e,t,s,r){const n=this.resources;for(let o=0,l=r.beats.length;o<l;o++){let u=r.beats[o],h=yi.BarSpacing*this.scale,c=yi.BarSize*this.scale,d=et.getIndex(u.duration)-2,f=t+this.y,p=this.getBeatX(u,_e.PreNotes)-this.beatGlyphsStart;var a=this.calculateBeamY(r,p);for(let x=0;x<d;x++){let k=0,_=0,T=0,C=f+x*h;o===r.beats.length-1?(k=p,_=this.getBeatX(u,_e.PostNotes)-this.beatGlyphsStart):(k=p,_=this.getBeatX(r.beats[o+1],_e.PreNotes)-this.beatGlyphsStart),T=C+a|0,qn.paintSingleBar(s,e+this.x+k,T,e+this.x+_,T,c)}let b=this.getBeatContainer(u).onNotes.octaveDots,m=0,y=0;b>0?(m=f+this.getLineY(0)-n.numberedNotationFont.size/1.5,y=yi.DotSpacing*-1*this.scale):b<0&&(m=f+a+d*h,y=yi.DotSpacing*this.scale);let w=this.getBeatX(u,_e.OnNotes)+4*this.scale-this.beatGlyphsStart;b=Math.abs(b);for(let x=0;x<b;x++)s.fillCircle(e+this.x+w,m,yi.DotSize*this.scale),m+=y}}getNoteLine(){return 0}get tupletOffset(){return super.tupletOffset+this.resources.numberedNotationFont.size*this.scale}getFlagTopY(e,t){return this.getLineY(0)-ci.NoteHeadHeight/2*this.scale}getFlagBottomY(e,t){return this.getLineY(0)-ci.NoteHeadHeight/2*this.scale}getBeamDirection(e){return R.Down}getTupletBeamDirection(e){return R.Up}getNoteY(e,t){let s=super.getNoteY(e,t);return isNaN(s)&&(s=this.getLineY(0)),s}calculateBeamYWithDirection(e,t,s){const r=this.resources.numberedNotationFont;return this.getLineY(0)+r.size*this.scale}getBarLineStart(e,t){return this.getLineY(0)-ci.NoteHeadHeight/2*this.scale}createLinePreBeatGlyphs(){(!this.bar.previousBar||this.bar.masterBar.keySignature!==this.bar.previousBar.masterBar.keySignature)&&(this.createStartSpacing(),this.createKeySignatureGlyphs()),this._isOnlyNumbered&&(!this.bar.previousBar||this.bar.previousBar&&this.bar.masterBar.timeSignatureNumerator!==this.bar.previousBar.masterBar.timeSignatureNumerator||this.bar.previousBar&&this.bar.masterBar.timeSignatureDenominator!==this.bar.previousBar.masterBar.timeSignatureDenominator||this.bar.previousBar&&this.bar.masterBar.isFreeTime&&this.bar.masterBar.isFreeTime!==this.bar.previousBar.masterBar.isFreeTime)&&(this.createStartSpacing(),this.createTimeSignatureGlyphs())}createKeySignatureGlyphs(){this.addPreBeatGlyph(new cF(0,this.getLineY(0),this.bar.masterBar.keySignature,this.bar.masterBar.keySignatureType))}createTimeSignatureGlyphs(){this.addPreBeatGlyph(new ei(0,0,5*this.scale));const e=this.bar.masterBar;this.addPreBeatGlyph(new K0(0,this.getLineY(0),e.timeSignatureNumerator,e.timeSignatureDenominator,e.timeSignatureCommon,e.isFreeTime&&(e.previousMasterBar==null||e.isFreeTime!==e.previousMasterBar.isFreeTime)))}createPostBeatGlyphs(){this._isOnlyNumbered&&super.createPostBeatGlyphs()}createVoiceGlyphs(e){for(const t of e.beats){let s=new uF(t,this.getVoiceContainer(e));s.preNotes=e.index==0?new hF:new Ha,s.onNotes=e.index==0?new jo:new za,this.addBeatGlyph(s)}}paintBeamingStem(e,t,s,r,n,a){a.lineWidth=pt.StemWidth*this.scale,a.beginPath(),a.moveTo(s,r),a.lineTo(s,n),a.stroke(),a.lineWidth=this.scale}}yi.StaffId="numbered";yi.BarSpacing=pt.BeamSpacing+pt.BeamThickness;yi.BarSize=2;yi.DotSpacing=5;yi.DotSize=2;class dF extends Fu{get staffId(){return Hc.StaffId}getStaffPaddingTop(e){return e.system.layout.renderer.settings.display.notationStaffPaddingTop}getStaffPaddingBottom(e){return e.system.layout.renderer.settings.display.notationStaffPaddingBottom}create(e,t){return new yi(e,t)}canCreate(e,t){return super.canCreate(e,t)&&t.showNumbered}constructor(){super()}}class fF extends Zt{get notationElement(){return me.EffectText}get hideOnMultiTrack(){return!1}get canShareBand(){return!0}get sizingMode(){return Ve.SinglePreBeat}shouldCreateGlyph(e,t){const s=t.voice.bar.masterBar;return t.voice.bar.staff.index===0&&t.voice.index===0&&t.index===0&&s.isFreeTime&&(s.index===0||s.isFreeTime!=s.previousMasterBar.isFreeTime)}createNewGlyph(e,t){return new ui(0,0,"Free time",e.resources.effectFont,de.Left)}canExpand(e,t){return!0}}class CS{constructor(e,t){this.vertical=e,this.createLayout=t}}class ip{constructor(e,t){this.supportsWorkers=e,this.createCanvas=t}}class D{static createStyleElement(e,t){let s=e.getElementById("alphaTabStyle");if(!s){if(!t){I.error("AlphaTab","Font directory could not be detected, cannot create style element");return}s=e.createElement("style"),s.id="alphaTabStyle";let r=`
            @font-face {
                font-family: 'alphaTab';
                 src: url('${t}Bravura.eot');
                 src: url('${t}Bravura.eot?#iefix') format('embedded-opentype')
                      , url('${t}Bravura.woff') format('woff')
                      , url('${t}Bravura.otf') format('opentype')
                      , url('${t}Bravura.svg#Bravura') format('svg');
                 font-weight: normal;
                 font-style: normal;
            }
            .at-surface * {
                cursor: default;
                vertical-align: top;
                overflow: visible;
            }
            .at-surface-svg text {
                dominant-baseline: central;
                white-space:pre;
            }
            .at {
                 font-family: 'alphaTab';
                 speak: none;
                 font-style: normal;
                 font-weight: normal;
                 font-variant: normal;
                 text-transform: none;
                 line-height: 1;
                 line-height: 1;
                 -webkit-font-smoothing: antialiased;
                 -moz-osx-font-smoothing: grayscale;
                 font-size: ${D.MusicFontSize}px;
                 overflow: visible !important;
            }`;s.innerHTML=r,e.getElementsByTagName("head").item(0).appendChild(s),D.bravuraFontChecker.checkForFontAvailability()}}static get globalThis(){if(D._globalThis===void 0){try{D._globalThis=globalThis}catch{}typeof D._globalThis>"u"&&(D._globalThis=self),typeof D._globalThis>"u"&&(D._globalThis=global),typeof D._globalThis>"u"&&(D._globalThis=window),typeof D._globalThis>"u"&&(D._globalThis=Function("return this")())}return this._globalThis}static get isRunningInWorker(){return"WorkerGlobalScope"in D.globalThis}static get isRunningInAudioWorklet(){return"AudioWorkletGlobalScope"in D.globalThis}static throttle(e,t){let s=0;return()=>{D.globalThis.clearTimeout(s),s=D.globalThis.setTimeout(e,t)}}static detectScriptFile(){if(!D.isRunningInWorker&&D.globalThis.ALPHATAB_ROOT){let e=D.globalThis.ALPHATAB_ROOT;return e=D.ensureFullUrl(e),e=D.appendScriptName(e),e}try{const e=import.meta.url;if(e&&e.indexOf("file://")===-1)return e}catch{}return"document"in D.globalThis&&document.currentScript?document.currentScript.src:null}static ensureFullUrl(e){var t,s,r;if(!e)return"";if(!e.startsWith("http")&&!e.startsWith("https")&&!e.startsWith("file")){let n="",a=D.globalThis.location;if(n+=(t=a.protocol)==null?void 0:t.toString(),n+="//",a.hostname&&(n+=(s=a.hostname)==null?void 0:s.toString()),a.port&&(n+=":",n+=(r=a.port)==null?void 0:r.toString()),!e.startsWith("/")){let o=a.pathname.split("/").slice(0,-1).join("/");o.length>0&&(o.startsWith("/")||(n+="/"),n+=o==null?void 0:o.toString())}return e.startsWith("/")||(n+="/"),n+=e==null?void 0:e.toString(),n}return e}static appendScriptName(e){return e&&!e.endsWith(".js")&&(e.endsWith("/")||(e+="/"),e+="alphaTab.js"),e}static detectFontDirectory(){if(!D.isRunningInWorker&&D.globalThis.ALPHATAB_FONT)return D.ensureFullUrl(D.globalThis.ALPHATAB_FONT);const e=D.scriptFile;if(e){let t=e.lastIndexOf("/");if(t>=0)return e.substr(0,t)+"/font/"}return null}static registerJQueryPlugin(){if(!D.isRunningInWorker&&D.globalThis&&"jQuery"in D.globalThis){let e=D.globalThis.jQuery,t=new nS;e.fn.alphaTab=function(s){const r=Array.prototype.slice.call(arguments,1);return this.length===1?t.exec(this[0],s,r):this.each((n,a)=>{t.exec(a,s,r)})},e.alphaTab={restore:nS.restore},e.fn.alphaTab.fn=t}}static getRenderEngineFactory(e){return!e||!D.renderEngines.has(e)?D.renderEngines.get("default"):D.renderEngines.get(e)}static getLayoutEngineFactory(e){return!e||!D.layoutEngines.has(e)?D.layoutEngines.get(rn.Page):D.layoutEngines.get(e)}static buildImporters(){return[new Mr,new eO,new KR,new tO,new tF,new Ti]}static createDefaultRenderEngines(){const e=new Map;return e.set("svg",new ip(!0,()=>new BO)),e.set("default",e.get("svg")),e.set("skia",new ip(!1,()=>new lt)),D.createPlatformSpecificRenderEngines(e),e}static enableAlphaSkia(e,t){lt.enable(e,t)}static registerAlphaSkiaCustomFont(e,t){return lt.registerFont(e,t)}static createPlatformSpecificRenderEngines(e){e.set("html5",new ip(!1,()=>new fO))}static createDefaultRenderers(){return[new Ja(D.StaffIdBeforeSlashAlways,[new c4,new p4,new r4,new $O,new fF,new d4,new XO]),new lF,new Ja(D.StaffIdBeforeScoreAlways,[new ZO]),new Ja(D.StaffIdBeforeScoreHideable,[new g4,new cS,new lS(!0),new dS,new uS,new fS,new hS,new SS],(e,t)=>t.showStandardNotation),new F4,new Ja(D.StaffIdBeforeNumberedAlways,[new QO,new lS(!1),new JO]),new dF,new Ja(D.StaffIdBeforeTabAlways,[new s4]),new Ja(D.StaffIdBeforeTabHideable,[new cS,new dS,new uS,new fS,new hS,new u4,new KO,new En(fe.Natural),new En(fe.Artificial),new En(fe.Pinch),new En(fe.Tap),new En(fe.Semi),new En(fe.Feedback),new t4,new YO,new e4,new a4,new l4,new o4,new SS],(e,t)=>t.showTablature),new Kf]}static createDefaultStaveProfiles(){const e=new Map,t=D.createDefaultRenderers();e.set(Yr.Default,t),e.set(Yr.ScoreTab,t);const s=new Set([D.StaffIdBeforeSlashAlways,D.StaffIdBeforeScoreAlways,D.StaffIdBeforeNumberedAlways,D.StaffIdBeforeTabAlways,fr.StaffId]);e.set(Yr.Score,t.filter(n=>s.has(n.staffId)));const r=new Set([D.StaffIdBeforeSlashAlways,D.StaffIdBeforeScoreAlways,D.StaffIdBeforeNumberedAlways,D.StaffIdBeforeTabAlways,La.StaffId]);return e.set(Yr.Tab,D.createDefaultRenderers().filter(n=>{if(n instanceof Kf){const a=n;a.showTimeSignature=!0,a.showRests=!0,a.showTiedNotes=!0}return r.has(n.staffId)})),e.set(Yr.TabMixed,D.createDefaultRenderers().filter(n=>{if(n instanceof Kf){const a=n;a.showTimeSignature=!1,a.showRests=!1,a.showTiedNotes=!1}return r.has(n.staffId)})),e}static createDefaultLayoutEngines(){const e=new Map;return e.set(rn.Page,new CS(!0,t=>new y4(t))),e.set(rn.Horizontal,new CS(!1,t=>new m4(t))),e}static initializeMain(e,t){D.isRunningInWorker||D.isRunningInAudioWorklet||((D.webPlatform===cs.Browser||D.webPlatform===cs.BrowserModule)&&(D.registerJQueryPlugin(),D.HighDpiFactor=window.devicePixelRatio,"ResizeObserver"in D.globalThis||(D.globalThis.ResizeObserver=iF),"IntersectionObserver"in D.globalThis||(D.globalThis.IntersectionObserver=sF),"replaceChildren"in Element.prototype||(Element.prototype.replaceChildren=function(...s){this.innerHTML="",this.append(...s)},Document.prototype.replaceChildren=Element.prototype.replaceChildren,DocumentFragment.prototype.replaceChildren=Element.prototype.replaceChildren),"replaceAll"in String.prototype||(String.prototype.replaceAll=function(s,r){return this.replace(new RegExp(s,"g"),r)})),D.createWebWorker=e,D.createAudioWorklet=t)}static get alphaTabWorker(){return this.globalThis.Worker}static initializeWorker(){if(!D.isRunningInWorker)throw new ni(ri.General,"Not running in worker, cannot run worker initialization");G0.init(),W0.init(),D.createWebWorker=e=>{throw new ni(ri.General,"Nested workers are not supported")}}static initializeAudioWorklet(){if(!D.isRunningInAudioWorklet)throw new ni(ri.General,"Not running in audio worklet, cannot run worklet initialization");yu.init()}static detectWebPack(){try{if(typeof __webpack_require__=="function")return!0}catch{}return!1}static detectVite(){try{if(typeof __BASE__=="string")return!0}catch{}return!1}static detectWebPlatform(){try{if(Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]")return cs.NodeJs}catch{}try{const e=import.meta.url;if(e&&typeof e=="string"&&!e.startsWith("file://"))return cs.BrowserModule}catch{}return cs.Browser}}D.StaffIdBeforeSlashAlways="before-slash-always";D.StaffIdBeforeScoreAlways="before-score-always";D.StaffIdBeforeScoreHideable="before-score-hideable";D.StaffIdBeforeNumberedAlways="before-numbered-always";D.StaffIdBeforeTabAlways="before-tab-always";D.StaffIdBeforeTabHideable="before-tab-hideable";D.MusicFontSize=34;D.HighDpiFactor=1;D._globalThis=void 0;D.webPlatform=D.detectWebPlatform();D.isWebPackBundled=D.detectWebPack();D.isViteBundled=D.detectVite();D.scriptFile=D.detectScriptFile();D.fontDirectory=D.detectFontDirectory();D.bravuraFontChecker=new X_(["alphaTab"]);D.renderEngines=D.createDefaultRenderEngines();D.layoutEngines=D.createDefaultLayoutEngines();D.staveProfiles=D.createDefaultStaveProfiles();class iT{constructor(){this.scriptFile=null,this.fontDirectory=null,this.file=null,this.tex=!1,this.tracks=null,this.enableLazyLoading=!0,this.engine="default",this.logLevel=ur.Info,this.useWorkers=!0,this.includeNoteBounds=!1,this.scriptFile=D.scriptFile,this.fontDirectory=D.fontDirectory}}var F;(function(i){i[i.SteelGuitar=1]="SteelGuitar",i[i.AcousticGuitar=2]="AcousticGuitar",i[i.TwelveStringGuitar=3]="TwelveStringGuitar",i[i.ElectricGuitar=4]="ElectricGuitar",i[i.Bass=5]="Bass",i[i.ClassicalGuitar=23]="ClassicalGuitar",i[i.UprightBass=6]="UprightBass",i[i.Ukulele=7]="Ukulele",i[i.Banjo=8]="Banjo",i[i.Mandolin=9]="Mandolin",i[i.Piano=10]="Piano",i[i.Synth=12]="Synth",i[i.Strings=11]="Strings",i[i.Brass=13]="Brass",i[i.Reed=14]="Reed",i[i.Woodwind=15]="Woodwind",i[i.Vocal=16]="Vocal",i[i.PitchedIdiophone=17]="PitchedIdiophone",i[i.Fx=21]="Fx",i[i.PercussionKit=18]="PercussionKit",i[i.Idiophone=19]="Idiophone",i[i.Membraphone=20]="Membraphone"})(F||(F={}));class V{constructor(e,t,s=null){if(this.icon=F.Piano,this.icon=e,this.instrumentSetName=t,s)this.instrumentSetType=s;else{const r=t.split(" ");r[0]=r[0].substr(0,1).toLowerCase()+r[0].substr(1),this.instrumentSetType=r.join("")}}}new V(F.Piano,"Acoustic Piano"),new V(F.Piano,"Acoustic Piano"),new V(F.Piano,"Electric Piano"),new V(F.Piano,"Acoustic Piano"),new V(F.Piano,"Electric Piano"),new V(F.Piano,"Electric Piano"),new V(F.Piano,"Harpsichord"),new V(F.Piano,"Harpsichord"),new V(F.PitchedIdiophone,"Celesta"),new V(F.PitchedIdiophone,"Vibraphone"),new V(F.PitchedIdiophone,"Vibraphone"),new V(F.PitchedIdiophone,"Vibraphone"),new V(F.PitchedIdiophone,"Xylophone"),new V(F.PitchedIdiophone,"Xylophone"),new V(F.PitchedIdiophone,"Vibraphone"),new V(F.Banjo,"Banjo"),new V(F.Piano,"Electric Organ"),new V(F.Piano,"Electric Organ"),new V(F.Piano,"Electric Organ"),new V(F.Piano,"Electric Organ"),new V(F.Piano,"Electric Organ"),new V(F.Piano,"Electric Organ"),new V(F.Woodwind,"Recorder"),new V(F.Piano,"Electric Organ"),new V(F.ClassicalGuitar,"Nylon Guitar"),new V(F.SteelGuitar,"Steel Guitar"),new V(F.SteelGuitar,"Electric Guitar"),new V(F.ElectricGuitar,"Electric Guitar"),new V(F.ElectricGuitar,"Electric Guitar"),new V(F.ElectricGuitar,"Electric Guitar"),new V(F.SteelGuitar,"Electric Guitar"),new V(F.SteelGuitar,"Electric Guitar"),new V(F.Bass,"Acoustic Bass"),new V(F.Bass,"Electric Bass"),new V(F.Bass,"Electric Bass"),new V(F.Bass,"Acoustic Bass"),new V(F.Bass,"Electric Bass"),new V(F.Bass,"Electric Bass"),new V(F.Synth,"Synth Bass"),new V(F.Synth,"Synth Bass"),new V(F.Strings,"Violin"),new V(F.Strings,"Viola"),new V(F.Strings,"Cello"),new V(F.Strings,"Contrabass"),new V(F.Strings,"Violin"),new V(F.Strings,"Violin"),new V(F.Piano,"Harp"),new V(F.Membraphone,"Timpani"),new V(F.Strings,"Violin"),new V(F.Strings,"Violin"),new V(F.Strings,"Violin"),new V(F.Strings,"Violin"),new V(F.Vocal,"Voice"),new V(F.Vocal,"Voice"),new V(F.Vocal,"Voice"),new V(F.Synth,"Pad Synthesizer"),new V(F.Brass,"Trumpet"),new V(F.Brass,"Trombone"),new V(F.Brass,"Tuba"),new V(F.Brass,"Trumpet"),new V(F.Brass,"French Horn"),new V(F.Brass,"Trumpet"),new V(F.Brass,"Trumpet"),new V(F.Brass,"Trumpet"),new V(F.Reed,"Saxophone"),new V(F.Reed,"Saxophone"),new V(F.Reed,"Saxophone"),new V(F.Reed,"Saxophone"),new V(F.Reed,"Oboe"),new V(F.Reed,"English Horn"),new V(F.Reed,"Bassoon"),new V(F.Reed,"Clarinet"),new V(F.Reed,"Piccolo"),new V(F.Woodwind,"Flute"),new V(F.Woodwind,"Recorder"),new V(F.Woodwind,"Flute"),new V(F.Woodwind,"Recorder"),new V(F.Woodwind,"Flute"),new V(F.Woodwind,"Recorder"),new V(F.Woodwind,"Flute"),new V(F.Synth,"Lead Synthesizer"),new V(F.Synth,"Lead Synthesizer"),new V(F.Synth,"Lead Synthesizer"),new V(F.Synth,"Lead Synthesizer"),new V(F.Synth,"Lead Synthesizer"),new V(F.Synth,"Lead Synthesizer"),new V(F.Synth,"Lead Synthesizer"),new V(F.Synth,"Lead Synthesizer"),new V(F.Synth,"Pad Synthesizer"),new V(F.Synth,"Pad Synthesizer"),new V(F.Synth,"Pad Synthesizer"),new V(F.Synth,"Pad Synthesizer"),new V(F.Synth,"Pad Synthesizer"),new V(F.Synth,"Pad Synthesizer"),new V(F.Synth,"Pad Synthesizer"),new V(F.Synth,"Pad Synthesizer"),new V(F.Fx,"Pad Synthesizer"),new V(F.Fx,"Pad Synthesizer"),new V(F.Fx,"Pad Synthesizer"),new V(F.Fx,"Pad Synthesizer"),new V(F.Fx,"Lead Synthesizer"),new V(F.Fx,"Lead Synthesizer"),new V(F.Fx,"Lead Synthesizer"),new V(F.Fx,"Trumpet"),new V(F.ElectricGuitar,"Banjo"),new V(F.Banjo,"Banjo"),new V(F.Ukulele,"Ukulele"),new V(F.Banjo,"Banjo"),new V(F.PitchedIdiophone,"Xylophone"),new V(F.Reed,"Bassoon"),new V(F.Strings,"Violin"),new V(F.Woodwind,"Flute"),new V(F.PitchedIdiophone,"Xylophone"),new V(F.Idiophone,"Celesta"),new V(F.PitchedIdiophone,"Vibraphone"),new V(F.Idiophone,"Xylophone"),new V(F.Membraphone,"Xylophone"),new V(F.Membraphone,"Xylophone"),new V(F.Membraphone,"Xylophone"),new V(F.Idiophone,"Celesta"),new V(F.Fx,"Steel Guitar"),new V(F.Fx,"Recorder"),new V(F.Fx,"Recorder"),new V(F.Fx,"Recorder"),new V(F.Fx,"Recorder"),new V(F.Fx,"Recorder"),new V(F.Fx,"Recorder"),new V(F.Fx,"Timpani");new V(F.PercussionKit,"Drums","drumKit");class Sa{static buildCrc32Lookup(){const t=new Uint32Array(256);for(let s=0;s<t.length;s++){let r=s;for(let n=0;n<8;n++)r=(r&1)===1?r>>>1^3988292384:r>>>1;t[s]=r}return t}get value(){return~this._checkValue}constructor(){this._checkValue=Sa.CrcInit,this.reset()}update(e,t,s){for(let r=0;r<s;r++)this._checkValue=Sa.Crc32Lookup[(this._checkValue^e[t+r])&255]^this._checkValue>>>8}reset(){this._checkValue=Sa.CrcInit}}Sa.Crc32Lookup=Sa.buildCrc32Lookup();Sa.CrcInit=4294967295;class kt{}kt.MAX_WBITS=15;kt.WSIZE=1<<kt.MAX_WBITS;kt.WMASK=kt.WSIZE-1;kt.MIN_MATCH=3;kt.MAX_MATCH=258;kt.DEFAULT_MEM_LEVEL=8;kt.PENDING_BUF_SIZE=1<<kt.DEFAULT_MEM_LEVEL+8;kt.HASH_BITS=kt.DEFAULT_MEM_LEVEL+7;kt.HASH_SIZE=1<<kt.HASH_BITS;kt.HASH_SHIFT=(kt.HASH_BITS+kt.MIN_MATCH-1)/kt.MIN_MATCH;kt.HASH_MASK=kt.HASH_SIZE-1;kt.MIN_LOOKAHEAD=kt.MAX_MATCH+kt.MIN_MATCH+1;kt.MAX_DIST=kt.WSIZE-kt.MIN_LOOKAHEAD;class Ts{constructor(e,t,s,r){this.length=null,this.numCodes=0,this.codes=null,this.huffman=e,this.minNumCodes=s,this.maxLength=r,this.freqs=new Int16Array(t),this.bitLengthCounts=new Int32Array(r)}reset(){for(let e=0;e<this.freqs.length;e++)this.freqs[e]=0;this.codes=null,this.length=null}buildTree(){let e=this.freqs.length,t=new Int32Array(e),s=0,r=0;for(let u=0;u<e;u++){let h=this.freqs[u];if(h!==0){let c=s++;for(;c>0;){let d=Math.floor((c-1)/2);if(this.freqs[t[d]]>h)t[c]=t[d],c=d;else break}t[c]=u,r=u}}for(;s<2;){let u=r<2?++r:0;t[s++]=u}this.numCodes=Math.max(r+1,this.minNumCodes);let n=s,a=new Int32Array(4*s-2),o=new Int32Array(2*s-1),l=n;for(let u=0;u<s;u++){let h=t[u];a[2*u]=h,a[2*u+1]=-1,o[u]=this.freqs[h]<<8,t[u]=u}do{let u=t[0],h=t[--s],c=0,d=1;for(;d<s;)d+1<s&&o[t[d]]>o[t[d+1]]&&d++,t[c]=t[d],c=d,d=d*2+1;let f=o[h];for(;d=c,c>0;)if(c=Math.floor((d-1)/2),o[t[c]]>f)t[d]=t[c];else break;t[d]=h;let p=t[0];h=l++,a[2*h]=u,a[2*h+1]=p;let g=Math.min(o[u]&255,o[p]&255);for(f=o[u]+o[p]-g+1,o[h]=f,c=0,d=1;d<s;)d+1<s&&o[t[d]]>o[t[d+1]]&&d++,t[c]=t[d],c=d,d=c*2+1;for(;d=c,d>0;)if(c=Math.floor((d-1)/2),o[t[c]]>f)t[d]=t[c];else break;t[d]=h}while(s>1);this.buildLength(a)}buildLength(e){this.length=new Uint8Array(this.freqs.length);let t=Math.floor(e.length/2),s=Math.floor((t+1)/2),r=0;for(let l=0;l<this.maxLength;l++)this.bitLengthCounts[l]=0;let n=new Int32Array(t);n[t-1]=0;for(let l=t-1;l>=0;l--)if(e[2*l+1]!=-1){let u=n[l]+1;u>this.maxLength&&(u=this.maxLength,r++),n[e[2*l]]=u,n[e[2*l+1]]=u}else{let u=n[l];this.bitLengthCounts[u-1]++,this.length[e[2*l]]=n[l]}if(r==0)return;let a=this.maxLength-1;do{for(;this.bitLengthCounts[--a]==0;);do this.bitLengthCounts[a]--,this.bitLengthCounts[++a]++,r-=1<<this.maxLength-1-a;while(r>0&&a<this.maxLength-1)}while(r>0);this.bitLengthCounts[this.maxLength-1]+=r,this.bitLengthCounts[this.maxLength-2]-=r;let o=2*s;for(let l=this.maxLength;l!=0;l--){let u=this.bitLengthCounts[l-1];for(;u>0;){let h=2*e[o++];e[h+1]==-1&&(this.length[e[h]]=l,u--)}}}getEncodedLength(){let e=0;for(let t=0;t<this.freqs.length;t++)e+=this.freqs[t]*this.length[t];return e}calcBLFreq(e){let t,s,r,n=-1,a=0;for(;a<this.numCodes;){r=1;let o=this.length[a];for(o==0?(t=138,s=3):(t=6,s=3,n!=o&&(e.freqs[o]++,r=0)),n=o,a++;a<this.numCodes&&n==this.length[a]&&(a++,!(++r>=t)););r<s?e.freqs[n]+=r:n!=0?e.freqs[Ts.Repeat3To6]++:r<=10?e.freqs[Ts.Repeat3To10]++:e.freqs[Ts.Repeat11To138]++}}setStaticCodes(e,t){this.codes=e,this.length=t}buildCodes(){let e=new Int32Array(this.maxLength),t=0;this.codes=new Int16Array(this.freqs.length);for(let s=0;s<this.maxLength;s++)e[s]=t,t+=this.bitLengthCounts[s]<<15-s;for(let s=0;s<this.numCodes;s++){let r=this.length[s];r>0&&(this.codes[s]=ge.bitReverse(e[r-1]),e[r-1]+=1<<16-r)}}writeTree(e){let t,s,r,n=-1,a=0;for(;a<this.numCodes;){r=1;let o=this.length[a];for(o==0?(t=138,s=3):(t=6,s=3,n!=o&&(e.writeSymbol(o),r=0)),n=o,a++;a<this.numCodes&&n==this.length[a]&&(a++,!(++r>=t)););if(r<s)for(;r-- >0;)e.writeSymbol(n);else n!=0?(e.writeSymbol(Ts.Repeat3To6),this.huffman.pending.writeBits(r-3,2)):r<=10?(e.writeSymbol(Ts.Repeat3To10),this.huffman.pending.writeBits(r-3,3)):(e.writeSymbol(Ts.Repeat11To138),this.huffman.pending.writeBits(r-11,7))}}writeSymbol(e){this.huffman.pending.writeBits(this.codes[e]&65535,this.length[e])}}Ts.Repeat3To6=16;Ts.Repeat3To10=17;Ts.Repeat11To138=18;class ge{static staticInit(){let e=0;for(;e<144;)ge.staticLCodes[e]=ge.bitReverse(48+e<<8),ge.staticLLength[e++]=8;for(;e<256;)ge.staticLCodes[e]=ge.bitReverse(256+e<<7),ge.staticLLength[e++]=9;for(;e<280;)ge.staticLCodes[e]=ge.bitReverse(-256+e<<9),ge.staticLLength[e++]=7;for(;e<ge.LITERAL_NUM;)ge.staticLCodes[e]=ge.bitReverse(-88+e<<8),ge.staticLLength[e++]=8;for(e=0;e<ge.DIST_NUM;e++)ge.staticDCodes[e]=ge.bitReverse(e<<11),ge.staticDLength[e]=5}static bitReverse(e){return ge.bit4Reverse[e&15]<<12|ge.bit4Reverse[e>>4&15]<<8|ge.bit4Reverse[e>>8&15]<<4|ge.bit4Reverse[e>>12]}constructor(e){this.last_lit=0,this.extra_bits=0,this.pending=e,this.literalTree=new Ts(this,ge.LITERAL_NUM,257,15),this.distTree=new Ts(this,ge.DIST_NUM,1,15),this.blTree=new Ts(this,ge.BITLEN_NUM,4,7),this.d_buf=new Int16Array(ge.BUFSIZE),this.l_buf=new Uint8Array(ge.BUFSIZE)}isFull(){return this.last_lit>=ge.BUFSIZE}reset(){this.last_lit=0,this.extra_bits=0,this.literalTree.reset(),this.distTree.reset(),this.blTree.reset()}flushStoredBlock(e,t,s,r){this.pending.writeBits((ge.STORED_BLOCK<<1)+(r?1:0),3),this.pending.alignToByte(),this.pending.writeShort(s),this.pending.writeShort(~s),this.pending.writeBlock(e,t,s),this.reset()}flushBlock(e,t,s,r){this.literalTree.freqs[ge.EOF_SYMBOL]++,this.literalTree.buildTree(),this.distTree.buildTree(),this.literalTree.calcBLFreq(this.blTree),this.distTree.calcBLFreq(this.blTree),this.blTree.buildTree();let n=4;for(let l=18;l>n;l--)this.blTree.length[ge.BL_ORDER[l]]>0&&(n=l+1);let a=14+n*3+this.blTree.getEncodedLength()+this.literalTree.getEncodedLength()+this.distTree.getEncodedLength()+this.extra_bits,o=this.extra_bits;for(let l=0;l<ge.LITERAL_NUM;l++)o+=this.literalTree.freqs[l]*ge.staticLLength[l];for(let l=0;l<ge.DIST_NUM;l++)o+=this.distTree.freqs[l]*ge.staticDLength[l];a>=o&&(a=o),t>=0&&s+4<a>>3?this.flushStoredBlock(e,t,s,r):a==o?(this.pending.writeBits((ge.STATIC_TREES<<1)+(r?1:0),3),this.literalTree.setStaticCodes(ge.staticLCodes,ge.staticLLength),this.distTree.setStaticCodes(ge.staticDCodes,ge.staticDLength),this.compressBlock(),this.reset()):(this.pending.writeBits((ge.DYN_TREES<<1)+(r?1:0),3),this.sendAllTrees(n),this.compressBlock(),this.reset())}sendAllTrees(e){this.blTree.buildCodes(),this.literalTree.buildCodes(),this.distTree.buildCodes(),this.pending.writeBits(this.literalTree.numCodes-257,5),this.pending.writeBits(this.distTree.numCodes-1,5),this.pending.writeBits(e-4,4);for(let t=0;t<e;t++)this.pending.writeBits(this.blTree.length[ge.BL_ORDER[t]],3);this.literalTree.writeTree(this.blTree),this.distTree.writeTree(this.blTree)}compressBlock(){for(let e=0;e<this.last_lit;e++){let t=this.l_buf[e]&255,s=this.d_buf[e];if(s--!=0){let r=ge.Lcode(t);this.literalTree.writeSymbol(r);let n=Math.floor((r-261)/4);n>0&&n<=5&&this.pending.writeBits(t&(1<<n)-1,n);let a=ge.Dcode(s);this.distTree.writeSymbol(a),n=Math.floor(a/2)-1,n>0&&this.pending.writeBits(s&(1<<n)-1,n)}else this.literalTree.writeSymbol(t)}this.literalTree.writeSymbol(ge.EOF_SYMBOL)}tallyDist(e,t){this.d_buf[this.last_lit]=e,this.l_buf[this.last_lit++]=t-3;let s=ge.Lcode(t-3);this.literalTree.freqs[s]++,s>=265&&s<285&&(this.extra_bits+=Math.floor((s-261)/4));let r=ge.Dcode(e-1);return this.distTree.freqs[r]++,r>=4&&(this.extra_bits+=Math.floor(r/2)-1),this.isFull()}tallyLit(e){return this.d_buf[this.last_lit]=0,this.l_buf[this.last_lit++]=e,this.literalTree.freqs[e]++,this.isFull()}static Lcode(e){if(e==255)return 285;let t=257;for(;e>=8;)t+=4,e=e>>1;return t+e}static Dcode(e){let t=0;for(;e>=4;)t+=2,e=e>>1;return t+e}}ge.BUFSIZE=1<<kt.DEFAULT_MEM_LEVEL+6;ge.LITERAL_NUM=286;ge.STORED_BLOCK=0;ge.STATIC_TREES=1;ge.DYN_TREES=2;ge.DIST_NUM=30;ge.staticLCodes=new Int16Array(ge.LITERAL_NUM);ge.staticLLength=new Uint8Array(ge.LITERAL_NUM);ge.staticDCodes=new Int16Array(ge.DIST_NUM);ge.staticDLength=new Uint8Array(ge.DIST_NUM);ge.BL_ORDER=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];ge.bit4Reverse=new Uint8Array([0,8,4,12,2,10,6,14,1,9,5,13,3,11,7,15]);ge.BITLEN_NUM=19;ge.EOF_SYMBOL=256;ge.staticInit();var pF=Object.freeze({__proto__:null,ActiveBeatsChangedEventArgs:Y_,AlphaSynth:F_,AlphaSynthAudioWorkletOutput:J_,AlphaSynthScriptProcessorOutput:Q_,AlphaSynthWebAudioOutputBase:Ns,AlphaSynthWebWorkerApi:Yg,CircularSampleBuffer:j0,MidiEventsPlayedEventArgs:H0,PlaybackRange:$_,PlaybackRangeChangedEventArgs:z0,get PlayerState(){return zt},PlayerStateChangedEventArgs:Ll,PositionChangedEventArgs:cu});D.isRunningInWorker?D.initializeWorker():D.isRunningInAudioWorklet?D.initializeAudioWorklet():D.initializeMain(i=>{if(D.webPlatform==cs.NodeJs)throw new ni(ri.General,"Workers not yet supported in Node.js");if(D.webPlatform==cs.BrowserModule||D.isWebPackBundled||D.isViteBundled)return I.debug("AlphaTab","Creating webworker"),new D.alphaTabWorker(new URL(new URL(""+new URL("alphaTab.worker-BBnuRQMH.js",import.meta.url).href,import.meta.url),import.meta.url),{type:"module"});if(!i.core.scriptFile)throw new ni(ri.General,"Could not detect alphaTab script file, cannot initialize renderer");try{I.debug("AlphaTab","Creating Blob worker");const e=`importScripts('${i.core.scriptFile}')`,t=new Blob([e]);return new Worker(URL.createObjectURL(t))}catch{return I.warning("Rendering","Could not create inline worker, fallback to normal worker"),new Worker(i.core.scriptFile)}},(i,e)=>{if(D.webPlatform==cs.NodeJs)throw new ni(ri.General,"Audio Worklets not yet supported in Node.js");return D.webPlatform==cs.BrowserModule||D.isWebPackBundled||D.isViteBundled?(I.debug("AlphaTab","Creating Module worklet"),i.audioWorklet.addModule(new URL(new URL(""+new URL("alphaTab.worklet-DUjwjb9R.js",import.meta.url).href,import.meta.url),import.meta.url))):(I.debug("AlphaTab","Creating Script worklet"),i.audioWorklet.addModule(e.core.scriptFile))});const gF={tex:!0,fontDirectory:"font/",engine:"svg"},mF={staveProfile:"Default",padding:[10,20],scale:1},yF=i=>({scrollElement:i,enableCursor:!0,enableAnimatedBeatCursor:!0,enableElementHighlighting:!0,enablePlayer:!0,enableUserInteraction:!0,soundFont:"soundfont/sonivox.sf2"}),bF=i=>({scrollElement:i,enableCursor:!1,enableAnimatedBeatCursor:!1,enableElementHighlighting:!1,enablePlayer:!1,enableUserInteraction:!1}),SF={guitarTuning:!1,trackNames:!1},wF={elements:SF},vF=(i,e)=>({core:gF,display:mF,notation:wF,player:ee(e)?yF(i):e});function sT({tex:i,root:e,player:t,scrollArea:s,isLooping:r,isCountingIn:n,instrumentVolume:a,chordsVolume:o,showChordsStaff:l,metronomeVolume:u}){const[h,c]=P.useState(),[d,f]=P.useState(!1),[p,g]=P.useState(!1);return P.useEffect(()=>{ee(h)||h.tex(i,l?[0,1]:[0])},[h,i]),P.useEffect(()=>{!ee(h)&&!ee(r)&&(h.isLooping=r)},[h,r]),P.useEffect(()=>{if(!ee(h)){const b=()=>f(!0),m=()=>f(!1);return h.renderStarted.on(b),h.renderFinished.on(m),()=>{h.renderStarted.off(b),h.renderFinished.off(m)}}return Et},[h,f]),P.useEffect(()=>{if(!ee(h)){const b=({state:m})=>{const y=m===pF.PlayerState.Playing;g(y),y&&(Qg(h,0,a),Qg(h,1,o),rT(h,u,n))};return h.playerStateChanged.on(b),()=>h.playerStateChanged.off(b)}return Et},[h,a,o,u,n,g]),PS(h,0,a),PS(h,1,o),kF(h,u,n),P.useEffect(()=>{if(!ee(e)&&!ee(s)){const b=new Vd(e,vF(s,t));return b.render(),ee(r)||(b.isLooping=r),ee(u)||(b.metronomeVolume=u,n&&(b.countInVolume=u)),c(b),()=>b.destroy()}return Et},[e,s]),{api:h,isLoading:d,isPlaying:p}}function PS(i,e,t){P.useEffect(()=>{Qg(i,e,t)},[i,e,t])}function kF(i,e,t){P.useEffect(()=>rT(i,e,t),[i,e,t])}function Qg(i,e,t){var r,n;if(ee(i)||ee(t))return;const s=(n=(r=i.score)==null?void 0:r.tracks)==null?void 0:n[e];ee(s)||i.changeTrackVolume([s],t)}function rT(i,e,t){ee(i)||ee(e)||(i.metronomeVolume=e,i.countInVolume=t?e:0)}var Z0={exports:{}};Z0.exports;(function(i){var e=function(){var t=String.fromCharCode,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",n={};function a(l,u){if(!n[l]){n[l]={};for(var h=0;h<l.length;h++)n[l][l.charAt(h)]=h}return n[l][u]}var o={compressToBase64:function(l){if(l==null)return"";var u=o._compress(l,6,function(h){return s.charAt(h)});switch(u.length%4){default:case 0:return u;case 1:return u+"===";case 2:return u+"==";case 3:return u+"="}},decompressFromBase64:function(l){return l==null?"":l==""?null:o._decompress(l.length,32,function(u){return a(s,l.charAt(u))})},compressToUTF16:function(l){return l==null?"":o._compress(l,15,function(u){return t(u+32)})+" "},decompressFromUTF16:function(l){return l==null?"":l==""?null:o._decompress(l.length,16384,function(u){return l.charCodeAt(u)-32})},compressToUint8Array:function(l){for(var u=o.compress(l),h=new Uint8Array(u.length*2),c=0,d=u.length;c<d;c++){var f=u.charCodeAt(c);h[c*2]=f>>>8,h[c*2+1]=f%256}return h},decompressFromUint8Array:function(l){if(l==null)return o.decompress(l);for(var u=new Array(l.length/2),h=0,c=u.length;h<c;h++)u[h]=l[h*2]*256+l[h*2+1];var d=[];return u.forEach(function(f){d.push(t(f))}),o.decompress(d.join(""))},compressToEncodedURIComponent:function(l){return l==null?"":o._compress(l,6,function(u){return r.charAt(u)})},decompressFromEncodedURIComponent:function(l){return l==null?"":l==""?null:(l=l.replace(/ /g,"+"),o._decompress(l.length,32,function(u){return a(r,l.charAt(u))}))},compress:function(l){return o._compress(l,16,function(u){return t(u)})},_compress:function(l,u,h){if(l==null)return"";var c,d,f={},p={},g="",b="",m="",y=2,w=3,x=2,k=[],_=0,T=0,C;for(C=0;C<l.length;C+=1)if(g=l.charAt(C),Object.prototype.hasOwnProperty.call(f,g)||(f[g]=w++,p[g]=!0),b=m+g,Object.prototype.hasOwnProperty.call(f,b))m=b;else{if(Object.prototype.hasOwnProperty.call(p,m)){if(m.charCodeAt(0)<256){for(c=0;c<x;c++)_=_<<1,T==u-1?(T=0,k.push(h(_)),_=0):T++;for(d=m.charCodeAt(0),c=0;c<8;c++)_=_<<1|d&1,T==u-1?(T=0,k.push(h(_)),_=0):T++,d=d>>1}else{for(d=1,c=0;c<x;c++)_=_<<1|d,T==u-1?(T=0,k.push(h(_)),_=0):T++,d=0;for(d=m.charCodeAt(0),c=0;c<16;c++)_=_<<1|d&1,T==u-1?(T=0,k.push(h(_)),_=0):T++,d=d>>1}y--,y==0&&(y=Math.pow(2,x),x++),delete p[m]}else for(d=f[m],c=0;c<x;c++)_=_<<1|d&1,T==u-1?(T=0,k.push(h(_)),_=0):T++,d=d>>1;y--,y==0&&(y=Math.pow(2,x),x++),f[b]=w++,m=String(g)}if(m!==""){if(Object.prototype.hasOwnProperty.call(p,m)){if(m.charCodeAt(0)<256){for(c=0;c<x;c++)_=_<<1,T==u-1?(T=0,k.push(h(_)),_=0):T++;for(d=m.charCodeAt(0),c=0;c<8;c++)_=_<<1|d&1,T==u-1?(T=0,k.push(h(_)),_=0):T++,d=d>>1}else{for(d=1,c=0;c<x;c++)_=_<<1|d,T==u-1?(T=0,k.push(h(_)),_=0):T++,d=0;for(d=m.charCodeAt(0),c=0;c<16;c++)_=_<<1|d&1,T==u-1?(T=0,k.push(h(_)),_=0):T++,d=d>>1}y--,y==0&&(y=Math.pow(2,x),x++),delete p[m]}else for(d=f[m],c=0;c<x;c++)_=_<<1|d&1,T==u-1?(T=0,k.push(h(_)),_=0):T++,d=d>>1;y--,y==0&&(y=Math.pow(2,x),x++)}for(d=2,c=0;c<x;c++)_=_<<1|d&1,T==u-1?(T=0,k.push(h(_)),_=0):T++,d=d>>1;for(;;)if(_=_<<1,T==u-1){k.push(h(_));break}else T++;return k.join("")},decompress:function(l){return l==null?"":l==""?null:o._decompress(l.length,32768,function(u){return l.charCodeAt(u)})},_decompress:function(l,u,h){var c=[],d=4,f=4,p=3,g="",b=[],m,y,w,x,k,_,T,C={val:h(0),position:u,index:1};for(m=0;m<3;m+=1)c[m]=m;for(w=0,k=Math.pow(2,2),_=1;_!=k;)x=C.val&C.position,C.position>>=1,C.position==0&&(C.position=u,C.val=h(C.index++)),w|=(x>0?1:0)*_,_<<=1;switch(w){case 0:for(w=0,k=Math.pow(2,8),_=1;_!=k;)x=C.val&C.position,C.position>>=1,C.position==0&&(C.position=u,C.val=h(C.index++)),w|=(x>0?1:0)*_,_<<=1;T=t(w);break;case 1:for(w=0,k=Math.pow(2,16),_=1;_!=k;)x=C.val&C.position,C.position>>=1,C.position==0&&(C.position=u,C.val=h(C.index++)),w|=(x>0?1:0)*_,_<<=1;T=t(w);break;case 2:return""}for(c[3]=T,y=T,b.push(T);;){if(C.index>l)return"";for(w=0,k=Math.pow(2,p),_=1;_!=k;)x=C.val&C.position,C.position>>=1,C.position==0&&(C.position=u,C.val=h(C.index++)),w|=(x>0?1:0)*_,_<<=1;switch(T=w){case 0:for(w=0,k=Math.pow(2,8),_=1;_!=k;)x=C.val&C.position,C.position>>=1,C.position==0&&(C.position=u,C.val=h(C.index++)),w|=(x>0?1:0)*_,_<<=1;c[f++]=t(w),T=f-1,d--;break;case 1:for(w=0,k=Math.pow(2,16),_=1;_!=k;)x=C.val&C.position,C.position>>=1,C.position==0&&(C.position=u,C.val=h(C.index++)),w|=(x>0?1:0)*_,_<<=1;c[f++]=t(w),T=f-1,d--;break;case 2:return b.join("")}if(d==0&&(d=Math.pow(2,p),p++),c[T])g=c[T];else if(T===f)g=y+y.charAt(0);else return null;b.push(g),c[f++]=y+g.charAt(0),d--,y=g,d==0&&(d=Math.pow(2,p),p++)}}};return o}();i!=null?i.exports=e:typeof angular<"u"&&angular!=null&&angular.module("LZString",[]).factory("LZString",function(){return e})})(Z0);var xF=Z0.exports;const nT=im(xF);function _F(i){const e={};for(const t of i){const s=Ba(t),r=VE(t);ee(e[s])&&(e[s]=[]),e[s].push(r)}return e}function MS(i){const e=Object.entries(i),t={};for(const[s,r]of e)ee(r)||(t[s]={c:r.cluster,f:r.frequency});return t}function TF(i){return{b:i.bars,t:i.tempo,c:i.clef,ts:{u:i.timeSignature.upper,l:i.timeSignature.lower},ks:i.keySignature,scst:i.showChordsStaff,scsy:i.showChordSymbols,usc:i.useSeventhChords,n:_F(i.notes),nd:MS(i.noteDurations),rd:MS(i.restDurations)}}function ES(i){const e=Object.entries(i),t={};for(const[s,r]of e)ee(r)||(t[s]={cluster:r.c,frequency:r.f});return t}function NF(i){const e=[];for(const[t,s]of Object.entries(i))for(const r of s){const n=`${t}${r}`;e.push(n)}return e.sort(w0)}function BF(i){return{bars:i.b,tempo:i.t,clef:i.c,keySignature:i.ks,showChordsStaff:i.scst,showChordSymbols:i.scsy,useSeventhChords:i.usc,timeStamp:Date.now(),noteDurations:ES(i.nd),restDurations:ES(i.rd),notes:NF(i.n),timeSignature:{lower:i.ts.l,upper:i.ts.u}}}const aT="c";function CF(i){const e=JSON.stringify(TF(i));return nT.compressToBase64(e).replace(/\+/g,"-").replace(/\//g,"_")}function PF(i){const e=i.replace(/-/g,"+").replace(/_/g,"/"),t=nT.decompressFromBase64(e);return BF(JSON.parse(t))}function MF(i){const e=new URL(window.location.origin+window.location.pathname);return e.searchParams.append(aT,CF(i)),e.toString()}function EF(i){try{const t=new URL(i).searchParams.get(aT);if(!ee(t)&&t.length>0)return PF(t)}catch{return}}function LF(){const{i18n:i}=Yt(),e=Ad(),t=Rn(Vr.selectSlice),s=Rn(GR),r=Rn(kg.selectSlice),[n,a]=P.useState(!1),[o,l]=P.useState(!1),u=Rn(xg.selectSlice),h=ee(u)?i.language:u,[c,d]=P.useState(),[f,p]=P.useState(),{api:g,isLoading:b,isPlaying:m}=sT({tex:s,root:c,scrollArea:f,instrumentVolume:r.instrumentVolume,metronomeVolume:r.metronomeVolume,chordsVolume:r.chordsVolume,isLooping:r.isLooping,isCountingIn:r.isCountingIn,showChordsStaff:t.showChordsStaff}),y=P.useCallback(()=>g==null?void 0:g.playPause(),[g]),w=P.useCallback(()=>g==null?void 0:g.stop(),[g]),x=P.useCallback(()=>{e(Vr.actions.setGeneratorConfig({...t,timeStamp:new Date().getTime()}))},[t]),k=P.useCallback(E=>e(kg.actions.setPlayerConfig({...r,...E})),[r]),_=P.useCallback(()=>k({isLooping:!r.isLooping}),[k]),T=P.useCallback(()=>k({isCountingIn:!r.isCountingIn}),[k]),C=P.useCallback(E=>k({instrumentVolume:E}),[k]),W=P.useCallback(E=>k({chordsVolume:E}),[k]),z=P.useCallback(E=>k({metronomeVolume:E}),[k]),te=P.useCallback(E=>{e(xg.actions.setLanguage(E))},[]);return P.useEffect(()=>{ee(u)||i.changeLanguage(u,()=>x())},[u]),P.useEffect(()=>{const E=EF(window.location.href);ee(E)||e(Vr.actions.setGeneratorConfig(E));const U=window.location.origin+window.location.pathname;window.history.replaceState({},document.title,U)},[]),{instrumentVolume:r.instrumentVolume,metronomeVolume:r.metronomeVolume,chordsVolume:r.chordsVolume,isLooping:r.isLooping,isCountingIn:r.isCountingIn,isLoading:b,isPlaying:m,isHelpOpen:o,isSettingsOpen:n,language:h,stop:w,playPause:y,regenerate:x,toggleLooping:_,toggleCountIn:T,setInstrumentVolume:C,setChordsVolume:W,setMetronomeVolume:z,setRootDOMElement:d,setScrollAreaDOMElement:p,setSettingsOpen:a,setHelpOpen:l,setLanguage:te}}const DF=B`
  border-top-left-radius: 14px;
  border-bottom-left-radius: 14px;
  min-width: 245px;
`,AF=B`
  overflow-x: auto;
  display: flex;
  flex-direction: column;
`,IF=X(Ot,B`
    display: flex;
    flex-direction: row;
    align-items: center;
    color: #000000dd;
    gap: 10px;
    padding: 15px 10px;
    cursor: pointer;
    border-bottom: 1px solid #ccc;
    &:hover {
      color: #000000;
      background-color: #00000010;
    }
  `),RF=B`
  flex: 1;
`;function OF({pages:i,onClick:e}){return v.jsx("div",{className:DF,children:v.jsx("div",{className:AF,children:i.map(t=>{const{id:s,name:r,Icon:n,Badge:a}=t;return v.jsxs("div",{className:IF,onClick:()=>e(t),children:[v.jsx(n,{}),v.jsx("span",{className:RF,children:r}),a&&v.jsx(a,{})]},s)})})})}const FF=B`
  position: fixed;
  top: 0px;
  left: 100vw;
  height: 100vh;
  width: 100vw;
  display: flex;
  flex-direction: column;
  z-index: 1001;
  transition: 0.2s ease;
  background-color: #ffffff;

  @supports (height: 100dvh) {
    height: min(100vh, 100dvh);
  }
`,VF=B`
  left: 0px;
`,HF=B`
  display: flex;
  flex-direction: row;
  align-items: center;
  justify-content: space-between;
  width: 100%;
  padding: 10px;
  height: ${au}px;
  background-color: #f0f0f0;
  border-bottom: 1px solid #ccc;
`,zF=X(_D,B`
    flex-grow: 1;
    flex-shrink: 1;
  `),WF=X(T0,B`
    position: relative;
    left: -5px;
  `),GF=B`
  flex: 1 1 1px;
  overflow: auto;
`,jF=B`
  width: 100%;
  padding: 14px;
  display: flex;
  flex-direction: row;
  justify-content: flex-end;
  align-items: center;
  pointer-events: all;
  gap: 10px;
  width: 100%;
  border-bottom-right-radius: 14px;
  background-color: #f0f0f0;
  border-top: 1px solid #ccc;
`;function oT({isOpen:i,title:e,buttons:t,children:s,data:r,onBack:n,onClose:a,onClick:o}){const l=X({[FF]:!0,[VF]:i}),u=P.useRef(null),h=()=>{var d;n==null||n(),(d=u.current)==null||d.scroll({top:0,left:0,behavior:"smooth"})},c=()=>{var d;a==null||a(),(d=u.current)==null||d.scroll({top:0,left:0,behavior:"smooth"})};return v.jsxs("div",{className:l,children:[v.jsxs("div",{className:HF,children:[!ee(n)&&v.jsx($D,{className:WF,onClick:h}),v.jsx("div",{className:zF,children:v.jsx("span",{children:e})}),!ee(a)&&v.jsx(Zx,{className:T0,onClick:c})]}),v.jsx("div",{className:GF,ref:u,children:s}),!ee(t)&&!ee(o)&&t.length>0&&v.jsx("div",{className:jF,children:t.map(d=>v.jsxs(ma,{onClick:()=>o(d,r),disabled:!d.enabled,children:[v.jsx(d.icon,{})," ",d.label]},d.id))})]})}var qt=(i=>(i.WARNING="warning",i.ERROR="error",i))(qt||{});const zr=Object.freeze([]);function ul(){return zr}function ey(i){return Ca(i.lower)&&Ca(i.upper)}const LS={[qt.WARNING]:2,[qt.ERROR]:1};function UF(i,e){return LS[i.type]-LS[e.type]}function $F(i){return Array.from(i).sort(UF)[0]}function YF(i){return P.useMemo(()=>$F(i),[i])}const XF=B`
  display: flex;
  flex-direction: column;
  padding: 14px;
  pointer-events: auto;

  @media ${ws} {
    padding: 10px;
  }
  @media ${Ks} {
    padding: 10px;
  }
`,Mi=({children:i})=>v.jsx("div",{className:XF,children:i}),QF=X(Ot,B`
    color: #000000dd;
    margin-bottom: 2px;
    pointer-events: auto;
  `),Ei=({children:i})=>v.jsx("div",{className:QF,children:i}),JF=X(Zs,B`
    color: #000000aa;
    margin-bottom: 14px;
  `),qF=B`
  font-weight: bold;
  color: #ec942c;
`,KF=B`
  font-weight: bold;
  color: #cc3300;
`,is=({children:i,issues:e})=>{const t=YF(e),s=X({[JF]:!0,[qF]:(t==null?void 0:t.type)===qt.WARNING,[KF]:(t==null?void 0:t.type)===qt.ERROR});return v.jsx("div",{className:s,children:ee(t)?i:t.label})},ZF=()=>v.jsx(WD,{color:"#ec942c"}),e3=()=>v.jsx(Qx,{color:"#cc3300"}),t3=B`
  background: linear-gradient(to bottom, #00000018 0px, #00000000 50px);
`,i3=()=>{const{t:i}=Yt(),{metronomeVolume:e,instrumentVolume:t,chordsVolume:s,setMetronomeVolume:r,setInstrumentVolume:n,setChordsVolume:a}=vr();return v.jsxs("div",{className:t3,children:[v.jsxs(Mi,{children:[v.jsx(Ei,{children:i("PlayerTooltips.MelodyVolume")}),v.jsx(To,{color:"dark",value:t,MuteIcon:Af,MaxVolumeIcon:If,onChange:n})]}),v.jsxs(Mi,{children:[v.jsx(Ei,{children:i("PlayerTooltips.ChordsVolume")}),v.jsx(To,{color:"dark",value:s,MuteIcon:Af,MaxVolumeIcon:If,onChange:a})]}),v.jsxs(Mi,{children:[v.jsx(Ei,{children:i("PlayerTooltips.MetronomeVolume")}),v.jsx(To,{color:"dark",value:e,MuteIcon:Af,MaxVolumeIcon:If,onChange:r})]})]})};function Da(i){"@babel/helpers - typeof";return Da=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Da(i)}function s3(i,e){if(Da(i)!="object"||!i)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e||"default");if(Da(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}function lT(i){var e=s3(i,"string");return Da(e)=="symbol"?e:e+""}function bl(i,e,t){return(e=lT(e))in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function DS(i,e){var t=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);e&&(s=s.filter(function(r){return Object.getOwnPropertyDescriptor(i,r).enumerable})),t.push.apply(t,s)}return t}function De(i){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?DS(Object(t),!0).forEach(function(s){bl(i,s,t[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(t)):DS(Object(t)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(t,s))})}return i}function r3(i){if(Array.isArray(i))return i}function n3(i,e){var t=i==null?null:typeof Symbol<"u"&&i[Symbol.iterator]||i["@@iterator"];if(t!=null){var s,r,n,a,o=[],l=!0,u=!1;try{if(n=(t=t.call(i)).next,e===0){if(Object(t)!==t)return;l=!1}else for(;!(l=(s=n.call(t)).done)&&(o.push(s.value),o.length!==e);l=!0);}catch(h){u=!0,r=h}finally{try{if(!l&&t.return!=null&&(a=t.return(),Object(a)!==a))return}finally{if(u)throw r}}return o}}function Jg(i,e){(e==null||e>i.length)&&(e=i.length);for(var t=0,s=Array(e);t<e;t++)s[t]=i[t];return s}function uT(i,e){if(i){if(typeof i=="string")return Jg(i,e);var t={}.toString.call(i).slice(8,-1);return t==="Object"&&i.constructor&&(t=i.constructor.name),t==="Map"||t==="Set"?Array.from(i):t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?Jg(i,e):void 0}}function a3(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function an(i,e){return r3(i)||n3(i,e)||uT(i,e)||a3()}function o3(i,e){if(i==null)return{};var t={};for(var s in i)if({}.hasOwnProperty.call(i,s)){if(e.indexOf(s)!==-1)continue;t[s]=i[s]}return t}function xn(i,e){if(i==null)return{};var t,s,r=o3(i,e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(i);for(s=0;s<n.length;s++)t=n[s],e.indexOf(t)===-1&&{}.propertyIsEnumerable.call(i,t)&&(r[t]=i[t])}return r}var l3=["defaultInputValue","defaultMenuIsOpen","defaultValue","inputValue","menuIsOpen","onChange","onInputChange","onMenuClose","onMenuOpen","value"];function u3(i){var e=i.defaultInputValue,t=e===void 0?"":e,s=i.defaultMenuIsOpen,r=s===void 0?!1:s,n=i.defaultValue,a=n===void 0?null:n,o=i.inputValue,l=i.menuIsOpen,u=i.onChange,h=i.onInputChange,c=i.onMenuClose,d=i.onMenuOpen,f=i.value,p=xn(i,l3),g=P.useState(o!==void 0?o:t),b=an(g,2),m=b[0],y=b[1],w=P.useState(l!==void 0?l:r),x=an(w,2),k=x[0],_=x[1],T=P.useState(f!==void 0?f:a),C=an(T,2),W=C[0],z=C[1],te=P.useCallback(function(A,Y){typeof u=="function"&&u(A,Y),z(A)},[u]),E=P.useCallback(function(A,Y){var le;typeof h=="function"&&(le=h(A,Y)),y(le!==void 0?le:A)},[h]),U=P.useCallback(function(){typeof d=="function"&&d(),_(!0)},[d]),re=P.useCallback(function(){typeof c=="function"&&c(),_(!1)},[c]),K=o!==void 0?o:m,ae=l!==void 0?l:k,ie=f!==void 0?f:W;return De(De({},p),{},{inputValue:K,menuIsOpen:ae,onChange:te,onInputChange:E,onMenuClose:re,onMenuOpen:U,value:ie})}function h3(i,e){if(!(i instanceof e))throw new TypeError("Cannot call a class as a function")}function AS(i,e){for(var t=0;t<e.length;t++){var s=e[t];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(i,lT(s.key),s)}}function c3(i,e,t){return e&&AS(i.prototype,e),t&&AS(i,t),Object.defineProperty(i,"prototype",{writable:!1}),i}function qg(i,e){return qg=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,s){return t.__proto__=s,t},qg(i,e)}function d3(i,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");i.prototype=Object.create(e&&e.prototype,{constructor:{value:i,writable:!0,configurable:!0}}),Object.defineProperty(i,"prototype",{writable:!1}),e&&qg(i,e)}function zc(i){return zc=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},zc(i)}function hT(){try{var i=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(hT=function(){return!!i})()}function f3(i){if(i===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return i}function p3(i,e){if(e&&(Da(e)=="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return f3(i)}function g3(i){var e=hT();return function(){var t,s=zc(i);if(e){var r=zc(this).constructor;t=Reflect.construct(s,arguments,r)}else t=s.apply(this,arguments);return p3(this,t)}}function m3(i){if(Array.isArray(i))return Jg(i)}function y3(i){if(typeof Symbol<"u"&&i[Symbol.iterator]!=null||i["@@iterator"]!=null)return Array.from(i)}function b3(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function ty(i){return m3(i)||y3(i)||uT(i)||b3()}function S3(i,e){return e||(e=i.slice(0)),Object.freeze(Object.defineProperties(i,{raw:{value:Object.freeze(e)}}))}const w3=Math.min,v3=Math.max,Wc=Math.round,bh=Math.floor,Gc=i=>({x:i,y:i});function k3(i){const{x:e,y:t,width:s,height:r}=i;return{width:s,height:r,top:t,left:e,right:e+s,bottom:t+r,x:e,y:t}}function Wd(){return typeof window<"u"}function cT(i){return fT(i)?(i.nodeName||"").toLowerCase():"#document"}function yn(i){var e;return(i==null||(e=i.ownerDocument)==null?void 0:e.defaultView)||window}function dT(i){var e;return(e=(fT(i)?i.ownerDocument:i.document)||window.document)==null?void 0:e.documentElement}function fT(i){return Wd()?i instanceof Node||i instanceof yn(i).Node:!1}function x3(i){return Wd()?i instanceof Element||i instanceof yn(i).Element:!1}function iy(i){return Wd()?i instanceof HTMLElement||i instanceof yn(i).HTMLElement:!1}function IS(i){return!Wd()||typeof ShadowRoot>"u"?!1:i instanceof ShadowRoot||i instanceof yn(i).ShadowRoot}function pT(i){const{overflow:e,overflowX:t,overflowY:s,display:r}=sy(i);return/auto|scroll|overlay|hidden|clip/.test(e+s+t)&&!["inline","contents"].includes(r)}function _3(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}function T3(i){return["html","body","#document"].includes(cT(i))}function sy(i){return yn(i).getComputedStyle(i)}function N3(i){if(cT(i)==="html")return i;const e=i.assignedSlot||i.parentNode||IS(i)&&i.host||dT(i);return IS(e)?e.host:e}function gT(i){const e=N3(i);return T3(e)?i.ownerDocument?i.ownerDocument.body:i.body:iy(e)&&pT(e)?e:gT(e)}function jc(i,e,t){var s;e===void 0&&(e=[]),t===void 0&&(t=!0);const r=gT(i),n=r===((s=i.ownerDocument)==null?void 0:s.body),a=yn(r);if(n){const o=Kg(a);return e.concat(a,a.visualViewport||[],pT(r)?r:[],o&&t?jc(o):[])}return e.concat(r,jc(r,[],t))}function Kg(i){return i.parent&&Object.getPrototypeOf(i.parent)?i.frameElement:null}function B3(i){const e=sy(i);let t=parseFloat(e.width)||0,s=parseFloat(e.height)||0;const r=iy(i),n=r?i.offsetWidth:t,a=r?i.offsetHeight:s,o=Wc(t)!==n||Wc(s)!==a;return o&&(t=n,s=a),{width:t,height:s,$:o}}function ry(i){return x3(i)?i:i.contextElement}function RS(i){const e=ry(i);if(!iy(e))return Gc(1);const t=e.getBoundingClientRect(),{width:s,height:r,$:n}=B3(e);let a=(n?Wc(t.width):t.width)/s,o=(n?Wc(t.height):t.height)/r;return(!a||!Number.isFinite(a))&&(a=1),(!o||!Number.isFinite(o))&&(o=1),{x:a,y:o}}const C3=Gc(0);function P3(i){const e=yn(i);return!_3()||!e.visualViewport?C3:{x:e.visualViewport.offsetLeft,y:e.visualViewport.offsetTop}}function M3(i,e,t){return!1}function OS(i,e,t,s){e===void 0&&(e=!1);const r=i.getBoundingClientRect(),n=ry(i);let a=Gc(1);e&&(a=RS(i));const o=M3()?P3(n):Gc(0);let l=(r.left+o.x)/a.x,u=(r.top+o.y)/a.y,h=r.width/a.x,c=r.height/a.y;if(n){const d=yn(n),f=s;let p=d,g=Kg(p);for(;g&&s&&f!==p;){const b=RS(g),m=g.getBoundingClientRect(),y=sy(g),w=m.left+(g.clientLeft+parseFloat(y.paddingLeft))*b.x,x=m.top+(g.clientTop+parseFloat(y.paddingTop))*b.y;l*=b.x,u*=b.y,h*=b.x,c*=b.y,l+=w,u+=x,p=yn(g),g=Kg(p)}}return k3({width:h,height:c,x:l,y:u})}function E3(i,e){let t=null,s;const r=dT(i);function n(){var o;clearTimeout(s),(o=t)==null||o.disconnect(),t=null}function a(o,l){o===void 0&&(o=!1),l===void 0&&(l=1),n();const{left:u,top:h,width:c,height:d}=i.getBoundingClientRect();if(o||e(),!c||!d)return;const f=bh(h),p=bh(r.clientWidth-(u+c)),g=bh(r.clientHeight-(h+d)),b=bh(u),y={rootMargin:-f+"px "+-p+"px "+-g+"px "+-b+"px",threshold:v3(0,w3(1,l))||1};let w=!0;function x(k){const _=k[0].intersectionRatio;if(_!==l){if(!w)return a();_?a(!1,_):s=setTimeout(()=>{a(!1,1e-7)},1e3)}w=!1}try{t=new IntersectionObserver(x,{...y,root:r.ownerDocument})}catch{t=new IntersectionObserver(x,y)}t.observe(i)}return a(!0),n}function L3(i,e,t,s){s===void 0&&(s={});const{ancestorScroll:r=!0,ancestorResize:n=!0,elementResize:a=typeof ResizeObserver=="function",layoutShift:o=typeof IntersectionObserver=="function",animationFrame:l=!1}=s,u=ry(i),h=r||n?[...u?jc(u):[],...jc(e)]:[];h.forEach(m=>{r&&m.addEventListener("scroll",t,{passive:!0}),n&&m.addEventListener("resize",t)});const c=u&&o?E3(u,t):null;let d=-1,f=null;a&&(f=new ResizeObserver(m=>{let[y]=m;y&&y.target===u&&f&&(f.unobserve(e),cancelAnimationFrame(d),d=requestAnimationFrame(()=>{var w;(w=f)==null||w.observe(e)})),t()}),u&&!l&&f.observe(u),f.observe(e));let p,g=l?OS(i):null;l&&b();function b(){const m=OS(i);g&&(m.x!==g.x||m.y!==g.y||m.width!==g.width||m.height!==g.height)&&t(),g=m,p=requestAnimationFrame(b)}return t(),()=>{var m;h.forEach(y=>{r&&y.removeEventListener("scroll",t),n&&y.removeEventListener("resize",t)}),c==null||c(),(m=f)==null||m.disconnect(),f=null,l&&cancelAnimationFrame(p)}}var Zg=P.useLayoutEffect,D3=["className","clearValue","cx","getStyles","getClassNames","getValue","hasValue","isMulti","isRtl","options","selectOption","selectProps","setValue","theme"],Uc=function(){};function A3(i,e){return e?e[0]==="-"?i+e:i+"__"+e:i}function I3(i,e){for(var t=arguments.length,s=new Array(t>2?t-2:0),r=2;r<t;r++)s[r-2]=arguments[r];var n=[].concat(s);if(e&&i)for(var a in e)e.hasOwnProperty(a)&&e[a]&&n.push("".concat(A3(i,a)));return n.filter(function(o){return o}).map(function(o){return String(o).trim()}).join(" ")}var FS=function(e){return j3(e)?e.filter(Boolean):Da(e)==="object"&&e!==null?[e]:[]},mT=function(e){e.className,e.clearValue,e.cx,e.getStyles,e.getClassNames,e.getValue,e.hasValue,e.isMulti,e.isRtl,e.options,e.selectOption,e.selectProps,e.setValue,e.theme;var t=xn(e,D3);return De({},t)},Kt=function(e,t,s){var r=e.cx,n=e.getStyles,a=e.getClassNames,o=e.className;return{css:n(t,e),className:r(s??{},a(t,e),o)}};function Gd(i){return[document.documentElement,document.body,window].indexOf(i)>-1}function R3(i){return Gd(i)?window.innerHeight:i.clientHeight}function yT(i){return Gd(i)?window.pageYOffset:i.scrollTop}function $c(i,e){if(Gd(i)){window.scrollTo(0,e);return}i.scrollTop=e}function O3(i){var e=getComputedStyle(i),t=e.position==="absolute",s=/(auto|scroll)/;if(e.position==="fixed")return document.documentElement;for(var r=i;r=r.parentElement;)if(e=getComputedStyle(r),!(t&&e.position==="static")&&s.test(e.overflow+e.overflowY+e.overflowX))return r;return document.documentElement}function F3(i,e,t,s){return t*((i=i/s-1)*i*i+1)+e}function Sh(i,e){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:200,s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:Uc,r=yT(i),n=e-r,a=10,o=0;function l(){o+=a;var u=F3(o,r,n,t);$c(i,u),o<t?window.requestAnimationFrame(l):s(i)}l()}function VS(i,e){var t=i.getBoundingClientRect(),s=e.getBoundingClientRect(),r=e.offsetHeight/3;s.bottom+r>t.bottom?$c(i,Math.min(e.offsetTop+e.clientHeight-i.offsetHeight+r,i.scrollHeight)):s.top-r<t.top&&$c(i,Math.max(e.offsetTop-r,0))}function V3(i){var e=i.getBoundingClientRect();return{bottom:e.bottom,height:e.height,left:e.left,right:e.right,top:e.top,width:e.width}}function HS(){try{return document.createEvent("TouchEvent"),!0}catch{return!1}}function H3(){try{return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)}catch{return!1}}var bT=!1,z3={get passive(){return bT=!0}},wh=typeof window<"u"?window:{};wh.addEventListener&&wh.removeEventListener&&(wh.addEventListener("p",Uc,z3),wh.removeEventListener("p",Uc,!1));var W3=bT;function G3(i){return i!=null}function j3(i){return Array.isArray(i)}function vh(i,e,t){return i?e:t}var U3=function(e){for(var t=arguments.length,s=new Array(t>1?t-1:0),r=1;r<t;r++)s[r-1]=arguments[r];var n=Object.entries(e).filter(function(a){var o=an(a,1),l=o[0];return!s.includes(l)});return n.reduce(function(a,o){var l=an(o,2),u=l[0],h=l[1];return a[u]=h,a},{})},$3=["children","innerProps"],Y3=["children","innerProps"];function X3(i){var e=i.maxHeight,t=i.menuEl,s=i.minHeight,r=i.placement,n=i.shouldScroll,a=i.isFixedPosition,o=i.controlHeight,l=O3(t),u={placement:"bottom",maxHeight:e};if(!t||!t.offsetParent)return u;var h=l.getBoundingClientRect(),c=h.height,d=t.getBoundingClientRect(),f=d.bottom,p=d.height,g=d.top,b=t.offsetParent.getBoundingClientRect(),m=b.top,y=a?window.innerHeight:R3(l),w=yT(l),x=parseInt(getComputedStyle(t).marginBottom,10),k=parseInt(getComputedStyle(t).marginTop,10),_=m-k,T=y-g,C=_+w,W=c-w-g,z=f-y+w+x,te=w+g-k,E=160;switch(r){case"auto":case"bottom":if(T>=p)return{placement:"bottom",maxHeight:e};if(W>=p&&!a)return n&&Sh(l,z,E),{placement:"bottom",maxHeight:e};if(!a&&W>=s||a&&T>=s){n&&Sh(l,z,E);var U=a?T-x:W-x;return{placement:"bottom",maxHeight:U}}if(r==="auto"||a){var re=e,K=a?_:C;return K>=s&&(re=Math.min(K-x-o,e)),{placement:"top",maxHeight:re}}if(r==="bottom")return n&&$c(l,z),{placement:"bottom",maxHeight:e};break;case"top":if(_>=p)return{placement:"top",maxHeight:e};if(C>=p&&!a)return n&&Sh(l,te,E),{placement:"top",maxHeight:e};if(!a&&C>=s||a&&_>=s){var ae=e;return(!a&&C>=s||a&&_>=s)&&(ae=a?_-k:C-k),n&&Sh(l,te,E),{placement:"top",maxHeight:ae}}return{placement:"bottom",maxHeight:e};default:throw new Error('Invalid placement provided "'.concat(r,'".'))}return u}function Q3(i){var e={bottom:"top",top:"bottom"};return i?e[i]:"bottom"}var ST=function(e){return e==="auto"?"bottom":e},J3=function(e,t){var s,r=e.placement,n=e.theme,a=n.borderRadius,o=n.spacing,l=n.colors;return De((s={label:"menu"},bl(s,Q3(r),"100%"),bl(s,"position","absolute"),bl(s,"width","100%"),bl(s,"zIndex",1),s),t?{}:{backgroundColor:l.neutral0,borderRadius:a,boxShadow:"0 0 0 1px hsla(0, 0%, 0%, 0.1), 0 4px 11px hsla(0, 0%, 0%, 0.1)",marginBottom:o.menuGutter,marginTop:o.menuGutter})},wT=P.createContext(null),q3=function(e){var t=e.children,s=e.minMenuHeight,r=e.maxMenuHeight,n=e.menuPlacement,a=e.menuPosition,o=e.menuShouldScrollIntoView,l=e.theme,u=P.useContext(wT)||{},h=u.setPortalPlacement,c=P.useRef(null),d=P.useState(r),f=an(d,2),p=f[0],g=f[1],b=P.useState(null),m=an(b,2),y=m[0],w=m[1],x=l.spacing.controlHeight;return Zg(function(){var k=c.current;if(k){var _=a==="fixed",T=o&&!_,C=X3({maxHeight:r,menuEl:k,minHeight:s,placement:n,shouldScroll:T,isFixedPosition:_,controlHeight:x});g(C.maxHeight),w(C.placement),h==null||h(C.placement)}},[r,n,a,o,s,h,x]),t({ref:c,placerProps:De(De({},e),{},{placement:y||ST(n),maxHeight:p})})},K3=function(e){var t=e.children,s=e.innerRef,r=e.innerProps;return Ee("div",Ae({},Kt(e,"menu",{menu:!0}),{ref:s},r),t)},Z3=K3,e5=function(e,t){var s=e.maxHeight,r=e.theme.spacing.baseUnit;return De({maxHeight:s,overflowY:"auto",position:"relative",WebkitOverflowScrolling:"touch"},t?{}:{paddingBottom:r,paddingTop:r})},t5=function(e){var t=e.children,s=e.innerProps,r=e.innerRef,n=e.isMulti;return Ee("div",Ae({},Kt(e,"menuList",{"menu-list":!0,"menu-list--is-multi":n}),{ref:r},s),t)},vT=function(e,t){var s=e.theme,r=s.spacing.baseUnit,n=s.colors;return De({textAlign:"center"},t?{}:{color:n.neutral40,padding:"".concat(r*2,"px ").concat(r*3,"px")})},i5=vT,s5=vT,r5=function(e){var t=e.children,s=t===void 0?"No options":t,r=e.innerProps,n=xn(e,$3);return Ee("div",Ae({},Kt(De(De({},n),{},{children:s,innerProps:r}),"noOptionsMessage",{"menu-notice":!0,"menu-notice--no-options":!0}),r),s)},n5=function(e){var t=e.children,s=t===void 0?"Loading...":t,r=e.innerProps,n=xn(e,Y3);return Ee("div",Ae({},Kt(De(De({},n),{},{children:s,innerProps:r}),"loadingMessage",{"menu-notice":!0,"menu-notice--loading":!0}),r),s)},a5=function(e){var t=e.rect,s=e.offset,r=e.position;return{left:t.left,position:r,top:s,width:t.width,zIndex:1}},o5=function(e){var t=e.appendTo,s=e.children,r=e.controlElement,n=e.innerProps,a=e.menuPlacement,o=e.menuPosition,l=P.useRef(null),u=P.useRef(null),h=P.useState(ST(a)),c=an(h,2),d=c[0],f=c[1],p=P.useMemo(function(){return{setPortalPlacement:f}},[]),g=P.useState(null),b=an(g,2),m=b[0],y=b[1],w=P.useCallback(function(){if(r){var T=V3(r),C=o==="fixed"?0:window.pageYOffset,W=T[d]+C;(W!==(m==null?void 0:m.offset)||T.left!==(m==null?void 0:m.rect.left)||T.width!==(m==null?void 0:m.rect.width))&&y({offset:W,rect:T})}},[r,o,d,m==null?void 0:m.offset,m==null?void 0:m.rect.left,m==null?void 0:m.rect.width]);Zg(function(){w()},[w]);var x=P.useCallback(function(){typeof u.current=="function"&&(u.current(),u.current=null),r&&l.current&&(u.current=L3(r,l.current,w,{elementResize:"ResizeObserver"in window}))},[r,w]);Zg(function(){x()},[x]);var k=P.useCallback(function(T){l.current=T,x()},[x]);if(!t&&o!=="fixed"||!m)return null;var _=Ee("div",Ae({ref:k},Kt(De(De({},e),{},{offset:m.offset,position:o,rect:m.rect}),"menuPortal",{"menu-portal":!0}),n),s);return Ee(wT.Provider,{value:p},t?dd.createPortal(_,t):_)},l5=function(e){var t=e.isDisabled,s=e.isRtl;return{label:"container",direction:s?"rtl":void 0,pointerEvents:t?"none":void 0,position:"relative"}},u5=function(e){var t=e.children,s=e.innerProps,r=e.isDisabled,n=e.isRtl;return Ee("div",Ae({},Kt(e,"container",{"--is-disabled":r,"--is-rtl":n}),s),t)},h5=function(e,t){var s=e.theme.spacing,r=e.isMulti,n=e.hasValue,a=e.selectProps.controlShouldRenderValue;return De({alignItems:"center",display:r&&n&&a?"flex":"grid",flex:1,flexWrap:"wrap",WebkitOverflowScrolling:"touch",position:"relative",overflow:"hidden"},t?{}:{padding:"".concat(s.baseUnit/2,"px ").concat(s.baseUnit*2,"px")})},c5=function(e){var t=e.children,s=e.innerProps,r=e.isMulti,n=e.hasValue;return Ee("div",Ae({},Kt(e,"valueContainer",{"value-container":!0,"value-container--is-multi":r,"value-container--has-value":n}),s),t)},d5=function(){return{alignItems:"center",alignSelf:"stretch",display:"flex",flexShrink:0}},f5=function(e){var t=e.children,s=e.innerProps;return Ee("div",Ae({},Kt(e,"indicatorsContainer",{indicators:!0}),s),t)},zS,p5=["size"],g5=["innerProps","isRtl","size"],m5={name:"8mmkcg",styles:"display:inline-block;fill:currentColor;line-height:1;stroke:currentColor;stroke-width:0"},kT=function(e){var t=e.size,s=xn(e,p5);return Ee("svg",Ae({height:t,width:t,viewBox:"0 0 20 20","aria-hidden":"true",focusable:"false",css:m5},s))},ny=function(e){return Ee(kT,Ae({size:20},e),Ee("path",{d:"M14.348 14.849c-0.469 0.469-1.229 0.469-1.697 0l-2.651-3.030-2.651 3.029c-0.469 0.469-1.229 0.469-1.697 0-0.469-0.469-0.469-1.229 0-1.697l2.758-3.15-2.759-3.152c-0.469-0.469-0.469-1.228 0-1.697s1.228-0.469 1.697 0l2.652 3.031 2.651-3.031c0.469-0.469 1.228-0.469 1.697 0s0.469 1.229 0 1.697l-2.758 3.152 2.758 3.15c0.469 0.469 0.469 1.229 0 1.698z"}))},xT=function(e){return Ee(kT,Ae({size:20},e),Ee("path",{d:"M4.516 7.548c0.436-0.446 1.043-0.481 1.576 0l3.908 3.747 3.908-3.747c0.533-0.481 1.141-0.446 1.574 0 0.436 0.445 0.408 1.197 0 1.615-0.406 0.418-4.695 4.502-4.695 4.502-0.217 0.223-0.502 0.335-0.787 0.335s-0.57-0.112-0.789-0.335c0 0-4.287-4.084-4.695-4.502s-0.436-1.17 0-1.615z"}))},_T=function(e,t){var s=e.isFocused,r=e.theme,n=r.spacing.baseUnit,a=r.colors;return De({label:"indicatorContainer",display:"flex",transition:"color 150ms"},t?{}:{color:s?a.neutral60:a.neutral20,padding:n*2,":hover":{color:s?a.neutral80:a.neutral40}})},y5=_T,b5=function(e){var t=e.children,s=e.innerProps;return Ee("div",Ae({},Kt(e,"dropdownIndicator",{indicator:!0,"dropdown-indicator":!0}),s),t||Ee(xT,null))},S5=_T,w5=function(e){var t=e.children,s=e.innerProps;return Ee("div",Ae({},Kt(e,"clearIndicator",{indicator:!0,"clear-indicator":!0}),s),t||Ee(ny,null))},v5=function(e,t){var s=e.isDisabled,r=e.theme,n=r.spacing.baseUnit,a=r.colors;return De({label:"indicatorSeparator",alignSelf:"stretch",width:1},t?{}:{backgroundColor:s?a.neutral10:a.neutral20,marginBottom:n*2,marginTop:n*2})},k5=function(e){var t=e.innerProps;return Ee("span",Ae({},t,Kt(e,"indicatorSeparator",{"indicator-separator":!0})))},x5=VC(zS||(zS=S3([`
  0%, 80%, 100% { opacity: 0; }
  40% { opacity: 1; }
`]))),_5=function(e,t){var s=e.isFocused,r=e.size,n=e.theme,a=n.colors,o=n.spacing.baseUnit;return De({label:"loadingIndicator",display:"flex",transition:"color 150ms",alignSelf:"center",fontSize:r,lineHeight:1,marginRight:r,textAlign:"center",verticalAlign:"middle"},t?{}:{color:s?a.neutral60:a.neutral20,padding:o*2})},sp=function(e){var t=e.delay,s=e.offset;return Ee("span",{css:Nd({animation:"".concat(x5," 1s ease-in-out ").concat(t,"ms infinite;"),backgroundColor:"currentColor",borderRadius:"1em",display:"inline-block",marginLeft:s?"1em":void 0,height:"1em",verticalAlign:"top",width:"1em"},"","")})},T5=function(e){var t=e.innerProps,s=e.isRtl,r=e.size,n=r===void 0?4:r,a=xn(e,g5);return Ee("div",Ae({},Kt(De(De({},a),{},{innerProps:t,isRtl:s,size:n}),"loadingIndicator",{indicator:!0,"loading-indicator":!0}),t),Ee(sp,{delay:0,offset:s}),Ee(sp,{delay:160,offset:!0}),Ee(sp,{delay:320,offset:!s}))},N5=function(e,t){var s=e.isDisabled,r=e.isFocused,n=e.theme,a=n.colors,o=n.borderRadius,l=n.spacing;return De({label:"control",alignItems:"center",cursor:"default",display:"flex",flexWrap:"wrap",justifyContent:"space-between",minHeight:l.controlHeight,outline:"0 !important",position:"relative",transition:"all 100ms"},t?{}:{backgroundColor:s?a.neutral5:a.neutral0,borderColor:s?a.neutral10:r?a.primary:a.neutral20,borderRadius:o,borderStyle:"solid",borderWidth:1,boxShadow:r?"0 0 0 1px ".concat(a.primary):void 0,"&:hover":{borderColor:r?a.primary:a.neutral30}})},B5=function(e){var t=e.children,s=e.isDisabled,r=e.isFocused,n=e.innerRef,a=e.innerProps,o=e.menuIsOpen;return Ee("div",Ae({ref:n},Kt(e,"control",{control:!0,"control--is-disabled":s,"control--is-focused":r,"control--menu-is-open":o}),a,{"aria-disabled":s||void 0}),t)},C5=B5,P5=["data"],M5=function(e,t){var s=e.theme.spacing;return t?{}:{paddingBottom:s.baseUnit*2,paddingTop:s.baseUnit*2}},E5=function(e){var t=e.children,s=e.cx,r=e.getStyles,n=e.getClassNames,a=e.Heading,o=e.headingProps,l=e.innerProps,u=e.label,h=e.theme,c=e.selectProps;return Ee("div",Ae({},Kt(e,"group",{group:!0}),l),Ee(a,Ae({},o,{selectProps:c,theme:h,getStyles:r,getClassNames:n,cx:s}),u),Ee("div",null,t))},L5=function(e,t){var s=e.theme,r=s.colors,n=s.spacing;return De({label:"group",cursor:"default",display:"block"},t?{}:{color:r.neutral40,fontSize:"75%",fontWeight:500,marginBottom:"0.25em",paddingLeft:n.baseUnit*3,paddingRight:n.baseUnit*3,textTransform:"uppercase"})},D5=function(e){var t=mT(e);t.data;var s=xn(t,P5);return Ee("div",Ae({},Kt(e,"groupHeading",{"group-heading":!0}),s))},A5=E5,I5=["innerRef","isDisabled","isHidden","inputClassName"],R5=function(e,t){var s=e.isDisabled,r=e.value,n=e.theme,a=n.spacing,o=n.colors;return De(De({visibility:s?"hidden":"visible",transform:r?"translateZ(0)":""},O5),t?{}:{margin:a.baseUnit/2,paddingBottom:a.baseUnit/2,paddingTop:a.baseUnit/2,color:o.neutral80})},TT={gridArea:"1 / 2",font:"inherit",minWidth:"2px",border:0,margin:0,outline:0,padding:0},O5={flex:"1 1 auto",display:"inline-grid",gridArea:"1 / 1 / 2 / 3",gridTemplateColumns:"0 min-content","&:after":De({content:'attr(data-value) " "',visibility:"hidden",whiteSpace:"pre"},TT)},F5=function(e){return De({label:"input",color:"inherit",background:0,opacity:e?0:1,width:"100%"},TT)},V5=function(e){var t=e.cx,s=e.value,r=mT(e),n=r.innerRef,a=r.isDisabled,o=r.isHidden,l=r.inputClassName,u=xn(r,I5);return Ee("div",Ae({},Kt(e,"input",{"input-container":!0}),{"data-value":s||""}),Ee("input",Ae({className:t({input:!0},l),ref:n,style:F5(o),disabled:a},u)))},H5=V5,z5=function(e,t){var s=e.theme,r=s.spacing,n=s.borderRadius,a=s.colors;return De({label:"multiValue",display:"flex",minWidth:0},t?{}:{backgroundColor:a.neutral10,borderRadius:n/2,margin:r.baseUnit/2})},W5=function(e,t){var s=e.theme,r=s.borderRadius,n=s.colors,a=e.cropWithEllipsis;return De({overflow:"hidden",textOverflow:a||a===void 0?"ellipsis":void 0,whiteSpace:"nowrap"},t?{}:{borderRadius:r/2,color:n.neutral80,fontSize:"85%",padding:3,paddingLeft:6})},G5=function(e,t){var s=e.theme,r=s.spacing,n=s.borderRadius,a=s.colors,o=e.isFocused;return De({alignItems:"center",display:"flex"},t?{}:{borderRadius:n/2,backgroundColor:o?a.dangerLight:void 0,paddingLeft:r.baseUnit,paddingRight:r.baseUnit,":hover":{backgroundColor:a.dangerLight,color:a.danger}})},NT=function(e){var t=e.children,s=e.innerProps;return Ee("div",s,t)},j5=NT,U5=NT;function $5(i){var e=i.children,t=i.innerProps;return Ee("div",Ae({role:"button"},t),e||Ee(ny,{size:14}))}var Y5=function(e){var t=e.children,s=e.components,r=e.data,n=e.innerProps,a=e.isDisabled,o=e.removeProps,l=e.selectProps,u=s.Container,h=s.Label,c=s.Remove;return Ee(u,{data:r,innerProps:De(De({},Kt(e,"multiValue",{"multi-value":!0,"multi-value--is-disabled":a})),n),selectProps:l},Ee(h,{data:r,innerProps:De({},Kt(e,"multiValueLabel",{"multi-value__label":!0})),selectProps:l},t),Ee(c,{data:r,innerProps:De(De({},Kt(e,"multiValueRemove",{"multi-value__remove":!0})),{},{"aria-label":"Remove ".concat(t||"option")},o),selectProps:l}))},X5=Y5,Q5=function(e,t){var s=e.isDisabled,r=e.isFocused,n=e.isSelected,a=e.theme,o=a.spacing,l=a.colors;return De({label:"option",cursor:"default",display:"block",fontSize:"inherit",width:"100%",userSelect:"none",WebkitTapHighlightColor:"rgba(0, 0, 0, 0)"},t?{}:{backgroundColor:n?l.primary:r?l.primary25:"transparent",color:s?l.neutral20:n?l.neutral0:"inherit",padding:"".concat(o.baseUnit*2,"px ").concat(o.baseUnit*3,"px"),":active":{backgroundColor:s?void 0:n?l.primary:l.primary50}})},J5=function(e){var t=e.children,s=e.isDisabled,r=e.isFocused,n=e.isSelected,a=e.innerRef,o=e.innerProps;return Ee("div",Ae({},Kt(e,"option",{option:!0,"option--is-disabled":s,"option--is-focused":r,"option--is-selected":n}),{ref:a,"aria-disabled":s},o),t)},q5=J5,K5=function(e,t){var s=e.theme,r=s.spacing,n=s.colors;return De({label:"placeholder",gridArea:"1 / 1 / 2 / 3"},t?{}:{color:n.neutral50,marginLeft:r.baseUnit/2,marginRight:r.baseUnit/2})},Z5=function(e){var t=e.children,s=e.innerProps;return Ee("div",Ae({},Kt(e,"placeholder",{placeholder:!0}),s),t)},e6=Z5,t6=function(e,t){var s=e.isDisabled,r=e.theme,n=r.spacing,a=r.colors;return De({label:"singleValue",gridArea:"1 / 1 / 2 / 3",maxWidth:"100%",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},t?{}:{color:s?a.neutral40:a.neutral80,marginLeft:n.baseUnit/2,marginRight:n.baseUnit/2})},i6=function(e){var t=e.children,s=e.isDisabled,r=e.innerProps;return Ee("div",Ae({},Kt(e,"singleValue",{"single-value":!0,"single-value--is-disabled":s}),r),t)},s6=i6,Ga={ClearIndicator:w5,Control:C5,DropdownIndicator:b5,DownChevron:xT,CrossIcon:ny,Group:A5,GroupHeading:D5,IndicatorsContainer:f5,IndicatorSeparator:k5,Input:H5,LoadingIndicator:T5,Menu:Z3,MenuList:t5,MenuPortal:o5,LoadingMessage:n5,NoOptionsMessage:r5,MultiValue:X5,MultiValueContainer:j5,MultiValueLabel:U5,MultiValueRemove:$5,Option:q5,Placeholder:e6,SelectContainer:u5,SingleValue:s6,ValueContainer:c5},r6=function(e){return De(De({},Ga),e.components)},WS=Number.isNaN||function(e){return typeof e=="number"&&e!==e};function n6(i,e){return!!(i===e||WS(i)&&WS(e))}function a6(i,e){if(i.length!==e.length)return!1;for(var t=0;t<i.length;t++)if(!n6(i[t],e[t]))return!1;return!0}function o6(i,e){e===void 0&&(e=a6);var t=null;function s(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];if(t&&t.lastThis===this&&e(r,t.lastArgs))return t.lastResult;var a=i.apply(this,r);return t={lastResult:a,lastArgs:r,lastThis:this},a}return s.clear=function(){t=null},s}var l6={name:"7pg0cj-a11yText",styles:"label:a11yText;z-index:9999;border:0;clip:rect(1px, 1px, 1px, 1px);height:1px;width:1px;position:absolute;overflow:hidden;padding:0;white-space:nowrap"},u6=function(e){return Ee("span",Ae({css:l6},e))},GS=u6,h6={guidance:function(e){var t=e.isSearchable,s=e.isMulti,r=e.tabSelectsValue,n=e.context,a=e.isInitialFocus;switch(n){case"menu":return"Use Up and Down to choose options, press Enter to select the currently focused option, press Escape to exit the menu".concat(r?", press Tab to select the option and exit the menu":"",".");case"input":return a?"".concat(e["aria-label"]||"Select"," is focused ").concat(t?",type to refine list":"",", press Down to open the menu, ").concat(s?" press left to focus selected values":""):"";case"value":return"Use left and right to toggle between focused values, press Backspace to remove the currently focused value";default:return""}},onChange:function(e){var t=e.action,s=e.label,r=s===void 0?"":s,n=e.labels,a=e.isDisabled;switch(t){case"deselect-option":case"pop-value":case"remove-value":return"option ".concat(r,", deselected.");case"clear":return"All selected options have been cleared.";case"initial-input-focus":return"option".concat(n.length>1?"s":""," ").concat(n.join(","),", selected.");case"select-option":return a?"option ".concat(r," is disabled. Select another option."):"option ".concat(r,", selected.");default:return""}},onFocus:function(e){var t=e.context,s=e.focused,r=e.options,n=e.label,a=n===void 0?"":n,o=e.selectValue,l=e.isDisabled,u=e.isSelected,h=e.isAppleDevice,c=function(g,b){return g&&g.length?"".concat(g.indexOf(b)+1," of ").concat(g.length):""};if(t==="value"&&o)return"value ".concat(a," focused, ").concat(c(o,s),".");if(t==="menu"&&h){var d=l?" disabled":"",f="".concat(u?" selected":"").concat(d);return"".concat(a).concat(f,", ").concat(c(r,s),".")}return""},onFilter:function(e){var t=e.inputValue,s=e.resultsMessage;return"".concat(s).concat(t?" for search term "+t:"",".")}},c6=function(e){var t=e.ariaSelection,s=e.focusedOption,r=e.focusedValue,n=e.focusableOptions,a=e.isFocused,o=e.selectValue,l=e.selectProps,u=e.id,h=e.isAppleDevice,c=l.ariaLiveMessages,d=l.getOptionLabel,f=l.inputValue,p=l.isMulti,g=l.isOptionDisabled,b=l.isSearchable,m=l.menuIsOpen,y=l.options,w=l.screenReaderStatus,x=l.tabSelectsValue,k=l.isLoading,_=l["aria-label"],T=l["aria-live"],C=P.useMemo(function(){return De(De({},h6),c||{})},[c]),W=P.useMemo(function(){var K="";if(t&&C.onChange){var ae=t.option,ie=t.options,A=t.removedValue,Y=t.removedValues,le=t.value,pe=function($i){return Array.isArray($i)?null:$i},oe=A||ae||pe(le),ze=oe?d(oe):"",Ye=ie||Y||void 0,Ie=Ye?Ye.map(d):[],it=De({isDisabled:oe&&g(oe,o),label:ze,labels:Ie},t);K=C.onChange(it)}return K},[t,C,g,o,d]),z=P.useMemo(function(){var K="",ae=s||r,ie=!!(s&&o&&o.includes(s));if(ae&&C.onFocus){var A={focused:ae,label:d(ae),isDisabled:g(ae,o),isSelected:ie,options:n,context:ae===s?"menu":"value",selectValue:o,isAppleDevice:h};K=C.onFocus(A)}return K},[s,r,d,g,C,n,o,h]),te=P.useMemo(function(){var K="";if(m&&y.length&&!k&&C.onFilter){var ae=w({count:n.length});K=C.onFilter({inputValue:f,resultsMessage:ae})}return K},[n,f,m,C,y,w,k]),E=(t==null?void 0:t.action)==="initial-input-focus",U=P.useMemo(function(){var K="";if(C.guidance){var ae=r?"value":m?"menu":"input";K=C.guidance({"aria-label":_,context:ae,isDisabled:s&&g(s,o),isMulti:p,isSearchable:b,tabSelectsValue:x,isInitialFocus:E})}return K},[_,s,r,p,g,b,m,C,o,x,E]),re=Ee(P.Fragment,null,Ee("span",{id:"aria-selection"},W),Ee("span",{id:"aria-focused"},z),Ee("span",{id:"aria-results"},te),Ee("span",{id:"aria-guidance"},U));return Ee(P.Fragment,null,Ee(GS,{id:u},E&&re),Ee(GS,{"aria-live":T,"aria-atomic":"false","aria-relevant":"additions text",role:"log"},a&&!E&&re))},d6=c6,em=[{base:"A",letters:"AⒶＡÀÁÂẦẤẪẨÃĀĂẰẮẴẲȦǠÄǞẢÅǺǍȀȂẠẬẶḀĄȺⱯ"},{base:"AA",letters:"Ꜳ"},{base:"AE",letters:"ÆǼǢ"},{base:"AO",letters:"Ꜵ"},{base:"AU",letters:"Ꜷ"},{base:"AV",letters:"ꜸꜺ"},{base:"AY",letters:"Ꜽ"},{base:"B",letters:"BⒷＢḂḄḆɃƂƁ"},{base:"C",letters:"CⒸＣĆĈĊČÇḈƇȻꜾ"},{base:"D",letters:"DⒹＤḊĎḌḐḒḎĐƋƊƉꝹ"},{base:"DZ",letters:"ǱǄ"},{base:"Dz",letters:"ǲǅ"},{base:"E",letters:"EⒺＥÈÉÊỀẾỄỂẼĒḔḖĔĖËẺĚȄȆẸỆȨḜĘḘḚƐƎ"},{base:"F",letters:"FⒻＦḞƑꝻ"},{base:"G",letters:"GⒼＧǴĜḠĞĠǦĢǤƓꞠꝽꝾ"},{base:"H",letters:"HⒽＨĤḢḦȞḤḨḪĦⱧⱵꞍ"},{base:"I",letters:"IⒾＩÌÍÎĨĪĬİÏḮỈǏȈȊỊĮḬƗ"},{base:"J",letters:"JⒿＪĴɈ"},{base:"K",letters:"KⓀＫḰǨḲĶḴƘⱩꝀꝂꝄꞢ"},{base:"L",letters:"LⓁＬĿĹĽḶḸĻḼḺŁȽⱢⱠꝈꝆꞀ"},{base:"LJ",letters:"Ǉ"},{base:"Lj",letters:"ǈ"},{base:"M",letters:"MⓂＭḾṀṂⱮƜ"},{base:"N",letters:"NⓃＮǸŃÑṄŇṆŅṊṈȠƝꞐꞤ"},{base:"NJ",letters:"Ǌ"},{base:"Nj",letters:"ǋ"},{base:"O",letters:"OⓄＯÒÓÔỒỐỖỔÕṌȬṎŌṐṒŎȮȰÖȪỎŐǑȌȎƠỜỚỠỞỢỌỘǪǬØǾƆƟꝊꝌ"},{base:"OI",letters:"Ƣ"},{base:"OO",letters:"Ꝏ"},{base:"OU",letters:"Ȣ"},{base:"P",letters:"PⓅＰṔṖƤⱣꝐꝒꝔ"},{base:"Q",letters:"QⓆＱꝖꝘɊ"},{base:"R",letters:"RⓇＲŔṘŘȐȒṚṜŖṞɌⱤꝚꞦꞂ"},{base:"S",letters:"SⓈＳẞŚṤŜṠŠṦṢṨȘŞⱾꞨꞄ"},{base:"T",letters:"TⓉＴṪŤṬȚŢṰṮŦƬƮȾꞆ"},{base:"TZ",letters:"Ꜩ"},{base:"U",letters:"UⓊＵÙÚÛŨṸŪṺŬÜǛǗǕǙỦŮŰǓȔȖƯỪỨỮỬỰỤṲŲṶṴɄ"},{base:"V",letters:"VⓋＶṼṾƲꝞɅ"},{base:"VY",letters:"Ꝡ"},{base:"W",letters:"WⓌＷẀẂŴẆẄẈⱲ"},{base:"X",letters:"XⓍＸẊẌ"},{base:"Y",letters:"YⓎＹỲÝŶỸȲẎŸỶỴƳɎỾ"},{base:"Z",letters:"ZⓏＺŹẐŻŽẒẔƵȤⱿⱫꝢ"},{base:"a",letters:"aⓐａẚàáâầấẫẩãāăằắẵẳȧǡäǟảåǻǎȁȃạậặḁąⱥɐ"},{base:"aa",letters:"ꜳ"},{base:"ae",letters:"æǽǣ"},{base:"ao",letters:"ꜵ"},{base:"au",letters:"ꜷ"},{base:"av",letters:"ꜹꜻ"},{base:"ay",letters:"ꜽ"},{base:"b",letters:"bⓑｂḃḅḇƀƃɓ"},{base:"c",letters:"cⓒｃćĉċčçḉƈȼꜿↄ"},{base:"d",letters:"dⓓｄḋďḍḑḓḏđƌɖɗꝺ"},{base:"dz",letters:"ǳǆ"},{base:"e",letters:"eⓔｅèéêềếễểẽēḕḗĕėëẻěȅȇẹệȩḝęḙḛɇɛǝ"},{base:"f",letters:"fⓕｆḟƒꝼ"},{base:"g",letters:"gⓖｇǵĝḡğġǧģǥɠꞡᵹꝿ"},{base:"h",letters:"hⓗｈĥḣḧȟḥḩḫẖħⱨⱶɥ"},{base:"hv",letters:"ƕ"},{base:"i",letters:"iⓘｉìíîĩīĭïḯỉǐȉȋịįḭɨı"},{base:"j",letters:"jⓙｊĵǰɉ"},{base:"k",letters:"kⓚｋḱǩḳķḵƙⱪꝁꝃꝅꞣ"},{base:"l",letters:"lⓛｌŀĺľḷḹļḽḻſłƚɫⱡꝉꞁꝇ"},{base:"lj",letters:"ǉ"},{base:"m",letters:"mⓜｍḿṁṃɱɯ"},{base:"n",letters:"nⓝｎǹńñṅňṇņṋṉƞɲŉꞑꞥ"},{base:"nj",letters:"ǌ"},{base:"o",letters:"oⓞｏòóôồốỗổõṍȭṏōṑṓŏȯȱöȫỏőǒȍȏơờớỡởợọộǫǭøǿɔꝋꝍɵ"},{base:"oi",letters:"ƣ"},{base:"ou",letters:"ȣ"},{base:"oo",letters:"ꝏ"},{base:"p",letters:"pⓟｐṕṗƥᵽꝑꝓꝕ"},{base:"q",letters:"qⓠｑɋꝗꝙ"},{base:"r",letters:"rⓡｒŕṙřȑȓṛṝŗṟɍɽꝛꞧꞃ"},{base:"s",letters:"sⓢｓßśṥŝṡšṧṣṩșşȿꞩꞅẛ"},{base:"t",letters:"tⓣｔṫẗťṭțţṱṯŧƭʈⱦꞇ"},{base:"tz",letters:"ꜩ"},{base:"u",letters:"uⓤｕùúûũṹūṻŭüǜǘǖǚủůűǔȕȗưừứữửựụṳųṷṵʉ"},{base:"v",letters:"vⓥｖṽṿʋꝟʌ"},{base:"vy",letters:"ꝡ"},{base:"w",letters:"wⓦｗẁẃŵẇẅẘẉⱳ"},{base:"x",letters:"xⓧｘẋẍ"},{base:"y",letters:"yⓨｙỳýŷỹȳẏÿỷẙỵƴɏỿ"},{base:"z",letters:"zⓩｚźẑżžẓẕƶȥɀⱬꝣ"}],f6=new RegExp("["+em.map(function(i){return i.letters}).join("")+"]","g"),BT={};for(var rp=0;rp<em.length;rp++)for(var np=em[rp],ap=0;ap<np.letters.length;ap++)BT[np.letters[ap]]=np.base;var CT=function(e){return e.replace(f6,function(t){return BT[t]})},p6=o6(CT),jS=function(e){return e.replace(/^\s+|\s+$/g,"")},g6=function(e){return"".concat(e.label," ").concat(e.value)},m6=function(e){return function(t,s){if(t.data.__isNew__)return!0;var r=De({ignoreCase:!0,ignoreAccents:!0,stringify:g6,trim:!0,matchFrom:"any"},e),n=r.ignoreCase,a=r.ignoreAccents,o=r.stringify,l=r.trim,u=r.matchFrom,h=l?jS(s):s,c=l?jS(o(t)):o(t);return n&&(h=h.toLowerCase(),c=c.toLowerCase()),a&&(h=p6(h),c=CT(c)),u==="start"?c.substr(0,h.length)===h:c.indexOf(h)>-1}},y6=["innerRef"];function b6(i){var e=i.innerRef,t=xn(i,y6),s=U3(t,"onExited","in","enter","exit","appear");return Ee("input",Ae({ref:e},s,{css:Nd({label:"dummyInput",background:0,border:0,caretColor:"transparent",fontSize:"inherit",gridArea:"1 / 1 / 2 / 3",outline:0,padding:0,width:1,color:"transparent",left:-100,opacity:0,position:"relative",transform:"scale(.01)"},"","")}))}var S6=function(e){e.cancelable&&e.preventDefault(),e.stopPropagation()};function w6(i){var e=i.isEnabled,t=i.onBottomArrive,s=i.onBottomLeave,r=i.onTopArrive,n=i.onTopLeave,a=P.useRef(!1),o=P.useRef(!1),l=P.useRef(0),u=P.useRef(null),h=P.useCallback(function(b,m){if(u.current!==null){var y=u.current,w=y.scrollTop,x=y.scrollHeight,k=y.clientHeight,_=u.current,T=m>0,C=x-k-w,W=!1;C>m&&a.current&&(s&&s(b),a.current=!1),T&&o.current&&(n&&n(b),o.current=!1),T&&m>C?(t&&!a.current&&t(b),_.scrollTop=x,W=!0,a.current=!0):!T&&-m>w&&(r&&!o.current&&r(b),_.scrollTop=0,W=!0,o.current=!0),W&&S6(b)}},[t,s,r,n]),c=P.useCallback(function(b){h(b,b.deltaY)},[h]),d=P.useCallback(function(b){l.current=b.changedTouches[0].clientY},[]),f=P.useCallback(function(b){var m=l.current-b.changedTouches[0].clientY;h(b,m)},[h]),p=P.useCallback(function(b){if(b){var m=W3?{passive:!1}:!1;b.addEventListener("wheel",c,m),b.addEventListener("touchstart",d,m),b.addEventListener("touchmove",f,m)}},[f,d,c]),g=P.useCallback(function(b){b&&(b.removeEventListener("wheel",c,!1),b.removeEventListener("touchstart",d,!1),b.removeEventListener("touchmove",f,!1))},[f,d,c]);return P.useEffect(function(){if(e){var b=u.current;return p(b),function(){g(b)}}},[e,p,g]),function(b){u.current=b}}var US=["boxSizing","height","overflow","paddingRight","position"],$S={boxSizing:"border-box",overflow:"hidden",position:"relative",height:"100%"};function YS(i){i.preventDefault()}function XS(i){i.stopPropagation()}function QS(){var i=this.scrollTop,e=this.scrollHeight,t=i+this.offsetHeight;i===0?this.scrollTop=1:t===e&&(this.scrollTop=i-1)}function JS(){return"ontouchstart"in window||navigator.maxTouchPoints}var qS=!!(typeof window<"u"&&window.document&&window.document.createElement),hl=0,qa={capture:!1,passive:!1};function v6(i){var e=i.isEnabled,t=i.accountForScrollbars,s=t===void 0?!0:t,r=P.useRef({}),n=P.useRef(null),a=P.useCallback(function(l){if(qS){var u=document.body,h=u&&u.style;if(s&&US.forEach(function(p){var g=h&&h[p];r.current[p]=g}),s&&hl<1){var c=parseInt(r.current.paddingRight,10)||0,d=document.body?document.body.clientWidth:0,f=window.innerWidth-d+c||0;Object.keys($S).forEach(function(p){var g=$S[p];h&&(h[p]=g)}),h&&(h.paddingRight="".concat(f,"px"))}u&&JS()&&(u.addEventListener("touchmove",YS,qa),l&&(l.addEventListener("touchstart",QS,qa),l.addEventListener("touchmove",XS,qa))),hl+=1}},[s]),o=P.useCallback(function(l){if(qS){var u=document.body,h=u&&u.style;hl=Math.max(hl-1,0),s&&hl<1&&US.forEach(function(c){var d=r.current[c];h&&(h[c]=d)}),u&&JS()&&(u.removeEventListener("touchmove",YS,qa),l&&(l.removeEventListener("touchstart",QS,qa),l.removeEventListener("touchmove",XS,qa)))}},[s]);return P.useEffect(function(){if(e){var l=n.current;return a(l),function(){o(l)}}},[e,a,o]),function(l){n.current=l}}var k6=function(e){var t=e.target;return t.ownerDocument.activeElement&&t.ownerDocument.activeElement.blur()},x6={name:"1kfdb0e",styles:"position:fixed;left:0;bottom:0;right:0;top:0"};function _6(i){var e=i.children,t=i.lockEnabled,s=i.captureEnabled,r=s===void 0?!0:s,n=i.onBottomArrive,a=i.onBottomLeave,o=i.onTopArrive,l=i.onTopLeave,u=w6({isEnabled:r,onBottomArrive:n,onBottomLeave:a,onTopArrive:o,onTopLeave:l}),h=v6({isEnabled:t}),c=function(f){u(f),h(f)};return Ee(P.Fragment,null,t&&Ee("div",{onClick:k6,css:x6}),e(c))}var T6={name:"1a0ro4n-requiredInput",styles:"label:requiredInput;opacity:0;pointer-events:none;position:absolute;bottom:0;left:0;right:0;width:100%"},N6=function(e){var t=e.name,s=e.onFocus;return Ee("input",{required:!0,name:t,tabIndex:-1,"aria-hidden":"true",onFocus:s,css:T6,value:"",onChange:function(){}})},B6=N6;function ay(i){var e;return typeof window<"u"&&window.navigator!=null?i.test(((e=window.navigator.userAgentData)===null||e===void 0?void 0:e.platform)||window.navigator.platform):!1}function C6(){return ay(/^iPhone/i)}function PT(){return ay(/^Mac/i)}function P6(){return ay(/^iPad/i)||PT()&&navigator.maxTouchPoints>1}function M6(){return C6()||P6()}function E6(){return PT()||M6()}var L6=function(e){return e.label},D6=function(e){return e.label},A6=function(e){return e.value},I6=function(e){return!!e.isDisabled},R6={clearIndicator:S5,container:l5,control:N5,dropdownIndicator:y5,group:M5,groupHeading:L5,indicatorsContainer:d5,indicatorSeparator:v5,input:R5,loadingIndicator:_5,loadingMessage:s5,menu:J3,menuList:e5,menuPortal:a5,multiValue:z5,multiValueLabel:W5,multiValueRemove:G5,noOptionsMessage:i5,option:Q5,placeholder:K5,singleValue:t6,valueContainer:h5},O6={primary:"#2684FF",primary75:"#4C9AFF",primary50:"#B2D4FF",primary25:"#DEEBFF",danger:"#DE350B",dangerLight:"#FFBDAD",neutral0:"hsl(0, 0%, 100%)",neutral5:"hsl(0, 0%, 95%)",neutral10:"hsl(0, 0%, 90%)",neutral20:"hsl(0, 0%, 80%)",neutral30:"hsl(0, 0%, 70%)",neutral40:"hsl(0, 0%, 60%)",neutral50:"hsl(0, 0%, 50%)",neutral60:"hsl(0, 0%, 40%)",neutral70:"hsl(0, 0%, 30%)",neutral80:"hsl(0, 0%, 20%)",neutral90:"hsl(0, 0%, 10%)"},F6=4,MT=4,V6=38,H6=MT*2,z6={baseUnit:MT,controlHeight:V6,menuGutter:H6},op={borderRadius:F6,colors:O6,spacing:z6},W6={"aria-live":"polite",backspaceRemovesValue:!0,blurInputOnSelect:HS(),captureMenuScroll:!HS(),classNames:{},closeMenuOnSelect:!0,closeMenuOnScroll:!1,components:{},controlShouldRenderValue:!0,escapeClearsValue:!1,filterOption:m6(),formatGroupLabel:L6,getOptionLabel:D6,getOptionValue:A6,isDisabled:!1,isLoading:!1,isMulti:!1,isRtl:!1,isSearchable:!0,isOptionDisabled:I6,loadingMessage:function(){return"Loading..."},maxMenuHeight:300,minMenuHeight:140,menuIsOpen:!1,menuPlacement:"bottom",menuPosition:"absolute",menuShouldBlockScroll:!1,menuShouldScrollIntoView:!H3(),noOptionsMessage:function(){return"No options"},openMenuOnFocus:!1,openMenuOnClick:!0,options:[],pageSize:5,placeholder:"Select...",screenReaderStatus:function(e){var t=e.count;return"".concat(t," result").concat(t!==1?"s":""," available")},styles:{},tabIndex:0,tabSelectsValue:!0,unstyled:!1};function KS(i,e,t,s){var r=DT(i,e,t),n=AT(i,e,t),a=LT(i,e),o=Yc(i,e);return{type:"option",data:e,isDisabled:r,isSelected:n,label:a,value:o,index:s}}function Uh(i,e){return i.options.map(function(t,s){if("options"in t){var r=t.options.map(function(a,o){return KS(i,a,e,o)}).filter(function(a){return ew(i,a)});return r.length>0?{type:"group",data:t,options:r,index:s}:void 0}var n=KS(i,t,e,s);return ew(i,n)?n:void 0}).filter(G3)}function ET(i){return i.reduce(function(e,t){return t.type==="group"?e.push.apply(e,ty(t.options.map(function(s){return s.data}))):e.push(t.data),e},[])}function ZS(i,e){return i.reduce(function(t,s){return s.type==="group"?t.push.apply(t,ty(s.options.map(function(r){return{data:r.data,id:"".concat(e,"-").concat(s.index,"-").concat(r.index)}}))):t.push({data:s.data,id:"".concat(e,"-").concat(s.index)}),t},[])}function G6(i,e){return ET(Uh(i,e))}function ew(i,e){var t=i.inputValue,s=t===void 0?"":t,r=e.data,n=e.isSelected,a=e.label,o=e.value;return(!RT(i)||!n)&&IT(i,{label:a,value:o,data:r},s)}function j6(i,e){var t=i.focusedValue,s=i.selectValue,r=s.indexOf(t);if(r>-1){var n=e.indexOf(t);if(n>-1)return t;if(r<e.length)return e[r]}return null}function U6(i,e){var t=i.focusedOption;return t&&e.indexOf(t)>-1?t:e[0]}var lp=function(e,t){var s,r=(s=e.find(function(n){return n.data===t}))===null||s===void 0?void 0:s.id;return r||null},LT=function(e,t){return e.getOptionLabel(t)},Yc=function(e,t){return e.getOptionValue(t)};function DT(i,e,t){return typeof i.isOptionDisabled=="function"?i.isOptionDisabled(e,t):!1}function AT(i,e,t){if(t.indexOf(e)>-1)return!0;if(typeof i.isOptionSelected=="function")return i.isOptionSelected(e,t);var s=Yc(i,e);return t.some(function(r){return Yc(i,r)===s})}function IT(i,e,t){return i.filterOption?i.filterOption(e,t):!0}var RT=function(e){var t=e.hideSelectedOptions,s=e.isMulti;return t===void 0?s:t},$6=1,OT=function(i){d3(t,i);var e=g3(t);function t(s){var r;if(h3(this,t),r=e.call(this,s),r.state={ariaSelection:null,focusedOption:null,focusedOptionId:null,focusableOptionsWithIds:[],focusedValue:null,inputIsHidden:!1,isFocused:!1,selectValue:[],clearFocusValueOnUpdate:!1,prevWasFocused:!1,inputIsHiddenAfterUpdate:void 0,prevProps:void 0,instancePrefix:""},r.blockOptionHover=!1,r.isComposing=!1,r.commonProps=void 0,r.initialTouchX=0,r.initialTouchY=0,r.openAfterFocus=!1,r.scrollToFocusedOptionOnUpdate=!1,r.userIsDragging=void 0,r.isAppleDevice=E6(),r.controlRef=null,r.getControlRef=function(l){r.controlRef=l},r.focusedOptionRef=null,r.getFocusedOptionRef=function(l){r.focusedOptionRef=l},r.menuListRef=null,r.getMenuListRef=function(l){r.menuListRef=l},r.inputRef=null,r.getInputRef=function(l){r.inputRef=l},r.focus=r.focusInput,r.blur=r.blurInput,r.onChange=function(l,u){var h=r.props,c=h.onChange,d=h.name;u.name=d,r.ariaOnChange(l,u),c(l,u)},r.setValue=function(l,u,h){var c=r.props,d=c.closeMenuOnSelect,f=c.isMulti,p=c.inputValue;r.onInputChange("",{action:"set-value",prevInputValue:p}),d&&(r.setState({inputIsHiddenAfterUpdate:!f}),r.onMenuClose()),r.setState({clearFocusValueOnUpdate:!0}),r.onChange(l,{action:u,option:h})},r.selectOption=function(l){var u=r.props,h=u.blurInputOnSelect,c=u.isMulti,d=u.name,f=r.state.selectValue,p=c&&r.isOptionSelected(l,f),g=r.isOptionDisabled(l,f);if(p){var b=r.getOptionValue(l);r.setValue(f.filter(function(m){return r.getOptionValue(m)!==b}),"deselect-option",l)}else if(!g)c?r.setValue([].concat(ty(f),[l]),"select-option",l):r.setValue(l,"select-option");else{r.ariaOnChange(l,{action:"select-option",option:l,name:d});return}h&&r.blurInput()},r.removeValue=function(l){var u=r.props.isMulti,h=r.state.selectValue,c=r.getOptionValue(l),d=h.filter(function(p){return r.getOptionValue(p)!==c}),f=vh(u,d,d[0]||null);r.onChange(f,{action:"remove-value",removedValue:l}),r.focusInput()},r.clearValue=function(){var l=r.state.selectValue;r.onChange(vh(r.props.isMulti,[],null),{action:"clear",removedValues:l})},r.popValue=function(){var l=r.props.isMulti,u=r.state.selectValue,h=u[u.length-1],c=u.slice(0,u.length-1),d=vh(l,c,c[0]||null);r.onChange(d,{action:"pop-value",removedValue:h})},r.getFocusedOptionId=function(l){return lp(r.state.focusableOptionsWithIds,l)},r.getFocusableOptionsWithIds=function(){return ZS(Uh(r.props,r.state.selectValue),r.getElementId("option"))},r.getValue=function(){return r.state.selectValue},r.cx=function(){for(var l=arguments.length,u=new Array(l),h=0;h<l;h++)u[h]=arguments[h];return I3.apply(void 0,[r.props.classNamePrefix].concat(u))},r.getOptionLabel=function(l){return LT(r.props,l)},r.getOptionValue=function(l){return Yc(r.props,l)},r.getStyles=function(l,u){var h=r.props.unstyled,c=R6[l](u,h);c.boxSizing="border-box";var d=r.props.styles[l];return d?d(c,u):c},r.getClassNames=function(l,u){var h,c;return(h=(c=r.props.classNames)[l])===null||h===void 0?void 0:h.call(c,u)},r.getElementId=function(l){return"".concat(r.state.instancePrefix,"-").concat(l)},r.getComponents=function(){return r6(r.props)},r.buildCategorizedOptions=function(){return Uh(r.props,r.state.selectValue)},r.getCategorizedOptions=function(){return r.props.menuIsOpen?r.buildCategorizedOptions():[]},r.buildFocusableOptions=function(){return ET(r.buildCategorizedOptions())},r.getFocusableOptions=function(){return r.props.menuIsOpen?r.buildFocusableOptions():[]},r.ariaOnChange=function(l,u){r.setState({ariaSelection:De({value:l},u)})},r.onMenuMouseDown=function(l){l.button===0&&(l.stopPropagation(),l.preventDefault(),r.focusInput())},r.onMenuMouseMove=function(l){r.blockOptionHover=!1},r.onControlMouseDown=function(l){if(!l.defaultPrevented){var u=r.props.openMenuOnClick;r.state.isFocused?r.props.menuIsOpen?l.target.tagName!=="INPUT"&&l.target.tagName!=="TEXTAREA"&&r.onMenuClose():u&&r.openMenu("first"):(u&&(r.openAfterFocus=!0),r.focusInput()),l.target.tagName!=="INPUT"&&l.target.tagName!=="TEXTAREA"&&l.preventDefault()}},r.onDropdownIndicatorMouseDown=function(l){if(!(l&&l.type==="mousedown"&&l.button!==0)&&!r.props.isDisabled){var u=r.props,h=u.isMulti,c=u.menuIsOpen;r.focusInput(),c?(r.setState({inputIsHiddenAfterUpdate:!h}),r.onMenuClose()):r.openMenu("first"),l.preventDefault()}},r.onClearIndicatorMouseDown=function(l){l&&l.type==="mousedown"&&l.button!==0||(r.clearValue(),l.preventDefault(),r.openAfterFocus=!1,l.type==="touchend"?r.focusInput():setTimeout(function(){return r.focusInput()}))},r.onScroll=function(l){typeof r.props.closeMenuOnScroll=="boolean"?l.target instanceof HTMLElement&&Gd(l.target)&&r.props.onMenuClose():typeof r.props.closeMenuOnScroll=="function"&&r.props.closeMenuOnScroll(l)&&r.props.onMenuClose()},r.onCompositionStart=function(){r.isComposing=!0},r.onCompositionEnd=function(){r.isComposing=!1},r.onTouchStart=function(l){var u=l.touches,h=u&&u.item(0);h&&(r.initialTouchX=h.clientX,r.initialTouchY=h.clientY,r.userIsDragging=!1)},r.onTouchMove=function(l){var u=l.touches,h=u&&u.item(0);if(h){var c=Math.abs(h.clientX-r.initialTouchX),d=Math.abs(h.clientY-r.initialTouchY),f=5;r.userIsDragging=c>f||d>f}},r.onTouchEnd=function(l){r.userIsDragging||(r.controlRef&&!r.controlRef.contains(l.target)&&r.menuListRef&&!r.menuListRef.contains(l.target)&&r.blurInput(),r.initialTouchX=0,r.initialTouchY=0)},r.onControlTouchEnd=function(l){r.userIsDragging||r.onControlMouseDown(l)},r.onClearIndicatorTouchEnd=function(l){r.userIsDragging||r.onClearIndicatorMouseDown(l)},r.onDropdownIndicatorTouchEnd=function(l){r.userIsDragging||r.onDropdownIndicatorMouseDown(l)},r.handleInputChange=function(l){var u=r.props.inputValue,h=l.currentTarget.value;r.setState({inputIsHiddenAfterUpdate:!1}),r.onInputChange(h,{action:"input-change",prevInputValue:u}),r.props.menuIsOpen||r.onMenuOpen()},r.onInputFocus=function(l){r.props.onFocus&&r.props.onFocus(l),r.setState({inputIsHiddenAfterUpdate:!1,isFocused:!0}),(r.openAfterFocus||r.props.openMenuOnFocus)&&r.openMenu("first"),r.openAfterFocus=!1},r.onInputBlur=function(l){var u=r.props.inputValue;if(r.menuListRef&&r.menuListRef.contains(document.activeElement)){r.inputRef.focus();return}r.props.onBlur&&r.props.onBlur(l),r.onInputChange("",{action:"input-blur",prevInputValue:u}),r.onMenuClose(),r.setState({focusedValue:null,isFocused:!1})},r.onOptionHover=function(l){if(!(r.blockOptionHover||r.state.focusedOption===l)){var u=r.getFocusableOptions(),h=u.indexOf(l);r.setState({focusedOption:l,focusedOptionId:h>-1?r.getFocusedOptionId(l):null})}},r.shouldHideSelectedOptions=function(){return RT(r.props)},r.onValueInputFocus=function(l){l.preventDefault(),l.stopPropagation(),r.focus()},r.onKeyDown=function(l){var u=r.props,h=u.isMulti,c=u.backspaceRemovesValue,d=u.escapeClearsValue,f=u.inputValue,p=u.isClearable,g=u.isDisabled,b=u.menuIsOpen,m=u.onKeyDown,y=u.tabSelectsValue,w=u.openMenuOnFocus,x=r.state,k=x.focusedOption,_=x.focusedValue,T=x.selectValue;if(!g&&!(typeof m=="function"&&(m(l),l.defaultPrevented))){switch(r.blockOptionHover=!0,l.key){case"ArrowLeft":if(!h||f)return;r.focusValue("previous");break;case"ArrowRight":if(!h||f)return;r.focusValue("next");break;case"Delete":case"Backspace":if(f)return;if(_)r.removeValue(_);else{if(!c)return;h?r.popValue():p&&r.clearValue()}break;case"Tab":if(r.isComposing||l.shiftKey||!b||!y||!k||w&&r.isOptionSelected(k,T))return;r.selectOption(k);break;case"Enter":if(l.keyCode===229)break;if(b){if(!k||r.isComposing)return;r.selectOption(k);break}return;case"Escape":b?(r.setState({inputIsHiddenAfterUpdate:!1}),r.onInputChange("",{action:"menu-close",prevInputValue:f}),r.onMenuClose()):p&&d&&r.clearValue();break;case" ":if(f)return;if(!b){r.openMenu("first");break}if(!k)return;r.selectOption(k);break;case"ArrowUp":b?r.focusOption("up"):r.openMenu("last");break;case"ArrowDown":b?r.focusOption("down"):r.openMenu("first");break;case"PageUp":if(!b)return;r.focusOption("pageup");break;case"PageDown":if(!b)return;r.focusOption("pagedown");break;case"Home":if(!b)return;r.focusOption("first");break;case"End":if(!b)return;r.focusOption("last");break;default:return}l.preventDefault()}},r.state.instancePrefix="react-select-"+(r.props.instanceId||++$6),r.state.selectValue=FS(s.value),s.menuIsOpen&&r.state.selectValue.length){var n=r.getFocusableOptionsWithIds(),a=r.buildFocusableOptions(),o=a.indexOf(r.state.selectValue[0]);r.state.focusableOptionsWithIds=n,r.state.focusedOption=a[o],r.state.focusedOptionId=lp(n,a[o])}return r}return c3(t,[{key:"componentDidMount",value:function(){this.startListeningComposition(),this.startListeningToTouch(),this.props.closeMenuOnScroll&&document&&document.addEventListener&&document.addEventListener("scroll",this.onScroll,!0),this.props.autoFocus&&this.focusInput(),this.props.menuIsOpen&&this.state.focusedOption&&this.menuListRef&&this.focusedOptionRef&&VS(this.menuListRef,this.focusedOptionRef)}},{key:"componentDidUpdate",value:function(r){var n=this.props,a=n.isDisabled,o=n.menuIsOpen,l=this.state.isFocused;(l&&!a&&r.isDisabled||l&&o&&!r.menuIsOpen)&&this.focusInput(),l&&a&&!r.isDisabled?this.setState({isFocused:!1},this.onMenuClose):!l&&!a&&r.isDisabled&&this.inputRef===document.activeElement&&this.setState({isFocused:!0}),this.menuListRef&&this.focusedOptionRef&&this.scrollToFocusedOptionOnUpdate&&(VS(this.menuListRef,this.focusedOptionRef),this.scrollToFocusedOptionOnUpdate=!1)}},{key:"componentWillUnmount",value:function(){this.stopListeningComposition(),this.stopListeningToTouch(),document.removeEventListener("scroll",this.onScroll,!0)}},{key:"onMenuOpen",value:function(){this.props.onMenuOpen()}},{key:"onMenuClose",value:function(){this.onInputChange("",{action:"menu-close",prevInputValue:this.props.inputValue}),this.props.onMenuClose()}},{key:"onInputChange",value:function(r,n){this.props.onInputChange(r,n)}},{key:"focusInput",value:function(){this.inputRef&&this.inputRef.focus()}},{key:"blurInput",value:function(){this.inputRef&&this.inputRef.blur()}},{key:"openMenu",value:function(r){var n=this,a=this.state,o=a.selectValue,l=a.isFocused,u=this.buildFocusableOptions(),h=r==="first"?0:u.length-1;if(!this.props.isMulti){var c=u.indexOf(o[0]);c>-1&&(h=c)}this.scrollToFocusedOptionOnUpdate=!(l&&this.menuListRef),this.setState({inputIsHiddenAfterUpdate:!1,focusedValue:null,focusedOption:u[h],focusedOptionId:this.getFocusedOptionId(u[h])},function(){return n.onMenuOpen()})}},{key:"focusValue",value:function(r){var n=this.state,a=n.selectValue,o=n.focusedValue;if(this.props.isMulti){this.setState({focusedOption:null});var l=a.indexOf(o);o||(l=-1);var u=a.length-1,h=-1;if(a.length){switch(r){case"previous":l===0?h=0:l===-1?h=u:h=l-1;break;case"next":l>-1&&l<u&&(h=l+1);break}this.setState({inputIsHidden:h!==-1,focusedValue:a[h]})}}}},{key:"focusOption",value:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"first",n=this.props.pageSize,a=this.state.focusedOption,o=this.getFocusableOptions();if(o.length){var l=0,u=o.indexOf(a);a||(u=-1),r==="up"?l=u>0?u-1:o.length-1:r==="down"?l=(u+1)%o.length:r==="pageup"?(l=u-n,l<0&&(l=0)):r==="pagedown"?(l=u+n,l>o.length-1&&(l=o.length-1)):r==="last"&&(l=o.length-1),this.scrollToFocusedOptionOnUpdate=!0,this.setState({focusedOption:o[l],focusedValue:null,focusedOptionId:this.getFocusedOptionId(o[l])})}}},{key:"getTheme",value:function(){return this.props.theme?typeof this.props.theme=="function"?this.props.theme(op):De(De({},op),this.props.theme):op}},{key:"getCommonProps",value:function(){var r=this.clearValue,n=this.cx,a=this.getStyles,o=this.getClassNames,l=this.getValue,u=this.selectOption,h=this.setValue,c=this.props,d=c.isMulti,f=c.isRtl,p=c.options,g=this.hasValue();return{clearValue:r,cx:n,getStyles:a,getClassNames:o,getValue:l,hasValue:g,isMulti:d,isRtl:f,options:p,selectOption:u,selectProps:c,setValue:h,theme:this.getTheme()}}},{key:"hasValue",value:function(){var r=this.state.selectValue;return r.length>0}},{key:"hasOptions",value:function(){return!!this.getFocusableOptions().length}},{key:"isClearable",value:function(){var r=this.props,n=r.isClearable,a=r.isMulti;return n===void 0?a:n}},{key:"isOptionDisabled",value:function(r,n){return DT(this.props,r,n)}},{key:"isOptionSelected",value:function(r,n){return AT(this.props,r,n)}},{key:"filterOption",value:function(r,n){return IT(this.props,r,n)}},{key:"formatOptionLabel",value:function(r,n){if(typeof this.props.formatOptionLabel=="function"){var a=this.props.inputValue,o=this.state.selectValue;return this.props.formatOptionLabel(r,{context:n,inputValue:a,selectValue:o})}else return this.getOptionLabel(r)}},{key:"formatGroupLabel",value:function(r){return this.props.formatGroupLabel(r)}},{key:"startListeningComposition",value:function(){document&&document.addEventListener&&(document.addEventListener("compositionstart",this.onCompositionStart,!1),document.addEventListener("compositionend",this.onCompositionEnd,!1))}},{key:"stopListeningComposition",value:function(){document&&document.removeEventListener&&(document.removeEventListener("compositionstart",this.onCompositionStart),document.removeEventListener("compositionend",this.onCompositionEnd))}},{key:"startListeningToTouch",value:function(){document&&document.addEventListener&&(document.addEventListener("touchstart",this.onTouchStart,!1),document.addEventListener("touchmove",this.onTouchMove,!1),document.addEventListener("touchend",this.onTouchEnd,!1))}},{key:"stopListeningToTouch",value:function(){document&&document.removeEventListener&&(document.removeEventListener("touchstart",this.onTouchStart),document.removeEventListener("touchmove",this.onTouchMove),document.removeEventListener("touchend",this.onTouchEnd))}},{key:"renderInput",value:function(){var r=this.props,n=r.isDisabled,a=r.isSearchable,o=r.inputId,l=r.inputValue,u=r.tabIndex,h=r.form,c=r.menuIsOpen,d=r.required,f=this.getComponents(),p=f.Input,g=this.state,b=g.inputIsHidden,m=g.ariaSelection,y=this.commonProps,w=o||this.getElementId("input"),x=De(De(De({"aria-autocomplete":"list","aria-expanded":c,"aria-haspopup":!0,"aria-errormessage":this.props["aria-errormessage"],"aria-invalid":this.props["aria-invalid"],"aria-label":this.props["aria-label"],"aria-labelledby":this.props["aria-labelledby"],"aria-required":d,role:"combobox","aria-activedescendant":this.isAppleDevice?void 0:this.state.focusedOptionId||""},c&&{"aria-controls":this.getElementId("listbox")}),!a&&{"aria-readonly":!0}),this.hasValue()?(m==null?void 0:m.action)==="initial-input-focus"&&{"aria-describedby":this.getElementId("live-region")}:{"aria-describedby":this.getElementId("placeholder")});return a?P.createElement(p,Ae({},y,{autoCapitalize:"none",autoComplete:"off",autoCorrect:"off",id:w,innerRef:this.getInputRef,isDisabled:n,isHidden:b,onBlur:this.onInputBlur,onChange:this.handleInputChange,onFocus:this.onInputFocus,spellCheck:"false",tabIndex:u,form:h,type:"text",value:l},x)):P.createElement(b6,Ae({id:w,innerRef:this.getInputRef,onBlur:this.onInputBlur,onChange:Uc,onFocus:this.onInputFocus,disabled:n,tabIndex:u,inputMode:"none",form:h,value:""},x))}},{key:"renderPlaceholderOrValue",value:function(){var r=this,n=this.getComponents(),a=n.MultiValue,o=n.MultiValueContainer,l=n.MultiValueLabel,u=n.MultiValueRemove,h=n.SingleValue,c=n.Placeholder,d=this.commonProps,f=this.props,p=f.controlShouldRenderValue,g=f.isDisabled,b=f.isMulti,m=f.inputValue,y=f.placeholder,w=this.state,x=w.selectValue,k=w.focusedValue,_=w.isFocused;if(!this.hasValue()||!p)return m?null:P.createElement(c,Ae({},d,{key:"placeholder",isDisabled:g,isFocused:_,innerProps:{id:this.getElementId("placeholder")}}),y);if(b)return x.map(function(C,W){var z=C===k,te="".concat(r.getOptionLabel(C),"-").concat(r.getOptionValue(C));return P.createElement(a,Ae({},d,{components:{Container:o,Label:l,Remove:u},isFocused:z,isDisabled:g,key:te,index:W,removeProps:{onClick:function(){return r.removeValue(C)},onTouchEnd:function(){return r.removeValue(C)},onMouseDown:function(U){U.preventDefault()}},data:C}),r.formatOptionLabel(C,"value"))});if(m)return null;var T=x[0];return P.createElement(h,Ae({},d,{data:T,isDisabled:g}),this.formatOptionLabel(T,"value"))}},{key:"renderClearIndicator",value:function(){var r=this.getComponents(),n=r.ClearIndicator,a=this.commonProps,o=this.props,l=o.isDisabled,u=o.isLoading,h=this.state.isFocused;if(!this.isClearable()||!n||l||!this.hasValue()||u)return null;var c={onMouseDown:this.onClearIndicatorMouseDown,onTouchEnd:this.onClearIndicatorTouchEnd,"aria-hidden":"true"};return P.createElement(n,Ae({},a,{innerProps:c,isFocused:h}))}},{key:"renderLoadingIndicator",value:function(){var r=this.getComponents(),n=r.LoadingIndicator,a=this.commonProps,o=this.props,l=o.isDisabled,u=o.isLoading,h=this.state.isFocused;if(!n||!u)return null;var c={"aria-hidden":"true"};return P.createElement(n,Ae({},a,{innerProps:c,isDisabled:l,isFocused:h}))}},{key:"renderIndicatorSeparator",value:function(){var r=this.getComponents(),n=r.DropdownIndicator,a=r.IndicatorSeparator;if(!n||!a)return null;var o=this.commonProps,l=this.props.isDisabled,u=this.state.isFocused;return P.createElement(a,Ae({},o,{isDisabled:l,isFocused:u}))}},{key:"renderDropdownIndicator",value:function(){var r=this.getComponents(),n=r.DropdownIndicator;if(!n)return null;var a=this.commonProps,o=this.props.isDisabled,l=this.state.isFocused,u={onMouseDown:this.onDropdownIndicatorMouseDown,onTouchEnd:this.onDropdownIndicatorTouchEnd,"aria-hidden":"true"};return P.createElement(n,Ae({},a,{innerProps:u,isDisabled:o,isFocused:l}))}},{key:"renderMenu",value:function(){var r=this,n=this.getComponents(),a=n.Group,o=n.GroupHeading,l=n.Menu,u=n.MenuList,h=n.MenuPortal,c=n.LoadingMessage,d=n.NoOptionsMessage,f=n.Option,p=this.commonProps,g=this.state.focusedOption,b=this.props,m=b.captureMenuScroll,y=b.inputValue,w=b.isLoading,x=b.loadingMessage,k=b.minMenuHeight,_=b.maxMenuHeight,T=b.menuIsOpen,C=b.menuPlacement,W=b.menuPosition,z=b.menuPortalTarget,te=b.menuShouldBlockScroll,E=b.menuShouldScrollIntoView,U=b.noOptionsMessage,re=b.onMenuScrollToTop,K=b.onMenuScrollToBottom;if(!T)return null;var ae=function(ze,Ye){var Ie=ze.type,it=ze.data,Pt=ze.isDisabled,$i=ze.isSelected,Fs=ze.label,kr=ze.value,ja=g===it,Ii=Pt?void 0:function(){return r.onOptionHover(it)},xr=Pt?void 0:function(){return r.selectOption(it)},$u="".concat(r.getElementId("option"),"-").concat(Ye),_n={id:$u,onClick:xr,onMouseMove:Ii,onMouseOver:Ii,tabIndex:-1,role:"option","aria-selected":r.isAppleDevice?void 0:$i};return P.createElement(f,Ae({},p,{innerProps:_n,data:it,isDisabled:Pt,isSelected:$i,key:$u,label:Fs,type:Ie,value:kr,isFocused:ja,innerRef:ja?r.getFocusedOptionRef:void 0}),r.formatOptionLabel(ze.data,"menu"))},ie;if(this.hasOptions())ie=this.getCategorizedOptions().map(function(oe){if(oe.type==="group"){var ze=oe.data,Ye=oe.options,Ie=oe.index,it="".concat(r.getElementId("group"),"-").concat(Ie),Pt="".concat(it,"-heading");return P.createElement(a,Ae({},p,{key:it,data:ze,options:Ye,Heading:o,headingProps:{id:Pt,data:oe.data},label:r.formatGroupLabel(oe.data)}),oe.options.map(function($i){return ae($i,"".concat(Ie,"-").concat($i.index))}))}else if(oe.type==="option")return ae(oe,"".concat(oe.index))});else if(w){var A=x({inputValue:y});if(A===null)return null;ie=P.createElement(c,p,A)}else{var Y=U({inputValue:y});if(Y===null)return null;ie=P.createElement(d,p,Y)}var le={minMenuHeight:k,maxMenuHeight:_,menuPlacement:C,menuPosition:W,menuShouldScrollIntoView:E},pe=P.createElement(q3,Ae({},p,le),function(oe){var ze=oe.ref,Ye=oe.placerProps,Ie=Ye.placement,it=Ye.maxHeight;return P.createElement(l,Ae({},p,le,{innerRef:ze,innerProps:{onMouseDown:r.onMenuMouseDown,onMouseMove:r.onMenuMouseMove},isLoading:w,placement:Ie}),P.createElement(_6,{captureEnabled:m,onTopArrive:re,onBottomArrive:K,lockEnabled:te},function(Pt){return P.createElement(u,Ae({},p,{innerRef:function(Fs){r.getMenuListRef(Fs),Pt(Fs)},innerProps:{role:"listbox","aria-multiselectable":p.isMulti,id:r.getElementId("listbox")},isLoading:w,maxHeight:it,focusedOption:g}),ie)}))});return z||W==="fixed"?P.createElement(h,Ae({},p,{appendTo:z,controlElement:this.controlRef,menuPlacement:C,menuPosition:W}),pe):pe}},{key:"renderFormField",value:function(){var r=this,n=this.props,a=n.delimiter,o=n.isDisabled,l=n.isMulti,u=n.name,h=n.required,c=this.state.selectValue;if(h&&!this.hasValue()&&!o)return P.createElement(B6,{name:u,onFocus:this.onValueInputFocus});if(!(!u||o))if(l)if(a){var d=c.map(function(g){return r.getOptionValue(g)}).join(a);return P.createElement("input",{name:u,type:"hidden",value:d})}else{var f=c.length>0?c.map(function(g,b){return P.createElement("input",{key:"i-".concat(b),name:u,type:"hidden",value:r.getOptionValue(g)})}):P.createElement("input",{name:u,type:"hidden",value:""});return P.createElement("div",null,f)}else{var p=c[0]?this.getOptionValue(c[0]):"";return P.createElement("input",{name:u,type:"hidden",value:p})}}},{key:"renderLiveRegion",value:function(){var r=this.commonProps,n=this.state,a=n.ariaSelection,o=n.focusedOption,l=n.focusedValue,u=n.isFocused,h=n.selectValue,c=this.getFocusableOptions();return P.createElement(d6,Ae({},r,{id:this.getElementId("live-region"),ariaSelection:a,focusedOption:o,focusedValue:l,isFocused:u,selectValue:h,focusableOptions:c,isAppleDevice:this.isAppleDevice}))}},{key:"render",value:function(){var r=this.getComponents(),n=r.Control,a=r.IndicatorsContainer,o=r.SelectContainer,l=r.ValueContainer,u=this.props,h=u.className,c=u.id,d=u.isDisabled,f=u.menuIsOpen,p=this.state.isFocused,g=this.commonProps=this.getCommonProps();return P.createElement(o,Ae({},g,{className:h,innerProps:{id:c,onKeyDown:this.onKeyDown},isDisabled:d,isFocused:p}),this.renderLiveRegion(),P.createElement(n,Ae({},g,{innerRef:this.getControlRef,innerProps:{onMouseDown:this.onControlMouseDown,onTouchEnd:this.onControlTouchEnd},isDisabled:d,isFocused:p,menuIsOpen:f}),P.createElement(l,Ae({},g,{isDisabled:d}),this.renderPlaceholderOrValue(),this.renderInput()),P.createElement(a,Ae({},g,{isDisabled:d}),this.renderClearIndicator(),this.renderLoadingIndicator(),this.renderIndicatorSeparator(),this.renderDropdownIndicator())),this.renderMenu(),this.renderFormField())}}],[{key:"getDerivedStateFromProps",value:function(r,n){var a=n.prevProps,o=n.clearFocusValueOnUpdate,l=n.inputIsHiddenAfterUpdate,u=n.ariaSelection,h=n.isFocused,c=n.prevWasFocused,d=n.instancePrefix,f=r.options,p=r.value,g=r.menuIsOpen,b=r.inputValue,m=r.isMulti,y=FS(p),w={};if(a&&(p!==a.value||f!==a.options||g!==a.menuIsOpen||b!==a.inputValue)){var x=g?G6(r,y):[],k=g?ZS(Uh(r,y),"".concat(d,"-option")):[],_=o?j6(n,y):null,T=U6(n,x),C=lp(k,T);w={selectValue:y,focusedOption:T,focusedOptionId:C,focusableOptionsWithIds:k,focusedValue:_,clearFocusValueOnUpdate:!1}}var W=l!=null&&r!==a?{inputIsHidden:l,inputIsHiddenAfterUpdate:void 0}:{},z=u,te=h&&c;return h&&!te&&(z={value:vh(m,y,y[0]||null),options:y,action:"initial-input-focus"},te=!c),(u==null?void 0:u.action)==="initial-input-focus"&&(z=null),De(De(De({},w),W),{},{prevProps:r,ariaSelection:z,prevWasFocused:te})}}]),t}(P.Component);OT.defaultProps=W6;var Y6=P.forwardRef(function(i,e){var t=u3(i);return P.createElement(OT,Ae({ref:e},t))}),Jo=Y6;const X6={input:()=>J6,singleValue:()=>q6,container:()=>Q6,menuList:()=>K6,valueContainer:()=>Z6,indicatorsContainer:()=>e8,dropdownIndicator:()=>t8,placeholder:()=>i8,control:()=>s8,menu:()=>o8,option:({isSelected:i,isFocused:e})=>X({[r8]:!0,[a8]:e,[n8]:i})},Q6=X(Ot,B`
    && {
      width: 100%;
    }
  `),J6=X(Ot,B`
    && {
      padding: 0px;
    }
  `),q6=X(Ot,B`
    && {
      overflow: visible;
    }
  `),K6=X(Ot,B`
    && {
      background-color: #00000010;
    }
  `),Z6=B`
  && {
    padding-right: 0px;
    margin-right: 0px;
    padding-left: 0px;
    margin-left: 0px;
  }
`,e8=B`
  && {
    padding-left: 0px;
    margin-left: 0px;
  }
`,t8=B`
  && {
    padding-left: 0px;
    margin-left: 0px;
  }
`,i8=X(Ot,B`
    && {
    }
  `),s8=B`
  && {
    border-width: 0px;
    box-shadow: none;
    padding: 3px 6px;
    border-radius: 6px;
    background-color: transparent;

    &:hover {
      background-color: transparent;
    }

    &:focus {
      background-color: transparent;
    }
  }
`,r8=B`
  && {
    color: #000000;
    background-color: transparent;

    &:active {
      background-color: #00000030;
    }
  }
`,n8=B`
  && {
    background-color: #00000015;
  }
`,a8=B`
  && {
    background-color: #00000020;
  }
`,o8=B`
  && {
    min-width: 60px;
  }
`,FT=B`
  width: 24px;
  height: 18px;
`,VT=X(FT,B`
    background-image: url('${o_}');
  `),HT=X(FT,B`
    background-image: url('${a_}');
  `),zT=B`
  display: flex;
  flex-direction: row;
  align-items: center;
  gap: 10px;
`,l8=X(zT,B`
    padding: 10px 3px;
  `),u8=({children:i,...e})=>{const{value:t,label:s}=e.getValue()[0];return v.jsx(Ga.SingleValue,{...e,children:v.jsxs("div",{className:l8,children:[v.jsx("div",{className:t===Fr.English?VT:HT}),s]})})},h8=({children:i,...e})=>{const{value:t,label:s}=e.data;return v.jsx(Ga.Option,{...e,children:v.jsxs("div",{className:zT,children:[v.jsx("div",{className:t===Fr.English?VT:HT}),s]})})},c8={IndicatorSeparator:()=>null,SingleValue:u8,Option:h8},d8=X(Ot,B`
    display: flex;
    flex-direction: row;
    align-items: center;
    color: #000000cc;
    border-bottom: 1px solid #ccc;
  `),up=[{label:"English",value:Fr.English},{label:"Magyar",value:Fr.Hungarian}],f8=()=>{const{language:i,setLanguage:e}=vr(),t=up.find(({value:r})=>r===i)??up[0],s=r=>{ee(r)||e(r.value)};return v.jsx("div",{className:d8,children:v.jsx(Jo,{inputId:"language-picker",menuPosition:"fixed",isSearchable:!1,value:t,options:up,classNames:X6,components:c8,onChange:s})})},p8=B`
  display: flex;
  flex-direction: column;
`,g8=({isOpen:i,buttons:e,pages:t,onClose:s,onClick:r,onButtonClick:n})=>{const{t:a}=Yt();return v.jsx(oT,{title:a("Settings.Settings"),isOpen:i,buttons:e,onClose:s,onClick:n,children:v.jsxs("div",{className:p8,children:[v.jsx(f8,{}),v.jsx(OF,{pages:t,onClick:r}),v.jsx(i3,{})]})})},m8=()=>v.jsx(v.Fragment,{}),y8=({page:i,issues:e,config:t,onChange:s,onBack:r})=>{const n=!ee(i),a=(i==null?void 0:i.name)??"",o=ee(i)?m8:i.Component;return v.jsx(oT,{title:a,isOpen:n,onBack:r,children:v.jsx(o,{issues:e,onChange:s,onClose:Et,value:t})})};function zu(i){const{t:e,i18n:t}=Yt();return P.useMemo(()=>i(e,t.language),[e,t.language,i])}function jd(i,e){const{t,i18n:s}=Yt();return P.useMemo(()=>i(t,s.language,e),[t,e,s.language,i])}function b8(i,e){return ee(e.bars)?[{id:void 0,type:qt.ERROR,label:i("Validation.EmptyBars")}]:e.bars<=0?[{id:void 0,type:qt.ERROR,label:i("Validation.ZeroBars")}]:zr}function S8(i,e){return ee(e.tempo)?[{id:void 0,type:qt.ERROR,label:i("Validation.EmptyTempo")}]:e.tempo<10||e.tempo>400?[{id:void 0,type:qt.ERROR,label:i("Validation.WrongBpm")}]:zr}function w8(i,e){if(e.notes.length===0)return[{id:void 0,type:qt.ERROR,label:i("Validation.EmptyNotes")}];const t=Eu(`${e.keySignature} major`).notes;return e.notes.some(r=>t.some(n=>Fo(n,r)))?zr:[{id:void 0,type:qt.ERROR,label:i("Validation.NoScaleNotes",{scale:e.keySignature,scaleNotes:t.join(", ")})}]}const tw=[1,2,4,8],iw=1,sw=30;function v8(i,e,t){const{timeSignature:s}=t;if(!ey(s)){const o=[];return ee(s.lower)&&o.push({id:"lower",type:qt.ERROR,label:i("Validation.EmptyTimeSignatureLower")}),ee(s.upper)&&o.push({id:"upper",type:qt.ERROR,label:i("Validation.EmptyTimeSignatureUpper")}),o}const{lower:r,upper:n}=s,a=[];if(!tw.includes(r)){const o=new Intl.ListFormat(e,{style:"short",type:"disjunction"});a.push({id:"lower",type:qt.ERROR,label:i("Validation.TimeSignatureLower",{lower:o.format(tw.map(l=>l.toString()))})})}return(n<iw||n>sw)&&a.push({id:"upper",type:qt.ERROR,label:i("Validation.TimeSignatureUpper",{min:iw,max:sw})}),a}const k8=B`
  font-family: 'Bravura';
  font-size: 28px;
  line-height: 28px;
  pointer-events: none;
  letter-spacing: 5px;
  position: relative;
`,gi=({children:i,top:e})=>v.jsx("span",{className:k8,style:{top:e},children:i}),WT=String.fromCodePoint(57506),GT=String.fromCodePoint(119134),jT=String.fromCodePoint(119135),UT=String.fromCodePoint(119136),$T=String.fromCodePoint(119137),Wu=String.fromCodePoint(59680),ta=10,x8=()=>v.jsx(gi,{children:WT}),_8=()=>v.jsx(gi,{top:ta,children:GT}),T8=()=>v.jsx(gi,{top:ta,children:jT}),N8=()=>v.jsx(gi,{top:ta,children:UT}),B8=()=>v.jsx(gi,{top:ta,children:$T}),C8=()=>v.jsxs(gi,{children:[WT,Wu]}),P8=()=>v.jsxs(gi,{top:ta,children:[GT,Wu]}),M8=()=>v.jsxs(gi,{top:ta,children:[jT,Wu]}),E8=()=>v.jsxs(gi,{top:ta,children:[UT,Wu]}),L8=()=>v.jsxs(gi,{top:ta,children:[$T,Wu]}),YT="",XT="",QT="",JT="",qT="",Gu=String.fromCodePoint(59680),D8=()=>v.jsx(gi,{children:YT}),A8=()=>v.jsx(gi,{children:XT}),I8=()=>v.jsx(gi,{children:QT}),R8=()=>v.jsx(gi,{children:JT}),O8=()=>v.jsx(gi,{children:qT}),F8=()=>v.jsxs(gi,{children:[YT,Gu]}),V8=()=>v.jsxs(gi,{children:[XT,Gu]}),H8=()=>v.jsxs(gi,{children:[QT,Gu]}),z8=()=>v.jsxs(gi,{children:[JT,Gu]}),W8=()=>v.jsxs(gi,{children:[qT,Gu]}),G8=(i={},e)=>t=>{const s={...i};for(const{isSelected:r,duration:n,cluster:a,frequency:o}of t)r?s[n]={cluster:a??1,frequency:o}:delete s[n];e(s)},j8={[ne.WHOLE]:x8,[ne.DOTTED_WHOLE]:C8,[ne.HALF]:_8,[ne.DOTTED_HALF]:P8,[ne.QUARTER]:T8,[ne.DOTTED_QUARTER]:M8,[ne.EIGHTH]:N8,[ne.DOTTED_EIGHT]:E8,[ne.SIXTEENTH]:B8,[ne.DOTTED_SIXTEENTH]:L8},U8={[ne.WHOLE]:D8,[ne.DOTTED_WHOLE]:F8,[ne.HALF]:A8,[ne.DOTTED_HALF]:V8,[ne.QUARTER]:I8,[ne.DOTTED_QUARTER]:H8,[ne.EIGHTH]:R8,[ne.DOTTED_EIGHT]:z8,[ne.SIXTEENTH]:O8,[ne.DOTTED_SIXTEENTH]:W8};function $8(i,e){const t=wi[e],s=i.div(t).valueOf();return s<1?0:Math.floor(s)}function KT(i,e,t,s=!0){const r=t(`DurationTypes.${i}`),a=`${t(`Durations.${e}`)} ${r}`;return s?Bx(a):a}function Y8(i,e,t,s,r){const{cluster:n,frequency:a}=t[e]??{},o=i==="NOTE"?j8:U8,l=new bi(s.upper??0,s.lower??1);return{type:i,duration:e,cluster:n,timeSignature:s,Component:o[e],name:KT(i,e,r),isSelected:!ee(n),isEnabled:wi[e].lte(l),frequency:a??Bt.MODERATE,maxCluster:$8(l,e)}}const X8=Object.keys(wi).sort((i,e)=>wi[e].sub(wi[i]).valueOf()),Q8=(i,e,t)=>(s,r,n)=>X8.filter(a=>Dd(a)===e).map(a=>Y8(i,a,n,t,s)),Xc=Object.keys(wi),J8=Xc.filter(oL(Dd)),q8=Xc.filter(Dd),hp=new bi(0,1);function K8(i,e,t){const s=wi[t];if(i.mod(s).equals(hp))return;const r=Xc.filter(a=>{const o=wi[a],l=s.add(o);return i.mod(l).equals(hp)}).flatMap(a=>Xc.filter(o=>{const l=wi[a],u=wi[o];return l.mod(u).equals(hp)}));if(r.length===0)return{cause:t,solutions:[]};if(r.some(a=>e.includes(a)))return;const n=Array.from(r).sort((a,o)=>wi[o].compare(wi[a]));return{cause:t,solutions:n}}function Z8({upper:i,lower:e},t,s){const r=new bi(i,e),n=[];for(const a of t){const o=K8(r,t,a);ee(o)||s.some(l=>o.solutions.includes(l))&&n.push(o)}return n}function rw(i){return Object.keys(i).filter(t=>!ee(i[t]))}function e7(i,e,t,s){const{timeSignature:r,noteDurations:n,restDurations:a}=t;if(!ey(r))return zr;const o=[...rw(n),...rw(a)].sort((h,c)=>wi[c].compare(wi[h]));if(o.length===0)return zr;const u=Z8(r,o,s?q8:J8);return u.length===0?zr:u.map(h=>{if(h.solutions.length===0)throw new Error("Should not get here!");const c=new Intl.ListFormat(e,{style:"short",type:"disjunction"}),d=h.solutions.map(f=>i(`Durations.${f}`));return{id:h.cause,type:qt.ERROR,label:i("Validation.DottedRhytms",{dotted:i(`Durations.${h.cause}`),required:c.format(d)})}})}function nw({noteDurations:i,restDurations:e},t,s){const r=s===void 0?{...i,...e}:s===pi.NOTE?i:e;return Object.entries(r).filter(([a,o])=>!ee(o)&&(ee(t)||Dd(a)===t)).map(([a])=>a).sort((a,o)=>wi[o].sub(wi[a]).valueOf())}function t7(i,e,t,s,r){const{timeSignature:n}=t;if(!ey(n))return zr;const a=new bi(n.upper,n.lower),o=`${n.upper}/${n.lower}`;return r===pi.NOTE&&nw(t,void 0,r).filter(c=>wi[c].lte(a)).length===0?[{id:void 0,label:i("Validation.EmptyDurations",{timeSignature:o}),type:qt.ERROR}]:nw(t,s,r).filter(u=>wi[u].gt(a)).map(u=>({id:u,label:i("Validation.DurationLongerThanBar",{duration:KT(r,u,i,!1),timeSignature:o}),type:qt.WARNING}))}const Ud=(i,e)=>(t,s,r)=>[...t7(t,s,r,e,i),...e7(t,s,r,e)],i7=Ud(pi.NOTE,!1),s7=Ud(pi.REST,!1),r7=Ud(pi.NOTE,!0),n7=Ud(pi.REST,!0);function a7(i,e,t){return{bars:b8(i,t),bpm:S8(i,t),timeSignature:v8(i,e,t),notes:w8(i,t),noteDurations:i7(i,e,t),restDurations:s7(i,e,t),dottedNoteDurations:r7(i,e,t),dottedRestDurations:n7(i,e,t),clef:ul(),keySignature:ul(),showChordsStaff:ul(),showChordSymbols:ul(),useSeventhChords:ul()}}function ZT(i){return jd(a7,i)}function o7(i,e,t){const s=Object.values(t).flatMap(r=>r).filter(r=>(r==null?void 0:r.type)==="error");return[{id:"save",label:i("Settings.Save"),icon:OD,enabled:s.length===0}]}function eN(i){return jd(o7,i)}const Aa=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],ju=[0,1,2,3,4,5,6,7,8];function l7(i){const e={};for(const t of Aa){const s=[];for(const r of ju){const n=`${t}${r}`,a=Oa(n);s[r]=i.includes(n)||i.includes(a)}e[t]=s}return e}function u7(i){const e=[];for(const t of ju){let s=!0;e:for(const r of Aa)if(s=s&&i[r][t],!s)break e;e[t]=s}return e}function h7(i){const e={};for(const t of Aa)e[t]=i[t].every(s=>s);return e}function cp(i){const e=[];for(const t of ju)for(const s of Aa)if(i[s][t]){const n=`${s}${t}`;e.push(n)}return e}function c7(i,e,t){const s=Array.from(i[e]);return s[t]=!s[t],{...i,[e]:s}}function d7(i,e,t){const s=!e[t],r={};for(const n of Aa){const a=[];for(const o of ju)a[o]=i[n][o],o===t&&(a[o]=s);r[n]=a}return r}function f7(i,e,t){const s=!e[t],r=i[t].map(()=>s);return{...i,[t]:r}}const p7=B`
  border-spacing: 0;
  border-collapse: collapse;
  overflow: hidden;
  table-layout: fixed;
  width: 100%;
`,oy=X(Zs,B`
    font-weight: 400;
    text-align: center;
    padding: 6px;
    cursor: pointer;
    position: relative;
    overflow: hidden;
    height: 38px;
    border: 1px solid #00000030;
    background-color: #00000010;
    @media ${ws} {
      padding: 2px;
    }
    &:hover {
      background-color: #00000020 !important;
    }
  `),tN=B`
  border-bottom-color: #00000050;
`,g7=B`
  border-right-color: #00000050;
`,iN=X(Iu,B`
    padding: 6px;
    text-align: center;
    cursor: pointer;
    position: relative;
    border: 1px solid #00000030;
    &:hover {
      background-color: #00000050 !important;
    }

    @media ${ws} {
      padding: 2px;
    }
  `),Uu=B`
  background-color: #000000aa !important;
  color: #ffffff;
  &:hover {
    background-color: #000000cc !important;
  }
`,sN=B`
  position: absolute;
  top: 1px;
  left: 3px;
`,rN=B`
  position: absolute;
  bottom: 1px;
  right: 3px;
`;B`
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  clip-path: polygon(
    calc(100% + 1px) -1px,
    calc(100% - 1px) 0px,
    0px calc(100% + 1px),
    1px calc(100% + 1px)
  );
  background-color: #00000050;
`;const nN=B`
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  clip-path: polygon(100% 0px, 0px 100%, 0px 0px);
  background-color: #00000020;
`,m7=({isSelected:i,note:e,octave:t,language:s,onClick:r})=>{const n=X(iN,i?Uu:void 0),a=Oa(e),o=()=>{r(e,t)};return a===e?v.jsxs("td",{className:n,onClick:o,children:[qi(e,s),t]}):v.jsxs("td",{className:n,onClick:o,children:[v.jsx("div",{className:nN}),v.jsxs("span",{className:sN,children:[qi(e,s),t]}),v.jsxs("span",{className:rN,children:[qi(a,s),t]})]})},y7=({isSelected:i,note:e,octave:t,language:s,accidental:r,onClick:n})=>{const a=X(iN,i?Uu:void 0),l=fn(e).acc===r?e:Oa(e),u=()=>{n(e,t)};return v.jsxs("td",{className:a,onClick:u,children:[qi(l,s),t]})},b7=({isSelected:i,note:e,language:t,onClick:s})=>{const r=X({[oy]:!0,[tN]:!0,[Uu]:i}),n=Oa(e),a=()=>s(e);return n===e?v.jsx("th",{className:r,onClick:a,children:qi(e,t)}):v.jsxs("th",{className:r,onClick:a,children:[v.jsx("div",{className:nN}),v.jsx("span",{className:sN,children:qi(e,t)}),v.jsx("span",{className:rN,children:qi(n,t)})]})},S7=({isSelected:i,note:e,language:t,accidental:s,onClick:r})=>{const n=X({[oy]:!0,[tN]:!0,[Uu]:i}),o=fn(e).acc===s?e:Oa(e),l=()=>r(e);return v.jsx("th",{className:n,onClick:l,children:qi(o,t)})},w7=({isSelected:i,octave:e,onClick:t})=>{const s=X({[oy]:!0,[g7]:!0,[Uu]:i}),r=()=>t(e);return v.jsx("th",{className:s,onClick:r,children:e})},v7=({onChange:i,keySignature:e,value:t})=>{const{i18n:s}=Yt(),r=Du(),n=s.language,a=P.useMemo(()=>l7(t),[t]),o=P.useMemo(()=>u7(a),[a]),l=P.useMemo(()=>h7(a),[a]),u=uL(e),h=r?y7:m7,c=r?S7:b7,d=(g,b)=>{i(cp(c7(a,g,b)))},f=g=>{i(cp(f7(a,l,g)))},p=g=>{i(cp(d7(a,o,g)))};return v.jsxs("table",{className:p7,children:[v.jsx("thead",{children:v.jsxs("tr",{children:[v.jsx("th",{}),Aa.map(g=>{const b=l[g];return v.jsx(c,{language:n,accidental:u,isSelected:b,note:g,onClick:f},`note-header-${g}`)})]})}),v.jsx("tbody",{children:ju.map(g=>{const b=o[g];return v.jsxs("tr",{children:[v.jsx(w7,{octave:g,isSelected:b,onClick:p}),Aa.map(m=>{const y=a[m][g];return v.jsx(h,{accidental:u,language:n,isSelected:y,note:m,octave:g,onClick:d},`note-${m}${g}`)})]},`note-row-${g}`)})})]})},Bi={input:()=>k7,singleValue:()=>x7,menuList:()=>_7,valueContainer:()=>T7,indicatorsContainer:()=>N7,dropdownIndicator:()=>B7,placeholder:()=>C7,control:()=>P7,menu:()=>D7,option:({isSelected:i,isFocused:e})=>X({[M7]:!0,[L7]:e,[E7]:i})},k7=X(Ot,B`
    && {
      padding: 0px;
    }
  `),x7=X(Ot,B`
    && {
      overflow: visible;
    }
  `),_7=X(Ot,B`
    && {
      background-color: #00000010;
    }
  `),T7=B`
  && {
    padding-right: 0px;
    margin-right: 0px;
  }
`,N7=B`
  && {
    padding-left: 0px;
    margin-left: 0px;
  }
`,B7=B`
  && {
    padding-left: 0px;
    margin-left: 0px;
  }
`,C7=X(Ot,B`
    && {
    }
  `),P7=B`
  && {
    border-width: 0px;
    box-shadow: none;
    padding: 3px 6px;
    border-radius: 6px;
    background-color: #00000010;

    &:hover {
      background-color: #00000015;
    }

    &:focus {
      background-color: #00000020;
    }
  }
`,M7=B`
  && {
    color: #000000;
    background-color: transparent;

    &:active {
      background-color: #00000030;
    }
  }
`,E7=B`
  && {
    background-color: #00000015;
  }
`,L7=B`
  && {
    background-color: #00000020;
  }
`,D7=B`
  && {
    min-width: 60px;
  }
`,A7={IndicatorSeparator:()=>null};function tm(i,e){const t=_o(i,ZE(e));return t.includes("b")?Oa(t):t}function I7(i,e,t=4){const s=tm(i[0],e),r=tm(i[i.length-1],e+t-1);return Lu([s,r],{sharps:!0})}function R7(i,e){const t=new Set;for(const s of i)for(let r=0;r<=e;r+=1)t.add(tm(s,r));return Array.from(t).sort(w0)}function O7(i,e,t){const s=i.map(r=>Ba(r)).map(r=>qi(r,t));return{label:e("PresetNames.Unfretted",{notes:s.join(", ")}),value:i.map(r=>qi(r,t))}}function Tr(i,e,t,s){const r=I7(i,e);return{label:t("PresetNames.Position",{position:e,lowest:qi(r[0],s),highest:qi(r[r.length-1],s)}),value:r}}function aw(i,e,t,s){const r=R7(i,e);return{label:t("PresetNames.ToNthFret",{fret:e,lowest:qi(r[0],s),highest:qi(r[r.length-1],s)}),value:r}}const F7=["E2","A2","D3","G3","B3","E4"],V7=["B1","E2","A2","D3","G3","B3","E4"],H7=["E1","A1","D2","G2"],z7=["B0","E1","A1","D2","G2"];function kh(i,e,t,s){return{label:t(i),options:[O7(e,t,s),Tr(e,0,t,s),Tr(e,1,t,s),Tr(e,2,t,s),Tr(e,3,t,s),Tr(e,4,t,s),Tr(e,5,t,s),Tr(e,6,t,s),Tr(e,7,t,s),Tr(e,8,t,s),Tr(e,9,t,s),aw(e,12,t,s),aw(e,24,t,s)]}}function W7(i,e){return[kh("Instruments.SixStringGuitar",F7,i,e),kh("Instruments.SevenStringGuitar",V7,i,e),kh("Instruments.FourStringBass",H7,i,e),kh("Instruments.FiveStringBass",z7,i,e)]}function G7(){return zu(W7)}const j7=B`
  display: flex;
  flex-direction: row;
`,U7=X(Ot,B`
    && {
      flex-shrink: 0;
      border-radius: 0px 6px 6px 0px;
      height: auto;
      background-color: #00000010;
      color: #000;
      border-left: 1px solid #00000020;
      &:hover {
        color: #000;
        background-color: #00000020;
      }
    }
  `),$7=X(Ot,B`
    && {
      white-space: nowrap;
    }
  `),Y7=B`
  && {
    border-bottom-right-radius: 0px;
    border-top-right-radius: 0px;
  }
`,X7=B`
  && {
    overflow: hidden;
  }
`,Q7=B`
  && {
    flex: 1;
  }
`,J7={...Bi,control:i=>{var e;return X((e=Bi==null?void 0:Bi.control)==null?void 0:e.call(Bi,i),Y7)},singleValue:i=>{var e;return X((e=Bi==null?void 0:Bi.singleValue)==null?void 0:e.call(Bi,i),X7)},container:()=>Q7,placeholder:()=>$7},q7=({value:i,keySignature:e,onChange:t})=>{const{t:s}=Yt(),r=G7(),n=P.useMemo(()=>r.flatMap(u=>u.options),[r]),a=P.useMemo(()=>n.find(({value:u})=>aL(u,i))??null,[i,n]),o=u=>{ee(u)||t(u.value)},l=()=>{const u=Eu(`${e} major`).notes,h=i.filter(c=>u.some(d=>Fo(d,c)));t(h)};return v.jsxs("div",{className:j7,children:[v.jsx(Jo,{inputId:"note-preset-picker",value:a,options:r,classNames:J7,placeholder:s("NotePresets.Custom"),components:A7,onChange:o}),v.jsxs(ma,{onClick:l,className:U7,children:[v.jsx(B0,{}),s("Settings.ScaleOnly")]})]})},K7=({value:i,issues:e,onChange:t})=>{const{t:s}=Yt(),r=n=>t({...i,notes:n});return v.jsxs(v.Fragment,{children:[v.jsxs(Mi,{children:[v.jsx(Ei,{children:s("Settings.NotesPreset")}),v.jsx(is,{issues:zr,children:s("Settings.NotesPresetDescription")}),v.jsx(q7,{value:i.notes,keySignature:i.keySignature,onChange:r})]}),v.jsxs(Mi,{children:[v.jsx(Ei,{children:s("Settings.Notes")}),v.jsx(is,{issues:e.notes,children:s("Settings.NotesDescription")}),v.jsx(v7,{value:i.notes,keySignature:i.keySignature,onChange:r})]})]})};function Z7(i,e,t,s,r){const n=Q8(i,e,s),a=jd(n,t),o=G8(t,r);return[a,o]}var ly={},uy={},hy={},qo={};Object.defineProperty(qo,"__esModule",{value:!0});qo.Direction=void 0;var ow;(function(i){i.Right="to right",i.Left="to left",i.Down="to bottom",i.Up="to top"})(ow||(qo.Direction=ow={}));(function(i){var e=ys&&ys.__spreadArray||function(E,U,re){if(re||arguments.length===2)for(var K=0,ae=U.length,ie;K<ae;K++)(ie||!(K in U))&&(ie||(ie=Array.prototype.slice.call(U,0,K)),ie[K]=U[K]);return E.concat(ie||Array.prototype.slice.call(U))};Object.defineProperty(i,"__esModule",{value:!0}),i.isIOS=i.useThumbOverlap=i.assertUnreachable=i.voidFn=i.getTrackBackground=i.replaceAt=i.schd=i.translate=i.getClosestThumbIndex=i.translateThumbs=i.getPaddingAndBorder=i.getMargin=i.checkInitialOverlap=i.checkValuesAgainstBoundaries=i.checkBoundaries=i.isVertical=i.relativeValue=i.normalizeValue=i.isStepDivisible=i.isTouchEvent=i.getStepDecimals=void 0;var t=P,s=qo,r=function(E){var U=E.toString().split(".")[1];return U?U.length:0};i.getStepDecimals=r;function n(E){return E.touches&&E.touches.length||E.changedTouches&&E.changedTouches.length}i.isTouchEvent=n;function a(E,U,re){var K=(U-E)/re,ae=8,ie=Number(K.toFixed(ae));return parseInt(ie.toString(),10)===ie}i.isStepDivisible=a;function o(E,U,re,K,ae,ie,A){var Y=1e11;if(E=Math.round(E*Y)/Y,!ie){var le=A[U-1],pe=A[U+1];if(le&&le>E)return le;if(pe&&pe<E)return pe}if(E>K)return K;if(E<re)return re;var oe=Math.floor(E*Y-re*Y)%Math.floor(ae*Y),ze=Math.floor(E*Y-Math.abs(oe)),Ye=oe===0?E:ze/Y,Ie=Math.abs(oe/Y)<ae/2?Ye:Ye+ae,it=(0,i.getStepDecimals)(ae);return parseFloat(Ie.toFixed(it))}i.normalizeValue=o;function l(E,U,re){return(E-U)/(re-U)}i.relativeValue=l;function u(E){return E===s.Direction.Up||E===s.Direction.Down}i.isVertical=u;function h(E,U,re){if(U>=re)throw new RangeError("min (".concat(U,") is equal/bigger than max (").concat(re,")"));if(E<U)throw new RangeError("value (".concat(E,") is smaller than min (").concat(U,")"));if(E>re)throw new RangeError("value (".concat(E,") is bigger than max (").concat(re,")"))}i.checkBoundaries=h;function c(E,U,re){return E<U?U:E>re?re:E}i.checkValuesAgainstBoundaries=c;function d(E){if(!(E.length<2)&&!E.slice(1).every(function(U,re){return E[re]<=U}))throw new RangeError("values={[".concat(E,"]} needs to be sorted when allowOverlap={false}"))}i.checkInitialOverlap=d;function f(E){var U=window.getComputedStyle(E);return{top:parseInt(U["margin-top"],10),bottom:parseInt(U["margin-bottom"],10),left:parseInt(U["margin-left"],10),right:parseInt(U["margin-right"],10)}}i.getMargin=f;function p(E){var U=window.getComputedStyle(E);return{top:parseInt(U["padding-top"],10)+parseInt(U["border-top-width"],10),bottom:parseInt(U["padding-bottom"],10)+parseInt(U["border-bottom-width"],10),left:parseInt(U["padding-left"],10)+parseInt(U["border-left-width"],10),right:parseInt(U["padding-right"],10)+parseInt(U["border-right-width"],10)}}i.getPaddingAndBorder=p;function g(E,U,re){var K=re?-1:1;E.forEach(function(ae,ie){return m(ae,K*U[ie].x,U[ie].y)})}i.translateThumbs=g;function b(E,U,re,K){for(var ae=0,ie=z(E[0],U,re,K),A=1;A<E.length;A++){var Y=z(E[A],U,re,K);Y<ie&&(ie=Y,ae=A)}return ae}i.getClosestThumbIndex=b;function m(E,U,re){E.style.transform="translate(".concat(U,"px, ").concat(re,"px)")}i.translate=m;var y=function(E){var U=[],re=null,K=function(){for(var ae=[],ie=0;ie<arguments.length;ie++)ae[ie]=arguments[ie];U=ae,!re&&(re=requestAnimationFrame(function(){re=null,E.apply(void 0,U)}))};return K};i.schd=y;function w(E,U,re){var K=E.slice(0);return K[U]=re,K}i.replaceAt=w;function x(E){var U=E.values,re=E.colors,K=E.min,ae=E.max,ie=E.direction,A=ie===void 0?s.Direction.Right:ie,Y=E.rtl,le=Y===void 0?!1:Y;le&&A===s.Direction.Right?A=s.Direction.Left:le&&s.Direction.Left&&(A=s.Direction.Right);var pe=U.slice(0).sort(function(ze,Ye){return ze-Ye}).map(function(ze){return(ze-K)/(ae-K)*100}),oe=pe.reduce(function(ze,Ye,Ie){return"".concat(ze,", ").concat(re[Ie]," ").concat(Ye,"%, ").concat(re[Ie+1]," ").concat(Ye,"%")},"");return"linear-gradient(".concat(A,", ").concat(re[0]," 0%").concat(oe,", ").concat(re[re.length-1]," 100%)")}i.getTrackBackground=x;function k(){}i.voidFn=k;function _(E){throw new Error("Didn't expect to get here")}i.assertUnreachable=_;var T=function(E,U,re,K,ae){ae===void 0&&(ae=function(A){return A});var ie=Math.ceil(e([E],Array.from(E.children),!0).reduce(function(A,Y){var le=Math.ceil(Y.getBoundingClientRect().width);if(Y.innerText&&Y.innerText.includes(re)&&Y.childElementCount===0){var pe=Y.cloneNode(!0);pe.innerHTML=ae(U.toFixed(K)),pe.style.visibility="hidden",document.body.appendChild(pe),le=Math.ceil(pe.getBoundingClientRect().width),document.body.removeChild(pe)}return le>A?le:A},E.getBoundingClientRect().width));return ie},C=function(E,U,re,K,ae,ie,A){A===void 0&&(A=function(pe){return pe});var Y=[],le=function(pe){var oe=T(re[pe],K[pe],ae,ie,A),ze=U[pe].x;U.forEach(function(Ye,Ie){var it=Ye.x,Pt=T(re[Ie],K[Ie],ae,ie,A);pe!==Ie&&(ze>=it&&ze<=it+Pt||ze+oe>=it&&ze+oe<=it+Pt)&&(Y.includes(Ie)||(Y.push(pe),Y.push(Ie),Y=e(e([],Y,!0),[pe,Ie],!1),le(Ie)))})};return le(E),Array.from(new Set(Y.sort()))},W=function(E,U,re,K,ae,ie){K===void 0&&(K=.1),ae===void 0&&(ae=" - "),ie===void 0&&(ie=function(Ie){return Ie});var A=(0,i.getStepDecimals)(K),Y=(0,t.useState)({}),le=Y[0],pe=Y[1],oe=(0,t.useState)(ie(U[re].toFixed(A))),ze=oe[0],Ye=oe[1];return(0,t.useEffect)(function(){if(E){var Ie=E.getThumbs();if(Ie.length<1)return;var it={},Pt=E.getOffsets(),$i=C(re,Pt,Ie,U,ae,A,ie),Fs=ie(U[re].toFixed(A));if($i.length){var kr=$i.reduce(function(_n,cy,dy,fy){return _n.length?e(e([],_n,!0),[Pt[fy[dy]].x],!1):[Pt[fy[dy]].x]},[]);if(Math.min.apply(Math,kr)===Pt[re].x){var ja=[];$i.forEach(function(_n){ja.push(U[_n].toFixed(A))}),Fs=Array.from(new Set(ja.sort(function(_n,cy){return parseFloat(_n)-parseFloat(cy)}))).map(ie).join(ae);var Ii=Math.min.apply(Math,kr),xr=Math.max.apply(Math,kr),$u=Ie[$i[kr.indexOf(xr)]].getBoundingClientRect().width;it.left="".concat(Math.abs(Ii-(xr+$u))/2,"px"),it.transform="translate(-50%, 0)"}else it.visibility="hidden"}Ye(Fs),pe(it)}},[E,U]),[ze,le]};i.useThumbOverlap=W;function z(E,U,re,K){var ae=E.getBoundingClientRect(),ie=ae.left,A=ae.top,Y=ae.width,le=ae.height;return u(K)?Math.abs(re-(A+le/2)):Math.abs(U-(ie+Y/2))}var te=function(){var E,U=((E=navigator.userAgentData)===null||E===void 0?void 0:E.platform)||navigator.platform;return["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(U)||navigator.userAgent.includes("Mac")&&"ontouchend"in document};i.isIOS=te})(hy);var eV=ys&&ys.__extends||function(){var i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(s,r){s.__proto__=r}||function(s,r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(s[n]=r[n])},i(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(e,t);function s(){this.constructor=e}e.prototype=t===null?Object.create(t):(s.prototype=t.prototype,new s)}}(),tV=ys&&ys.__createBinding||(Object.create?function(i,e,t,s){s===void 0&&(s=t);var r=Object.getOwnPropertyDescriptor(e,t);(!r||("get"in r?!e.__esModule:r.writable||r.configurable))&&(r={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(i,s,r)}:function(i,e,t,s){s===void 0&&(s=t),i[s]=e[t]}),iV=ys&&ys.__setModuleDefault||(Object.create?function(i,e){Object.defineProperty(i,"default",{enumerable:!0,value:e})}:function(i,e){i.default=e}),sV=ys&&ys.__importStar||function(i){if(i&&i.__esModule)return i;var e={};if(i!=null)for(var t in i)t!=="default"&&Object.prototype.hasOwnProperty.call(i,t)&&tV(e,i,t);return iV(e,i),e},lw=ys&&ys.__spreadArray||function(i,e,t){if(t||arguments.length===2)for(var s=0,r=e.length,n;s<r;s++)(n||!(s in e))&&(n||(n=Array.prototype.slice.call(e,0,s)),n[s]=e[s]);return i.concat(n||Array.prototype.slice.call(e))};Object.defineProperty(uy,"__esModule",{value:!0});var xh=sV(P),rt=hy,mi=qo,rV=["ArrowRight","ArrowUp","k","PageUp"],nV=["ArrowLeft","ArrowDown","j","PageDown"],aV=function(i){eV(e,i);function e(t){var s=i.call(this,t)||this;if(s.trackRef=xh.createRef(),s.thumbRefs=[],s.state={draggedTrackPos:[-1,-1],draggedThumbIndex:-1,thumbZIndexes:new Array(s.props.values.length).fill(0).map(function(r,n){return n}),isChanged:!1,markOffsets:[]},s.getOffsets=function(){var r=s.props,n=r.direction,a=r.values,o=r.min,l=r.max,u=s.trackRef.current;if(!u)return console.warn("No track element found."),[];var h=u.getBoundingClientRect(),c=(0,rt.getPaddingAndBorder)(u);return s.getThumbs().map(function(d,f){var p={x:0,y:0},g=d.getBoundingClientRect(),b=(0,rt.getMargin)(d);switch(n){case mi.Direction.Right:return p.x=(b.left+c.left)*-1,p.y=((g.height-h.height)/2+c.top)*-1,p.x+=h.width*(0,rt.relativeValue)(a[f],o,l)-g.width/2,p;case mi.Direction.Left:return p.x=(b.right+c.right)*-1,p.y=((g.height-h.height)/2+c.top)*-1,p.x+=h.width-h.width*(0,rt.relativeValue)(a[f],o,l)-g.width/2,p;case mi.Direction.Up:return p.x=((g.width-h.width)/2+b.left+c.left)*-1,p.y=-c.left,p.y+=h.height-h.height*(0,rt.relativeValue)(a[f],o,l)-g.height/2,p;case mi.Direction.Down:return p.x=((g.width-h.width)/2+b.left+c.left)*-1,p.y=-c.left,p.y+=h.height*(0,rt.relativeValue)(a[f],o,l)-g.height/2,p;default:return(0,rt.assertUnreachable)(n)}})},s.getThumbs=function(){return s.trackRef&&s.trackRef.current?Array.from(s.trackRef.current.children).filter(function(r){return r.hasAttribute("aria-valuenow")}):(console.warn("No thumbs found in the track container. Did you forget to pass & spread the `props` param in renderTrack?"),[])},s.getTargetIndex=function(r){return s.getThumbs().findIndex(function(n){return n===r.target||n.contains(r.target)})},s.addTouchEvents=function(r){document.addEventListener("touchmove",s.schdOnTouchMove,{passive:!1}),document.addEventListener("touchend",s.schdOnEnd,{passive:!1}),document.addEventListener("touchcancel",s.schdOnEnd,{passive:!1})},s.addMouseEvents=function(r){document.addEventListener("mousemove",s.schdOnMouseMove),document.addEventListener("mouseup",s.schdOnEnd)},s.onMouseDownTrack=function(r){var n;if(!(r.button!==0||(0,rt.isIOS)()))if(r.persist(),r.preventDefault(),s.addMouseEvents(r.nativeEvent),s.props.values.length>1&&s.props.draggableTrack){if(s.thumbRefs.some(function(o){var l;return(l=o.current)===null||l===void 0?void 0:l.contains(r.target)}))return;s.setState({draggedTrackPos:[r.clientX,r.clientY]},function(){return s.onMove(r.clientX,r.clientY)})}else{var a=(0,rt.getClosestThumbIndex)(s.thumbRefs.map(function(o){return o.current}),r.clientX,r.clientY,s.props.direction);(n=s.thumbRefs[a].current)===null||n===void 0||n.focus(),s.setState({draggedThumbIndex:a},function(){return s.onMove(r.clientX,r.clientY)})}},s.onResize=function(){(0,rt.translateThumbs)(s.getThumbs(),s.getOffsets(),s.props.rtl),s.calculateMarkOffsets()},s.onTouchStartTrack=function(r){var n;if(r.persist(),s.addTouchEvents(r.nativeEvent),s.props.values.length>1&&s.props.draggableTrack){if(s.thumbRefs.some(function(o){var l;return(l=o.current)===null||l===void 0?void 0:l.contains(r.target)}))return;s.setState({draggedTrackPos:[r.touches[0].clientX,r.touches[0].clientY]},function(){return s.onMove(r.touches[0].clientX,r.touches[0].clientY)})}else{var a=(0,rt.getClosestThumbIndex)(s.thumbRefs.map(function(o){return o.current}),r.touches[0].clientX,r.touches[0].clientY,s.props.direction);(n=s.thumbRefs[a].current)===null||n===void 0||n.focus(),s.setState({draggedThumbIndex:a},function(){return s.onMove(r.touches[0].clientX,r.touches[0].clientY)})}},s.onMouseOrTouchStart=function(r){if(!s.props.disabled){var n=(0,rt.isTouchEvent)(r);if(!(!n&&r.button!==0)){var a=s.getTargetIndex(r);a!==-1&&(n?s.addTouchEvents(r):s.addMouseEvents(r),s.setState({draggedThumbIndex:a,thumbZIndexes:s.state.thumbZIndexes.map(function(o,l){return l===a?Math.max.apply(Math,s.state.thumbZIndexes):o<=s.state.thumbZIndexes[a]?o:o-1})}))}}},s.onMouseMove=function(r){r.preventDefault(),s.onMove(r.clientX,r.clientY)},s.onTouchMove=function(r){r.preventDefault(),s.onMove(r.touches[0].clientX,r.touches[0].clientY)},s.onKeyDown=function(r){var n=s.props,a=n.values,o=n.onChange,l=n.step,u=n.rtl,h=n.direction,c=s.state.isChanged,d=s.getTargetIndex(r.nativeEvent),f=u||h===mi.Direction.Left||h===mi.Direction.Down?-1:1;d!==-1&&(rV.includes(r.key)?(r.preventDefault(),s.setState({draggedThumbIndex:d,isChanged:!0}),o((0,rt.replaceAt)(a,d,s.normalizeValue(a[d]+f*(r.key==="PageUp"?l*10:l),d)))):nV.includes(r.key)?(r.preventDefault(),s.setState({draggedThumbIndex:d,isChanged:!0}),o((0,rt.replaceAt)(a,d,s.normalizeValue(a[d]-f*(r.key==="PageDown"?l*10:l),d)))):r.key==="Tab"?s.setState({draggedThumbIndex:-1},function(){c&&s.fireOnFinalChange()}):c&&s.fireOnFinalChange())},s.onKeyUp=function(r){var n=s.state.isChanged;s.setState({draggedThumbIndex:-1},function(){n&&s.fireOnFinalChange()})},s.onMove=function(r,n){var a=s.state,o=a.draggedThumbIndex,l=a.draggedTrackPos,u=s.props,h=u.direction,c=u.min,d=u.max,f=u.onChange,p=u.values,g=u.step,b=u.rtl;if(o===-1&&l[0]===-1&&l[1]===-1)return null;var m=s.trackRef.current;if(!m)return null;var y=m.getBoundingClientRect(),w=(0,rt.isVertical)(h)?y.height:y.width;if(l[0]!==-1&&l[1]!==-1){var x=r-l[0],k=n-l[1],_=0;switch(h){case mi.Direction.Right:case mi.Direction.Left:_=x/w*(d-c);break;case mi.Direction.Down:case mi.Direction.Up:_=k/w*(d-c);break;default:(0,rt.assertUnreachable)(h)}if(b&&(_*=-1),Math.abs(_)>=g/2){for(var T=0;T<s.thumbRefs.length;T++){if(p[T]===d&&Math.sign(_)===1||p[T]===c&&Math.sign(_)===-1)return;var C=p[T]+_;C>d?_=d-p[T]:C<c&&(_=c-p[T])}for(var W=p.slice(0),T=0;T<s.thumbRefs.length;T++)W=(0,rt.replaceAt)(W,T,s.normalizeValue(p[T]+_,T));s.setState({draggedTrackPos:[r,n]}),f(W)}}else{var z=0;switch(h){case mi.Direction.Right:z=(r-y.left)/w*(d-c)+c;break;case mi.Direction.Left:z=(w-(r-y.left))/w*(d-c)+c;break;case mi.Direction.Down:z=(n-y.top)/w*(d-c)+c;break;case mi.Direction.Up:z=(w-(n-y.top))/w*(d-c)+c;break;default:(0,rt.assertUnreachable)(h)}b&&(z=d+c-z),Math.abs(p[o]-z)>=g/2&&f((0,rt.replaceAt)(p,o,s.normalizeValue(z,o)))}},s.normalizeValue=function(r,n){var a=s.props,o=a.min,l=a.max,u=a.step,h=a.allowOverlap,c=a.values;return(0,rt.normalizeValue)(r,n,o,l,u,h,c)},s.onEnd=function(r){if(r.preventDefault(),document.removeEventListener("mousemove",s.schdOnMouseMove),document.removeEventListener("touchmove",s.schdOnTouchMove),document.removeEventListener("mouseup",s.schdOnEnd),document.removeEventListener("touchend",s.schdOnEnd),document.removeEventListener("touchcancel",s.schdOnEnd),s.state.draggedThumbIndex===-1&&s.state.draggedTrackPos[0]===-1&&s.state.draggedTrackPos[1]===-1)return null;s.setState({draggedThumbIndex:-1,draggedTrackPos:[-1,-1]},function(){s.fireOnFinalChange()})},s.fireOnFinalChange=function(){s.setState({isChanged:!1});var r=s.props,n=r.onFinalChange,a=r.values;n&&n(a)},s.updateMarkRefs=function(r){if(!r.renderMark){s.numOfMarks=void 0,s.markRefs=void 0;return}s.numOfMarks=(r.max-r.min)/s.props.step,s.markRefs=[];for(var n=0;n<s.numOfMarks+1;n++)s.markRefs[n]=xh.createRef()},s.calculateMarkOffsets=function(){if(!(!s.props.renderMark||!s.trackRef||!s.numOfMarks||!s.markRefs||s.trackRef.current===null)){for(var r=window.getComputedStyle(s.trackRef.current),n=parseInt(r.width,10),a=parseInt(r.height,10),o=parseInt(r.paddingLeft,10),l=parseInt(r.paddingTop,10),u=[],h=0;h<s.numOfMarks+1;h++){var c=9999,d=9999;if(s.markRefs[h].current){var f=s.markRefs[h].current.getBoundingClientRect();c=f.height,d=f.width}s.props.direction===mi.Direction.Left||s.props.direction===mi.Direction.Right?u.push([Math.round(n/s.numOfMarks*h+o-d/2),-Math.round((c-a)/2)]):u.push([Math.round(a/s.numOfMarks*h+l-c/2),-Math.round((d-n)/2)])}s.setState({markOffsets:u})}},t.step===0)throw new Error('"step" property should be a positive number');return s.schdOnMouseMove=(0,rt.schd)(s.onMouseMove),s.schdOnTouchMove=(0,rt.schd)(s.onTouchMove),s.schdOnEnd=(0,rt.schd)(s.onEnd),s.thumbRefs=t.values.map(function(){return xh.createRef()}),s.updateMarkRefs(t),s}return e.prototype.componentDidMount=function(){var t=this,s=this.props,r=s.values,n=s.min,a=s.step;this.resizeObserver=window.ResizeObserver?new window.ResizeObserver(this.onResize):{observe:function(){return window.addEventListener("resize",t.onResize)},unobserve:function(){return window.removeEventListener("resize",t.onResize)}},document.addEventListener("touchstart",this.onMouseOrTouchStart,{passive:!1}),document.addEventListener("mousedown",this.onMouseOrTouchStart,{passive:!1}),!this.props.allowOverlap&&(0,rt.checkInitialOverlap)(this.props.values),this.props.values.forEach(function(o){return(0,rt.checkBoundaries)(o,t.props.min,t.props.max)}),this.resizeObserver.observe(this.trackRef.current),(0,rt.translateThumbs)(this.getThumbs(),this.getOffsets(),this.props.rtl),this.calculateMarkOffsets(),r.forEach(function(o){(0,rt.isStepDivisible)(n,o,a)||console.warn("The `values` property is in conflict with the current `step`, `min`, and `max` properties. Please provide values that are accessible using the min, max, and step values.")})},e.prototype.componentDidUpdate=function(t,s){var r=this.props,n=r.max,a=r.min,o=r.step,l=r.values,u=r.rtl;(t.max!==n||t.min!==a||t.step!==o)&&this.updateMarkRefs(this.props),(0,rt.translateThumbs)(this.getThumbs(),this.getOffsets(),u),(t.max!==n||t.min!==a||t.step!==o||s.markOffsets.length!==this.state.markOffsets.length)&&(this.calculateMarkOffsets(),l.forEach(function(h){(0,rt.isStepDivisible)(a,h,o)||console.warn("The `values` property is in conflict with the current `step`, `min`, and `max` properties. Please provide values that are accessible using the min, max, and step values.")}))},e.prototype.componentWillUnmount=function(){var t={passive:!1};document.removeEventListener("mousedown",this.onMouseOrTouchStart,t),document.removeEventListener("mousemove",this.schdOnMouseMove),document.removeEventListener("touchmove",this.schdOnTouchMove),document.removeEventListener("touchstart",this.onMouseOrTouchStart),document.removeEventListener("mouseup",this.schdOnEnd),document.removeEventListener("touchend",this.schdOnEnd),this.resizeObserver.unobserve(this.trackRef.current)},e.prototype.render=function(){var t=this,s=this.props,r=s.label,n=s.labelledBy,a=s.renderTrack,o=s.renderThumb,l=s.renderMark,u=l===void 0?function(){return null}:l,h=s.values,c=s.min,d=s.max,f=s.allowOverlap,p=s.disabled,g=this.state,b=g.draggedThumbIndex,m=g.thumbZIndexes,y=g.markOffsets;return a({props:{style:{transform:"scale(1)",cursor:b>-1?"grabbing":this.props.draggableTrack?(0,rt.isVertical)(this.props.direction)?"ns-resize":"ew-resize":h.length===1&&!p?"pointer":"inherit"},onMouseDown:p?rt.voidFn:this.onMouseDownTrack,onTouchStart:p?rt.voidFn:this.onTouchStartTrack,ref:this.trackRef},isDragged:this.state.draggedThumbIndex>-1,disabled:p,children:lw(lw([],y.map(function(w,x,k){return u({props:{style:t.props.direction===mi.Direction.Left||t.props.direction===mi.Direction.Right?{position:"absolute",left:"".concat(w[0],"px"),marginTop:"".concat(w[1],"px")}:{position:"absolute",top:"".concat(w[0],"px"),marginLeft:"".concat(w[1],"px")},key:"mark".concat(x),ref:t.markRefs[x]},index:x})}),!0),h.map(function(w,x){var k=t.state.draggedThumbIndex===x;return o({index:x,value:w,isDragged:k,props:{style:{position:"absolute",zIndex:m[x],cursor:p?"inherit":k?"grabbing":"grab",userSelect:"none",touchAction:"none",WebkitUserSelect:"none",MozUserSelect:"none",msUserSelect:"none"},key:x,tabIndex:p?void 0:0,"aria-valuemax":f?d:h[x+1]||d,"aria-valuemin":f?c:h[x-1]||c,"aria-valuenow":w,draggable:!1,ref:t.thumbRefs[x],"aria-label":r,"aria-labelledby":n,role:"slider",onKeyDown:p?rt.voidFn:t.onKeyDown,onKeyUp:p?rt.voidFn:t.onKeyUp}})}),!0)})},e.defaultProps={label:"Accessibility label",labelledBy:null,step:1,direction:mi.Direction.Right,rtl:!1,disabled:!1,allowOverlap:!1,draggableTrack:!1,min:0,max:100},e}(xh.Component);uy.default=aV;(function(i){var e=ys&&ys.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(i,"__esModule",{value:!0}),i.checkValuesAgainstBoundaries=i.relativeValue=i.useThumbOverlap=i.Direction=i.getTrackBackground=i.Range=void 0;var t=e(uy);i.Range=t.default;var s=hy;Object.defineProperty(i,"getTrackBackground",{enumerable:!0,get:function(){return s.getTrackBackground}}),Object.defineProperty(i,"useThumbOverlap",{enumerable:!0,get:function(){return s.useThumbOverlap}}),Object.defineProperty(i,"relativeValue",{enumerable:!0,get:function(){return s.relativeValue}}),Object.defineProperty(i,"checkValuesAgainstBoundaries",{enumerable:!0,get:function(){return s.checkValuesAgainstBoundaries}});var r=qo;Object.defineProperty(i,"Direction",{enumerable:!0,get:function(){return r.Direction}})})(ly);const oV=({max:i,onChange:e,value:t})=>{const s=P.useMemo(()=>[t],[t]),r=([n])=>{const a=Math.max(1,n);a!==t&&e(a)};return v.jsx(ly.Range,{values:s,step:1,min:0,max:i,onChange:r,renderMark:({index:n,props:a})=>n===0||n===i?null:v.jsx(uV,{index:n,props:a,value:t},a.key),renderTrack:({props:n,children:a})=>v.jsx(dV,{props:n,children:a,max:i,values:s}),renderThumb:({props:n,isDragged:a})=>v.jsx(gV,{props:n,isDragged:a},n.key)})},lV=B`
  width: 2px;
  height: 2px;
  border-radius: 1px;
`,uV=({props:i,index:e,value:t})=>{const s=e<t?"#ffffffdd":"#00000099";return v.jsx("div",{...i,className:lV,style:{...i.style,backgroundColor:s}})},hV=B`
  height: 33px;
  display: flex;
  width: 100%;
`,cV=B`
  height: 6px;
  width: 100%;
  border-radius: 3px;
  align-self: center;
`,dV=({props:i,children:e,max:t,values:s})=>{const r=ly.getTrackBackground({values:s,colors:["#777","#cfcfcf"],min:0,max:t});return v.jsx("div",{onMouseDown:i.onMouseDown,onTouchStart:i.onTouchStart,className:hV,style:i.style,children:v.jsx("div",{ref:i.ref,className:cV,style:{background:r},children:e})})},fV=X(Iu,B`
    height: 26px;
    width: 26px;
    border-radius: 50%;
    background-color: #777;
    color: #ffffff;
    display: flex;
    flex-direction: row;
    align-items: center;
    justify-content: center;
    transition: outline 0.5s ease;
    outline: 0px solid #00000020;
  `),pV=B`
  outline: 6px solid #00000020;
`,gV=({props:i,isDragged:e})=>{const t=X({[fV]:!0,[pV]:e});return P.createElement("div",{...i,key:i.key,className:t,style:i.style},i["aria-valuenow"])};function mV(i){return[{value:Bt.INFREQUENT,label:i(`Frequency.${Bt.INFREQUENT}`)},{value:Bt.MODERATE,label:i(`Frequency.${Bt.MODERATE}`)},{value:Bt.FREQUENT,label:i(`Frequency.${Bt.FREQUENT}`)}]}function yV(){return zu(mV)}const bV={input:()=>wV,singleValue:()=>vV,menuList:()=>kV,valueContainer:()=>xV,indicatorsContainer:()=>_V,dropdownIndicator:()=>TV,placeholder:()=>NV,control:()=>BV,menu:()=>EV,option:({isSelected:i,isFocused:e})=>X({[CV]:!0,[MV]:e,[PV]:i})},SV={IndicatorSeparator:()=>null},wV=X(Zs,B`
    && {
      color: #000000;
    }
  `),vV=X(Zs,B`
    && {
      color: #000000;
      overflow: visible;
    }
  `),kV=X(Zs,B`
    && {
      color: #000000;
      background-color: #ffffff;
    }
  `),xV=B`
  && {
    padding-right: 0px;
    margin-right: 0px;
  }
`,_V=B`
  && {
    padding: 0px !important;
    margin: 0px !important;
  }
`,TV=B`
  && {
    padding-left: 0px;
    margin-left: 0px;
  }
`,NV=X(Zs,B`
    && {
      color: #000000;
    }
  `),BV=B`
  && {
    height: 45px;
    border-width: 0px;
    box-shadow: none;
    padding: 0px;
    border-radius: 0px;
    background-color: transparent;

    &:hover {
      background-color: #00000015;
    }

    &:focus {
      background-color: #00000020;
    }
  }
`,CV=B`
  && {
    color: #000000;

    &:active {
      background-color: #00000030;
    }
  }
`,PV=B`
  && {
    background-color: #00000015;
  }
`,MV=B`
  && {
    background-color: #00000020;
  }
`,EV=B`
  && {
    min-width: 60px;
  }
`,LV=({value:i,onChange:e})=>{const t=yV(),s=P.useMemo(()=>t.find(n=>n.value===i),[i,t]),r=n=>{ee(n)||e(n.value)};return v.jsx(Jo,{inputId:"duration-frequency-picker",menuPosition:"fixed",isSearchable:!1,value:s,options:t,classNames:bV,components:SV,onChange:r})},DV=B`
  width: 100%;
  border-collapse: collapse;
  table-layout: fixed;
`,AV=B`
  &:nth-of-type(even) {
    background-color: #00000010;
    &:hover {
      background-color: #00000015;
    }
  }

  &:nth-of-type(odd) {
    background-color: #00000000;
    &:hover {
      background-color: #00000010;
    }
  }
`,IV=B`
  background-color: #00000020;
  cursor: not-allowed;
`,_h=B`
  border: 1px solid #ccc;
  font-weight: 400;
  height: 45px;
`,RV=B`
  cursor: pointer;
  position: relative;
  user-select: none;
  -webkit-tap-highlight-color: transparent;
`,OV=B`
  cursor: pointer;
`,FV=B`
  cursor: not-allowed;
`,VV=X(TD,B`
    position: absolute;
    bottom: 5px;
    right: 10px;
  `),HV=B`
  color: #666;
`,zV=B`
  color: green;
`,aN=X(Zs,B`
    border: 1px solid #ccc;
    font-weight: 400;
    text-align: center;
    height: 45px;
  `),WV=B`
  width: 75px;
`,GV=X(aN,B`
    width: 120px;
  `),jV=X(aN,B``),UV=X(Zs,B`
    width: 100%;
    height: 45px;
    display: flex;
    align-items: center;
    color: #00000090;
    text-align: left;
    padding-left: 10px;
  `),$V=B`
  padding: 0px 20px;
  text-align: center;
`,YV=B`
  padding: 0px;
`;function XV(i,{t:e}){const{isEnabled:t,isSelected:s,name:r,timeSignature:n}=i;if(t&&!s)return`${r} ${e("DurationGrid.IsNotActive")}`;if(!t)return ee(n.lower)||ee(n.upper)?e("Validation.DurationInvalidBecauseOfTimeSignature"):Bx(e("DurationGrid.DurationTooLong",{duration:r.toLocaleLowerCase()}));throw new Error(`Unknown situation with duration ${r}`)}const QV=({value:i,onChange:e})=>{const t=Yt(),{t:s}=t,r=(l,u)=>{const h=i.map(c=>c.duration===l?{...c,...u}:c);e(h)},n=l=>()=>r(l.duration,{isSelected:!l.isSelected}),a=l=>u=>r(l.duration,{frequency:u}),o=l=>u=>r(l.duration,{cluster:u});return v.jsxs("table",{className:DV,children:[v.jsx("thead",{children:v.jsxs("tr",{children:[v.jsx("th",{className:WV}),v.jsx("th",{className:GV,children:s("DurationGrid.Probability")}),v.jsx("th",{className:jV,children:s("DurationGrid.ClusterSize")})]})}),v.jsx("tbody",{children:i.map(l=>{const u=`${l.duration}-${l.type}`,h=X({[AV]:l.isEnabled,[IV]:!l.isEnabled}),c=X(_h,RV,{[FV]:!l.isEnabled&&!l.isSelected}),d=X(_h,{[OV]:l.isEnabled}),f=l.isSelected?GD:XD,p=l.isEnabled||l.isSelected?f:UD,g=X(VV,{[HV]:!l.isSelected,[zV]:l.isSelected}),b=l.isEnabled||l.isSelected?n(l):void 0;return v.jsxs("tr",{className:h,children:[v.jsxs("th",{className:c,onClick:b,children:[v.jsx(l.Component,{}),v.jsx(p,{className:g})]}),l.isSelected&&l.isEnabled?v.jsxs(v.Fragment,{children:[v.jsx("td",{className:X(_h,YV),children:v.jsx(LV,{value:l.frequency,onChange:a(l)})}),v.jsx("td",{className:X(_h,$V),children:v.jsx(oV,{max:l.maxCluster,value:l.cluster??1,onChange:o(l)})})]}):v.jsx("td",{className:d,colSpan:2,onClick:b,children:v.jsx("div",{className:UV,children:XV(l,t)})})]},u)})})]})},Qc=({value:i,type:e,dotted:t,timeSignature:s,onChange:r})=>{const[n,a]=Z7(e,t,i,s,r);return v.jsx(QV,{value:n,onChange:a})},JV=({value:i,issues:e,onChange:t})=>{const{t:s}=Yt(),r=n=>{t({...i,noteDurations:n})};return v.jsxs(v.Fragment,{children:[v.jsxs(Mi,{children:[v.jsx(Ei,{children:s("Settings.NoteDurations")}),v.jsx(is,{issues:e.noteDurations,children:s("Settings.NoteDurationsDescription")}),v.jsx(Qc,{timeSignature:i.timeSignature,value:i.noteDurations,onChange:r,type:pi.NOTE,dotted:!1})]}),v.jsxs(Mi,{children:[v.jsx(Ei,{children:s("Settings.DottedNoteDurations")}),v.jsx(is,{issues:e.dottedNoteDurations,children:s("Settings.DottedNoteDurationsDescription")}),v.jsx(Qc,{value:i.noteDurations,timeSignature:i.timeSignature,onChange:r,type:pi.NOTE,dotted:!0})]})]})};function qV(i){return[{clef:ot.TREBLE,icon:String.fromCodePoint(57424),label:i("ClefsPrimary.G2"),alternateName:i("ClefsAlternate.G2"),isEnabled:!0,iconStyle:B`
        top: 6px;
        transform: scale(0.95);
      `},{clef:ot.BASS,icon:String.fromCodePoint(57442),label:i("ClefsPrimary.F4"),alternateName:i("ClefsAlternate.F4"),isEnabled:!0,iconStyle:B`
        top: -1px;
      `},{clef:ot.TENOR,icon:String.fromCodePoint(57436),label:i("ClefsPrimary.C3"),alternateName:i("ClefsAlternate.C3"),isEnabled:!0,iconStyle:B`
        top: 4px;
      `},{clef:ot.ALTO,icon:String.fromCodePoint(57436),label:i("ClefsPrimary.C4"),alternateName:i("ClefsAlternate.C4"),isEnabled:!0,iconStyle:B`
        top: 4px;
      `}]}function KV(){return zu(qV)}const ZV=X(Zs,B`
    display: flex;
    flex-direction: row;
    flex: 1;
    border: none;
    gap: 8px;
    cursor: pointer;
    color: #000000;
    overflow: hidden;
    background-color: transparent;
    padding: 1px 0px;
  `),eH=X(B`
    font-family: 'Bravura';
    position: relative;
    pointer-events: none;
    line-height: 20px;
    font-size: 1rem;
  `),tH=B`
  display: flex;
  flex-direction: column;
  align-items: flex-start;
`,oN=({model:i,onClick:e})=>{const t=X(Zs,eH,i.iconStyle);return v.jsxs("button",{className:ZV,disabled:!i.isEnabled,onClick:e,children:[v.jsx("span",{className:t,children:i.icon}),v.jsx("div",{className:tH,children:v.jsx("span",{className:Ot,children:i.label})})]})},iH=({children:i,...e})=>{const t=e.getValue()[0].value;return v.jsx(Ga.SingleValue,{...e,children:v.jsx(oN,{isSelected:!1,model:t,onClick:Et})})},sH=({children:i,...e})=>{const t=e.data.value;return v.jsx(Ga.Option,{...e,children:v.jsx(oN,{isSelected:e.isSelected,model:t,onClick:Et})})},rH={IndicatorSeparator:()=>null,SingleValue:iH,Option:sH},nH=({value:i,onChange:e})=>{const t=KV().map(n=>({label:n.label,value:n})),s=t.find(n=>n.value.clef===i),r=n=>{var a;e((a=n==null?void 0:n.value)==null?void 0:a.clef)};return v.jsx(Jo,{inputId:"duration-frequency-picker",isSearchable:!1,menuPosition:"fixed",value:s,options:t,classNames:Bi,components:rH,onChange:r})};function aH(i){const e={[j.C_MAJOR_A_MINOR]:!1,[j.G_MAJOR_E_MINOR_1_SHARP]:!1,[j.D_MAJOR_B_MINOR_2_SHARPS]:!1,[j.A_MAJOR_F_SHARP_MINOR_3_SHARPS]:!1,[j.E_MAJOR_C_SHARP_MINOR_4_SHARPS]:!1,[j.B_MAJOR_G_SHARP_MINOR_5_SHARPS]:!1,[j.F_SHARP_MAJOR_D_SHARP_MINOR_6_SHARPS]:!1,[j.C_SHARP_MAJOR_A_SHARP_MINOR_7_SHARPS]:!1,[j.F_MAJOR_D_MINOR_1_FLAT]:!1,[j.Bb_MAJOR_G_MINOR_2_FLATS]:!1,[j.Eb_MAJOR_C_MINOR_3_FLATS]:!1,[j.Ab_MAJOR_F_MINOR_4_FLATS]:!1,[j.Db_MAJOR_Bb_MINOR_5_FLATS]:!1,[j.Gb_MAJOR_Eb_MINOR_6_FLATS]:!1,[j.Cb_MAJOR_Ab_MINOR_7_FLATS]:!1};return Object.keys(e).map(t=>({label:i(`KeySignatures.${t}`),value:t}))}function oH(){return zu(aH)}function lH(i){switch(i){case j.C_MAJOR_A_MINOR:return;case j.G_MAJOR_E_MINOR_1_SHARP:case j.D_MAJOR_B_MINOR_2_SHARPS:case j.A_MAJOR_F_SHARP_MINOR_3_SHARPS:case j.E_MAJOR_C_SHARP_MINOR_4_SHARPS:case j.B_MAJOR_G_SHARP_MINOR_5_SHARPS:case j.F_SHARP_MAJOR_D_SHARP_MINOR_6_SHARPS:case j.C_SHARP_MAJOR_A_SHARP_MINOR_7_SHARPS:return"#";case j.F_MAJOR_D_MINOR_1_FLAT:case j.Bb_MAJOR_G_MINOR_2_FLATS:case j.Eb_MAJOR_C_MINOR_3_FLATS:case j.Ab_MAJOR_F_MINOR_4_FLATS:case j.Db_MAJOR_Bb_MINOR_5_FLATS:case j.Gb_MAJOR_Eb_MINOR_6_FLATS:case j.Cb_MAJOR_Ab_MINOR_7_FLATS:return"b"}}function uH(i){switch(i){case j.C_MAJOR_A_MINOR:return 0;case j.G_MAJOR_E_MINOR_1_SHARP:case j.F_MAJOR_D_MINOR_1_FLAT:return 1;case j.D_MAJOR_B_MINOR_2_SHARPS:case j.Bb_MAJOR_G_MINOR_2_FLATS:return 2;case j.A_MAJOR_F_SHARP_MINOR_3_SHARPS:case j.Eb_MAJOR_C_MINOR_3_FLATS:return 3;case j.E_MAJOR_C_SHARP_MINOR_4_SHARPS:case j.Ab_MAJOR_F_MINOR_4_FLATS:return 4;case j.B_MAJOR_G_SHARP_MINOR_5_SHARPS:case j.Db_MAJOR_Bb_MINOR_5_FLATS:return 5;case j.F_SHARP_MAJOR_D_SHARP_MINOR_6_SHARPS:case j.Gb_MAJOR_Eb_MINOR_6_FLATS:return 6;case j.C_SHARP_MAJOR_A_SHARP_MINOR_7_SHARPS:case j.Cb_MAJOR_Ab_MINOR_7_FLATS:return 7}}function hH(i){switch(i){case"#":return"♯";case"b":return"♭";default:return""}}const cH={"#":[-5,5,-9,1,11,-3,7],b:[0,-6,2,-4,4,-2,6]},dH=B`
  letter-spacing: -3px;
  margin-right: 4px;
`,fH=B`
  letter-spacing: -3px;
  margin-right: 4px;
`,pH=B`
  position: relative;
`,lN=({keySignature:i})=>{const e=lH(i),t=hH(e),s=uH(i),r=[];for(let n=0;n<s;n+=1)r.push(v.jsx("span",{className:pH,style:{top:cH[e][n]},children:t},`${e}-${n}`));return v.jsx("span",{className:e==="#"?dH:fH,children:r})},gH=({children:i,...e})=>{const t=e.getValue()[0].value;return v.jsxs(Ga.SingleValue,{...e,children:[i," ",t===j.C_MAJOR_A_MINOR?null:v.jsxs(v.Fragment,{children:["(",v.jsx(lN,{keySignature:t}),")"]})]})},mH=({children:i,...e})=>{const t=e.data.value;return v.jsxs(Ga.Option,{...e,children:[i," ",t===j.C_MAJOR_A_MINOR?null:v.jsxs(v.Fragment,{children:["(",v.jsx(lN,{keySignature:t}),")"]})]})},yH=B`
  && {
    max-height: 250px;
  }
`,bH={...Bi,menuList:i=>{var e;return X((e=Bi==null?void 0:Bi.menuList)==null?void 0:e.call(Bi,i),yH)}},SH={IndicatorSeparator:()=>null,SingleValue:gH,Option:mH},wH=({value:i,onChange:e})=>{const t=oH(),s=P.useMemo(()=>t.find(n=>n.value===i),[i,t]),r=n=>{ee(n)||e(n.value)};return v.jsx(Jo,{inputId:"key-signature-picker",value:s,options:t,classNames:bH,components:SH,onChange:r})},vH=X(Ot,B`
    border-radius: 6px;
    background-color: #00000010;
    flex: 1;
    color: #000000;
    border: none;
    outline: none;
    padding: 10px 14px;
    &:hover {
      background-color: #00000015;
    }
    &:focus {
      background-color: #00000020;
    }
  `),uN=({className:i,...e})=>v.jsx("input",{className:X(vH,i),...e}),uw=({value:i,min:e,max:t,step:s,onChange:r})=>{const n=a=>{const o=a.target.valueAsNumber;r(ee(o)||Number.isNaN(o)?void 0:o)};return v.jsx(uN,{type:"number",value:i??"",min:e,max:t,step:s,onChange:n})},kH={input:()=>xH,singleValue:()=>_H,menuList:()=>TH,valueContainer:()=>NH,dropdownIndicator:()=>BH,placeholder:()=>CH,control:()=>PH,menu:()=>DH,container:()=>AH,option:({isSelected:i,isFocused:e})=>X({[MH]:!0,[LH]:e,[EH]:i})},xH=X(Ot,B`
    && {
      /* no extra rules */
    }
  `),_H=X(Ot,B`
    && {
      overflow: visible;
    }
  `),TH=X(Ot,B`
    && {
      background-color: #ffffff;
    }
  `),NH=B`
  && {
    padding-top: 0px;
    padding-bottom: 0px;
    padding-right: 0px;
    margin-right: 0px;
  }
`,BH=B`
  && {
    padding-left: 0px;
    margin-left: 0px;
  }
`,CH=X(Ot,B`
    && {
      /* no extra rules */
    }
  `),PH=B`
  && {
    border-width: 0px;
    box-shadow: none;
    padding: 0px;
    min-height: 0px;
    border-radius: 6px;
    background-color: #00000010;

    &:hover {
      background-color: #00000015;
    }

    &:focus {
      background-color: #00000020;
    }
  }
`,MH=B`
  && {
    color: #000000;
    background-color: transparent;

    &:active {
      background-color: #00000030;
    }
  }
`,EH=B`
  && {
    background-color: #00000015;
  }
`,LH=B`
  && {
    background-color: #00000020;
  }
`,DH=B`
  && {
    width: 55px;
  }
`,AH=B`
  && {
    padding: 0px;
    min-height: 0px;
    width: 60px;
  }
`,IH={IndicatorSeparator:()=>null},RH=B`
  display: flex;
  flex-direction: row;
  align-items: center;
  border-radius: 6px;
  padding: 6px 7px;
  gap: 8px;
  background-color: #00000010;
`,OH=B`
  max-width: 55px;
  height: 36px;
  padding: 6px 7px;
`,hw=[1,2,4,8].map(i=>({label:i.toString(),value:i})),FH=({value:i,onChange:e})=>{const t=n=>{const a=n.target.valueAsNumber;e({...i,upper:ee(a)||Number.isNaN(a)?void 0:a})},s=n=>{e({...i,lower:(n==null?void 0:n.value)??i.lower})},r=hw.find(n=>n.value===i.lower);return v.jsxs("div",{className:RH,children:[v.jsx(uN,{className:OH,value:i.upper??"",onChange:t,type:"number",step:1,min:1,max:30}),"/",v.jsx(Jo,{menuPosition:"fixed",isSearchable:!1,value:r,options:hw,classNames:kH,components:IH,onChange:s})]})},VH=({onChange:i,value:e,issues:t})=>{const{t:s}=Yt(),r=u=>i({...e,clef:u}),n=u=>i({...e,keySignature:u}),a=u=>i({...e,tempo:u}),o=u=>i({...e,bars:u}),l=u=>i({...e,timeSignature:u});return v.jsxs(v.Fragment,{children:[v.jsxs(Mi,{children:[v.jsx(Ei,{children:s("Settings.Clef")}),v.jsx(is,{issues:t.clef,children:s("Settings.ClefDescription")}),v.jsx(nH,{value:e.clef,onChange:r})]}),v.jsxs(Mi,{children:[v.jsx(Ei,{children:s("Settings.KeySignature")}),v.jsx(is,{issues:t.keySignature,children:s("Settings.KeySignatureDescription")}),v.jsx(wH,{value:e.keySignature,onChange:n})]}),v.jsxs(Mi,{children:[v.jsx(Ei,{children:s("Settings.TimeSignature")}),v.jsx(is,{issues:t.timeSignature,children:s("Settings.TimeSignatureDescription")}),v.jsx(FH,{value:e.timeSignature,onChange:l})]}),v.jsxs(Mi,{children:[v.jsx(Ei,{children:s("Settings.Tempo")}),v.jsx(is,{issues:t.bpm,children:s("Settings.TempoDescription")}),v.jsx(uw,{value:e.tempo,onChange:a,min:10,max:400,step:1})]}),v.jsxs(Mi,{children:[v.jsx(Ei,{children:s("Settings.BarCount")}),v.jsx(is,{issues:t.bars,children:s("Settings.BarCountDescription")}),v.jsx(uw,{value:e.bars,onChange:o,min:1,max:100,step:1})]})]})},cw={[qt.WARNING]:2,[qt.ERROR]:1};function HH(i,e){return cw[i.type]-cw[e.type]}const zH=B`
  padding: 8px;
  cursor: pointer;
  display: flex;
  flex-direction: column;
  gap: 8px;
  &:hover {
    background-color: #00000010;
    border-radius: 8px;
  }
`,WH=X(Zs,B`
    font-weight: bold;
    word-break: break-all;
  `),dp=X(Zs,B`
    display: flex;
    gap: 4px;
    color: #00000090;
  `),GH=({isCopied:i})=>{const{t:e}=Yt();switch(i){case void 0:return v.jsx("span",{className:dp,children:e("Settings.ClickToCopy")});case!0:return v.jsxs("span",{className:dp,children:[v.jsx(ID,{}),v.jsx("span",{children:e("Settings.CopySuccess")})]});case!1:return v.jsxs("span",{className:dp,children:[v.jsx(Qx,{}),v.jsx("span",{children:e("Settings.CopyFailure")})]})}},jH=({url:i,disabled:e})=>{const[t,s]=P.useState(void 0),r=()=>{ee(i)||navigator.clipboard.writeText(i).then(()=>s(!0)).catch(()=>s(!1))};return e?null:v.jsxs("div",{className:zH,onClick:r,children:[v.jsx("span",{className:WH,children:i}),v.jsx(GH,{isCopied:t})]})},UH=({value:i,issues:e})=>{const{t}=Yt(),s=P.useMemo(()=>Object.values(e).flatMap(a=>a).filter(a=>!ee(a)).some(a=>a.type===qt.ERROR)?[{id:void 0,type:qt.ERROR,label:t("Validation.ErrorInUrl")}]:zr,[e]),r=P.useMemo(()=>s.length===0?MF(i):void 0,[i,s]);return v.jsx(v.Fragment,{children:v.jsxs(Mi,{children:[v.jsx(Ei,{children:t("Settings.ShareableLink")}),v.jsx(is,{issues:s,children:t("Settings.ShareableLinkDescription")}),v.jsx(jH,{url:r,disabled:s.length>0})]})})},$H=B`
  position: relative;
  display: inline-block;
  width: 60px;
  height: 34px;
`,YH=B`
  position: absolute;
  cursor: pointer;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  transition: 0.4s;
  border-radius: 26px;
  background-color: #777;
`,XH=B`
  background-color: #238636;
`,QH=B`
  cursor: not-allowed;
`,JH=B`
  position: absolute;
  content: '';
  height: 26px;
  width: 26px;
  left: 4px;
  bottom: 4px;
  transition: 0.4s;
  border-radius: 50%;
  background-color: #ffffff;
`,qH=B`
  transform: translateX(26px);
`,KH=B`
  background-color: #ffffff80;
`,ZH=B`
  opacity: 0;
  width: 100%;
  height: 100%;
  position: absolute;
  top: 0;
  left: 0;
  cursor: pointer;
  z-index: 2; /* Ensure the input is on top of the slider */
  &:disabled {
    cursor: not-allowed;
  }
`,fp=({id:i,value:e,disabled:t,onChange:s})=>{const r=()=>{t||s(!e)},n=X({[YH]:!0,[XH]:e,[QH]:t}),a=X({[JH]:!0,[qH]:e,[KH]:t});return v.jsxs("label",{className:$H,children:[v.jsx("input",{id:i,type:"checkbox",disabled:t,checked:e,onChange:Et,onClick:r,className:ZH}),v.jsx("span",{className:n}),v.jsx("span",{className:a})]})},ez=({value:i,issues:e,onChange:t})=>{const{t:s}=Yt(),r=o=>{t({...i,showChordSymbols:o})},n=o=>{t({...i,showChordsStaff:o})},a=o=>{t({...i,useSeventhChords:o})};return v.jsxs(v.Fragment,{children:[v.jsxs(Mi,{children:[v.jsx(Ei,{children:s("Settings.ShowChordLabels")}),v.jsx(is,{issues:e.showChordSymbols,children:s("Settings.ShowChordLabelsDescription")}),v.jsx(fp,{id:"show-chords",value:!!i.showChordSymbols,onChange:r})]}),v.jsxs(Mi,{children:[v.jsx(Ei,{children:s("Settings.ShowChordsStaff")}),v.jsx(is,{issues:e.showChordsStaff,children:s("Settings.ShowChordsStaffDescription")}),v.jsx(fp,{id:"show-chords",value:!!i.showChordsStaff,onChange:n})]}),v.jsxs(Mi,{children:[v.jsx(Ei,{children:s("Settings.SeventhChords")}),v.jsx(is,{issues:e.useSeventhChords,children:s("Settings.SeventhChordsDescription")}),v.jsx(fp,{id:"seventh-chords",value:!!i.useSeventhChords,onChange:a})]})]})},tz=({value:i,issues:e,onChange:t})=>{const{t:s}=Yt(),r=n=>{t({...i,restDurations:n})};return v.jsxs(v.Fragment,{children:[v.jsxs(Mi,{children:[v.jsx(Ei,{children:s("Settings.RestDurations")}),v.jsx(is,{issues:e.restDurations,children:s("Settings.RestDurationsDescription")}),v.jsx(Qc,{timeSignature:i.timeSignature,value:i.restDurations,onChange:r,type:pi.REST,dotted:!1})]}),v.jsxs(Mi,{children:[v.jsx(Ei,{children:s("Settings.DottedRestDurations")}),v.jsx(is,{issues:e.dottedRestDurations,children:s("Settings.DottedRestDurationsDescription")}),v.jsx(Qc,{timeSignature:i.timeSignature,value:i.restDurations,onChange:r,type:pi.REST,dotted:!0})]})]})};function Th(...i){const t=i.flatMap(s=>s).filter(Ca).sort(HH)[0];if(!ee(t))return t.type==="error"?e3:ZF}function iz(i,e,t){return[{id:Mn.BASICS,name:i("Settings.BasicsPage"),Icon:Id,Badge:Th(t.bars,t.bpm,t.clef,t.keySignature,t.timeSignature),Component:VH},{id:Mn.NOTES,name:i("Settings.NotesPage"),Icon:Xx,Badge:Th(t.notes),Component:K7},{id:Mn.RHYTHMS,name:i("Settings.RhythmsPage"),Icon:Yx,Badge:Th(t.noteDurations,t.dottedNoteDurations),Component:JV},{id:Mn.RESTS,name:i("Settings.RestsPage"),Icon:VD,Badge:Th(t.restDurations,t.dottedRestDurations),Component:tz},{id:Mn.CHORDS,name:i("Settings.ChordsPage"),Icon:B0,Badge:void 0,Component:ez},{id:Mn.SHARE,name:i("Settings.SharePage"),Icon:zD,Badge:void 0,Component:UH}]}function hN(i){return jd(iz,i)}const sz=()=>{const i=Ad(),e=Rn(Vr.selectSlice),{isSettingsOpen:t,setSettingsOpen:s}=vr(),[r,n]=P.useState(void 0),[a,o]=P.useState(()=>e),l=ZT(a),u=eN(l),h=hN(l),c=()=>{s(!1),n(void 0),o(e)},d=()=>{n(void 0)},f=p=>{p.id==="save"&&i(Vr.actions.setGeneratorConfig({...a,timeStamp:Date.now()})),s(!1),n(void 0)};return P.useEffect(()=>n(void 0),[t]),v.jsxs(v.Fragment,{children:[v.jsx(g8,{isOpen:t,buttons:u,pages:h,onClick:n,onClose:c,onButtonClick:f}),v.jsx(y8,{page:r,config:a,issues:l,onBack:d,onChange:o})]})},rz=B`
  position: absolute;
  top: 0px;
  left: 0px;
  width: 100vw;
  height: 100vh;
  @supports (height: 100dvh) {
    height: min(100vh, 100dvh);
  }
  z-index: 10001;
  backdrop-filter: blur(30px);
  background-color: #00000099;
  display: flex;
  align-items: center;
  justify-content: center;
  user-select: none;
`,nz=B`
  background-color: #efefef;
  border-radius: 14px;
  user-select: text;
  display: flex;
  flex-direction: row;
  align-items: stretch;
  box-shadow: rgba(0, 0, 0, 0.07) 0px 1px 2px, rgba(0, 0, 0, 0.07) 0px 2px 4px,
    rgba(0, 0, 0, 0.07) 0px 4px 8px, rgba(0, 0, 0, 0.07) 0px 8px 16px,
    rgba(0, 0, 0, 0.07) 0px 16px 32px, rgba(0, 0, 0, 0.07) 0px 32px 64px;
`,az=document.getElementById("modal"),oz=({onBackdropClick:i,modalClassName:e,backdropClassName:t,children:s})=>{const r=n=>{n.preventDefault(),n.stopPropagation()};return dd.createPortal(v.jsx("div",{className:X(rz,t),onClick:i,children:v.jsx("div",{onClick:r,className:X(nz,e),children:s})}),az)};function lz(){var o,l;const i=P.useRef(null),[e,t]=P.useState(0),s=P.useCallback(u=>{t(u.target.scrollTop)},[]),r=u=>{ee(i.current)||i.current.scrollTop!==u&&i.current.scrollTo({top:u,behavior:"smooth"})},n=((o=i.current)==null?void 0:o.scrollHeight)??0,a=((l=i.current)==null?void 0:l.clientHeight)??0;return{ref:i,needsTopGradient:e>0,needsBottomGradient:e<n-a,onScroll:s,setScrollTop:r}}const uz=B`
  border-top-left-radius: 14px;
  border-bottom-left-radius: 14px;
  min-width: 245px;
`,hz=B`
  display: flex;
  flex-direction: row;
  align-items: center;
  font-size: 1.4rem;
  font-weight: bold;
  color: #000000;
  gap: 10px;
  padding: 14px 18px;
`,cz=B`
  position: relative;
  top: 1px;
`,dz=B`
  overflow-x: auto;
  display: flex;
  flex-direction: column;
  padding: 14px 0px;
`,fz=B`
  display: flex;
  flex-direction: row;
  align-items: center;
  color: #000000cc;
  font-size: 1.2rem;
  gap: 10px;
  padding: 10px 18px;
  cursor: pointer;
  &:hover {
    color: #000000;
    background-color: #00000010;
  }
`,pz=B`
  background-color: #00000020;
  color: #000000;
  &:hover {
    color: #000000;
    background-color: #00000020;
  }
`,gz=B`
  flex: 1;
`,mz=B`
  position: relative;
  flex: 1;
  min-width: 400px;
  background-color: #ffffff;
  box-shadow: rgba(100, 100, 111, 0.4) 0px 2px 29px 0px;
  border-top-right-radius: 14px;
  border-bottom-right-radius: 14px;
  /* margin: 10px 10px 10px 0px; */
  /* border-radius: 10px; */
`,yz=B`
  display: flex;
  flex-direction: row;
  gap: 10px;
  align-items: center;
`,bz=B`
  display: flex;
  flex-direction: row;
  justify-content: space-between;
  align-items: center;
  font-size: 1.4rem;
  font-weight: bold;
  color: #000000;
  padding: 14px;
`,Sz=B`
  font-size: 1.4rem;
  color: #000000;
  cursor: pointer;
`,wz=B`
  overflow: auto;
  width: 600px;
  height: 540px;
`,cN=B`
  position: absolute;
  pointer-events: none;
  height: 50px;
  transition: opacity linear 200ms;
`,vz=X(cN,B`
    bottom: 65px;
    left: 0px;
    right: 20px;
    background: linear-gradient(0deg, #ffffffff 0%, transparent 100%);
  `),kz=X(cN,B`
    top: 60px;
    left: 0px;
    right: 20px;
    background: linear-gradient(180deg, #ffffffff 0%, transparent 100%);
  `),xz=B`
  height: 65px;
  display: flex;
  flex-direction: row;
  justify-content: flex-end;
  align-items: flex-end;
  pointer-events: all;
  padding: 14px;
  gap: 10px;
  width: 100%;
  border-bottom-right-radius: 14px;
`;function dN({pages:i,title:e,icon:t,activePageId:s,pageProps:r,closeOnBackdropClick:n,buttons:a=[],onClick:o,onClose:l,setActivePage:u}){const h=P.useMemo(()=>i.find(m=>m.id===s),[i,s]),{ref:c,needsBottomGradient:d,needsTopGradient:f,onScroll:p,setScrollTop:g}=lz(),b=m=>()=>{u(m),g(0)};return v.jsxs(oz,{onBackdropClick:n?l:Et,children:[v.jsxs("div",{className:uz,children:[v.jsxs("header",{className:hz,children:[v.jsx(t,{className:cz})," ",e]}),v.jsx("div",{className:dz,children:i.map(m=>{const{id:y,name:w,Icon:x,Badge:k}=m,_=X(fz,y===s?pz:null);return v.jsxs("div",{className:_,onClick:b(m.id),children:[v.jsx(x,{}),v.jsx("span",{className:gz,children:w}),k&&v.jsx(k,{})]},y)})})]}),v.jsxs("div",{className:mz,children:[v.jsxs("header",{className:bz,children:[v.jsxs("div",{className:yz,children:[v.jsx(h.Icon,{})," ",h.name]}),v.jsx(Zx,{className:Sz,onClick:l})]}),v.jsxs("div",{className:wz,ref:c,onScroll:p,children:[v.jsx("div",{className:kz,style:{opacity:f?1:0}}),v.jsx(h.Component,{...r})]}),ee(a)||a.length===0?null:v.jsxs(v.Fragment,{children:[v.jsx("div",{className:vz,style:{opacity:d?1:0}}),v.jsx(_z,{buttons:a,data:r,onClick:o??Et})]})]})]})}function _z({buttons:i,data:e,onClick:t}){return v.jsx("div",{className:xz,children:i.map(s=>v.jsxs(ma,{onClick:()=>t(s,e),disabled:!s.enabled,children:[v.jsx(s.icon,{})," ",s.label]},s.id))})}const Tz=({onClose:i})=>{const{t:e}=Yt(),t=Ad(),s=Rn(nu.selectors.selectSettingsPage),r=Rn(Vr.selectSlice),[n,a]=P.useState(()=>r),o=ZT(n),l=eN(o),u=hN(o),h=f=>t(nu.actions.setSettingsPage(f));P.useEffect(()=>a(r),[r]);const c=P.useMemo(()=>({onChange:a,onClose:i,value:n,issues:o}),[a,i,n,o]),d=f=>{f.id==="save"&&(t(Vr.actions.setGeneratorConfig({...n,timeStamp:Date.now()})),i())};return v.jsx(dN,{icon:Id,title:e("Settings.Settings"),pages:u,activePageId:s,pageProps:c,setActivePage:h,buttons:l,onClick:d,onClose:i})},Nz=()=>{const{isSettingsOpen:i,setSettingsOpen:e}=vr(),t=Du(),s=()=>e(!1);return t?v.jsx(sz,{}):i&&v.jsx(Tz,{onClose:s})};function Bz(i){return ct({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M204.504 23.109c-66.649.146-106.53 38.463-117.59 77.154-11.06 38.692 3.301 76.266 17.495 97.608l.37-.247a64 64 0 0 0 51.755 26.485 64 64 0 0 0 64-64 64 64 0 0 0-64-64 64 64 0 0 0-49.717 23.777c.595-6.139 1.676-12.251 3.363-18.152 9.337-32.665 33.605-60.427 94.383-60.625 59.958-.195 94.302 63.78 92.652 152.82-1.487 80.241-11.975 128.266-60.033 171.305-48.058 43.04-107.95 78.339-179.906 106.484-13.016 5.091-1.171 19.747 6.515 16.781 72.712-28.054 144.82-53.25 195.828-98.931 51.008-45.681 96.234-86.259 96.811-197.293.506-97.408-44.5-169.401-151.926-169.166zm224.03 41a32 32 0 0 0-32 32 32 32 0 0 0 32 32 32 32 0 0 0 32-32 32 32 0 0 0-32-32zm0 128a32 32 0 0 0-32 32 32 32 0 0 0 32 32 32 32 0 0 0 32-32 32 32 0 0 0-32-32z"},child:[]}]})(i)}function Cz(i){return ct({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M238.75 138.492l18.147-18.829c.898-21.472 9.107-59.37 26.166-60.771 6.994.097 14.566 5.833 15.742 16.021 3.25 28.145-11.833 40.563-29.072 57.372l-31.408 32.586-.037-.038c-28.467 31.447-65.355 70.37-69.772 106.973-5.588 53.77 31.264 108.42 87.149 105.693l-3.178-18.066c-37.522-4.905-69.771-43.77-56.711-81.312 23.275-60.413 75.664-92.822 116.333-148.022 11.474-15.574 14.575-46.945 11.815-63.128-2.76-16.184-14.345-43.066-32.059-45.017-34.714-4.59-60.724 62.476-53.114 116.538zm25.667 75.896l-15.508 15.248c.542 2.775 1.166 6.185 2.088 12.14-34.017 21.505-36.576 66.707-12.186 90.96 5.177 5.31 15.165-2.767 10.104-8.674-10.971-19.786-12.097-44.028 5.742-57.137 8.78 50.539 24.627 117.16 30.164 170.895.364 3.535-6.593 10.614-9.973 11.396 0-22.091-17.908-40-40-40-22.09 0-40 17.909-40 40 .017 20.193 15.266 36.007 35.123 39.668 42.008 7.745 78.659-17.935 72.76-53.16-8.793-59.062-21.986-121.007-30.857-175.32 12.066-1.253 28.875 5.169 36.428 12.847 8.575 9.297 12.95 22.35 11.982 32.787-.924 9.96-7.425 20.992-17.06 30.381l3.662 20.776c17.346-12.583 35.117-30.185 36.94-49.844 1.518-16.352-5.01-40.324-18.08-52.273-16.885-15.437-38.313-18.553-57.349-16.612-2.004-13.065-3.018-18.039-3.98-24.078z"},child:[]}]})(i)}function fN(i,e,t){const{i18n:s}=Yt(),r=s.language;return P.useMemo(()=>{const n=nL(j.C_MAJOR_A_MINOR,i,e);return{tempo:120,tracks:[{bars:sL(n,4).map(l=>({items:l.map(h=>({duration:ne.QUARTER,note:h,type:"note",label:qi(Ba(h),r)}))})),clef:t,staff:"score",instrument:"AcousticGuitarSteel",keySignature:j.C_MAJOR_A_MINOR,name:"",shortName:"",timeSignature:{lower:4,upper:4},tuning:Mg}]}},[r])}const Pz=B`
  width: 100%;
  height: 100%;
  margin: 0 auto;
  background-color: transparent;
  display: flex;
  flex-direction: column;
  overflow: hidden;
  position: relative;
`,Mz=B`
  left: 0px;
  right: 0px;
  top: 0px;
  bottom: 0px;
  padding: 0px;
`,pN=({track:i})=>{const[e,t]=P.useState(),[s,r]=P.useState(),n=P.useMemo(()=>g_(i),[i]);return sT({tex:n,root:s,scrollArea:e,player:bF(e)}),v.jsx("div",{id:"help-page",className:Pz,children:v.jsx(n_,{viewPortStyle:Mz,setRootCallback:r,setScrollAreaCallback:t})})},Ez=()=>{const i=fN("E2","E5",ot.TREBLE);return v.jsx(pN,{track:i})},Lz=()=>{const i=fN("B0","G3",ot.BASS);return v.jsx(pN,{track:i})};function Dz(i){return[{id:Pc.TREBLE_CLEF,name:i("Help.TrebleClef"),Icon:Cz,Component:Ez},{id:Pc.BASS_CLEF,name:i("Help.BassClef"),Icon:Bz,Component:Lz}]}function Az(){return zu(Dz)}const Iz=({onClose:i})=>{const{t:e}=Yt(),t=Ad(),s=Az(),r=Rn(nu.selectors.selectHelpPage),n=a=>t(nu.actions.setHelpPage(a));return v.jsx(dN,{icon:Id,activePageId:r,title:e("Help.Help"),onClose:i,setActivePage:n,pages:s,pageProps:void 0})},Rz=()=>{const{isHelpOpen:i,setHelpOpen:e}=vr(),t=Du(),s=()=>e(!1);return t?null:i&&v.jsx(Iz,{onClose:s})},Oz=()=>{const i=LF();return v.jsxs(r_.Provider,{value:i,children:[v.jsx(DI,{disabled:!1}),v.jsx(wI,{}),v.jsx(eI,{}),v.jsx(Rz,{}),v.jsx(Nz,{})]})},Fz=()=>v.jsx(iA,{children:v.jsx(Oz,{})});Tk(document.getElementById("root")).render(v.jsx(bD,{store:Mx,children:v.jsxs(qC,{children:[v.jsx(FC,{styles:gL}),v.jsx(SP,{i18n:Wh,children:v.jsx(Fz,{})})]})}));
