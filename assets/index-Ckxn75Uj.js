function fS(s,e){for(var t=0;t<e.length;t++){const i=e[t];if(typeof i!="string"&&!Array.isArray(i)){for(const r in i)if(r!=="default"&&!(r in s)){const n=Object.getOwnPropertyDescriptor(i,r);n&&Object.defineProperty(s,r,n.get?n:{enumerable:!0,get:()=>i[r]})}}}return Object.freeze(Object.defineProperty(s,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const n of r)if(n.type==="childList")for(const a of n.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&i(a)}).observe(document,{childList:!0,subtree:!0});function t(r){const n={};return r.integrity&&(n.integrity=r.integrity),r.referrerPolicy&&(n.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?n.credentials="include":r.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function i(r){if(r.ep)return;r.ep=!0;const n=t(r);fetch(r.href,n)}})();function pS(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}var Oy={exports:{}},Xh={},Vy={exports:{}},De={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var el=Symbol.for("react.element"),gS=Symbol.for("react.portal"),mS=Symbol.for("react.fragment"),yS=Symbol.for("react.strict_mode"),wS=Symbol.for("react.profiler"),bS=Symbol.for("react.provider"),SS=Symbol.for("react.context"),kS=Symbol.for("react.forward_ref"),_S=Symbol.for("react.suspense"),BS=Symbol.for("react.memo"),xS=Symbol.for("react.lazy"),Mp=Symbol.iterator;function vS(s){return s===null||typeof s!="object"?null:(s=Mp&&s[Mp]||s["@@iterator"],typeof s=="function"?s:null)}var Hy={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Wy=Object.assign,zy={};function Pa(s,e,t){this.props=s,this.context=e,this.refs=zy,this.updater=t||Hy}Pa.prototype.isReactComponent={};Pa.prototype.setState=function(s,e){if(typeof s!="object"&&typeof s!="function"&&s!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,s,e,"setState")};Pa.prototype.forceUpdate=function(s){this.updater.enqueueForceUpdate(this,s,"forceUpdate")};function Gy(){}Gy.prototype=Pa.prototype;function qd(s,e,t){this.props=s,this.context=e,this.refs=zy,this.updater=t||Hy}var Kd=qd.prototype=new Gy;Kd.constructor=qd;Wy(Kd,Pa.prototype);Kd.isPureReactComponent=!0;var Fp=Array.isArray,Uy=Object.prototype.hasOwnProperty,jd={current:null},$y={key:!0,ref:!0,__self:!0,__source:!0};function Yy(s,e,t){var i,r={},n=null,a=null;if(e!=null)for(i in e.ref!==void 0&&(a=e.ref),e.key!==void 0&&(n=""+e.key),e)Uy.call(e,i)&&!$y.hasOwnProperty(i)&&(r[i]=e[i]);var o=arguments.length-2;if(o===1)r.children=t;else if(1<o){for(var l=Array(o),h=0;h<o;h++)l[h]=arguments[h+2];r.children=l}if(s&&s.defaultProps)for(i in o=s.defaultProps,o)r[i]===void 0&&(r[i]=o[i]);return{$$typeof:el,type:s,key:n,ref:a,props:r,_owner:jd.current}}function TS(s,e){return{$$typeof:el,type:s.type,key:e,ref:s.ref,props:s.props,_owner:s._owner}}function Zd(s){return typeof s=="object"&&s!==null&&s.$$typeof===el}function NS(s){var e={"=":"=0",":":"=2"};return"$"+s.replace(/[=:]/g,function(t){return e[t]})}var Rp=/\/+/g;function Ru(s,e){return typeof s=="object"&&s!==null&&s.key!=null?NS(""+s.key):e.toString(36)}function Vl(s,e,t,i,r){var n=typeof s;(n==="undefined"||n==="boolean")&&(s=null);var a=!1;if(s===null)a=!0;else switch(n){case"string":case"number":a=!0;break;case"object":switch(s.$$typeof){case el:case gS:a=!0}}if(a)return a=s,r=r(a),s=i===""?"."+Ru(a,0):i,Fp(r)?(t="",s!=null&&(t=s.replace(Rp,"$&/")+"/"),Vl(r,e,t,"",function(h){return h})):r!=null&&(Zd(r)&&(r=TS(r,t+(!r.key||a&&a.key===r.key?"":(""+r.key).replace(Rp,"$&/")+"/")+s)),e.push(r)),1;if(a=0,i=i===""?".":i+":",Fp(s))for(var o=0;o<s.length;o++){n=s[o];var l=i+Ru(n,o);a+=Vl(n,e,t,l,r)}else if(l=vS(s),typeof l=="function")for(s=l.call(s),o=0;!(n=s.next()).done;)n=n.value,l=i+Ru(n,o++),a+=Vl(n,e,t,l,r);else if(n==="object")throw e=String(s),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(s).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return a}function gl(s,e,t){if(s==null)return s;var i=[],r=0;return Vl(s,i,"","",function(n){return e.call(t,n,r++)}),i}function PS(s){if(s._status===-1){var e=s._result;e=e(),e.then(function(t){(s._status===0||s._status===-1)&&(s._status=1,s._result=t)},function(t){(s._status===0||s._status===-1)&&(s._status=2,s._result=t)}),s._status===-1&&(s._status=0,s._result=e)}if(s._status===1)return s._result.default;throw s._result}var xi={current:null},Hl={transition:null},CS={ReactCurrentDispatcher:xi,ReactCurrentBatchConfig:Hl,ReactCurrentOwner:jd};De.Children={map:gl,forEach:function(s,e,t){gl(s,function(){e.apply(this,arguments)},t)},count:function(s){var e=0;return gl(s,function(){e++}),e},toArray:function(s){return gl(s,function(e){return e})||[]},only:function(s){if(!Zd(s))throw Error("React.Children.only expected to receive a single React element child.");return s}};De.Component=Pa;De.Fragment=mS;De.Profiler=wS;De.PureComponent=qd;De.StrictMode=yS;De.Suspense=_S;De.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=CS;De.cloneElement=function(s,e,t){if(s==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+s+".");var i=Wy({},s.props),r=s.key,n=s.ref,a=s._owner;if(e!=null){if(e.ref!==void 0&&(n=e.ref,a=jd.current),e.key!==void 0&&(r=""+e.key),s.type&&s.type.defaultProps)var o=s.type.defaultProps;for(l in e)Uy.call(e,l)&&!$y.hasOwnProperty(l)&&(i[l]=e[l]===void 0&&o!==void 0?o[l]:e[l])}var l=arguments.length-2;if(l===1)i.children=t;else if(1<l){o=Array(l);for(var h=0;h<l;h++)o[h]=arguments[h+2];i.children=o}return{$$typeof:el,type:s.type,key:r,ref:n,props:i,_owner:a}};De.createContext=function(s){return s={$$typeof:SS,_currentValue:s,_currentValue2:s,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},s.Provider={$$typeof:bS,_context:s},s.Consumer=s};De.createElement=Yy;De.createFactory=function(s){var e=Yy.bind(null,s);return e.type=s,e};De.createRef=function(){return{current:null}};De.forwardRef=function(s){return{$$typeof:kS,render:s}};De.isValidElement=Zd;De.lazy=function(s){return{$$typeof:xS,_payload:{_status:-1,_result:s},_init:PS}};De.memo=function(s,e){return{$$typeof:BS,type:s,compare:e===void 0?null:e}};De.startTransition=function(s){var e=Hl.transition;Hl.transition={};try{s()}finally{Hl.transition=e}};De.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")};De.useCallback=function(s,e){return xi.current.useCallback(s,e)};De.useContext=function(s){return xi.current.useContext(s)};De.useDebugValue=function(){};De.useDeferredValue=function(s){return xi.current.useDeferredValue(s)};De.useEffect=function(s,e){return xi.current.useEffect(s,e)};De.useId=function(){return xi.current.useId()};De.useImperativeHandle=function(s,e,t){return xi.current.useImperativeHandle(s,e,t)};De.useInsertionEffect=function(s,e){return xi.current.useInsertionEffect(s,e)};De.useLayoutEffect=function(s,e){return xi.current.useLayoutEffect(s,e)};De.useMemo=function(s,e){return xi.current.useMemo(s,e)};De.useReducer=function(s,e,t){return xi.current.useReducer(s,e,t)};De.useRef=function(s){return xi.current.useRef(s)};De.useState=function(s){return xi.current.useState(s)};De.useSyncExternalStore=function(s,e,t){return xi.current.useSyncExternalStore(s,e,t)};De.useTransition=function(){return xi.current.useTransition()};De.version="18.2.0";Vy.exports=De;var be=Vy.exports;const lr=pS(be),fo=fS({__proto__:null,default:lr},[be]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ES=be,LS=Symbol.for("react.element"),MS=Symbol.for("react.fragment"),FS=Object.prototype.hasOwnProperty,RS=ES.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,DS={key:!0,ref:!0,__self:!0,__source:!0};function Xy(s,e,t){var i,r={},n=null,a=null;t!==void 0&&(n=""+t),e.key!==void 0&&(n=""+e.key),e.ref!==void 0&&(a=e.ref);for(i in e)FS.call(e,i)&&!DS.hasOwnProperty(i)&&(r[i]=e[i]);if(s&&s.defaultProps)for(i in e=s.defaultProps,e)r[i]===void 0&&(r[i]=e[i]);return{$$typeof:LS,type:s,key:n,ref:a,props:r,_owner:RS.current}}Xh.Fragment=MS;Xh.jsx=Xy;Xh.jsxs=Xy;Oy.exports=Xh;var ve=Oy.exports,Qy={exports:{}},ji={},Jy={exports:{}},qy={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(s){function e(W,se){var pe=W.length;W.push(se);e:for(;0<pe;){var Me=pe-1>>>1,ke=W[Me];if(0<r(ke,se))W[Me]=se,W[pe]=ke,pe=Me;else break e}}function t(W){return W.length===0?null:W[0]}function i(W){if(W.length===0)return null;var se=W[0],pe=W.pop();if(pe!==se){W[0]=pe;e:for(var Me=0,ke=W.length,Ms=ke>>>1;Me<Ms;){var li=2*(Me+1)-1,jt=W[li],Zr=li+1,pl=W[Zr];if(0>r(jt,pe))Zr<ke&&0>r(pl,jt)?(W[Me]=pl,W[Zr]=pe,Me=Zr):(W[Me]=jt,W[li]=pe,Me=li);else if(Zr<ke&&0>r(pl,pe))W[Me]=pl,W[Zr]=pe,Me=Zr;else break e}}return se}function r(W,se){var pe=W.sortIndex-se.sortIndex;return pe!==0?pe:W.id-se.id}if(typeof performance=="object"&&typeof performance.now=="function"){var n=performance;s.unstable_now=function(){return n.now()}}else{var a=Date,o=a.now();s.unstable_now=function(){return a.now()-o}}var l=[],h=[],u=1,c=null,d=3,p=!1,g=!1,w=!1,S=typeof setTimeout=="function"?setTimeout:null,b=typeof clearTimeout=="function"?clearTimeout:null,m=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function y(W){for(var se=t(h);se!==null;){if(se.callback===null)i(h);else if(se.startTime<=W)i(h),se.sortIndex=se.expirationTime,e(l,se);else break;se=t(h)}}function B(W){if(w=!1,y(W),!g)if(t(l)!==null)g=!0,oi(_);else{var se=t(h);se!==null&&mi(B,se.startTime-W)}}function _(W,se){g=!1,w&&(w=!1,b(D),D=-1),p=!0;var pe=d;try{for(y(se),c=t(l);c!==null&&(!(c.expirationTime>se)||W&&!ge());){var Me=c.callback;if(typeof Me=="function"){c.callback=null,d=c.priorityLevel;var ke=Me(c.expirationTime<=se);se=s.unstable_now(),typeof ke=="function"?c.callback=ke:c===t(l)&&i(l),y(se)}else i(l);c=t(l)}if(c!==null)var Ms=!0;else{var li=t(h);li!==null&&mi(B,li.startTime-se),Ms=!1}return Ms}finally{c=null,d=pe,p=!1}}var P=!1,N=null,D=-1,Q=5,J=-1;function ge(){return!(s.unstable_now()-J<Q)}function qt(){if(N!==null){var W=s.unstable_now();J=W;var se=!0;try{se=N(!0,W)}finally{se?Ti():(P=!1,N=null)}}else P=!1}var Ti;if(typeof m=="function")Ti=function(){m(qt)};else if(typeof MessageChannel<"u"){var Kt=new MessageChannel,gi=Kt.port2;Kt.port1.onmessage=qt,Ti=function(){gi.postMessage(null)}}else Ti=function(){S(qt,0)};function oi(W){N=W,P||(P=!0,Ti())}function mi(W,se){D=S(function(){W(s.unstable_now())},se)}s.unstable_IdlePriority=5,s.unstable_ImmediatePriority=1,s.unstable_LowPriority=4,s.unstable_NormalPriority=3,s.unstable_Profiling=null,s.unstable_UserBlockingPriority=2,s.unstable_cancelCallback=function(W){W.callback=null},s.unstable_continueExecution=function(){g||p||(g=!0,oi(_))},s.unstable_forceFrameRate=function(W){0>W||125<W?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Q=0<W?Math.floor(1e3/W):5},s.unstable_getCurrentPriorityLevel=function(){return d},s.unstable_getFirstCallbackNode=function(){return t(l)},s.unstable_next=function(W){switch(d){case 1:case 2:case 3:var se=3;break;default:se=d}var pe=d;d=se;try{return W()}finally{d=pe}},s.unstable_pauseExecution=function(){},s.unstable_requestPaint=function(){},s.unstable_runWithPriority=function(W,se){switch(W){case 1:case 2:case 3:case 4:case 5:break;default:W=3}var pe=d;d=W;try{return se()}finally{d=pe}},s.unstable_scheduleCallback=function(W,se,pe){var Me=s.unstable_now();switch(typeof pe=="object"&&pe!==null?(pe=pe.delay,pe=typeof pe=="number"&&0<pe?Me+pe:Me):pe=Me,W){case 1:var ke=-1;break;case 2:ke=250;break;case 5:ke=1073741823;break;case 4:ke=1e4;break;default:ke=5e3}return ke=pe+ke,W={id:u++,callback:se,priorityLevel:W,startTime:pe,expirationTime:ke,sortIndex:-1},pe>Me?(W.sortIndex=pe,e(h,W),t(l)===null&&W===t(h)&&(w?(b(D),D=-1):w=!0,mi(B,pe-Me))):(W.sortIndex=ke,e(l,W),g||p||(g=!0,oi(_))),W},s.unstable_shouldYield=ge,s.unstable_wrapCallback=function(W){var se=d;return function(){var pe=d;d=se;try{return W.apply(this,arguments)}finally{d=pe}}}})(qy);Jy.exports=qy;var AS=Jy.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ky=be,Ji=AS;function V(s){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+s,t=1;t<arguments.length;t++)e+="&args[]="+encodeURIComponent(arguments[t]);return"Minified React error #"+s+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var jy=new Set,po={};function Mn(s,e){ca(s,e),ca(s+"Capture",e)}function ca(s,e){for(po[s]=e,s=0;s<e.length;s++)jy.add(e[s])}var dr=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Cc=Object.prototype.hasOwnProperty,IS=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,Dp={},Ap={};function OS(s){return Cc.call(Ap,s)?!0:Cc.call(Dp,s)?!1:IS.test(s)?Ap[s]=!0:(Dp[s]=!0,!1)}function VS(s,e,t,i){if(t!==null&&t.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return i?!1:t!==null?!t.acceptsBooleans:(s=s.toLowerCase().slice(0,5),s!=="data-"&&s!=="aria-");default:return!1}}function HS(s,e,t,i){if(e===null||typeof e>"u"||VS(s,e,t,i))return!0;if(i)return!1;if(t!==null)switch(t.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function vi(s,e,t,i,r,n,a){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=i,this.attributeNamespace=r,this.mustUseProperty=t,this.propertyName=s,this.type=e,this.sanitizeURL=n,this.removeEmptyString=a}var ni={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(s){ni[s]=new vi(s,0,!1,s,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(s){var e=s[0];ni[e]=new vi(e,1,!1,s[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(s){ni[s]=new vi(s,2,!1,s.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(s){ni[s]=new vi(s,2,!1,s,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(s){ni[s]=new vi(s,3,!1,s.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(s){ni[s]=new vi(s,3,!0,s,null,!1,!1)});["capture","download"].forEach(function(s){ni[s]=new vi(s,4,!1,s,null,!1,!1)});["cols","rows","size","span"].forEach(function(s){ni[s]=new vi(s,6,!1,s,null,!1,!1)});["rowSpan","start"].forEach(function(s){ni[s]=new vi(s,5,!1,s.toLowerCase(),null,!1,!1)});var ef=/[\-:]([a-z])/g;function tf(s){return s[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(s){var e=s.replace(ef,tf);ni[e]=new vi(e,1,!1,s,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(s){var e=s.replace(ef,tf);ni[e]=new vi(e,1,!1,s,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(s){var e=s.replace(ef,tf);ni[e]=new vi(e,1,!1,s,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(s){ni[s]=new vi(s,1,!1,s.toLowerCase(),null,!1,!1)});ni.xlinkHref=new vi("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(s){ni[s]=new vi(s,1,!1,s.toLowerCase(),null,!0,!0)});function sf(s,e,t,i){var r=ni.hasOwnProperty(e)?ni[e]:null;(r!==null?r.type!==0:i||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(HS(e,t,r,i)&&(t=null),i||r===null?OS(e)&&(t===null?s.removeAttribute(e):s.setAttribute(e,""+t)):r.mustUseProperty?s[r.propertyName]=t===null?r.type===3?!1:"":t:(e=r.attributeName,i=r.attributeNamespace,t===null?s.removeAttribute(e):(r=r.type,t=r===3||r===4&&t===!0?"":""+t,i?s.setAttributeNS(i,e,t):s.setAttribute(e,t))))}var br=Ky.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,ml=Symbol.for("react.element"),Un=Symbol.for("react.portal"),$n=Symbol.for("react.fragment"),rf=Symbol.for("react.strict_mode"),Ec=Symbol.for("react.profiler"),Zy=Symbol.for("react.provider"),e0=Symbol.for("react.context"),nf=Symbol.for("react.forward_ref"),Lc=Symbol.for("react.suspense"),Mc=Symbol.for("react.suspense_list"),af=Symbol.for("react.memo"),Tr=Symbol.for("react.lazy"),t0=Symbol.for("react.offscreen"),Ip=Symbol.iterator;function Ra(s){return s===null||typeof s!="object"?null:(s=Ip&&s[Ip]||s["@@iterator"],typeof s=="function"?s:null)}var yt=Object.assign,Du;function $a(s){if(Du===void 0)try{throw Error()}catch(t){var e=t.stack.trim().match(/\n( *(at )?)/);Du=e&&e[1]||""}return`
`+Du+s}var Au=!1;function Iu(s,e){if(!s||Au)return"";Au=!0;var t=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(h){var i=h}Reflect.construct(s,[],e)}else{try{e.call()}catch(h){i=h}s.call(e.prototype)}else{try{throw Error()}catch(h){i=h}s()}}catch(h){if(h&&i&&typeof h.stack=="string"){for(var r=h.stack.split(`
`),n=i.stack.split(`
`),a=r.length-1,o=n.length-1;1<=a&&0<=o&&r[a]!==n[o];)o--;for(;1<=a&&0<=o;a--,o--)if(r[a]!==n[o]){if(a!==1||o!==1)do if(a--,o--,0>o||r[a]!==n[o]){var l=`
`+r[a].replace(" at new "," at ");return s.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",s.displayName)),l}while(1<=a&&0<=o);break}}}finally{Au=!1,Error.prepareStackTrace=t}return(s=s?s.displayName||s.name:"")?$a(s):""}function WS(s){switch(s.tag){case 5:return $a(s.type);case 16:return $a("Lazy");case 13:return $a("Suspense");case 19:return $a("SuspenseList");case 0:case 2:case 15:return s=Iu(s.type,!1),s;case 11:return s=Iu(s.type.render,!1),s;case 1:return s=Iu(s.type,!0),s;default:return""}}function Fc(s){if(s==null)return null;if(typeof s=="function")return s.displayName||s.name||null;if(typeof s=="string")return s;switch(s){case $n:return"Fragment";case Un:return"Portal";case Ec:return"Profiler";case rf:return"StrictMode";case Lc:return"Suspense";case Mc:return"SuspenseList"}if(typeof s=="object")switch(s.$$typeof){case e0:return(s.displayName||"Context")+".Consumer";case Zy:return(s._context.displayName||"Context")+".Provider";case nf:var e=s.render;return s=s.displayName,s||(s=e.displayName||e.name||"",s=s!==""?"ForwardRef("+s+")":"ForwardRef"),s;case af:return e=s.displayName||null,e!==null?e:Fc(s.type)||"Memo";case Tr:e=s._payload,s=s._init;try{return Fc(s(e))}catch{}}return null}function zS(s){var e=s.type;switch(s.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return s=e.render,s=s.displayName||s.name||"",e.displayName||(s!==""?"ForwardRef("+s+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Fc(e);case 8:return e===rf?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function Gr(s){switch(typeof s){case"boolean":case"number":case"string":case"undefined":return s;case"object":return s;default:return""}}function i0(s){var e=s.type;return(s=s.nodeName)&&s.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function GS(s){var e=i0(s)?"checked":"value",t=Object.getOwnPropertyDescriptor(s.constructor.prototype,e),i=""+s[e];if(!s.hasOwnProperty(e)&&typeof t<"u"&&typeof t.get=="function"&&typeof t.set=="function"){var r=t.get,n=t.set;return Object.defineProperty(s,e,{configurable:!0,get:function(){return r.call(this)},set:function(a){i=""+a,n.call(this,a)}}),Object.defineProperty(s,e,{enumerable:t.enumerable}),{getValue:function(){return i},setValue:function(a){i=""+a},stopTracking:function(){s._valueTracker=null,delete s[e]}}}}function yl(s){s._valueTracker||(s._valueTracker=GS(s))}function s0(s){if(!s)return!1;var e=s._valueTracker;if(!e)return!0;var t=e.getValue(),i="";return s&&(i=i0(s)?s.checked?"true":"false":s.value),s=i,s!==t?(e.setValue(s),!0):!1}function sh(s){if(s=s||(typeof document<"u"?document:void 0),typeof s>"u")return null;try{return s.activeElement||s.body}catch{return s.body}}function Rc(s,e){var t=e.checked;return yt({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:t??s._wrapperState.initialChecked})}function Op(s,e){var t=e.defaultValue==null?"":e.defaultValue,i=e.checked!=null?e.checked:e.defaultChecked;t=Gr(e.value!=null?e.value:t),s._wrapperState={initialChecked:i,initialValue:t,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function r0(s,e){e=e.checked,e!=null&&sf(s,"checked",e,!1)}function Dc(s,e){r0(s,e);var t=Gr(e.value),i=e.type;if(t!=null)i==="number"?(t===0&&s.value===""||s.value!=t)&&(s.value=""+t):s.value!==""+t&&(s.value=""+t);else if(i==="submit"||i==="reset"){s.removeAttribute("value");return}e.hasOwnProperty("value")?Ac(s,e.type,t):e.hasOwnProperty("defaultValue")&&Ac(s,e.type,Gr(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(s.defaultChecked=!!e.defaultChecked)}function Vp(s,e,t){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var i=e.type;if(!(i!=="submit"&&i!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+s._wrapperState.initialValue,t||e===s.value||(s.value=e),s.defaultValue=e}t=s.name,t!==""&&(s.name=""),s.defaultChecked=!!s._wrapperState.initialChecked,t!==""&&(s.name=t)}function Ac(s,e,t){(e!=="number"||sh(s.ownerDocument)!==s)&&(t==null?s.defaultValue=""+s._wrapperState.initialValue:s.defaultValue!==""+t&&(s.defaultValue=""+t))}var Ya=Array.isArray;function ra(s,e,t,i){if(s=s.options,e){e={};for(var r=0;r<t.length;r++)e["$"+t[r]]=!0;for(t=0;t<s.length;t++)r=e.hasOwnProperty("$"+s[t].value),s[t].selected!==r&&(s[t].selected=r),r&&i&&(s[t].defaultSelected=!0)}else{for(t=""+Gr(t),e=null,r=0;r<s.length;r++){if(s[r].value===t){s[r].selected=!0,i&&(s[r].defaultSelected=!0);return}e!==null||s[r].disabled||(e=s[r])}e!==null&&(e.selected=!0)}}function Ic(s,e){if(e.dangerouslySetInnerHTML!=null)throw Error(V(91));return yt({},e,{value:void 0,defaultValue:void 0,children:""+s._wrapperState.initialValue})}function Hp(s,e){var t=e.value;if(t==null){if(t=e.children,e=e.defaultValue,t!=null){if(e!=null)throw Error(V(92));if(Ya(t)){if(1<t.length)throw Error(V(93));t=t[0]}e=t}e==null&&(e=""),t=e}s._wrapperState={initialValue:Gr(t)}}function n0(s,e){var t=Gr(e.value),i=Gr(e.defaultValue);t!=null&&(t=""+t,t!==s.value&&(s.value=t),e.defaultValue==null&&s.defaultValue!==t&&(s.defaultValue=t)),i!=null&&(s.defaultValue=""+i)}function Wp(s){var e=s.textContent;e===s._wrapperState.initialValue&&e!==""&&e!==null&&(s.value=e)}function a0(s){switch(s){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Oc(s,e){return s==null||s==="http://www.w3.org/1999/xhtml"?a0(e):s==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":s}var wl,o0=function(s){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,t,i,r){MSApp.execUnsafeLocalFunction(function(){return s(e,t,i,r)})}:s}(function(s,e){if(s.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in s)s.innerHTML=e;else{for(wl=wl||document.createElement("div"),wl.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=wl.firstChild;s.firstChild;)s.removeChild(s.firstChild);for(;e.firstChild;)s.appendChild(e.firstChild)}});function go(s,e){if(e){var t=s.firstChild;if(t&&t===s.lastChild&&t.nodeType===3){t.nodeValue=e;return}}s.textContent=e}var Ka={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},US=["Webkit","ms","Moz","O"];Object.keys(Ka).forEach(function(s){US.forEach(function(e){e=e+s.charAt(0).toUpperCase()+s.substring(1),Ka[e]=Ka[s]})});function l0(s,e,t){return e==null||typeof e=="boolean"||e===""?"":t||typeof e!="number"||e===0||Ka.hasOwnProperty(s)&&Ka[s]?(""+e).trim():e+"px"}function h0(s,e){s=s.style;for(var t in e)if(e.hasOwnProperty(t)){var i=t.indexOf("--")===0,r=l0(t,e[t],i);t==="float"&&(t="cssFloat"),i?s.setProperty(t,r):s[t]=r}}var $S=yt({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Vc(s,e){if(e){if($S[s]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(V(137,s));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(V(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(V(61))}if(e.style!=null&&typeof e.style!="object")throw Error(V(62))}}function Hc(s,e){if(s.indexOf("-")===-1)return typeof e.is=="string";switch(s){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Wc=null;function of(s){return s=s.target||s.srcElement||window,s.correspondingUseElement&&(s=s.correspondingUseElement),s.nodeType===3?s.parentNode:s}var zc=null,na=null,aa=null;function zp(s){if(s=sl(s)){if(typeof zc!="function")throw Error(V(280));var e=s.stateNode;e&&(e=jh(e),zc(s.stateNode,s.type,e))}}function u0(s){na?aa?aa.push(s):aa=[s]:na=s}function c0(){if(na){var s=na,e=aa;if(aa=na=null,zp(s),e)for(s=0;s<e.length;s++)zp(e[s])}}function d0(s,e){return s(e)}function f0(){}var Ou=!1;function p0(s,e,t){if(Ou)return s(e,t);Ou=!0;try{return d0(s,e,t)}finally{Ou=!1,(na!==null||aa!==null)&&(f0(),c0())}}function mo(s,e){var t=s.stateNode;if(t===null)return null;var i=jh(t);if(i===null)return null;t=i[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(i=!i.disabled)||(s=s.type,i=!(s==="button"||s==="input"||s==="select"||s==="textarea")),s=!i;break e;default:s=!1}if(s)return null;if(t&&typeof t!="function")throw Error(V(231,e,typeof t));return t}var Gc=!1;if(dr)try{var Da={};Object.defineProperty(Da,"passive",{get:function(){Gc=!0}}),window.addEventListener("test",Da,Da),window.removeEventListener("test",Da,Da)}catch{Gc=!1}function YS(s,e,t,i,r,n,a,o,l){var h=Array.prototype.slice.call(arguments,3);try{e.apply(t,h)}catch(u){this.onError(u)}}var ja=!1,rh=null,nh=!1,Uc=null,XS={onError:function(s){ja=!0,rh=s}};function QS(s,e,t,i,r,n,a,o,l){ja=!1,rh=null,YS.apply(XS,arguments)}function JS(s,e,t,i,r,n,a,o,l){if(QS.apply(this,arguments),ja){if(ja){var h=rh;ja=!1,rh=null}else throw Error(V(198));nh||(nh=!0,Uc=h)}}function Fn(s){var e=s,t=s;if(s.alternate)for(;e.return;)e=e.return;else{s=e;do e=s,e.flags&4098&&(t=e.return),s=e.return;while(s)}return e.tag===3?t:null}function g0(s){if(s.tag===13){var e=s.memoizedState;if(e===null&&(s=s.alternate,s!==null&&(e=s.memoizedState)),e!==null)return e.dehydrated}return null}function Gp(s){if(Fn(s)!==s)throw Error(V(188))}function qS(s){var e=s.alternate;if(!e){if(e=Fn(s),e===null)throw Error(V(188));return e!==s?null:s}for(var t=s,i=e;;){var r=t.return;if(r===null)break;var n=r.alternate;if(n===null){if(i=r.return,i!==null){t=i;continue}break}if(r.child===n.child){for(n=r.child;n;){if(n===t)return Gp(r),s;if(n===i)return Gp(r),e;n=n.sibling}throw Error(V(188))}if(t.return!==i.return)t=r,i=n;else{for(var a=!1,o=r.child;o;){if(o===t){a=!0,t=r,i=n;break}if(o===i){a=!0,i=r,t=n;break}o=o.sibling}if(!a){for(o=n.child;o;){if(o===t){a=!0,t=n,i=r;break}if(o===i){a=!0,i=n,t=r;break}o=o.sibling}if(!a)throw Error(V(189))}}if(t.alternate!==i)throw Error(V(190))}if(t.tag!==3)throw Error(V(188));return t.stateNode.current===t?s:e}function m0(s){return s=qS(s),s!==null?y0(s):null}function y0(s){if(s.tag===5||s.tag===6)return s;for(s=s.child;s!==null;){var e=y0(s);if(e!==null)return e;s=s.sibling}return null}var w0=Ji.unstable_scheduleCallback,Up=Ji.unstable_cancelCallback,KS=Ji.unstable_shouldYield,jS=Ji.unstable_requestPaint,xt=Ji.unstable_now,ZS=Ji.unstable_getCurrentPriorityLevel,lf=Ji.unstable_ImmediatePriority,b0=Ji.unstable_UserBlockingPriority,ah=Ji.unstable_NormalPriority,ek=Ji.unstable_LowPriority,S0=Ji.unstable_IdlePriority,Qh=null,Us=null;function tk(s){if(Us&&typeof Us.onCommitFiberRoot=="function")try{Us.onCommitFiberRoot(Qh,s,void 0,(s.current.flags&128)===128)}catch{}}var xs=Math.clz32?Math.clz32:rk,ik=Math.log,sk=Math.LN2;function rk(s){return s>>>=0,s===0?32:31-(ik(s)/sk|0)|0}var bl=64,Sl=4194304;function Xa(s){switch(s&-s){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return s&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return s&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return s}}function oh(s,e){var t=s.pendingLanes;if(t===0)return 0;var i=0,r=s.suspendedLanes,n=s.pingedLanes,a=t&268435455;if(a!==0){var o=a&~r;o!==0?i=Xa(o):(n&=a,n!==0&&(i=Xa(n)))}else a=t&~r,a!==0?i=Xa(a):n!==0&&(i=Xa(n));if(i===0)return 0;if(e!==0&&e!==i&&!(e&r)&&(r=i&-i,n=e&-e,r>=n||r===16&&(n&4194240)!==0))return e;if(i&4&&(i|=t&16),e=s.entangledLanes,e!==0)for(s=s.entanglements,e&=i;0<e;)t=31-xs(e),r=1<<t,i|=s[t],e&=~r;return i}function nk(s,e){switch(s){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function ak(s,e){for(var t=s.suspendedLanes,i=s.pingedLanes,r=s.expirationTimes,n=s.pendingLanes;0<n;){var a=31-xs(n),o=1<<a,l=r[a];l===-1?(!(o&t)||o&i)&&(r[a]=nk(o,e)):l<=e&&(s.expiredLanes|=o),n&=~o}}function $c(s){return s=s.pendingLanes&-1073741825,s!==0?s:s&1073741824?1073741824:0}function k0(){var s=bl;return bl<<=1,!(bl&4194240)&&(bl=64),s}function Vu(s){for(var e=[],t=0;31>t;t++)e.push(s);return e}function tl(s,e,t){s.pendingLanes|=e,e!==536870912&&(s.suspendedLanes=0,s.pingedLanes=0),s=s.eventTimes,e=31-xs(e),s[e]=t}function ok(s,e){var t=s.pendingLanes&~e;s.pendingLanes=e,s.suspendedLanes=0,s.pingedLanes=0,s.expiredLanes&=e,s.mutableReadLanes&=e,s.entangledLanes&=e,e=s.entanglements;var i=s.eventTimes;for(s=s.expirationTimes;0<t;){var r=31-xs(t),n=1<<r;e[r]=0,i[r]=-1,s[r]=-1,t&=~n}}function hf(s,e){var t=s.entangledLanes|=e;for(s=s.entanglements;t;){var i=31-xs(t),r=1<<i;r&e|s[i]&e&&(s[i]|=e),t&=~r}}var Xe=0;function _0(s){return s&=-s,1<s?4<s?s&268435455?16:536870912:4:1}var B0,uf,x0,v0,T0,Yc=!1,kl=[],Rr=null,Dr=null,Ar=null,yo=new Map,wo=new Map,Cr=[],lk="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function $p(s,e){switch(s){case"focusin":case"focusout":Rr=null;break;case"dragenter":case"dragleave":Dr=null;break;case"mouseover":case"mouseout":Ar=null;break;case"pointerover":case"pointerout":yo.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":wo.delete(e.pointerId)}}function Aa(s,e,t,i,r,n){return s===null||s.nativeEvent!==n?(s={blockedOn:e,domEventName:t,eventSystemFlags:i,nativeEvent:n,targetContainers:[r]},e!==null&&(e=sl(e),e!==null&&uf(e)),s):(s.eventSystemFlags|=i,e=s.targetContainers,r!==null&&e.indexOf(r)===-1&&e.push(r),s)}function hk(s,e,t,i,r){switch(e){case"focusin":return Rr=Aa(Rr,s,e,t,i,r),!0;case"dragenter":return Dr=Aa(Dr,s,e,t,i,r),!0;case"mouseover":return Ar=Aa(Ar,s,e,t,i,r),!0;case"pointerover":var n=r.pointerId;return yo.set(n,Aa(yo.get(n)||null,s,e,t,i,r)),!0;case"gotpointercapture":return n=r.pointerId,wo.set(n,Aa(wo.get(n)||null,s,e,t,i,r)),!0}return!1}function N0(s){var e=nn(s.target);if(e!==null){var t=Fn(e);if(t!==null){if(e=t.tag,e===13){if(e=g0(t),e!==null){s.blockedOn=e,T0(s.priority,function(){x0(t)});return}}else if(e===3&&t.stateNode.current.memoizedState.isDehydrated){s.blockedOn=t.tag===3?t.stateNode.containerInfo:null;return}}}s.blockedOn=null}function Wl(s){if(s.blockedOn!==null)return!1;for(var e=s.targetContainers;0<e.length;){var t=Xc(s.domEventName,s.eventSystemFlags,e[0],s.nativeEvent);if(t===null){t=s.nativeEvent;var i=new t.constructor(t.type,t);Wc=i,t.target.dispatchEvent(i),Wc=null}else return e=sl(t),e!==null&&uf(e),s.blockedOn=t,!1;e.shift()}return!0}function Yp(s,e,t){Wl(s)&&t.delete(e)}function uk(){Yc=!1,Rr!==null&&Wl(Rr)&&(Rr=null),Dr!==null&&Wl(Dr)&&(Dr=null),Ar!==null&&Wl(Ar)&&(Ar=null),yo.forEach(Yp),wo.forEach(Yp)}function Ia(s,e){s.blockedOn===e&&(s.blockedOn=null,Yc||(Yc=!0,Ji.unstable_scheduleCallback(Ji.unstable_NormalPriority,uk)))}function bo(s){function e(r){return Ia(r,s)}if(0<kl.length){Ia(kl[0],s);for(var t=1;t<kl.length;t++){var i=kl[t];i.blockedOn===s&&(i.blockedOn=null)}}for(Rr!==null&&Ia(Rr,s),Dr!==null&&Ia(Dr,s),Ar!==null&&Ia(Ar,s),yo.forEach(e),wo.forEach(e),t=0;t<Cr.length;t++)i=Cr[t],i.blockedOn===s&&(i.blockedOn=null);for(;0<Cr.length&&(t=Cr[0],t.blockedOn===null);)N0(t),t.blockedOn===null&&Cr.shift()}var oa=br.ReactCurrentBatchConfig,lh=!0;function ck(s,e,t,i){var r=Xe,n=oa.transition;oa.transition=null;try{Xe=1,cf(s,e,t,i)}finally{Xe=r,oa.transition=n}}function dk(s,e,t,i){var r=Xe,n=oa.transition;oa.transition=null;try{Xe=4,cf(s,e,t,i)}finally{Xe=r,oa.transition=n}}function cf(s,e,t,i){if(lh){var r=Xc(s,e,t,i);if(r===null)Ju(s,e,i,hh,t),$p(s,i);else if(hk(r,s,e,t,i))i.stopPropagation();else if($p(s,i),e&4&&-1<lk.indexOf(s)){for(;r!==null;){var n=sl(r);if(n!==null&&B0(n),n=Xc(s,e,t,i),n===null&&Ju(s,e,i,hh,t),n===r)break;r=n}r!==null&&i.stopPropagation()}else Ju(s,e,i,null,t)}}var hh=null;function Xc(s,e,t,i){if(hh=null,s=of(i),s=nn(s),s!==null)if(e=Fn(s),e===null)s=null;else if(t=e.tag,t===13){if(s=g0(e),s!==null)return s;s=null}else if(t===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;s=null}else e!==s&&(s=null);return hh=s,null}function P0(s){switch(s){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(ZS()){case lf:return 1;case b0:return 4;case ah:case ek:return 16;case S0:return 536870912;default:return 16}default:return 16}}var Lr=null,df=null,zl=null;function C0(){if(zl)return zl;var s,e=df,t=e.length,i,r="value"in Lr?Lr.value:Lr.textContent,n=r.length;for(s=0;s<t&&e[s]===r[s];s++);var a=t-s;for(i=1;i<=a&&e[t-i]===r[n-i];i++);return zl=r.slice(s,1<i?1-i:void 0)}function Gl(s){var e=s.keyCode;return"charCode"in s?(s=s.charCode,s===0&&e===13&&(s=13)):s=e,s===10&&(s=13),32<=s||s===13?s:0}function _l(){return!0}function Xp(){return!1}function Zi(s){function e(t,i,r,n,a){this._reactName=t,this._targetInst=r,this.type=i,this.nativeEvent=n,this.target=a,this.currentTarget=null;for(var o in s)s.hasOwnProperty(o)&&(t=s[o],this[o]=t?t(n):n[o]);return this.isDefaultPrevented=(n.defaultPrevented!=null?n.defaultPrevented:n.returnValue===!1)?_l:Xp,this.isPropagationStopped=Xp,this}return yt(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var t=this.nativeEvent;t&&(t.preventDefault?t.preventDefault():typeof t.returnValue!="unknown"&&(t.returnValue=!1),this.isDefaultPrevented=_l)},stopPropagation:function(){var t=this.nativeEvent;t&&(t.stopPropagation?t.stopPropagation():typeof t.cancelBubble!="unknown"&&(t.cancelBubble=!0),this.isPropagationStopped=_l)},persist:function(){},isPersistent:_l}),e}var Ca={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(s){return s.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},ff=Zi(Ca),il=yt({},Ca,{view:0,detail:0}),fk=Zi(il),Hu,Wu,Oa,Jh=yt({},il,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:pf,button:0,buttons:0,relatedTarget:function(s){return s.relatedTarget===void 0?s.fromElement===s.srcElement?s.toElement:s.fromElement:s.relatedTarget},movementX:function(s){return"movementX"in s?s.movementX:(s!==Oa&&(Oa&&s.type==="mousemove"?(Hu=s.screenX-Oa.screenX,Wu=s.screenY-Oa.screenY):Wu=Hu=0,Oa=s),Hu)},movementY:function(s){return"movementY"in s?s.movementY:Wu}}),Qp=Zi(Jh),pk=yt({},Jh,{dataTransfer:0}),gk=Zi(pk),mk=yt({},il,{relatedTarget:0}),zu=Zi(mk),yk=yt({},Ca,{animationName:0,elapsedTime:0,pseudoElement:0}),wk=Zi(yk),bk=yt({},Ca,{clipboardData:function(s){return"clipboardData"in s?s.clipboardData:window.clipboardData}}),Sk=Zi(bk),kk=yt({},Ca,{data:0}),Jp=Zi(kk),_k={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Bk={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},xk={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function vk(s){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(s):(s=xk[s])?!!e[s]:!1}function pf(){return vk}var Tk=yt({},il,{key:function(s){if(s.key){var e=_k[s.key]||s.key;if(e!=="Unidentified")return e}return s.type==="keypress"?(s=Gl(s),s===13?"Enter":String.fromCharCode(s)):s.type==="keydown"||s.type==="keyup"?Bk[s.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:pf,charCode:function(s){return s.type==="keypress"?Gl(s):0},keyCode:function(s){return s.type==="keydown"||s.type==="keyup"?s.keyCode:0},which:function(s){return s.type==="keypress"?Gl(s):s.type==="keydown"||s.type==="keyup"?s.keyCode:0}}),Nk=Zi(Tk),Pk=yt({},Jh,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),qp=Zi(Pk),Ck=yt({},il,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:pf}),Ek=Zi(Ck),Lk=yt({},Ca,{propertyName:0,elapsedTime:0,pseudoElement:0}),Mk=Zi(Lk),Fk=yt({},Jh,{deltaX:function(s){return"deltaX"in s?s.deltaX:"wheelDeltaX"in s?-s.wheelDeltaX:0},deltaY:function(s){return"deltaY"in s?s.deltaY:"wheelDeltaY"in s?-s.wheelDeltaY:"wheelDelta"in s?-s.wheelDelta:0},deltaZ:0,deltaMode:0}),Rk=Zi(Fk),Dk=[9,13,27,32],gf=dr&&"CompositionEvent"in window,Za=null;dr&&"documentMode"in document&&(Za=document.documentMode);var Ak=dr&&"TextEvent"in window&&!Za,E0=dr&&(!gf||Za&&8<Za&&11>=Za),Kp=" ",jp=!1;function L0(s,e){switch(s){case"keyup":return Dk.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function M0(s){return s=s.detail,typeof s=="object"&&"data"in s?s.data:null}var Yn=!1;function Ik(s,e){switch(s){case"compositionend":return M0(e);case"keypress":return e.which!==32?null:(jp=!0,Kp);case"textInput":return s=e.data,s===Kp&&jp?null:s;default:return null}}function Ok(s,e){if(Yn)return s==="compositionend"||!gf&&L0(s,e)?(s=C0(),zl=df=Lr=null,Yn=!1,s):null;switch(s){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return E0&&e.locale!=="ko"?null:e.data;default:return null}}var Vk={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Zp(s){var e=s&&s.nodeName&&s.nodeName.toLowerCase();return e==="input"?!!Vk[s.type]:e==="textarea"}function F0(s,e,t,i){u0(i),e=uh(e,"onChange"),0<e.length&&(t=new ff("onChange","change",null,t,i),s.push({event:t,listeners:e}))}var eo=null,So=null;function Hk(s){U0(s,0)}function qh(s){var e=Jn(s);if(s0(e))return s}function Wk(s,e){if(s==="change")return e}var R0=!1;if(dr){var Gu;if(dr){var Uu="oninput"in document;if(!Uu){var eg=document.createElement("div");eg.setAttribute("oninput","return;"),Uu=typeof eg.oninput=="function"}Gu=Uu}else Gu=!1;R0=Gu&&(!document.documentMode||9<document.documentMode)}function tg(){eo&&(eo.detachEvent("onpropertychange",D0),So=eo=null)}function D0(s){if(s.propertyName==="value"&&qh(So)){var e=[];F0(e,So,s,of(s)),p0(Hk,e)}}function zk(s,e,t){s==="focusin"?(tg(),eo=e,So=t,eo.attachEvent("onpropertychange",D0)):s==="focusout"&&tg()}function Gk(s){if(s==="selectionchange"||s==="keyup"||s==="keydown")return qh(So)}function Uk(s,e){if(s==="click")return qh(e)}function $k(s,e){if(s==="input"||s==="change")return qh(e)}function Yk(s,e){return s===e&&(s!==0||1/s===1/e)||s!==s&&e!==e}var Ps=typeof Object.is=="function"?Object.is:Yk;function ko(s,e){if(Ps(s,e))return!0;if(typeof s!="object"||s===null||typeof e!="object"||e===null)return!1;var t=Object.keys(s),i=Object.keys(e);if(t.length!==i.length)return!1;for(i=0;i<t.length;i++){var r=t[i];if(!Cc.call(e,r)||!Ps(s[r],e[r]))return!1}return!0}function ig(s){for(;s&&s.firstChild;)s=s.firstChild;return s}function sg(s,e){var t=ig(s);s=0;for(var i;t;){if(t.nodeType===3){if(i=s+t.textContent.length,s<=e&&i>=e)return{node:t,offset:e-s};s=i}e:{for(;t;){if(t.nextSibling){t=t.nextSibling;break e}t=t.parentNode}t=void 0}t=ig(t)}}function A0(s,e){return s&&e?s===e?!0:s&&s.nodeType===3?!1:e&&e.nodeType===3?A0(s,e.parentNode):"contains"in s?s.contains(e):s.compareDocumentPosition?!!(s.compareDocumentPosition(e)&16):!1:!1}function I0(){for(var s=window,e=sh();e instanceof s.HTMLIFrameElement;){try{var t=typeof e.contentWindow.location.href=="string"}catch{t=!1}if(t)s=e.contentWindow;else break;e=sh(s.document)}return e}function mf(s){var e=s&&s.nodeName&&s.nodeName.toLowerCase();return e&&(e==="input"&&(s.type==="text"||s.type==="search"||s.type==="tel"||s.type==="url"||s.type==="password")||e==="textarea"||s.contentEditable==="true")}function Xk(s){var e=I0(),t=s.focusedElem,i=s.selectionRange;if(e!==t&&t&&t.ownerDocument&&A0(t.ownerDocument.documentElement,t)){if(i!==null&&mf(t)){if(e=i.start,s=i.end,s===void 0&&(s=e),"selectionStart"in t)t.selectionStart=e,t.selectionEnd=Math.min(s,t.value.length);else if(s=(e=t.ownerDocument||document)&&e.defaultView||window,s.getSelection){s=s.getSelection();var r=t.textContent.length,n=Math.min(i.start,r);i=i.end===void 0?n:Math.min(i.end,r),!s.extend&&n>i&&(r=i,i=n,n=r),r=sg(t,n);var a=sg(t,i);r&&a&&(s.rangeCount!==1||s.anchorNode!==r.node||s.anchorOffset!==r.offset||s.focusNode!==a.node||s.focusOffset!==a.offset)&&(e=e.createRange(),e.setStart(r.node,r.offset),s.removeAllRanges(),n>i?(s.addRange(e),s.extend(a.node,a.offset)):(e.setEnd(a.node,a.offset),s.addRange(e)))}}for(e=[],s=t;s=s.parentNode;)s.nodeType===1&&e.push({element:s,left:s.scrollLeft,top:s.scrollTop});for(typeof t.focus=="function"&&t.focus(),t=0;t<e.length;t++)s=e[t],s.element.scrollLeft=s.left,s.element.scrollTop=s.top}}var Qk=dr&&"documentMode"in document&&11>=document.documentMode,Xn=null,Qc=null,to=null,Jc=!1;function rg(s,e,t){var i=t.window===t?t.document:t.nodeType===9?t:t.ownerDocument;Jc||Xn==null||Xn!==sh(i)||(i=Xn,"selectionStart"in i&&mf(i)?i={start:i.selectionStart,end:i.selectionEnd}:(i=(i.ownerDocument&&i.ownerDocument.defaultView||window).getSelection(),i={anchorNode:i.anchorNode,anchorOffset:i.anchorOffset,focusNode:i.focusNode,focusOffset:i.focusOffset}),to&&ko(to,i)||(to=i,i=uh(Qc,"onSelect"),0<i.length&&(e=new ff("onSelect","select",null,e,t),s.push({event:e,listeners:i}),e.target=Xn)))}function Bl(s,e){var t={};return t[s.toLowerCase()]=e.toLowerCase(),t["Webkit"+s]="webkit"+e,t["Moz"+s]="moz"+e,t}var Qn={animationend:Bl("Animation","AnimationEnd"),animationiteration:Bl("Animation","AnimationIteration"),animationstart:Bl("Animation","AnimationStart"),transitionend:Bl("Transition","TransitionEnd")},$u={},O0={};dr&&(O0=document.createElement("div").style,"AnimationEvent"in window||(delete Qn.animationend.animation,delete Qn.animationiteration.animation,delete Qn.animationstart.animation),"TransitionEvent"in window||delete Qn.transitionend.transition);function Kh(s){if($u[s])return $u[s];if(!Qn[s])return s;var e=Qn[s],t;for(t in e)if(e.hasOwnProperty(t)&&t in O0)return $u[s]=e[t];return s}var V0=Kh("animationend"),H0=Kh("animationiteration"),W0=Kh("animationstart"),z0=Kh("transitionend"),G0=new Map,ng="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Jr(s,e){G0.set(s,e),Mn(e,[s])}for(var Yu=0;Yu<ng.length;Yu++){var Xu=ng[Yu],Jk=Xu.toLowerCase(),qk=Xu[0].toUpperCase()+Xu.slice(1);Jr(Jk,"on"+qk)}Jr(V0,"onAnimationEnd");Jr(H0,"onAnimationIteration");Jr(W0,"onAnimationStart");Jr("dblclick","onDoubleClick");Jr("focusin","onFocus");Jr("focusout","onBlur");Jr(z0,"onTransitionEnd");ca("onMouseEnter",["mouseout","mouseover"]);ca("onMouseLeave",["mouseout","mouseover"]);ca("onPointerEnter",["pointerout","pointerover"]);ca("onPointerLeave",["pointerout","pointerover"]);Mn("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Mn("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Mn("onBeforeInput",["compositionend","keypress","textInput","paste"]);Mn("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Mn("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Mn("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Qa="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Kk=new Set("cancel close invalid load scroll toggle".split(" ").concat(Qa));function ag(s,e,t){var i=s.type||"unknown-event";s.currentTarget=t,JS(i,e,void 0,s),s.currentTarget=null}function U0(s,e){e=(e&4)!==0;for(var t=0;t<s.length;t++){var i=s[t],r=i.event;i=i.listeners;e:{var n=void 0;if(e)for(var a=i.length-1;0<=a;a--){var o=i[a],l=o.instance,h=o.currentTarget;if(o=o.listener,l!==n&&r.isPropagationStopped())break e;ag(r,o,h),n=l}else for(a=0;a<i.length;a++){if(o=i[a],l=o.instance,h=o.currentTarget,o=o.listener,l!==n&&r.isPropagationStopped())break e;ag(r,o,h),n=l}}}if(nh)throw s=Uc,nh=!1,Uc=null,s}function tt(s,e){var t=e[ed];t===void 0&&(t=e[ed]=new Set);var i=s+"__bubble";t.has(i)||($0(e,s,2,!1),t.add(i))}function Qu(s,e,t){var i=0;e&&(i|=4),$0(t,s,i,e)}var xl="_reactListening"+Math.random().toString(36).slice(2);function _o(s){if(!s[xl]){s[xl]=!0,jy.forEach(function(t){t!=="selectionchange"&&(Kk.has(t)||Qu(t,!1,s),Qu(t,!0,s))});var e=s.nodeType===9?s:s.ownerDocument;e===null||e[xl]||(e[xl]=!0,Qu("selectionchange",!1,e))}}function $0(s,e,t,i){switch(P0(e)){case 1:var r=ck;break;case 4:r=dk;break;default:r=cf}t=r.bind(null,e,t,s),r=void 0,!Gc||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(r=!0),i?r!==void 0?s.addEventListener(e,t,{capture:!0,passive:r}):s.addEventListener(e,t,!0):r!==void 0?s.addEventListener(e,t,{passive:r}):s.addEventListener(e,t,!1)}function Ju(s,e,t,i,r){var n=i;if(!(e&1)&&!(e&2)&&i!==null)e:for(;;){if(i===null)return;var a=i.tag;if(a===3||a===4){var o=i.stateNode.containerInfo;if(o===r||o.nodeType===8&&o.parentNode===r)break;if(a===4)for(a=i.return;a!==null;){var l=a.tag;if((l===3||l===4)&&(l=a.stateNode.containerInfo,l===r||l.nodeType===8&&l.parentNode===r))return;a=a.return}for(;o!==null;){if(a=nn(o),a===null)return;if(l=a.tag,l===5||l===6){i=n=a;continue e}o=o.parentNode}}i=i.return}p0(function(){var h=n,u=of(t),c=[];e:{var d=G0.get(s);if(d!==void 0){var p=ff,g=s;switch(s){case"keypress":if(Gl(t)===0)break e;case"keydown":case"keyup":p=Nk;break;case"focusin":g="focus",p=zu;break;case"focusout":g="blur",p=zu;break;case"beforeblur":case"afterblur":p=zu;break;case"click":if(t.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":p=Qp;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":p=gk;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":p=Ek;break;case V0:case H0:case W0:p=wk;break;case z0:p=Mk;break;case"scroll":p=fk;break;case"wheel":p=Rk;break;case"copy":case"cut":case"paste":p=Sk;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":p=qp}var w=(e&4)!==0,S=!w&&s==="scroll",b=w?d!==null?d+"Capture":null:d;w=[];for(var m=h,y;m!==null;){y=m;var B=y.stateNode;if(y.tag===5&&B!==null&&(y=B,b!==null&&(B=mo(m,b),B!=null&&w.push(Bo(m,B,y)))),S)break;m=m.return}0<w.length&&(d=new p(d,g,null,t,u),c.push({event:d,listeners:w}))}}if(!(e&7)){e:{if(d=s==="mouseover"||s==="pointerover",p=s==="mouseout"||s==="pointerout",d&&t!==Wc&&(g=t.relatedTarget||t.fromElement)&&(nn(g)||g[fr]))break e;if((p||d)&&(d=u.window===u?u:(d=u.ownerDocument)?d.defaultView||d.parentWindow:window,p?(g=t.relatedTarget||t.toElement,p=h,g=g?nn(g):null,g!==null&&(S=Fn(g),g!==S||g.tag!==5&&g.tag!==6)&&(g=null)):(p=null,g=h),p!==g)){if(w=Qp,B="onMouseLeave",b="onMouseEnter",m="mouse",(s==="pointerout"||s==="pointerover")&&(w=qp,B="onPointerLeave",b="onPointerEnter",m="pointer"),S=p==null?d:Jn(p),y=g==null?d:Jn(g),d=new w(B,m+"leave",p,t,u),d.target=S,d.relatedTarget=y,B=null,nn(u)===h&&(w=new w(b,m+"enter",g,t,u),w.target=y,w.relatedTarget=S,B=w),S=B,p&&g)t:{for(w=p,b=g,m=0,y=w;y;y=On(y))m++;for(y=0,B=b;B;B=On(B))y++;for(;0<m-y;)w=On(w),m--;for(;0<y-m;)b=On(b),y--;for(;m--;){if(w===b||b!==null&&w===b.alternate)break t;w=On(w),b=On(b)}w=null}else w=null;p!==null&&og(c,d,p,w,!1),g!==null&&S!==null&&og(c,S,g,w,!0)}}e:{if(d=h?Jn(h):window,p=d.nodeName&&d.nodeName.toLowerCase(),p==="select"||p==="input"&&d.type==="file")var _=Wk;else if(Zp(d))if(R0)_=$k;else{_=Gk;var P=zk}else(p=d.nodeName)&&p.toLowerCase()==="input"&&(d.type==="checkbox"||d.type==="radio")&&(_=Uk);if(_&&(_=_(s,h))){F0(c,_,t,u);break e}P&&P(s,d,h),s==="focusout"&&(P=d._wrapperState)&&P.controlled&&d.type==="number"&&Ac(d,"number",d.value)}switch(P=h?Jn(h):window,s){case"focusin":(Zp(P)||P.contentEditable==="true")&&(Xn=P,Qc=h,to=null);break;case"focusout":to=Qc=Xn=null;break;case"mousedown":Jc=!0;break;case"contextmenu":case"mouseup":case"dragend":Jc=!1,rg(c,t,u);break;case"selectionchange":if(Qk)break;case"keydown":case"keyup":rg(c,t,u)}var N;if(gf)e:{switch(s){case"compositionstart":var D="onCompositionStart";break e;case"compositionend":D="onCompositionEnd";break e;case"compositionupdate":D="onCompositionUpdate";break e}D=void 0}else Yn?L0(s,t)&&(D="onCompositionEnd"):s==="keydown"&&t.keyCode===229&&(D="onCompositionStart");D&&(E0&&t.locale!=="ko"&&(Yn||D!=="onCompositionStart"?D==="onCompositionEnd"&&Yn&&(N=C0()):(Lr=u,df="value"in Lr?Lr.value:Lr.textContent,Yn=!0)),P=uh(h,D),0<P.length&&(D=new Jp(D,s,null,t,u),c.push({event:D,listeners:P}),N?D.data=N:(N=M0(t),N!==null&&(D.data=N)))),(N=Ak?Ik(s,t):Ok(s,t))&&(h=uh(h,"onBeforeInput"),0<h.length&&(u=new Jp("onBeforeInput","beforeinput",null,t,u),c.push({event:u,listeners:h}),u.data=N))}U0(c,e)})}function Bo(s,e,t){return{instance:s,listener:e,currentTarget:t}}function uh(s,e){for(var t=e+"Capture",i=[];s!==null;){var r=s,n=r.stateNode;r.tag===5&&n!==null&&(r=n,n=mo(s,t),n!=null&&i.unshift(Bo(s,n,r)),n=mo(s,e),n!=null&&i.push(Bo(s,n,r))),s=s.return}return i}function On(s){if(s===null)return null;do s=s.return;while(s&&s.tag!==5);return s||null}function og(s,e,t,i,r){for(var n=e._reactName,a=[];t!==null&&t!==i;){var o=t,l=o.alternate,h=o.stateNode;if(l!==null&&l===i)break;o.tag===5&&h!==null&&(o=h,r?(l=mo(t,n),l!=null&&a.unshift(Bo(t,l,o))):r||(l=mo(t,n),l!=null&&a.push(Bo(t,l,o)))),t=t.return}a.length!==0&&s.push({event:e,listeners:a})}var jk=/\r\n?/g,Zk=/\u0000|\uFFFD/g;function lg(s){return(typeof s=="string"?s:""+s).replace(jk,`
`).replace(Zk,"")}function vl(s,e,t){if(e=lg(e),lg(s)!==e&&t)throw Error(V(425))}function ch(){}var qc=null,Kc=null;function jc(s,e){return s==="textarea"||s==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var Zc=typeof setTimeout=="function"?setTimeout:void 0,e_=typeof clearTimeout=="function"?clearTimeout:void 0,hg=typeof Promise=="function"?Promise:void 0,t_=typeof queueMicrotask=="function"?queueMicrotask:typeof hg<"u"?function(s){return hg.resolve(null).then(s).catch(i_)}:Zc;function i_(s){setTimeout(function(){throw s})}function qu(s,e){var t=e,i=0;do{var r=t.nextSibling;if(s.removeChild(t),r&&r.nodeType===8)if(t=r.data,t==="/$"){if(i===0){s.removeChild(r),bo(e);return}i--}else t!=="$"&&t!=="$?"&&t!=="$!"||i++;t=r}while(t);bo(e)}function Ir(s){for(;s!=null;s=s.nextSibling){var e=s.nodeType;if(e===1||e===3)break;if(e===8){if(e=s.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return s}function ug(s){s=s.previousSibling;for(var e=0;s;){if(s.nodeType===8){var t=s.data;if(t==="$"||t==="$!"||t==="$?"){if(e===0)return s;e--}else t==="/$"&&e++}s=s.previousSibling}return null}var Ea=Math.random().toString(36).slice(2),Hs="__reactFiber$"+Ea,xo="__reactProps$"+Ea,fr="__reactContainer$"+Ea,ed="__reactEvents$"+Ea,s_="__reactListeners$"+Ea,r_="__reactHandles$"+Ea;function nn(s){var e=s[Hs];if(e)return e;for(var t=s.parentNode;t;){if(e=t[fr]||t[Hs]){if(t=e.alternate,e.child!==null||t!==null&&t.child!==null)for(s=ug(s);s!==null;){if(t=s[Hs])return t;s=ug(s)}return e}s=t,t=s.parentNode}return null}function sl(s){return s=s[Hs]||s[fr],!s||s.tag!==5&&s.tag!==6&&s.tag!==13&&s.tag!==3?null:s}function Jn(s){if(s.tag===5||s.tag===6)return s.stateNode;throw Error(V(33))}function jh(s){return s[xo]||null}var td=[],qn=-1;function qr(s){return{current:s}}function st(s){0>qn||(s.current=td[qn],td[qn]=null,qn--)}function Ze(s,e){qn++,td[qn]=s.current,s.current=e}var Ur={},pi=qr(Ur),Fi=qr(!1),Sn=Ur;function da(s,e){var t=s.type.contextTypes;if(!t)return Ur;var i=s.stateNode;if(i&&i.__reactInternalMemoizedUnmaskedChildContext===e)return i.__reactInternalMemoizedMaskedChildContext;var r={},n;for(n in t)r[n]=e[n];return i&&(s=s.stateNode,s.__reactInternalMemoizedUnmaskedChildContext=e,s.__reactInternalMemoizedMaskedChildContext=r),r}function Ri(s){return s=s.childContextTypes,s!=null}function dh(){st(Fi),st(pi)}function cg(s,e,t){if(pi.current!==Ur)throw Error(V(168));Ze(pi,e),Ze(Fi,t)}function Y0(s,e,t){var i=s.stateNode;if(e=e.childContextTypes,typeof i.getChildContext!="function")return t;i=i.getChildContext();for(var r in i)if(!(r in e))throw Error(V(108,zS(s)||"Unknown",r));return yt({},t,i)}function fh(s){return s=(s=s.stateNode)&&s.__reactInternalMemoizedMergedChildContext||Ur,Sn=pi.current,Ze(pi,s),Ze(Fi,Fi.current),!0}function dg(s,e,t){var i=s.stateNode;if(!i)throw Error(V(169));t?(s=Y0(s,e,Sn),i.__reactInternalMemoizedMergedChildContext=s,st(Fi),st(pi),Ze(pi,s)):st(Fi),Ze(Fi,t)}var js=null,Zh=!1,Ku=!1;function X0(s){js===null?js=[s]:js.push(s)}function n_(s){Zh=!0,X0(s)}function Kr(){if(!Ku&&js!==null){Ku=!0;var s=0,e=Xe;try{var t=js;for(Xe=1;s<t.length;s++){var i=t[s];do i=i(!0);while(i!==null)}js=null,Zh=!1}catch(r){throw js!==null&&(js=js.slice(s+1)),w0(lf,Kr),r}finally{Xe=e,Ku=!1}}return null}var Kn=[],jn=0,ph=null,gh=0,is=[],ss=0,kn=null,sr=1,rr="";function en(s,e){Kn[jn++]=gh,Kn[jn++]=ph,ph=s,gh=e}function Q0(s,e,t){is[ss++]=sr,is[ss++]=rr,is[ss++]=kn,kn=s;var i=sr;s=rr;var r=32-xs(i)-1;i&=~(1<<r),t+=1;var n=32-xs(e)+r;if(30<n){var a=r-r%5;n=(i&(1<<a)-1).toString(32),i>>=a,r-=a,sr=1<<32-xs(e)+r|t<<r|i,rr=n+s}else sr=1<<n|t<<r|i,rr=s}function yf(s){s.return!==null&&(en(s,1),Q0(s,1,0))}function wf(s){for(;s===ph;)ph=Kn[--jn],Kn[jn]=null,gh=Kn[--jn],Kn[jn]=null;for(;s===kn;)kn=is[--ss],is[ss]=null,rr=is[--ss],is[ss]=null,sr=is[--ss],is[ss]=null}var Yi=null,Gi=null,lt=!1,ms=null;function J0(s,e){var t=as(5,null,null,0);t.elementType="DELETED",t.stateNode=e,t.return=s,e=s.deletions,e===null?(s.deletions=[t],s.flags|=16):e.push(t)}function fg(s,e){switch(s.tag){case 5:var t=s.type;return e=e.nodeType!==1||t.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(s.stateNode=e,Yi=s,Gi=Ir(e.firstChild),!0):!1;case 6:return e=s.pendingProps===""||e.nodeType!==3?null:e,e!==null?(s.stateNode=e,Yi=s,Gi=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(t=kn!==null?{id:sr,overflow:rr}:null,s.memoizedState={dehydrated:e,treeContext:t,retryLane:1073741824},t=as(18,null,null,0),t.stateNode=e,t.return=s,s.child=t,Yi=s,Gi=null,!0):!1;default:return!1}}function id(s){return(s.mode&1)!==0&&(s.flags&128)===0}function sd(s){if(lt){var e=Gi;if(e){var t=e;if(!fg(s,e)){if(id(s))throw Error(V(418));e=Ir(t.nextSibling);var i=Yi;e&&fg(s,e)?J0(i,t):(s.flags=s.flags&-4097|2,lt=!1,Yi=s)}}else{if(id(s))throw Error(V(418));s.flags=s.flags&-4097|2,lt=!1,Yi=s}}}function pg(s){for(s=s.return;s!==null&&s.tag!==5&&s.tag!==3&&s.tag!==13;)s=s.return;Yi=s}function Tl(s){if(s!==Yi)return!1;if(!lt)return pg(s),lt=!0,!1;var e;if((e=s.tag!==3)&&!(e=s.tag!==5)&&(e=s.type,e=e!=="head"&&e!=="body"&&!jc(s.type,s.memoizedProps)),e&&(e=Gi)){if(id(s))throw q0(),Error(V(418));for(;e;)J0(s,e),e=Ir(e.nextSibling)}if(pg(s),s.tag===13){if(s=s.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(V(317));e:{for(s=s.nextSibling,e=0;s;){if(s.nodeType===8){var t=s.data;if(t==="/$"){if(e===0){Gi=Ir(s.nextSibling);break e}e--}else t!=="$"&&t!=="$!"&&t!=="$?"||e++}s=s.nextSibling}Gi=null}}else Gi=Yi?Ir(s.stateNode.nextSibling):null;return!0}function q0(){for(var s=Gi;s;)s=Ir(s.nextSibling)}function fa(){Gi=Yi=null,lt=!1}function bf(s){ms===null?ms=[s]:ms.push(s)}var a_=br.ReactCurrentBatchConfig;function fs(s,e){if(s&&s.defaultProps){e=yt({},e),s=s.defaultProps;for(var t in s)e[t]===void 0&&(e[t]=s[t]);return e}return e}var mh=qr(null),yh=null,Zn=null,Sf=null;function kf(){Sf=Zn=yh=null}function _f(s){var e=mh.current;st(mh),s._currentValue=e}function rd(s,e,t){for(;s!==null;){var i=s.alternate;if((s.childLanes&e)!==e?(s.childLanes|=e,i!==null&&(i.childLanes|=e)):i!==null&&(i.childLanes&e)!==e&&(i.childLanes|=e),s===t)break;s=s.return}}function la(s,e){yh=s,Sf=Zn=null,s=s.dependencies,s!==null&&s.firstContext!==null&&(s.lanes&e&&(Li=!0),s.firstContext=null)}function ls(s){var e=s._currentValue;if(Sf!==s)if(s={context:s,memoizedValue:e,next:null},Zn===null){if(yh===null)throw Error(V(308));Zn=s,yh.dependencies={lanes:0,firstContext:s}}else Zn=Zn.next=s;return e}var an=null;function Bf(s){an===null?an=[s]:an.push(s)}function K0(s,e,t,i){var r=e.interleaved;return r===null?(t.next=t,Bf(e)):(t.next=r.next,r.next=t),e.interleaved=t,pr(s,i)}function pr(s,e){s.lanes|=e;var t=s.alternate;for(t!==null&&(t.lanes|=e),t=s,s=s.return;s!==null;)s.childLanes|=e,t=s.alternate,t!==null&&(t.childLanes|=e),t=s,s=s.return;return t.tag===3?t.stateNode:null}var Nr=!1;function xf(s){s.updateQueue={baseState:s.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function j0(s,e){s=s.updateQueue,e.updateQueue===s&&(e.updateQueue={baseState:s.baseState,firstBaseUpdate:s.firstBaseUpdate,lastBaseUpdate:s.lastBaseUpdate,shared:s.shared,effects:s.effects})}function hr(s,e){return{eventTime:s,lane:e,tag:0,payload:null,callback:null,next:null}}function Or(s,e,t){var i=s.updateQueue;if(i===null)return null;if(i=i.shared,Ie&2){var r=i.pending;return r===null?e.next=e:(e.next=r.next,r.next=e),i.pending=e,pr(s,t)}return r=i.interleaved,r===null?(e.next=e,Bf(i)):(e.next=r.next,r.next=e),i.interleaved=e,pr(s,t)}function Ul(s,e,t){if(e=e.updateQueue,e!==null&&(e=e.shared,(t&4194240)!==0)){var i=e.lanes;i&=s.pendingLanes,t|=i,e.lanes=t,hf(s,t)}}function gg(s,e){var t=s.updateQueue,i=s.alternate;if(i!==null&&(i=i.updateQueue,t===i)){var r=null,n=null;if(t=t.firstBaseUpdate,t!==null){do{var a={eventTime:t.eventTime,lane:t.lane,tag:t.tag,payload:t.payload,callback:t.callback,next:null};n===null?r=n=a:n=n.next=a,t=t.next}while(t!==null);n===null?r=n=e:n=n.next=e}else r=n=e;t={baseState:i.baseState,firstBaseUpdate:r,lastBaseUpdate:n,shared:i.shared,effects:i.effects},s.updateQueue=t;return}s=t.lastBaseUpdate,s===null?t.firstBaseUpdate=e:s.next=e,t.lastBaseUpdate=e}function wh(s,e,t,i){var r=s.updateQueue;Nr=!1;var n=r.firstBaseUpdate,a=r.lastBaseUpdate,o=r.shared.pending;if(o!==null){r.shared.pending=null;var l=o,h=l.next;l.next=null,a===null?n=h:a.next=h,a=l;var u=s.alternate;u!==null&&(u=u.updateQueue,o=u.lastBaseUpdate,o!==a&&(o===null?u.firstBaseUpdate=h:o.next=h,u.lastBaseUpdate=l))}if(n!==null){var c=r.baseState;a=0,u=h=l=null,o=n;do{var d=o.lane,p=o.eventTime;if((i&d)===d){u!==null&&(u=u.next={eventTime:p,lane:0,tag:o.tag,payload:o.payload,callback:o.callback,next:null});e:{var g=s,w=o;switch(d=e,p=t,w.tag){case 1:if(g=w.payload,typeof g=="function"){c=g.call(p,c,d);break e}c=g;break e;case 3:g.flags=g.flags&-65537|128;case 0:if(g=w.payload,d=typeof g=="function"?g.call(p,c,d):g,d==null)break e;c=yt({},c,d);break e;case 2:Nr=!0}}o.callback!==null&&o.lane!==0&&(s.flags|=64,d=r.effects,d===null?r.effects=[o]:d.push(o))}else p={eventTime:p,lane:d,tag:o.tag,payload:o.payload,callback:o.callback,next:null},u===null?(h=u=p,l=c):u=u.next=p,a|=d;if(o=o.next,o===null){if(o=r.shared.pending,o===null)break;d=o,o=d.next,d.next=null,r.lastBaseUpdate=d,r.shared.pending=null}}while(!0);if(u===null&&(l=c),r.baseState=l,r.firstBaseUpdate=h,r.lastBaseUpdate=u,e=r.shared.interleaved,e!==null){r=e;do a|=r.lane,r=r.next;while(r!==e)}else n===null&&(r.shared.lanes=0);Bn|=a,s.lanes=a,s.memoizedState=c}}function mg(s,e,t){if(s=e.effects,e.effects=null,s!==null)for(e=0;e<s.length;e++){var i=s[e],r=i.callback;if(r!==null){if(i.callback=null,i=t,typeof r!="function")throw Error(V(191,r));r.call(i)}}}var Z0=new Ky.Component().refs;function nd(s,e,t,i){e=s.memoizedState,t=t(i,e),t=t==null?e:yt({},e,t),s.memoizedState=t,s.lanes===0&&(s.updateQueue.baseState=t)}var eu={isMounted:function(s){return(s=s._reactInternals)?Fn(s)===s:!1},enqueueSetState:function(s,e,t){s=s._reactInternals;var i=_i(),r=Hr(s),n=hr(i,r);n.payload=e,t!=null&&(n.callback=t),e=Or(s,n,r),e!==null&&(vs(e,s,r,i),Ul(e,s,r))},enqueueReplaceState:function(s,e,t){s=s._reactInternals;var i=_i(),r=Hr(s),n=hr(i,r);n.tag=1,n.payload=e,t!=null&&(n.callback=t),e=Or(s,n,r),e!==null&&(vs(e,s,r,i),Ul(e,s,r))},enqueueForceUpdate:function(s,e){s=s._reactInternals;var t=_i(),i=Hr(s),r=hr(t,i);r.tag=2,e!=null&&(r.callback=e),e=Or(s,r,i),e!==null&&(vs(e,s,i,t),Ul(e,s,i))}};function yg(s,e,t,i,r,n,a){return s=s.stateNode,typeof s.shouldComponentUpdate=="function"?s.shouldComponentUpdate(i,n,a):e.prototype&&e.prototype.isPureReactComponent?!ko(t,i)||!ko(r,n):!0}function e1(s,e,t){var i=!1,r=Ur,n=e.contextType;return typeof n=="object"&&n!==null?n=ls(n):(r=Ri(e)?Sn:pi.current,i=e.contextTypes,n=(i=i!=null)?da(s,r):Ur),e=new e(t,n),s.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=eu,s.stateNode=e,e._reactInternals=s,i&&(s=s.stateNode,s.__reactInternalMemoizedUnmaskedChildContext=r,s.__reactInternalMemoizedMaskedChildContext=n),e}function wg(s,e,t,i){s=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(t,i),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(t,i),e.state!==s&&eu.enqueueReplaceState(e,e.state,null)}function ad(s,e,t,i){var r=s.stateNode;r.props=t,r.state=s.memoizedState,r.refs=Z0,xf(s);var n=e.contextType;typeof n=="object"&&n!==null?r.context=ls(n):(n=Ri(e)?Sn:pi.current,r.context=da(s,n)),r.state=s.memoizedState,n=e.getDerivedStateFromProps,typeof n=="function"&&(nd(s,e,n,t),r.state=s.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof r.getSnapshotBeforeUpdate=="function"||typeof r.UNSAFE_componentWillMount!="function"&&typeof r.componentWillMount!="function"||(e=r.state,typeof r.componentWillMount=="function"&&r.componentWillMount(),typeof r.UNSAFE_componentWillMount=="function"&&r.UNSAFE_componentWillMount(),e!==r.state&&eu.enqueueReplaceState(r,r.state,null),wh(s,t,r,i),r.state=s.memoizedState),typeof r.componentDidMount=="function"&&(s.flags|=4194308)}function Va(s,e,t){if(s=t.ref,s!==null&&typeof s!="function"&&typeof s!="object"){if(t._owner){if(t=t._owner,t){if(t.tag!==1)throw Error(V(309));var i=t.stateNode}if(!i)throw Error(V(147,s));var r=i,n=""+s;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===n?e.ref:(e=function(a){var o=r.refs;o===Z0&&(o=r.refs={}),a===null?delete o[n]:o[n]=a},e._stringRef=n,e)}if(typeof s!="string")throw Error(V(284));if(!t._owner)throw Error(V(290,s))}return s}function Nl(s,e){throw s=Object.prototype.toString.call(e),Error(V(31,s==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":s))}function bg(s){var e=s._init;return e(s._payload)}function t1(s){function e(b,m){if(s){var y=b.deletions;y===null?(b.deletions=[m],b.flags|=16):y.push(m)}}function t(b,m){if(!s)return null;for(;m!==null;)e(b,m),m=m.sibling;return null}function i(b,m){for(b=new Map;m!==null;)m.key!==null?b.set(m.key,m):b.set(m.index,m),m=m.sibling;return b}function r(b,m){return b=Wr(b,m),b.index=0,b.sibling=null,b}function n(b,m,y){return b.index=y,s?(y=b.alternate,y!==null?(y=y.index,y<m?(b.flags|=2,m):y):(b.flags|=2,m)):(b.flags|=1048576,m)}function a(b){return s&&b.alternate===null&&(b.flags|=2),b}function o(b,m,y,B){return m===null||m.tag!==6?(m=rc(y,b.mode,B),m.return=b,m):(m=r(m,y),m.return=b,m)}function l(b,m,y,B){var _=y.type;return _===$n?u(b,m,y.props.children,B,y.key):m!==null&&(m.elementType===_||typeof _=="object"&&_!==null&&_.$$typeof===Tr&&bg(_)===m.type)?(B=r(m,y.props),B.ref=Va(b,m,y),B.return=b,B):(B=ql(y.type,y.key,y.props,null,b.mode,B),B.ref=Va(b,m,y),B.return=b,B)}function h(b,m,y,B){return m===null||m.tag!==4||m.stateNode.containerInfo!==y.containerInfo||m.stateNode.implementation!==y.implementation?(m=nc(y,b.mode,B),m.return=b,m):(m=r(m,y.children||[]),m.return=b,m)}function u(b,m,y,B,_){return m===null||m.tag!==7?(m=gn(y,b.mode,B,_),m.return=b,m):(m=r(m,y),m.return=b,m)}function c(b,m,y){if(typeof m=="string"&&m!==""||typeof m=="number")return m=rc(""+m,b.mode,y),m.return=b,m;if(typeof m=="object"&&m!==null){switch(m.$$typeof){case ml:return y=ql(m.type,m.key,m.props,null,b.mode,y),y.ref=Va(b,null,m),y.return=b,y;case Un:return m=nc(m,b.mode,y),m.return=b,m;case Tr:var B=m._init;return c(b,B(m._payload),y)}if(Ya(m)||Ra(m))return m=gn(m,b.mode,y,null),m.return=b,m;Nl(b,m)}return null}function d(b,m,y,B){var _=m!==null?m.key:null;if(typeof y=="string"&&y!==""||typeof y=="number")return _!==null?null:o(b,m,""+y,B);if(typeof y=="object"&&y!==null){switch(y.$$typeof){case ml:return y.key===_?l(b,m,y,B):null;case Un:return y.key===_?h(b,m,y,B):null;case Tr:return _=y._init,d(b,m,_(y._payload),B)}if(Ya(y)||Ra(y))return _!==null?null:u(b,m,y,B,null);Nl(b,y)}return null}function p(b,m,y,B,_){if(typeof B=="string"&&B!==""||typeof B=="number")return b=b.get(y)||null,o(m,b,""+B,_);if(typeof B=="object"&&B!==null){switch(B.$$typeof){case ml:return b=b.get(B.key===null?y:B.key)||null,l(m,b,B,_);case Un:return b=b.get(B.key===null?y:B.key)||null,h(m,b,B,_);case Tr:var P=B._init;return p(b,m,y,P(B._payload),_)}if(Ya(B)||Ra(B))return b=b.get(y)||null,u(m,b,B,_,null);Nl(m,B)}return null}function g(b,m,y,B){for(var _=null,P=null,N=m,D=m=0,Q=null;N!==null&&D<y.length;D++){N.index>D?(Q=N,N=null):Q=N.sibling;var J=d(b,N,y[D],B);if(J===null){N===null&&(N=Q);break}s&&N&&J.alternate===null&&e(b,N),m=n(J,m,D),P===null?_=J:P.sibling=J,P=J,N=Q}if(D===y.length)return t(b,N),lt&&en(b,D),_;if(N===null){for(;D<y.length;D++)N=c(b,y[D],B),N!==null&&(m=n(N,m,D),P===null?_=N:P.sibling=N,P=N);return lt&&en(b,D),_}for(N=i(b,N);D<y.length;D++)Q=p(N,b,D,y[D],B),Q!==null&&(s&&Q.alternate!==null&&N.delete(Q.key===null?D:Q.key),m=n(Q,m,D),P===null?_=Q:P.sibling=Q,P=Q);return s&&N.forEach(function(ge){return e(b,ge)}),lt&&en(b,D),_}function w(b,m,y,B){var _=Ra(y);if(typeof _!="function")throw Error(V(150));if(y=_.call(y),y==null)throw Error(V(151));for(var P=_=null,N=m,D=m=0,Q=null,J=y.next();N!==null&&!J.done;D++,J=y.next()){N.index>D?(Q=N,N=null):Q=N.sibling;var ge=d(b,N,J.value,B);if(ge===null){N===null&&(N=Q);break}s&&N&&ge.alternate===null&&e(b,N),m=n(ge,m,D),P===null?_=ge:P.sibling=ge,P=ge,N=Q}if(J.done)return t(b,N),lt&&en(b,D),_;if(N===null){for(;!J.done;D++,J=y.next())J=c(b,J.value,B),J!==null&&(m=n(J,m,D),P===null?_=J:P.sibling=J,P=J);return lt&&en(b,D),_}for(N=i(b,N);!J.done;D++,J=y.next())J=p(N,b,D,J.value,B),J!==null&&(s&&J.alternate!==null&&N.delete(J.key===null?D:J.key),m=n(J,m,D),P===null?_=J:P.sibling=J,P=J);return s&&N.forEach(function(qt){return e(b,qt)}),lt&&en(b,D),_}function S(b,m,y,B){if(typeof y=="object"&&y!==null&&y.type===$n&&y.key===null&&(y=y.props.children),typeof y=="object"&&y!==null){switch(y.$$typeof){case ml:e:{for(var _=y.key,P=m;P!==null;){if(P.key===_){if(_=y.type,_===$n){if(P.tag===7){t(b,P.sibling),m=r(P,y.props.children),m.return=b,b=m;break e}}else if(P.elementType===_||typeof _=="object"&&_!==null&&_.$$typeof===Tr&&bg(_)===P.type){t(b,P.sibling),m=r(P,y.props),m.ref=Va(b,P,y),m.return=b,b=m;break e}t(b,P);break}else e(b,P);P=P.sibling}y.type===$n?(m=gn(y.props.children,b.mode,B,y.key),m.return=b,b=m):(B=ql(y.type,y.key,y.props,null,b.mode,B),B.ref=Va(b,m,y),B.return=b,b=B)}return a(b);case Un:e:{for(P=y.key;m!==null;){if(m.key===P)if(m.tag===4&&m.stateNode.containerInfo===y.containerInfo&&m.stateNode.implementation===y.implementation){t(b,m.sibling),m=r(m,y.children||[]),m.return=b,b=m;break e}else{t(b,m);break}else e(b,m);m=m.sibling}m=nc(y,b.mode,B),m.return=b,b=m}return a(b);case Tr:return P=y._init,S(b,m,P(y._payload),B)}if(Ya(y))return g(b,m,y,B);if(Ra(y))return w(b,m,y,B);Nl(b,y)}return typeof y=="string"&&y!==""||typeof y=="number"?(y=""+y,m!==null&&m.tag===6?(t(b,m.sibling),m=r(m,y),m.return=b,b=m):(t(b,m),m=rc(y,b.mode,B),m.return=b,b=m),a(b)):t(b,m)}return S}var pa=t1(!0),i1=t1(!1),rl={},$s=qr(rl),vo=qr(rl),To=qr(rl);function on(s){if(s===rl)throw Error(V(174));return s}function vf(s,e){switch(Ze(To,e),Ze(vo,s),Ze($s,rl),s=e.nodeType,s){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:Oc(null,"");break;default:s=s===8?e.parentNode:e,e=s.namespaceURI||null,s=s.tagName,e=Oc(e,s)}st($s),Ze($s,e)}function ga(){st($s),st(vo),st(To)}function s1(s){on(To.current);var e=on($s.current),t=Oc(e,s.type);e!==t&&(Ze(vo,s),Ze($s,t))}function Tf(s){vo.current===s&&(st($s),st(vo))}var ft=qr(0);function bh(s){for(var e=s;e!==null;){if(e.tag===13){var t=e.memoizedState;if(t!==null&&(t=t.dehydrated,t===null||t.data==="$?"||t.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===s)break;for(;e.sibling===null;){if(e.return===null||e.return===s)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var ju=[];function Nf(){for(var s=0;s<ju.length;s++)ju[s]._workInProgressVersionPrimary=null;ju.length=0}var $l=br.ReactCurrentDispatcher,Zu=br.ReactCurrentBatchConfig,_n=0,mt=null,Ot=null,Xt=null,Sh=!1,io=!1,No=0,o_=0;function hi(){throw Error(V(321))}function Pf(s,e){if(e===null)return!1;for(var t=0;t<e.length&&t<s.length;t++)if(!Ps(s[t],e[t]))return!1;return!0}function Cf(s,e,t,i,r,n){if(_n=n,mt=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,$l.current=s===null||s.memoizedState===null?c_:d_,s=t(i,r),io){n=0;do{if(io=!1,No=0,25<=n)throw Error(V(301));n+=1,Xt=Ot=null,e.updateQueue=null,$l.current=f_,s=t(i,r)}while(io)}if($l.current=kh,e=Ot!==null&&Ot.next!==null,_n=0,Xt=Ot=mt=null,Sh=!1,e)throw Error(V(300));return s}function Ef(){var s=No!==0;return No=0,s}function Rs(){var s={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Xt===null?mt.memoizedState=Xt=s:Xt=Xt.next=s,Xt}function hs(){if(Ot===null){var s=mt.alternate;s=s!==null?s.memoizedState:null}else s=Ot.next;var e=Xt===null?mt.memoizedState:Xt.next;if(e!==null)Xt=e,Ot=s;else{if(s===null)throw Error(V(310));Ot=s,s={memoizedState:Ot.memoizedState,baseState:Ot.baseState,baseQueue:Ot.baseQueue,queue:Ot.queue,next:null},Xt===null?mt.memoizedState=Xt=s:Xt=Xt.next=s}return Xt}function Po(s,e){return typeof e=="function"?e(s):e}function ec(s){var e=hs(),t=e.queue;if(t===null)throw Error(V(311));t.lastRenderedReducer=s;var i=Ot,r=i.baseQueue,n=t.pending;if(n!==null){if(r!==null){var a=r.next;r.next=n.next,n.next=a}i.baseQueue=r=n,t.pending=null}if(r!==null){n=r.next,i=i.baseState;var o=a=null,l=null,h=n;do{var u=h.lane;if((_n&u)===u)l!==null&&(l=l.next={lane:0,action:h.action,hasEagerState:h.hasEagerState,eagerState:h.eagerState,next:null}),i=h.hasEagerState?h.eagerState:s(i,h.action);else{var c={lane:u,action:h.action,hasEagerState:h.hasEagerState,eagerState:h.eagerState,next:null};l===null?(o=l=c,a=i):l=l.next=c,mt.lanes|=u,Bn|=u}h=h.next}while(h!==null&&h!==n);l===null?a=i:l.next=o,Ps(i,e.memoizedState)||(Li=!0),e.memoizedState=i,e.baseState=a,e.baseQueue=l,t.lastRenderedState=i}if(s=t.interleaved,s!==null){r=s;do n=r.lane,mt.lanes|=n,Bn|=n,r=r.next;while(r!==s)}else r===null&&(t.lanes=0);return[e.memoizedState,t.dispatch]}function tc(s){var e=hs(),t=e.queue;if(t===null)throw Error(V(311));t.lastRenderedReducer=s;var i=t.dispatch,r=t.pending,n=e.memoizedState;if(r!==null){t.pending=null;var a=r=r.next;do n=s(n,a.action),a=a.next;while(a!==r);Ps(n,e.memoizedState)||(Li=!0),e.memoizedState=n,e.baseQueue===null&&(e.baseState=n),t.lastRenderedState=n}return[n,i]}function r1(){}function n1(s,e){var t=mt,i=hs(),r=e(),n=!Ps(i.memoizedState,r);if(n&&(i.memoizedState=r,Li=!0),i=i.queue,Lf(l1.bind(null,t,i,s),[s]),i.getSnapshot!==e||n||Xt!==null&&Xt.memoizedState.tag&1){if(t.flags|=2048,Co(9,o1.bind(null,t,i,r,e),void 0,null),Qt===null)throw Error(V(349));_n&30||a1(t,e,r)}return r}function a1(s,e,t){s.flags|=16384,s={getSnapshot:e,value:t},e=mt.updateQueue,e===null?(e={lastEffect:null,stores:null},mt.updateQueue=e,e.stores=[s]):(t=e.stores,t===null?e.stores=[s]:t.push(s))}function o1(s,e,t,i){e.value=t,e.getSnapshot=i,h1(e)&&u1(s)}function l1(s,e,t){return t(function(){h1(e)&&u1(s)})}function h1(s){var e=s.getSnapshot;s=s.value;try{var t=e();return!Ps(s,t)}catch{return!0}}function u1(s){var e=pr(s,1);e!==null&&vs(e,s,1,-1)}function Sg(s){var e=Rs();return typeof s=="function"&&(s=s()),e.memoizedState=e.baseState=s,s={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Po,lastRenderedState:s},e.queue=s,s=s.dispatch=u_.bind(null,mt,s),[e.memoizedState,s]}function Co(s,e,t,i){return s={tag:s,create:e,destroy:t,deps:i,next:null},e=mt.updateQueue,e===null?(e={lastEffect:null,stores:null},mt.updateQueue=e,e.lastEffect=s.next=s):(t=e.lastEffect,t===null?e.lastEffect=s.next=s:(i=t.next,t.next=s,s.next=i,e.lastEffect=s)),s}function c1(){return hs().memoizedState}function Yl(s,e,t,i){var r=Rs();mt.flags|=s,r.memoizedState=Co(1|e,t,void 0,i===void 0?null:i)}function tu(s,e,t,i){var r=hs();i=i===void 0?null:i;var n=void 0;if(Ot!==null){var a=Ot.memoizedState;if(n=a.destroy,i!==null&&Pf(i,a.deps)){r.memoizedState=Co(e,t,n,i);return}}mt.flags|=s,r.memoizedState=Co(1|e,t,n,i)}function kg(s,e){return Yl(8390656,8,s,e)}function Lf(s,e){return tu(2048,8,s,e)}function d1(s,e){return tu(4,2,s,e)}function f1(s,e){return tu(4,4,s,e)}function p1(s,e){if(typeof e=="function")return s=s(),e(s),function(){e(null)};if(e!=null)return s=s(),e.current=s,function(){e.current=null}}function g1(s,e,t){return t=t!=null?t.concat([s]):null,tu(4,4,p1.bind(null,e,s),t)}function Mf(){}function m1(s,e){var t=hs();e=e===void 0?null:e;var i=t.memoizedState;return i!==null&&e!==null&&Pf(e,i[1])?i[0]:(t.memoizedState=[s,e],s)}function y1(s,e){var t=hs();e=e===void 0?null:e;var i=t.memoizedState;return i!==null&&e!==null&&Pf(e,i[1])?i[0]:(s=s(),t.memoizedState=[s,e],s)}function w1(s,e,t){return _n&21?(Ps(t,e)||(t=k0(),mt.lanes|=t,Bn|=t,s.baseState=!0),e):(s.baseState&&(s.baseState=!1,Li=!0),s.memoizedState=t)}function l_(s,e){var t=Xe;Xe=t!==0&&4>t?t:4,s(!0);var i=Zu.transition;Zu.transition={};try{s(!1),e()}finally{Xe=t,Zu.transition=i}}function b1(){return hs().memoizedState}function h_(s,e,t){var i=Hr(s);if(t={lane:i,action:t,hasEagerState:!1,eagerState:null,next:null},S1(s))k1(e,t);else if(t=K0(s,e,t,i),t!==null){var r=_i();vs(t,s,i,r),_1(t,e,i)}}function u_(s,e,t){var i=Hr(s),r={lane:i,action:t,hasEagerState:!1,eagerState:null,next:null};if(S1(s))k1(e,r);else{var n=s.alternate;if(s.lanes===0&&(n===null||n.lanes===0)&&(n=e.lastRenderedReducer,n!==null))try{var a=e.lastRenderedState,o=n(a,t);if(r.hasEagerState=!0,r.eagerState=o,Ps(o,a)){var l=e.interleaved;l===null?(r.next=r,Bf(e)):(r.next=l.next,l.next=r),e.interleaved=r;return}}catch{}finally{}t=K0(s,e,r,i),t!==null&&(r=_i(),vs(t,s,i,r),_1(t,e,i))}}function S1(s){var e=s.alternate;return s===mt||e!==null&&e===mt}function k1(s,e){io=Sh=!0;var t=s.pending;t===null?e.next=e:(e.next=t.next,t.next=e),s.pending=e}function _1(s,e,t){if(t&4194240){var i=e.lanes;i&=s.pendingLanes,t|=i,e.lanes=t,hf(s,t)}}var kh={readContext:ls,useCallback:hi,useContext:hi,useEffect:hi,useImperativeHandle:hi,useInsertionEffect:hi,useLayoutEffect:hi,useMemo:hi,useReducer:hi,useRef:hi,useState:hi,useDebugValue:hi,useDeferredValue:hi,useTransition:hi,useMutableSource:hi,useSyncExternalStore:hi,useId:hi,unstable_isNewReconciler:!1},c_={readContext:ls,useCallback:function(s,e){return Rs().memoizedState=[s,e===void 0?null:e],s},useContext:ls,useEffect:kg,useImperativeHandle:function(s,e,t){return t=t!=null?t.concat([s]):null,Yl(4194308,4,p1.bind(null,e,s),t)},useLayoutEffect:function(s,e){return Yl(4194308,4,s,e)},useInsertionEffect:function(s,e){return Yl(4,2,s,e)},useMemo:function(s,e){var t=Rs();return e=e===void 0?null:e,s=s(),t.memoizedState=[s,e],s},useReducer:function(s,e,t){var i=Rs();return e=t!==void 0?t(e):e,i.memoizedState=i.baseState=e,s={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:s,lastRenderedState:e},i.queue=s,s=s.dispatch=h_.bind(null,mt,s),[i.memoizedState,s]},useRef:function(s){var e=Rs();return s={current:s},e.memoizedState=s},useState:Sg,useDebugValue:Mf,useDeferredValue:function(s){return Rs().memoizedState=s},useTransition:function(){var s=Sg(!1),e=s[0];return s=l_.bind(null,s[1]),Rs().memoizedState=s,[e,s]},useMutableSource:function(){},useSyncExternalStore:function(s,e,t){var i=mt,r=Rs();if(lt){if(t===void 0)throw Error(V(407));t=t()}else{if(t=e(),Qt===null)throw Error(V(349));_n&30||a1(i,e,t)}r.memoizedState=t;var n={value:t,getSnapshot:e};return r.queue=n,kg(l1.bind(null,i,n,s),[s]),i.flags|=2048,Co(9,o1.bind(null,i,n,t,e),void 0,null),t},useId:function(){var s=Rs(),e=Qt.identifierPrefix;if(lt){var t=rr,i=sr;t=(i&~(1<<32-xs(i)-1)).toString(32)+t,e=":"+e+"R"+t,t=No++,0<t&&(e+="H"+t.toString(32)),e+=":"}else t=o_++,e=":"+e+"r"+t.toString(32)+":";return s.memoizedState=e},unstable_isNewReconciler:!1},d_={readContext:ls,useCallback:m1,useContext:ls,useEffect:Lf,useImperativeHandle:g1,useInsertionEffect:d1,useLayoutEffect:f1,useMemo:y1,useReducer:ec,useRef:c1,useState:function(){return ec(Po)},useDebugValue:Mf,useDeferredValue:function(s){var e=hs();return w1(e,Ot.memoizedState,s)},useTransition:function(){var s=ec(Po)[0],e=hs().memoizedState;return[s,e]},useMutableSource:r1,useSyncExternalStore:n1,useId:b1,unstable_isNewReconciler:!1},f_={readContext:ls,useCallback:m1,useContext:ls,useEffect:Lf,useImperativeHandle:g1,useInsertionEffect:d1,useLayoutEffect:f1,useMemo:y1,useReducer:tc,useRef:c1,useState:function(){return tc(Po)},useDebugValue:Mf,useDeferredValue:function(s){var e=hs();return Ot===null?e.memoizedState=s:w1(e,Ot.memoizedState,s)},useTransition:function(){var s=tc(Po)[0],e=hs().memoizedState;return[s,e]},useMutableSource:r1,useSyncExternalStore:n1,useId:b1,unstable_isNewReconciler:!1};function ma(s,e){try{var t="",i=e;do t+=WS(i),i=i.return;while(i);var r=t}catch(n){r=`
Error generating stack: `+n.message+`
`+n.stack}return{value:s,source:e,stack:r,digest:null}}function ic(s,e,t){return{value:s,source:null,stack:t??null,digest:e??null}}function od(s,e){try{console.error(e.value)}catch(t){setTimeout(function(){throw t})}}var p_=typeof WeakMap=="function"?WeakMap:Map;function B1(s,e,t){t=hr(-1,t),t.tag=3,t.payload={element:null};var i=e.value;return t.callback=function(){Bh||(Bh=!0,yd=i),od(s,e)},t}function x1(s,e,t){t=hr(-1,t),t.tag=3;var i=s.type.getDerivedStateFromError;if(typeof i=="function"){var r=e.value;t.payload=function(){return i(r)},t.callback=function(){od(s,e)}}var n=s.stateNode;return n!==null&&typeof n.componentDidCatch=="function"&&(t.callback=function(){od(s,e),typeof i!="function"&&(Vr===null?Vr=new Set([this]):Vr.add(this));var a=e.stack;this.componentDidCatch(e.value,{componentStack:a!==null?a:""})}),t}function _g(s,e,t){var i=s.pingCache;if(i===null){i=s.pingCache=new p_;var r=new Set;i.set(e,r)}else r=i.get(e),r===void 0&&(r=new Set,i.set(e,r));r.has(t)||(r.add(t),s=P_.bind(null,s,e,t),e.then(s,s))}function Bg(s){do{var e;if((e=s.tag===13)&&(e=s.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return s;s=s.return}while(s!==null);return null}function xg(s,e,t,i,r){return s.mode&1?(s.flags|=65536,s.lanes=r,s):(s===e?s.flags|=65536:(s.flags|=128,t.flags|=131072,t.flags&=-52805,t.tag===1&&(t.alternate===null?t.tag=17:(e=hr(-1,1),e.tag=2,Or(t,e,1))),t.lanes|=1),s)}var g_=br.ReactCurrentOwner,Li=!1;function wi(s,e,t,i){e.child=s===null?i1(e,null,t,i):pa(e,s.child,t,i)}function vg(s,e,t,i,r){t=t.render;var n=e.ref;return la(e,r),i=Cf(s,e,t,i,n,r),t=Ef(),s!==null&&!Li?(e.updateQueue=s.updateQueue,e.flags&=-2053,s.lanes&=~r,gr(s,e,r)):(lt&&t&&yf(e),e.flags|=1,wi(s,e,i,r),e.child)}function Tg(s,e,t,i,r){if(s===null){var n=t.type;return typeof n=="function"&&!Hf(n)&&n.defaultProps===void 0&&t.compare===null&&t.defaultProps===void 0?(e.tag=15,e.type=n,v1(s,e,n,i,r)):(s=ql(t.type,null,i,e,e.mode,r),s.ref=e.ref,s.return=e,e.child=s)}if(n=s.child,!(s.lanes&r)){var a=n.memoizedProps;if(t=t.compare,t=t!==null?t:ko,t(a,i)&&s.ref===e.ref)return gr(s,e,r)}return e.flags|=1,s=Wr(n,i),s.ref=e.ref,s.return=e,e.child=s}function v1(s,e,t,i,r){if(s!==null){var n=s.memoizedProps;if(ko(n,i)&&s.ref===e.ref)if(Li=!1,e.pendingProps=i=n,(s.lanes&r)!==0)s.flags&131072&&(Li=!0);else return e.lanes=s.lanes,gr(s,e,r)}return ld(s,e,t,i,r)}function T1(s,e,t){var i=e.pendingProps,r=i.children,n=s!==null?s.memoizedState:null;if(i.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},Ze(ta,Oi),Oi|=t;else{if(!(t&1073741824))return s=n!==null?n.baseLanes|t:t,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:s,cachePool:null,transitions:null},e.updateQueue=null,Ze(ta,Oi),Oi|=s,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},i=n!==null?n.baseLanes:t,Ze(ta,Oi),Oi|=i}else n!==null?(i=n.baseLanes|t,e.memoizedState=null):i=t,Ze(ta,Oi),Oi|=i;return wi(s,e,r,t),e.child}function N1(s,e){var t=e.ref;(s===null&&t!==null||s!==null&&s.ref!==t)&&(e.flags|=512,e.flags|=2097152)}function ld(s,e,t,i,r){var n=Ri(t)?Sn:pi.current;return n=da(e,n),la(e,r),t=Cf(s,e,t,i,n,r),i=Ef(),s!==null&&!Li?(e.updateQueue=s.updateQueue,e.flags&=-2053,s.lanes&=~r,gr(s,e,r)):(lt&&i&&yf(e),e.flags|=1,wi(s,e,t,r),e.child)}function Ng(s,e,t,i,r){if(Ri(t)){var n=!0;fh(e)}else n=!1;if(la(e,r),e.stateNode===null)Xl(s,e),e1(e,t,i),ad(e,t,i,r),i=!0;else if(s===null){var a=e.stateNode,o=e.memoizedProps;a.props=o;var l=a.context,h=t.contextType;typeof h=="object"&&h!==null?h=ls(h):(h=Ri(t)?Sn:pi.current,h=da(e,h));var u=t.getDerivedStateFromProps,c=typeof u=="function"||typeof a.getSnapshotBeforeUpdate=="function";c||typeof a.UNSAFE_componentWillReceiveProps!="function"&&typeof a.componentWillReceiveProps!="function"||(o!==i||l!==h)&&wg(e,a,i,h),Nr=!1;var d=e.memoizedState;a.state=d,wh(e,i,a,r),l=e.memoizedState,o!==i||d!==l||Fi.current||Nr?(typeof u=="function"&&(nd(e,t,u,i),l=e.memoizedState),(o=Nr||yg(e,t,o,i,d,l,h))?(c||typeof a.UNSAFE_componentWillMount!="function"&&typeof a.componentWillMount!="function"||(typeof a.componentWillMount=="function"&&a.componentWillMount(),typeof a.UNSAFE_componentWillMount=="function"&&a.UNSAFE_componentWillMount()),typeof a.componentDidMount=="function"&&(e.flags|=4194308)):(typeof a.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=i,e.memoizedState=l),a.props=i,a.state=l,a.context=h,i=o):(typeof a.componentDidMount=="function"&&(e.flags|=4194308),i=!1)}else{a=e.stateNode,j0(s,e),o=e.memoizedProps,h=e.type===e.elementType?o:fs(e.type,o),a.props=h,c=e.pendingProps,d=a.context,l=t.contextType,typeof l=="object"&&l!==null?l=ls(l):(l=Ri(t)?Sn:pi.current,l=da(e,l));var p=t.getDerivedStateFromProps;(u=typeof p=="function"||typeof a.getSnapshotBeforeUpdate=="function")||typeof a.UNSAFE_componentWillReceiveProps!="function"&&typeof a.componentWillReceiveProps!="function"||(o!==c||d!==l)&&wg(e,a,i,l),Nr=!1,d=e.memoizedState,a.state=d,wh(e,i,a,r);var g=e.memoizedState;o!==c||d!==g||Fi.current||Nr?(typeof p=="function"&&(nd(e,t,p,i),g=e.memoizedState),(h=Nr||yg(e,t,h,i,d,g,l)||!1)?(u||typeof a.UNSAFE_componentWillUpdate!="function"&&typeof a.componentWillUpdate!="function"||(typeof a.componentWillUpdate=="function"&&a.componentWillUpdate(i,g,l),typeof a.UNSAFE_componentWillUpdate=="function"&&a.UNSAFE_componentWillUpdate(i,g,l)),typeof a.componentDidUpdate=="function"&&(e.flags|=4),typeof a.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof a.componentDidUpdate!="function"||o===s.memoizedProps&&d===s.memoizedState||(e.flags|=4),typeof a.getSnapshotBeforeUpdate!="function"||o===s.memoizedProps&&d===s.memoizedState||(e.flags|=1024),e.memoizedProps=i,e.memoizedState=g),a.props=i,a.state=g,a.context=l,i=h):(typeof a.componentDidUpdate!="function"||o===s.memoizedProps&&d===s.memoizedState||(e.flags|=4),typeof a.getSnapshotBeforeUpdate!="function"||o===s.memoizedProps&&d===s.memoizedState||(e.flags|=1024),i=!1)}return hd(s,e,t,i,n,r)}function hd(s,e,t,i,r,n){N1(s,e);var a=(e.flags&128)!==0;if(!i&&!a)return r&&dg(e,t,!1),gr(s,e,n);i=e.stateNode,g_.current=e;var o=a&&typeof t.getDerivedStateFromError!="function"?null:i.render();return e.flags|=1,s!==null&&a?(e.child=pa(e,s.child,null,n),e.child=pa(e,null,o,n)):wi(s,e,o,n),e.memoizedState=i.state,r&&dg(e,t,!0),e.child}function P1(s){var e=s.stateNode;e.pendingContext?cg(s,e.pendingContext,e.pendingContext!==e.context):e.context&&cg(s,e.context,!1),vf(s,e.containerInfo)}function Pg(s,e,t,i,r){return fa(),bf(r),e.flags|=256,wi(s,e,t,i),e.child}var ud={dehydrated:null,treeContext:null,retryLane:0};function cd(s){return{baseLanes:s,cachePool:null,transitions:null}}function C1(s,e,t){var i=e.pendingProps,r=ft.current,n=!1,a=(e.flags&128)!==0,o;if((o=a)||(o=s!==null&&s.memoizedState===null?!1:(r&2)!==0),o?(n=!0,e.flags&=-129):(s===null||s.memoizedState!==null)&&(r|=1),Ze(ft,r&1),s===null)return sd(e),s=e.memoizedState,s!==null&&(s=s.dehydrated,s!==null)?(e.mode&1?s.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(a=i.children,s=i.fallback,n?(i=e.mode,n=e.child,a={mode:"hidden",children:a},!(i&1)&&n!==null?(n.childLanes=0,n.pendingProps=a):n=ru(a,i,0,null),s=gn(s,i,t,null),n.return=e,s.return=e,n.sibling=s,e.child=n,e.child.memoizedState=cd(t),e.memoizedState=ud,s):Ff(e,a));if(r=s.memoizedState,r!==null&&(o=r.dehydrated,o!==null))return m_(s,e,a,i,o,r,t);if(n){n=i.fallback,a=e.mode,r=s.child,o=r.sibling;var l={mode:"hidden",children:i.children};return!(a&1)&&e.child!==r?(i=e.child,i.childLanes=0,i.pendingProps=l,e.deletions=null):(i=Wr(r,l),i.subtreeFlags=r.subtreeFlags&14680064),o!==null?n=Wr(o,n):(n=gn(n,a,t,null),n.flags|=2),n.return=e,i.return=e,i.sibling=n,e.child=i,i=n,n=e.child,a=s.child.memoizedState,a=a===null?cd(t):{baseLanes:a.baseLanes|t,cachePool:null,transitions:a.transitions},n.memoizedState=a,n.childLanes=s.childLanes&~t,e.memoizedState=ud,i}return n=s.child,s=n.sibling,i=Wr(n,{mode:"visible",children:i.children}),!(e.mode&1)&&(i.lanes=t),i.return=e,i.sibling=null,s!==null&&(t=e.deletions,t===null?(e.deletions=[s],e.flags|=16):t.push(s)),e.child=i,e.memoizedState=null,i}function Ff(s,e){return e=ru({mode:"visible",children:e},s.mode,0,null),e.return=s,s.child=e}function Pl(s,e,t,i){return i!==null&&bf(i),pa(e,s.child,null,t),s=Ff(e,e.pendingProps.children),s.flags|=2,e.memoizedState=null,s}function m_(s,e,t,i,r,n,a){if(t)return e.flags&256?(e.flags&=-257,i=ic(Error(V(422))),Pl(s,e,a,i)):e.memoizedState!==null?(e.child=s.child,e.flags|=128,null):(n=i.fallback,r=e.mode,i=ru({mode:"visible",children:i.children},r,0,null),n=gn(n,r,a,null),n.flags|=2,i.return=e,n.return=e,i.sibling=n,e.child=i,e.mode&1&&pa(e,s.child,null,a),e.child.memoizedState=cd(a),e.memoizedState=ud,n);if(!(e.mode&1))return Pl(s,e,a,null);if(r.data==="$!"){if(i=r.nextSibling&&r.nextSibling.dataset,i)var o=i.dgst;return i=o,n=Error(V(419)),i=ic(n,i,void 0),Pl(s,e,a,i)}if(o=(a&s.childLanes)!==0,Li||o){if(i=Qt,i!==null){switch(a&-a){case 4:r=2;break;case 16:r=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:r=32;break;case 536870912:r=268435456;break;default:r=0}r=r&(i.suspendedLanes|a)?0:r,r!==0&&r!==n.retryLane&&(n.retryLane=r,pr(s,r),vs(i,s,r,-1))}return Vf(),i=ic(Error(V(421))),Pl(s,e,a,i)}return r.data==="$?"?(e.flags|=128,e.child=s.child,e=C_.bind(null,s),r._reactRetry=e,null):(s=n.treeContext,Gi=Ir(r.nextSibling),Yi=e,lt=!0,ms=null,s!==null&&(is[ss++]=sr,is[ss++]=rr,is[ss++]=kn,sr=s.id,rr=s.overflow,kn=e),e=Ff(e,i.children),e.flags|=4096,e)}function Cg(s,e,t){s.lanes|=e;var i=s.alternate;i!==null&&(i.lanes|=e),rd(s.return,e,t)}function sc(s,e,t,i,r){var n=s.memoizedState;n===null?s.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:i,tail:t,tailMode:r}:(n.isBackwards=e,n.rendering=null,n.renderingStartTime=0,n.last=i,n.tail=t,n.tailMode=r)}function E1(s,e,t){var i=e.pendingProps,r=i.revealOrder,n=i.tail;if(wi(s,e,i.children,t),i=ft.current,i&2)i=i&1|2,e.flags|=128;else{if(s!==null&&s.flags&128)e:for(s=e.child;s!==null;){if(s.tag===13)s.memoizedState!==null&&Cg(s,t,e);else if(s.tag===19)Cg(s,t,e);else if(s.child!==null){s.child.return=s,s=s.child;continue}if(s===e)break e;for(;s.sibling===null;){if(s.return===null||s.return===e)break e;s=s.return}s.sibling.return=s.return,s=s.sibling}i&=1}if(Ze(ft,i),!(e.mode&1))e.memoizedState=null;else switch(r){case"forwards":for(t=e.child,r=null;t!==null;)s=t.alternate,s!==null&&bh(s)===null&&(r=t),t=t.sibling;t=r,t===null?(r=e.child,e.child=null):(r=t.sibling,t.sibling=null),sc(e,!1,r,t,n);break;case"backwards":for(t=null,r=e.child,e.child=null;r!==null;){if(s=r.alternate,s!==null&&bh(s)===null){e.child=r;break}s=r.sibling,r.sibling=t,t=r,r=s}sc(e,!0,t,null,n);break;case"together":sc(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function Xl(s,e){!(e.mode&1)&&s!==null&&(s.alternate=null,e.alternate=null,e.flags|=2)}function gr(s,e,t){if(s!==null&&(e.dependencies=s.dependencies),Bn|=e.lanes,!(t&e.childLanes))return null;if(s!==null&&e.child!==s.child)throw Error(V(153));if(e.child!==null){for(s=e.child,t=Wr(s,s.pendingProps),e.child=t,t.return=e;s.sibling!==null;)s=s.sibling,t=t.sibling=Wr(s,s.pendingProps),t.return=e;t.sibling=null}return e.child}function y_(s,e,t){switch(e.tag){case 3:P1(e),fa();break;case 5:s1(e);break;case 1:Ri(e.type)&&fh(e);break;case 4:vf(e,e.stateNode.containerInfo);break;case 10:var i=e.type._context,r=e.memoizedProps.value;Ze(mh,i._currentValue),i._currentValue=r;break;case 13:if(i=e.memoizedState,i!==null)return i.dehydrated!==null?(Ze(ft,ft.current&1),e.flags|=128,null):t&e.child.childLanes?C1(s,e,t):(Ze(ft,ft.current&1),s=gr(s,e,t),s!==null?s.sibling:null);Ze(ft,ft.current&1);break;case 19:if(i=(t&e.childLanes)!==0,s.flags&128){if(i)return E1(s,e,t);e.flags|=128}if(r=e.memoizedState,r!==null&&(r.rendering=null,r.tail=null,r.lastEffect=null),Ze(ft,ft.current),i)break;return null;case 22:case 23:return e.lanes=0,T1(s,e,t)}return gr(s,e,t)}var L1,dd,M1,F1;L1=function(s,e){for(var t=e.child;t!==null;){if(t.tag===5||t.tag===6)s.appendChild(t.stateNode);else if(t.tag!==4&&t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return;t=t.return}t.sibling.return=t.return,t=t.sibling}};dd=function(){};M1=function(s,e,t,i){var r=s.memoizedProps;if(r!==i){s=e.stateNode,on($s.current);var n=null;switch(t){case"input":r=Rc(s,r),i=Rc(s,i),n=[];break;case"select":r=yt({},r,{value:void 0}),i=yt({},i,{value:void 0}),n=[];break;case"textarea":r=Ic(s,r),i=Ic(s,i),n=[];break;default:typeof r.onClick!="function"&&typeof i.onClick=="function"&&(s.onclick=ch)}Vc(t,i);var a;t=null;for(h in r)if(!i.hasOwnProperty(h)&&r.hasOwnProperty(h)&&r[h]!=null)if(h==="style"){var o=r[h];for(a in o)o.hasOwnProperty(a)&&(t||(t={}),t[a]="")}else h!=="dangerouslySetInnerHTML"&&h!=="children"&&h!=="suppressContentEditableWarning"&&h!=="suppressHydrationWarning"&&h!=="autoFocus"&&(po.hasOwnProperty(h)?n||(n=[]):(n=n||[]).push(h,null));for(h in i){var l=i[h];if(o=r!=null?r[h]:void 0,i.hasOwnProperty(h)&&l!==o&&(l!=null||o!=null))if(h==="style")if(o){for(a in o)!o.hasOwnProperty(a)||l&&l.hasOwnProperty(a)||(t||(t={}),t[a]="");for(a in l)l.hasOwnProperty(a)&&o[a]!==l[a]&&(t||(t={}),t[a]=l[a])}else t||(n||(n=[]),n.push(h,t)),t=l;else h==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,o=o?o.__html:void 0,l!=null&&o!==l&&(n=n||[]).push(h,l)):h==="children"?typeof l!="string"&&typeof l!="number"||(n=n||[]).push(h,""+l):h!=="suppressContentEditableWarning"&&h!=="suppressHydrationWarning"&&(po.hasOwnProperty(h)?(l!=null&&h==="onScroll"&&tt("scroll",s),n||o===l||(n=[])):(n=n||[]).push(h,l))}t&&(n=n||[]).push("style",t);var h=n;(e.updateQueue=h)&&(e.flags|=4)}};F1=function(s,e,t,i){t!==i&&(e.flags|=4)};function Ha(s,e){if(!lt)switch(s.tailMode){case"hidden":e=s.tail;for(var t=null;e!==null;)e.alternate!==null&&(t=e),e=e.sibling;t===null?s.tail=null:t.sibling=null;break;case"collapsed":t=s.tail;for(var i=null;t!==null;)t.alternate!==null&&(i=t),t=t.sibling;i===null?e||s.tail===null?s.tail=null:s.tail.sibling=null:i.sibling=null}}function ui(s){var e=s.alternate!==null&&s.alternate.child===s.child,t=0,i=0;if(e)for(var r=s.child;r!==null;)t|=r.lanes|r.childLanes,i|=r.subtreeFlags&14680064,i|=r.flags&14680064,r.return=s,r=r.sibling;else for(r=s.child;r!==null;)t|=r.lanes|r.childLanes,i|=r.subtreeFlags,i|=r.flags,r.return=s,r=r.sibling;return s.subtreeFlags|=i,s.childLanes=t,e}function w_(s,e,t){var i=e.pendingProps;switch(wf(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return ui(e),null;case 1:return Ri(e.type)&&dh(),ui(e),null;case 3:return i=e.stateNode,ga(),st(Fi),st(pi),Nf(),i.pendingContext&&(i.context=i.pendingContext,i.pendingContext=null),(s===null||s.child===null)&&(Tl(e)?e.flags|=4:s===null||s.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,ms!==null&&(Sd(ms),ms=null))),dd(s,e),ui(e),null;case 5:Tf(e);var r=on(To.current);if(t=e.type,s!==null&&e.stateNode!=null)M1(s,e,t,i,r),s.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!i){if(e.stateNode===null)throw Error(V(166));return ui(e),null}if(s=on($s.current),Tl(e)){i=e.stateNode,t=e.type;var n=e.memoizedProps;switch(i[Hs]=e,i[xo]=n,s=(e.mode&1)!==0,t){case"dialog":tt("cancel",i),tt("close",i);break;case"iframe":case"object":case"embed":tt("load",i);break;case"video":case"audio":for(r=0;r<Qa.length;r++)tt(Qa[r],i);break;case"source":tt("error",i);break;case"img":case"image":case"link":tt("error",i),tt("load",i);break;case"details":tt("toggle",i);break;case"input":Op(i,n),tt("invalid",i);break;case"select":i._wrapperState={wasMultiple:!!n.multiple},tt("invalid",i);break;case"textarea":Hp(i,n),tt("invalid",i)}Vc(t,n),r=null;for(var a in n)if(n.hasOwnProperty(a)){var o=n[a];a==="children"?typeof o=="string"?i.textContent!==o&&(n.suppressHydrationWarning!==!0&&vl(i.textContent,o,s),r=["children",o]):typeof o=="number"&&i.textContent!==""+o&&(n.suppressHydrationWarning!==!0&&vl(i.textContent,o,s),r=["children",""+o]):po.hasOwnProperty(a)&&o!=null&&a==="onScroll"&&tt("scroll",i)}switch(t){case"input":yl(i),Vp(i,n,!0);break;case"textarea":yl(i),Wp(i);break;case"select":case"option":break;default:typeof n.onClick=="function"&&(i.onclick=ch)}i=r,e.updateQueue=i,i!==null&&(e.flags|=4)}else{a=r.nodeType===9?r:r.ownerDocument,s==="http://www.w3.org/1999/xhtml"&&(s=a0(t)),s==="http://www.w3.org/1999/xhtml"?t==="script"?(s=a.createElement("div"),s.innerHTML="<script><\/script>",s=s.removeChild(s.firstChild)):typeof i.is=="string"?s=a.createElement(t,{is:i.is}):(s=a.createElement(t),t==="select"&&(a=s,i.multiple?a.multiple=!0:i.size&&(a.size=i.size))):s=a.createElementNS(s,t),s[Hs]=e,s[xo]=i,L1(s,e,!1,!1),e.stateNode=s;e:{switch(a=Hc(t,i),t){case"dialog":tt("cancel",s),tt("close",s),r=i;break;case"iframe":case"object":case"embed":tt("load",s),r=i;break;case"video":case"audio":for(r=0;r<Qa.length;r++)tt(Qa[r],s);r=i;break;case"source":tt("error",s),r=i;break;case"img":case"image":case"link":tt("error",s),tt("load",s),r=i;break;case"details":tt("toggle",s),r=i;break;case"input":Op(s,i),r=Rc(s,i),tt("invalid",s);break;case"option":r=i;break;case"select":s._wrapperState={wasMultiple:!!i.multiple},r=yt({},i,{value:void 0}),tt("invalid",s);break;case"textarea":Hp(s,i),r=Ic(s,i),tt("invalid",s);break;default:r=i}Vc(t,r),o=r;for(n in o)if(o.hasOwnProperty(n)){var l=o[n];n==="style"?h0(s,l):n==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,l!=null&&o0(s,l)):n==="children"?typeof l=="string"?(t!=="textarea"||l!=="")&&go(s,l):typeof l=="number"&&go(s,""+l):n!=="suppressContentEditableWarning"&&n!=="suppressHydrationWarning"&&n!=="autoFocus"&&(po.hasOwnProperty(n)?l!=null&&n==="onScroll"&&tt("scroll",s):l!=null&&sf(s,n,l,a))}switch(t){case"input":yl(s),Vp(s,i,!1);break;case"textarea":yl(s),Wp(s);break;case"option":i.value!=null&&s.setAttribute("value",""+Gr(i.value));break;case"select":s.multiple=!!i.multiple,n=i.value,n!=null?ra(s,!!i.multiple,n,!1):i.defaultValue!=null&&ra(s,!!i.multiple,i.defaultValue,!0);break;default:typeof r.onClick=="function"&&(s.onclick=ch)}switch(t){case"button":case"input":case"select":case"textarea":i=!!i.autoFocus;break e;case"img":i=!0;break e;default:i=!1}}i&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return ui(e),null;case 6:if(s&&e.stateNode!=null)F1(s,e,s.memoizedProps,i);else{if(typeof i!="string"&&e.stateNode===null)throw Error(V(166));if(t=on(To.current),on($s.current),Tl(e)){if(i=e.stateNode,t=e.memoizedProps,i[Hs]=e,(n=i.nodeValue!==t)&&(s=Yi,s!==null))switch(s.tag){case 3:vl(i.nodeValue,t,(s.mode&1)!==0);break;case 5:s.memoizedProps.suppressHydrationWarning!==!0&&vl(i.nodeValue,t,(s.mode&1)!==0)}n&&(e.flags|=4)}else i=(t.nodeType===9?t:t.ownerDocument).createTextNode(i),i[Hs]=e,e.stateNode=i}return ui(e),null;case 13:if(st(ft),i=e.memoizedState,s===null||s.memoizedState!==null&&s.memoizedState.dehydrated!==null){if(lt&&Gi!==null&&e.mode&1&&!(e.flags&128))q0(),fa(),e.flags|=98560,n=!1;else if(n=Tl(e),i!==null&&i.dehydrated!==null){if(s===null){if(!n)throw Error(V(318));if(n=e.memoizedState,n=n!==null?n.dehydrated:null,!n)throw Error(V(317));n[Hs]=e}else fa(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;ui(e),n=!1}else ms!==null&&(Sd(ms),ms=null),n=!0;if(!n)return e.flags&65536?e:null}return e.flags&128?(e.lanes=t,e):(i=i!==null,i!==(s!==null&&s.memoizedState!==null)&&i&&(e.child.flags|=8192,e.mode&1&&(s===null||ft.current&1?Ht===0&&(Ht=3):Vf())),e.updateQueue!==null&&(e.flags|=4),ui(e),null);case 4:return ga(),dd(s,e),s===null&&_o(e.stateNode.containerInfo),ui(e),null;case 10:return _f(e.type._context),ui(e),null;case 17:return Ri(e.type)&&dh(),ui(e),null;case 19:if(st(ft),n=e.memoizedState,n===null)return ui(e),null;if(i=(e.flags&128)!==0,a=n.rendering,a===null)if(i)Ha(n,!1);else{if(Ht!==0||s!==null&&s.flags&128)for(s=e.child;s!==null;){if(a=bh(s),a!==null){for(e.flags|=128,Ha(n,!1),i=a.updateQueue,i!==null&&(e.updateQueue=i,e.flags|=4),e.subtreeFlags=0,i=t,t=e.child;t!==null;)n=t,s=i,n.flags&=14680066,a=n.alternate,a===null?(n.childLanes=0,n.lanes=s,n.child=null,n.subtreeFlags=0,n.memoizedProps=null,n.memoizedState=null,n.updateQueue=null,n.dependencies=null,n.stateNode=null):(n.childLanes=a.childLanes,n.lanes=a.lanes,n.child=a.child,n.subtreeFlags=0,n.deletions=null,n.memoizedProps=a.memoizedProps,n.memoizedState=a.memoizedState,n.updateQueue=a.updateQueue,n.type=a.type,s=a.dependencies,n.dependencies=s===null?null:{lanes:s.lanes,firstContext:s.firstContext}),t=t.sibling;return Ze(ft,ft.current&1|2),e.child}s=s.sibling}n.tail!==null&&xt()>ya&&(e.flags|=128,i=!0,Ha(n,!1),e.lanes=4194304)}else{if(!i)if(s=bh(a),s!==null){if(e.flags|=128,i=!0,t=s.updateQueue,t!==null&&(e.updateQueue=t,e.flags|=4),Ha(n,!0),n.tail===null&&n.tailMode==="hidden"&&!a.alternate&&!lt)return ui(e),null}else 2*xt()-n.renderingStartTime>ya&&t!==1073741824&&(e.flags|=128,i=!0,Ha(n,!1),e.lanes=4194304);n.isBackwards?(a.sibling=e.child,e.child=a):(t=n.last,t!==null?t.sibling=a:e.child=a,n.last=a)}return n.tail!==null?(e=n.tail,n.rendering=e,n.tail=e.sibling,n.renderingStartTime=xt(),e.sibling=null,t=ft.current,Ze(ft,i?t&1|2:t&1),e):(ui(e),null);case 22:case 23:return Of(),i=e.memoizedState!==null,s!==null&&s.memoizedState!==null!==i&&(e.flags|=8192),i&&e.mode&1?Oi&1073741824&&(ui(e),e.subtreeFlags&6&&(e.flags|=8192)):ui(e),null;case 24:return null;case 25:return null}throw Error(V(156,e.tag))}function b_(s,e){switch(wf(e),e.tag){case 1:return Ri(e.type)&&dh(),s=e.flags,s&65536?(e.flags=s&-65537|128,e):null;case 3:return ga(),st(Fi),st(pi),Nf(),s=e.flags,s&65536&&!(s&128)?(e.flags=s&-65537|128,e):null;case 5:return Tf(e),null;case 13:if(st(ft),s=e.memoizedState,s!==null&&s.dehydrated!==null){if(e.alternate===null)throw Error(V(340));fa()}return s=e.flags,s&65536?(e.flags=s&-65537|128,e):null;case 19:return st(ft),null;case 4:return ga(),null;case 10:return _f(e.type._context),null;case 22:case 23:return Of(),null;case 24:return null;default:return null}}var Cl=!1,fi=!1,S_=typeof WeakSet=="function"?WeakSet:Set,j=null;function ea(s,e){var t=s.ref;if(t!==null)if(typeof t=="function")try{t(null)}catch(i){bt(s,e,i)}else t.current=null}function fd(s,e,t){try{t()}catch(i){bt(s,e,i)}}var Eg=!1;function k_(s,e){if(qc=lh,s=I0(),mf(s)){if("selectionStart"in s)var t={start:s.selectionStart,end:s.selectionEnd};else e:{t=(t=s.ownerDocument)&&t.defaultView||window;var i=t.getSelection&&t.getSelection();if(i&&i.rangeCount!==0){t=i.anchorNode;var r=i.anchorOffset,n=i.focusNode;i=i.focusOffset;try{t.nodeType,n.nodeType}catch{t=null;break e}var a=0,o=-1,l=-1,h=0,u=0,c=s,d=null;t:for(;;){for(var p;c!==t||r!==0&&c.nodeType!==3||(o=a+r),c!==n||i!==0&&c.nodeType!==3||(l=a+i),c.nodeType===3&&(a+=c.nodeValue.length),(p=c.firstChild)!==null;)d=c,c=p;for(;;){if(c===s)break t;if(d===t&&++h===r&&(o=a),d===n&&++u===i&&(l=a),(p=c.nextSibling)!==null)break;c=d,d=c.parentNode}c=p}t=o===-1||l===-1?null:{start:o,end:l}}else t=null}t=t||{start:0,end:0}}else t=null;for(Kc={focusedElem:s,selectionRange:t},lh=!1,j=e;j!==null;)if(e=j,s=e.child,(e.subtreeFlags&1028)!==0&&s!==null)s.return=e,j=s;else for(;j!==null;){e=j;try{var g=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(g!==null){var w=g.memoizedProps,S=g.memoizedState,b=e.stateNode,m=b.getSnapshotBeforeUpdate(e.elementType===e.type?w:fs(e.type,w),S);b.__reactInternalSnapshotBeforeUpdate=m}break;case 3:var y=e.stateNode.containerInfo;y.nodeType===1?y.textContent="":y.nodeType===9&&y.documentElement&&y.removeChild(y.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(V(163))}}catch(B){bt(e,e.return,B)}if(s=e.sibling,s!==null){s.return=e.return,j=s;break}j=e.return}return g=Eg,Eg=!1,g}function so(s,e,t){var i=e.updateQueue;if(i=i!==null?i.lastEffect:null,i!==null){var r=i=i.next;do{if((r.tag&s)===s){var n=r.destroy;r.destroy=void 0,n!==void 0&&fd(e,t,n)}r=r.next}while(r!==i)}}function iu(s,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var t=e=e.next;do{if((t.tag&s)===s){var i=t.create;t.destroy=i()}t=t.next}while(t!==e)}}function pd(s){var e=s.ref;if(e!==null){var t=s.stateNode;switch(s.tag){case 5:s=t;break;default:s=t}typeof e=="function"?e(s):e.current=s}}function R1(s){var e=s.alternate;e!==null&&(s.alternate=null,R1(e)),s.child=null,s.deletions=null,s.sibling=null,s.tag===5&&(e=s.stateNode,e!==null&&(delete e[Hs],delete e[xo],delete e[ed],delete e[s_],delete e[r_])),s.stateNode=null,s.return=null,s.dependencies=null,s.memoizedProps=null,s.memoizedState=null,s.pendingProps=null,s.stateNode=null,s.updateQueue=null}function D1(s){return s.tag===5||s.tag===3||s.tag===4}function Lg(s){e:for(;;){for(;s.sibling===null;){if(s.return===null||D1(s.return))return null;s=s.return}for(s.sibling.return=s.return,s=s.sibling;s.tag!==5&&s.tag!==6&&s.tag!==18;){if(s.flags&2||s.child===null||s.tag===4)continue e;s.child.return=s,s=s.child}if(!(s.flags&2))return s.stateNode}}function gd(s,e,t){var i=s.tag;if(i===5||i===6)s=s.stateNode,e?t.nodeType===8?t.parentNode.insertBefore(s,e):t.insertBefore(s,e):(t.nodeType===8?(e=t.parentNode,e.insertBefore(s,t)):(e=t,e.appendChild(s)),t=t._reactRootContainer,t!=null||e.onclick!==null||(e.onclick=ch));else if(i!==4&&(s=s.child,s!==null))for(gd(s,e,t),s=s.sibling;s!==null;)gd(s,e,t),s=s.sibling}function md(s,e,t){var i=s.tag;if(i===5||i===6)s=s.stateNode,e?t.insertBefore(s,e):t.appendChild(s);else if(i!==4&&(s=s.child,s!==null))for(md(s,e,t),s=s.sibling;s!==null;)md(s,e,t),s=s.sibling}var ei=null,ps=!1;function xr(s,e,t){for(t=t.child;t!==null;)A1(s,e,t),t=t.sibling}function A1(s,e,t){if(Us&&typeof Us.onCommitFiberUnmount=="function")try{Us.onCommitFiberUnmount(Qh,t)}catch{}switch(t.tag){case 5:fi||ea(t,e);case 6:var i=ei,r=ps;ei=null,xr(s,e,t),ei=i,ps=r,ei!==null&&(ps?(s=ei,t=t.stateNode,s.nodeType===8?s.parentNode.removeChild(t):s.removeChild(t)):ei.removeChild(t.stateNode));break;case 18:ei!==null&&(ps?(s=ei,t=t.stateNode,s.nodeType===8?qu(s.parentNode,t):s.nodeType===1&&qu(s,t),bo(s)):qu(ei,t.stateNode));break;case 4:i=ei,r=ps,ei=t.stateNode.containerInfo,ps=!0,xr(s,e,t),ei=i,ps=r;break;case 0:case 11:case 14:case 15:if(!fi&&(i=t.updateQueue,i!==null&&(i=i.lastEffect,i!==null))){r=i=i.next;do{var n=r,a=n.destroy;n=n.tag,a!==void 0&&(n&2||n&4)&&fd(t,e,a),r=r.next}while(r!==i)}xr(s,e,t);break;case 1:if(!fi&&(ea(t,e),i=t.stateNode,typeof i.componentWillUnmount=="function"))try{i.props=t.memoizedProps,i.state=t.memoizedState,i.componentWillUnmount()}catch(o){bt(t,e,o)}xr(s,e,t);break;case 21:xr(s,e,t);break;case 22:t.mode&1?(fi=(i=fi)||t.memoizedState!==null,xr(s,e,t),fi=i):xr(s,e,t);break;default:xr(s,e,t)}}function Mg(s){var e=s.updateQueue;if(e!==null){s.updateQueue=null;var t=s.stateNode;t===null&&(t=s.stateNode=new S_),e.forEach(function(i){var r=E_.bind(null,s,i);t.has(i)||(t.add(i),i.then(r,r))})}}function cs(s,e){var t=e.deletions;if(t!==null)for(var i=0;i<t.length;i++){var r=t[i];try{var n=s,a=e,o=a;e:for(;o!==null;){switch(o.tag){case 5:ei=o.stateNode,ps=!1;break e;case 3:ei=o.stateNode.containerInfo,ps=!0;break e;case 4:ei=o.stateNode.containerInfo,ps=!0;break e}o=o.return}if(ei===null)throw Error(V(160));A1(n,a,r),ei=null,ps=!1;var l=r.alternate;l!==null&&(l.return=null),r.return=null}catch(h){bt(r,e,h)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)I1(e,s),e=e.sibling}function I1(s,e){var t=s.alternate,i=s.flags;switch(s.tag){case 0:case 11:case 14:case 15:if(cs(e,s),Fs(s),i&4){try{so(3,s,s.return),iu(3,s)}catch(w){bt(s,s.return,w)}try{so(5,s,s.return)}catch(w){bt(s,s.return,w)}}break;case 1:cs(e,s),Fs(s),i&512&&t!==null&&ea(t,t.return);break;case 5:if(cs(e,s),Fs(s),i&512&&t!==null&&ea(t,t.return),s.flags&32){var r=s.stateNode;try{go(r,"")}catch(w){bt(s,s.return,w)}}if(i&4&&(r=s.stateNode,r!=null)){var n=s.memoizedProps,a=t!==null?t.memoizedProps:n,o=s.type,l=s.updateQueue;if(s.updateQueue=null,l!==null)try{o==="input"&&n.type==="radio"&&n.name!=null&&r0(r,n),Hc(o,a);var h=Hc(o,n);for(a=0;a<l.length;a+=2){var u=l[a],c=l[a+1];u==="style"?h0(r,c):u==="dangerouslySetInnerHTML"?o0(r,c):u==="children"?go(r,c):sf(r,u,c,h)}switch(o){case"input":Dc(r,n);break;case"textarea":n0(r,n);break;case"select":var d=r._wrapperState.wasMultiple;r._wrapperState.wasMultiple=!!n.multiple;var p=n.value;p!=null?ra(r,!!n.multiple,p,!1):d!==!!n.multiple&&(n.defaultValue!=null?ra(r,!!n.multiple,n.defaultValue,!0):ra(r,!!n.multiple,n.multiple?[]:"",!1))}r[xo]=n}catch(w){bt(s,s.return,w)}}break;case 6:if(cs(e,s),Fs(s),i&4){if(s.stateNode===null)throw Error(V(162));r=s.stateNode,n=s.memoizedProps;try{r.nodeValue=n}catch(w){bt(s,s.return,w)}}break;case 3:if(cs(e,s),Fs(s),i&4&&t!==null&&t.memoizedState.isDehydrated)try{bo(e.containerInfo)}catch(w){bt(s,s.return,w)}break;case 4:cs(e,s),Fs(s);break;case 13:cs(e,s),Fs(s),r=s.child,r.flags&8192&&(n=r.memoizedState!==null,r.stateNode.isHidden=n,!n||r.alternate!==null&&r.alternate.memoizedState!==null||(Af=xt())),i&4&&Mg(s);break;case 22:if(u=t!==null&&t.memoizedState!==null,s.mode&1?(fi=(h=fi)||u,cs(e,s),fi=h):cs(e,s),Fs(s),i&8192){if(h=s.memoizedState!==null,(s.stateNode.isHidden=h)&&!u&&s.mode&1)for(j=s,u=s.child;u!==null;){for(c=j=u;j!==null;){switch(d=j,p=d.child,d.tag){case 0:case 11:case 14:case 15:so(4,d,d.return);break;case 1:ea(d,d.return);var g=d.stateNode;if(typeof g.componentWillUnmount=="function"){i=d,t=d.return;try{e=i,g.props=e.memoizedProps,g.state=e.memoizedState,g.componentWillUnmount()}catch(w){bt(i,t,w)}}break;case 5:ea(d,d.return);break;case 22:if(d.memoizedState!==null){Rg(c);continue}}p!==null?(p.return=d,j=p):Rg(c)}u=u.sibling}e:for(u=null,c=s;;){if(c.tag===5){if(u===null){u=c;try{r=c.stateNode,h?(n=r.style,typeof n.setProperty=="function"?n.setProperty("display","none","important"):n.display="none"):(o=c.stateNode,l=c.memoizedProps.style,a=l!=null&&l.hasOwnProperty("display")?l.display:null,o.style.display=l0("display",a))}catch(w){bt(s,s.return,w)}}}else if(c.tag===6){if(u===null)try{c.stateNode.nodeValue=h?"":c.memoizedProps}catch(w){bt(s,s.return,w)}}else if((c.tag!==22&&c.tag!==23||c.memoizedState===null||c===s)&&c.child!==null){c.child.return=c,c=c.child;continue}if(c===s)break e;for(;c.sibling===null;){if(c.return===null||c.return===s)break e;u===c&&(u=null),c=c.return}u===c&&(u=null),c.sibling.return=c.return,c=c.sibling}}break;case 19:cs(e,s),Fs(s),i&4&&Mg(s);break;case 21:break;default:cs(e,s),Fs(s)}}function Fs(s){var e=s.flags;if(e&2){try{e:{for(var t=s.return;t!==null;){if(D1(t)){var i=t;break e}t=t.return}throw Error(V(160))}switch(i.tag){case 5:var r=i.stateNode;i.flags&32&&(go(r,""),i.flags&=-33);var n=Lg(s);md(s,n,r);break;case 3:case 4:var a=i.stateNode.containerInfo,o=Lg(s);gd(s,o,a);break;default:throw Error(V(161))}}catch(l){bt(s,s.return,l)}s.flags&=-3}e&4096&&(s.flags&=-4097)}function __(s,e,t){j=s,O1(s)}function O1(s,e,t){for(var i=(s.mode&1)!==0;j!==null;){var r=j,n=r.child;if(r.tag===22&&i){var a=r.memoizedState!==null||Cl;if(!a){var o=r.alternate,l=o!==null&&o.memoizedState!==null||fi;o=Cl;var h=fi;if(Cl=a,(fi=l)&&!h)for(j=r;j!==null;)a=j,l=a.child,a.tag===22&&a.memoizedState!==null?Dg(r):l!==null?(l.return=a,j=l):Dg(r);for(;n!==null;)j=n,O1(n),n=n.sibling;j=r,Cl=o,fi=h}Fg(s)}else r.subtreeFlags&8772&&n!==null?(n.return=r,j=n):Fg(s)}}function Fg(s){for(;j!==null;){var e=j;if(e.flags&8772){var t=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:fi||iu(5,e);break;case 1:var i=e.stateNode;if(e.flags&4&&!fi)if(t===null)i.componentDidMount();else{var r=e.elementType===e.type?t.memoizedProps:fs(e.type,t.memoizedProps);i.componentDidUpdate(r,t.memoizedState,i.__reactInternalSnapshotBeforeUpdate)}var n=e.updateQueue;n!==null&&mg(e,n,i);break;case 3:var a=e.updateQueue;if(a!==null){if(t=null,e.child!==null)switch(e.child.tag){case 5:t=e.child.stateNode;break;case 1:t=e.child.stateNode}mg(e,a,t)}break;case 5:var o=e.stateNode;if(t===null&&e.flags&4){t=o;var l=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&t.focus();break;case"img":l.src&&(t.src=l.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var h=e.alternate;if(h!==null){var u=h.memoizedState;if(u!==null){var c=u.dehydrated;c!==null&&bo(c)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(V(163))}fi||e.flags&512&&pd(e)}catch(d){bt(e,e.return,d)}}if(e===s){j=null;break}if(t=e.sibling,t!==null){t.return=e.return,j=t;break}j=e.return}}function Rg(s){for(;j!==null;){var e=j;if(e===s){j=null;break}var t=e.sibling;if(t!==null){t.return=e.return,j=t;break}j=e.return}}function Dg(s){for(;j!==null;){var e=j;try{switch(e.tag){case 0:case 11:case 15:var t=e.return;try{iu(4,e)}catch(l){bt(e,t,l)}break;case 1:var i=e.stateNode;if(typeof i.componentDidMount=="function"){var r=e.return;try{i.componentDidMount()}catch(l){bt(e,r,l)}}var n=e.return;try{pd(e)}catch(l){bt(e,n,l)}break;case 5:var a=e.return;try{pd(e)}catch(l){bt(e,a,l)}}}catch(l){bt(e,e.return,l)}if(e===s){j=null;break}var o=e.sibling;if(o!==null){o.return=e.return,j=o;break}j=e.return}}var B_=Math.ceil,_h=br.ReactCurrentDispatcher,Rf=br.ReactCurrentOwner,os=br.ReactCurrentBatchConfig,Ie=0,Qt=null,Dt=null,ri=0,Oi=0,ta=qr(0),Ht=0,Eo=null,Bn=0,su=0,Df=0,ro=null,Pi=null,Af=0,ya=1/0,Ks=null,Bh=!1,yd=null,Vr=null,El=!1,Mr=null,xh=0,no=0,wd=null,Ql=-1,Jl=0;function _i(){return Ie&6?xt():Ql!==-1?Ql:Ql=xt()}function Hr(s){return s.mode&1?Ie&2&&ri!==0?ri&-ri:a_.transition!==null?(Jl===0&&(Jl=k0()),Jl):(s=Xe,s!==0||(s=window.event,s=s===void 0?16:P0(s.type)),s):1}function vs(s,e,t,i){if(50<no)throw no=0,wd=null,Error(V(185));tl(s,t,i),(!(Ie&2)||s!==Qt)&&(s===Qt&&(!(Ie&2)&&(su|=t),Ht===4&&Er(s,ri)),Di(s,i),t===1&&Ie===0&&!(e.mode&1)&&(ya=xt()+500,Zh&&Kr()))}function Di(s,e){var t=s.callbackNode;ak(s,e);var i=oh(s,s===Qt?ri:0);if(i===0)t!==null&&Up(t),s.callbackNode=null,s.callbackPriority=0;else if(e=i&-i,s.callbackPriority!==e){if(t!=null&&Up(t),e===1)s.tag===0?n_(Ag.bind(null,s)):X0(Ag.bind(null,s)),t_(function(){!(Ie&6)&&Kr()}),t=null;else{switch(_0(i)){case 1:t=lf;break;case 4:t=b0;break;case 16:t=ah;break;case 536870912:t=S0;break;default:t=ah}t=Y1(t,V1.bind(null,s))}s.callbackPriority=e,s.callbackNode=t}}function V1(s,e){if(Ql=-1,Jl=0,Ie&6)throw Error(V(327));var t=s.callbackNode;if(ha()&&s.callbackNode!==t)return null;var i=oh(s,s===Qt?ri:0);if(i===0)return null;if(i&30||i&s.expiredLanes||e)e=vh(s,i);else{e=i;var r=Ie;Ie|=2;var n=W1();(Qt!==s||ri!==e)&&(Ks=null,ya=xt()+500,pn(s,e));do try{T_();break}catch(o){H1(s,o)}while(!0);kf(),_h.current=n,Ie=r,Dt!==null?e=0:(Qt=null,ri=0,e=Ht)}if(e!==0){if(e===2&&(r=$c(s),r!==0&&(i=r,e=bd(s,r))),e===1)throw t=Eo,pn(s,0),Er(s,i),Di(s,xt()),t;if(e===6)Er(s,i);else{if(r=s.current.alternate,!(i&30)&&!x_(r)&&(e=vh(s,i),e===2&&(n=$c(s),n!==0&&(i=n,e=bd(s,n))),e===1))throw t=Eo,pn(s,0),Er(s,i),Di(s,xt()),t;switch(s.finishedWork=r,s.finishedLanes=i,e){case 0:case 1:throw Error(V(345));case 2:tn(s,Pi,Ks);break;case 3:if(Er(s,i),(i&130023424)===i&&(e=Af+500-xt(),10<e)){if(oh(s,0)!==0)break;if(r=s.suspendedLanes,(r&i)!==i){_i(),s.pingedLanes|=s.suspendedLanes&r;break}s.timeoutHandle=Zc(tn.bind(null,s,Pi,Ks),e);break}tn(s,Pi,Ks);break;case 4:if(Er(s,i),(i&4194240)===i)break;for(e=s.eventTimes,r=-1;0<i;){var a=31-xs(i);n=1<<a,a=e[a],a>r&&(r=a),i&=~n}if(i=r,i=xt()-i,i=(120>i?120:480>i?480:1080>i?1080:1920>i?1920:3e3>i?3e3:4320>i?4320:1960*B_(i/1960))-i,10<i){s.timeoutHandle=Zc(tn.bind(null,s,Pi,Ks),i);break}tn(s,Pi,Ks);break;case 5:tn(s,Pi,Ks);break;default:throw Error(V(329))}}}return Di(s,xt()),s.callbackNode===t?V1.bind(null,s):null}function bd(s,e){var t=ro;return s.current.memoizedState.isDehydrated&&(pn(s,e).flags|=256),s=vh(s,e),s!==2&&(e=Pi,Pi=t,e!==null&&Sd(e)),s}function Sd(s){Pi===null?Pi=s:Pi.push.apply(Pi,s)}function x_(s){for(var e=s;;){if(e.flags&16384){var t=e.updateQueue;if(t!==null&&(t=t.stores,t!==null))for(var i=0;i<t.length;i++){var r=t[i],n=r.getSnapshot;r=r.value;try{if(!Ps(n(),r))return!1}catch{return!1}}}if(t=e.child,e.subtreeFlags&16384&&t!==null)t.return=e,e=t;else{if(e===s)break;for(;e.sibling===null;){if(e.return===null||e.return===s)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function Er(s,e){for(e&=~Df,e&=~su,s.suspendedLanes|=e,s.pingedLanes&=~e,s=s.expirationTimes;0<e;){var t=31-xs(e),i=1<<t;s[t]=-1,e&=~i}}function Ag(s){if(Ie&6)throw Error(V(327));ha();var e=oh(s,0);if(!(e&1))return Di(s,xt()),null;var t=vh(s,e);if(s.tag!==0&&t===2){var i=$c(s);i!==0&&(e=i,t=bd(s,i))}if(t===1)throw t=Eo,pn(s,0),Er(s,e),Di(s,xt()),t;if(t===6)throw Error(V(345));return s.finishedWork=s.current.alternate,s.finishedLanes=e,tn(s,Pi,Ks),Di(s,xt()),null}function If(s,e){var t=Ie;Ie|=1;try{return s(e)}finally{Ie=t,Ie===0&&(ya=xt()+500,Zh&&Kr())}}function xn(s){Mr!==null&&Mr.tag===0&&!(Ie&6)&&ha();var e=Ie;Ie|=1;var t=os.transition,i=Xe;try{if(os.transition=null,Xe=1,s)return s()}finally{Xe=i,os.transition=t,Ie=e,!(Ie&6)&&Kr()}}function Of(){Oi=ta.current,st(ta)}function pn(s,e){s.finishedWork=null,s.finishedLanes=0;var t=s.timeoutHandle;if(t!==-1&&(s.timeoutHandle=-1,e_(t)),Dt!==null)for(t=Dt.return;t!==null;){var i=t;switch(wf(i),i.tag){case 1:i=i.type.childContextTypes,i!=null&&dh();break;case 3:ga(),st(Fi),st(pi),Nf();break;case 5:Tf(i);break;case 4:ga();break;case 13:st(ft);break;case 19:st(ft);break;case 10:_f(i.type._context);break;case 22:case 23:Of()}t=t.return}if(Qt=s,Dt=s=Wr(s.current,null),ri=Oi=e,Ht=0,Eo=null,Df=su=Bn=0,Pi=ro=null,an!==null){for(e=0;e<an.length;e++)if(t=an[e],i=t.interleaved,i!==null){t.interleaved=null;var r=i.next,n=t.pending;if(n!==null){var a=n.next;n.next=r,i.next=a}t.pending=i}an=null}return s}function H1(s,e){do{var t=Dt;try{if(kf(),$l.current=kh,Sh){for(var i=mt.memoizedState;i!==null;){var r=i.queue;r!==null&&(r.pending=null),i=i.next}Sh=!1}if(_n=0,Xt=Ot=mt=null,io=!1,No=0,Rf.current=null,t===null||t.return===null){Ht=1,Eo=e,Dt=null;break}e:{var n=s,a=t.return,o=t,l=e;if(e=ri,o.flags|=32768,l!==null&&typeof l=="object"&&typeof l.then=="function"){var h=l,u=o,c=u.tag;if(!(u.mode&1)&&(c===0||c===11||c===15)){var d=u.alternate;d?(u.updateQueue=d.updateQueue,u.memoizedState=d.memoizedState,u.lanes=d.lanes):(u.updateQueue=null,u.memoizedState=null)}var p=Bg(a);if(p!==null){p.flags&=-257,xg(p,a,o,n,e),p.mode&1&&_g(n,h,e),e=p,l=h;var g=e.updateQueue;if(g===null){var w=new Set;w.add(l),e.updateQueue=w}else g.add(l);break e}else{if(!(e&1)){_g(n,h,e),Vf();break e}l=Error(V(426))}}else if(lt&&o.mode&1){var S=Bg(a);if(S!==null){!(S.flags&65536)&&(S.flags|=256),xg(S,a,o,n,e),bf(ma(l,o));break e}}n=l=ma(l,o),Ht!==4&&(Ht=2),ro===null?ro=[n]:ro.push(n),n=a;do{switch(n.tag){case 3:n.flags|=65536,e&=-e,n.lanes|=e;var b=B1(n,l,e);gg(n,b);break e;case 1:o=l;var m=n.type,y=n.stateNode;if(!(n.flags&128)&&(typeof m.getDerivedStateFromError=="function"||y!==null&&typeof y.componentDidCatch=="function"&&(Vr===null||!Vr.has(y)))){n.flags|=65536,e&=-e,n.lanes|=e;var B=x1(n,o,e);gg(n,B);break e}}n=n.return}while(n!==null)}G1(t)}catch(_){e=_,Dt===t&&t!==null&&(Dt=t=t.return);continue}break}while(!0)}function W1(){var s=_h.current;return _h.current=kh,s===null?kh:s}function Vf(){(Ht===0||Ht===3||Ht===2)&&(Ht=4),Qt===null||!(Bn&268435455)&&!(su&268435455)||Er(Qt,ri)}function vh(s,e){var t=Ie;Ie|=2;var i=W1();(Qt!==s||ri!==e)&&(Ks=null,pn(s,e));do try{v_();break}catch(r){H1(s,r)}while(!0);if(kf(),Ie=t,_h.current=i,Dt!==null)throw Error(V(261));return Qt=null,ri=0,Ht}function v_(){for(;Dt!==null;)z1(Dt)}function T_(){for(;Dt!==null&&!KS();)z1(Dt)}function z1(s){var e=$1(s.alternate,s,Oi);s.memoizedProps=s.pendingProps,e===null?G1(s):Dt=e,Rf.current=null}function G1(s){var e=s;do{var t=e.alternate;if(s=e.return,e.flags&32768){if(t=b_(t,e),t!==null){t.flags&=32767,Dt=t;return}if(s!==null)s.flags|=32768,s.subtreeFlags=0,s.deletions=null;else{Ht=6,Dt=null;return}}else if(t=w_(t,e,Oi),t!==null){Dt=t;return}if(e=e.sibling,e!==null){Dt=e;return}Dt=e=s}while(e!==null);Ht===0&&(Ht=5)}function tn(s,e,t){var i=Xe,r=os.transition;try{os.transition=null,Xe=1,N_(s,e,t,i)}finally{os.transition=r,Xe=i}return null}function N_(s,e,t,i){do ha();while(Mr!==null);if(Ie&6)throw Error(V(327));t=s.finishedWork;var r=s.finishedLanes;if(t===null)return null;if(s.finishedWork=null,s.finishedLanes=0,t===s.current)throw Error(V(177));s.callbackNode=null,s.callbackPriority=0;var n=t.lanes|t.childLanes;if(ok(s,n),s===Qt&&(Dt=Qt=null,ri=0),!(t.subtreeFlags&2064)&&!(t.flags&2064)||El||(El=!0,Y1(ah,function(){return ha(),null})),n=(t.flags&15990)!==0,t.subtreeFlags&15990||n){n=os.transition,os.transition=null;var a=Xe;Xe=1;var o=Ie;Ie|=4,Rf.current=null,k_(s,t),I1(t,s),Xk(Kc),lh=!!qc,Kc=qc=null,s.current=t,__(t),jS(),Ie=o,Xe=a,os.transition=n}else s.current=t;if(El&&(El=!1,Mr=s,xh=r),n=s.pendingLanes,n===0&&(Vr=null),tk(t.stateNode),Di(s,xt()),e!==null)for(i=s.onRecoverableError,t=0;t<e.length;t++)r=e[t],i(r.value,{componentStack:r.stack,digest:r.digest});if(Bh)throw Bh=!1,s=yd,yd=null,s;return xh&1&&s.tag!==0&&ha(),n=s.pendingLanes,n&1?s===wd?no++:(no=0,wd=s):no=0,Kr(),null}function ha(){if(Mr!==null){var s=_0(xh),e=os.transition,t=Xe;try{if(os.transition=null,Xe=16>s?16:s,Mr===null)var i=!1;else{if(s=Mr,Mr=null,xh=0,Ie&6)throw Error(V(331));var r=Ie;for(Ie|=4,j=s.current;j!==null;){var n=j,a=n.child;if(j.flags&16){var o=n.deletions;if(o!==null){for(var l=0;l<o.length;l++){var h=o[l];for(j=h;j!==null;){var u=j;switch(u.tag){case 0:case 11:case 15:so(8,u,n)}var c=u.child;if(c!==null)c.return=u,j=c;else for(;j!==null;){u=j;var d=u.sibling,p=u.return;if(R1(u),u===h){j=null;break}if(d!==null){d.return=p,j=d;break}j=p}}}var g=n.alternate;if(g!==null){var w=g.child;if(w!==null){g.child=null;do{var S=w.sibling;w.sibling=null,w=S}while(w!==null)}}j=n}}if(n.subtreeFlags&2064&&a!==null)a.return=n,j=a;else e:for(;j!==null;){if(n=j,n.flags&2048)switch(n.tag){case 0:case 11:case 15:so(9,n,n.return)}var b=n.sibling;if(b!==null){b.return=n.return,j=b;break e}j=n.return}}var m=s.current;for(j=m;j!==null;){a=j;var y=a.child;if(a.subtreeFlags&2064&&y!==null)y.return=a,j=y;else e:for(a=m;j!==null;){if(o=j,o.flags&2048)try{switch(o.tag){case 0:case 11:case 15:iu(9,o)}}catch(_){bt(o,o.return,_)}if(o===a){j=null;break e}var B=o.sibling;if(B!==null){B.return=o.return,j=B;break e}j=o.return}}if(Ie=r,Kr(),Us&&typeof Us.onPostCommitFiberRoot=="function")try{Us.onPostCommitFiberRoot(Qh,s)}catch{}i=!0}return i}finally{Xe=t,os.transition=e}}return!1}function Ig(s,e,t){e=ma(t,e),e=B1(s,e,1),s=Or(s,e,1),e=_i(),s!==null&&(tl(s,1,e),Di(s,e))}function bt(s,e,t){if(s.tag===3)Ig(s,s,t);else for(;e!==null;){if(e.tag===3){Ig(e,s,t);break}else if(e.tag===1){var i=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof i.componentDidCatch=="function"&&(Vr===null||!Vr.has(i))){s=ma(t,s),s=x1(e,s,1),e=Or(e,s,1),s=_i(),e!==null&&(tl(e,1,s),Di(e,s));break}}e=e.return}}function P_(s,e,t){var i=s.pingCache;i!==null&&i.delete(e),e=_i(),s.pingedLanes|=s.suspendedLanes&t,Qt===s&&(ri&t)===t&&(Ht===4||Ht===3&&(ri&130023424)===ri&&500>xt()-Af?pn(s,0):Df|=t),Di(s,e)}function U1(s,e){e===0&&(s.mode&1?(e=Sl,Sl<<=1,!(Sl&130023424)&&(Sl=4194304)):e=1);var t=_i();s=pr(s,e),s!==null&&(tl(s,e,t),Di(s,t))}function C_(s){var e=s.memoizedState,t=0;e!==null&&(t=e.retryLane),U1(s,t)}function E_(s,e){var t=0;switch(s.tag){case 13:var i=s.stateNode,r=s.memoizedState;r!==null&&(t=r.retryLane);break;case 19:i=s.stateNode;break;default:throw Error(V(314))}i!==null&&i.delete(e),U1(s,t)}var $1;$1=function(s,e,t){if(s!==null)if(s.memoizedProps!==e.pendingProps||Fi.current)Li=!0;else{if(!(s.lanes&t)&&!(e.flags&128))return Li=!1,y_(s,e,t);Li=!!(s.flags&131072)}else Li=!1,lt&&e.flags&1048576&&Q0(e,gh,e.index);switch(e.lanes=0,e.tag){case 2:var i=e.type;Xl(s,e),s=e.pendingProps;var r=da(e,pi.current);la(e,t),r=Cf(null,e,i,s,r,t);var n=Ef();return e.flags|=1,typeof r=="object"&&r!==null&&typeof r.render=="function"&&r.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,Ri(i)?(n=!0,fh(e)):n=!1,e.memoizedState=r.state!==null&&r.state!==void 0?r.state:null,xf(e),r.updater=eu,e.stateNode=r,r._reactInternals=e,ad(e,i,s,t),e=hd(null,e,i,!0,n,t)):(e.tag=0,lt&&n&&yf(e),wi(null,e,r,t),e=e.child),e;case 16:i=e.elementType;e:{switch(Xl(s,e),s=e.pendingProps,r=i._init,i=r(i._payload),e.type=i,r=e.tag=M_(i),s=fs(i,s),r){case 0:e=ld(null,e,i,s,t);break e;case 1:e=Ng(null,e,i,s,t);break e;case 11:e=vg(null,e,i,s,t);break e;case 14:e=Tg(null,e,i,fs(i.type,s),t);break e}throw Error(V(306,i,""))}return e;case 0:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:fs(i,r),ld(s,e,i,r,t);case 1:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:fs(i,r),Ng(s,e,i,r,t);case 3:e:{if(P1(e),s===null)throw Error(V(387));i=e.pendingProps,n=e.memoizedState,r=n.element,j0(s,e),wh(e,i,null,t);var a=e.memoizedState;if(i=a.element,n.isDehydrated)if(n={element:i,isDehydrated:!1,cache:a.cache,pendingSuspenseBoundaries:a.pendingSuspenseBoundaries,transitions:a.transitions},e.updateQueue.baseState=n,e.memoizedState=n,e.flags&256){r=ma(Error(V(423)),e),e=Pg(s,e,i,t,r);break e}else if(i!==r){r=ma(Error(V(424)),e),e=Pg(s,e,i,t,r);break e}else for(Gi=Ir(e.stateNode.containerInfo.firstChild),Yi=e,lt=!0,ms=null,t=i1(e,null,i,t),e.child=t;t;)t.flags=t.flags&-3|4096,t=t.sibling;else{if(fa(),i===r){e=gr(s,e,t);break e}wi(s,e,i,t)}e=e.child}return e;case 5:return s1(e),s===null&&sd(e),i=e.type,r=e.pendingProps,n=s!==null?s.memoizedProps:null,a=r.children,jc(i,r)?a=null:n!==null&&jc(i,n)&&(e.flags|=32),N1(s,e),wi(s,e,a,t),e.child;case 6:return s===null&&sd(e),null;case 13:return C1(s,e,t);case 4:return vf(e,e.stateNode.containerInfo),i=e.pendingProps,s===null?e.child=pa(e,null,i,t):wi(s,e,i,t),e.child;case 11:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:fs(i,r),vg(s,e,i,r,t);case 7:return wi(s,e,e.pendingProps,t),e.child;case 8:return wi(s,e,e.pendingProps.children,t),e.child;case 12:return wi(s,e,e.pendingProps.children,t),e.child;case 10:e:{if(i=e.type._context,r=e.pendingProps,n=e.memoizedProps,a=r.value,Ze(mh,i._currentValue),i._currentValue=a,n!==null)if(Ps(n.value,a)){if(n.children===r.children&&!Fi.current){e=gr(s,e,t);break e}}else for(n=e.child,n!==null&&(n.return=e);n!==null;){var o=n.dependencies;if(o!==null){a=n.child;for(var l=o.firstContext;l!==null;){if(l.context===i){if(n.tag===1){l=hr(-1,t&-t),l.tag=2;var h=n.updateQueue;if(h!==null){h=h.shared;var u=h.pending;u===null?l.next=l:(l.next=u.next,u.next=l),h.pending=l}}n.lanes|=t,l=n.alternate,l!==null&&(l.lanes|=t),rd(n.return,t,e),o.lanes|=t;break}l=l.next}}else if(n.tag===10)a=n.type===e.type?null:n.child;else if(n.tag===18){if(a=n.return,a===null)throw Error(V(341));a.lanes|=t,o=a.alternate,o!==null&&(o.lanes|=t),rd(a,t,e),a=n.sibling}else a=n.child;if(a!==null)a.return=n;else for(a=n;a!==null;){if(a===e){a=null;break}if(n=a.sibling,n!==null){n.return=a.return,a=n;break}a=a.return}n=a}wi(s,e,r.children,t),e=e.child}return e;case 9:return r=e.type,i=e.pendingProps.children,la(e,t),r=ls(r),i=i(r),e.flags|=1,wi(s,e,i,t),e.child;case 14:return i=e.type,r=fs(i,e.pendingProps),r=fs(i.type,r),Tg(s,e,i,r,t);case 15:return v1(s,e,e.type,e.pendingProps,t);case 17:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:fs(i,r),Xl(s,e),e.tag=1,Ri(i)?(s=!0,fh(e)):s=!1,la(e,t),e1(e,i,r),ad(e,i,r,t),hd(null,e,i,!0,s,t);case 19:return E1(s,e,t);case 22:return T1(s,e,t)}throw Error(V(156,e.tag))};function Y1(s,e){return w0(s,e)}function L_(s,e,t,i){this.tag=s,this.key=t,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=i,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function as(s,e,t,i){return new L_(s,e,t,i)}function Hf(s){return s=s.prototype,!(!s||!s.isReactComponent)}function M_(s){if(typeof s=="function")return Hf(s)?1:0;if(s!=null){if(s=s.$$typeof,s===nf)return 11;if(s===af)return 14}return 2}function Wr(s,e){var t=s.alternate;return t===null?(t=as(s.tag,e,s.key,s.mode),t.elementType=s.elementType,t.type=s.type,t.stateNode=s.stateNode,t.alternate=s,s.alternate=t):(t.pendingProps=e,t.type=s.type,t.flags=0,t.subtreeFlags=0,t.deletions=null),t.flags=s.flags&14680064,t.childLanes=s.childLanes,t.lanes=s.lanes,t.child=s.child,t.memoizedProps=s.memoizedProps,t.memoizedState=s.memoizedState,t.updateQueue=s.updateQueue,e=s.dependencies,t.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},t.sibling=s.sibling,t.index=s.index,t.ref=s.ref,t}function ql(s,e,t,i,r,n){var a=2;if(i=s,typeof s=="function")Hf(s)&&(a=1);else if(typeof s=="string")a=5;else e:switch(s){case $n:return gn(t.children,r,n,e);case rf:a=8,r|=8;break;case Ec:return s=as(12,t,e,r|2),s.elementType=Ec,s.lanes=n,s;case Lc:return s=as(13,t,e,r),s.elementType=Lc,s.lanes=n,s;case Mc:return s=as(19,t,e,r),s.elementType=Mc,s.lanes=n,s;case t0:return ru(t,r,n,e);default:if(typeof s=="object"&&s!==null)switch(s.$$typeof){case Zy:a=10;break e;case e0:a=9;break e;case nf:a=11;break e;case af:a=14;break e;case Tr:a=16,i=null;break e}throw Error(V(130,s==null?s:typeof s,""))}return e=as(a,t,e,r),e.elementType=s,e.type=i,e.lanes=n,e}function gn(s,e,t,i){return s=as(7,s,i,e),s.lanes=t,s}function ru(s,e,t,i){return s=as(22,s,i,e),s.elementType=t0,s.lanes=t,s.stateNode={isHidden:!1},s}function rc(s,e,t){return s=as(6,s,null,e),s.lanes=t,s}function nc(s,e,t){return e=as(4,s.children!==null?s.children:[],s.key,e),e.lanes=t,e.stateNode={containerInfo:s.containerInfo,pendingChildren:null,implementation:s.implementation},e}function F_(s,e,t,i,r){this.tag=e,this.containerInfo=s,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Vu(0),this.expirationTimes=Vu(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Vu(0),this.identifierPrefix=i,this.onRecoverableError=r,this.mutableSourceEagerHydrationData=null}function Wf(s,e,t,i,r,n,a,o,l){return s=new F_(s,e,t,o,l),e===1?(e=1,n===!0&&(e|=8)):e=0,n=as(3,null,null,e),s.current=n,n.stateNode=s,n.memoizedState={element:i,isDehydrated:t,cache:null,transitions:null,pendingSuspenseBoundaries:null},xf(n),s}function R_(s,e,t){var i=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Un,key:i==null?null:""+i,children:s,containerInfo:e,implementation:t}}function X1(s){if(!s)return Ur;s=s._reactInternals;e:{if(Fn(s)!==s||s.tag!==1)throw Error(V(170));var e=s;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(Ri(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(V(171))}if(s.tag===1){var t=s.type;if(Ri(t))return Y0(s,t,e)}return e}function Q1(s,e,t,i,r,n,a,o,l){return s=Wf(t,i,!0,s,r,n,a,o,l),s.context=X1(null),t=s.current,i=_i(),r=Hr(t),n=hr(i,r),n.callback=e??null,Or(t,n,r),s.current.lanes=r,tl(s,r,i),Di(s,i),s}function nu(s,e,t,i){var r=e.current,n=_i(),a=Hr(r);return t=X1(t),e.context===null?e.context=t:e.pendingContext=t,e=hr(n,a),e.payload={element:s},i=i===void 0?null:i,i!==null&&(e.callback=i),s=Or(r,e,a),s!==null&&(vs(s,r,a,n),Ul(s,r,a)),a}function Th(s){if(s=s.current,!s.child)return null;switch(s.child.tag){case 5:return s.child.stateNode;default:return s.child.stateNode}}function Og(s,e){if(s=s.memoizedState,s!==null&&s.dehydrated!==null){var t=s.retryLane;s.retryLane=t!==0&&t<e?t:e}}function zf(s,e){Og(s,e),(s=s.alternate)&&Og(s,e)}function D_(){return null}var J1=typeof reportError=="function"?reportError:function(s){console.error(s)};function Gf(s){this._internalRoot=s}au.prototype.render=Gf.prototype.render=function(s){var e=this._internalRoot;if(e===null)throw Error(V(409));nu(s,e,null,null)};au.prototype.unmount=Gf.prototype.unmount=function(){var s=this._internalRoot;if(s!==null){this._internalRoot=null;var e=s.containerInfo;xn(function(){nu(null,s,null,null)}),e[fr]=null}};function au(s){this._internalRoot=s}au.prototype.unstable_scheduleHydration=function(s){if(s){var e=v0();s={blockedOn:null,target:s,priority:e};for(var t=0;t<Cr.length&&e!==0&&e<Cr[t].priority;t++);Cr.splice(t,0,s),t===0&&N0(s)}};function Uf(s){return!(!s||s.nodeType!==1&&s.nodeType!==9&&s.nodeType!==11)}function ou(s){return!(!s||s.nodeType!==1&&s.nodeType!==9&&s.nodeType!==11&&(s.nodeType!==8||s.nodeValue!==" react-mount-point-unstable "))}function Vg(){}function A_(s,e,t,i,r){if(r){if(typeof i=="function"){var n=i;i=function(){var h=Th(a);n.call(h)}}var a=Q1(e,i,s,0,null,!1,!1,"",Vg);return s._reactRootContainer=a,s[fr]=a.current,_o(s.nodeType===8?s.parentNode:s),xn(),a}for(;r=s.lastChild;)s.removeChild(r);if(typeof i=="function"){var o=i;i=function(){var h=Th(l);o.call(h)}}var l=Wf(s,0,!1,null,null,!1,!1,"",Vg);return s._reactRootContainer=l,s[fr]=l.current,_o(s.nodeType===8?s.parentNode:s),xn(function(){nu(e,l,t,i)}),l}function lu(s,e,t,i,r){var n=t._reactRootContainer;if(n){var a=n;if(typeof r=="function"){var o=r;r=function(){var l=Th(a);o.call(l)}}nu(e,a,s,r)}else a=A_(t,e,s,r,i);return Th(a)}B0=function(s){switch(s.tag){case 3:var e=s.stateNode;if(e.current.memoizedState.isDehydrated){var t=Xa(e.pendingLanes);t!==0&&(hf(e,t|1),Di(e,xt()),!(Ie&6)&&(ya=xt()+500,Kr()))}break;case 13:xn(function(){var i=pr(s,1);if(i!==null){var r=_i();vs(i,s,1,r)}}),zf(s,1)}};uf=function(s){if(s.tag===13){var e=pr(s,134217728);if(e!==null){var t=_i();vs(e,s,134217728,t)}zf(s,134217728)}};x0=function(s){if(s.tag===13){var e=Hr(s),t=pr(s,e);if(t!==null){var i=_i();vs(t,s,e,i)}zf(s,e)}};v0=function(){return Xe};T0=function(s,e){var t=Xe;try{return Xe=s,e()}finally{Xe=t}};zc=function(s,e,t){switch(e){case"input":if(Dc(s,t),e=t.name,t.type==="radio"&&e!=null){for(t=s;t.parentNode;)t=t.parentNode;for(t=t.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<t.length;e++){var i=t[e];if(i!==s&&i.form===s.form){var r=jh(i);if(!r)throw Error(V(90));s0(i),Dc(i,r)}}}break;case"textarea":n0(s,t);break;case"select":e=t.value,e!=null&&ra(s,!!t.multiple,e,!1)}};d0=If;f0=xn;var I_={usingClientEntryPoint:!1,Events:[sl,Jn,jh,u0,c0,If]},Wa={findFiberByHostInstance:nn,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},O_={bundleType:Wa.bundleType,version:Wa.version,rendererPackageName:Wa.rendererPackageName,rendererConfig:Wa.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:br.ReactCurrentDispatcher,findHostInstanceByFiber:function(s){return s=m0(s),s===null?null:s.stateNode},findFiberByHostInstance:Wa.findFiberByHostInstance||D_,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Ll=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Ll.isDisabled&&Ll.supportsFiber)try{Qh=Ll.inject(O_),Us=Ll}catch{}}ji.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=I_;ji.createPortal=function(s,e){var t=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Uf(e))throw Error(V(200));return R_(s,e,null,t)};ji.createRoot=function(s,e){if(!Uf(s))throw Error(V(299));var t=!1,i="",r=J1;return e!=null&&(e.unstable_strictMode===!0&&(t=!0),e.identifierPrefix!==void 0&&(i=e.identifierPrefix),e.onRecoverableError!==void 0&&(r=e.onRecoverableError)),e=Wf(s,1,!1,null,null,t,!1,i,r),s[fr]=e.current,_o(s.nodeType===8?s.parentNode:s),new Gf(e)};ji.findDOMNode=function(s){if(s==null)return null;if(s.nodeType===1)return s;var e=s._reactInternals;if(e===void 0)throw typeof s.render=="function"?Error(V(188)):(s=Object.keys(s).join(","),Error(V(268,s)));return s=m0(e),s=s===null?null:s.stateNode,s};ji.flushSync=function(s){return xn(s)};ji.hydrate=function(s,e,t){if(!ou(e))throw Error(V(200));return lu(null,s,e,!0,t)};ji.hydrateRoot=function(s,e,t){if(!Uf(s))throw Error(V(405));var i=t!=null&&t.hydratedSources||null,r=!1,n="",a=J1;if(t!=null&&(t.unstable_strictMode===!0&&(r=!0),t.identifierPrefix!==void 0&&(n=t.identifierPrefix),t.onRecoverableError!==void 0&&(a=t.onRecoverableError)),e=Q1(e,null,s,1,t??null,r,!1,n,a),s[fr]=e.current,_o(s),i)for(s=0;s<i.length;s++)t=i[s],r=t._getVersion,r=r(t._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[t,r]:e.mutableSourceEagerHydrationData.push(t,r);return new au(e)};ji.render=function(s,e,t){if(!ou(e))throw Error(V(200));return lu(null,s,e,!1,t)};ji.unmountComponentAtNode=function(s){if(!ou(s))throw Error(V(40));return s._reactRootContainer?(xn(function(){lu(null,null,s,!1,function(){s._reactRootContainer=null,s[fr]=null})}),!0):!1};ji.unstable_batchedUpdates=If;ji.unstable_renderSubtreeIntoContainer=function(s,e,t,i){if(!ou(t))throw Error(V(200));if(s==null||s._reactInternals===void 0)throw Error(V(38));return lu(s,e,t,!1,i)};ji.version="18.2.0-next-9e3b772b8-20220608";function q1(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(q1)}catch(s){console.error(s)}}q1(),Qy.exports=ji;var V_=Qy.exports,K1,Hg=V_;K1=Hg.createRoot,Hg.hydrateRoot;var H_=!1;function W_(s){if(s.sheet)return s.sheet;for(var e=0;e<document.styleSheets.length;e++)if(document.styleSheets[e].ownerNode===s)return document.styleSheets[e]}function z_(s){var e=document.createElement("style");return e.setAttribute("data-emotion",s.key),s.nonce!==void 0&&e.setAttribute("nonce",s.nonce),e.appendChild(document.createTextNode("")),e.setAttribute("data-s",""),e}var G_=function(){function s(t){var i=this;this._insertTag=function(r){var n;i.tags.length===0?i.insertionPoint?n=i.insertionPoint.nextSibling:i.prepend?n=i.container.firstChild:n=i.before:n=i.tags[i.tags.length-1].nextSibling,i.container.insertBefore(r,n),i.tags.push(r)},this.isSpeedy=t.speedy===void 0?!H_:t.speedy,this.tags=[],this.ctr=0,this.nonce=t.nonce,this.key=t.key,this.container=t.container,this.prepend=t.prepend,this.insertionPoint=t.insertionPoint,this.before=null}var e=s.prototype;return e.hydrate=function(i){i.forEach(this._insertTag)},e.insert=function(i){this.ctr%(this.isSpeedy?65e3:1)===0&&this._insertTag(z_(this));var r=this.tags[this.tags.length-1];if(this.isSpeedy){var n=W_(r);try{n.insertRule(i,n.cssRules.length)}catch{}}else r.appendChild(document.createTextNode(i));this.ctr++},e.flush=function(){this.tags.forEach(function(i){var r;return(r=i.parentNode)==null?void 0:r.removeChild(i)}),this.tags=[],this.ctr=0},s}(),ci="-ms-",Nh="-moz-",We="-webkit-",j1="comm",$f="rule",Yf="decl",U_="@import",Z1="@keyframes",$_="@layer",Y_=Math.abs,hu=String.fromCharCode,X_=Object.assign;function Q_(s,e){return ii(s,0)^45?(((e<<2^ii(s,0))<<2^ii(s,1))<<2^ii(s,2))<<2^ii(s,3):0}function ew(s){return s.trim()}function J_(s,e){return(s=e.exec(s))?s[0]:s}function ze(s,e,t){return s.replace(e,t)}function kd(s,e){return s.indexOf(e)}function ii(s,e){return s.charCodeAt(e)|0}function Lo(s,e,t){return s.slice(e,t)}function As(s){return s.length}function Xf(s){return s.length}function Ml(s,e){return e.push(s),s}function q_(s,e){return s.map(e).join("")}var uu=1,wa=1,tw=0,Ai=0,Ft=0,La="";function cu(s,e,t,i,r,n,a){return{value:s,root:e,parent:t,type:i,props:r,children:n,line:uu,column:wa,length:a,return:""}}function za(s,e){return X_(cu("",null,null,"",null,null,0),s,{length:-s.length},e)}function K_(){return Ft}function j_(){return Ft=Ai>0?ii(La,--Ai):0,wa--,Ft===10&&(wa=1,uu--),Ft}function Xi(){return Ft=Ai<tw?ii(La,Ai++):0,wa++,Ft===10&&(wa=1,uu++),Ft}function Ys(){return ii(La,Ai)}function Kl(){return Ai}function nl(s,e){return Lo(La,s,e)}function Mo(s){switch(s){case 0:case 9:case 10:case 13:case 32:return 5;case 33:case 43:case 44:case 47:case 62:case 64:case 126:case 59:case 123:case 125:return 4;case 58:return 3;case 34:case 39:case 40:case 91:return 2;case 41:case 93:return 1}return 0}function iw(s){return uu=wa=1,tw=As(La=s),Ai=0,[]}function sw(s){return La="",s}function jl(s){return ew(nl(Ai-1,_d(s===91?s+2:s===40?s+1:s)))}function Z_(s){for(;(Ft=Ys())&&Ft<33;)Xi();return Mo(s)>2||Mo(Ft)>3?"":" "}function eB(s,e){for(;--e&&Xi()&&!(Ft<48||Ft>102||Ft>57&&Ft<65||Ft>70&&Ft<97););return nl(s,Kl()+(e<6&&Ys()==32&&Xi()==32))}function _d(s){for(;Xi();)switch(Ft){case s:return Ai;case 34:case 39:s!==34&&s!==39&&_d(Ft);break;case 40:s===41&&_d(s);break;case 92:Xi();break}return Ai}function tB(s,e){for(;Xi()&&s+Ft!==57;)if(s+Ft===84&&Ys()===47)break;return"/*"+nl(e,Ai-1)+"*"+hu(s===47?s:Xi())}function iB(s){for(;!Mo(Ys());)Xi();return nl(s,Ai)}function sB(s){return sw(Zl("",null,null,null,[""],s=iw(s),0,[0],s))}function Zl(s,e,t,i,r,n,a,o,l){for(var h=0,u=0,c=a,d=0,p=0,g=0,w=1,S=1,b=1,m=0,y="",B=r,_=n,P=i,N=y;S;)switch(g=m,m=Xi()){case 40:if(g!=108&&ii(N,c-1)==58){kd(N+=ze(jl(m),"&","&\f"),"&\f")!=-1&&(b=-1);break}case 34:case 39:case 91:N+=jl(m);break;case 9:case 10:case 13:case 32:N+=Z_(g);break;case 92:N+=eB(Kl()-1,7);continue;case 47:switch(Ys()){case 42:case 47:Ml(rB(tB(Xi(),Kl()),e,t),l);break;default:N+="/"}break;case 123*w:o[h++]=As(N)*b;case 125*w:case 59:case 0:switch(m){case 0:case 125:S=0;case 59+u:b==-1&&(N=ze(N,/\f/g,"")),p>0&&As(N)-c&&Ml(p>32?zg(N+";",i,t,c-1):zg(ze(N," ","")+";",i,t,c-2),l);break;case 59:N+=";";default:if(Ml(P=Wg(N,e,t,h,u,r,o,y,B=[],_=[],c),n),m===123)if(u===0)Zl(N,e,P,P,B,n,c,o,_);else switch(d===99&&ii(N,3)===110?100:d){case 100:case 108:case 109:case 115:Zl(s,P,P,i&&Ml(Wg(s,P,P,0,0,r,o,y,r,B=[],c),_),r,_,c,o,i?B:_);break;default:Zl(N,P,P,P,[""],_,0,o,_)}}h=u=p=0,w=b=1,y=N="",c=a;break;case 58:c=1+As(N),p=g;default:if(w<1){if(m==123)--w;else if(m==125&&w++==0&&j_()==125)continue}switch(N+=hu(m),m*w){case 38:b=u>0?1:(N+="\f",-1);break;case 44:o[h++]=(As(N)-1)*b,b=1;break;case 64:Ys()===45&&(N+=jl(Xi())),d=Ys(),u=c=As(y=N+=iB(Kl())),m++;break;case 45:g===45&&As(N)==2&&(w=0)}}return n}function Wg(s,e,t,i,r,n,a,o,l,h,u){for(var c=r-1,d=r===0?n:[""],p=Xf(d),g=0,w=0,S=0;g<i;++g)for(var b=0,m=Lo(s,c+1,c=Y_(w=a[g])),y=s;b<p;++b)(y=ew(w>0?d[b]+" "+m:ze(m,/&\f/g,d[b])))&&(l[S++]=y);return cu(s,e,t,r===0?$f:o,l,h,u)}function rB(s,e,t){return cu(s,e,t,j1,hu(K_()),Lo(s,2,-2),0)}function zg(s,e,t,i){return cu(s,e,t,Yf,Lo(s,0,i),Lo(s,i+1,-1),i)}function ua(s,e){for(var t="",i=Xf(s),r=0;r<i;r++)t+=e(s[r],r,s,e)||"";return t}function nB(s,e,t,i){switch(s.type){case $_:if(s.children.length)break;case U_:case Yf:return s.return=s.return||s.value;case j1:return"";case Z1:return s.return=s.value+"{"+ua(s.children,i)+"}";case $f:s.value=s.props.join(",")}return As(t=ua(s.children,i))?s.return=s.value+"{"+t+"}":""}function aB(s){var e=Xf(s);return function(t,i,r,n){for(var a="",o=0;o<e;o++)a+=s[o](t,i,r,n)||"";return a}}function oB(s){return function(e){e.root||(e=e.return)&&s(e)}}function lB(s){var e=Object.create(null);return function(t){return e[t]===void 0&&(e[t]=s(t)),e[t]}}var hB=function(e,t,i){for(var r=0,n=0;r=n,n=Ys(),r===38&&n===12&&(t[i]=1),!Mo(n);)Xi();return nl(e,Ai)},uB=function(e,t){var i=-1,r=44;do switch(Mo(r)){case 0:r===38&&Ys()===12&&(t[i]=1),e[i]+=hB(Ai-1,t,i);break;case 2:e[i]+=jl(r);break;case 4:if(r===44){e[++i]=Ys()===58?"&\f":"",t[i]=e[i].length;break}default:e[i]+=hu(r)}while(r=Xi());return e},cB=function(e,t){return sw(uB(iw(e),t))},Gg=new WeakMap,dB=function(e){if(!(e.type!=="rule"||!e.parent||e.length<1)){for(var t=e.value,i=e.parent,r=e.column===i.column&&e.line===i.line;i.type!=="rule";)if(i=i.parent,!i)return;if(!(e.props.length===1&&t.charCodeAt(0)!==58&&!Gg.get(i))&&!r){Gg.set(e,!0);for(var n=[],a=cB(t,n),o=i.props,l=0,h=0;l<a.length;l++)for(var u=0;u<o.length;u++,h++)e.props[h]=n[l]?a[l].replace(/&\f/g,o[u]):o[u]+" "+a[l]}}},fB=function(e){if(e.type==="decl"){var t=e.value;t.charCodeAt(0)===108&&t.charCodeAt(2)===98&&(e.return="",e.value="")}};function rw(s,e){switch(Q_(s,e)){case 5103:return We+"print-"+s+s;case 5737:case 4201:case 3177:case 3433:case 1641:case 4457:case 2921:case 5572:case 6356:case 5844:case 3191:case 6645:case 3005:case 6391:case 5879:case 5623:case 6135:case 4599:case 4855:case 4215:case 6389:case 5109:case 5365:case 5621:case 3829:return We+s+s;case 5349:case 4246:case 4810:case 6968:case 2756:return We+s+Nh+s+ci+s+s;case 6828:case 4268:return We+s+ci+s+s;case 6165:return We+s+ci+"flex-"+s+s;case 5187:return We+s+ze(s,/(\w+).+(:[^]+)/,We+"box-$1$2"+ci+"flex-$1$2")+s;case 5443:return We+s+ci+"flex-item-"+ze(s,/flex-|-self/,"")+s;case 4675:return We+s+ci+"flex-line-pack"+ze(s,/align-content|flex-|-self/,"")+s;case 5548:return We+s+ci+ze(s,"shrink","negative")+s;case 5292:return We+s+ci+ze(s,"basis","preferred-size")+s;case 6060:return We+"box-"+ze(s,"-grow","")+We+s+ci+ze(s,"grow","positive")+s;case 4554:return We+ze(s,/([^-])(transform)/g,"$1"+We+"$2")+s;case 6187:return ze(ze(ze(s,/(zoom-|grab)/,We+"$1"),/(image-set)/,We+"$1"),s,"")+s;case 5495:case 3959:return ze(s,/(image-set\([^]*)/,We+"$1$`$1");case 4968:return ze(ze(s,/(.+:)(flex-)?(.*)/,We+"box-pack:$3"+ci+"flex-pack:$3"),/s.+-b[^;]+/,"justify")+We+s+s;case 4095:case 3583:case 4068:case 2532:return ze(s,/(.+)-inline(.+)/,We+"$1$2")+s;case 8116:case 7059:case 5753:case 5535:case 5445:case 5701:case 4933:case 4677:case 5533:case 5789:case 5021:case 4765:if(As(s)-1-e>6)switch(ii(s,e+1)){case 109:if(ii(s,e+4)!==45)break;case 102:return ze(s,/(.+:)(.+)-([^]+)/,"$1"+We+"$2-$3$1"+Nh+(ii(s,e+3)==108?"$3":"$2-$3"))+s;case 115:return~kd(s,"stretch")?rw(ze(s,"stretch","fill-available"),e)+s:s}break;case 4949:if(ii(s,e+1)!==115)break;case 6444:switch(ii(s,As(s)-3-(~kd(s,"!important")&&10))){case 107:return ze(s,":",":"+We)+s;case 101:return ze(s,/(.+:)([^;!]+)(;|!.+)?/,"$1"+We+(ii(s,14)===45?"inline-":"")+"box$3$1"+We+"$2$3$1"+ci+"$2box$3")+s}break;case 5936:switch(ii(s,e+11)){case 114:return We+s+ci+ze(s,/[svh]\w+-[tblr]{2}/,"tb")+s;case 108:return We+s+ci+ze(s,/[svh]\w+-[tblr]{2}/,"tb-rl")+s;case 45:return We+s+ci+ze(s,/[svh]\w+-[tblr]{2}/,"lr")+s}return We+s+ci+s+s}return s}var pB=function(e,t,i,r){if(e.length>-1&&!e.return)switch(e.type){case Yf:e.return=rw(e.value,e.length);break;case Z1:return ua([za(e,{value:ze(e.value,"@","@"+We)})],r);case $f:if(e.length)return q_(e.props,function(n){switch(J_(n,/(::plac\w+|:read-\w+)/)){case":read-only":case":read-write":return ua([za(e,{props:[ze(n,/:(read-\w+)/,":"+Nh+"$1")]})],r);case"::placeholder":return ua([za(e,{props:[ze(n,/:(plac\w+)/,":"+We+"input-$1")]}),za(e,{props:[ze(n,/:(plac\w+)/,":"+Nh+"$1")]}),za(e,{props:[ze(n,/:(plac\w+)/,ci+"input-$1")]})],r)}return""})}},gB=[pB],nw=function(e){var t=e.key;if(t==="css"){var i=document.querySelectorAll("style[data-emotion]:not([data-s])");Array.prototype.forEach.call(i,function(w){var S=w.getAttribute("data-emotion");S.indexOf(" ")!==-1&&(document.head.appendChild(w),w.setAttribute("data-s",""))})}var r=e.stylisPlugins||gB,n={},a,o=[];a=e.container||document.head,Array.prototype.forEach.call(document.querySelectorAll('style[data-emotion^="'+t+' "]'),function(w){for(var S=w.getAttribute("data-emotion").split(" "),b=1;b<S.length;b++)n[S[b]]=!0;o.push(w)});var l,h=[dB,fB];{var u,c=[nB,oB(function(w){u.insert(w)})],d=aB(h.concat(r,c)),p=function(S){return ua(sB(S),d)};l=function(S,b,m,y){u=m,p(S?S+"{"+b.styles+"}":b.styles),y&&(g.inserted[b.name]=!0)}}var g={key:t,sheet:new G_({key:t,container:a,nonce:e.nonce,speedy:e.speedy,prepend:e.prepend,insertionPoint:e.insertionPoint}),nonce:e.nonce,inserted:n,registered:{},insert:l};return g.sheet.hydrate(o),g},aw={exports:{}},Qe={};/** @license React v16.13.1
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Jt=typeof Symbol=="function"&&Symbol.for,Qf=Jt?Symbol.for("react.element"):60103,Jf=Jt?Symbol.for("react.portal"):60106,du=Jt?Symbol.for("react.fragment"):60107,fu=Jt?Symbol.for("react.strict_mode"):60108,pu=Jt?Symbol.for("react.profiler"):60114,gu=Jt?Symbol.for("react.provider"):60109,mu=Jt?Symbol.for("react.context"):60110,qf=Jt?Symbol.for("react.async_mode"):60111,yu=Jt?Symbol.for("react.concurrent_mode"):60111,wu=Jt?Symbol.for("react.forward_ref"):60112,bu=Jt?Symbol.for("react.suspense"):60113,mB=Jt?Symbol.for("react.suspense_list"):60120,Su=Jt?Symbol.for("react.memo"):60115,ku=Jt?Symbol.for("react.lazy"):60116,yB=Jt?Symbol.for("react.block"):60121,wB=Jt?Symbol.for("react.fundamental"):60117,bB=Jt?Symbol.for("react.responder"):60118,SB=Jt?Symbol.for("react.scope"):60119;function es(s){if(typeof s=="object"&&s!==null){var e=s.$$typeof;switch(e){case Qf:switch(s=s.type,s){case qf:case yu:case du:case pu:case fu:case bu:return s;default:switch(s=s&&s.$$typeof,s){case mu:case wu:case ku:case Su:case gu:return s;default:return e}}case Jf:return e}}}function ow(s){return es(s)===yu}Qe.AsyncMode=qf;Qe.ConcurrentMode=yu;Qe.ContextConsumer=mu;Qe.ContextProvider=gu;Qe.Element=Qf;Qe.ForwardRef=wu;Qe.Fragment=du;Qe.Lazy=ku;Qe.Memo=Su;Qe.Portal=Jf;Qe.Profiler=pu;Qe.StrictMode=fu;Qe.Suspense=bu;Qe.isAsyncMode=function(s){return ow(s)||es(s)===qf};Qe.isConcurrentMode=ow;Qe.isContextConsumer=function(s){return es(s)===mu};Qe.isContextProvider=function(s){return es(s)===gu};Qe.isElement=function(s){return typeof s=="object"&&s!==null&&s.$$typeof===Qf};Qe.isForwardRef=function(s){return es(s)===wu};Qe.isFragment=function(s){return es(s)===du};Qe.isLazy=function(s){return es(s)===ku};Qe.isMemo=function(s){return es(s)===Su};Qe.isPortal=function(s){return es(s)===Jf};Qe.isProfiler=function(s){return es(s)===pu};Qe.isStrictMode=function(s){return es(s)===fu};Qe.isSuspense=function(s){return es(s)===bu};Qe.isValidElementType=function(s){return typeof s=="string"||typeof s=="function"||s===du||s===yu||s===pu||s===fu||s===bu||s===mB||typeof s=="object"&&s!==null&&(s.$$typeof===ku||s.$$typeof===Su||s.$$typeof===gu||s.$$typeof===mu||s.$$typeof===wu||s.$$typeof===wB||s.$$typeof===bB||s.$$typeof===SB||s.$$typeof===yB)};Qe.typeOf=es;aw.exports=Qe;var kB=aw.exports,lw=kB,_B={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},BB={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},hw={};hw[lw.ForwardRef]=_B;hw[lw.Memo]=BB;var xB=!0;function uw(s,e,t){var i="";return t.split(" ").forEach(function(r){s[r]!==void 0?e.push(s[r]+";"):r&&(i+=r+" ")}),i}var vB=function(e,t,i){var r=e.key+"-"+t.name;(i===!1||xB===!1)&&e.registered[r]===void 0&&(e.registered[r]=t.styles)},cw=function(e,t,i){vB(e,t,i);var r=e.key+"-"+t.name;if(e.inserted[t.name]===void 0){var n=t;do e.insert(t===n?"."+r:"",n,e.sheet,!0),n=n.next;while(n!==void 0)}};function TB(s){for(var e=0,t,i=0,r=s.length;r>=4;++i,r-=4)t=s.charCodeAt(i)&255|(s.charCodeAt(++i)&255)<<8|(s.charCodeAt(++i)&255)<<16|(s.charCodeAt(++i)&255)<<24,t=(t&65535)*1540483477+((t>>>16)*59797<<16),t^=t>>>24,e=(t&65535)*1540483477+((t>>>16)*59797<<16)^(e&65535)*1540483477+((e>>>16)*59797<<16);switch(r){case 3:e^=(s.charCodeAt(i+2)&255)<<16;case 2:e^=(s.charCodeAt(i+1)&255)<<8;case 1:e^=s.charCodeAt(i)&255,e=(e&65535)*1540483477+((e>>>16)*59797<<16)}return e^=e>>>13,e=(e&65535)*1540483477+((e>>>16)*59797<<16),((e^e>>>15)>>>0).toString(36)}var NB={animationIterationCount:1,aspectRatio:1,borderImageOutset:1,borderImageSlice:1,borderImageWidth:1,boxFlex:1,boxFlexGroup:1,boxOrdinalGroup:1,columnCount:1,columns:1,flex:1,flexGrow:1,flexPositive:1,flexShrink:1,flexNegative:1,flexOrder:1,gridRow:1,gridRowEnd:1,gridRowSpan:1,gridRowStart:1,gridColumn:1,gridColumnEnd:1,gridColumnSpan:1,gridColumnStart:1,msGridRow:1,msGridRowSpan:1,msGridColumn:1,msGridColumnSpan:1,fontWeight:1,lineHeight:1,opacity:1,order:1,orphans:1,scale:1,tabSize:1,widows:1,zIndex:1,zoom:1,WebkitLineClamp:1,fillOpacity:1,floodOpacity:1,stopOpacity:1,strokeDasharray:1,strokeDashoffset:1,strokeMiterlimit:1,strokeOpacity:1,strokeWidth:1},PB=!1,CB=/[A-Z]|^ms/g,EB=/_EMO_([^_]+?)_([^]*?)_EMO_/g,dw=function(e){return e.charCodeAt(1)===45},Ug=function(e){return e!=null&&typeof e!="boolean"},ac=lB(function(s){return dw(s)?s:s.replace(CB,"-$&").toLowerCase()}),$g=function(e,t){switch(e){case"animation":case"animationName":if(typeof t=="string")return t.replace(EB,function(i,r,n){return Is={name:r,styles:n,next:Is},r})}return NB[e]!==1&&!dw(e)&&typeof t=="number"&&t!==0?t+"px":t},LB="Component selectors can only be used in conjunction with @emotion/babel-plugin, the swc Emotion plugin, or another Emotion-aware compiler transform.";function Fo(s,e,t){if(t==null)return"";var i=t;if(i.__emotion_styles!==void 0)return i;switch(typeof t){case"boolean":return"";case"object":{var r=t;if(r.anim===1)return Is={name:r.name,styles:r.styles,next:Is},r.name;var n=t;if(n.styles!==void 0){var a=n.next;if(a!==void 0)for(;a!==void 0;)Is={name:a.name,styles:a.styles,next:Is},a=a.next;var o=n.styles+";";return o}return MB(s,e,t)}case"function":{if(s!==void 0){var l=Is,h=t(s);return Is=l,Fo(s,e,h)}break}}var u=t;if(e==null)return u;var c=e[u];return c!==void 0?c:u}function MB(s,e,t){var i="";if(Array.isArray(t))for(var r=0;r<t.length;r++)i+=Fo(s,e,t[r])+";";else for(var n in t){var a=t[n];if(typeof a!="object"){var o=a;e!=null&&e[o]!==void 0?i+=n+"{"+e[o]+"}":Ug(o)&&(i+=ac(n)+":"+$g(n,o)+";")}else{if(n==="NO_COMPONENT_SELECTOR"&&PB)throw new Error(LB);if(Array.isArray(a)&&typeof a[0]=="string"&&(e==null||e[a[0]]===void 0))for(var l=0;l<a.length;l++)Ug(a[l])&&(i+=ac(n)+":"+$g(n,a[l])+";");else{var h=Fo(s,e,a);switch(n){case"animation":case"animationName":{i+=ac(n)+":"+h+";";break}default:i+=n+"{"+h+"}"}}}}return i}var Yg=/label:\s*([^\s;{]+)\s*(;|$)/g,Is;function ao(s,e,t){if(s.length===1&&typeof s[0]=="object"&&s[0]!==null&&s[0].styles!==void 0)return s[0];var i=!0,r="";Is=void 0;var n=s[0];if(n==null||n.raw===void 0)i=!1,r+=Fo(t,e,n);else{var a=n;r+=a[0]}for(var o=1;o<s.length;o++)if(r+=Fo(t,e,s[o]),i){var l=n;r+=l[o]}Yg.lastIndex=0;for(var h="",u;(u=Yg.exec(r))!==null;)h+="-"+u[1];var c=TB(r)+h;return{name:c,styles:r,next:Is}}var FB=fo.useInsertionEffect?fo.useInsertionEffect:!1,Xg=FB||be.useLayoutEffect,fw=be.createContext(typeof HTMLElement<"u"?nw({key:"css"}):null);fw.Provider;var RB=function(e){return be.forwardRef(function(t,i){var r=be.useContext(fw);return e(t,r,i)})},DB=be.createContext({}),AB=RB(function(s,e){var t=s.styles,i=ao([t],void 0,be.useContext(DB)),r=be.useRef();return Xg(function(){var n=e.key+"-global",a=new e.sheet.constructor({key:n,nonce:e.sheet.nonce,container:e.sheet.container,speedy:e.sheet.isSpeedy}),o=!1,l=document.querySelector('style[data-emotion="'+n+" "+i.name+'"]');return e.sheet.tags.length&&(a.before=e.sheet.tags[0]),l!==null&&(o=!0,l.setAttribute("data-emotion",n),a.hydrate([l])),r.current=[a,o],function(){a.flush()}},[e]),Xg(function(){var n=r.current,a=n[0],o=n[1];if(o){n[1]=!1;return}if(i.next!==void 0&&cw(e,i.next,!0),a.tags.length){var l=a.tags[a.tags.length-1].nextElementSibling;a.before=l,a.flush()}e.insert("",i,a,!1)},[e,i.name]),null});function IB(){for(var s=arguments.length,e=new Array(s),t=0;t<s;t++)e[t]=arguments[t];return ao(e)}/**
 * @remix-run/router v1.19.2
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Ph(){return Ph=Object.assign?Object.assign.bind():function(s){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(s[i]=t[i])}return s},Ph.apply(this,arguments)}var ln;(function(s){s.Pop="POP",s.Push="PUSH",s.Replace="REPLACE"})(ln||(ln={}));const Qg="popstate";function OB(s){s===void 0&&(s={});function e(r,n){let{pathname:a="/",search:o="",hash:l=""}=Kf(r.location.hash.substr(1));return!a.startsWith("/")&&!a.startsWith(".")&&(a="/"+a),Bd("",{pathname:a,search:o,hash:l},n.state&&n.state.usr||null,n.state&&n.state.key||"default")}function t(r,n){let a=r.document.querySelector("base"),o="";if(a&&a.getAttribute("href")){let l=r.location.href,h=l.indexOf("#");o=h===-1?l:l.slice(0,h)}return o+"#"+(typeof n=="string"?n:gw(n))}function i(r,n){VB(r.pathname.charAt(0)==="/","relative pathnames are not supported in hash history.push("+JSON.stringify(n)+")")}return WB(e,t,i,s)}function pw(s,e){if(s===!1||s===null||typeof s>"u")throw new Error(e)}function VB(s,e){if(!s){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function HB(){return Math.random().toString(36).substr(2,8)}function Jg(s,e){return{usr:s.state,key:s.key,idx:e}}function Bd(s,e,t,i){return t===void 0&&(t=null),Ph({pathname:typeof s=="string"?s:s.pathname,search:"",hash:""},typeof e=="string"?Kf(e):e,{state:t,key:e&&e.key||i||HB()})}function gw(s){let{pathname:e="/",search:t="",hash:i=""}=s;return t&&t!=="?"&&(e+=t.charAt(0)==="?"?t:"?"+t),i&&i!=="#"&&(e+=i.charAt(0)==="#"?i:"#"+i),e}function Kf(s){let e={};if(s){let t=s.indexOf("#");t>=0&&(e.hash=s.substr(t),s=s.substr(0,t));let i=s.indexOf("?");i>=0&&(e.search=s.substr(i),s=s.substr(0,i)),s&&(e.pathname=s)}return e}function WB(s,e,t,i){i===void 0&&(i={});let{window:r=document.defaultView,v5Compat:n=!1}=i,a=r.history,o=ln.Pop,l=null,h=u();h==null&&(h=0,a.replaceState(Ph({},a.state,{idx:h}),""));function u(){return(a.state||{idx:null}).idx}function c(){o=ln.Pop;let S=u(),b=S==null?null:S-h;h=S,l&&l({action:o,location:w.location,delta:b})}function d(S,b){o=ln.Push;let m=Bd(w.location,S,b);t&&t(m,S),h=u()+1;let y=Jg(m,h),B=w.createHref(m);try{a.pushState(y,"",B)}catch(_){if(_ instanceof DOMException&&_.name==="DataCloneError")throw _;r.location.assign(B)}n&&l&&l({action:o,location:w.location,delta:1})}function p(S,b){o=ln.Replace;let m=Bd(w.location,S,b);t&&t(m,S),h=u();let y=Jg(m,h),B=w.createHref(m);a.replaceState(y,"",B),n&&l&&l({action:o,location:w.location,delta:0})}function g(S){let b=r.location.origin!=="null"?r.location.origin:r.location.href,m=typeof S=="string"?S:gw(S);return m=m.replace(/ $/,"%20"),pw(b,"No window.location.(origin|href) available to create URL for href: "+m),new URL(m,b)}let w={get action(){return o},get location(){return s(r,a)},listen(S){if(l)throw new Error("A history only accepts one active listener");return r.addEventListener(Qg,c),l=S,()=>{r.removeEventListener(Qg,c),l=null}},createHref(S){return e(r,S)},createURL:g,encodeLocation(S){let b=g(S);return{pathname:b.pathname,search:b.search,hash:b.hash}},push:d,replace:p,go(S){return a.go(S)}};return w}var qg;(function(s){s.data="data",s.deferred="deferred",s.redirect="redirect",s.error="error"})(qg||(qg={}));function zB(s,e){if(e==="/")return s;if(!s.toLowerCase().startsWith(e.toLowerCase()))return null;let t=e.endsWith("/")?e.length-1:e.length,i=s.charAt(t);return i&&i!=="/"?null:s.slice(t)||"/"}const mw=["post","put","patch","delete"];new Set(mw);const GB=["get",...mw];new Set(GB);/**
 * React Router v6.26.2
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function xd(){return xd=Object.assign?Object.assign.bind():function(s){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(s[i]=t[i])}return s},xd.apply(this,arguments)}const UB=be.createContext(null),yw=be.createContext(null);function $B(){return be.useContext(yw)!=null}function YB(s){let{basename:e="/",children:t=null,location:i,navigationType:r=ln.Pop,navigator:n,static:a=!1,future:o}=s;$B()&&pw(!1);let l=e.replace(/^\/*/,"/"),h=be.useMemo(()=>({basename:l,navigator:n,static:a,future:xd({v7_relativeSplatPath:!1},o)}),[l,o,n,a]);typeof i=="string"&&(i=Kf(i));let{pathname:u="/",search:c="",hash:d="",state:p=null,key:g="default"}=i,w=be.useMemo(()=>{let S=zB(u,l);return S==null?null:{location:{pathname:S,search:c,hash:d,state:p,key:g},navigationType:r}},[l,u,c,d,p,g,r]);return w==null?null:be.createElement(UB.Provider,{value:h},be.createElement(yw.Provider,{children:t,value:w}))}new Promise(()=>{});/**
 * React Router DOM v6.26.2
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */const XB="6";try{window.__reactRouterVersion=XB}catch{}const QB="startTransition",Kg=fo[QB];function JB(s){let{basename:e,children:t,future:i,window:r}=s,n=be.useRef();n.current==null&&(n.current=OB({window:r,v5Compat:!0}));let a=n.current,[o,l]=be.useState({action:a.action,location:a.location}),{v7_startTransition:h}=i||{},u=be.useCallback(c=>{h&&Kg?Kg(()=>l(c)):l(c)},[l,h]);return be.useLayoutEffect(()=>a.listen(u),[a,u]),be.createElement(YB,{basename:e,children:t,location:o.location,navigationType:o.action,navigator:a,future:i})}var jg;(function(s){s.UseScrollRestoration="useScrollRestoration",s.UseSubmit="useSubmit",s.UseSubmitFetcher="useSubmitFetcher",s.UseFetcher="useFetcher",s.useViewTransitionState="useViewTransitionState"})(jg||(jg={}));var Zg;(function(s){s.UseFetcher="useFetcher",s.UseFetchers="useFetchers",s.UseScrollRestoration="useScrollRestoration"})(Zg||(Zg={}));const qB=(...s)=>{console!=null&&console.warn&&(mn(s[0])&&(s[0]=`react-i18next:: ${s[0]}`),console.warn(...s))},em={},vd=(...s)=>{mn(s[0])&&em[s[0]]||(mn(s[0])&&(em[s[0]]=new Date),qB(...s))},ww=(s,e)=>()=>{if(s.isInitialized)e();else{const t=()=>{setTimeout(()=>{s.off("initialized",t)},0),e()};s.on("initialized",t)}},tm=(s,e,t)=>{s.loadNamespaces(e,ww(s,t))},im=(s,e,t,i)=>{mn(t)&&(t=[t]),t.forEach(r=>{s.options.ns.indexOf(r)<0&&s.options.ns.push(r)}),s.loadLanguages(e,ww(s,i))},KB=(s,e,t={})=>!e.languages||!e.languages.length?(vd("i18n.languages were undefined or empty",e.languages),!0):e.hasLoadedNamespace(s,{lng:t.lng,precheck:(i,r)=>{var n;if(((n=t.bindI18n)==null?void 0:n.indexOf("languageChanging"))>-1&&i.services.backendConnector.backend&&i.isLanguageChangingTo&&!r(i.isLanguageChangingTo,s))return!1}}),mn=s=>typeof s=="string",jB=s=>typeof s=="object"&&s!==null,ZB=/&(?:amp|#38|lt|#60|gt|#62|apos|#39|quot|#34|nbsp|#160|copy|#169|reg|#174|hellip|#8230|#x2F|#47);/g,ex={"&amp;":"&","&#38;":"&","&lt;":"<","&#60;":"<","&gt;":">","&#62;":">","&apos;":"'","&#39;":"'","&quot;":'"',"&#34;":'"',"&nbsp;":" ","&#160;":" ","&copy;":"©","&#169;":"©","&reg;":"®","&#174;":"®","&hellip;":"…","&#8230;":"…","&#x2F;":"/","&#47;":"/"},tx=s=>ex[s],ix=s=>s.replace(ZB,tx);let sx={bindI18n:"languageChanged",bindI18nStore:"",transEmptyNodeValue:"",transSupportBasicHtmlNodes:!0,transWrapTextNodes:"",transKeepBasicHtmlNodesFor:["br","strong","i","p"],useSuspense:!0,unescape:ix};const rx=()=>sx;let nx;const ax=()=>nx,bw=be.createContext();class ox{constructor(){this.usedNamespaces={}}addUsedNamespaces(e){e.forEach(t=>{var i;(i=this.usedNamespaces)[t]??(i[t]=!0)})}getUsedNamespaces(){return Object.keys(this.usedNamespaces)}}const lx=(s,e)=>{const t=be.useRef();return be.useEffect(()=>{t.current=s},[s,e]),t.current},Sw=(s,e,t,i)=>s.getFixedT(e,t,i),hx=(s,e,t,i)=>be.useCallback(Sw(s,e,t,i),[s,e,t,i]),ux=(s,e={})=>{var B,_,P,N;const{i18n:t}=e,{i18n:i,defaultNS:r}=be.useContext(bw)||{},n=t||i||ax();if(n&&!n.reportNamespaces&&(n.reportNamespaces=new ox),!n){vd("You will need to pass in an i18next instance by using initReactI18next");const D=(J,ge)=>mn(ge)?ge:jB(ge)&&mn(ge.defaultValue)?ge.defaultValue:Array.isArray(J)?J[J.length-1]:J,Q=[D,{},!1];return Q.t=D,Q.i18n={},Q.ready=!1,Q}(B=n.options.react)!=null&&B.wait&&vd("It seems you are still using the old wait option, you may migrate to the new useSuspense behaviour.");const a={...rx(),...n.options.react,...e},{useSuspense:o,keyPrefix:l}=a;let h=r||((_=n.options)==null?void 0:_.defaultNS);h=mn(h)?[h]:h||["translation"],(N=(P=n.reportNamespaces).addUsedNamespaces)==null||N.call(P,h);const u=(n.isInitialized||n.initializedStoreOnce)&&h.every(D=>KB(D,n,a)),c=hx(n,e.lng||null,a.nsMode==="fallback"?h:h[0],l),d=()=>c,p=()=>Sw(n,e.lng||null,a.nsMode==="fallback"?h:h[0],l),[g,w]=be.useState(d);let S=h.join();e.lng&&(S=`${e.lng}${S}`);const b=lx(S),m=be.useRef(!0);be.useEffect(()=>{const{bindI18n:D,bindI18nStore:Q}=a;m.current=!0,!u&&!o&&(e.lng?im(n,e.lng,h,()=>{m.current&&w(p)}):tm(n,h,()=>{m.current&&w(p)})),u&&b&&b!==S&&m.current&&w(p);const J=()=>{m.current&&w(p)};return D&&(n==null||n.on(D,J)),Q&&(n==null||n.store.on(Q,J)),()=>{m.current=!1,n&&(D==null||D.split(" ").forEach(ge=>n.off(ge,J))),Q&&n&&Q.split(" ").forEach(ge=>n.store.off(ge,J))}},[n,S]),be.useEffect(()=>{m.current&&u&&w(d)},[n,l,u]);const y=[g,n,u];if(y.t=g,y.i18n=n,y.ready=u,u||!u&&!o)return y;throw new Promise(D=>{e.lng?im(n,e.lng,h,()=>D()):tm(n,h,()=>D())})};function cx({i18n:s,defaultNS:e,children:t}){const i=be.useMemo(()=>({i18n:s,defaultNS:e}),[s,e]);return be.createElement(bw.Provider,{value:i},t)}const dx={type:"logger",log(s){this.output("log",s)},warn(s){this.output("warn",s)},error(s){this.output("error",s)},output(s,e){console&&console[s]&&console[s].apply(console,e)}};let fx=class Td{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.init(e,t)}init(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.prefix=t.prefix||"i18next:",this.logger=e||dx,this.options=t,this.debug=t.debug}log(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return this.forward(t,"log","",!0)}warn(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return this.forward(t,"warn","",!0)}error(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return this.forward(t,"error","")}deprecate(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return this.forward(t,"warn","WARNING DEPRECATED: ",!0)}forward(e,t,i,r){return r&&!this.debug?null:(typeof e[0]=="string"&&(e[0]=`${i}${this.prefix} ${e[0]}`),this.logger[t](e))}create(e){return new Td(this.logger,{prefix:`${this.prefix}:${e}:`,...this.options})}clone(e){return e=e||this.options,e.prefix=e.prefix||this.prefix,new Td(this.logger,e)}};var Gs=new fx;let _u=class{constructor(){this.observers={}}on(e,t){return e.split(" ").forEach(i=>{this.observers[i]||(this.observers[i]=new Map);const r=this.observers[i].get(t)||0;this.observers[i].set(t,r+1)}),this}off(e,t){if(this.observers[e]){if(!t){delete this.observers[e];return}this.observers[e].delete(t)}}emit(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),r=1;r<t;r++)i[r-1]=arguments[r];this.observers[e]&&Array.from(this.observers[e].entries()).forEach(a=>{let[o,l]=a;for(let h=0;h<l;h++)o(...i)}),this.observers["*"]&&Array.from(this.observers["*"].entries()).forEach(a=>{let[o,l]=a;for(let h=0;h<l;h++)o.apply(o,[e,...i])})}};const Ga=()=>{let s,e;const t=new Promise((i,r)=>{s=i,e=r});return t.resolve=s,t.reject=e,t},sm=s=>s==null?"":""+s,px=(s,e,t)=>{s.forEach(i=>{e[i]&&(t[i]=e[i])})},gx=/###/g,rm=s=>s&&s.indexOf("###")>-1?s.replace(gx,"."):s,nm=s=>!s||typeof s=="string",oo=(s,e,t)=>{const i=typeof e!="string"?e:e.split(".");let r=0;for(;r<i.length-1;){if(nm(s))return{};const n=rm(i[r]);!s[n]&&t&&(s[n]=new t),Object.prototype.hasOwnProperty.call(s,n)?s=s[n]:s={},++r}return nm(s)?{}:{obj:s,k:rm(i[r])}},am=(s,e,t)=>{const{obj:i,k:r}=oo(s,e,Object);if(i!==void 0||e.length===1){i[r]=t;return}let n=e[e.length-1],a=e.slice(0,e.length-1),o=oo(s,a,Object);for(;o.obj===void 0&&a.length;)n=`${a[a.length-1]}.${n}`,a=a.slice(0,a.length-1),o=oo(s,a,Object),o&&o.obj&&typeof o.obj[`${o.k}.${n}`]<"u"&&(o.obj=void 0);o.obj[`${o.k}.${n}`]=t},mx=(s,e,t,i)=>{const{obj:r,k:n}=oo(s,e,Object);r[n]=r[n]||[],r[n].push(t)},Ch=(s,e)=>{const{obj:t,k:i}=oo(s,e);if(t)return t[i]},yx=(s,e,t)=>{const i=Ch(s,t);return i!==void 0?i:Ch(e,t)},kw=(s,e,t)=>{for(const i in e)i!=="__proto__"&&i!=="constructor"&&(i in s?typeof s[i]=="string"||s[i]instanceof String||typeof e[i]=="string"||e[i]instanceof String?t&&(s[i]=e[i]):kw(s[i],e[i],t):s[i]=e[i]);return s},Vn=s=>s.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&");var wx={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};const bx=s=>typeof s=="string"?s.replace(/[&<>"'\/]/g,e=>wx[e]):s;class Sx{constructor(e){this.capacity=e,this.regExpMap=new Map,this.regExpQueue=[]}getRegExp(e){const t=this.regExpMap.get(e);if(t!==void 0)return t;const i=new RegExp(e);return this.regExpQueue.length===this.capacity&&this.regExpMap.delete(this.regExpQueue.shift()),this.regExpMap.set(e,i),this.regExpQueue.push(e),i}}const kx=[" ",",","?","!",";"],_x=new Sx(20),Bx=(s,e,t)=>{e=e||"",t=t||"";const i=kx.filter(a=>e.indexOf(a)<0&&t.indexOf(a)<0);if(i.length===0)return!0;const r=_x.getRegExp(`(${i.map(a=>a==="?"?"\\?":a).join("|")})`);let n=!r.test(s);if(!n){const a=s.indexOf(t);a>0&&!r.test(s.substring(0,a))&&(n=!0)}return n},Nd=function(s,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:".";if(!s)return;if(s[e])return s[e];const i=e.split(t);let r=s;for(let n=0;n<i.length;){if(!r||typeof r!="object")return;let a,o="";for(let l=n;l<i.length;++l)if(l!==n&&(o+=t),o+=i[l],a=r[o],a!==void 0){if(["string","number","boolean"].indexOf(typeof a)>-1&&l<i.length-1)continue;n+=l-n+1;break}r=a}return r},Eh=s=>s&&s.indexOf("_")>0?s.replace("_","-"):s;class om extends _u{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{ns:["translation"],defaultNS:"translation"};super(),this.data=e||{},this.options=t,this.options.keySeparator===void 0&&(this.options.keySeparator="."),this.options.ignoreJSONStructure===void 0&&(this.options.ignoreJSONStructure=!0)}addNamespaces(e){this.options.ns.indexOf(e)<0&&this.options.ns.push(e)}removeNamespaces(e){const t=this.options.ns.indexOf(e);t>-1&&this.options.ns.splice(t,1)}getResource(e,t,i){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};const n=r.keySeparator!==void 0?r.keySeparator:this.options.keySeparator,a=r.ignoreJSONStructure!==void 0?r.ignoreJSONStructure:this.options.ignoreJSONStructure;let o;e.indexOf(".")>-1?o=e.split("."):(o=[e,t],i&&(Array.isArray(i)?o.push(...i):typeof i=="string"&&n?o.push(...i.split(n)):o.push(i)));const l=Ch(this.data,o);return!l&&!t&&!i&&e.indexOf(".")>-1&&(e=o[0],t=o[1],i=o.slice(2).join(".")),l||!a||typeof i!="string"?l:Nd(this.data&&this.data[e]&&this.data[e][t],i,n)}addResource(e,t,i,r){let n=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{silent:!1};const a=n.keySeparator!==void 0?n.keySeparator:this.options.keySeparator;let o=[e,t];i&&(o=o.concat(a?i.split(a):i)),e.indexOf(".")>-1&&(o=e.split("."),r=t,t=o[1]),this.addNamespaces(t),am(this.data,o,r),n.silent||this.emit("added",e,t,i,r)}addResources(e,t,i){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{silent:!1};for(const n in i)(typeof i[n]=="string"||Array.isArray(i[n]))&&this.addResource(e,t,n,i[n],{silent:!0});r.silent||this.emit("added",e,t,i)}addResourceBundle(e,t,i,r,n){let a=arguments.length>5&&arguments[5]!==void 0?arguments[5]:{silent:!1,skipCopy:!1},o=[e,t];e.indexOf(".")>-1&&(o=e.split("."),r=i,i=t,t=o[1]),this.addNamespaces(t);let l=Ch(this.data,o)||{};a.skipCopy||(i=JSON.parse(JSON.stringify(i))),r?kw(l,i,n):l={...l,...i},am(this.data,o,l),a.silent||this.emit("added",e,t,i)}removeResourceBundle(e,t){this.hasResourceBundle(e,t)&&delete this.data[e][t],this.removeNamespaces(t),this.emit("removed",e,t)}hasResourceBundle(e,t){return this.getResource(e,t)!==void 0}getResourceBundle(e,t){return t||(t=this.options.defaultNS),this.options.compatibilityAPI==="v1"?{...this.getResource(e,t)}:this.getResource(e,t)}getDataByLanguage(e){return this.data[e]}hasLanguageSomeTranslations(e){const t=this.getDataByLanguage(e);return!!(t&&Object.keys(t)||[]).find(r=>t[r]&&Object.keys(t[r]).length>0)}toJSON(){return this.data}}var _w={processors:{},addPostProcessor(s){this.processors[s.name]=s},handle(s,e,t,i,r){return s.forEach(n=>{this.processors[n]&&(e=this.processors[n].process(e,t,i,r))}),e}};const lm={};class Lh extends _u{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),px(["resourceStore","languageUtils","pluralResolver","interpolator","backendConnector","i18nFormat","utils"],e,this),this.options=t,this.options.keySeparator===void 0&&(this.options.keySeparator="."),this.logger=Gs.create("translator")}changeLanguage(e){e&&(this.language=e)}exists(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{interpolation:{}};if(e==null)return!1;const i=this.resolve(e,t);return i&&i.res!==void 0}extractFromKey(e,t){let i=t.nsSeparator!==void 0?t.nsSeparator:this.options.nsSeparator;i===void 0&&(i=":");const r=t.keySeparator!==void 0?t.keySeparator:this.options.keySeparator;let n=t.ns||this.options.defaultNS||[];const a=i&&e.indexOf(i)>-1,o=!this.options.userDefinedKeySeparator&&!t.keySeparator&&!this.options.userDefinedNsSeparator&&!t.nsSeparator&&!Bx(e,i,r);if(a&&!o){const l=e.match(this.interpolator.nestingRegexp);if(l&&l.length>0)return{key:e,namespaces:n};const h=e.split(i);(i!==r||i===r&&this.options.ns.indexOf(h[0])>-1)&&(n=h.shift()),e=h.join(r)}return typeof n=="string"&&(n=[n]),{key:e,namespaces:n}}translate(e,t,i){if(typeof t!="object"&&this.options.overloadTranslationOptionHandler&&(t=this.options.overloadTranslationOptionHandler(arguments)),typeof t=="object"&&(t={...t}),t||(t={}),e==null)return"";Array.isArray(e)||(e=[String(e)]);const r=t.returnDetails!==void 0?t.returnDetails:this.options.returnDetails,n=t.keySeparator!==void 0?t.keySeparator:this.options.keySeparator,{key:a,namespaces:o}=this.extractFromKey(e[e.length-1],t),l=o[o.length-1],h=t.lng||this.language,u=t.appendNamespaceToCIMode||this.options.appendNamespaceToCIMode;if(h&&h.toLowerCase()==="cimode"){if(u){const B=t.nsSeparator||this.options.nsSeparator;return r?{res:`${l}${B}${a}`,usedKey:a,exactUsedKey:a,usedLng:h,usedNS:l,usedParams:this.getUsedParamsDetails(t)}:`${l}${B}${a}`}return r?{res:a,usedKey:a,exactUsedKey:a,usedLng:h,usedNS:l,usedParams:this.getUsedParamsDetails(t)}:a}const c=this.resolve(e,t);let d=c&&c.res;const p=c&&c.usedKey||a,g=c&&c.exactUsedKey||a,w=Object.prototype.toString.apply(d),S=["[object Number]","[object Function]","[object RegExp]"],b=t.joinArrays!==void 0?t.joinArrays:this.options.joinArrays,m=!this.i18nFormat||this.i18nFormat.handleAsObject;if(m&&d&&(typeof d!="string"&&typeof d!="boolean"&&typeof d!="number")&&S.indexOf(w)<0&&!(typeof b=="string"&&Array.isArray(d))){if(!t.returnObjects&&!this.options.returnObjects){this.options.returnedObjectHandler||this.logger.warn("accessing an object - but returnObjects options is not enabled!");const B=this.options.returnedObjectHandler?this.options.returnedObjectHandler(p,d,{...t,ns:o}):`key '${a} (${this.language})' returned an object instead of string.`;return r?(c.res=B,c.usedParams=this.getUsedParamsDetails(t),c):B}if(n){const B=Array.isArray(d),_=B?[]:{},P=B?g:p;for(const N in d)if(Object.prototype.hasOwnProperty.call(d,N)){const D=`${P}${n}${N}`;_[N]=this.translate(D,{...t,joinArrays:!1,ns:o}),_[N]===D&&(_[N]=d[N])}d=_}}else if(m&&typeof b=="string"&&Array.isArray(d))d=d.join(b),d&&(d=this.extendTranslation(d,e,t,i));else{let B=!1,_=!1;const P=t.count!==void 0&&typeof t.count!="string",N=Lh.hasDefaultValue(t),D=P?this.pluralResolver.getSuffix(h,t.count,t):"",Q=t.ordinal&&P?this.pluralResolver.getSuffix(h,t.count,{ordinal:!1}):"",J=P&&!t.ordinal&&t.count===0&&this.pluralResolver.shouldUseIntlApi(),ge=J&&t[`defaultValue${this.options.pluralSeparator}zero`]||t[`defaultValue${D}`]||t[`defaultValue${Q}`]||t.defaultValue;!this.isValidLookup(d)&&N&&(B=!0,d=ge),this.isValidLookup(d)||(_=!0,d=a);const Ti=(t.missingKeyNoValueFallbackToKey||this.options.missingKeyNoValueFallbackToKey)&&_?void 0:d,Kt=N&&ge!==d&&this.options.updateMissing;if(_||B||Kt){if(this.logger.log(Kt?"updateKey":"missingKey",h,l,a,Kt?ge:d),n){const W=this.resolve(a,{...t,keySeparator:!1});W&&W.res&&this.logger.warn("Seems the loaded translations were in flat JSON format instead of nested. Either set keySeparator: false on init or make sure your translations are published in nested format.")}let gi=[];const oi=this.languageUtils.getFallbackCodes(this.options.fallbackLng,t.lng||this.language);if(this.options.saveMissingTo==="fallback"&&oi&&oi[0])for(let W=0;W<oi.length;W++)gi.push(oi[W]);else this.options.saveMissingTo==="all"?gi=this.languageUtils.toResolveHierarchy(t.lng||this.language):gi.push(t.lng||this.language);const mi=(W,se,pe)=>{const Me=N&&pe!==d?pe:Ti;this.options.missingKeyHandler?this.options.missingKeyHandler(W,l,se,Me,Kt,t):this.backendConnector&&this.backendConnector.saveMissing&&this.backendConnector.saveMissing(W,l,se,Me,Kt,t),this.emit("missingKey",W,l,se,d)};this.options.saveMissing&&(this.options.saveMissingPlurals&&P?gi.forEach(W=>{const se=this.pluralResolver.getSuffixes(W,t);J&&t[`defaultValue${this.options.pluralSeparator}zero`]&&se.indexOf(`${this.options.pluralSeparator}zero`)<0&&se.push(`${this.options.pluralSeparator}zero`),se.forEach(pe=>{mi([W],a+pe,t[`defaultValue${pe}`]||ge)})}):mi(gi,a,ge))}d=this.extendTranslation(d,e,t,c,i),_&&d===a&&this.options.appendNamespaceToMissingKey&&(d=`${l}:${a}`),(_||B)&&this.options.parseMissingKeyHandler&&(this.options.compatibilityAPI!=="v1"?d=this.options.parseMissingKeyHandler(this.options.appendNamespaceToMissingKey?`${l}:${a}`:a,B?d:void 0):d=this.options.parseMissingKeyHandler(d))}return r?(c.res=d,c.usedParams=this.getUsedParamsDetails(t),c):d}extendTranslation(e,t,i,r,n){var a=this;if(this.i18nFormat&&this.i18nFormat.parse)e=this.i18nFormat.parse(e,{...this.options.interpolation.defaultVariables,...i},i.lng||this.language||r.usedLng,r.usedNS,r.usedKey,{resolved:r});else if(!i.skipInterpolation){i.interpolation&&this.interpolator.init({...i,interpolation:{...this.options.interpolation,...i.interpolation}});const h=typeof e=="string"&&(i&&i.interpolation&&i.interpolation.skipOnVariables!==void 0?i.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables);let u;if(h){const d=e.match(this.interpolator.nestingRegexp);u=d&&d.length}let c=i.replace&&typeof i.replace!="string"?i.replace:i;if(this.options.interpolation.defaultVariables&&(c={...this.options.interpolation.defaultVariables,...c}),e=this.interpolator.interpolate(e,c,i.lng||this.language||r.usedLng,i),h){const d=e.match(this.interpolator.nestingRegexp),p=d&&d.length;u<p&&(i.nest=!1)}!i.lng&&this.options.compatibilityAPI!=="v1"&&r&&r.res&&(i.lng=this.language||r.usedLng),i.nest!==!1&&(e=this.interpolator.nest(e,function(){for(var d=arguments.length,p=new Array(d),g=0;g<d;g++)p[g]=arguments[g];return n&&n[0]===p[0]&&!i.context?(a.logger.warn(`It seems you are nesting recursively key: ${p[0]} in key: ${t[0]}`),null):a.translate(...p,t)},i)),i.interpolation&&this.interpolator.reset()}const o=i.postProcess||this.options.postProcess,l=typeof o=="string"?[o]:o;return e!=null&&l&&l.length&&i.applyPostProcessor!==!1&&(e=_w.handle(l,e,t,this.options&&this.options.postProcessPassResolved?{i18nResolved:{...r,usedParams:this.getUsedParamsDetails(i)},...i}:i,this)),e}resolve(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i,r,n,a,o;return typeof e=="string"&&(e=[e]),e.forEach(l=>{if(this.isValidLookup(i))return;const h=this.extractFromKey(l,t),u=h.key;r=u;let c=h.namespaces;this.options.fallbackNS&&(c=c.concat(this.options.fallbackNS));const d=t.count!==void 0&&typeof t.count!="string",p=d&&!t.ordinal&&t.count===0&&this.pluralResolver.shouldUseIntlApi(),g=t.context!==void 0&&(typeof t.context=="string"||typeof t.context=="number")&&t.context!=="",w=t.lngs?t.lngs:this.languageUtils.toResolveHierarchy(t.lng||this.language,t.fallbackLng);c.forEach(S=>{this.isValidLookup(i)||(o=S,!lm[`${w[0]}-${S}`]&&this.utils&&this.utils.hasLoadedNamespace&&!this.utils.hasLoadedNamespace(o)&&(lm[`${w[0]}-${S}`]=!0,this.logger.warn(`key "${r}" for languages "${w.join(", ")}" won't get resolved as namespace "${o}" was not yet loaded`,"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!")),w.forEach(b=>{if(this.isValidLookup(i))return;a=b;const m=[u];if(this.i18nFormat&&this.i18nFormat.addLookupKeys)this.i18nFormat.addLookupKeys(m,u,b,S,t);else{let B;d&&(B=this.pluralResolver.getSuffix(b,t.count,t));const _=`${this.options.pluralSeparator}zero`,P=`${this.options.pluralSeparator}ordinal${this.options.pluralSeparator}`;if(d&&(m.push(u+B),t.ordinal&&B.indexOf(P)===0&&m.push(u+B.replace(P,this.options.pluralSeparator)),p&&m.push(u+_)),g){const N=`${u}${this.options.contextSeparator}${t.context}`;m.push(N),d&&(m.push(N+B),t.ordinal&&B.indexOf(P)===0&&m.push(N+B.replace(P,this.options.pluralSeparator)),p&&m.push(N+_))}}let y;for(;y=m.pop();)this.isValidLookup(i)||(n=y,i=this.getResource(b,S,y,t))}))})}),{res:i,usedKey:r,exactUsedKey:n,usedLng:a,usedNS:o}}isValidLookup(e){return e!==void 0&&!(!this.options.returnNull&&e===null)&&!(!this.options.returnEmptyString&&e==="")}getResource(e,t,i){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return this.i18nFormat&&this.i18nFormat.getResource?this.i18nFormat.getResource(e,t,i,r):this.resourceStore.getResource(e,t,i,r)}getUsedParamsDetails(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=["defaultValue","ordinal","context","replace","lng","lngs","fallbackLng","ns","keySeparator","nsSeparator","returnObjects","returnDetails","joinArrays","postProcess","interpolation"],i=e.replace&&typeof e.replace!="string";let r=i?e.replace:e;if(i&&typeof e.count<"u"&&(r.count=e.count),this.options.interpolation.defaultVariables&&(r={...this.options.interpolation.defaultVariables,...r}),!i){r={...r};for(const n of t)delete r[n]}return r}static hasDefaultValue(e){const t="defaultValue";for(const i in e)if(Object.prototype.hasOwnProperty.call(e,i)&&t===i.substring(0,t.length)&&e[i]!==void 0)return!0;return!1}}const oc=s=>s.charAt(0).toUpperCase()+s.slice(1);class hm{constructor(e){this.options=e,this.supportedLngs=this.options.supportedLngs||!1,this.logger=Gs.create("languageUtils")}getScriptPartFromCode(e){if(e=Eh(e),!e||e.indexOf("-")<0)return null;const t=e.split("-");return t.length===2||(t.pop(),t[t.length-1].toLowerCase()==="x")?null:this.formatLanguageCode(t.join("-"))}getLanguagePartFromCode(e){if(e=Eh(e),!e||e.indexOf("-")<0)return e;const t=e.split("-");return this.formatLanguageCode(t[0])}formatLanguageCode(e){if(typeof e=="string"&&e.indexOf("-")>-1){const t=["hans","hant","latn","cyrl","cans","mong","arab"];let i=e.split("-");return this.options.lowerCaseLng?i=i.map(r=>r.toLowerCase()):i.length===2?(i[0]=i[0].toLowerCase(),i[1]=i[1].toUpperCase(),t.indexOf(i[1].toLowerCase())>-1&&(i[1]=oc(i[1].toLowerCase()))):i.length===3&&(i[0]=i[0].toLowerCase(),i[1].length===2&&(i[1]=i[1].toUpperCase()),i[0]!=="sgn"&&i[2].length===2&&(i[2]=i[2].toUpperCase()),t.indexOf(i[1].toLowerCase())>-1&&(i[1]=oc(i[1].toLowerCase())),t.indexOf(i[2].toLowerCase())>-1&&(i[2]=oc(i[2].toLowerCase()))),i.join("-")}return this.options.cleanCode||this.options.lowerCaseLng?e.toLowerCase():e}isSupportedCode(e){return(this.options.load==="languageOnly"||this.options.nonExplicitSupportedLngs)&&(e=this.getLanguagePartFromCode(e)),!this.supportedLngs||!this.supportedLngs.length||this.supportedLngs.indexOf(e)>-1}getBestMatchFromCodes(e){if(!e)return null;let t;return e.forEach(i=>{if(t)return;const r=this.formatLanguageCode(i);(!this.options.supportedLngs||this.isSupportedCode(r))&&(t=r)}),!t&&this.options.supportedLngs&&e.forEach(i=>{if(t)return;const r=this.getLanguagePartFromCode(i);if(this.isSupportedCode(r))return t=r;t=this.options.supportedLngs.find(n=>{if(n===r)return n;if(!(n.indexOf("-")<0&&r.indexOf("-")<0)&&(n.indexOf("-")>0&&r.indexOf("-")<0&&n.substring(0,n.indexOf("-"))===r||n.indexOf(r)===0&&r.length>1))return n})}),t||(t=this.getFallbackCodes(this.options.fallbackLng)[0]),t}getFallbackCodes(e,t){if(!e)return[];if(typeof e=="function"&&(e=e(t)),typeof e=="string"&&(e=[e]),Array.isArray(e))return e;if(!t)return e.default||[];let i=e[t];return i||(i=e[this.getScriptPartFromCode(t)]),i||(i=e[this.formatLanguageCode(t)]),i||(i=e[this.getLanguagePartFromCode(t)]),i||(i=e.default),i||[]}toResolveHierarchy(e,t){const i=this.getFallbackCodes(t||this.options.fallbackLng||[],e),r=[],n=a=>{a&&(this.isSupportedCode(a)?r.push(a):this.logger.warn(`rejecting language code not found in supportedLngs: ${a}`))};return typeof e=="string"&&(e.indexOf("-")>-1||e.indexOf("_")>-1)?(this.options.load!=="languageOnly"&&n(this.formatLanguageCode(e)),this.options.load!=="languageOnly"&&this.options.load!=="currentOnly"&&n(this.getScriptPartFromCode(e)),this.options.load!=="currentOnly"&&n(this.getLanguagePartFromCode(e))):typeof e=="string"&&n(this.formatLanguageCode(e)),i.forEach(a=>{r.indexOf(a)<0&&n(this.formatLanguageCode(a))}),r}}let xx=[{lngs:["ach","ak","am","arn","br","fil","gun","ln","mfe","mg","mi","oc","pt","pt-BR","tg","tl","ti","tr","uz","wa"],nr:[1,2],fc:1},{lngs:["af","an","ast","az","bg","bn","ca","da","de","dev","el","en","eo","es","et","eu","fi","fo","fur","fy","gl","gu","ha","hi","hu","hy","ia","it","kk","kn","ku","lb","mai","ml","mn","mr","nah","nap","nb","ne","nl","nn","no","nso","pa","pap","pms","ps","pt-PT","rm","sco","se","si","so","son","sq","sv","sw","ta","te","tk","ur","yo"],nr:[1,2],fc:2},{lngs:["ay","bo","cgg","fa","ht","id","ja","jbo","ka","km","ko","ky","lo","ms","sah","su","th","tt","ug","vi","wo","zh"],nr:[1],fc:3},{lngs:["be","bs","cnr","dz","hr","ru","sr","uk"],nr:[1,2,5],fc:4},{lngs:["ar"],nr:[0,1,2,3,11,100],fc:5},{lngs:["cs","sk"],nr:[1,2,5],fc:6},{lngs:["csb","pl"],nr:[1,2,5],fc:7},{lngs:["cy"],nr:[1,2,3,8],fc:8},{lngs:["fr"],nr:[1,2],fc:9},{lngs:["ga"],nr:[1,2,3,7,11],fc:10},{lngs:["gd"],nr:[1,2,3,20],fc:11},{lngs:["is"],nr:[1,2],fc:12},{lngs:["jv"],nr:[0,1],fc:13},{lngs:["kw"],nr:[1,2,3,4],fc:14},{lngs:["lt"],nr:[1,2,10],fc:15},{lngs:["lv"],nr:[1,2,0],fc:16},{lngs:["mk"],nr:[1,2],fc:17},{lngs:["mnk"],nr:[0,1,2],fc:18},{lngs:["mt"],nr:[1,2,11,20],fc:19},{lngs:["or"],nr:[2,1],fc:2},{lngs:["ro"],nr:[1,2,20],fc:20},{lngs:["sl"],nr:[5,1,2,3],fc:21},{lngs:["he","iw"],nr:[1,2,20,21],fc:22}],vx={1:s=>+(s>1),2:s=>+(s!=1),3:s=>0,4:s=>s%10==1&&s%100!=11?0:s%10>=2&&s%10<=4&&(s%100<10||s%100>=20)?1:2,5:s=>s==0?0:s==1?1:s==2?2:s%100>=3&&s%100<=10?3:s%100>=11?4:5,6:s=>s==1?0:s>=2&&s<=4?1:2,7:s=>s==1?0:s%10>=2&&s%10<=4&&(s%100<10||s%100>=20)?1:2,8:s=>s==1?0:s==2?1:s!=8&&s!=11?2:3,9:s=>+(s>=2),10:s=>s==1?0:s==2?1:s<7?2:s<11?3:4,11:s=>s==1||s==11?0:s==2||s==12?1:s>2&&s<20?2:3,12:s=>+(s%10!=1||s%100==11),13:s=>+(s!==0),14:s=>s==1?0:s==2?1:s==3?2:3,15:s=>s%10==1&&s%100!=11?0:s%10>=2&&(s%100<10||s%100>=20)?1:2,16:s=>s%10==1&&s%100!=11?0:s!==0?1:2,17:s=>s==1||s%10==1&&s%100!=11?0:1,18:s=>s==0?0:s==1?1:2,19:s=>s==1?0:s==0||s%100>1&&s%100<11?1:s%100>10&&s%100<20?2:3,20:s=>s==1?0:s==0||s%100>0&&s%100<20?1:2,21:s=>s%100==1?1:s%100==2?2:s%100==3||s%100==4?3:0,22:s=>s==1?0:s==2?1:(s<0||s>10)&&s%10==0?2:3};const Tx=["v1","v2","v3"],Nx=["v4"],um={zero:0,one:1,two:2,few:3,many:4,other:5},Px=()=>{const s={};return xx.forEach(e=>{e.lngs.forEach(t=>{s[t]={numbers:e.nr,plurals:vx[e.fc]}})}),s};class Cx{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.languageUtils=e,this.options=t,this.logger=Gs.create("pluralResolver"),(!this.options.compatibilityJSON||Nx.includes(this.options.compatibilityJSON))&&(typeof Intl>"u"||!Intl.PluralRules)&&(this.options.compatibilityJSON="v3",this.logger.error("Your environment seems not to be Intl API compatible, use an Intl.PluralRules polyfill. Will fallback to the compatibilityJSON v3 format handling.")),this.rules=Px(),this.pluralRulesCache={}}addRule(e,t){this.rules[e]=t}clearCache(){this.pluralRulesCache={}}getRule(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(this.shouldUseIntlApi())try{const i=Eh(e==="dev"?"en":e),r=t.ordinal?"ordinal":"cardinal",n=JSON.stringify({cleanedCode:i,type:r});if(n in this.pluralRulesCache)return this.pluralRulesCache[n];const a=new Intl.PluralRules(i,{type:r});return this.pluralRulesCache[n]=a,a}catch{return}return this.rules[e]||this.rules[this.languageUtils.getLanguagePartFromCode(e)]}needsPlural(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const i=this.getRule(e,t);return this.shouldUseIntlApi()?i&&i.resolvedOptions().pluralCategories.length>1:i&&i.numbers.length>1}getPluralFormsOfKey(e,t){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this.getSuffixes(e,i).map(r=>`${t}${r}`)}getSuffixes(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const i=this.getRule(e,t);return i?this.shouldUseIntlApi()?i.resolvedOptions().pluralCategories.sort((r,n)=>um[r]-um[n]).map(r=>`${this.options.prepend}${t.ordinal?`ordinal${this.options.prepend}`:""}${r}`):i.numbers.map(r=>this.getSuffix(e,r,t)):[]}getSuffix(e,t){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const r=this.getRule(e,i);return r?this.shouldUseIntlApi()?`${this.options.prepend}${i.ordinal?`ordinal${this.options.prepend}`:""}${r.select(t)}`:this.getSuffixRetroCompatible(r,t):(this.logger.warn(`no plural rule found for: ${e}`),"")}getSuffixRetroCompatible(e,t){const i=e.noAbs?e.plurals(t):e.plurals(Math.abs(t));let r=e.numbers[i];this.options.simplifyPluralSuffix&&e.numbers.length===2&&e.numbers[0]===1&&(r===2?r="plural":r===1&&(r=""));const n=()=>this.options.prepend&&r.toString()?this.options.prepend+r.toString():r.toString();return this.options.compatibilityJSON==="v1"?r===1?"":typeof r=="number"?`_plural_${r.toString()}`:n():this.options.compatibilityJSON==="v2"||this.options.simplifyPluralSuffix&&e.numbers.length===2&&e.numbers[0]===1?n():this.options.prepend&&i.toString()?this.options.prepend+i.toString():i.toString()}shouldUseIntlApi(){return!Tx.includes(this.options.compatibilityJSON)}}const cm=function(s,e,t){let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:".",r=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!0,n=yx(s,e,t);return!n&&r&&typeof t=="string"&&(n=Nd(s,t,i),n===void 0&&(n=Nd(e,t,i))),n},lc=s=>s.replace(/\$/g,"$$$$");class Ex{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.logger=Gs.create("interpolator"),this.options=e,this.format=e.interpolation&&e.interpolation.format||(t=>t),this.init(e)}init(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};e.interpolation||(e.interpolation={escapeValue:!0});const{escape:t,escapeValue:i,useRawValueToEscape:r,prefix:n,prefixEscaped:a,suffix:o,suffixEscaped:l,formatSeparator:h,unescapeSuffix:u,unescapePrefix:c,nestingPrefix:d,nestingPrefixEscaped:p,nestingSuffix:g,nestingSuffixEscaped:w,nestingOptionsSeparator:S,maxReplaces:b,alwaysFormat:m}=e.interpolation;this.escape=t!==void 0?t:bx,this.escapeValue=i!==void 0?i:!0,this.useRawValueToEscape=r!==void 0?r:!1,this.prefix=n?Vn(n):a||"{{",this.suffix=o?Vn(o):l||"}}",this.formatSeparator=h||",",this.unescapePrefix=u?"":c||"-",this.unescapeSuffix=this.unescapePrefix?"":u||"",this.nestingPrefix=d?Vn(d):p||Vn("$t("),this.nestingSuffix=g?Vn(g):w||Vn(")"),this.nestingOptionsSeparator=S||",",this.maxReplaces=b||1e3,this.alwaysFormat=m!==void 0?m:!1,this.resetRegExp()}reset(){this.options&&this.init(this.options)}resetRegExp(){const e=(t,i)=>t&&t.source===i?(t.lastIndex=0,t):new RegExp(i,"g");this.regexp=e(this.regexp,`${this.prefix}(.+?)${this.suffix}`),this.regexpUnescape=e(this.regexpUnescape,`${this.prefix}${this.unescapePrefix}(.+?)${this.unescapeSuffix}${this.suffix}`),this.nestingRegexp=e(this.nestingRegexp,`${this.nestingPrefix}(.+?)${this.nestingSuffix}`)}interpolate(e,t,i,r){let n,a,o;const l=this.options&&this.options.interpolation&&this.options.interpolation.defaultVariables||{},h=p=>{if(p.indexOf(this.formatSeparator)<0){const b=cm(t,l,p,this.options.keySeparator,this.options.ignoreJSONStructure);return this.alwaysFormat?this.format(b,void 0,i,{...r,...t,interpolationkey:p}):b}const g=p.split(this.formatSeparator),w=g.shift().trim(),S=g.join(this.formatSeparator).trim();return this.format(cm(t,l,w,this.options.keySeparator,this.options.ignoreJSONStructure),S,i,{...r,...t,interpolationkey:w})};this.resetRegExp();const u=r&&r.missingInterpolationHandler||this.options.missingInterpolationHandler,c=r&&r.interpolation&&r.interpolation.skipOnVariables!==void 0?r.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables;return[{regex:this.regexpUnescape,safeValue:p=>lc(p)},{regex:this.regexp,safeValue:p=>this.escapeValue?lc(this.escape(p)):lc(p)}].forEach(p=>{for(o=0;n=p.regex.exec(e);){const g=n[1].trim();if(a=h(g),a===void 0)if(typeof u=="function"){const S=u(e,n,r);a=typeof S=="string"?S:""}else if(r&&Object.prototype.hasOwnProperty.call(r,g))a="";else if(c){a=n[0];continue}else this.logger.warn(`missed to pass in variable ${g} for interpolating ${e}`),a="";else typeof a!="string"&&!this.useRawValueToEscape&&(a=sm(a));const w=p.safeValue(a);if(e=e.replace(n[0],w),c?(p.regex.lastIndex+=a.length,p.regex.lastIndex-=n[0].length):p.regex.lastIndex=0,o++,o>=this.maxReplaces)break}}),e}nest(e,t){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},r,n,a;const o=(l,h)=>{const u=this.nestingOptionsSeparator;if(l.indexOf(u)<0)return l;const c=l.split(new RegExp(`${u}[ ]*{`));let d=`{${c[1]}`;l=c[0],d=this.interpolate(d,a);const p=d.match(/'/g),g=d.match(/"/g);(p&&p.length%2===0&&!g||g.length%2!==0)&&(d=d.replace(/'/g,'"'));try{a=JSON.parse(d),h&&(a={...h,...a})}catch(w){return this.logger.warn(`failed parsing options string in nesting for key ${l}`,w),`${l}${u}${d}`}return a.defaultValue&&a.defaultValue.indexOf(this.prefix)>-1&&delete a.defaultValue,l};for(;r=this.nestingRegexp.exec(e);){let l=[];a={...i},a=a.replace&&typeof a.replace!="string"?a.replace:a,a.applyPostProcessor=!1,delete a.defaultValue;let h=!1;if(r[0].indexOf(this.formatSeparator)!==-1&&!/{.*}/.test(r[1])){const u=r[1].split(this.formatSeparator).map(c=>c.trim());r[1]=u.shift(),l=u,h=!0}if(n=t(o.call(this,r[1].trim(),a),a),n&&r[0]===e&&typeof n!="string")return n;typeof n!="string"&&(n=sm(n)),n||(this.logger.warn(`missed to resolve ${r[1]} for nesting ${e}`),n=""),h&&(n=l.reduce((u,c)=>this.format(u,c,i.lng,{...i,interpolationkey:r[1].trim()}),n.trim())),e=e.replace(r[0],n),this.regexp.lastIndex=0}return e}}const Lx=s=>{let e=s.toLowerCase().trim();const t={};if(s.indexOf("(")>-1){const i=s.split("(");e=i[0].toLowerCase().trim();const r=i[1].substring(0,i[1].length-1);e==="currency"&&r.indexOf(":")<0?t.currency||(t.currency=r.trim()):e==="relativetime"&&r.indexOf(":")<0?t.range||(t.range=r.trim()):r.split(";").forEach(a=>{if(a){const[o,...l]=a.split(":"),h=l.join(":").trim().replace(/^'+|'+$/g,""),u=o.trim();t[u]||(t[u]=h),h==="false"&&(t[u]=!1),h==="true"&&(t[u]=!0),isNaN(h)||(t[u]=parseInt(h,10))}})}return{formatName:e,formatOptions:t}},Hn=s=>{const e={};return(t,i,r)=>{let n=r;r&&r.interpolationkey&&r.formatParams&&r.formatParams[r.interpolationkey]&&r[r.interpolationkey]&&(n={...n,[r.interpolationkey]:void 0});const a=i+JSON.stringify(n);let o=e[a];return o||(o=s(Eh(i),r),e[a]=o),o(t)}};class Mx{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.logger=Gs.create("formatter"),this.options=e,this.formats={number:Hn((t,i)=>{const r=new Intl.NumberFormat(t,{...i});return n=>r.format(n)}),currency:Hn((t,i)=>{const r=new Intl.NumberFormat(t,{...i,style:"currency"});return n=>r.format(n)}),datetime:Hn((t,i)=>{const r=new Intl.DateTimeFormat(t,{...i});return n=>r.format(n)}),relativetime:Hn((t,i)=>{const r=new Intl.RelativeTimeFormat(t,{...i});return n=>r.format(n,i.range||"day")}),list:Hn((t,i)=>{const r=new Intl.ListFormat(t,{...i});return n=>r.format(n)})},this.init(e)}init(e){const i=(arguments.length>1&&arguments[1]!==void 0?arguments[1]:{interpolation:{}}).interpolation;this.formatSeparator=i.formatSeparator?i.formatSeparator:i.formatSeparator||","}add(e,t){this.formats[e.toLowerCase().trim()]=t}addCached(e,t){this.formats[e.toLowerCase().trim()]=Hn(t)}format(e,t,i){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};const n=t.split(this.formatSeparator);if(n.length>1&&n[0].indexOf("(")>1&&n[0].indexOf(")")<0&&n.find(o=>o.indexOf(")")>-1)){const o=n.findIndex(l=>l.indexOf(")")>-1);n[0]=[n[0],...n.splice(1,o)].join(this.formatSeparator)}return n.reduce((o,l)=>{const{formatName:h,formatOptions:u}=Lx(l);if(this.formats[h]){let c=o;try{const d=r&&r.formatParams&&r.formatParams[r.interpolationkey]||{},p=d.locale||d.lng||r.locale||r.lng||i;c=this.formats[h](o,p,{...u,...r,...d})}catch(d){this.logger.warn(d)}return c}else this.logger.warn(`there was no format function for ${h}`);return o},e)}}const Fx=(s,e)=>{s.pending[e]!==void 0&&(delete s.pending[e],s.pendingCount--)};class Rx extends _u{constructor(e,t,i){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};super(),this.backend=e,this.store=t,this.services=i,this.languageUtils=i.languageUtils,this.options=r,this.logger=Gs.create("backendConnector"),this.waitingReads=[],this.maxParallelReads=r.maxParallelReads||10,this.readingCalls=0,this.maxRetries=r.maxRetries>=0?r.maxRetries:5,this.retryTimeout=r.retryTimeout>=1?r.retryTimeout:350,this.state={},this.queue=[],this.backend&&this.backend.init&&this.backend.init(i,r.backend,r)}queueLoad(e,t,i,r){const n={},a={},o={},l={};return e.forEach(h=>{let u=!0;t.forEach(c=>{const d=`${h}|${c}`;!i.reload&&this.store.hasResourceBundle(h,c)?this.state[d]=2:this.state[d]<0||(this.state[d]===1?a[d]===void 0&&(a[d]=!0):(this.state[d]=1,u=!1,a[d]===void 0&&(a[d]=!0),n[d]===void 0&&(n[d]=!0),l[c]===void 0&&(l[c]=!0)))}),u||(o[h]=!0)}),(Object.keys(n).length||Object.keys(a).length)&&this.queue.push({pending:a,pendingCount:Object.keys(a).length,loaded:{},errors:[],callback:r}),{toLoad:Object.keys(n),pending:Object.keys(a),toLoadLanguages:Object.keys(o),toLoadNamespaces:Object.keys(l)}}loaded(e,t,i){const r=e.split("|"),n=r[0],a=r[1];t&&this.emit("failedLoading",n,a,t),!t&&i&&this.store.addResourceBundle(n,a,i,void 0,void 0,{skipCopy:!0}),this.state[e]=t?-1:2,t&&i&&(this.state[e]=0);const o={};this.queue.forEach(l=>{mx(l.loaded,[n],a),Fx(l,e),t&&l.errors.push(t),l.pendingCount===0&&!l.done&&(Object.keys(l.loaded).forEach(h=>{o[h]||(o[h]={});const u=l.loaded[h];u.length&&u.forEach(c=>{o[h][c]===void 0&&(o[h][c]=!0)})}),l.done=!0,l.errors.length?l.callback(l.errors):l.callback())}),this.emit("loaded",o),this.queue=this.queue.filter(l=>!l.done)}read(e,t,i){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0,n=arguments.length>4&&arguments[4]!==void 0?arguments[4]:this.retryTimeout,a=arguments.length>5?arguments[5]:void 0;if(!e.length)return a(null,{});if(this.readingCalls>=this.maxParallelReads){this.waitingReads.push({lng:e,ns:t,fcName:i,tried:r,wait:n,callback:a});return}this.readingCalls++;const o=(h,u)=>{if(this.readingCalls--,this.waitingReads.length>0){const c=this.waitingReads.shift();this.read(c.lng,c.ns,c.fcName,c.tried,c.wait,c.callback)}if(h&&u&&r<this.maxRetries){setTimeout(()=>{this.read.call(this,e,t,i,r+1,n*2,a)},n);return}a(h,u)},l=this.backend[i].bind(this.backend);if(l.length===2){try{const h=l(e,t);h&&typeof h.then=="function"?h.then(u=>o(null,u)).catch(o):o(null,h)}catch(h){o(h)}return}return l(e,t,o)}prepareLoading(e,t){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},r=arguments.length>3?arguments[3]:void 0;if(!this.backend)return this.logger.warn("No backend was added via i18next.use. Will not load resources."),r&&r();typeof e=="string"&&(e=this.languageUtils.toResolveHierarchy(e)),typeof t=="string"&&(t=[t]);const n=this.queueLoad(e,t,i,r);if(!n.toLoad.length)return n.pending.length||r(),null;n.toLoad.forEach(a=>{this.loadOne(a)})}load(e,t,i){this.prepareLoading(e,t,{},i)}reload(e,t,i){this.prepareLoading(e,t,{reload:!0},i)}loadOne(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";const i=e.split("|"),r=i[0],n=i[1];this.read(r,n,"read",void 0,void 0,(a,o)=>{a&&this.logger.warn(`${t}loading namespace ${n} for language ${r} failed`,a),!a&&o&&this.logger.log(`${t}loaded namespace ${n} for language ${r}`,o),this.loaded(e,a,o)})}saveMissing(e,t,i,r,n){let a=arguments.length>5&&arguments[5]!==void 0?arguments[5]:{},o=arguments.length>6&&arguments[6]!==void 0?arguments[6]:()=>{};if(this.services.utils&&this.services.utils.hasLoadedNamespace&&!this.services.utils.hasLoadedNamespace(t)){this.logger.warn(`did not save key "${i}" as the namespace "${t}" was not yet loaded`,"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!");return}if(!(i==null||i==="")){if(this.backend&&this.backend.create){const l={...a,isUpdate:n},h=this.backend.create.bind(this.backend);if(h.length<6)try{let u;h.length===5?u=h(e,t,i,r,l):u=h(e,t,i,r),u&&typeof u.then=="function"?u.then(c=>o(null,c)).catch(o):o(null,u)}catch(u){o(u)}else h(e,t,i,r,o,l)}!e||!e[0]||this.store.addResource(e[0],t,i,r)}}}const dm=()=>({debug:!1,initImmediate:!0,ns:["translation"],defaultNS:["translation"],fallbackLng:["dev"],fallbackNS:!1,supportedLngs:!1,nonExplicitSupportedLngs:!1,load:"all",preload:!1,simplifyPluralSuffix:!0,keySeparator:".",nsSeparator:":",pluralSeparator:"_",contextSeparator:"_",partialBundledLanguages:!1,saveMissing:!1,updateMissing:!1,saveMissingTo:"fallback",saveMissingPlurals:!0,missingKeyHandler:!1,missingInterpolationHandler:!1,postProcess:!1,postProcessPassResolved:!1,returnNull:!1,returnEmptyString:!0,returnObjects:!1,joinArrays:!1,returnedObjectHandler:!1,parseMissingKeyHandler:!1,appendNamespaceToMissingKey:!1,appendNamespaceToCIMode:!1,overloadTranslationOptionHandler:s=>{let e={};if(typeof s[1]=="object"&&(e=s[1]),typeof s[1]=="string"&&(e.defaultValue=s[1]),typeof s[2]=="string"&&(e.tDescription=s[2]),typeof s[2]=="object"||typeof s[3]=="object"){const t=s[3]||s[2];Object.keys(t).forEach(i=>{e[i]=t[i]})}return e},interpolation:{escapeValue:!0,format:s=>s,prefix:"{{",suffix:"}}",formatSeparator:",",unescapePrefix:"-",nestingPrefix:"$t(",nestingSuffix:")",nestingOptionsSeparator:",",maxReplaces:1e3,skipOnVariables:!0}}),fm=s=>(typeof s.ns=="string"&&(s.ns=[s.ns]),typeof s.fallbackLng=="string"&&(s.fallbackLng=[s.fallbackLng]),typeof s.fallbackNS=="string"&&(s.fallbackNS=[s.fallbackNS]),s.supportedLngs&&s.supportedLngs.indexOf("cimode")<0&&(s.supportedLngs=s.supportedLngs.concat(["cimode"])),s),Fl=()=>{},Dx=s=>{Object.getOwnPropertyNames(Object.getPrototypeOf(s)).forEach(t=>{typeof s[t]=="function"&&(s[t]=s[t].bind(s))})};class Ro extends _u{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;if(super(),this.options=fm(e),this.services={},this.logger=Gs,this.modules={external:[]},Dx(this),t&&!this.isInitialized&&!e.isClone){if(!this.options.initImmediate)return this.init(e,t),this;setTimeout(()=>{this.init(e,t)},0)}}init(){var e=this;let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},i=arguments.length>1?arguments[1]:void 0;this.isInitializing=!0,typeof t=="function"&&(i=t,t={}),!t.defaultNS&&t.defaultNS!==!1&&t.ns&&(typeof t.ns=="string"?t.defaultNS=t.ns:t.ns.indexOf("translation")<0&&(t.defaultNS=t.ns[0]));const r=dm();this.options={...r,...this.options,...fm(t)},this.options.compatibilityAPI!=="v1"&&(this.options.interpolation={...r.interpolation,...this.options.interpolation}),t.keySeparator!==void 0&&(this.options.userDefinedKeySeparator=t.keySeparator),t.nsSeparator!==void 0&&(this.options.userDefinedNsSeparator=t.nsSeparator);const n=u=>u?typeof u=="function"?new u:u:null;if(!this.options.isClone){this.modules.logger?Gs.init(n(this.modules.logger),this.options):Gs.init(null,this.options);let u;this.modules.formatter?u=this.modules.formatter:typeof Intl<"u"&&(u=Mx);const c=new hm(this.options);this.store=new om(this.options.resources,this.options);const d=this.services;d.logger=Gs,d.resourceStore=this.store,d.languageUtils=c,d.pluralResolver=new Cx(c,{prepend:this.options.pluralSeparator,compatibilityJSON:this.options.compatibilityJSON,simplifyPluralSuffix:this.options.simplifyPluralSuffix}),u&&(!this.options.interpolation.format||this.options.interpolation.format===r.interpolation.format)&&(d.formatter=n(u),d.formatter.init(d,this.options),this.options.interpolation.format=d.formatter.format.bind(d.formatter)),d.interpolator=new Ex(this.options),d.utils={hasLoadedNamespace:this.hasLoadedNamespace.bind(this)},d.backendConnector=new Rx(n(this.modules.backend),d.resourceStore,d,this.options),d.backendConnector.on("*",function(p){for(var g=arguments.length,w=new Array(g>1?g-1:0),S=1;S<g;S++)w[S-1]=arguments[S];e.emit(p,...w)}),this.modules.languageDetector&&(d.languageDetector=n(this.modules.languageDetector),d.languageDetector.init&&d.languageDetector.init(d,this.options.detection,this.options)),this.modules.i18nFormat&&(d.i18nFormat=n(this.modules.i18nFormat),d.i18nFormat.init&&d.i18nFormat.init(this)),this.translator=new Lh(this.services,this.options),this.translator.on("*",function(p){for(var g=arguments.length,w=new Array(g>1?g-1:0),S=1;S<g;S++)w[S-1]=arguments[S];e.emit(p,...w)}),this.modules.external.forEach(p=>{p.init&&p.init(this)})}if(this.format=this.options.interpolation.format,i||(i=Fl),this.options.fallbackLng&&!this.services.languageDetector&&!this.options.lng){const u=this.services.languageUtils.getFallbackCodes(this.options.fallbackLng);u.length>0&&u[0]!=="dev"&&(this.options.lng=u[0])}!this.services.languageDetector&&!this.options.lng&&this.logger.warn("init: no languageDetector is used and no lng is defined"),["getResource","hasResourceBundle","getResourceBundle","getDataByLanguage"].forEach(u=>{this[u]=function(){return e.store[u](...arguments)}}),["addResource","addResources","addResourceBundle","removeResourceBundle"].forEach(u=>{this[u]=function(){return e.store[u](...arguments),e}});const l=Ga(),h=()=>{const u=(c,d)=>{this.isInitializing=!1,this.isInitialized&&!this.initializedStoreOnce&&this.logger.warn("init: i18next is already initialized. You should call init just once!"),this.isInitialized=!0,this.options.isClone||this.logger.log("initialized",this.options),this.emit("initialized",this.options),l.resolve(d),i(c,d)};if(this.languages&&this.options.compatibilityAPI!=="v1"&&!this.isInitialized)return u(null,this.t.bind(this));this.changeLanguage(this.options.lng,u)};return this.options.resources||!this.options.initImmediate?h():setTimeout(h,0),l}loadResources(e){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Fl;const r=typeof e=="string"?e:this.language;if(typeof e=="function"&&(i=e),!this.options.resources||this.options.partialBundledLanguages){if(r&&r.toLowerCase()==="cimode"&&(!this.options.preload||this.options.preload.length===0))return i();const n=[],a=o=>{if(!o||o==="cimode")return;this.services.languageUtils.toResolveHierarchy(o).forEach(h=>{h!=="cimode"&&n.indexOf(h)<0&&n.push(h)})};r?a(r):this.services.languageUtils.getFallbackCodes(this.options.fallbackLng).forEach(l=>a(l)),this.options.preload&&this.options.preload.forEach(o=>a(o)),this.services.backendConnector.load(n,this.options.ns,o=>{!o&&!this.resolvedLanguage&&this.language&&this.setResolvedLanguage(this.language),i(o)})}else i(null)}reloadResources(e,t,i){const r=Ga();return typeof e=="function"&&(i=e,e=void 0),typeof t=="function"&&(i=t,t=void 0),e||(e=this.languages),t||(t=this.options.ns),i||(i=Fl),this.services.backendConnector.reload(e,t,n=>{r.resolve(),i(n)}),r}use(e){if(!e)throw new Error("You are passing an undefined module! Please check the object you are passing to i18next.use()");if(!e.type)throw new Error("You are passing a wrong module! Please check the object you are passing to i18next.use()");return e.type==="backend"&&(this.modules.backend=e),(e.type==="logger"||e.log&&e.warn&&e.error)&&(this.modules.logger=e),e.type==="languageDetector"&&(this.modules.languageDetector=e),e.type==="i18nFormat"&&(this.modules.i18nFormat=e),e.type==="postProcessor"&&_w.addPostProcessor(e),e.type==="formatter"&&(this.modules.formatter=e),e.type==="3rdParty"&&this.modules.external.push(e),this}setResolvedLanguage(e){if(!(!e||!this.languages)&&!(["cimode","dev"].indexOf(e)>-1))for(let t=0;t<this.languages.length;t++){const i=this.languages[t];if(!(["cimode","dev"].indexOf(i)>-1)&&this.store.hasLanguageSomeTranslations(i)){this.resolvedLanguage=i;break}}}changeLanguage(e,t){var i=this;this.isLanguageChangingTo=e;const r=Ga();this.emit("languageChanging",e);const n=l=>{this.language=l,this.languages=this.services.languageUtils.toResolveHierarchy(l),this.resolvedLanguage=void 0,this.setResolvedLanguage(l)},a=(l,h)=>{h?(n(h),this.translator.changeLanguage(h),this.isLanguageChangingTo=void 0,this.emit("languageChanged",h),this.logger.log("languageChanged",h)):this.isLanguageChangingTo=void 0,r.resolve(function(){return i.t(...arguments)}),t&&t(l,function(){return i.t(...arguments)})},o=l=>{!e&&!l&&this.services.languageDetector&&(l=[]);const h=typeof l=="string"?l:this.services.languageUtils.getBestMatchFromCodes(l);h&&(this.language||n(h),this.translator.language||this.translator.changeLanguage(h),this.services.languageDetector&&this.services.languageDetector.cacheUserLanguage&&this.services.languageDetector.cacheUserLanguage(h)),this.loadResources(h,u=>{a(u,h)})};return!e&&this.services.languageDetector&&!this.services.languageDetector.async?o(this.services.languageDetector.detect()):!e&&this.services.languageDetector&&this.services.languageDetector.async?this.services.languageDetector.detect.length===0?this.services.languageDetector.detect().then(o):this.services.languageDetector.detect(o):o(e),r}getFixedT(e,t,i){var r=this;const n=function(a,o){let l;if(typeof o!="object"){for(var h=arguments.length,u=new Array(h>2?h-2:0),c=2;c<h;c++)u[c-2]=arguments[c];l=r.options.overloadTranslationOptionHandler([a,o].concat(u))}else l={...o};l.lng=l.lng||n.lng,l.lngs=l.lngs||n.lngs,l.ns=l.ns||n.ns,l.keyPrefix!==""&&(l.keyPrefix=l.keyPrefix||i||n.keyPrefix);const d=r.options.keySeparator||".";let p;return l.keyPrefix&&Array.isArray(a)?p=a.map(g=>`${l.keyPrefix}${d}${g}`):p=l.keyPrefix?`${l.keyPrefix}${d}${a}`:a,r.t(p,l)};return typeof e=="string"?n.lng=e:n.lngs=e,n.ns=t,n.keyPrefix=i,n}t(){return this.translator&&this.translator.translate(...arguments)}exists(){return this.translator&&this.translator.exists(...arguments)}setDefaultNamespace(e){this.options.defaultNS=e}hasLoadedNamespace(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!this.isInitialized)return this.logger.warn("hasLoadedNamespace: i18next was not initialized",this.languages),!1;if(!this.languages||!this.languages.length)return this.logger.warn("hasLoadedNamespace: i18n.languages were undefined or empty",this.languages),!1;const i=t.lng||this.resolvedLanguage||this.languages[0],r=this.options?this.options.fallbackLng:!1,n=this.languages[this.languages.length-1];if(i.toLowerCase()==="cimode")return!0;const a=(o,l)=>{const h=this.services.backendConnector.state[`${o}|${l}`];return h===-1||h===0||h===2};if(t.precheck){const o=t.precheck(this,a);if(o!==void 0)return o}return!!(this.hasResourceBundle(i,e)||!this.services.backendConnector.backend||this.options.resources&&!this.options.partialBundledLanguages||a(i,e)&&(!r||a(n,e)))}loadNamespaces(e,t){const i=Ga();return this.options.ns?(typeof e=="string"&&(e=[e]),e.forEach(r=>{this.options.ns.indexOf(r)<0&&this.options.ns.push(r)}),this.loadResources(r=>{i.resolve(),t&&t(r)}),i):(t&&t(),Promise.resolve())}loadLanguages(e,t){const i=Ga();typeof e=="string"&&(e=[e]);const r=this.options.preload||[],n=e.filter(a=>r.indexOf(a)<0&&this.services.languageUtils.isSupportedCode(a));return n.length?(this.options.preload=r.concat(n),this.loadResources(a=>{i.resolve(),t&&t(a)}),i):(t&&t(),Promise.resolve())}dir(e){if(e||(e=this.resolvedLanguage||(this.languages&&this.languages.length>0?this.languages[0]:this.language)),!e)return"rtl";const t=["ar","shu","sqr","ssh","xaa","yhd","yud","aao","abh","abv","acm","acq","acw","acx","acy","adf","ads","aeb","aec","afb","ajp","apc","apd","arb","arq","ars","ary","arz","auz","avl","ayh","ayl","ayn","ayp","bbz","pga","he","iw","ps","pbt","pbu","pst","prp","prd","ug","ur","ydd","yds","yih","ji","yi","hbo","men","xmn","fa","jpr","peo","pes","prs","dv","sam","ckb"],i=this.services&&this.services.languageUtils||new hm(dm());return t.indexOf(i.getLanguagePartFromCode(e))>-1||e.toLowerCase().indexOf("-arab")>1?"rtl":"ltr"}static createInstance(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;return new Ro(e,t)}cloneInstance(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Fl;const i=e.forkResourceStore;i&&delete e.forkResourceStore;const r={...this.options,...e,isClone:!0},n=new Ro(r);return(e.debug!==void 0||e.prefix!==void 0)&&(n.logger=n.logger.clone(e)),["store","services","language"].forEach(o=>{n[o]=this[o]}),n.services={...this.services},n.services.utils={hasLoadedNamespace:n.hasLoadedNamespace.bind(n)},i&&(n.store=new om(this.store.data,r),n.services.resourceStore=n.store),n.translator=new Lh(n.services,r),n.translator.on("*",function(o){for(var l=arguments.length,h=new Array(l>1?l-1:0),u=1;u<l;u++)h[u-1]=arguments[u];n.emit(o,...h)}),n.init(r,t),n.translator.options=r,n.translator.backendConnector.services.utils={hasLoadedNamespace:n.hasLoadedNamespace.bind(n)},n}toJSON(){return{options:this.options,store:this.store,language:this.language,languages:this.languages,resolvedLanguage:this.resolvedLanguage}}}const ai=Ro.createInstance();ai.createInstance=Ro.createInstance;ai.createInstance;ai.dir;ai.init;ai.loadResources;ai.reloadResources;ai.use;ai.changeLanguage;ai.getFixedT;ai.t;ai.exists;ai.setDefaultNamespace;ai.hasLoadedNamespace;ai.loadNamespaces;ai.loadLanguages;const Ax={Language:"Language",Score:{AlphaTabRenderedBy:"Tabs & score rendered by:"}},Ix={Language:"Nyelv",Score:{AlphaTabRenderedBy:"Tabot és kottát generálta:"}};ai.init({interpolation:{escapeValue:!1},debug:!0,lng:window.navigator.language,fallbackLng:"en",resources:{en:{translation:Ax},hu:{translation:Ix}},react:{transSupportBasicHtmlNodes:!0,transKeepBasicHtmlNodesFor:["br","strong","i"]}});const Ox=ai,Vx=IB`
  #root {
    width: 100vw;
    height: 100vh;
  }
  #modal {
    /* No styling for now */
  }
  #tooltip {
    position: fixed;
    top: 0px;
    left: 0px;
    width: 100vw;
    height: 100vh;
    pointer-events: none;
  }

  *,
  *::before,
  *::after {
    box-sizing: border-box;
    margin: 0px;
    padding: 0px;
  }

  div,
  span {
    font-family: 'Poppins', sans-serif;
  }

  body {
    -webkit-font-smoothing: antialiased;
    background-color: #000000;
    /* background: linear-gradient(147deg, #000000 0%, #434343 74%); */
    height: 100vh;
    width: 100vw;
  }

  img,
  picture,
  video,
  canvas,
  svg {
    display: block;
    max-width: 100%;
  }

  input,
  button,
  textarea,
  select {
    font: inherit;
  }

  p,
  h1,
  h2,
  h3,
  h4,
  h5,
  h6 {
    overflow-wrap: break-word;
  }

  a:-webkit-any-link {
    text-decoration: none;
  }

  a {
    text-decoration: none !important;
  }

  // Custom scrollbar
  * {
    --sb-track-color: #ffffff20;
    --sb-thumb-color: #ffffff60;
    --sb-size: 8px;
  }

  *::-webkit-scrollbar {
    width: var(--sb-size);
    height: var(--sb-size);
  }

  *::-webkit-scrollbar-track {
    background: var(--sb-track-color);
    border-radius: 4px;
    overflow: hidden;
  }

  *::-webkit-scrollbar-thumb {
    background: var(--sb-thumb-color);
    border-radius: 4px;
  }

  @supports not selector(::-webkit-scrollbar) {
    * {
      scrollbar-color: var(--sb-thumb-color) var(--sb-track-color);
    }
  }

  /** Alphatab stuff */
  .at-footer {
    flex: 0 0 auto;
    background: #436d9d;
    color: #fff;
  }
  /* Player */
  .at-cursor-bar {
    /* Defines the color of the bar background when a bar is played */
    background: #ffffff30;
  }
  .at-selection div {
    /* Defines the color of the selection background */
    background: #ffffff20;
  }
  .at-cursor-beat {
    /* Defines the beat cursor */
    background: red;
    width: 3px;
  }
  .at-highlight * {
    /* Defines the color of the music symbols when played (svg) */
    /* fill: #0078ff;
    stroke: #0078ff; */
  }
  // Hide big rendered by label, and display clickable logo elsewhere
  .at-surface > div:last-child {
    display: none !important;
  }
`;function pm(s,e){if(s.inserted[e.name]===void 0)return s.insert("",e,s.sheet,!0)}function gm(s,e,t){var i=[],r=uw(s,i,t);return i.length<2?t:r+e(i)}var Hx=function(e){var t=nw(e);t.sheet.speedy=function(o){this.isSpeedy=o},t.compat=!0;var i=function(){for(var l=arguments.length,h=new Array(l),u=0;u<l;u++)h[u]=arguments[u];var c=ao(h,t.registered,void 0);return cw(t,c,!1),t.key+"-"+c.name},r=function(){for(var l=arguments.length,h=new Array(l),u=0;u<l;u++)h[u]=arguments[u];var c=ao(h,t.registered),d="animation-"+c.name;return pm(t,{name:c.name,styles:"@keyframes "+d+"{"+c.styles+"}"}),d},n=function(){for(var l=arguments.length,h=new Array(l),u=0;u<l;u++)h[u]=arguments[u];var c=ao(h,t.registered);pm(t,c)},a=function(){for(var l=arguments.length,h=new Array(l),u=0;u<l;u++)h[u]=arguments[u];return gm(t.registered,i,Wx(h))};return{css:i,cx:a,injectGlobal:n,keyframes:r,hydrate:function(l){l.forEach(function(h){t.inserted[h]=!0})},flush:function(){t.registered={},t.inserted={},t.sheet.flush()},sheet:t.sheet,cache:t,getRegisteredStyles:uw.bind(null,t.registered),merge:gm.bind(null,t.registered,i)}},Wx=function s(e){for(var t="",i=0;i<e.length;i++){var r=e[i];if(r!=null){var n=void 0;switch(typeof r){case"boolean":break;case"object":{if(Array.isArray(r))n=s(r);else{n="";for(var a in r)r[a]&&a&&(n&&(n+=" "),n+=a)}break}default:n=r}n&&(t&&(t+=" "),t+=n)}}return t},jf=Hx({key:"css"}),Bw=jf.cx,zx=jf.keyframes,wt=jf.css;const Gx=zx`
  0% {
    transform: rotate(0deg);
  }
  100% {
    transform: rotate(360deg);
  }
`,Ux=wt`
  width: 60px;
  height: 60px;
  border: 7px solid #fff;
  border-bottom-color: transparent;
  border-radius: 50%;
  display: inline-block;
  box-sizing: border-box;
  animation: ${Gx} 1s linear infinite;
`,$x=()=>ve.jsx("span",{className:Ux}),Yx=wt`
  position: fixed;
  top: 0px;
  left: 0px;
  right: 0px;
  bottom: 0px;
  z-index: 3;

  backdrop-filter: blur(5px);
  background: #22222299;

  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  gap: 20px;
`,Xx=wt`
  color: #ffffff;
  font-size: 2em;
`,Qx=({isVisible:s})=>s?ve.jsxs("div",{className:Yx,children:[ve.jsx($x,{}),ve.jsx("div",{className:Xx,children:"Score is loading..."})]}):null;var ur;(function(s){s[s.Page=0]="Page",s[s.Horizontal=1]="Horizontal"})(ur||(ur={}));var er;(function(s){s[s.Default=0]="Default",s[s.ScoreTab=1]="ScoreTab",s[s.Score=2]="Score",s[s.Tab=3]="Tab",s[s.TabMixed=4]="TabMixed"})(er||(er={}));class nr{static getValue(e){return nr._values||(nr._values=new Map),e=e.toLowerCase().replaceAll(" ",""),nr._values.has(e)?nr._values.get(e):0}static isPiano(e){return e<=7||e>=16&&e<=23}static isGuitar(e){return e>=24&&e<=39||e===105||e===43}}nr._values=new Map([["acousticgrandpiano",0],["brightacousticpiano",1],["electricgrandpiano",2],["honkytonkpiano",3],["electricpiano1",4],["electricpiano2",5],["harpsichord",6],["clavinet",7],["celesta",8],["glockenspiel",9],["musicbox",10],["vibraphone",11],["marimba",12],["xylophone",13],["tubularbells",14],["dulcimer",15],["drawbarorgan",16],["percussiveorgan",17],["rockorgan",18],["churchorgan",19],["reedorgan",20],["accordion",21],["harmonica",22],["tangoaccordion",23],["acousticguitarnylon",24],["acousticguitarsteel",25],["electricguitarjazz",26],["electricguitarclean",27],["electricguitarmuted",28],["overdrivenguitar",29],["distortionguitar",30],["guitarharmonics",31],["acousticbass",32],["electricbassfinger",33],["electricbasspick",34],["fretlessbass",35],["slapbass1",36],["slapbass2",37],["synthbass1",38],["synthbass2",39],["violin",40],["viola",41],["cello",42],["contrabass",43],["tremolostrings",44],["pizzicatostrings",45],["orchestralharp",46],["timpani",47],["stringensemble1",48],["stringensemble2",49],["synthstrings1",50],["synthstrings2",51],["choiraahs",52],["voiceoohs",53],["synthvoice",54],["orchestrahit",55],["trumpet",56],["trombone",57],["tuba",58],["mutedtrumpet",59],["frenchhorn",60],["brasssection",61],["synthbrass1",62],["synthbrass2",63],["sopranosax",64],["altosax",65],["tenorsax",66],["baritonesax",67],["oboe",68],["englishhorn",69],["bassoon",70],["clarinet",71],["piccolo",72],["flute",73],["recorder",74],["panflute",75],["blownbottle",76],["shakuhachi",77],["whistle",78],["ocarina",79],["lead1square",80],["lead2sawtooth",81],["lead3calliope",82],["lead4chiff",83],["lead5charang",84],["lead6voice",85],["lead7fifths",86],["lead8bassandlead",87],["pad1newage",88],["pad2warm",89],["pad3polysynth",90],["pad4choir",91],["pad5bowed",92],["pad6metallic",93],["pad7halo",94],["pad8sweep",95],["fx1rain",96],["fx2soundtrack",97],["fx3crystal",98],["fx4atmosphere",99],["fx5brightness",100],["fx6goblins",101],["fx7echoes",102],["fx8scifi",103],["sitar",104],["banjo",105],["shamisen",106],["koto",107],["kalimba",108],["bagpipe",109],["fiddle",110],["shanai",111],["tinklebell",112],["agogo",113],["steeldrums",114],["woodblock",115],["taikodrum",116],["melodictom",117],["synthdrum",118],["reversecymbal",119],["guitarfretnoise",120],["breathnoise",121],["seashore",122],["birdtweet",123],["telephonering",124],["helicopter",125],["applause",126],["gunshot",127]]);class Ma{init(e,t){this.data=e,this.settings=t}}var Nt;(function(s){s[s.General=0]="General",s[s.Format=1]="Format",s[s.AlphaTex=2]="AlphaTex"})(Nt||(Nt={}));class Pt extends Error{constructor(e,t="",i){super(t??"",{cause:i}),this.type=e,Object.setPrototypeOf(this,Pt.prototype)}}class Ye extends Pt{constructor(e=null,t){super(Nt.Format,e??"Unsupported format",t),Object.setPrototypeOf(this,Ye.prototype)}}var et;(function(s){s[s.None=0]="None",s[s.Normal=1]="Normal",s[s.Heavy=2]="Heavy",s[s.Tenuto=3]="Tenuto"})(et||(et={}));var gt;(function(s){s[s.Tempo=0]="Tempo",s[s.Volume=1]="Volume",s[s.Instrument=2]="Instrument",s[s.Balance=3]="Balance"})(gt||(gt={}));class Vt{constructor(){this.isLinear=!1,this.type=gt.Tempo,this.value=0,this.ratioPosition=0,this.text=""}static buildTempoAutomation(e,t,i,r){(r<1||r>5)&&(r=2);let n=new Float32Array([1,.5,1,1.5,2,3]),a=new Vt;return a.type=gt.Tempo,a.isLinear=e,a.ratioPosition=t,a.value=i*n[r],a}static buildInstrumentAutomation(e,t,i){let r=new Vt;return r.type=gt.Instrument,r.isLinear=e,r.ratioPosition=t,r.value=i,r}}var ie;(function(s){s[s.Neutral=0]="Neutral",s[s.C3=1]="C3",s[s.C4=2]="C4",s[s.F4=3]="F4",s[s.G2=4]="G2"})(ie||(ie={}));var Te;(function(s){s[s._15ma=0]="_15ma",s[s._8va=1]="_8va",s[s.Regular=2]="Regular",s[s._8vb=3]="_8vb",s[s._15mb=4]="_15mb"})(Te||(Te={}));var Qi;(function(s){s[s.None=0]="None",s[s.Simple=1]="Simple",s[s.FirstOfDouble=2]="FirstOfDouble",s[s.SecondOfDouble=3]="SecondOfDouble"})(Qi||(Qi={}));class Sr{constructor(){this.id=Sr._globalBarId++,this.index=0,this.nextBar=null,this.previousBar=null,this.clef=ie.G2,this.clefOttava=Te.Regular,this.voices=[],this.simileMark=Qi.None,this.isMultiVoice=!1,this.displayScale=1,this.displayWidth=-1}get masterBar(){return this.staff.track.score.masterBars[this.index]}get isEmpty(){for(let e=0,t=this.voices.length;e<t;e++)if(!this.voices[e].isEmpty)return!1;return!0}addVoice(e){e.bar=this,e.index=this.voices.length,this.voices.push(e)}finish(e,t=null){this.isMultiVoice=!1;for(let i=0,r=this.voices.length;i<r;i++){let n=this.voices[i];n.finish(e,t),i>0&&!n.isEmpty&&(this.isMultiVoice=!0)}}calculateDuration(){let e=0;for(let t of this.voices){let i=t.calculateDuration();i>e&&(e=i)}return e}}Sr._globalBarId=0;class re{static ticksToMillis(e,t){return e*(6e4/(t*re.QuarterTime))|0}static millisToTicks(e,t){return e/(6e4/(t*re.QuarterTime))|0}static toTicks(e){return re.valueToTicks(e)}static valueToTicks(e){let t=e;return t<0&&(t=1/-t),re.QuarterTime*(4/t)|0}static applyDot(e,t){return t?e+(e/4|0)*3:e+(e/2|0)}static applyTuplet(e,t,i){return e*i/t|0}static removeTuplet(e,t,i){return e*t/i|0}static dynamicToVelocity(e){return re.MinVelocity+e*re.VelocityIncrement}}re.QuarterTime=960;re.MinVelocity=15;re.VelocityIncrement=16;class A{constructor(e=0,t=0){this.offset=e,this.value=t}}A.MaxPosition=60;A.MaxValue=12;var Ee;(function(s){s[s.Default=0]="Default",s[s.Gradual=1]="Gradual",s[s.Fast=2]="Fast"})(Ee||(Ee={}));var G;(function(s){s[s.None=0]="None",s[s.Custom=1]="Custom",s[s.Bend=2]="Bend",s[s.Release=3]="Release",s[s.BendRelease=4]="BendRelease",s[s.Hold=5]="Hold",s[s.Prebend=6]="Prebend",s[s.PrebendBend=7]="PrebendBend",s[s.PrebendRelease=8]="PrebendRelease"})(G||(G={}));var Ve;(function(s){s[s.None=0]="None",s[s.BrushUp=1]="BrushUp",s[s.BrushDown=2]="BrushDown",s[s.ArpeggioUp=3]="ArpeggioUp",s[s.ArpeggioDown=4]="ArpeggioDown"})(Ve||(Ve={}));var ki;(function(s){s[s.None=0]="None",s[s.Crescendo=1]="Crescendo",s[s.Decrescendo=2]="Decrescendo"})(ki||(ki={}));var k;(function(s){s[s.QuadrupleWhole=-4]="QuadrupleWhole",s[s.DoubleWhole=-2]="DoubleWhole",s[s.Whole=1]="Whole",s[s.Half=2]="Half",s[s.Quarter=4]="Quarter",s[s.Eighth=8]="Eighth",s[s.Sixteenth=16]="Sixteenth",s[s.ThirtySecond=32]="ThirtySecond",s[s.SixtyFourth=64]="SixtyFourth",s[s.OneHundredTwentyEighth=128]="OneHundredTwentyEighth",s[s.TwoHundredFiftySixth=256]="TwoHundredFiftySixth"})(k||(k={}));var de;(function(s){s[s.PPP=0]="PPP",s[s.PP=1]="PP",s[s.P=2]="P",s[s.MP=3]="MP",s[s.MF=4]="MF",s[s.F=5]="F",s[s.FF=6]="FF",s[s.FFF=7]="FFF"})(de||(de={}));var $;(function(s){s[s.None=0]="None",s[s.OnBeat=1]="OnBeat",s[s.BeforeBeat=2]="BeforeBeat",s[s.BendGrace=3]="BendGrace"})($||($={}));var oe;(function(s){s[s.Unknown=-2]="Unknown",s[s.NoOrDead=-1]="NoOrDead",s[s.Thumb=0]="Thumb",s[s.IndexFinger=1]="IndexFinger",s[s.MiddleFinger=2]="MiddleFinger",s[s.AnnularFinger=3]="AnnularFinger",s[s.LittleFinger=4]="LittleFinger"})(oe||(oe={}));var X;(function(s){s[s.None=0]="None",s[s.Natural=1]="Natural",s[s.Artificial=2]="Artificial",s[s.Pinch=3]="Pinch",s[s.Tap=4]="Tap",s[s.Semi=5]="Semi",s[s.Feedback=6]="Feedback"})(X||(X={}));var ot;(function(s){s[s.Default=0]="Default",s[s.ForceNone=1]="ForceNone",s[s.ForceNatural=2]="ForceNatural",s[s.ForceSharp=3]="ForceSharp",s[s.ForceDoubleSharp=4]="ForceDoubleSharp",s[s.ForceFlat=5]="ForceFlat",s[s.ForceDoubleFlat=6]="ForceDoubleFlat"})(ot||(ot={}));var vt;(function(s){s[s.None=0]="None",s[s.IntoFromBelow=1]="IntoFromBelow",s[s.IntoFromAbove=2]="IntoFromAbove"})(vt||(vt={}));var ne;(function(s){s[s.None=0]="None",s[s.Shift=1]="Shift",s[s.Legato=2]="Legato",s[s.OutUp=3]="OutUp",s[s.OutDown=4]="OutDown",s[s.PickSlideDown=5]="PickSlideDown",s[s.PickSlideUp=6]="PickSlideUp"})(ne||(ne={}));var Be;(function(s){s[s.None=0]="None",s[s.Slight=1]="Slight",s[s.Wide=2]="Wide"})(Be||(Be={}));var ar;(function(s){s[s.Hidden=0]="Hidden",s[s.ShowWithBeams=1]="ShowWithBeams",s[s.ShowWithBars=2]="ShowWithBars"})(ar||(ar={}));var Cs;(function(s){s[s.ScoreDefault=0]="ScoreDefault",s[s.ScoreForcePiano=1]="ScoreForcePiano",s[s.SingleNoteEffectBand=2]="SingleNoteEffectBand",s[s.SingleNoteEffectBandForcePiano=3]="SingleNoteEffectBandForcePiano"})(Cs||(Cs={}));var St;(function(s){s[s.GuitarPro=0]="GuitarPro",s[s.SongBook=1]="SongBook"})(St||(St={}));var K;(function(s){s[s.ScoreTitle=0]="ScoreTitle",s[s.ScoreSubTitle=1]="ScoreSubTitle",s[s.ScoreArtist=2]="ScoreArtist",s[s.ScoreAlbum=3]="ScoreAlbum",s[s.ScoreWords=4]="ScoreWords",s[s.ScoreMusic=5]="ScoreMusic",s[s.ScoreWordsAndMusic=6]="ScoreWordsAndMusic",s[s.ScoreCopyright=7]="ScoreCopyright",s[s.GuitarTuning=8]="GuitarTuning",s[s.TrackNames=9]="TrackNames",s[s.ChordDiagrams=10]="ChordDiagrams",s[s.ParenthesisOnTiedBends=11]="ParenthesisOnTiedBends",s[s.TabNotesOnTiedBends=12]="TabNotesOnTiedBends",s[s.ZerosOnDiveWhammys=13]="ZerosOnDiveWhammys",s[s.EffectAlternateEndings=14]="EffectAlternateEndings",s[s.EffectCapo=15]="EffectCapo",s[s.EffectChordNames=16]="EffectChordNames",s[s.EffectCrescendo=17]="EffectCrescendo",s[s.EffectDynamics=18]="EffectDynamics",s[s.EffectFadeIn=19]="EffectFadeIn",s[s.EffectFermata=20]="EffectFermata",s[s.EffectFingering=21]="EffectFingering",s[s.EffectHarmonics=22]="EffectHarmonics",s[s.EffectLetRing=23]="EffectLetRing",s[s.EffectLyrics=24]="EffectLyrics",s[s.EffectMarker=25]="EffectMarker",s[s.EffectOttavia=26]="EffectOttavia",s[s.EffectPalmMute=27]="EffectPalmMute",s[s.EffectPickSlide=28]="EffectPickSlide",s[s.EffectPickStroke=29]="EffectPickStroke",s[s.EffectSlightBeatVibrato=30]="EffectSlightBeatVibrato",s[s.EffectSlightNoteVibrato=31]="EffectSlightNoteVibrato",s[s.EffectTap=32]="EffectTap",s[s.EffectTempo=33]="EffectTempo",s[s.EffectText=34]="EffectText",s[s.EffectTrill=35]="EffectTrill",s[s.EffectTripletFeel=36]="EffectTripletFeel",s[s.EffectWhammyBar=37]="EffectWhammyBar",s[s.EffectWideBeatVibrato=38]="EffectWideBeatVibrato",s[s.EffectWideNoteVibrato=39]="EffectWideNoteVibrato",s[s.EffectLeftHandTap=40]="EffectLeftHandTap",s[s.EffectFreeTime=41]="EffectFreeTime"})(K||(K={}));class Do{constructor(){this.notationMode=St.GuitarPro,this.fingeringMode=Cs.ScoreDefault,this.elements=new Map,this.rhythmMode=ar.Hidden,this.rhythmHeight=15,this.transpositionPitches=[],this.displayTranspositionPitches=[],this.smallGraceTabNotes=!0,this.extendBendArrowsOnTiedNotes=!0,this.extendLineEffectsToBeatEnd=!1,this.slurHeight=5}isNotationElementVisible(e){return this.elements.has(e)?this.elements.get(e):Do.defaultElements.has(e)?Do.defaultElements.get(e):!0}}Do.defaultElements=new Map([[K.ZerosOnDiveWhammys,!1]]);class xw{constructor(e){this._value=void 0,this._factory=e}get value(){return this._value===void 0&&(this._value=this._factory()),this._value}}var ws;(function(s){s[s.None=0]="None",s[s.Debug=1]="Debug",s[s.Info=2]="Info",s[s.Warning=3]="Warning",s[s.Error=4]="Error"})(ws||(ws={}));class hn{static format(e,t){return`[AlphaTab][${e}] ${t}`}debug(e,t,...i){console.debug(hn.format(e,t),...i)}warning(e,t,...i){console.warn(hn.format(e,t),...i)}info(e,t,...i){console.info(hn.format(e,t),...i)}error(e,t,...i){console.error(hn.format(e,t),...i)}}hn.logLevel=ws.Info;class C{static shouldLog(e){return C.logLevel!==ws.None&&e>=C.logLevel}static debug(e,t,...i){C.shouldLog(ws.Debug)&&C.log.debug(e,t,...i)}static warning(e,t,...i){C.shouldLog(ws.Warning)&&C.log.warning(e,t,...i)}static info(e,t,...i){C.shouldLog(ws.Info)&&C.log.info(e,t,...i)}static error(e,t,...i){C.shouldLog(ws.Error)&&C.log.error(e,t,...i)}}C.logLevel=ws.Info;C.log=new hn;class Jx{constructor(){this.note=null,this.noteValue=0,this.octave=0}get realValue(){return this.octave*12+this.noteValue}}class Re{static getIndex(e){let t=0;return e<0?t:Math.log2(e)|0}static keySignatureIsFlat(e){return e<0}static keySignatureIsNatural(e){return e===0}static keySignatureIsSharp(e){return e>0}static applyPitchOffsets(e,t){for(let i=0;i<t.tracks.length;i++){if(i<e.notation.displayTranspositionPitches.length)for(let r of t.tracks[i].staves)r.displayTranspositionPitch=-e.notation.displayTranspositionPitches[i];if(i<e.notation.transpositionPitches.length)for(let r of t.tracks[i].staves)r.transpositionPitch=-e.notation.transpositionPitches[i]}}static fingerToString(e,t,i,r){if(e.notation.fingeringMode===Cs.ScoreForcePiano||e.notation.fingeringMode===Cs.SingleNoteEffectBandForcePiano||nr.isPiano(t.voice.bar.staff.track.playbackInfo.program))switch(i){case oe.Unknown:case oe.NoOrDead:return null;case oe.Thumb:return"1";case oe.IndexFinger:return"2";case oe.MiddleFinger:return"3";case oe.AnnularFinger:return"4";case oe.LittleFinger:return"5";default:return null}if(r)switch(i){case oe.Unknown:return null;case oe.NoOrDead:return"0";case oe.Thumb:return"t";case oe.IndexFinger:return"1";case oe.MiddleFinger:return"2";case oe.AnnularFinger:return"3";case oe.LittleFinger:return"4";default:return null}switch(i){case oe.Unknown:case oe.NoOrDead:return null;case oe.Thumb:return"p";case oe.IndexFinger:return"i";case oe.MiddleFinger:return"m";case oe.AnnularFinger:return"a";case oe.LittleFinger:return"c";default:return null}}static isTuning(e){return!!Re.parseTuning(e)}static parseTuning(e){let t="",i="";for(let n=0;n<e.length;n++){let a=e.charCodeAt(n);if(a>=48&&a<=57){if(!t)return null;i+=String.fromCharCode(a)}else if(a>=65&&a<=90||a>=97&&a<=122||a===35)t+=String.fromCharCode(a);else return null}if(!i||!t)return null;let r=new Jx;return r.octave=parseInt(i)+1,r.note=t.toLowerCase(),r.noteValue=Re.getToneForText(r.note),r}static getTuningForText(e){let t=Re.parseTuning(e);return t?t.realValue:-1}static getToneForText(e){switch(e.toLowerCase()){case"c":return 0;case"c#":case"db":return 1;case"d":return 2;case"d#":case"eb":return 3;case"e":return 4;case"f":return 5;case"f#":case"gb":return 6;case"g":return 7;case"g#":case"ab":return 8;case"a":return 9;case"a#":case"bb":return 10;case"b":return 11;default:return 0}}static newGuid(){return Math.floor((1+Math.random())*65536).toString(16).substring(1)+Math.floor((1+Math.random())*65536).toString(16).substring(1)+"-"+Math.floor((1+Math.random())*65536).toString(16).substring(1)+"-"+Math.floor((1+Math.random())*65536).toString(16).substring(1)+"-"+Math.floor((1+Math.random())*65536).toString(16).substring(1)+"-"+Math.floor((1+Math.random())*65536).toString(16).substring(1)+Math.floor((1+Math.random())*65536).toString(16).substring(1)+Math.floor((1+Math.random())*65536).toString(16).substring(1)}static isAlmostEqualTo(e,t){return Math.abs(e-t)<1e-5}static toHexString(e,t=0){let i="",r="0123456789ABCDEF";do i=String.fromCharCode(r.charCodeAt(e&15))+i,e=e>>4;while(e>0);for(;i.length<t;)i="0"+i;return i}}var At;(function(s){s[s.None=0]="None",s[s.Up=1]="Up",s[s.Down=2]="Down"})(At||(At={}));var f;(function(s){s[s.None=-1]="None",s[s.GClef=57424]="GClef",s[s.CClef=57436]="CClef",s[s.FClef=57442]="FClef",s[s.UnpitchedPercussionClef1=57449]="UnpitchedPercussionClef1",s[s.SixStringTabClef=57453]="SixStringTabClef",s[s.FourStringTabClef=57454]="FourStringTabClef",s[s.TimeSig0=57472]="TimeSig0",s[s.TimeSig1=57473]="TimeSig1",s[s.TimeSig2=57474]="TimeSig2",s[s.TimeSig3=57475]="TimeSig3",s[s.TimeSig4=57476]="TimeSig4",s[s.TimeSig5=57477]="TimeSig5",s[s.TimeSig6=57478]="TimeSig6",s[s.TimeSig7=57479]="TimeSig7",s[s.TimeSig8=57480]="TimeSig8",s[s.TimeSig9=57481]="TimeSig9",s[s.TimeSigCommon=57482]="TimeSigCommon",s[s.TimeSigCutCommon=57483]="TimeSigCutCommon",s[s.NoteheadDoubleWholeSquare=57505]="NoteheadDoubleWholeSquare",s[s.NoteheadDoubleWhole=57504]="NoteheadDoubleWhole",s[s.NoteheadWhole=57506]="NoteheadWhole",s[s.NoteheadHalf=57507]="NoteheadHalf",s[s.NoteheadBlack=57508]="NoteheadBlack",s[s.NoteheadNull=57509]="NoteheadNull",s[s.NoteheadXOrnate=57514]="NoteheadXOrnate",s[s.NoteheadTriangleUpWhole=57531]="NoteheadTriangleUpWhole",s[s.NoteheadTriangleUpHalf=57532]="NoteheadTriangleUpHalf",s[s.NoteheadTriangleUpBlack=57534]="NoteheadTriangleUpBlack",s[s.NoteheadDiamondBlackWide=57564]="NoteheadDiamondBlackWide",s[s.NoteheadDiamondWhite=57565]="NoteheadDiamondWhite",s[s.NoteheadDiamondWhiteWide=57566]="NoteheadDiamondWhiteWide",s[s.NoteheadCircleX=57523]="NoteheadCircleX",s[s.NoteheadXWhole=57511]="NoteheadXWhole",s[s.NoteheadXHalf=57512]="NoteheadXHalf",s[s.NoteheadXBlack=57513]="NoteheadXBlack",s[s.NoteheadParenthesis=57550]="NoteheadParenthesis",s[s.NoteheadSlashedBlack2=57552]="NoteheadSlashedBlack2",s[s.NoteheadCircleSlash=57591]="NoteheadCircleSlash",s[s.NoteheadHeavyX=57592]="NoteheadHeavyX",s[s.NoteheadHeavyXHat=57593]="NoteheadHeavyXHat",s[s.NoteheadSlashVerticalEnds=57600]="NoteheadSlashVerticalEnds",s[s.NoteheadSlashWhiteWhole=57602]="NoteheadSlashWhiteWhole",s[s.NoteheadSlashWhiteHalf=57603]="NoteheadSlashWhiteHalf",s[s.NoteQuarterUp=57813]="NoteQuarterUp",s[s.NoteEighthUp=57815]="NoteEighthUp",s[s.Tremolo3=57890]="Tremolo3",s[s.Tremolo2=57889]="Tremolo2",s[s.Tremolo1=57888]="Tremolo1",s[s.FlagEighthUp=57920]="FlagEighthUp",s[s.FlagEighthDown=57921]="FlagEighthDown",s[s.FlagSixteenthUp=57922]="FlagSixteenthUp",s[s.FlagSixteenthDown=57923]="FlagSixteenthDown",s[s.FlagThirtySecondUp=57924]="FlagThirtySecondUp",s[s.FlagThirtySecondDown=57925]="FlagThirtySecondDown",s[s.FlagSixtyFourthUp=57926]="FlagSixtyFourthUp",s[s.FlagSixtyFourthDown=57927]="FlagSixtyFourthDown",s[s.FlagOneHundredTwentyEighthUp=57928]="FlagOneHundredTwentyEighthUp",s[s.FlagOneHundredTwentyEighthDown=57929]="FlagOneHundredTwentyEighthDown",s[s.FlagTwoHundredFiftySixthUp=57930]="FlagTwoHundredFiftySixthUp",s[s.FlagTwoHundredFiftySixthDown=57931]="FlagTwoHundredFiftySixthDown",s[s.AccidentalFlat=57952]="AccidentalFlat",s[s.AccidentalNatural=57953]="AccidentalNatural",s[s.AccidentalSharp=57954]="AccidentalSharp",s[s.AccidentalDoubleSharp=57955]="AccidentalDoubleSharp",s[s.AccidentalDoubleFlat=57956]="AccidentalDoubleFlat",s[s.AccidentalQuarterToneFlatArrowUp=57968]="AccidentalQuarterToneFlatArrowUp",s[s.AccidentalQuarterToneSharpArrowUp=57972]="AccidentalQuarterToneSharpArrowUp",s[s.AccidentalQuarterToneNaturalArrowUp=57970]="AccidentalQuarterToneNaturalArrowUp",s[s.ArticAccentAbove=58528]="ArticAccentAbove",s[s.ArticAccentBelow=58529]="ArticAccentBelow",s[s.ArticStaccatoAbove=58530]="ArticStaccatoAbove",s[s.ArticStaccatoBelow=58531]="ArticStaccatoBelow",s[s.ArticTenutoAbove=58532]="ArticTenutoAbove",s[s.ArticTenutoBelow=58533]="ArticTenutoBelow",s[s.ArticMarcatoAbove=58540]="ArticMarcatoAbove",s[s.ArticMarcatoBelow=58541]="ArticMarcatoBelow",s[s.FermataAbove=58560]="FermataAbove",s[s.FermataShortAbove=58564]="FermataShortAbove",s[s.FermataLongAbove=58566]="FermataLongAbove",s[s.RestLonga=58593]="RestLonga",s[s.RestDoubleWhole=58594]="RestDoubleWhole",s[s.RestWhole=58595]="RestWhole",s[s.RestHalf=58596]="RestHalf",s[s.RestQuarter=58597]="RestQuarter",s[s.RestEighth=58598]="RestEighth",s[s.RestSixteenth=58599]="RestSixteenth",s[s.RestThirtySecond=58600]="RestThirtySecond",s[s.RestSixtyFourth=58601]="RestSixtyFourth",s[s.RestOneHundredTwentyEighth=58602]="RestOneHundredTwentyEighth",s[s.RestTwoHundredFiftySixth=58603]="RestTwoHundredFiftySixth",s[s.Repeat1Bar=58624]="Repeat1Bar",s[s.Repeat2Bars=58625]="Repeat2Bars",s[s.Ottava=58640]="Ottava",s[s.OttavaAlta=58641]="OttavaAlta",s[s.OttavaBassaVb=58652]="OttavaBassaVb",s[s.Quindicesima=58644]="Quindicesima",s[s.QuindicesimaAlta=58645]="QuindicesimaAlta",s[s.DynamicPPP=58666]="DynamicPPP",s[s.DynamicPP=58667]="DynamicPP",s[s.DynamicPiano=58656]="DynamicPiano",s[s.DynamicMP=58668]="DynamicMP",s[s.DynamicMF=58669]="DynamicMF",s[s.DynamicForte=58658]="DynamicForte",s[s.DynamicFF=58671]="DynamicFF",s[s.DynamicFFF=58672]="DynamicFFF",s[s.OrnamentTrill=58726]="OrnamentTrill",s[s.StringsDownBow=58896]="StringsDownBow",s[s.StringsUpBow=58898]="StringsUpBow",s[s.PictEdgeOfCymbal=59177]="PictEdgeOfCymbal",s[s.GuitarString0=59443]="GuitarString0",s[s.GuitarString1=59444]="GuitarString1",s[s.GuitarString2=59445]="GuitarString2",s[s.GuitarString3=59446]="GuitarString3",s[s.GuitarString4=59447]="GuitarString4",s[s.GuitarString5=59448]="GuitarString5",s[s.GuitarString6=59449]="GuitarString6",s[s.GuitarString7=59450]="GuitarString7",s[s.GuitarString8=59451]="GuitarString8",s[s.GuitarString9=59452]="GuitarString9",s[s.GuitarGolpe=59458]="GuitarGolpe",s[s.FretboardX=59481]="FretboardX",s[s.FretboardO=59482]="FretboardO",s[s.WiggleTrill=60068]="WiggleTrill",s[s.WiggleVibratoMediumFast=60126]="WiggleVibratoMediumFast",s[s.OctaveBaselineM=60565]="OctaveBaselineM",s[s.OctaveBaselineB=60563]="OctaveBaselineB"})(f||(f={}));var Y;(function(s){s[s.Left=0]="Left",s[s.Center=1]="Center",s[s.Right=2]="Right"})(Y||(Y={}));var te;(function(s){s[s.Top=0]="Top",s[s.Middle=1]="Middle",s[s.Bottom=2]="Bottom"})(te||(te={}));class Bu{constructor(e,t){this.width=e,this.height=t}}class O{constructor(e="",t=0,i=0,r=f.None,n=f.None,a=f.None,o=f.None,l=te.Middle){this.elementType=e,this.outputMidiNumber=i,this.staffLine=t,this.noteHeadDefault=r,this.noteHeadHalf=n!==f.None?n:r,this.noteHeadWhole=a!==f.None?a:r,this.techniqueSymbol=o,this.techniqueSymbolPlacement=l}getSymbol(e){switch(e){case k.Whole:return this.noteHeadWhole;case k.Half:return this.noteHeadHalf;default:return this.noteHeadDefault}}}class nt{static articulationFromElementVariation(e,t){return e<nt.gp6ElementAndVariationToArticulation.length?(t>=nt.gp6ElementAndVariationToArticulation.length&&(t=0),nt.gp6ElementAndVariationToArticulation[e][t]):38}static getArticulation(e){const t=e.percussionArticulation,i=e.beat.voice.bar.staff.track.percussionArticulations;return t<i.length?i[t]:nt.getArticulationByValue(t)}static getElementAndVariation(e){const t=nt.getArticulation(e);if(!t)return[-1,-1];for(let i=0;i<nt.gp6ElementAndVariationToArticulation.length;i++){const r=nt.gp6ElementAndVariationToArticulation[i];for(let n=0;n<r.length;n++){const a=nt.getArticulationByValue(r[n]);if((a==null?void 0:a.outputMidiNumber)===t.outputMidiNumber)return[i,n]}}return[-1,-1]}static getArticulationByValue(e){return nt.instrumentArticulations.has(e)?nt.instrumentArticulations.get(e):null}}nt.gp6ElementAndVariationToArticulation=[[35,35,35],[38,91,37],[99,100,99],[56,100,56],[102,103,102],[43,43,43],[45,45,45],[47,47,47],[48,48,48],[50,50,50],[42,92,46],[44,44,44],[57,98,57],[49,97,49],[55,95,55],[51,93,127],[52,96,52]];nt.instrumentArticulations=new Map([[38,new O("snare",3,38,f.NoteheadBlack,f.NoteheadHalf,f.NoteheadWhole)],[37,new O("snare",3,37,f.NoteheadXBlack,f.NoteheadXBlack,f.NoteheadXBlack)],[91,new O("snare",3,38,f.NoteheadDiamondWhite,f.NoteheadDiamondWhite,f.NoteheadDiamondWhite)],[42,new O("hiHat",-1,42,f.NoteheadXBlack,f.NoteheadXBlack,f.NoteheadXBlack)],[92,new O("hiHat",-1,46,f.NoteheadCircleSlash,f.NoteheadCircleSlash,f.NoteheadCircleSlash)],[46,new O("hiHat",-1,46,f.NoteheadCircleX,f.NoteheadCircleX,f.NoteheadCircleX)],[44,new O("hiHat",9,44,f.NoteheadXBlack,f.NoteheadXBlack,f.NoteheadXBlack)],[35,new O("kickDrum",8,35,f.NoteheadBlack,f.NoteheadHalf,f.NoteheadWhole)],[36,new O("kickDrum",7,36,f.NoteheadBlack,f.NoteheadHalf,f.NoteheadWhole)],[50,new O("tom",1,50,f.NoteheadBlack,f.NoteheadHalf,f.NoteheadWhole)],[48,new O("tom",2,48,f.NoteheadBlack,f.NoteheadHalf,f.NoteheadWhole)],[47,new O("tom",4,47,f.NoteheadBlack,f.NoteheadHalf,f.NoteheadWhole)],[45,new O("tom",5,45,f.NoteheadBlack,f.NoteheadHalf,f.NoteheadWhole)],[43,new O("tom",6,43,f.NoteheadBlack,f.NoteheadHalf,f.NoteheadWhole)],[93,new O("ride",0,51,f.NoteheadXBlack,f.NoteheadXBlack,f.NoteheadXBlack,f.PictEdgeOfCymbal,te.Bottom)],[51,new O("ride",0,51,f.NoteheadXBlack,f.NoteheadXBlack,f.NoteheadXBlack)],[53,new O("ride",0,53,f.NoteheadDiamondWhite,f.NoteheadDiamondWhite,f.NoteheadDiamondWhite)],[94,new O("ride",0,51,f.NoteheadXBlack,f.NoteheadXBlack,f.NoteheadXBlack,f.ArticStaccatoAbove,te.Top)],[55,new O("splash",-2,55,f.NoteheadXBlack,f.NoteheadXBlack,f.NoteheadXBlack)],[95,new O("splash",-2,55,f.NoteheadXBlack,f.NoteheadXBlack,f.NoteheadXBlack,f.ArticStaccatoAbove,te.Bottom)],[52,new O("china",-3,52,f.NoteheadHeavyXHat,f.NoteheadHeavyXHat,f.NoteheadHeavyXHat)],[96,new O("china",-3,52,f.NoteheadHeavyXHat,f.NoteheadHeavyXHat,f.NoteheadHeavyXHat)],[49,new O("crash",-2,49,f.NoteheadHeavyX,f.NoteheadHeavyX,f.NoteheadHeavyX)],[97,new O("crash",-2,49,f.NoteheadHeavyX,f.NoteheadHeavyX,f.NoteheadHeavyX,f.ArticStaccatoAbove,te.Bottom)],[57,new O("crash",-1,57,f.NoteheadHeavyX,f.NoteheadHeavyX,f.NoteheadHeavyX)],[98,new O("crash",-1,57,f.NoteheadHeavyX,f.NoteheadHeavyX,f.NoteheadHeavyX,f.ArticStaccatoAbove,te.Bottom)],[99,new O("cowbell",1,56,f.NoteheadTriangleUpBlack,f.NoteheadTriangleUpHalf,f.NoteheadTriangleUpWhole)],[100,new O("cowbell",1,56,f.NoteheadXBlack,f.NoteheadXHalf,f.NoteheadXWhole)],[56,new O("cowbell",0,56,f.NoteheadTriangleUpBlack,f.NoteheadTriangleUpHalf,f.NoteheadTriangleUpWhole)],[101,new O("cowbell",0,56,f.NoteheadXBlack,f.NoteheadXHalf,f.NoteheadXWhole)],[102,new O("cowbell",-1,56,f.NoteheadTriangleUpBlack,f.NoteheadTriangleUpHalf,f.NoteheadTriangleUpWhole)],[103,new O("cowbell",-1,56,f.NoteheadXBlack,f.NoteheadXHalf,f.NoteheadXWhole)],[77,new O("woodblock",-9,77,f.NoteheadTriangleUpBlack,f.NoteheadTriangleUpBlack,f.NoteheadTriangleUpBlack)],[76,new O("woodblock",-10,76,f.NoteheadTriangleUpBlack,f.NoteheadTriangleUpBlack,f.NoteheadTriangleUpBlack)],[60,new O("bongo",-4,60,f.NoteheadBlack,f.NoteheadHalf,f.NoteheadWhole)],[104,new O("bongo",-5,60,f.NoteheadBlack,f.NoteheadHalf,f.NoteheadWhole,f.NoteheadParenthesis,te.Middle)],[105,new O("bongo",-6,60,f.NoteheadXBlack,f.NoteheadXBlack,f.NoteheadXBlack)],[61,new O("bongo",-7,61,f.NoteheadBlack,f.NoteheadHalf,f.NoteheadWhole)],[106,new O("bongo",-8,61,f.NoteheadBlack,f.NoteheadHalf,f.NoteheadWhole,f.NoteheadParenthesis,te.Middle)],[107,new O("bongo",-16,61,f.NoteheadXBlack,f.NoteheadXBlack,f.NoteheadXBlack)],[66,new O("timbale",10,66,f.NoteheadBlack,f.NoteheadHalf,f.NoteheadWhole)],[65,new O("timbale",9,65,f.NoteheadBlack,f.NoteheadHalf,f.NoteheadWhole)],[68,new O("agogo",12,68,f.NoteheadBlack,f.NoteheadHalf,f.NoteheadWhole)],[67,new O("agogo",11,67,f.NoteheadBlack,f.NoteheadHalf,f.NoteheadWhole)],[64,new O("conga",17,64,f.NoteheadBlack,f.NoteheadHalf,f.NoteheadWhole)],[108,new O("conga",16,64,f.NoteheadXBlack,f.NoteheadXBlack,f.NoteheadXBlack)],[109,new O("conga",15,64,f.NoteheadBlack,f.NoteheadHalf,f.NoteheadWhole,f.NoteheadParenthesis,te.Middle)],[63,new O("conga",14,63,f.NoteheadBlack,f.NoteheadHalf,f.NoteheadWhole)],[110,new O("conga",13,63,f.NoteheadXBlack,f.NoteheadXBlack,f.NoteheadXBlack)],[62,new O("conga",19,62,f.NoteheadBlack,f.NoteheadHalf,f.NoteheadWhole,f.NoteheadParenthesis,te.Middle)],[72,new O("whistle",-11,72,f.NoteheadBlack,f.NoteheadHalf,f.NoteheadWhole)],[71,new O("whistle",-17,71,f.NoteheadBlack,f.NoteheadHalf,f.NoteheadWhole)],[73,new O("guiro",38,73,f.NoteheadBlack,f.NoteheadHalf,f.NoteheadWhole)],[74,new O("guiro",37,74,f.NoteheadBlack,f.NoteheadHalf,f.NoteheadWhole)],[86,new O("surdo",36,86,f.NoteheadBlack,f.NoteheadHalf,f.NoteheadWhole)],[87,new O("surdo",35,87,f.NoteheadXBlack,f.NoteheadXBlack,f.NoteheadXBlack,f.NoteheadParenthesis,te.Middle)],[54,new O("tambourine",3,54,f.NoteheadTriangleUpBlack,f.NoteheadTriangleUpBlack,f.NoteheadTriangleUpBlack)],[111,new O("tambourine",2,54,f.NoteheadTriangleUpBlack,f.NoteheadTriangleUpBlack,f.NoteheadTriangleUpBlack,f.StringsUpBow,te.Bottom)],[112,new O("tambourine",1,54,f.NoteheadTriangleUpBlack,f.NoteheadTriangleUpBlack,f.NoteheadTriangleUpBlack,f.StringsDownBow,te.Bottom)],[113,new O("tambourine",-7,54,f.NoteheadXBlack,f.NoteheadXBlack,f.NoteheadXBlack)],[79,new O("cuica",30,79,f.NoteheadBlack,f.NoteheadHalf,f.NoteheadWhole)],[78,new O("cuica",29,78,f.NoteheadXBlack,f.NoteheadXBlack,f.NoteheadXBlack)],[58,new O("vibraslap",28,58,f.NoteheadBlack,f.NoteheadHalf,f.NoteheadWhole)],[81,new O("triangle",27,81,f.NoteheadBlack,f.NoteheadHalf,f.NoteheadWhole)],[80,new O("triangle",26,80,f.NoteheadXBlack,f.NoteheadXBlack,f.NoteheadXBlack,f.NoteheadParenthesis,te.Middle)],[114,new O("grancassa",25,43,f.NoteheadBlack,f.NoteheadHalf,f.NoteheadWhole)],[115,new O("piatti",18,49,f.NoteheadBlack,f.NoteheadHalf,f.NoteheadWhole)],[116,new O("piatti",24,49,f.NoteheadXBlack,f.NoteheadXBlack,f.NoteheadXBlack)],[69,new O("cabasa",23,69,f.NoteheadBlack,f.NoteheadHalf,f.NoteheadWhole)],[117,new O("cabasa",22,69,f.NoteheadBlack,f.NoteheadHalf,f.NoteheadWhole,f.StringsUpBow,te.Bottom)],[85,new O("castanets",21,85,f.NoteheadBlack,f.NoteheadHalf,f.NoteheadWhole)],[75,new O("claves",20,75,f.NoteheadBlack,f.NoteheadHalf,f.NoteheadWhole)],[70,new O("maraca",-12,70,f.NoteheadBlack,f.NoteheadHalf,f.NoteheadWhole)],[118,new O("maraca",-13,70,f.NoteheadBlack,f.NoteheadHalf,f.NoteheadWhole,f.StringsUpBow,te.Bottom)],[119,new O("maraca",-14,70,f.NoteheadBlack,f.NoteheadHalf,f.NoteheadWhole)],[120,new O("maraca",-15,70,f.NoteheadBlack,f.NoteheadHalf,f.NoteheadWhole,f.StringsUpBow,te.Bottom)],[82,new O("shaker",-23,54,f.NoteheadBlack,f.NoteheadHalf,f.NoteheadWhole)],[122,new O("shaker",-24,54,f.NoteheadBlack,f.NoteheadHalf,f.NoteheadWhole,f.StringsUpBow,te.Bottom)],[84,new O("bellTree",-18,53,f.NoteheadBlack,f.NoteheadHalf,f.NoteheadWhole)],[123,new O("bellTree",-19,53,f.NoteheadBlack,f.NoteheadHalf,f.NoteheadWhole,f.StringsUpBow,te.Bottom)],[83,new O("jingleBell",-20,53,f.NoteheadBlack,f.NoteheadHalf,f.NoteheadWhole)],[124,new O("unpitched",-21,62,f.NoteheadNull,f.NoteheadNull,f.NoteheadNull,f.GuitarGolpe,te.Top)],[125,new O("unpitched",-22,62,f.NoteheadNull,f.NoteheadNull,f.NoteheadNull,f.GuitarGolpe,te.Bottom)],[39,new O("handClap",3,39,f.NoteheadBlack,f.NoteheadHalf,f.NoteheadWhole)],[40,new O("snare",3,40,f.NoteheadBlack,f.NoteheadHalf,f.NoteheadWhole)],[31,new O("snare",3,40,f.NoteheadSlashedBlack2,f.NoteheadSlashedBlack2,f.NoteheadSlashedBlack2)],[41,new O("tom",5,41,f.NoteheadBlack,f.NoteheadHalf,f.NoteheadWhole)],[59,new O("ride",2,59,f.NoteheadXBlack,f.NoteheadXBlack,f.NoteheadXBlack,f.PictEdgeOfCymbal,te.Bottom)],[126,new O("ride",2,59,f.NoteheadXBlack,f.NoteheadXBlack,f.NoteheadXBlack)],[127,new O("ride",2,59,f.NoteheadDiamondWhite,f.NoteheadDiamondWhite,f.NoteheadDiamondWhite)],[29,new O("ride",2,59,f.NoteheadXBlack,f.NoteheadXBlack,f.NoteheadXBlack,f.ArticStaccatoAbove,te.Top)],[30,new O("crash",-3,49,f.NoteheadXBlack,f.NoteheadXBlack,f.NoteheadXBlack)],[33,new O("snare",3,37,f.NoteheadXBlack,f.NoteheadXBlack,f.NoteheadXBlack)],[34,new O("snare",3,38,f.NoteheadBlack,f.NoteheadBlack,f.NoteheadBlack)]]);nt.instrumentArticulationNames=new Map([["Ride (choke)",29],["Cymbal (hit)",30],["Snare (side stick)",31],["Snare (side stick) 2",33],["Snare (hit)",34],["Kick (hit)",35],["Kick (hit) 2",36],["Snare (side stick) 3",37],["Snare (hit) 2",38],["Hand Clap (hit)",39],["Snare (hit) 3",40],["Low Floor Tom (hit)",41],["Hi-Hat (closed)",42],["Very Low Tom (hit)",43],["Pedal Hi-Hat (hit)",44],["Low Tom (hit)",45],["Hi-Hat (open)",46],["Mid Tom (hit)",47],["High Tom (hit)",48],["Crash high (hit)",49],["High Floor Tom (hit)",50],["Ride (middle)",51],["China (hit)",52],["Ride (bell)",53],["Tambourine (hit)",54],["Splash (hit)",55],["Cowbell medium (hit)",56],["Crash medium (hit)",57],["Vibraslap (hit)",58],["Ride (edge)",59],["Hand (hit)",60],["Hand (hit)",61],["Conga high (mute)",62],["Conga high (hit)",63],["Conga low (hit)",64],["Timbale high (hit)",65],["Timbale low (hit)",66],["Agogo high (hit)",67],["Agogo tow (hit)",68],["Cabasa (hit)",69],["Left Maraca (hit)",70],["Whistle high (hit)",71],["Whistle low (hit)",72],["Guiro (hit)",73],["Guiro (scrap-return)",74],["Claves (hit)",75],["Woodblock high (hit)",76],["Woodblock low (hit)",77],["Cuica (mute)",78],["Cuica (open)",79],["Triangle (rnute)",80],["Triangle (hit)",81],["Shaker (hit)",82],["Tinkle Bell (hat)",83],["Jingle Bell (hit)",83],["Bell Tree (hit)",84],["Castanets (hit)",85],["Surdo (hit)",86],["Surdo (mute)",87],["Snare (rim shot)",91],["Hi-Hat (half)",92],["Ride (edge) 2",93],["Ride (choke) 2",94],["Splash (choke)",95],["China (choke)",96],["Crash high (choke)",97],["Crash medium (choke)",98],["Cowbell low (hit)",99],["Cowbell low (tip)",100],["Cowbell medium (tip)",101],["Cowbell high (hit)",102],["Cowbell high (tip)",103],["Hand (mute)",104],["Hand (slap)",105],["Hand (mute) 2",106],["Hand (slap) 2",107],["Conga low (slap)",108],["Conga low (mute)",109],["Conga high (slap)",110],["Tambourine (return)",111],["Tambourine (roll)",112],["Tambourine (hand)",113],["Grancassa (hit)",114],["Piatti (hat)",115],["Piatti (hand)",116],["Cabasa (return)",117],["Left Maraca (return)",118],["Right Maraca (hit)",119],["Right Maraca (return)",120],["Shaker (return)",122],["Bell Tee (return)",123],["Golpe (thumb)",124],["Golpe (finger)",125],["Ride (middle) 2",126],["Ride (bell) 2",127]]);class Wn{constructor(){this.tieDestinationNoteId=-1,this.tieOriginNoteId=-1,this.slurDestinationNoteId=-1,this.slurOriginNoteId=-1,this.hammerPullDestinationNoteId=-1,this.hammerPullOriginNoteId=-1}}class je{constructor(){this.id=je.GlobalNoteId++,this.index=0,this.accentuated=et.None,this.bendType=G.None,this.bendStyle=Ee.Default,this.bendOrigin=null,this.isContinuedBend=!1,this.bendPoints=null,this.maxBendPoint=null,this.fret=-1,this.string=-1,this.showStringNumber=!1,this.octave=-1,this.tone=-1,this.percussionArticulation=-1,this.isVisible=!0,this.isLeftHandTapped=!1,this.isHammerPullOrigin=!1,this.hammerPullOrigin=null,this.hammerPullDestination=null,this.isSlurDestination=!1,this.slurOrigin=null,this.slurDestination=null,this.harmonicType=X.None,this.harmonicValue=0,this.isGhost=!1,this.isLetRing=!1,this.letRingDestination=null,this.isPalmMute=!1,this.palmMuteDestination=null,this.isDead=!1,this.isStaccato=!1,this.slideInType=vt.None,this.slideOutType=ne.None,this.slideTarget=null,this.slideOrigin=null,this.vibrato=Be.None,this.tieOrigin=null,this.tieDestination=null,this.isTieDestination=!1,this.leftHandFinger=oe.Unknown,this.rightHandFinger=oe.Unknown,this.isFingering=!1,this.trillValue=-1,this.trillSpeed=k.ThirtySecond,this.durationPercent=1,this.accidentalMode=ot.Default,this.dynamics=de.F,this.isEffectSlurOrigin=!1,this.hasEffectSlur=!1,this.effectSlurOrigin=null,this.effectSlurDestination=null,this._noteIdBag=null}get hasBend(){return this.bendPoints!==null&&this.bendType!==G.None}get isStringed(){return this.string>=0}get isPiano(){return!this.isStringed&&this.octave>=0&&this.tone>=0}get isPercussion(){return!this.isStringed&&this.percussionArticulation>=0}get element(){return this.isPercussion?nt.getElementAndVariation(this)[0]:-1}get variation(){return this.isPercussion?nt.getElementAndVariation(this)[1]:-1}get isHammerPullDestination(){return!!this.hammerPullOrigin}get isSlurOrigin(){return!!this.slurDestination}get isHarmonic(){return this.harmonicType!==X.None}get isTieOrigin(){return this.tieDestination!==null}get trillFret(){return this.trillValue-this.stringTuning}get isTrill(){return this.trillValue>=0}get isEffectSlurDestination(){return!!this.effectSlurOrigin}get stringTuning(){return this.beat.voice.bar.staff.capo+je.getStringTuning(this.beat.voice.bar.staff,this.string)}static getStringTuning(e,t){return e.tuning.length>0?e.tuning[e.tuning.length-(t-1)-1]:0}get realValue(){return this.calculateRealValue(!0,!0)}get realValueWithoutHarmonic(){return this.calculateRealValue(!0,!1)}calculateRealValue(e,t){const i=e?this.beat.voice.bar.staff.transpositionPitch:0;if(t){let r=this.calculateRealValue(e,!1);return this.isStringed&&(this.harmonicType===X.Natural?r=this.harmonicPitch+this.stringTuning-i:r+=this.harmonicPitch),r}else return this.isPercussion?this.percussionArticulation:this.isStringed?this.fret+this.stringTuning-i:this.isPiano?this.octave*12+this.tone-i:0}get harmonicPitch(){if(this.harmonicType===X.None||!this.isStringed)return 0;let e=this.harmonicValue;return Re.isAlmostEqualTo(e,2.4)?36:Re.isAlmostEqualTo(e,2.7)?34:e<3?0:e<=3.5?31:e<=4?28:e<=5?24:e<=6?34:e<=7?19:e<=8.5?36:e<=9?28:e<=10?34:e<=11?0:e<=12?12:e<14?0:e<=15?34:e<=16?28:e<=17?36:e<=18?0:e<=19?19:e<=21?0:e<=22?36:e<=24?24:0}get initialBendValue(){return this.hasBend?Math.floor(this.bendPoints[0].value/2):this.bendOrigin?Math.floor(this.bendOrigin.bendPoints[this.bendOrigin.bendPoints.length-1].value/2):this.isTieDestination&&this.tieOrigin.bendOrigin?Math.floor(this.tieOrigin.bendOrigin.bendPoints[this.tieOrigin.bendOrigin.bendPoints.length-1].value/2):this.beat.hasWhammyBar?Math.floor(this.beat.whammyBarPoints[0].value/2):this.beat.isContinuedWhammy?Math.floor(this.beat.previousBeat.whammyBarPoints[this.beat.previousBeat.whammyBarPoints.length-1].value/2):0}get displayValue(){return this.displayValueWithoutBend+this.initialBendValue}get displayValueWithoutBend(){let e=this.realValue;switch(this.harmonicType!==X.Natural&&this.harmonicType!==X.None&&(e-=this.harmonicPitch),this.beat.ottava){case Te._15ma:e-=24;break;case Te._8va:e-=12;break;case Te.Regular:break;case Te._8vb:e+=12;break;case Te._15mb:e+=24;break}switch(this.beat.voice.bar.clefOttava){case Te._15ma:e-=24;break;case Te._8va:e-=12;break;case Te.Regular:break;case Te._8vb:e+=12;break;case Te._15mb:e+=24;break}return e-this.beat.voice.bar.staff.displayTranspositionPitch}get hasQuarterToneOffset(){return this.hasBend?this.bendPoints[0].value%2!==0:this.bendOrigin?this.bendOrigin.bendPoints[this.bendOrigin.bendPoints.length-1].value%2!==0:this.beat.hasWhammyBar?this.beat.whammyBarPoints[0].value%2!==0:this.beat.isContinuedWhammy?this.beat.previousBeat.whammyBarPoints[this.beat.previousBeat.whammyBarPoints.length-1].value%2!==0:!1}addBendPoint(e){let t=this.bendPoints;t===null&&(t=[],this.bendPoints=t),t.push(e),(!this.maxBendPoint||e.value>this.maxBendPoint.value)&&(this.maxBendPoint=e),this.bendType===G.None&&(this.bendType=G.Custom)}finish(e,t=null){let i=new xw(()=>je.nextNoteOnSameLine(this)),r=e&&e.notation.notationMode===St.SongBook;if(this.isTieDestination&&(this.chain(t),r&&this.tieOrigin&&this.tieOrigin.isLetRing&&(this.isLetRing=!0)),this.isLetRing&&(!i.value||!i.value.isLetRing?this.letRingDestination=this:this.letRingDestination=i.value,r&&this.isTieDestination&&!this.tieOrigin.hasBend&&(this.isVisible=!1)),this.isPalmMute&&(!i.value||!i.value.isPalmMute?this.palmMuteDestination=this:this.palmMuteDestination=i.value),this.isHammerPullOrigin){let o=je.findHammerPullDestination(this);o?(this.hammerPullDestination=o,o.hammerPullOrigin=this):this.isHammerPullOrigin=!1}switch(this.slideOutType){case ne.Shift:case ne.Legato:this.slideTarget=i.value,this.slideTarget?this.slideTarget.slideOrigin=this:this.slideOutType=ne.None;break}let n=null;this.isHammerPullOrigin&&this.hammerPullDestination?n=this.hammerPullDestination:this.slideOutType===ne.Legato&&this.slideTarget&&(n=this.slideTarget),n&&(this.hasEffectSlur=!0,this.effectSlurOrigin&&this.beat.pickStroke===At.None?(this.effectSlurOrigin.effectSlurDestination=n,this.effectSlurOrigin.effectSlurDestination.effectSlurOrigin=this.effectSlurOrigin,this.effectSlurOrigin=null):(this.isEffectSlurOrigin=!0,this.effectSlurDestination=n,this.effectSlurDestination.effectSlurOrigin=this));const a=this.bendPoints;if(a!=null&&a.length>0&&this.bendType===G.Custom){let o=this.isTieDestination&&this.tieOrigin.hasBend;if(this.isContinuedBend=o,a.length===4){let l=a[0],h=a[1],u=a[2],c=a[3];h.value===u.value?c.value>l.value?h.value>c.value?this.bendType=G.BendRelease:!o&&l.value>0?(this.bendType=G.PrebendBend,a.splice(2,1),a.splice(1,1)):(this.bendType=G.Bend,a.splice(2,1),a.splice(1,1)):c.value<l.value?o?(this.bendType=G.Release,a.splice(2,1),a.splice(1,1)):(this.bendType=G.PrebendRelease,a.splice(2,1),a.splice(1,1)):h.value>l.value?this.bendType=G.BendRelease:l.value>0&&!o?(this.bendType=G.Prebend,a.splice(2,1),a.splice(1,1)):(this.bendType=G.Hold,a.splice(2,1),a.splice(1,1)):C.warning("Model","Unsupported bend type detected, fallback to custom",null)}else if(a.length===2){let l=a[0],h=a[1];h.value>l.value?!o&&l.value>0?this.bendType=G.PrebendBend:this.bendType=G.Bend:h.value<l.value?o?this.bendType=G.Release:this.bendType=G.PrebendRelease:l.value>0&&!o?this.bendType=G.Prebend:this.bendType=G.Hold}}else(a===null||a.length===0)&&(this.bendType=G.None);this.initialBendValue>0&&(this.accidentalMode=ot.Default)}static nextNoteOnSameLine(e){let t=e.beat.nextBeat;for(;t&&t.voice.bar.index<=e.beat.voice.bar.index+je.MaxOffsetForSameLineSearch;){let i=t.getNoteOnString(e.string);if(i)return i;t=t.nextBeat}return null}static findHammerPullDestination(e){let t=e.beat.nextBeat;for(;t&&t.voice.bar.index<=e.beat.voice.bar.index+je.MaxOffsetForSameLineSearch;){let i=t.getNoteOnString(e.string);if(i)return i;for(let r=e.string;r>0;r--)if(i=t.getNoteOnString(r),i){if(i.isLeftHandTapped)return i;break}for(let r=e.string;r<=e.beat.voice.bar.staff.tuning.length;r++)if(i=t.getNoteOnString(r),i){if(i.isLeftHandTapped)return i;break}t=t.nextBeat}return null}static findTieOrigin(e){let t=e.beat.previousBeat;for(;t&&t.voice.bar.index>=e.beat.voice.bar.index-je.MaxOffsetForSameLineSearch;){if(e.isStringed){let i=t.getNoteOnString(e.string);if(i)return i}else if(e.octave===-1&&e.tone===-1){if(e.index<t.notes.length)return t.notes[e.index]}else{let i=t.getNoteWithRealValue(e.realValue);if(i)return i}t=t.previousBeat}return null}chain(e=null){if(e!==null)if(this._noteIdBag!==null){let t;e.has(je.NoteIdLookupKey)?t=e.get(je.NoteIdLookupKey):(t=new Map,e.set(je.NoteIdLookupKey,t)),(this._noteIdBag.hammerPullDestinationNoteId!==-1||this._noteIdBag.tieDestinationNoteId!==-1||this._noteIdBag.slurDestinationNoteId!==-1)&&t.set(this.id,this),this._noteIdBag.hammerPullOriginNoteId!==-1&&(this.hammerPullOrigin=t.get(this._noteIdBag.hammerPullOriginNoteId),this.hammerPullOrigin.hammerPullDestination=this),this._noteIdBag.tieOriginNoteId!==-1&&(this.tieOrigin=t.get(this._noteIdBag.tieOriginNoteId),this.tieOrigin.tieDestination=this),this._noteIdBag.slurOriginNoteId!==-1&&(this.slurOrigin=t.get(this._noteIdBag.slurOriginNoteId),this.slurOrigin.slurDestination=this),this._noteIdBag=null}else{if(!this.isTieDestination&&this.tieOrigin===null)return;let t=this.tieOrigin??je.findTieOrigin(this);t?(t.tieDestination=this,this.tieOrigin=t,this.fret=t.fret,this.octave=t.octave,this.tone=t.tone,t.hasBend&&(this.bendOrigin=this.tieOrigin)):this.isTieDestination=!1}}toJson(e){this.tieDestination!==null&&e.set("tiedestinationnoteid",this.tieDestination.id),this.tieOrigin!==null&&e.set("tieoriginnoteid",this.tieOrigin.id),this.slurDestination!==null&&e.set("slurdestinationnoteid",this.slurDestination.id),this.slurOrigin!==null&&e.set("sluroriginnoteid",this.slurOrigin.id),this.hammerPullOrigin!==null&&e.set("hammerpulloriginnoteid",this.hammerPullOrigin.id),this.hammerPullDestination!==null&&e.set("hammerpulldestinationnoteid",this.hammerPullDestination.id)}setProperty(e,t){switch(e){case"tiedestinationnoteid":return this._noteIdBag==null&&(this._noteIdBag=new Wn),this._noteIdBag.tieDestinationNoteId=t,!0;case"tieoriginnoteid":return this._noteIdBag==null&&(this._noteIdBag=new Wn),this._noteIdBag.tieOriginNoteId=t,!0;case"slurdestinationnoteid":return this._noteIdBag==null&&(this._noteIdBag=new Wn),this._noteIdBag.slurDestinationNoteId=t,!0;case"sluroriginnoteid":return this._noteIdBag==null&&(this._noteIdBag=new Wn),this._noteIdBag.slurOriginNoteId=t,!0;case"hammerpulloriginnoteid":return this._noteIdBag==null&&(this._noteIdBag=new Wn),this._noteIdBag.hammerPullOriginNoteId=t,!0;case"hammerpulldestinationnoteid":return this._noteIdBag==null&&(this._noteIdBag=new Wn),this._noteIdBag.hammerPullDestinationNoteId=t,!0}return!1}}je.GlobalNoteId=0;je.MaxOffsetForSameLineSearch=3;je.NoteIdLookupKey="NoteIdLookup";class Lt{constructor(e){this._isEqualLengthTuplet=!0,this.totalDuration=0,this.beats=[],this.isFull=!1,this.voice=e}check(e){if(this.beats.length===0)return this.beats.push(e),this.totalDuration+=e.playbackDuration,!0;if(e.graceType!==$.None)return!0;if(e.voice!==this.voice||this.isFull||e.tupletNumerator!==this.beats[0].tupletNumerator||e.tupletDenominator!==this.beats[0].tupletDenominator)return!1;if(e.playbackDuration!==this.beats[0].playbackDuration&&(this._isEqualLengthTuplet=!1),this.beats.push(e),this.totalDuration+=e.playbackDuration,this._isEqualLengthTuplet)this.beats.length===this.beats[0].tupletNumerator&&(this.isFull=!0);else{let t=this.beats[0].tupletNumerator/this.beats[0].tupletDenominator|0;for(let i of Lt.AllTicks)if(this.totalDuration===i*t){this.isFull=!0;break}}return!0}}Lt.HalfTicks=1920;Lt.QuarterTicks=960;Lt.EighthTicks=480;Lt.SixteenthTicks=240;Lt.ThirtySecondTicks=120;Lt.SixtyFourthTicks=60;Lt.OneHundredTwentyEighthTicks=30;Lt.TwoHundredFiftySixthTicks=15;Lt.AllTicks=[Lt.HalfTicks,Lt.QuarterTicks,Lt.EighthTicks,Lt.SixteenthTicks,Lt.ThirtySecondTicks,Lt.SixtyFourthTicks,Lt.OneHundredTwentyEighthTicks,Lt.TwoHundredFiftySixthTicks];var xe;(function(s){s[s.None=0]="None",s[s.Custom=1]="Custom",s[s.Dive=2]="Dive",s[s.Dip=3]="Dip",s[s.Hold=4]="Hold",s[s.Predive=5]="Predive",s[s.PrediveDive=6]="PrediveDive"})(xe||(xe={}));class vw{static clone(e){const t=new A;return t.offset=e.offset,t.value=e.value,t}}class Tw{static clone(e){const t=new je;if(t.index=e.index,t.accentuated=e.accentuated,t.bendType=e.bendType,t.bendStyle=e.bendStyle,t.isContinuedBend=e.isContinuedBend,e.bendPoints){t.bendPoints=[];for(const i of e.bendPoints)t.addBendPoint(vw.clone(i))}return t.fret=e.fret,t.string=e.string,t.showStringNumber=e.showStringNumber,t.octave=e.octave,t.tone=e.tone,t.percussionArticulation=e.percussionArticulation,t.isVisible=e.isVisible,t.isLeftHandTapped=e.isLeftHandTapped,t.isHammerPullOrigin=e.isHammerPullOrigin,t.isSlurDestination=e.isSlurDestination,t.harmonicType=e.harmonicType,t.harmonicValue=e.harmonicValue,t.isGhost=e.isGhost,t.isLetRing=e.isLetRing,t.isPalmMute=e.isPalmMute,t.isDead=e.isDead,t.isStaccato=e.isStaccato,t.slideInType=e.slideInType,t.slideOutType=e.slideOutType,t.vibrato=e.vibrato,t.isTieDestination=e.isTieDestination,t.leftHandFinger=e.leftHandFinger,t.rightHandFinger=e.rightHandFinger,t.isFingering=e.isFingering,t.trillValue=e.trillValue,t.trillSpeed=e.trillSpeed,t.durationPercent=e.durationPercent,t.accidentalMode=e.accidentalMode,t.dynamics=e.dynamics,t}}class qx{static clone(e){const t=new Vt;return t.isLinear=e.isLinear,t.type=e.type,t.value=e.value,t.ratioPosition=e.ratioPosition,t.text=e.text,t}}class Zf{static clone(e){const t=new Wt;t.index=e.index,t.notes=[];for(const i of e.notes)t.addNote(Tw.clone(i));t.isEmpty=e.isEmpty,t.whammyStyle=e.whammyStyle,t.ottava=e.ottava,t.isLegatoOrigin=e.isLegatoOrigin,t.duration=e.duration,t.isLetRing=e.isLetRing,t.isPalmMute=e.isPalmMute,t.automations=[];for(const i of e.automations)t.automations.push(qx.clone(i));if(t.dots=e.dots,t.fadeIn=e.fadeIn,t.lyrics=e.lyrics?e.lyrics.slice():null,t.hasRasgueado=e.hasRasgueado,t.pop=e.pop,t.slap=e.slap,t.tap=e.tap,t.text=e.text,t.slashed=e.slashed,t.brushType=e.brushType,t.brushDuration=e.brushDuration,t.tupletDenominator=e.tupletDenominator,t.tupletNumerator=e.tupletNumerator,t.isContinuedWhammy=e.isContinuedWhammy,t.whammyBarType=e.whammyBarType,e.whammyBarPoints){t.whammyBarPoints=[];for(const i of e.whammyBarPoints)t.addWhammyBarPoint(vw.clone(i))}return t.vibrato=e.vibrato,t.chordId=e.chordId,t.graceType=e.graceType,t.pickStroke=e.pickStroke,t.tremoloSpeed=e.tremoloSpeed,t.crescendo=e.crescendo,t.displayStart=e.displayStart,t.playbackStart=e.playbackStart,t.displayDuration=e.displayDuration,t.playbackDuration=e.playbackDuration,t.dynamics=e.dynamics,t.invertBeamDirection=e.invertBeamDirection,t.preferredBeamDirection=e.preferredBeamDirection,t.isEffectSlurOrigin=e.isEffectSlurOrigin,t.beamingMode=e.beamingMode,t}}class Pd{constructor(){this.beats=[],this.id="empty",this.isComplete=!1}addBeat(e){e.graceIndex=this.beats.length,e.graceGroup=this,this.beats.push(e)}finish(){this.beats.length>0&&(this.id=this.beats[0].absoluteDisplayStart+"_"+this.beats[0].voice.index)}}var ks;(function(s){s[s.Auto=0]="Auto",s[s.ForceSplitToNext=1]="ForceSplitToNext",s[s.ForceMergeWithNext=2]="ForceMergeWithNext"})(ks||(ks={}));class Wt{constructor(){this.id=Wt._globalBeatId++,this.index=0,this.previousBeat=null,this.nextBeat=null,this.notes=[],this.noteStringLookup=new Map,this.noteValueLookup=new Map,this.isEmpty=!1,this.whammyStyle=Ee.Default,this.ottava=Te.Regular,this.fermata=null,this.isLegatoOrigin=!1,this.minNote=null,this.maxNote=null,this.maxStringNote=null,this.minStringNote=null,this.duration=k.Quarter,this.isLetRing=!1,this.isPalmMute=!1,this.automations=[],this.dots=0,this.fadeIn=!1,this.lyrics=null,this.hasRasgueado=!1,this.pop=!1,this.slap=!1,this.tap=!1,this.text=null,this.slashed=!1,this.brushType=Ve.None,this.brushDuration=0,this.tupletDenominator=-1,this.tupletNumerator=-1,this.tupletGroup=null,this.isContinuedWhammy=!1,this.whammyBarType=xe.None,this.whammyBarPoints=null,this.maxWhammyPoint=null,this.minWhammyPoint=null,this.vibrato=Be.None,this.chordId=null,this.graceType=$.None,this.graceGroup=null,this.graceIndex=-1,this.pickStroke=At.None,this.tremoloSpeed=null,this.crescendo=ki.None,this.displayStart=0,this.playbackStart=0,this.displayDuration=0,this.playbackDuration=0,this.dynamics=de.F,this.invertBeamDirection=!1,this.preferredBeamDirection=null,this.isEffectSlurOrigin=!1,this.effectSlurOrigin=null,this.effectSlurDestination=null,this.beamingMode=ks.Auto}get isLastOfVoice(){return this.index===this.voice.beats.length-1}get isLegatoDestination(){return!!this.previousBeat&&this.previousBeat.isLegatoOrigin}get isRest(){return this.isEmpty||this.notes.length===0}get isFullBarRest(){return this.isRest&&this.voice.beats.length===1&&this.duration===k.Whole}get hasTuplet(){return!(this.tupletDenominator===-1&&this.tupletNumerator===-1)&&!(this.tupletDenominator===1&&this.tupletNumerator===1)}get hasWhammyBar(){return this.whammyBarPoints!==null&&this.whammyBarType!==xe.None}get hasChord(){return!!this.chordId}get chord(){return this.chordId?this.voice.bar.staff.getChord(this.chordId):null}get isTremolo(){return!!this.tremoloSpeed}get absoluteDisplayStart(){return this.voice.bar.masterBar.start+this.displayStart}get absolutePlaybackStart(){return this.voice.bar.masterBar.start+this.playbackStart}get isEffectSlurDestination(){return!!this.effectSlurOrigin}addWhammyBarPoint(e){let t=this.whammyBarPoints;t===null&&(t=[],this.whammyBarPoints=t),t.push(e),(!this.maxWhammyPoint||e.value>this.maxWhammyPoint.value)&&(this.maxWhammyPoint=e),(!this.minWhammyPoint||e.value<this.minWhammyPoint.value)&&(this.minWhammyPoint=e),this.whammyBarType===xe.None&&(this.whammyBarType=xe.Custom)}removeWhammyBarPoint(e){const t=this.whammyBarPoints;if(t===null||e<0||e>=t.length)return;t.splice(e,1);let i=t[e];if(i===this.maxWhammyPoint){this.maxWhammyPoint=null;for(let r of t)(!this.maxWhammyPoint||r.value>this.maxWhammyPoint.value)&&(this.maxWhammyPoint=r)}if(i===this.minWhammyPoint){this.minWhammyPoint=null;for(let r of t)(!this.minWhammyPoint||r.value<this.minWhammyPoint.value)&&(this.minWhammyPoint=r)}}addNote(e){e.beat=this,e.index=this.notes.length,this.notes.push(e),e.isStringed&&this.noteStringLookup.set(e.string,e)}removeNote(e){let t=this.notes.indexOf(e);t>=0&&(this.notes.splice(t,1),e.isStringed&&this.noteStringLookup.delete(e.string))}getAutomation(e){for(let t=0,i=this.automations.length;t<i;t++){let r=this.automations[t];if(r.type===e)return r}return null}getNoteOnString(e){return this.noteStringLookup.has(e)?this.noteStringLookup.get(e):null}calculateDuration(){if(this.isFullBarRest)return this.voice.bar.masterBar.calculateDuration();let e=re.toTicks(this.duration);return this.dots===2?e=re.applyDot(e,!0):this.dots===1&&(e=re.applyDot(e,!1)),this.tupletDenominator>0&&this.tupletNumerator>=0&&(e=re.applyTuplet(e,this.tupletNumerator,this.tupletDenominator)),e}updateDurations(){let e=this.calculateDuration();switch(this.playbackDuration=e,this.graceType){case $.BeforeBeat:case $.OnBeat:switch(this.duration){case k.Sixteenth:this.playbackDuration=re.toTicks(k.SixtyFourth);break;case k.ThirtySecond:this.playbackDuration=re.toTicks(k.OneHundredTwentyEighth);break;default:this.playbackDuration=re.toTicks(k.ThirtySecond);break}this.displayDuration=0;break;case $.BendGrace:this.playbackDuration/=2,this.displayDuration=0;break;default:this.displayDuration=e;let t=this.previousBeat;t&&t.graceType===$.BendGrace&&(this.playbackDuration=t.playbackDuration);break}}finishTuplet(){let e=this.previousBeat,t=e?e.tupletGroup:null;if((this.hasTuplet||this.graceType!==$.None&&t)&&((!e||!t||!t.check(this))&&(t=new Lt(this.voice),t.check(this)),this.tupletGroup=t),this.index>0){const i=this.voice.bar.masterBar.calculateDuration(),r=[];for(const n of this.automations)n.ratioPosition===0&&(n.ratioPosition=this.playbackStart/i),n.type!==gt.Volume&&r.push(n);this.automations=r}}finish(e,t=null){switch(this.getAutomation(gt.Instrument)===null&&this.index===0&&this.voice.index===0&&this.voice.bar.index===0&&this.voice.bar.staff.index===0&&this.automations.push(Vt.buildInstrumentAutomation(!1,0,this.voice.bar.staff.track.playbackInfo.program)),this.graceType){case $.OnBeat:case $.BeforeBeat:let h=this.graceGroup.beats.length;h===1?this.duration=k.Eighth:h===2?this.duration=k.Sixteenth:this.duration=k.ThirtySecond;break}let i=e?e.notation.notationMode:St.GuitarPro,r=this.text==="grad"||this.text==="grad.";r&&i===St.SongBook&&(this.text="");let n=!1;this.minNote=null,this.maxNote=null,this.minStringNote=null,this.maxStringNote=null;let a=0,o=!1;for(let h=0,u=this.notes.length;h<u;h++){let c=this.notes[h];if(c.dynamics=this.dynamics,c.finish(e,t),c.isLetRing&&(this.isLetRing=!0),c.isPalmMute&&(this.isPalmMute=!0),i===St.SongBook&&c.hasBend&&this.graceType!==$.BendGrace){if(!c.isTieOrigin)switch(c.bendType){case G.Bend:case G.PrebendRelease:case G.PrebendBend:n=!0;break}r||c.bendStyle===Ee.Gradual?(r=!0,c.bendStyle=Ee.Gradual,n=!1):c.bendStyle=Ee.Fast}c.isVisible&&(a++,(!this.minNote||c.realValue<this.minNote.realValue)&&(this.minNote=c),(!this.maxNote||c.realValue>this.maxNote.realValue)&&(this.maxNote=c),(!this.minStringNote||c.string<this.minStringNote.string)&&(this.minStringNote=c),(!this.maxStringNote||c.string>this.maxStringNote.string)&&(this.maxStringNote=c),c.hasEffectSlur&&(o=!0))}if(o&&(this.effectSlurOrigin?(this.effectSlurOrigin.effectSlurDestination=this.nextBeat,this.effectSlurOrigin.effectSlurDestination&&(this.effectSlurOrigin.effectSlurDestination.effectSlurOrigin=this.effectSlurOrigin),this.effectSlurOrigin=null):(this.isEffectSlurOrigin=!0,this.effectSlurDestination=this.nextBeat,this.effectSlurDestination&&(this.effectSlurDestination.effectSlurOrigin=this))),this.notes.length>0&&a===0&&(this.isEmpty=!0),!this.isRest&&(!this.isLetRing||!this.isPalmMute)){let h=this.previousBeat;for(;h&&h.isRest;)this.isLetRing||(h.isLetRing=!1),this.isPalmMute||(h.isPalmMute=!1),h=h.previousBeat}else this.isRest&&this.previousBeat&&e&&e.notation.notationMode===St.GuitarPro&&(this.previousBeat.isLetRing&&(this.isLetRing=!0),this.previousBeat.isPalmMute&&(this.isPalmMute=!0));const l=this.whammyBarPoints;if(l!==null&&l.length>0&&this.whammyBarType===xe.Custom){i===St.SongBook&&(this.whammyStyle=r?Ee.Gradual:Ee.Fast);let h=!!this.previousBeat&&this.previousBeat.hasWhammyBar;if(this.isContinuedWhammy=h,l.length===4){let u=l[0],c=l[1],d=l[2],p=l[3];c.value===d.value&&(u.value<c.value&&c.value<p.value||u.value>c.value&&c.value>p.value?(u.value!==0&&!h?this.whammyBarType=xe.PrediveDive:this.whammyBarType=xe.Dive,l.splice(2,1),l.splice(1,1)):u.value>c.value&&c.value<p.value||u.value<c.value&&c.value>p.value?(this.whammyBarType=xe.Dip,(c.offset===d.offset||i===St.SongBook)&&l.splice(2,1)):u.value===c.value&&c.value===p.value&&(u.value!==0&&!h?this.whammyBarType=xe.Predive:this.whammyBarType=xe.Hold,l.splice(2,1),l.splice(1,1)))}}if(this.updateDurations(),n){let h=Zf.clone(this);h.id=Wt._globalBeatId++,h.pickStroke=At.None;for(let u=0,c=h.notes.length;u<c;u++){let d=h.notes[u],p=this.notes[u];if(d.bendType=G.None,d.maxBendPoint=null,d.bendPoints=null,d.bendStyle=Ee.Default,d.id=je.GlobalNoteId++,p.isTieOrigin&&(d.tieDestination=p.tieDestination,p.tieDestination.tieOrigin=d),p.isTieDestination&&(d.tieOrigin=p.tieOrigin?p.tieOrigin:null,p.tieOrigin.tieDestination=d),p.hasBend&&p.isTieOrigin){let g=je.findTieOrigin(p);if(g&&g.hasBend){d.bendType=G.Hold;let w=p.bendPoints[p.bendPoints.length-1];d.addBendPoint(new A(0,w.value)),d.addBendPoint(new A(A.MaxPosition,w.value))}}d.isTieDestination=!0}this.graceType=$.BendGrace,this.graceGroup=new Pd,this.graceGroup.addBeat(this),this.graceGroup.isComplete=!0,this.graceGroup.finish(),this.updateDurations(),this.voice.insertBeat(this,h),h.graceGroup=new Pd,h.graceGroup.addBeat(this),h.graceGroup.isComplete=!0,h.graceGroup.finish()}}isBefore(e){return this.voice.bar.index<e.voice.bar.index||e.voice.bar.index===this.voice.bar.index&&this.index<e.index}isAfter(e){return this.voice.bar.index>e.voice.bar.index||e.voice.bar.index===this.voice.bar.index&&this.index>e.index}hasNoteOnString(e){return this.noteStringLookup.has(e)}getNoteWithRealValue(e){return this.noteValueLookup.has(e)?this.noteValueLookup.get(e):null}chain(e=null){for(const t of this.notes)this.noteValueLookup.set(t.realValue,t),t.chain(e)}}Wt._globalBeatId=0;class $r{constructor(){this.name="",this.firstFret=1,this.strings=[],this.barreFrets=[],this.showName=!0,this.showDiagram=!0,this.showFingering=!0}get uniqueId(){return[this.name,this.firstFret.toString(),this.strings.join(","),this.barreFrets.join(","),this.showDiagram.toString(),this.showFingering.toString(),this.showName.toString()].join("|")}}var fe;(function(s){s[s.Cb=-7]="Cb",s[s.Gb=-6]="Gb",s[s.Db=-5]="Db",s[s.Ab=-4]="Ab",s[s.Eb=-3]="Eb",s[s.Bb=-2]="Bb",s[s.F=-1]="F",s[s.C=0]="C",s[s.G=1]="G",s[s.D=2]="D",s[s.A=3]="A",s[s.E=4]="E",s[s.B=5]="B",s[s.FSharp=6]="FSharp",s[s.CSharp=7]="CSharp"})(fe||(fe={}));var Gt;(function(s){s[s.IgnoreSpaces=0]="IgnoreSpaces",s[s.Begin=1]="Begin",s[s.Text=2]="Text",s[s.Comment=3]="Comment",s[s.Dash=4]="Dash"})(Gt||(Gt={}));class ct{constructor(){this.startBar=0,this.text=""}finish(e=!1){this.chunks=[],this.parse(this.text,0,this.chunks,e)}parse(e,t,i,r){if(!e)return;let n=Gt.Begin,a=Gt.Begin,o=!1,l=0;for(;t<e.length;){let h=e.charCodeAt(t);switch(n){case Gt.IgnoreSpaces:switch(h){case ct.CharCodeLF:case ct.CharCodeCR:case ct.CharCodeTab:break;case ct.CharCodeSpace:if(!o){n=a;continue}break;default:o=!1,n=a;continue}break;case Gt.Begin:switch(h){case ct.CharCodeBrackedOpen:n=Gt.Comment;break;default:l=t,n=Gt.Text;continue}break;case Gt.Comment:switch(h){case ct.CharCodeBrackedClose:n=Gt.Begin;break}break;case Gt.Text:switch(h){case ct.CharCodeDash:n=Gt.Dash;break;case ct.CharCodeCR:case ct.CharCodeLF:case ct.CharCodeSpace:let u=e.substr(l,t-l);this.addChunk(u,r),n=Gt.IgnoreSpaces,a=Gt.Begin;break}break;case Gt.Dash:switch(h){case ct.CharCodeDash:break;default:let u=e.substr(l,t-l);this.addChunk(u,r),o=!0,n=Gt.IgnoreSpaces,a=Gt.Begin;continue}break}t+=1}n===Gt.Text&&t!==l&&this.addChunk(e.substr(l,t-l),r)}addChunk(e,t){e=this.prepareChunk(e),(!t||e.length>0&&e!=="-")&&this.chunks.push(e)}prepareChunk(e){let t=e.split("+").join(" "),i=t.length;for(;i>0&&t.charAt(i-1)==="_";)i--;return i!==t.length?t.substr(0,i):t}}ct.CharCodeLF=10;ct.CharCodeTab=9;ct.CharCodeCR=13;ct.CharCodeSpace=32;ct.CharCodeBrackedClose=93;ct.CharCodeBrackedOpen=91;ct.CharCodeDash=45;var Es;(function(s){s[s.Major=0]="Major",s[s.Minor=1]="Minor"})(Es||(Es={}));var ce;(function(s){s[s.NoTripletFeel=0]="NoTripletFeel",s[s.Triplet16th=1]="Triplet16th",s[s.Triplet8th=2]="Triplet8th",s[s.Dotted16th=3]="Dotted16th",s[s.Dotted8th=4]="Dotted8th",s[s.Scottish16th=5]="Scottish16th",s[s.Scottish8th=6]="Scottish8th"})(ce||(ce={}));class mr{constructor(){this.alternateEndings=0,this.nextMasterBar=null,this.previousMasterBar=null,this.index=0,this.keySignature=fe.C,this.keySignatureType=Es.Major,this.isDoubleBar=!1,this.isRepeatStart=!1,this.repeatCount=0,this.timeSignatureNumerator=4,this.timeSignatureDenominator=4,this.timeSignatureCommon=!1,this.isFreeTime=!1,this.tripletFeel=ce.NoTripletFeel,this.section=null,this.tempoAutomations=[],this.fermata=null,this.start=0,this.isAnacrusis=!1,this.displayScale=1,this.displayWidth=-1}get isRepeatEnd(){return this.repeatCount>0}get isSectionStart(){return!!this.section}get tempoAutomation(){return this.tempoAutomations.length>0?this.tempoAutomations[0]:null}calculateDuration(e=!0){if(this.isAnacrusis&&e){let t=0;for(let i of this.score.tracks)for(let r of i.staves){let n=this.index<r.bars.length?r.bars[this.index].calculateDuration():0;n>t&&(t=n)}return t}return this.timeSignatureNumerator*re.valueToTicks(this.timeSignatureDenominator)}addFermata(e,t){let i=this.fermata;i===null&&(i=new Map,this.fermata=i),i.set(e,t)}getFermata(e){const t=this.fermata;return t===null?null:t.has(e.playbackStart)?t.get(e.playbackStart):null}}mr.MaxAlternateEndings=8;class Kx{constructor(){this.hideDynamics=!1}}class mm{constructor(){this.masterBars=[],this.opening=null,this.closings=[],this.isClosed=!1}get openings(){const e=this.opening;return e?[e]:[]}get isOpened(){var e;return((e=this.opening)==null?void 0:e.isRepeatStart)===!0}addMasterBar(e){this.opening===null&&(this.opening=e),this.masterBars.push(e),e.repeatGroup=this,e.isRepeatEnd&&(this.closings.push(e),this.isClosed=!0)}}let Rn=class{constructor(){this._currentRepeatGroup=null,this._openedRepeatGroups=[],this._properlyOpenedRepeatGroups=0,this.album="",this.artist="",this.copyright="",this.instructions="",this.music="",this.notices="",this.subTitle="",this.title="",this.words="",this.tab="",this.tempo=120,this.tempoLabel="",this.masterBars=[],this.tracks=[],this.defaultSystemsLayout=3,this.systemsLayout=[],this.stylesheet=new Kx}rebuildRepeatGroups(){this._currentRepeatGroup=null,this._openedRepeatGroups=[],this._properlyOpenedRepeatGroups=0;for(const e of this.masterBars)this.addMasterBarToRepeatGroups(e)}addMasterBar(e){e.score=this,e.index=this.masterBars.length,this.masterBars.length!==0&&(e.previousMasterBar=this.masterBars[this.masterBars.length-1],e.previousMasterBar.nextMasterBar=e,e.start=e.previousMasterBar.start+(e.previousMasterBar.isAnacrusis?0:e.previousMasterBar.calculateDuration())),this.addMasterBarToRepeatGroups(e),this.masterBars.push(e)}addMasterBarToRepeatGroups(e){var t;e.isRepeatStart?((t=this._currentRepeatGroup)!=null&&t.isClosed&&(this._openedRepeatGroups.pop(),this._properlyOpenedRepeatGroups--),this._currentRepeatGroup=new mm,this._openedRepeatGroups.push(this._currentRepeatGroup),this._properlyOpenedRepeatGroups++):this._currentRepeatGroup||(this._currentRepeatGroup=new mm,this._openedRepeatGroups.push(this._currentRepeatGroup)),this._currentRepeatGroup.addMasterBar(e),e.isRepeatEnd&&this._properlyOpenedRepeatGroups>1&&(this._openedRepeatGroups.pop(),this._properlyOpenedRepeatGroups--,this._currentRepeatGroup=this._openedRepeatGroups.length>0?this._openedRepeatGroups[this._openedRepeatGroups.length-1]:null)}addTrack(e){e.score=this,e.index=this.tracks.length,this.tracks.push(e)}finish(e){const t=new Map;for(let i=0,r=this.tracks.length;i<r;i++)this.tracks[i].finish(e,t)}};class xu{constructor(){this.marker="",this.text=""}}class ut extends Pt{constructor(e){super(Nt.Format,e),Object.setPrototypeOf(this,ut.prototype)}}class Ce{constructor(e,t,i,r=255){this.raw=0,this.raw=(r&255)<<24|(e&255)<<16|(t&255)<<8|i&255,this.updateRgba()}updateRgba(){this.a===255?this.rgba="#"+Re.toHexString(this.r,2)+Re.toHexString(this.g,2)+Re.toHexString(this.b,2):this.rgba=`rgba(${this.r},${this.g},${this.b},${this.a/255})`}get a(){return this.raw>>24&255}get r(){return this.raw>>16&255}get g(){return this.raw>>8&255}get b(){return this.raw&255}static random(e=100){return new Ce(Math.random()*255|0,Math.random()*255|0,Math.random()*255|0,e)}static fromJson(e){if(e instanceof Ce)return e;switch(typeof e){case"number":{const t=new Ce(0,0,0,0);return t.raw=e,t.updateRgba(),t}case"string":{const t=e;if(t.startsWith("#")){if(t.length===4)return new Ce(parseInt(t[1],16)*17,parseInt(t[2],16)*17,parseInt(t[3],16)*17);if(t.length===5)return new Ce(parseInt(t[1],16)*17,parseInt(t[2],16)*17,parseInt(t[3],16)*17,parseInt(t[4],16)*17);if(t.length===7)return new Ce(parseInt(t.substring(1,3),16),parseInt(t.substring(3,5),16),parseInt(t.substring(5,7),16));if(t.length===9)return new Ce(parseInt(t.substring(1,3),16),parseInt(t.substring(3,5),16),parseInt(t.substring(5,7),16),parseInt(t.substring(7,9),16))}else if(t.startsWith("rgba")||t.startsWith("rgb")){const i=t.indexOf("("),r=t.lastIndexOf(")");if(i===-1||r===-1)throw new ut("No values specified for rgb/rgba function");const n=t.substring(i+1,r).split(",");if(n.length===3)return new Ce(parseInt(n[0]),parseInt(n[1]),parseInt(n[2]));if(n.length===4)return new Ce(parseInt(n[0]),parseInt(n[1]),parseInt(n[2]),parseFloat(n[3])*255)}return null}}throw new ut("Unsupported format for color")}static toJson(e){return e.raw}}Ce.BlackRgb="#000000";class Nw{constructor(){this.volume=15,this.balance=8,this.port=1,this.program=0,this.primaryChannel=0,this.secondaryChannel=0,this.isMute=!1,this.isSolo=!1}}class R{static getTextForTuning(e,t){let i=R.getTextPartsForTuning(e);return t?i.join(""):i[0]}static getTextPartsForTuning(e,t=-1){let i=e/12|0,r=e%12;return[["C","Db","D","Eb","E","F","Gb","G","Ab","A","Bb","B"][r],(i+t).toString()]}static getDefaultTuningFor(e){return R._defaultTunings.has(e)?R._defaultTunings.get(e):null}static getPresetsFor(e){switch(e){case 7:return R._sevenStrings;case 6:return R._sixStrings;case 5:return R._fiveStrings;case 4:return R._fourStrings}return[]}static initialize(){R._defaultTunings.set(7,new R("Guitar 7 strings",[64,59,55,50,45,40,35],!0)),R._sevenStrings.push(R._defaultTunings.get(7)),R._defaultTunings.set(6,new R("Guitar Standard Tuning",[64,59,55,50,45,40],!0)),R._sixStrings.push(R._defaultTunings.get(6)),R._sixStrings.push(new R("Guitar Tune down ½ step",[63,58,54,49,44,39],!1)),R._sixStrings.push(new R("Guitar Tune down 1 step",[62,57,53,48,43,38],!1)),R._sixStrings.push(new R("Guitar Tune down 2 step",[60,55,51,46,41,36],!1)),R._sixStrings.push(new R("Guitar Dropped D Tuning",[64,59,55,50,45,38],!1)),R._sixStrings.push(new R("Guitar Dropped D Tuning variant",[64,57,55,50,45,38],!1)),R._sixStrings.push(new R("Guitar Double Dropped D Tuning",[62,59,55,50,45,38],!1)),R._sixStrings.push(new R("Guitar Dropped E Tuning",[66,61,57,52,47,40],!1)),R._sixStrings.push(new R("Guitar Dropped C Tuning",[62,57,53,48,43,36],!1)),R._sixStrings.push(new R("Guitar Open C Tuning",[64,60,55,48,43,36],!1)),R._sixStrings.push(new R("Guitar Open Cm Tuning",[63,60,55,48,43,36],!1)),R._sixStrings.push(new R("Guitar Open C6 Tuning",[64,57,55,48,43,36],!1)),R._sixStrings.push(new R("Guitar Open Cmaj7 Tuning",[64,59,55,52,43,36],!1)),R._sixStrings.push(new R("Guitar Open D Tuning",[62,57,54,50,45,38],!1)),R._sixStrings.push(new R("Guitar Open Dm Tuning",[62,57,53,50,45,38],!1)),R._sixStrings.push(new R("Guitar Open D5 Tuning",[62,57,50,50,45,38],!1)),R._sixStrings.push(new R("Guitar Open D6 Tuning",[62,59,54,50,45,38],!1)),R._sixStrings.push(new R("Guitar Open Dsus4 Tuning",[62,57,55,50,45,38],!1)),R._sixStrings.push(new R("Guitar Open E Tuning",[64,59,56,52,47,40],!1)),R._sixStrings.push(new R("Guitar Open Em Tuning",[64,59,55,52,47,40],!1)),R._sixStrings.push(new R("Guitar Open Esus11 Tuning",[64,59,55,52,45,40],!1)),R._sixStrings.push(new R("Guitar Open F Tuning",[65,60,53,48,45,41],!1)),R._sixStrings.push(new R("Guitar Open G Tuning",[62,59,55,50,43,38],!1)),R._sixStrings.push(new R("Guitar Open Gm Tuning",[62,58,55,50,43,38],!1)),R._sixStrings.push(new R("Guitar Open G6 Tuning",[64,59,55,50,43,38],!1)),R._sixStrings.push(new R("Guitar Open Gsus4 Tuning",[62,60,55,50,43,38],!1)),R._sixStrings.push(new R("Guitar Open A Tuning",[64,61,57,52,45,40],!1)),R._sixStrings.push(new R("Guitar Open Am Tuning",[64,60,57,52,45,40],!1)),R._sixStrings.push(new R("Guitar Nashville Tuning",[64,59,67,62,57,52],!1)),R._sixStrings.push(new R("Bass 6 Strings Tuning",[48,43,38,33,28,23],!1)),R._sixStrings.push(new R("Lute or Vihuela Tuning",[64,59,54,50,45,40],!1)),R._defaultTunings.set(5,new R("Bass 5 Strings Tuning",[43,38,33,28,23],!0)),R._fiveStrings.push(R._defaultTunings.get(5)),R._fiveStrings.push(new R("Banjo Dropped C Tuning",[62,59,55,48,67],!1)),R._fiveStrings.push(new R("Banjo Open D Tuning",[62,57,54,50,69],!1)),R._fiveStrings.push(new R("Banjo Open G Tuning",[62,59,55,50,67],!1)),R._fiveStrings.push(new R("Banjo G Minor Tuning",[62,58,55,50,67],!1)),R._fiveStrings.push(new R("Banjo G Modal Tuning",[62,57,55,50,67],!1)),R._defaultTunings.set(4,new R("Bass Standard Tuning",[43,38,33,28],!0)),R._fourStrings.push(R._defaultTunings.get(4)),R._fourStrings.push(new R("Bass Tune down ½ step",[42,37,32,27],!1)),R._fourStrings.push(new R("Bass Tune down 1 step",[41,36,31,26],!1)),R._fourStrings.push(new R("Bass Tune down 2 step",[39,34,29,24],!1)),R._fourStrings.push(new R("Bass Dropped D Tuning",[43,38,33,26],!1)),R._fourStrings.push(new R("Ukulele C Tuning",[45,40,36,43],!1)),R._fourStrings.push(new R("Ukulele G Tuning",[52,47,43,38],!1)),R._fourStrings.push(new R("Mandolin Standard Tuning",[64,57,50,43],!1)),R._fourStrings.push(new R("Mandolin or Violin Tuning",[76,69,62,55],!1)),R._fourStrings.push(new R("Viola Tuning",[69,62,55,48],!1)),R._fourStrings.push(new R("Cello Tuning",[57,50,43,36],!1))}static findTuning(e){let t=R.getPresetsFor(e.length);for(let i=0,r=t.length;i<r;i++){let n=t[i],a=!0;for(let o=0,l=e.length;o<l;o++)if(e[o]!==n.tunings[o]){a=!1;break}if(a)return n}return null}constructor(e="",t=null,i=!1){this.isStandard=i,this.name=e,this.tunings=t??[]}finish(){const e=R.findTuning(this.tunings);e&&(this.name=e.name,this.isStandard=e.isStandard),this.name=this.name.trim()}}R._sevenStrings=[];R._sixStrings=[];R._fiveStrings=[];R._fourStrings=[];R._defaultTunings=new Map;R.defaultAccidentals=["","#","","#","","","#","","#","","#",""];R.defaultSteps=["C","C","D","D","E","F","F","G","G","A","A","B"];R.initialize();class Pw{constructor(){this.index=0,this.bars=[],this.chords=null,this.capo=0,this.transpositionPitch=0,this.displayTranspositionPitch=0,this.stringTuning=new R("",[],!1),this.showSlash=!1,this.showNumbered=!1,this.showTablature=!0,this.showStandardNotation=!0,this.isPercussion=!1,this.standardNotationLineCount=5}get tuning(){return this.stringTuning.tunings}get tuningName(){return this.stringTuning.name}get isStringed(){return this.stringTuning.tunings.length>0}finish(e,t=null){this.stringTuning.finish();for(let i=0,r=this.bars.length;i<r;i++)this.bars[i].finish(e,t)}addChord(e,t){t.staff=this;let i=this.chords;i===null&&(i=new Map,this.chords=i),i.set(e,t)}hasChord(e){var t;return((t=this.chords)==null?void 0:t.has(e))??!1}getChord(e){var t;return((t=this.chords)==null?void 0:t.get(e))??null}addBar(e){let t=this.bars;e.staff=this,e.index=t.length,t.length>0&&(e.previousBar=t[t.length-1],e.previousBar.nextBar=e),t.push(e)}}class Qs{constructor(){this.index=0,this.staves=[],this.playbackInfo=new Nw,this.color=new Ce(200,0,0,255),this.name="",this.isVisibleOnMultiTrack=!0,this.shortName="",this.defaultSystemsLayout=3,this.systemsLayout=[],this.percussionArticulations=[]}ensureStaveCount(e){for(;this.staves.length<e;)this.addStaff(new Pw)}addStaff(e){e.index=this.staves.length,e.track=this,this.staves.push(e)}finish(e,t=null){this.shortName||(this.shortName=this.name,this.shortName.length>Qs.ShortNameMaxLength&&(this.shortName=this.shortName.substr(0,Qs.ShortNameMaxLength)));for(let i=0,r=this.staves.length;i<r;i++)this.staves[i].finish(e,t)}applyLyrics(e){for(let i of e)i.finish();let t=this.staves[0];for(let i=0;i<e.length;i++){let r=e[i];if(r.startBar>=0&&r.startBar<t.bars.length){let n=t.bars[r.startBar].voices[0].beats[0];for(let a=0;a<r.chunks.length&&n;a++){for(;n&&(n.isEmpty||n.isRest);)n=n.nextBeat;n&&(n.lyrics||(n.lyrics=new Array(e.length),n.lyrics.fill("")),n.lyrics[i]=r.chunks[a],n=n.nextBeat)}}}}}Qs.ShortNameMaxLength=10;let Js=class Cw{constructor(){this.id=Cw._globalBarId++,this.index=0,this.beats=[],this.isEmpty=!0}insertBeat(e,t){t.nextBeat=e.nextBeat,t.nextBeat&&(t.nextBeat.previousBeat=t),t.previousBeat=e,t.voice=this,e.nextBeat=t,this.beats.splice(e.index+1,0,t)}addBeat(e){e.voice=this,e.index=this.beats.length,this.beats.push(e),e.isEmpty||(this.isEmpty=!1)}chain(e,t=null){if(this.bar){if(e.index<this.beats.length-1)e.nextBeat=this.beats[e.index+1],e.nextBeat.previousBeat=e;else if(e.isLastOfVoice&&e.voice.bar.nextBar){let i=this.bar.nextBar.voices[this.index];i.beats.length>0&&(e.nextBeat=i.beats[0]),e.nextBeat.previousBeat=e}e.chain(t)}}addGraceBeat(e){if(this.beats.length===0){this.addBeat(e);return}let t=this.beats[this.beats.length-1];this.beats.splice(this.beats.length-1,1),this.addBeat(e),this.addBeat(t),this.isEmpty=!1}getBeatAtPlaybackStart(e){return this._beatLookup.has(e)?this._beatLookup.get(e):null}finish(e,t=null){this._beatLookup=new Map;let i=null;for(let a=0;a<this.beats.length;a++){let o=this.beats[a];o.index=a,this.chain(o,t),o.graceType===$.None?(o.graceGroup=i,i&&(i.isComplete=!0),i=null):(i||(i=new Pd),i.addBeat(o))}let r=0,n=0;for(let a=0;a<this.beats.length;a++){let o=this.beats[a];if(o.index=a,o.finish(e,t),o.graceType===$.None){if(o.graceGroup){const l=o.graceGroup.beats[0],h=o.graceGroup.beats[o.graceGroup.beats.length-1];if(l.graceType!==$.BendGrace){let u=h.playbackStart+h.playbackDuration-l.playbackStart;switch(l.graceType){case $.BeforeBeat:l.previousBeat?(l.previousBeat.playbackDuration-=u,l.previousBeat.voice==this?n=l.previousBeat.playbackStart+l.previousBeat.playbackDuration:n=-u):n=-u;for(const c of o.graceGroup.beats)this._beatLookup.delete(c.playbackStart),c.playbackStart=n,this._beatLookup.set(c.playbackStart,o),n+=c.playbackDuration;break;case $.OnBeat:o.playbackDuration-=u,h.voice===this?n=h.playbackStart+h.playbackDuration:n=-u;break}}}o.displayStart=r,o.playbackStart=n,o.fermata?this.bar.masterBar.addFermata(o.playbackStart,o.fermata):o.fermata=this.bar.masterBar.getFermata(o),this._beatLookup.set(o.playbackStart,o)}else o.displayStart=r,o.playbackStart=n;o.finishTuplet(),o.graceGroup&&o.graceGroup.finish(),r+=o.displayDuration,n+=o.playbackDuration}}calculateDuration(){if(this.isEmpty||this.beats.length===0)return 0;let e=this.beats[this.beats.length-1],t=this.beats[0];return e.playbackStart+e.playbackDuration-t.playbackStart}};Js._globalBarId=0;class ue{static float64ToBytes(e){return ue._dataView.setFloat64(0,e,!0),this._conversionByteArray}static bytesToFloat64(e){throw ue._conversionByteArray.set(e,0),ue._dataView.getFloat64(0,!0)}static uint16ToInt16(e){return ue._dataView.setUint16(0,e,!0),ue._dataView.getInt16(0,!0)}static int16ToUint32(e){return ue._dataView.setInt16(0,e,!0),ue._dataView.getUint32(0,!0)}static int32ToUint16(e){return ue._dataView.setInt32(0,e,!0),ue._dataView.getUint16(0,!0)}static int32ToInt16(e){return ue._dataView.setInt32(0,e,!0),ue._dataView.getInt16(0,!0)}static int32ToUint32(e){return ue._dataView.setInt32(0,e,!0),ue._dataView.getUint32(0,!0)}static uint8ToInt8(e){return ue._dataView.setUint8(0,e),ue._dataView.getInt8(0)}}ue._conversionBuffer=new ArrayBuffer(8);ue._conversionByteArray=new Uint8Array(ue._conversionBuffer);ue._dataView=new DataView(ue._conversionBuffer);class v{static readInt32BE(e){let t=e.readByte(),i=e.readByte(),r=e.readByte(),n=e.readByte();return t<<24|i<<16|r<<8|n}static readInt32LE(e){let t=e.readByte(),i=e.readByte(),r=e.readByte();return e.readByte()<<24|r<<16|i<<8|t}static readUInt32LE(e){let t=e.readByte(),i=e.readByte(),r=e.readByte();return e.readByte()<<24|r<<16|i<<8|t}static decodeUInt32LE(e,t){let i=e[t],r=e[t+1],n=e[t+2];return e[t+3]<<24|n<<16|r<<8|i}static readUInt16LE(e){let t=e.readByte(),i=e.readByte();return ue.int32ToUint16(i<<8|t)}static readInt16LE(e){let t=e.readByte(),i=e.readByte();return ue.int32ToInt16(i<<8|t)}static readUInt32BE(e){let t=e.readByte(),i=e.readByte(),r=e.readByte(),n=e.readByte();return ue.int32ToUint32(t<<24|i<<16|r<<8|n)}static readUInt16BE(e){let t=e.readByte(),i=e.readByte();return ue.int32ToInt16(t<<8|i)}static readInt16BE(e){let t=e.readByte(),i=e.readByte();return ue.int32ToInt16(t<<8|i)}static readByteArray(e,t){let i=new Uint8Array(t);return e.read(i,0,t),i}static read8BitChars(e,t){let i=new Uint8Array(t);return e.read(i,0,i.length),v.toString(i,"utf-8")}static read8BitString(e){let t="",i=e.readByte();for(;i!==0;)t+=String.fromCharCode(i),i=e.readByte();return t}static read8BitStringLength(e,t){let i="",r=-1;for(let a=0;a<t;a++){let o=e.readByte();o===0&&r===-1&&(r=a),i+=String.fromCharCode(o)}let n=i;return r>=0?n.substr(0,r):n}static readSInt8(e){let t=e.readByte();return((t&255)>>7)*-256+(t&255)}static readInt24(e,t){let i=e[t]|e[t+1]<<8|e[t+2]<<16;return(i&8388608)===8388608&&(i=i|255<<24),i}static readInt16(e,t){return ue.int32ToInt16(e[t]|e[t+1]<<8)}static toString(e,t){let i=v.detectEncoding(e);return i&&(t=i),t||(t="utf-8"),new TextDecoder(t).decode(e.buffer)}static detectEncoding(e){return e.length>2&&e[0]===254&&e[1]===255?"utf-16be":e.length>2&&e[0]===255&&e[1]===254?"utf-16le":e.length>4&&e[0]===0&&e[1]===0&&e[2]===254&&e[3]===255?"utf-32be":e.length>4&&e[0]===255&&e[1]===254&&e[2]===0&&e[3]===0?"utf-32le":null}static stringToBytes(e){return new TextEncoder().encode(e)}static writeInt32BE(e,t){e.writeByte(t>>24&255),e.writeByte(t>>16&255),e.writeByte(t>>8&255),e.writeByte(t>>0&255)}static writeInt32LE(e,t){e.writeByte(t>>0&255),e.writeByte(t>>8&255),e.writeByte(t>>16&255),e.writeByte(t>>24&255)}static writeUInt16LE(e,t){e.writeByte(t>>0&255),e.writeByte(t>>8&255)}static writeInt16LE(e,t){e.writeByte(t>>0&255),e.writeByte(t>>8&255)}static writeInt16BE(e,t){e.writeByte(t>>8&255),e.writeByte(t>>0&255)}}class Tt{constructor(){this.length=0,this.position=0}get bytesWritten(){return this.position}getBuffer(){return this._buffer}static empty(){return Tt.withCapacity(0)}static withCapacity(e){let t=new Tt;return t._buffer=new Uint8Array(e),t}static fromBuffer(e){let t=new Tt;return t._buffer=e,t.length=e.length,t}static fromString(e){let t=v.stringToBytes(e);return Tt.fromBuffer(t)}reset(){this.position=0}skip(e){this.position+=e}readByte(){return this.length-this.position<=0?-1:this._buffer[this.position++]}read(e,t,i){let r=this.length-this.position;return r>i&&(r=i),r<=0?0:(e.set(this._buffer.subarray(this.position,this.position+r),t),this.position+=r,r)}writeByte(e){let t=this.position+1;this.ensureCapacity(t),this._buffer[this.position]=e&255,t>this.length&&(this.length=t),this.position=t}write(e,t,i){let r=this.position+i;this.ensureCapacity(r);let n=Math.min(i,e.length-t);this._buffer.set(e.subarray(t,t+n),this.position),r>this.length&&(this.length=r),this.position=r}ensureCapacity(e){if(e>this._buffer.length){let t=e;t<256&&(t=256),t<this._buffer.length*2&&(t=this._buffer.length*2);let i=new Uint8Array(t);this.length>0&&i.set(this._buffer.subarray(0,0+this.length),0),this._buffer=i}}readAll(){return this.toArray()}toArray(){let e=new Uint8Array(this.length);return e.set(this._buffer.subarray(0,0+this.length),0),e}copyTo(e){e.write(this._buffer,0,this.length)}}var x;(function(s){s[s.No=0]="No",s[s.Eof=1]="Eof",s[s.Number=2]="Number",s[s.DoubleDot=3]="DoubleDot",s[s.Dot=4]="Dot",s[s.String=5]="String",s[s.Tuning=6]="Tuning",s[s.LParensis=7]="LParensis",s[s.RParensis=8]="RParensis",s[s.LBrace=9]="LBrace",s[s.RBrace=10]="RBrace",s[s.Pipe=11]="Pipe",s[s.MetaCommand=12]="MetaCommand",s[s.Multiply=13]="Multiply",s[s.LowerThan=14]="LowerThan"})(x||(x={}));class yn extends Pt{constructor(e,t,i,r,n,a,o,l=null){super(Nt.AlphaTex,e),this.position=t,this.line=i,this.col=r,this.nonTerm=n??"",this.expected=a??x.No,this.symbol=o??x.No,this.symbolData=l,Object.setPrototypeOf(this,yn.prototype)}static symbolError(e,t,i,r,n,a,o=null){let l=`MalFormed AlphaTex: @${e} (line ${t}, col ${i}): Error on block ${r}`;return n!==a?(l+=`, expected a ${x[n]} found a ${x[a]}`,o!==null&&(l+=`: '${o}'`)):l+=`, invalid value: '${o}'`,new yn(l,e,t,i,r,n,a,o)}static errorMessage(e,t,i,r){return e=`MalFormed AlphaTex: @${t} (line ${i}, col ${r}): ${e}`,new yn(e,t,i,r,null,null,null,null)}}class Ut extends Ma{constructor(){super(),this._trackChannel=0,this._input="",this._ch=Ut.Eof,this._curChPos=0,this._line=1,this._col=0,this._lastValidSpot=[0,1,0],this._sy=x.No,this._syData="",this._allowNegatives=!1,this._allowFloat=!1,this._allowTuning=!1,this._currentDuration=k.QuadrupleWhole,this._currentDynamics=de.PPP,this._currentTuplet=0,this._staffHasExplicitTuning=!1,this._staffTuningApplied=!1,this._percussionArticulationNames=new Map,this.logErrors=!1}get name(){return"AlphaTex"}initFromString(e,t){this.data=Tt.empty(),this._input=e,this.settings=t}readScore(){try{if(this.data.length>0&&(this._input=v.toString(this.data.readAll(),this.settings.importer.encoding)),this._allowTuning=!0,this._lyrics=new Map,this.createDefaultScore(),this._curChPos=0,this._line=1,this._col=0,this.saveValidSpot(),this._currentDuration=k.Quarter,this._currentDynamics=de.F,this._currentTuplet=1,this._ch=this.nextChar(),this._sy=this.newSy(),this._sy===x.LowerThan)throw new Ye("Unknown start sign '<' (meant to import as XML?)");if(this._sy===x.Eof)throw new Ye("Unexpected end of file");const e=this.metaData(),t=this.bars();if(!e&&!t)throw new Ye("No alphaTex data found");this.consolidate(),this._score.finish(this.settings),this._score.rebuildRepeatGroups();for(const[i,r]of this._lyrics)this._score.tracks[i].applyLyrics(r);return this._score}catch(e){throw e instanceof yn?new Ye(e.message,e):e}}consolidate(){for(let e of this._score.tracks)for(let t of e.staves)for(;t.bars.length<this._score.masterBars.length;){let i=this.newBar(t),r=new Wt;r.isEmpty=!0,i.voices[0].addBeat(r)}}error(e,t,i=!0){let r,n=!1;i?(r=this._sy,(r===x.String||r===x.Number||r===x.MetaCommand)&&(n=!0)):r=t;let a=yn.symbolError(this._lastValidSpot[0],this._lastValidSpot[1],this._lastValidSpot[2],e,t,r,n?this._syData:null);throw this.logErrors&&C.error(this.name,a.message),a}errorMessage(e){let t=yn.errorMessage(e,this._lastValidSpot[0],this._lastValidSpot[1],this._lastValidSpot[2]);throw this.logErrors&&C.error(this.name,t.message),t}createDefaultScore(){this._score=new Rn,this._score.tempo=120,this._score.tempoLabel="",this.newTrack()}newTrack(){this._currentTrack=new Qs,this._currentTrack.ensureStaveCount(1),this._currentTrack.playbackInfo.program=25,this._currentTrack.playbackInfo.primaryChannel=this._trackChannel++,this._currentTrack.playbackInfo.secondaryChannel=this._trackChannel++,this._currentStaff=this._currentTrack.staves[0],this._currentStaff.displayTranspositionPitch=-12,this._currentStaff.stringTuning.tunings=R.getDefaultTuningFor(6).tunings,this._score.addTrack(this._currentTrack),this._lyrics.set(this._currentTrack.index,[]),this._currentDynamics=de.F}parseClefFromString(e){switch(e.toLowerCase()){case"g2":case"treble":return ie.G2;case"f4":case"bass":return ie.F4;case"c3":case"tenor":return ie.C3;case"c4":case"alto":return ie.C4;case"n":case"neutral":return ie.Neutral;default:return ie.G2}}parseClefFromInt(e){switch(e){case 43:return ie.G2;case 65:return ie.F4;case 48:return ie.C3;case 60:return ie.C4;default:return ie.G2}}parseTripletFeelFromString(e){switch(e.toLowerCase()){case"no":case"none":return ce.NoTripletFeel;case"t16":case"triplet-16th":return ce.Triplet16th;case"t8":case"triplet-8th":return ce.Triplet8th;case"d16":case"dotted-16th":return ce.Dotted16th;case"d8":case"dotted-8th":return ce.Dotted8th;case"s16":case"scottish-16th":return ce.Scottish16th;case"s8":case"scottish-8th":return ce.Scottish8th;default:return ce.NoTripletFeel}}parseTripletFeelFromInt(e){switch(e){case 0:return ce.NoTripletFeel;case 1:return ce.Triplet16th;case 2:return ce.Triplet8th;case 3:return ce.Dotted16th;case 4:return ce.Dotted8th;case 5:return ce.Scottish16th;case 6:return ce.Scottish8th;default:return ce.NoTripletFeel}}parseKeySignature(e){switch(e.toLowerCase()){case"cb":case"cbmajor":return fe.Cb;case"gb":case"gbmajor":case"d#minor":return fe.Gb;case"db":case"dbmajor":case"bbminor":return fe.Db;case"ab":case"abmajor":case"fminor":return fe.Ab;case"eb":case"ebmajor":case"cminor":return fe.Eb;case"bb":case"bbmajor":case"gminor":return fe.Bb;case"f":case"fmajor":case"dminor":return fe.F;case"c":case"cmajor":case"aminor":return fe.C;case"g":case"gmajor":case"eminor":return fe.G;case"d":case"dmajor":case"bminor":return fe.D;case"a":case"amajor":case"f#minor":return fe.A;case"e":case"emajor":case"c#minor":return fe.E;case"b":case"bmajor":case"g#minor":return fe.B;case"f#":case"f#major":case"ebminor":return fe.FSharp;case"c#":case"c#major":return fe.CSharp;default:return fe.C}}nextChar(){return this._curChPos<this._input.length?(this._ch=this._input.charCodeAt(this._curChPos++),this._ch===10?(this._line++,this._col=0):this._col++):this._ch=Ut.Eof,this._ch}saveValidSpot(){this._lastValidSpot=[this._curChPos,this._line,this._col]}newSy(){for(this.saveValidSpot(),this._sy=x.No;this._sy===x.No;)if(this._ch===Ut.Eof)this._sy=x.Eof;else if(Ut.isWhiteSpace(this._ch))this._ch=this.nextChar(),this.saveValidSpot();else if(this._ch===47){if(this._ch=this.nextChar(),this._ch===47)for(;this._ch!==13&&this._ch!==10&&this._ch!==Ut.Eof;)this._ch=this.nextChar();else if(this._ch===42)for(;this._ch!==Ut.Eof;)if(this._ch===42){if(this._ch=this.nextChar(),this._ch===47){this._ch=this.nextChar();break}}else this._ch=this.nextChar();else this.error("comment",x.String,!1);this.saveValidSpot()}else if(this._ch===34||this._ch===39){let e=this._ch;this._ch=this.nextChar();let t="";for(this._sy=x.String;this._ch!==e&&this._ch!==Ut.Eof;)t+=String.fromCharCode(this._ch),this._ch=this.nextChar();this._ch===Ut.Eof&&this.errorMessage("String opened but never closed"),this._syData=t,this._ch=this.nextChar()}else if(this._ch===45)this._allowNegatives?(this._sy=x.Number,this._syData=this.readNumber()):(this._sy=x.String,this._syData=this.readName());else if(this._ch===46)this._sy=x.Dot,this._ch=this.nextChar();else if(this._ch===58)this._sy=x.DoubleDot,this._ch=this.nextChar();else if(this._ch===40)this._sy=x.LParensis,this._ch=this.nextChar();else if(this._ch===92)this._ch=this.nextChar(),this._sy=x.MetaCommand,this._syData=this.readName();else if(this._ch===41)this._sy=x.RParensis,this._ch=this.nextChar();else if(this._ch===123)this._sy=x.LBrace,this._ch=this.nextChar();else if(this._ch===125)this._sy=x.RBrace,this._ch=this.nextChar();else if(this._ch===124)this._sy=x.Pipe,this._ch=this.nextChar();else if(this._ch===42)this._sy=x.Multiply,this._ch=this.nextChar();else if(this._ch===60)this._sy=x.LowerThan,this._ch=this.nextChar();else if(this.isDigit(this._ch))this._sy=x.Number,this._syData=this.readNumber();else if(Ut.isNameLetter(this._ch)){let e=this.readName(),t=this._allowTuning?Re.parseTuning(e):null;t?(this._sy=x.Tuning,this._syData=t):(this._sy=x.String,this._syData=e)}else this.error("symbol",x.String,!1);return this._sy}static isNameLetter(e){return!Ut.isTerminal(e)&&(33<=e&&e<=47||58<=e&&e<=126||128<=e)}static isTerminal(e){return e===46||e===123||e===125||e===91||e===93||e===40||e===41||e===124||e===39||e===34||e===92}static isWhiteSpace(e){return e===9||e===10||e===11||e===13||e===32}isDigit(e){return e>=48&&e<=57||this._allowNegatives&&e===45||this._allowFloat&&e===46}readName(){let e="";do e+=String.fromCharCode(this._ch),this._ch=this.nextChar();while(Ut.isNameLetter(this._ch)||this.isDigit(this._ch));return e}readNumber(){let e="";do e+=String.fromCharCode(this._ch),this._ch=this.nextChar();while(this.isDigit(this._ch));return this._allowFloat?parseFloat(e):parseInt(e)}metaData(){let e=!1,t=!0;for(;this._sy===x.MetaCommand&&t;){let i=this._syData.toLowerCase();switch(i){case"title":case"subtitle":case"artist":case"album":case"words":case"music":case"copyright":this._sy=this.newSy(),this._sy!==x.String&&this.error(i,x.String,!0);let r=this._syData;switch(i){case"title":this._score.title=r;break;case"subtitle":this._score.subTitle=r;break;case"artist":this._score.artist=r;break;case"album":this._score.album=r;break;case"words":this._score.words=r;break;case"music":this._score.music=r;break;case"copyright":this._score.copyright=r;break}this._sy=this.newSy(),e=!0;break;case"tempo":this._allowFloat=!0,this._sy=this.newSy(),this._allowFloat=!1,this._sy===x.Number?this._score.tempo=this._syData:this.error("tempo",x.Number,!0),this._sy=this.newSy(),e=!0;break;default:this.handleStaffMeta()?e=!0:e?this.error("metaDataTags",x.String,!1):t=!1;break}}return e?(this._sy!==x.Dot&&this.error("song",x.Dot,!0),this._sy=this.newSy()):this._sy===x.Dot&&(this._sy=this.newSy()),e}handleStaffMeta(){var e;switch(this._syData.toLowerCase()){case"capo":return this._sy=this.newSy(),this._sy===x.Number?this._currentStaff.capo=this._syData:this.error("capo",x.Number,!0),this._sy=this.newSy(),!0;case"tuning":this._sy=this.newSy();let t=this._currentStaff.tuning.length;switch(this._staffHasExplicitTuning=!0,this._staffTuningApplied=!1,this._sy){case x.String:let o=this._syData.toLowerCase();o==="piano"||o==="none"||o==="voice"?(this._currentStaff.stringTuning.tunings=[],this._currentStaff.displayTranspositionPitch=0):this.error("tuning",x.Tuning,!0),this._sy=this.newSy();break;case x.Tuning:let l=[];do{let h=this._syData;l.push(h.realValue),this._sy=this.newSy()}while(this._sy===x.Tuning);this._currentStaff.stringTuning.tunings=l;break;default:this.error("tuning",x.Tuning,!0);break}return t!==this._currentStaff.tuning.length&&(((e=this._currentStaff.chords)==null?void 0:e.size)??0)>0&&this.errorMessage("Tuning must be defined before any chord"),!0;case"instrument":if(this._sy=this.newSy(),this._staffTuningApplied=!1,this._sy===x.Number){let o=this._syData;o>=0&&o<=127?this._currentTrack.playbackInfo.program=this._syData:this.error("instrument",x.Number,!1)}else if(this._sy===x.String){let o=this._syData.toLowerCase();if(o==="percussion"){for(const l of this._currentTrack.staves)this.applyPercussionStaff(l);this._currentTrack.playbackInfo.primaryChannel=9,this._currentTrack.playbackInfo.secondaryChannel=9}else this._currentTrack.playbackInfo.program=nr.getValue(o)}else this.error("instrument",x.Number,!0);return this._sy=this.newSy(),!0;case"lyrics":this._sy=this.newSy();let i=new ct;return i.startBar=0,i.text="",this._sy===x.Number&&(i.startBar=this._syData,this._sy=this.newSy()),this._sy===x.String?(i.text=this._syData,this._sy=this.newSy()):this.error("lyrics",x.String,!0),this._lyrics.get(this._currentTrack.index).push(i),!0;case"chord":this._sy=this.newSy();let r=new $r;this.chordProperties(r),this._sy===x.String?(r.name=this._syData,this._sy=this.newSy()):this.error("chord-name",x.String,!0);for(let o=0;o<this._currentStaff.tuning.length;o++)this._sy===x.Number?r.strings.push(this._syData):this._sy===x.String&&this._syData.toLowerCase()==="x"&&r.strings.push(-1),this._sy=this.newSy();return this._currentStaff.addChord(this.getChordId(this._currentStaff,r.name),r),!0;case"articulation":this._sy=this.newSy();let n="";if(this._sy===x.String?(n=this._syData,this._sy=this.newSy()):this.error("articulation-name",x.String,!0),n==="defaults"){for(const[o,l]of nt.instrumentArticulationNames)this._percussionArticulationNames.set(o.toLowerCase(),l),this._percussionArticulationNames.set(Ut.toArticulationId(o),l);return!0}let a=0;return this._sy===x.Number?(a=this._syData,this._sy=this.newSy()):this.error("articulation-number",x.Number,!0),nt.instrumentArticulations.has(a)||this.errorMessage(`Unknown articulation ${a}. Refer to https://www.alphatab.net/docs/alphatex/percussion for available ids`),this._percussionArticulationNames.set(n.toLowerCase(),a),!0;default:return!1}}static toArticulationId(e){return e.replace(new RegExp("[^a-zA-Z0-9]","g"),"").toLowerCase()}applyPercussionStaff(e){e.isPercussion=!0,e.showTablature=!1}chordProperties(e){if(this._sy===x.LBrace){for(this._sy=this.newSy();this._sy===x.String;)switch(this._syData.toLowerCase()){case"firstfret":switch(this._sy=this.newSy(),this._sy){case x.Number:e.firstFret=this._syData;break;default:this.error("chord-firstfret",x.Number,!0);break}this._sy=this.newSy();break;case"showdiagram":switch(this._sy=this.newSy(),this._sy){case x.String:e.showDiagram=this._syData.toLowerCase()!=="false";break;case x.Number:e.showDiagram=this._syData!==0;break;default:this.error("chord-showdiagram",x.String,!0);break}this._sy=this.newSy();break;case"showfingering":switch(this._sy=this.newSy(),this._sy){case x.String:e.showDiagram=this._syData.toLowerCase()!=="false";break;case x.Number:e.showFingering=this._syData!==0;break;default:this.error("chord-showfingering",x.String,!0);break}this._sy=this.newSy();break;case"showname":switch(this._sy=this.newSy(),this._sy){case x.String:e.showName=this._syData.toLowerCase()!=="false";break;case x.Number:e.showName=this._syData!==0;break;default:this.error("chord-showname",x.String,!0);break}this._sy=this.newSy();break;case"barre":for(this._sy=this.newSy();this._sy===x.Number;)e.barreFrets.push(this._syData),this._sy=this.newSy();break;default:this.error("chord-properties",x.String,!1);break}this._sy!==x.RBrace&&this.error("chord-properties",x.RBrace,!0),this._sy=this.newSy()}}bars(){let e=this.bar();for(;this._sy!==x.Eof;)if(this._sy===x.Pipe)this._sy=this.newSy(),this.bar();else if(this._sy===x.MetaCommand)this.bar();else break;return e}trackStaffMeta(){if(this._sy!==x.MetaCommand)return!1;if(this._syData.toLowerCase()==="track"&&(this._staffHasExplicitTuning=!1,this._staffTuningApplied=!1,this._sy=this.newSy(),this._score.masterBars.length>0&&this.newTrack(),this._sy===x.String&&(this._currentTrack.name=this._syData,this._sy=this.newSy()),this._sy===x.String&&(this._currentTrack.shortName=this._syData,this._sy=this.newSy())),this._sy===x.MetaCommand&&this._syData.toLowerCase()==="staff"){if(this._staffHasExplicitTuning=!1,this._staffTuningApplied=!1,this._sy=this.newSy(),this._currentTrack.staves[0].bars.length>0){this._currentTrack.ensureStaveCount(this._currentTrack.staves.length+1);const e=this._currentStaff.isPercussion;this._currentStaff=this._currentTrack.staves[this._currentTrack.staves.length-1],e&&this.applyPercussionStaff(this._currentStaff),this._currentDynamics=de.F}this.staffProperties()}return!0}staffProperties(){if(this._sy!==x.LBrace)return;this._sy=this.newSy();let e=!1,t=!1,i=!1,r=!1;for(;this._sy===x.String;)switch(this._syData.toLowerCase()){case"score":e=!0,this._sy=this.newSy();break;case"tabs":t=!0,this._sy=this.newSy();break;case"slash":i=!0,this._sy=this.newSy();break;case"numbered":r=!0,this._sy=this.newSy();break;default:this.error("staff-properties",x.String,!1);break}(e||t||i||r)&&(this._currentStaff.showStandardNotation=e,this._currentStaff.showTablature=t,this._currentStaff.showSlash=i,this._currentStaff.showNumbered=r),this._sy!==x.RBrace&&this.error("staff-properties",x.RBrace,!0),this._sy=this.newSy()}bar(){const e=this.trackStaffMeta();let t=this.newBar(this._currentStaff);if(this._currentStaff.bars.length>this._score.masterBars.length){let a=new mr;this._score.addMasterBar(a),a.index>0&&(a.keySignature=a.previousMasterBar.keySignature,a.keySignatureType=a.previousMasterBar.keySignatureType,a.timeSignatureDenominator=a.previousMasterBar.timeSignatureDenominator,a.timeSignatureNumerator=a.previousMasterBar.timeSignatureNumerator,a.tripletFeel=a.previousMasterBar.tripletFeel)}const i=this.barMeta(t);if(!this._staffTuningApplied&&!this._staffHasExplicitTuning){const a=this._currentTrack.playbackInfo.program;this._currentStaff.displayTranspositionPitch=0,this._currentStaff.stringTuning.tunings=[],a==15||a>=24&&a<=31?(this._currentStaff.displayTranspositionPitch=-12,this._currentStaff.stringTuning.tunings=R.getDefaultTuningFor(6).tunings):a>=32&&a<=39?(this._currentStaff.displayTranspositionPitch=-12,this._currentStaff.stringTuning.tunings=[43,38,33,28]):a==40||a==44||a==45||a==48||a==49||a==50||a==51?this._currentStaff.stringTuning.tunings=[52,57,50,43]:a==41?this._currentStaff.stringTuning.tunings=[57,50,43,36]:a==42?this._currentStaff.stringTuning.tunings=[45,38,31,24]:a==43?(this._currentStaff.displayTranspositionPitch=-12,this._currentStaff.stringTuning.tunings=[43,38,33,28]):a==105?this._currentStaff.stringTuning.tunings=[50,47,43,38,55]:a==106?this._currentStaff.stringTuning.tunings=[57,52,45]:a==107?this._currentStaff.stringTuning.tunings=[52,45,38,31]:a==110&&(this._currentStaff.stringTuning.tunings=[64,57,50,43]),this._staffTuningApplied=!0}let r=!1,n=t.voices[0];for(;this._sy!==x.Pipe&&this._sy!==x.Eof&&this.beat(n);)r=!0;if(n.beats.length===0){let a=new Wt;a.isEmpty=!0,n.addBeat(a)}return e||i||r}newBar(e){let t=new Sr;e.addBar(t),t.index>0&&(t.clef=t.previousBar.clef);let i=new Js;return t.addVoice(i),t}beat(e){this.beatDuration();let t=new Wt;if(e.addBeat(t),this._allowTuning=!this._currentStaff.isPercussion,this._sy===x.LParensis){for(this._sy=this.newSy(),this.note(t);this._sy!==x.RParensis&&this._sy!==x.Eof&&(this._allowTuning=!this._currentStaff.isPercussion,!!this.note(t)););this._sy!==x.RParensis&&this.error("note-list",x.RParensis,!0),this._sy=this.newSy()}else if(this._sy===x.String&&this._syData.toLowerCase()==="r")this._sy=this.newSy();else if(!this.note(t))return e.beats.splice(e.beats.length-1,1),!1;this._sy===x.Dot&&(this._allowNegatives=!0,this._sy=this.newSy(),this._allowNegatives=!1,this._sy!==x.Number&&this.error("duration",x.Number,!0),this._currentDuration=this.parseDuration(this._syData),this._sy=this.newSy()),t.duration=this._currentDuration,t.dynamics=this._currentDynamics,this._currentTuplet!==1&&!t.hasTuplet&&Ut.applyTuplet(t,this._currentTuplet);let i=1;this._sy===x.Multiply&&(this._sy=this.newSy(),this._sy!==x.Number?this.error("multiplier",x.Number,!0):i=this._syData,this._sy=this.newSy()),this.beatEffects(t);for(let r=0;r<i-1;r++)e.addBeat(Zf.clone(t));return!0}beatDuration(){if(this._sy===x.DoubleDot&&(this._allowNegatives=!0,this._sy=this.newSy(),this._allowNegatives=!1,this._sy!==x.Number&&this.error("duration",x.Number,!0),this._currentDuration=this.parseDuration(this._syData),this._currentTuplet=1,this._sy=this.newSy(),this._sy===x.LBrace)){for(this._sy=this.newSy();this._sy===x.String;)switch(this._syData.toLowerCase()){case"tu":this._sy=this.newSy(),this._sy!==x.Number&&this.error("duration-tuplet",x.Number,!0),this._currentTuplet=this._syData,this._sy=this.newSy();break;default:this.error("beat-duration",x.String,!1);break}this._sy!==x.RBrace&&this.error("beat-duration",x.RBrace,!0),this._sy=this.newSy()}}beatEffects(e){if(this._sy===x.LBrace){for(this._sy=this.newSy();this._sy===x.String;)this.applyBeatEffect(e)||this.error("beat-effects",x.String,!1);this._sy!==x.RBrace&&this.error("beat-effects",x.RBrace,!0),this._sy=this.newSy()}}applyBeatEffect(e){let t=this._syData.toLowerCase();if(t==="f")e.fadeIn=!0;else if(t==="v")e.vibrato=Be.Slight;else if(t==="s")e.slap=!0;else if(t==="p")e.pop=!0;else if(t==="tt")e.tap=!0;else if(t==="dd")e.dots=2;else if(t==="d")e.dots=1;else if(t==="su")e.pickStroke=At.Up;else if(t==="sd")e.pickStroke=At.Down;else if(t==="tu"){if(this._sy=this.newSy(),this._sy!==x.Number)return this.error("tuplet",x.Number,!0),!1;Ut.applyTuplet(e,this._syData)}else if(t==="tb"||t==="tbe"){let i=t==="tbe";for(this._sy=this.newSy(),this._sy!==x.LParensis&&this.error("tremolobar-effect",x.LParensis,!0),this._allowNegatives=!0,this._sy=this.newSy();this._sy!==x.RParensis&&this._sy!==x.Eof;){let r=0,n=0;i?(this._sy!==x.Number&&this.error("tremolobar-effect",x.Number,!0),r=this._syData,this._sy=this.newSy(),this._sy!==x.Number&&this.error("tremolobar-effect",x.Number,!0),n=this._syData):(this._sy!==x.Number&&this.error("tremolobar-effect",x.Number,!0),r=0,n=this._syData),e.addWhammyBarPoint(new A(r,n)),this._sy=this.newSy()}if(e.whammyBarPoints!=null){for(;e.whammyBarPoints.length>60;)e.removeWhammyBarPoint(e.whammyBarPoints.length-1);if(i)e.whammyBarPoints.sort((r,n)=>r.offset-n.offset);else{let r=e.whammyBarPoints.length,n=60/r|0,a=0;for(;a<r;)e.whammyBarPoints[a].offset=Math.min(60,a*n),a++}}this._allowNegatives=!1,this._sy!==x.RParensis&&this.error("tremolobar-effect",x.RParensis,!0)}else if(t==="bu"||t==="bd"||t==="au"||t==="ad"){switch(t){case"bu":e.brushType=Ve.BrushUp;break;case"bd":e.brushType=Ve.BrushDown;break;case"au":e.brushType=Ve.ArpeggioUp;break;case"ad":e.brushType=Ve.ArpeggioDown;break}return this._sy=this.newSy(),this._sy===x.Number?(e.brushDuration=this._syData,this._sy=this.newSy(),!0):(e.updateDurations(),t==="bu"||t==="bd"?e.brushDuration=e.playbackDuration/4/e.notes.length:(t==="au"||t==="ad")&&(e.brushDuration=e.playbackDuration/e.notes.length),!0)}else if(t==="ch"){this._sy=this.newSy();let i=this._syData,r=this.getChordId(this._currentStaff,i);if(!this._currentStaff.hasChord(r)){let n=new $r;n.showDiagram=!1,n.name=i,this._currentStaff.addChord(r,n)}e.chordId=r}else{if(t==="gr")return this._sy=this.newSy(),this._syData.toLowerCase()==="ob"?(e.graceType=$.OnBeat,this._sy=this.newSy()):this._syData.toLowerCase()==="b"?(e.graceType=$.BendGrace,this._sy=this.newSy()):e.graceType=$.BeforeBeat,!0;if(t==="dy"){switch(this._sy=this.newSy(),this._syData.toLowerCase()){case"ppp":e.dynamics=de.PPP;break;case"pp":e.dynamics=de.PP;break;case"p":e.dynamics=de.P;break;case"mp":e.dynamics=de.MP;break;case"mf":e.dynamics=de.MF;break;case"f":e.dynamics=de.F;break;case"ff":e.dynamics=de.FF;break;case"fff":e.dynamics=de.FFF;break}this._currentDynamics=e.dynamics}else if(t==="cre")e.crescendo=ki.Crescendo;else if(t==="dec")e.crescendo=ki.Decrescendo;else if(t==="tempo"){const i=this.readTempoAutomation();return e.automations.push(i),e.voice.bar.masterBar.tempoAutomations.push(i),!0}else if(t==="tp"){if(this._sy=this.newSy(),e.tremoloSpeed=k.Eighth,this._sy===x.Number){switch(this._syData){case 8:e.tremoloSpeed=k.Eighth;break;case 16:e.tremoloSpeed=k.Sixteenth;break;case 32:e.tremoloSpeed=k.ThirtySecond;break;default:e.tremoloSpeed=k.Eighth;break}this._sy=this.newSy()}return!0}else return t==="slashed"?(e.slashed=!0,this._sy=this.newSy(),!0):!1}return this._sy=this.newSy(),!0}getChordId(e,t){return t.toLowerCase()+e.index+e.track.index}static applyTuplet(e,t){switch(t){case 3:e.tupletNumerator=3,e.tupletDenominator=2;break;case 5:e.tupletNumerator=5,e.tupletDenominator=4;break;case 6:e.tupletNumerator=6,e.tupletDenominator=4;break;case 7:e.tupletNumerator=7,e.tupletDenominator=4;break;case 9:e.tupletNumerator=9,e.tupletDenominator=8;break;case 10:e.tupletNumerator=10,e.tupletDenominator=8;break;case 11:e.tupletNumerator=11,e.tupletDenominator=8;break;case 12:e.tupletNumerator=12,e.tupletDenominator=8;break;default:e.tupletNumerator=1,e.tupletDenominator=1;break}}isNoteText(e){return e==="x"||e==="-"||e==="r"}note(e){let t=!1,i=!1,r=-1,n=-1,a=-1;switch(this._sy){case x.Number:r=this._syData,this._currentStaff.isPercussion&&!nt.instrumentArticulations.has(r)&&this.errorMessage(`Unknown percussion articulation ${r}`);break;case x.String:if(this._currentStaff.isPercussion){const c=this._syData.toLowerCase();this._percussionArticulationNames.has(c)?r=this._percussionArticulationNames.get(c):this.errorMessage(`Unknown percussion articulation '${this._syData}'`)}else t=this._syData==="x",i=this._syData==="-",i||t?r=0:this.error("note-fret",x.Number,!0);break;case x.Tuning:let u=this._syData;n=u.octave,a=u.noteValue;break;default:return!1}this._sy=this.newSy();let o=n===-1&&this._currentStaff.tuning.length>0&&!this._currentStaff.isPercussion,l=-1;o&&(this._sy!==x.Dot&&this.error("note",x.Dot,!0),this._sy=this.newSy(),this._sy!==x.Number&&this.error("note-string",x.Number,!0),l=this._syData,(l<1||l>this._currentStaff.tuning.length)&&this.error("note-string",x.Number,!1),this._sy=this.newSy());let h=new je;return o?(h.string=this._currentStaff.tuning.length-(l-1),h.isDead=t,h.isTieDestination=i,i||(h.fret=r)):this._currentStaff.isPercussion?h.percussionArticulation=r:(h.octave=n,h.tone=a,h.isTieDestination=i),e.addNote(h),this.noteEffects(h),!0}noteEffects(e){if(this._sy===x.LBrace){for(this._sy=this.newSy();this._sy===x.String;){let t=this._syData.toLowerCase();if(t==="b"||t==="be"){let i=t==="be";for(this._sy=this.newSy(),this._sy!==x.LParensis&&this.error("bend-effect",x.LParensis,!0),this._sy=this.newSy();this._sy!==x.RParensis&&this._sy!==x.Eof;){let n=0,a=0;i?(this._sy!==x.Number&&this.error("bend-effect-value",x.Number,!0),n=this._syData,this._sy=this.newSy(),this._sy!==x.Number&&this.error("bend-effect-value",x.Number,!0),a=this._syData):(this._sy!==x.Number&&this.error("bend-effect-value",x.Number,!0),a=this._syData),e.addBendPoint(new A(n,a)),this._sy=this.newSy()}const r=e.bendPoints;if(r!=null){for(;r.length>60;)r.splice(r.length-1,1);if(i)r.sort((n,a)=>n.offset-a.offset);else{let n=r.length,a=60/(n-1)|0,o=0;for(;o<n;)r[o].offset=Math.min(60,o*a),o++}}this._sy!==x.RParensis&&this.error("bend-effect",x.RParensis,!0),this._sy=this.newSy()}else if(t==="nh")e.harmonicType=X.Natural,this._sy=this.newSy();else if(t==="ah")e.harmonicType=X.Artificial,this._sy=this.newSy();else if(t==="th")e.harmonicType=X.Tap,this._sy=this.newSy();else if(t==="ph")e.harmonicType=X.Pinch,this._sy=this.newSy();else if(t==="sh")e.harmonicType=X.Semi,this._sy=this.newSy();else if(t==="tr"){this._sy=this.newSy(),this._sy!==x.Number&&this.error("trill-effect",x.Number,!0);let i=this._syData;this._sy=this.newSy();let r=k.Sixteenth;if(this._sy===x.Number){switch(this._syData){case 16:r=k.Sixteenth;break;case 32:r=k.ThirtySecond;break;case 64:r=k.SixtyFourth;break;default:r=k.Sixteenth;break}this._sy=this.newSy()}e.trillValue=i+e.stringTuning,e.trillSpeed=r}else if(t==="v")this._sy=this.newSy(),e.vibrato=Be.Slight;else if(t==="sl")this._sy=this.newSy(),e.slideOutType=ne.Legato;else if(t==="ss")this._sy=this.newSy(),e.slideOutType=ne.Shift;else if(t==="sib")this._sy=this.newSy(),e.slideInType=vt.IntoFromBelow;else if(t==="sia")this._sy=this.newSy(),e.slideInType=vt.IntoFromAbove;else if(t==="sou")this._sy=this.newSy(),e.slideOutType=ne.OutUp;else if(t==="sod")this._sy=this.newSy(),e.slideOutType=ne.OutDown;else if(t==="psd")this._sy=this.newSy(),e.slideOutType=ne.PickSlideDown;else if(t==="psu")this._sy=this.newSy(),e.slideOutType=ne.PickSlideUp;else if(t==="h")this._sy=this.newSy(),e.isHammerPullOrigin=!0;else if(t==="lht")this._sy=this.newSy(),e.isLeftHandTapped=!0;else if(t==="g")this._sy=this.newSy(),e.isGhost=!0;else if(t==="ac")this._sy=this.newSy(),e.accentuated=et.Normal;else if(t==="hac")this._sy=this.newSy(),e.accentuated=et.Heavy;else if(t==="ten")this._sy=this.newSy(),e.accentuated=et.Tenuto;else if(t==="pm")this._sy=this.newSy(),e.isPalmMute=!0;else if(t==="st")this._sy=this.newSy(),e.isStaccato=!0;else if(t==="lr")this._sy=this.newSy(),e.isLetRing=!0;else if(t==="x")this._sy=this.newSy(),e.fret=0,e.isDead=!0;else if(t==="-"||t==="t")this._sy=this.newSy(),e.isTieDestination=!0;else if(t==="lf"){this._sy=this.newSy();let i=oe.Thumb;this._sy===x.Number&&(i=this.toFinger(this._syData),this._sy=this.newSy()),e.leftHandFinger=i}else if(t==="rf"){this._sy=this.newSy();let i=oe.Thumb;this._sy===x.Number&&(i=this.toFinger(this._syData),this._sy=this.newSy()),e.rightHandFinger=i}else this.applyBeatEffect(e.beat)||this.error(t,x.String,!1)}this._sy!==x.RBrace&&this.error("note-effect",x.RBrace,!1),this._sy=this.newSy()}}toFinger(e){switch(e){case 1:return oe.Thumb;case 2:return oe.IndexFinger;case 3:return oe.MiddleFinger;case 4:return oe.AnnularFinger;case 5:return oe.LittleFinger}return oe.Thumb}parseDuration(e){switch(e){case-4:return k.QuadrupleWhole;case-2:return k.DoubleWhole;case 1:return k.Whole;case 2:return k.Half;case 4:return k.Quarter;case 8:return k.Eighth;case 16:return k.Sixteenth;case 32:return k.ThirtySecond;case 64:return k.SixtyFourth;case 128:return k.OneHundredTwentyEighth;case 256:return k.TwoHundredFiftySixth;default:return k.Quarter}}barMeta(e){let t=!1,i=e.masterBar;for(;this._sy===x.MetaCommand;){t=!0;let r=this._syData.toLowerCase();if(r==="ts")this._sy=this.newSy(),this._sy!==x.Number&&this.error("timesignature-numerator",x.Number,!0),i.timeSignatureNumerator=this._syData,this._sy=this.newSy(),this._sy!==x.Number&&this.error("timesignature-denominator",x.Number,!0),i.timeSignatureDenominator=this._syData,this._sy=this.newSy();else if(r=="ft")i.isFreeTime=!0;else if(r==="ro")i.isRepeatStart=!0,this._sy=this.newSy();else if(r==="rc")this._sy=this.newSy(),this._sy!==x.Number&&this.error("repeatclose",x.Number,!0),this._syData>2048&&this.error("repeatclose",x.Number,!1),i.repeatCount=this._syData,this._sy=this.newSy();else if(r==="ae")if(this._sy=this.newSy(),this._sy===x.LParensis){for(this._sy=this.newSy(),this._sy!==x.Number&&this.error("alternateending",x.Number,!0),this.applyAlternateEnding(i);this._sy===x.Number;)this.applyAlternateEnding(i);this._sy!==x.RParensis&&this.error("alternateending-list",x.RParensis,!0),this._sy=this.newSy()}else this._sy!==x.Number&&this.error("alternateending",x.Number,!0),this.applyAlternateEnding(i);else if(r==="ks")this._sy=this.newSy(),this._sy!==x.String&&this.error("keysignature",x.String,!0),i.keySignature=this.parseKeySignature(this._syData),this._sy=this.newSy();else if(r==="clef"){switch(this._sy=this.newSy(),this._sy){case x.String:e.clef=this.parseClefFromString(this._syData);break;case x.Number:e.clef=this.parseClefFromInt(this._syData);break;case x.Tuning:let n=this._syData;e.clef=this.parseClefFromInt(n.realValue);break;default:this.error("clef",x.String,!0);break}this._sy=this.newSy()}else if(r==="tempo"){const n=this.readTempoAutomation();i.tempoAutomations.push(n)}else if(r==="section"){this._sy=this.newSy(),this._sy!==x.String&&this.error("section",x.String,!0);let n=this._syData;this._sy=this.newSy();let a="";this._sy===x.String&&!this.isNoteText(this._syData.toLowerCase())&&(a=n,n=this._syData,this._sy=this.newSy());let o=new xu;o.marker=a,o.text=n,i.section=o}else if(r==="tf"){switch(this._allowTuning=!1,this._sy=this.newSy(),this._allowTuning=!0,this._sy){case x.String:i.tripletFeel=this.parseTripletFeelFromString(this._syData);break;case x.Number:i.tripletFeel=this.parseTripletFeelFromInt(this._syData);break;default:this.error("triplet-feel",x.String,!0);break}this._sy=this.newSy()}else r==="ac"?(i.isAnacrusis=!0,this._sy=this.newSy()):e.index===0?this.handleStaffMeta()||this.error("measure-effects",x.String,!1):this.error("measure-effects",x.String,!1)}if(i.index===0&&i.tempoAutomations.length===0){let r=new Vt;r.isLinear=!1,r.type=gt.Tempo,r.value=this._score.tempo,i.tempoAutomations.push(r)}return t}readTempoAutomation(){this._allowFloat=!0,this._sy=this.newSy(),this._allowFloat=!1,this._sy!==x.Number&&this.error("tempo",x.Number,!0);const e=new Vt;return e.isLinear=!1,e.type=gt.Tempo,e.value=this._syData,this._sy=this.newSy(),e}applyAlternateEnding(e){let t=this._syData;t<1&&this.error("alternateending",x.Number,!0),e.alternateEndings|=1<<t-1,this._sy=this.newSy()}}Ut.Eof=0;class Os extends Ma{get name(){return"Guitar Pro 3-5"}constructor(){super(),this._versionNumber=0,this._globalTripletFeel=ce.NoTripletFeel,this._lyricsTrack=0,this._lyrics=[],this._barCount=0,this._trackCount=0,this._playbackInfos=[],this._beatTextChunksByTrack=new Map}readScore(){if(this.readVersion(),this._score=new Rn,this.readScoreInformation(),this._versionNumber<500&&(this._globalTripletFeel=_e.gpReadBool(this.data)?ce.Triplet8th:ce.NoTripletFeel),this._versionNumber>=400&&this.readLyrics(),this._versionNumber>=510&&this.data.skip(19),this._versionNumber>=500&&(this.readPageSetup(),this._score.tempoLabel=_e.gpReadStringIntByte(this.data,this.settings.importer.encoding)),this._score.tempo=v.readInt32LE(this.data),this._versionNumber>=510&&_e.gpReadBool(this.data),v.readInt32LE(this.data),this._versionNumber>=400&&this.data.readByte(),this.readPlaybackInfos(),this._versionNumber>=500&&(this.data.skip(38),this.data.skip(4)),this._barCount=v.readInt32LE(this.data),this._trackCount=v.readInt32LE(this.data),this.readMasterBars(),this.readTracks(),this.readBars(),this._score.masterBars.length>0){const e=Vt.buildTempoAutomation(!1,0,this._score.tempo,2);e.text=this._score.tempoLabel,this._score.masterBars[0].tempoAutomations.push(e)}return this._score.finish(this.settings),this._lyrics&&this._lyricsTrack>=0&&this._score.tracks[this._lyricsTrack].applyLyrics(this._lyrics),this._score}readVersion(){let e=_e.gpReadStringByteLength(this.data,30,this.settings.importer.encoding);if(!e.startsWith(Os.VersionString))throw new Ye("Unsupported format");e=e.substr(Os.VersionString.length+1);let t=e.indexOf(".");this._versionNumber=100*parseInt(e.substr(0,t))+parseInt(e.substr(t+1)),C.debug(this.name,"Guitar Pro version "+e+" detected")}readScoreInformation(){var i;this._score.title=_e.gpReadStringIntUnused(this.data,this.settings.importer.encoding),this._score.subTitle=_e.gpReadStringIntUnused(this.data,this.settings.importer.encoding),this._score.artist=_e.gpReadStringIntUnused(this.data,this.settings.importer.encoding),this._score.album=_e.gpReadStringIntUnused(this.data,this.settings.importer.encoding),this._score.words=_e.gpReadStringIntUnused(this.data,this.settings.importer.encoding),this._score.music=this._versionNumber>=500?_e.gpReadStringIntUnused(this.data,this.settings.importer.encoding):this._score.words,this._score.copyright=_e.gpReadStringIntUnused(this.data,this.settings.importer.encoding),this._score.tab=_e.gpReadStringIntUnused(this.data,this.settings.importer.encoding),this._score.instructions=_e.gpReadStringIntUnused(this.data,this.settings.importer.encoding);let e=v.readInt32LE(this.data),t="";for(let r=0;r<e;r++)r>0&&(t+=`\r
`),t+=(i=_e.gpReadStringIntUnused(this.data,this.settings.importer.encoding))==null?void 0:i.toString();this._score.notices=t}readLyrics(){this._lyrics=[],this._lyricsTrack=v.readInt32LE(this.data)-1;for(let e=0;e<5;e++){let t=new ct;t.startBar=v.readInt32LE(this.data)-1,t.text=_e.gpReadStringInt(this.data,this.settings.importer.encoding),this._lyrics.push(t)}}readPageSetup(){this.data.skip(30);for(let e=0;e<10;e++)_e.gpReadStringIntByte(this.data,this.settings.importer.encoding)}readPlaybackInfos(){this._playbackInfos=[];for(let e=0;e<64;e++){let t=new Nw;t.primaryChannel=e,t.secondaryChannel=e,t.program=v.readInt32LE(this.data),t.volume=this.data.readByte(),t.balance=this.data.readByte(),this.data.skip(6),this._playbackInfos.push(t)}}readMasterBars(){for(let e=0;e<this._barCount;e++)this.readMasterBar()}readMasterBar(){let e=null;this._score.masterBars.length>0&&(e=this._score.masterBars[this._score.masterBars.length-1]);let t=new mr,i=this.data.readByte();if(i&1?t.timeSignatureNumerator=this.data.readByte():e&&(t.timeSignatureNumerator=e.timeSignatureNumerator),i&2?t.timeSignatureDenominator=this.data.readByte():e&&(t.timeSignatureDenominator=e.timeSignatureDenominator),t.isRepeatStart=(i&4)!==0,i&8&&(t.repeatCount=this.data.readByte()+(this._versionNumber>=500?0:1)),i&16&&this._versionNumber<500){let r=e,n=0;for(;r&&!(r.isRepeatEnd&&r!==e||r.isRepeatStart);)n=n|r.alternateEndings,r=r.previousMasterBar;let a=0,o=this.data.readByte();for(let l=0;l<8;l++){let h=1<<l;o>l&&!(n&h)&&(a=a|h)}t.alternateEndings=a}if(i&32){let r=new xu;r.text=_e.gpReadStringIntByte(this.data,this.settings.importer.encoding),r.marker="",_e.gpReadColor(this.data,!1),t.section=r}if(i&64?(t.keySignature=v.readSInt8(this.data),t.keySignatureType=this.data.readByte()):e&&(t.keySignature=e.keySignature,t.keySignatureType=e.keySignatureType),this._versionNumber>=500&&i&3&&this.data.skip(4),this._versionNumber>=500&&(t.alternateEndings=this.data.readByte()),this._versionNumber>=500){switch(this.data.readByte()){case 1:t.tripletFeel=ce.Triplet8th;break;case 2:t.tripletFeel=ce.Triplet16th;break}this.data.readByte()}else t.tripletFeel=this._globalTripletFeel;t.isDoubleBar=(i&128)!==0,this._score.addMasterBar(t)}readTracks(){for(let e=0;e<this._trackCount;e++)this.readTrack()}readTrack(){let e=new Qs;e.ensureStaveCount(1),this._score.addTrack(e);let t=e.staves[0],i=this.data.readByte();e.name=_e.gpReadStringByteLength(this.data,40,this.settings.importer.encoding),i&1&&(t.isPercussion=!0),this._versionNumber>=500&&(e.isVisibleOnMultiTrack=(i&8)!==0);let r=v.readInt32LE(this.data),n=[];for(let h=0;h<7;h++){let u=v.readInt32LE(this.data);r>h&&n.push(u)}t.stringTuning.tunings=n;let a=v.readInt32LE(this.data),o=v.readInt32LE(this.data)-1,l=v.readInt32LE(this.data)-1;if(this.data.skip(4),o>=0&&o<this._playbackInfos.length){let h=this._playbackInfos[o];h.port=a,h.isSolo=(i&16)!==0,h.isMute=(i&32)!==0,h.secondaryChannel=l,nr.isGuitar(h.program)&&(t.displayTranspositionPitch=-12),e.playbackInfo=h}t.capo=v.readInt32LE(this.data),e.color=_e.gpReadColor(this.data,!1),this._versionNumber>=500&&(this.data.readByte(),this.data.readByte(),this.data.skip(43)),this._versionNumber>=510&&(this.data.skip(4),_e.gpReadStringIntByte(this.data,this.settings.importer.encoding),_e.gpReadStringIntByte(this.data,this.settings.importer.encoding))}readBars(){for(let e=0;e<this._barCount;e++)for(let t=0;t<this._trackCount;t++)this.readBar(this._score.tracks[t])}readBar(e){let t=new Sr,i=e.staves[0];i.isPercussion&&(t.clef=ie.Neutral),i.addBar(t);let r=1;this._versionNumber>=500&&(this.data.readByte(),r=2);for(let n=0;n<r;n++)this.readVoice(e,t)}readVoice(e,t){let i=v.readInt32LE(this.data);if(i===0)return;let r=new Js;t.addVoice(r);for(let n=0;n<i;n++)this.readBeat(e,t,r)}readBeat(e,t,i){let r=new Wt,n=this.data.readByte();if(n&1&&(r.dots=1),n&64){let u=this.data.readByte();r.isEmpty=(u&2)===0}switch(i.addBeat(r),v.readSInt8(this.data)){case-2:r.duration=k.Whole;break;case-1:r.duration=k.Half;break;case 0:r.duration=k.Quarter;break;case 1:r.duration=k.Eighth;break;case 2:r.duration=k.Sixteenth;break;case 3:r.duration=k.ThirtySecond;break;case 4:r.duration=k.SixtyFourth;break;default:r.duration=k.Quarter;break}if(n&32)switch(r.tupletNumerator=v.readInt32LE(this.data),r.tupletNumerator){case 1:r.tupletDenominator=1;break;case 3:r.tupletDenominator=2;break;case 5:case 6:case 7:r.tupletDenominator=4;break;case 9:case 10:case 11:case 12:case 13:r.tupletDenominator=8;break;case 2:case 4:case 8:break;default:r.tupletNumerator=1,r.tupletDenominator=1;break}n&2&&this.readChord(r);let o=this.settings.importer.beatTextAsLyrics&&e.index!==this._lyricsTrack;if(n&4){const u=_e.gpReadStringIntUnused(this.data,this.settings.importer.encoding);if(o){const c=new ct;c.text=u.trim(),c.finish(!0);const d=[];for(let p=c.chunks.length-1;p>=0;p--)d.push(c.chunks[p]);this._beatTextChunksByTrack.set(e.index,d)}else r.text=u}let l=X.None;n&8&&(l=this.readBeatEffects(r)),n&16&&this.readMixTableChange(r);let h=this.data.readByte();for(let u=6;u>=0;u--)if(h&1<<u&&6-u<t.staff.tuning.length){const c=this.readNote(e,t,i,r,6-u);l!==X.None&&(c.harmonicType=l,c.harmonicType===X.Natural&&(c.harmonicValue=this.deltaFretToHarmonicValue(c.fret)))}this._versionNumber>=500&&(this.data.readByte(),this.data.readByte()&8&&this.data.readByte()),o&&!r.isRest&&this._beatTextChunksByTrack.has(e.index)&&this._beatTextChunksByTrack.get(e.index).length>0&&(r.lyrics=[this._beatTextChunksByTrack.get(e.index).pop()])}readChord(e){let t=new $r,i=Re.newGuid();if(this._versionNumber>=500){this.data.skip(17),t.name=_e.gpReadStringByteLength(this.data,21,this.settings.importer.encoding),this.data.skip(4),t.firstFret=v.readInt32LE(this.data);for(let a=0;a<7;a++){let o=v.readInt32LE(this.data);a<e.voice.bar.staff.tuning.length&&t.strings.push(o)}let r=this.data.readByte(),n=new Uint8Array(5);this.data.read(n,0,n.length);for(let a=0;a<r;a++)t.barreFrets.push(n[a]);this.data.skip(26)}else if(this.data.readByte()!==0)if(this._versionNumber>=400){this.data.skip(16),t.name=_e.gpReadStringByteLength(this.data,21,this.settings.importer.encoding),this.data.skip(4),t.firstFret=v.readInt32LE(this.data);for(let a=0;a<7;a++){let o=v.readInt32LE(this.data);a<e.voice.bar.staff.tuning.length&&t.strings.push(o)}let r=this.data.readByte(),n=new Uint8Array(5);this.data.read(n,0,n.length);for(let a=0;a<r;a++)t.barreFrets.push(n[a]);this.data.skip(26)}else{this.data.skip(25),t.name=_e.gpReadStringByteLength(this.data,34,this.settings.importer.encoding),t.firstFret=v.readInt32LE(this.data);for(let r=0;r<6;r++){let n=v.readInt32LE(this.data);r<e.voice.bar.staff.tuning.length&&t.strings.push(n)}this.data.skip(36)}else{let r=this._versionNumber>=406?7:6;if(t.name=_e.gpReadStringIntByte(this.data,this.settings.importer.encoding),t.firstFret=v.readInt32LE(this.data),t.firstFret>0)for(let n=0;n<r;n++){let a=v.readInt32LE(this.data);n<e.voice.bar.staff.tuning.length&&t.strings.push(a)}}t.name&&(e.chordId=i,e.voice.bar.staff.addChord(e.chordId,t))}readBeatEffects(e){let t=this.data.readByte(),i=0;if(this._versionNumber>=400&&(i=this.data.readByte()),e.fadeIn=(t&16)!==0,(this._versionNumber<400&&t&1||t&2)&&(e.vibrato=Be.Slight),e.hasRasgueado=(i&1)!==0,t&32&&this._versionNumber>=400)switch(v.readSInt8(this.data)){case 1:e.tap=!0;break;case 2:e.slap=!0;break;case 3:e.pop=!0;break}else if(t&32){switch(v.readSInt8(this.data)){case 1:e.tap=!0;break;case 2:e.slap=!0;break;case 3:e.pop=!0;break}this.data.skip(4)}if(i&4&&this.readTremoloBarEffect(e),t&64){let r=0,n=0;this._versionNumber<500?(n=this.data.readByte(),r=this.data.readByte()):(r=this.data.readByte(),n=this.data.readByte()),r>0?(e.brushType=Ve.BrushUp,e.brushDuration=Os.toStrokeValue(r)):n>0&&(e.brushType=Ve.BrushDown,e.brushDuration=Os.toStrokeValue(n))}if(i&2)switch(v.readSInt8(this.data)){case 0:e.pickStroke=At.None;break;case 1:e.pickStroke=At.Up;break;case 2:e.pickStroke=At.Down;break}if(this._versionNumber<400){if(t&4)return X.Natural;if(t&8)return X.Artificial}return X.None}readTremoloBarEffect(e){this.data.readByte(),v.readInt32LE(this.data);let t=v.readInt32LE(this.data);if(t>0)for(let i=0;i<t;i++){let r=new A(0,0);r.offset=v.readInt32LE(this.data),r.value=v.readInt32LE(this.data)/Os.BendStep|0,_e.gpReadBool(this.data),e.addWhammyBarPoint(r)}}static toStrokeValue(e){switch(e){case 1:return 30;case 2:return 30;case 3:return 60;case 4:return 120;case 5:return 240;case 6:return 480;default:return 0}}readMixTableChange(e){let t=new jx;t.instrument=v.readSInt8(this.data),this._versionNumber>=500&&this.data.skip(16),t.volume=v.readSInt8(this.data),t.balance=v.readSInt8(this.data);let i=v.readSInt8(this.data),r=v.readSInt8(this.data),n=v.readSInt8(this.data),a=v.readSInt8(this.data);if(this._versionNumber>=500&&(t.tempoName=_e.gpReadStringIntByte(this.data,this.settings.importer.encoding)),t.tempo=v.readInt32LE(this.data),t.volume>=0&&this.data.readByte(),t.balance>=0&&this.data.readByte(),i>=0&&this.data.readByte(),r>=0&&this.data.readByte(),n>=0&&this.data.readByte(),a>=0&&this.data.readByte(),t.tempo>=0&&(t.duration=v.readSInt8(this.data),this._versionNumber>=510&&this.data.readByte()),this._versionNumber>=400&&this.data.readByte(),this._versionNumber>=500&&this.data.readByte(),this._versionNumber>=510&&(_e.gpReadStringIntByte(this.data,this.settings.importer.encoding),_e.gpReadStringIntByte(this.data,this.settings.importer.encoding)),t.volume>=0){let o=new Vt;o.isLinear=!0,o.type=gt.Volume,o.value=t.volume,e.automations.push(o)}if(t.balance>=0){let o=new Vt;o.isLinear=!0,o.type=gt.Balance,o.value=t.balance,e.automations.push(o)}if(t.instrument>=0){let o=new Vt;o.isLinear=!0,o.type=gt.Instrument,o.value=t.instrument,e.automations.push(o)}if(t.tempo>=0){let o=new Vt;o.isLinear=!0,o.type=gt.Tempo,o.value=t.tempo,e.automations.push(o),e.voice.bar.masterBar.tempoAutomations.push(o)}}readNote(e,t,i,r,n){let a=new je;a.string=t.staff.tuning.length-n;let o=this.data.readByte();if(o&2?a.accentuated=et.Heavy:o&64&&(a.accentuated=et.Normal),a.isGhost=(o&4)!==0,o&32){let h=this.data.readByte();h===3?a.isDead=!0:h===2&&(a.isTieDestination=!0)}if(o&1&&this._versionNumber<500&&(this.data.readByte(),this.data.readByte()),o&16){let h=v.readSInt8(this.data);a.dynamics=this.toDynamicValue(h),r.dynamics=a.dynamics}o&32&&(a.fret=v.readSInt8(this.data)),o&128&&(a.leftHandFinger=v.readSInt8(this.data),a.rightHandFinger=v.readSInt8(this.data),a.isFingering=!0);let l=!1;if(this._versionNumber>=500&&(o&1&&(a.durationPercent=_e.gpReadDouble(this.data)),l=(this.data.readByte()&2)!==0),r.addNote(a),o&8&&this.readNoteEffects(e,i,r,a),t.staff.isPercussion&&(a.percussionArticulation=a.fret,a.string=-1,a.fret=-1),l){const h=R.defaultAccidentals[a.realValueWithoutHarmonic%12];h==="#"?a.accidentalMode=ot.ForceFlat:h==="b"&&(a.accidentalMode=ot.ForceSharp)}return a}toDynamicValue(e){switch(e){case 1:return de.PPP;case 2:return de.PP;case 3:return de.P;case 4:return de.MP;case 5:return de.MF;case 6:return de.F;case 7:return de.FF;case 8:return de.FFF;default:return de.F}}readNoteEffects(e,t,i,r){let n=this.data.readByte(),a=0;this._versionNumber>=400&&(a=this.data.readByte()),n&1&&this.readBend(r),n&16&&this.readGrace(t,r),a&4&&this.readTremoloPicking(i),a&8?this.readSlide(r):this._versionNumber<400&&n&4&&(r.slideOutType=ne.Shift),a&16&&this.readArtificialHarmonic(r),a&32&&this.readTrill(r),r.isLetRing=(n&8)!==0,r.isHammerPullOrigin=(n&2)!==0,a&64&&(r.vibrato=Be.Slight),r.isPalmMute=(a&2)!==0,r.isStaccato=(a&1)!==0}readBend(e){this.data.readByte(),v.readInt32LE(this.data);let t=v.readInt32LE(this.data);if(t>0)for(let i=0;i<t;i++){let r=new A(0,0);r.offset=v.readInt32LE(this.data),r.value=v.readInt32LE(this.data)/Os.BendStep|0,_e.gpReadBool(this.data),e.addBendPoint(r)}}readGrace(e,t){let i=new Wt,r=new je;switch(r.string=t.string,r.fret=v.readSInt8(this.data),i.duration=k.ThirtySecond,i.dynamics=this.toDynamicValue(v.readSInt8(this.data)),v.readSInt8(this.data)){case 0:break;case 1:r.slideOutType=ne.Legato,r.slideTarget=t;break;case 2:break;case 3:r.isHammerPullOrigin=!0;break}if(r.dynamics=i.dynamics,this.data.skip(1),this._versionNumber<500)i.graceType=$.BeforeBeat;else{let a=this.data.readByte();r.isDead=(a&1)!==0,i.graceType=a&2?$.OnBeat:$.BeforeBeat}e.addGraceBeat(i),i.addNote(r)}readTremoloPicking(e){switch(this.data.readByte()){case 1:e.tremoloSpeed=k.Eighth;break;case 2:e.tremoloSpeed=k.Sixteenth;break;case 3:e.tremoloSpeed=k.ThirtySecond;break}}readSlide(e){if(this._versionNumber>=500){let t=v.readSInt8(this.data);t&1?e.slideOutType=ne.Shift:t&2?e.slideOutType=ne.Legato:t&4?e.slideOutType=ne.OutDown:t&8&&(e.slideOutType=ne.OutUp),t&16?e.slideInType=vt.IntoFromBelow:t&32&&(e.slideInType=vt.IntoFromAbove)}else switch(v.readSInt8(this.data)){case 1:e.slideOutType=ne.Shift;break;case 2:e.slideOutType=ne.Legato;break;case 3:e.slideOutType=ne.OutDown;break;case 4:e.slideOutType=ne.OutUp;break;case-1:e.slideInType=vt.IntoFromBelow;break;case-2:e.slideInType=vt.IntoFromAbove;break}}readArtificialHarmonic(e){let t=this.data.readByte();if(this._versionNumber>=500)switch(t){case 1:e.harmonicType=X.Natural,e.harmonicValue=this.deltaFretToHarmonicValue(e.fret);break;case 2:this.data.readByte(),this.data.readByte(),this.data.readByte(),e.harmonicType=X.Artificial;break;case 3:e.harmonicType=X.Tap,e.harmonicValue=this.deltaFretToHarmonicValue(this.data.readByte());break;case 4:e.harmonicType=X.Pinch,e.harmonicValue=12;break;case 5:e.harmonicType=X.Semi,e.harmonicValue=12;break}else if(this._versionNumber>=400)switch(t){case 1:e.harmonicType=X.Natural;break;case 3:e.harmonicType=X.Tap;break;case 4:e.harmonicType=X.Pinch;break;case 5:e.harmonicType=X.Semi;break;case 15:e.harmonicType=X.Artificial;break;case 17:e.harmonicType=X.Artificial;break;case 22:e.harmonicType=X.Artificial;break}}deltaFretToHarmonicValue(e){switch(e){case 2:return 2.4;case 3:return 3.2;case 4:case 5:case 7:case 9:case 12:case 16:case 17:case 19:case 24:return e;case 8:return 8.2;case 10:return 9.6;case 14:case 15:return 14.7;case 21:case 22:return 21.7;default:return 12}}readTrill(e){switch(e.trillValue=this.data.readByte()+e.stringTuning,this.data.readByte()){case 1:e.trillSpeed=k.Sixteenth;break;case 2:e.trillSpeed=k.ThirtySecond;break;case 3:e.trillSpeed=k.SixtyFourth;break}}}Os.VersionString="FICHIER GUITAR PRO ";Os.BendStep=25;class _e{static gpReadDouble(e){let t=new Uint8Array(8);return e.read(t,0,t.length),new Float64Array(t.buffer)[0]}static gpReadFloat(e){let t=new Uint8Array(4);return t[3]=e.readByte(),t[2]=e.readByte(),t[2]=e.readByte(),t[1]=e.readByte(),new Float32Array(t.buffer)[0]}static gpReadColor(e,t=!1){let i=e.readByte(),r=e.readByte(),n=e.readByte(),a=255;return t?a=e.readByte():e.skip(1),new Ce(i,r,n,a)}static gpReadBool(e){return e.readByte()!==0}static gpReadStringIntUnused(e,t){return e.skip(4),_e.gpReadString(e,e.readByte(),t)}static gpReadStringInt(e,t){return _e.gpReadString(e,v.readInt32LE(e),t)}static gpReadStringIntByte(e,t){let i=v.readInt32LE(e)-1;return e.readByte(),_e.gpReadString(e,i,t)}static gpReadString(e,t,i){let r=new Uint8Array(t);return e.read(r,0,r.length),v.toString(r,i)}static gpWriteString(e,t){const i=v.stringToBytes(t);e.writeByte(t.length),e.write(i,0,i.length)}static gpReadStringByteLength(e,t,i){let r=e.readByte(),n=_e.gpReadString(e,r,i);return r<t&&e.skip(t-r),n}}class jx{constructor(){this.volume=-1,this.balance=-1,this.instrument=-1,this.tempoName="",this.tempo=-1,this.duration=-1}}class si{constructor(){this.x=0,this.y=0,this.w=0,this.h=0}}var ds;(function(s){s[s.Boolean=0]="Boolean",s[s.Integer=1]="Integer",s[s.Float=2]="Float",s[s.String=3]="String",s[s.Point=4]="Point",s[s.Size=5]="Size",s[s.Rectangle=6]="Rectangle",s[s.Color=7]="Color"})(ds||(ds={}));class vu{constructor(e){this.raw=new Map;let t=Tt.fromBuffer(e),i=v.readInt32BE(t);for(let r=0;r<i;r++){let n=_e.gpReadString(t,t.readByte(),"utf-8");switch(t.readByte()){case ds.Boolean:let o=t.readByte()===1;this.addValue(n,o);break;case ds.Integer:let l=v.readInt32BE(t);this.addValue(n,l);break;case ds.Float:let h=_e.gpReadFloat(t);this.addValue(n,h);break;case ds.String:let u=_e.gpReadString(t,v.readInt16BE(t),"utf-8");this.addValue(n,u);break;case ds.Point:let c=v.readInt32BE(t),d=v.readInt32BE(t);this.addValue(n,new A(c,d));break;case ds.Size:let p=v.readInt32BE(t),g=v.readInt32BE(t);this.addValue(n,new A(p,g));break;case ds.Rectangle:let w=new si;w.x=v.readInt32BE(t),w.y=v.readInt32BE(t),w.w=v.readInt32BE(t),w.h=v.readInt32BE(t),this.addValue(n,w);break;case ds.Color:let S=_e.gpReadColor(t,!0);this.addValue(n,S);break}}}apply(e){for(const[t,i]of this.raw)switch(t){case"StandardNotation/hideDynamics":e.stylesheet.hideDynamics=i;break}}addValue(e,t){this.raw.set(e,t)}static writeForScore(e){const t=Tt.withCapacity(128);return v.writeInt32BE(t,1),vu.writeBooleanEntry(t,"StandardNotation/hideDynamics",e.stylesheet.hideDynamics),t.toArray()}static writeBooleanEntry(e,t,i){_e.gpWriteString(e,t),e.writeByte(ds.Boolean),e.writeByte(i?1:0)}}var Ts;(function(s){s[s.Short=0]="Short",s[s.Medium=1]="Medium",s[s.Long=2]="Long"})(Ts||(Ts={}));class ep{constructor(){this.type=Ts.Short,this.length=0}}var L;(function(s){s[s.None=0]="None",s[s.Element=1]="Element",s[s.Text=2]="Text",s[s.CDATA=3]="CDATA",s[s.Document=4]="Document",s[s.DocumentType=5]="DocumentType"})(L||(L={}));class ys{constructor(){this.nodeType=L.None,this.localName=null,this.value=null,this.childNodes=[],this.attributes=new Map,this.firstChild=null,this.firstElement=null}addChild(e){this.childNodes.push(e),this.firstChild=e,(e.nodeType===L.Element||e.nodeType===L.CDATA)&&(this.firstElement=e)}getAttribute(e){return this.attributes.has(e)?this.attributes.get(e):""}getElementsByTagName(e,t=!1){let i=[];return this.searchElementsByTagName(this.childNodes,i,e,t),i}searchElementsByTagName(e,t,i,r=!1){for(let n of e)n&&n.nodeType===L.Element&&n.localName===i&&t.push(n),r&&this.searchElementsByTagName(n.childNodes,t,i,!0)}findChildElement(e){for(let t of this.childNodes)if(t&&t.nodeType===L.Element&&t.localName===e)return t;return null}addElement(e){const t=new ys;return t.nodeType=L.Element,t.localName=e,this.addChild(t),t}get innerText(){var e;if(this.nodeType===L.Element||this.nodeType===L.Document){if(this.firstElement&&this.firstElement.nodeType===L.CDATA)return this.firstElement.innerText;let t="";for(let r of this.childNodes)t+=(e=r.innerText)==null?void 0:e.toString();return t.trim()}return this.value??""}set innerText(e){const t=new ys;t.nodeType=L.Text,t.value=e,this.childNodes=[t]}setCData(e){const t=new ys;t.nodeType=L.CDATA,t.value=e,this.childNodes=[t]}}class yi extends Pt{constructor(e,t,i){super(Nt.Format,e),this.pos=0,this.xml=t,this.pos=i,Object.setPrototypeOf(this,yi.prototype)}}var Z;(function(s){s[s.IgnoreSpaces=0]="IgnoreSpaces",s[s.Begin=1]="Begin",s[s.BeginNode=2]="BeginNode",s[s.TagName=3]="TagName",s[s.Body=4]="Body",s[s.AttribName=5]="AttribName",s[s.Equals=6]="Equals",s[s.AttvalBegin=7]="AttvalBegin",s[s.AttribVal=8]="AttribVal",s[s.Childs=9]="Childs",s[s.Close=10]="Close",s[s.WaitEnd=11]="WaitEnd",s[s.WaitEndRet=12]="WaitEndRet",s[s.Pcdata=13]="Pcdata",s[s.Header=14]="Header",s[s.Comment=15]="Comment",s[s.Doctype=16]="Doctype",s[s.Cdata=17]="Cdata",s[s.Escape=18]="Escape"})(Z||(Z={}));class z{static parse(e,t,i){let r=e.charCodeAt(t),n=Z.Begin,a=Z.Begin,o=0,l="",h=Z.Begin,u=null,c=null,d=0,p=0;for(;t<e.length;){switch(r=e.charCodeAt(t),n){case Z.IgnoreSpaces:switch(r){case z.CharCodeLF:case z.CharCodeCR:case z.CharCodeTab:case z.CharCodeSpace:break;default:n=a;continue}break;case Z.Begin:switch(r){case z.CharCodeLowerThan:n=Z.IgnoreSpaces,a=Z.BeginNode;break;default:o=t,n=Z.Pcdata;continue}break;case Z.Pcdata:if(r===z.CharCodeLowerThan){l+=e.substr(o,t-o);let g=new ys;g.nodeType=L.Text,g.value=l,l="",i.addChild(g),n=Z.IgnoreSpaces,a=Z.BeginNode}else r===z.CharCodeAmp&&(l+=e.substr(o,t-o),n=Z.Escape,h=Z.Pcdata,o=t+1);break;case Z.Cdata:if(r===z.CharCodeBrackedClose&&e.charCodeAt(t+1)===z.CharCodeBrackedClose&&e.charCodeAt(t+2)===z.CharCodeGreaterThan){let g=new ys;g.nodeType=L.CDATA,g.value=e.substr(o,t-o),i.addChild(g),t+=2,n=Z.Begin}break;case Z.BeginNode:switch(r){case z.CharCodeExclamation:if(e.charCodeAt(t+1)===z.CharCodeBrackedOpen){if(t+=2,e.substr(t,6).toUpperCase()!=="CDATA[")throw new yi("Expected <![CDATA[",e,t);t+=5,n=Z.Cdata,o=t+1}else if(e.charCodeAt(t+1)===z.CharCodeUpperD||e.charCodeAt(t+1)===z.CharCodeLowerD){if(e.substr(t+2,6).toUpperCase()!=="OCTYPE")throw new yi("Expected <!DOCTYPE",e,t);t+=8,n=Z.Doctype,o=t+1}else{if(e.charCodeAt(t+1)!==z.CharCodeMinus||e.charCodeAt(t+2)!==z.CharCodeMinus)throw new yi("Expected <!--",e,t);t+=2,n=Z.Comment,o=t+1}break;case z.CharCodeQuestion:n=Z.Header,o=t;break;case z.CharCodeSlash:if(!i)throw new yi("Expected node name",e,t);o=t+1,n=Z.IgnoreSpaces,a=Z.Close;break;default:n=Z.TagName,o=t;continue}break;case Z.TagName:if(!z.isValidChar(r)){if(t===o)throw new yi("Expected node name",e,t);u=new ys,u.nodeType=L.Element,u.localName=e.substr(o,t-o),i.addChild(u),n=Z.IgnoreSpaces,a=Z.Body;continue}break;case Z.Body:switch(r){case z.CharCodeSlash:n=Z.WaitEnd;break;case z.CharCodeGreaterThan:n=Z.Childs;break;default:n=Z.AttribName,o=t;continue}break;case Z.AttribName:if(!z.isValidChar(r)){if(o===t)throw new yi("Expected attribute name",e,t);if(c=e.substr(o,t-o),u.attributes.has(c))throw new yi(`Duplicate attribute [${c}]`,e,t);n=Z.IgnoreSpaces,a=Z.Equals;continue}break;case Z.Equals:switch(r){case z.CharCodeEquals:n=Z.IgnoreSpaces,a=Z.AttvalBegin;break;default:throw new yi("Expected =",e,t)}break;case Z.AttvalBegin:switch(r){case z.CharCodeDoubleQuote:case z.CharCodeSingleQuote:l="",n=Z.AttribVal,o=t+1,p=r;break}break;case Z.AttribVal:switch(r){case z.CharCodeAmp:l+=e.substr(o,t-o),n=Z.Escape,h=Z.AttribVal,o=t+1;break;default:if(r===p){l+=e.substr(o,t-o);let g=l;l="",u.attributes.set(c,g),n=Z.IgnoreSpaces,a=Z.Body}break}break;case Z.Childs:t=z.parse(e,t,u),o=t,n=Z.Begin;break;case Z.WaitEnd:switch(r){case z.CharCodeGreaterThan:n=Z.Begin;break;default:throw new yi("Expected >",e,t)}break;case Z.WaitEndRet:switch(r){case z.CharCodeGreaterThan:return t;default:throw new yi("Expected >",e,t)}case Z.Close:if(!z.isValidChar(r)){if(o===t)throw new yi("Expected node name",e,t);if(e.substr(o,t-o)!==i.localName)throw new yi("Expected </"+i.localName+">",e,t);n=Z.IgnoreSpaces,a=Z.WaitEndRet;continue}break;case Z.Comment:r===z.CharCodeMinus&&e.charCodeAt(t+1)===z.CharCodeMinus&&e.charCodeAt(t+2)===z.CharCodeGreaterThan&&(t+=2,n=Z.Begin);break;case Z.Doctype:if(r===z.CharCodeBrackedOpen)d++;else if(r===z.CharCodeBrackedClose)d--;else if(r===z.CharCodeGreaterThan&&d===0){let g=new ys;g.nodeType=L.DocumentType,g.value=e.substr(o,t-o),i.addChild(g),n=Z.Begin}break;case Z.Header:r===z.CharCodeQuestion&&e.charCodeAt(t+1)===z.CharCodeGreaterThan&&(t++,n=Z.Begin);break;case Z.Escape:if(r===z.CharCodeSemi){let g=e.substr(o,t-o);if(g.charCodeAt(0)===z.CharCodeSharp){let w=g.charCodeAt(1)===z.CharCodeLowerX?parseInt("0"+g.substr(1,g.length-1)):parseInt(g.substr(1,g.length-1));l+=String.fromCharCode(w)}else z.Escapes.has(g)?l+=z.Escapes.get(g):l+=("&"+g+";").toString();o=t+1,n=h}else!z.isValidChar(r)&&r!==z.CharCodeSharp&&(l+="&",l+=e.substr(o,t-o),t--,o=t+1,n=h);break}t++}if(n===Z.Begin&&(o=t,n=Z.Pcdata),n===Z.Pcdata){if(t!==o){l+=e.substr(o,t-o);let g=new ys;g.nodeType=L.Text,g.value=l,i.addChild(g)}return t}if(n===Z.Escape&&h===Z.Pcdata){l+="&",l+=e.substr(o,t-o);let g=new ys;return g.nodeType=L.Text,g.value=l,i.addChild(g),t}throw new yi("Unexpected end",e,t)}static isValidChar(e){return e>=z.CharCodeLowerA&&e<=z.CharCodeLowerZ||e>=z.CharCodeUpperA&&e<=z.CharCodeUpperZ||e>=z.CharCode0&&e<=z.CharCode9||e===z.CharCodeColon||e===z.CharCodeDot||e===z.CharCodeUnderscore||e===z.CharCodeMinus}}z.CharCodeLF=10;z.CharCodeTab=9;z.CharCodeCR=13;z.CharCodeSpace=32;z.CharCodeLowerThan=60;z.CharCodeAmp=38;z.CharCodeBrackedClose=93;z.CharCodeBrackedOpen=91;z.CharCodeGreaterThan=62;z.CharCodeExclamation=33;z.CharCodeUpperD=68;z.CharCodeLowerD=100;z.CharCodeMinus=45;z.CharCodeQuestion=63;z.CharCodeSlash=47;z.CharCodeEquals=61;z.CharCodeDoubleQuote=34;z.CharCodeSingleQuote=39;z.CharCodeSharp=35;z.CharCodeLowerX=120;z.CharCodeLowerA=97;z.CharCodeLowerZ=122;z.CharCodeUpperA=65;z.CharCodeUpperZ=90;z.CharCode0=48;z.CharCode9=57;z.CharCodeColon=58;z.CharCodeDot=46;z.CharCodeUnderscore=95;z.CharCodeSemi=59;z.Escapes=new Map([["lt","<"],["gt",">"],["amp","&"],["quot",'"'],["apos","'"]]);class tp{static write(e,t,i){const r=new tp(t,i);return r.writeNode(e),r.toString()}constructor(e,t){this._result=[],this._indention=e,this._xmlHeader=t,this._currentIndention="",this._isStartOfLine=!0}writeNode(e){switch(e.nodeType){case L.None:break;case L.Element:this._result.length>0&&this.writeLine(),this.write(`<${e.localName}`);for(const[t,i]of e.attributes)this.write(` ${t}="`),this.writeAttributeValue(i),this.write('"');if(e.childNodes.length===0)this.write("/>");else{if(this.write(">"),e.childNodes.length===1&&!e.firstElement)this.writeNode(e.childNodes[0]);else{this.indent();for(const t of e.childNodes)t.nodeType===L.Element&&this.writeNode(t);this.unindend(),this.writeLine()}this.write(`</${e.localName}>`)}break;case L.Text:e.value&&this.write(e.value);break;case L.CDATA:e.value!==null&&this.write(`<![CDATA[${e.value}]]>`);break;case L.Document:this._xmlHeader&&this.write('<?xml version="1.0" encoding="utf-8"?>');for(const t of e.childNodes)this.writeNode(t);break;case L.DocumentType:this.write(`<!DOCTYPE ${e.value}>`);break}}unindend(){this._currentIndention=this._currentIndention.substr(0,this._currentIndention.length-this._indention.length)}indent(){this._currentIndention+=this._indention}writeAttributeValue(e){for(let t=0;t<e.length;t++){const i=e.charAt(t);switch(i){case"<":this._result.push("&lt;");break;case">":this._result.push("&gt;");break;case"&":this._result.push("&amp;");break;case"'":this._result.push("&apos;");break;case'"':this._result.push("&quot;");break;default:this._result.push(i);break}}}write(e){this._isStartOfLine&&this._result.push(this._currentIndention),this._result.push(e),this._isStartOfLine=!1}writeLine(e=null){e&&this.write(e),this._indention.length>0&&!this._isStartOfLine&&(this._result.push(`
`),this._isStartOfLine=!0)}toString(){return this._result.join("").trimRight()}}class Mh extends ys{constructor(){super(),this.nodeType=L.Document}parse(e){z.parse(e,0,this)}toString(){return this.toFormattedString()}toFormattedString(e="",t=!1){return tp.write(this,e,t)}}var E;(function(s){s[s.Up=0]="Up",s[s.Down=1]="Down"})(E||(E={}));class Zx{constructor(){this.id="",this.dots=0,this.tupletDenominator=-1,this.tupletNumerator=-1,this.value=k.Quarter}}class ev{constructor(){this.name="",this.path="",this.role="",this.program=0}get uniqueId(){return this.path+";"+this.name+";"+this.role}}class rs{constructor(){this._hasAnacrusis=!1,this._skipApplyLyrics=!1}parseXml(e,t){this._masterTrackAutomations=new Map,this._automationsPerTrackIdAndBarIndex=new Map,this._tracksMapping=[],this._tracksById=new Map,this._masterBars=[],this._barsOfMasterBar=[],this._voicesOfBar=new Map,this._barsById=new Map,this._voiceById=new Map,this._beatsOfVoice=new Map,this._beatById=new Map,this._rhythmOfBeat=new Map,this._rhythmById=new Map,this._notesOfBeat=new Map,this._noteById=new Map,this._tappedNotes=new Map,this._lyricsByTrack=new Map,this._soundsByTrack=new Map,this._skipApplyLyrics=!1;let i=new Mh;try{i.parse(e)}catch(r){throw new Ye("Could not parse XML",r)}if(this.parseDom(i),this.buildModel(),this.score.finish(t),!this._skipApplyLyrics&&this._lyricsByTrack.size>0)for(const[r,n]of this._lyricsByTrack)this._tracksById.get(r).applyLyrics(n)}parseDom(e){let t=e.firstElement;if(t)if(t.localName==="GPIF"){this.score=new Rn;for(let i of t.childNodes)if(i.nodeType===L.Element)switch(i.localName){case"Score":this.parseScoreNode(i);break;case"MasterTrack":this.parseMasterTrackNode(i);break;case"Tracks":this.parseTracksNode(i);break;case"MasterBars":this.parseMasterBarsNode(i);break;case"Bars":this.parseBars(i);break;case"Voices":this.parseVoices(i);break;case"Beats":this.parseBeats(i);break;case"Notes":this.parseNotes(i);break;case"Rhythms":this.parseRhythms(i);break}}else throw new Ye("Root node of XML was not GPIF")}parseScoreNode(e){for(let t of e.childNodes)if(t.nodeType===L.Element)switch(t.localName){case"Title":this.score.title=t.firstChild.innerText;break;case"SubTitle":this.score.subTitle=t.firstChild.innerText;break;case"Artist":this.score.artist=t.firstChild.innerText;break;case"Album":this.score.album=t.firstChild.innerText;break;case"Words":this.score.words=t.firstChild.innerText;break;case"Music":this.score.music=t.firstChild.innerText;break;case"WordsAndMusic":if(t.firstChild&&t.firstChild.innerText!==""){let i=t.firstChild.innerText;i&&!this.score.words&&(this.score.words=i),i&&!this.score.music&&(this.score.music=i)}break;case"Copyright":this.score.copyright=t.firstChild.innerText;break;case"Tabber":this.score.tab=t.firstChild.innerText;break;case"Instructions":this.score.instructions=t.firstChild.innerText;break;case"Notices":this.score.notices=t.firstChild.innerText;break;case"ScoreSystemsDefaultLayout":this.score.defaultSystemsLayout=parseInt(t.innerText);break;case"ScoreSystemsLayout":this.score.systemsLayout=t.innerText.split(" ").map(i=>parseInt(i));break}}parseMasterTrackNode(e){for(let t of e.childNodes)if(t.nodeType===L.Element)switch(t.localName){case"Automations":this.parseAutomations(t,this._masterTrackAutomations,null);break;case"Tracks":this._tracksMapping=t.innerText.split(" ");break;case"Anacrusis":this._hasAnacrusis=!0;break}}parseAutomations(e,t,i){for(let r of e.childNodes)if(r.nodeType===L.Element)switch(r.localName){case"Automation":this.parseAutomation(r,t,i);break}}parseAutomation(e,t,i){let r=null,n=!1,a=-1,o=0,l=0,h=null,u=0,c=null;for(let p of e.childNodes)if(p.nodeType===L.Element)switch(p.localName){case"Type":r=p.innerText;break;case"Linear":n=p.innerText.toLowerCase()==="true";break;case"Bar":a=parseInt(p.innerText);break;case"Position":o=parseFloat(p.innerText);break;case"Value":if(p.firstElement&&p.firstElement.nodeType===L.CDATA)h=p.innerText;else{let g=p.innerText.split(" ");g.length===1?(l=parseFloat(g[0]),u=1):(l=parseFloat(g[0]),u=parseInt(g[1]))}break;case"Text":c=p.innerText;break}if(!r)return;let d=null;switch(r){case"Tempo":d=Vt.buildTempoAutomation(n,o,l,u);break;case"Sound":h&&i&&i.has(h)&&(d=Vt.buildInstrumentAutomation(n,o,i.get(h).program));break}d&&(c&&(d.text=c),a>=0&&(t.has(a)||t.set(a,[]),t.get(a).push(d)))}parseTracksNode(e){for(let t of e.childNodes)if(t.nodeType===L.Element)switch(t.localName){case"Track":this.parseTrack(t);break}}parseTrack(e){this._articulationByName=new Map;let t=new Qs;t.ensureStaveCount(1);let i=t.staves[0];i.showStandardNotation=!0;let r=e.getAttribute("id");for(let n of e.childNodes)if(n.nodeType===L.Element)switch(n.localName){case"Name":t.name=n.innerText;break;case"Color":let a=n.innerText.split(" ");if(a.length>=3){let h=parseInt(a[0]),u=parseInt(a[1]),c=parseInt(a[2]);t.color=new Ce(h,u,c,255)}break;case"Instrument":let o=n.getAttribute("ref");(o.endsWith("-gs")||o.endsWith("GrandStaff"))&&(t.ensureStaveCount(2),t.staves[1].showStandardNotation=!0);break;case"InstrumentSet":this.parseInstrumentSet(t,n);break;case"NotationPatch":this.parseNotationPatch(t,n);break;case"ShortName":t.shortName=n.innerText;break;case"SystemsDefautLayout":t.defaultSystemsLayout=parseInt(n.innerText);break;case"SystemsLayout":t.systemsLayout=n.innerText.split(" ").map(h=>parseInt(h));break;case"Lyrics":this.parseLyrics(r,n);break;case"Properties":this.parseTrackProperties(t,n);break;case"GeneralMidi":case"MidiConnection":case"MIDISettings":this.parseGeneralMidi(t,n);break;case"Sounds":this.parseSounds(r,t,n);break;case"PlaybackState":let l=n.innerText;t.playbackInfo.isSolo=l==="Solo",t.playbackInfo.isMute=l==="Mute";break;case"PartSounding":this.parsePartSounding(t,n);break;case"Staves":this.parseStaves(t,n);break;case"Transpose":this.parseTranspose(t,n);break;case"RSE":this.parseRSE(t,n);break;case"Automations":this.parseTrackAutomations(r,n);break}this._tracksById.set(r,t)}parseTrackAutomations(e,t){const i=new Map;this._automationsPerTrackIdAndBarIndex.set(e,i),this.parseAutomations(t,i,this._soundsByTrack.get(e))}parseNotationPatch(e,t){for(let i of t.childNodes)if(i.nodeType===L.Element)switch(i.localName){case"LineCount":const r=parseInt(i.innerText);for(let n of e.staves)n.standardNotationLineCount=r;break;case"Elements":this.parseElements(e,i);break}}parseInstrumentSet(e,t){for(let i of t.childNodes)if(i.nodeType===L.Element)switch(i.localName){case"Type":switch(i.innerText){case"drumKit":for(let n of e.staves)n.isPercussion=!0;break}if(i.innerText==="drumKit")for(let n of e.staves)n.isPercussion=!0;break;case"Elements":this.parseElements(e,i);break;case"LineCount":const r=parseInt(i.innerText);for(let n of e.staves)n.standardNotationLineCount=r;break}}parseElements(e,t){for(let i of t.childNodes)if(i.nodeType===L.Element)switch(i.localName){case"Element":this.parseElement(e,i);break}}parseElement(e,t){const i=t.findChildElement("Type"),r=i?i.innerText:"";for(let n of t.childNodes)if(n.nodeType===L.Element)switch(n.localName){case"Name":case"Articulations":this.parseArticulations(e,n,r);break}}parseArticulations(e,t,i){for(let r of t.childNodes)if(r.nodeType===L.Element)switch(r.localName){case"Articulation":this.parseArticulation(e,r,i);break}}parseArticulation(e,t,i){const r=new O;r.outputMidiNumber=-1,r.elementType=i;let n="";for(let a of t.childNodes)if(a.nodeType===L.Element){const o=a.innerText;switch(a.localName){case"Name":n=a.innerText;break;case"OutputMidiNumber":o.length>0&&(r.outputMidiNumber=parseInt(o));break;case"TechniqueSymbol":r.techniqueSymbol=this.parseTechniqueSymbol(o);break;case"TechniquePlacement":switch(o){case"outside":r.techniqueSymbolPlacement=te.Bottom;break;case"inside":r.techniqueSymbolPlacement=te.Middle;break;case"above":r.techniqueSymbolPlacement=te.Bottom;break;case"below":r.techniqueSymbolPlacement=te.Top;break}break;case"Noteheads":const l=o.split(" ");l.length>=1&&(r.noteHeadDefault=this.parseNoteHead(l[0])),l.length>=2&&(r.noteHeadHalf=this.parseNoteHead(l[1])),l.length>=3&&(r.noteHeadWhole=this.parseNoteHead(l[2])),r.noteHeadHalf==f.None&&(r.noteHeadHalf=r.noteHeadDefault),r.noteHeadWhole==f.None&&(r.noteHeadWhole=r.noteHeadDefault);break;case"StaffLine":o.length>0&&(r.staffLine=parseInt(o));break}}r.outputMidiNumber!==-1?(e.percussionArticulations.push(r),n.length>0&&this._articulationByName.set(n,r)):n.length>0&&this._articulationByName.has(n)&&(this._articulationByName.get(n).staffLine=r.staffLine)}parseTechniqueSymbol(e){switch(e){case"pictEdgeOfCymbal":return f.PictEdgeOfCymbal;case"articStaccatoAbove":return f.ArticStaccatoAbove;case"noteheadParenthesis":return f.NoteheadParenthesis;case"stringsUpBow":return f.StringsUpBow;case"stringsDownBow":return f.StringsDownBow;case"guitarGolpe":return f.GuitarGolpe;default:return f.None}}parseNoteHead(e){switch(e){case"noteheadDoubleWholeSquare":return f.NoteheadDoubleWholeSquare;case"noteheadDoubleWhole":return f.NoteheadDoubleWhole;case"noteheadWhole":return f.NoteheadWhole;case"noteheadHalf":return f.NoteheadHalf;case"noteheadBlack":return f.NoteheadBlack;case"noteheadNull":return f.NoteheadNull;case"noteheadXOrnate":return f.NoteheadXOrnate;case"noteheadTriangleUpWhole":return f.NoteheadTriangleUpWhole;case"noteheadTriangleUpHalf":return f.NoteheadTriangleUpHalf;case"noteheadTriangleUpBlack":return f.NoteheadTriangleUpBlack;case"noteheadDiamondBlackWide":return f.NoteheadDiamondBlackWide;case"noteheadDiamondWhite":return f.NoteheadDiamondWhite;case"noteheadDiamondWhiteWide":return f.NoteheadDiamondWhiteWide;case"noteheadCircleX":return f.NoteheadCircleX;case"noteheadXWhole":return f.NoteheadXWhole;case"noteheadXHalf":return f.NoteheadXHalf;case"noteheadXBlack":return f.NoteheadXBlack;case"noteheadParenthesis":return f.NoteheadParenthesis;case"noteheadSlashedBlack2":return f.NoteheadSlashedBlack2;case"noteheadCircleSlash":return f.NoteheadCircleSlash;case"noteheadHeavyX":return f.NoteheadHeavyX;case"noteheadHeavyXHat":return f.NoteheadHeavyXHat;default:return C.warning("GPIF","Unknown notehead symbol",e),f.None}}parseStaves(e,t){let i=0;for(let r of t.childNodes)if(r.nodeType===L.Element)switch(r.localName){case"Staff":e.ensureStaveCount(i+1);let n=e.staves[i];this.parseStaff(n,r),i++;break}}parseStaff(e,t){for(let i of t.childNodes)if(i.nodeType===L.Element)switch(i.localName){case"Properties":this.parseStaffProperties(e,i);break}}parseStaffProperties(e,t){for(let i of t.childNodes)if(i.nodeType===L.Element)switch(i.localName){case"Property":this.parseStaffProperty(e,i);break}}parseStaffProperty(e,t){switch(t.getAttribute("name")){case"Tuning":for(let n of t.childNodes)if(n.nodeType===L.Element)switch(n.localName){case"Pitches":let a=t.findChildElement("Pitches").innerText.split(" "),o=new Array(a.length);for(let l=0;l<o.length;l++)o[o.length-1-l]=parseInt(a[l]);e.stringTuning.tunings=o;break;case"Label":e.stringTuning.name=n.innerText;break}e.isPercussion||(e.showTablature=!0);break;case"DiagramCollection":case"ChordCollection":this.parseDiagramCollectionForStaff(e,t);break;case"CapoFret":let r=parseInt(t.findChildElement("Fret").innerText);e.capo=r;break}}parseLyrics(e,t){let i=[];for(let r of t.childNodes)if(r.nodeType===L.Element)switch(r.localName){case"Line":i.push(this.parseLyricsLine(r));break}this._lyricsByTrack.set(e,i)}parseLyricsLine(e){let t=new ct;for(let i of e.childNodes)if(i.nodeType===L.Element)switch(i.localName){case"Offset":t.startBar=parseInt(i.innerText);break;case"Text":t.text=i.innerText;break}return t}parseDiagramCollectionForTrack(e,t){let i=t.findChildElement("Items");for(let r of i.childNodes)if(r.nodeType===L.Element)switch(r.localName){case"Item":this.parseDiagramItemForTrack(e,r);break}}parseDiagramCollectionForStaff(e,t){let i=t.findChildElement("Items");for(let r of i.childNodes)if(r.nodeType===L.Element)switch(r.localName){case"Item":this.parseDiagramItemForStaff(e,r);break}}parseDiagramItemForTrack(e,t){let i=new $r,r=t.getAttribute("id");for(let n of e.staves)n.addChord(r,i);this.parseDiagramItemForChord(i,t)}parseDiagramItemForStaff(e,t){let i=new $r,r=t.getAttribute("id");e.addChord(r,i),this.parseDiagramItemForChord(i,t)}parseDiagramItemForChord(e,t){e.name=t.getAttribute("name");let i=t.findChildElement("Diagram");if(!i){e.showDiagram=!1,e.showFingering=!1;return}let r=parseInt(i.getAttribute("stringCount")),n=parseInt(i.getAttribute("baseFret"));e.firstFret=n+1;for(let a=0;a<r;a++)e.strings.push(-1);for(let a of i.childNodes)if(a.nodeType===L.Element)switch(a.localName){case"Fret":let o=parseInt(a.getAttribute("string"));e.strings[r-o-1]=n+parseInt(a.getAttribute("fret"));break;case"Fingering":let l=new Map;for(let h of a.childNodes)if(h.nodeType===L.Element)switch(h.localName){case"Position":let u=oe.Unknown,c=n+parseInt(h.getAttribute("fret"));switch(h.getAttribute("finger")){case"Index":u=oe.IndexFinger;break;case"Middle":u=oe.MiddleFinger;break;case"Rank":u=oe.AnnularFinger;break;case"Pinky":u=oe.LittleFinger;break;case"Thumb":u=oe.Thumb;break}u!==oe.Unknown&&(l.has(u)?e.barreFrets.push(c):l.set(u,!0));break}break;case"Property":switch(a.getAttribute("name")){case"ShowName":e.showName=a.getAttribute("value")==="true";break;case"ShowDiagram":e.showDiagram=a.getAttribute("value")==="true";break;case"ShowFingering":e.showFingering=a.getAttribute("value")==="true";break}break}}parseTrackProperties(e,t){for(let i of t.childNodes)if(i.nodeType===L.Element)switch(i.localName){case"Property":this.parseTrackProperty(e,i);break}}parseTrackProperty(e,t){switch(t.getAttribute("name")){case"Tuning":let r=t.findChildElement("Pitches").innerText.split(" "),n=new Array(r.length);for(let o=0;o<n.length;o++)n[n.length-1-o]=parseInt(r[o]);for(let o of e.staves)o.stringTuning.tunings=n,o.showStandardNotation=!0,o.showTablature=!0;break;case"DiagramCollection":case"ChordCollection":this.parseDiagramCollectionForTrack(e,t);break;case"CapoFret":let a=parseInt(t.findChildElement("Fret").innerText);for(let o of e.staves)o.capo=a;break}}parseGeneralMidi(e,t){for(let r of t.childNodes)if(r.nodeType===L.Element)switch(r.localName){case"Program":e.playbackInfo.program=parseInt(r.innerText);break;case"Port":e.playbackInfo.port=parseInt(r.innerText);break;case"PrimaryChannel":e.playbackInfo.primaryChannel=parseInt(r.innerText);break;case"SecondaryChannel":e.playbackInfo.secondaryChannel=parseInt(r.innerText);break}if(t.getAttribute("table")==="Percussion")for(let r of e.staves)r.isPercussion=!0}parseSounds(e,t,i){for(let r of i.childNodes)if(r.nodeType===L.Element)switch(r.localName){case"Sound":this.parseSound(e,t,r);break}}parseSound(e,t,i){const r=new ev;for(let n of i.childNodes)if(n.nodeType===L.Element)switch(n.localName){case"Name":r.name=n.innerText;break;case"Path":r.path=n.innerText;break;case"Role":r.role=n.innerText;break;case"MIDI":this.parseSoundMidi(r,n);break}(r.role==="Factory"||t.playbackInfo.program===0)&&(t.playbackInfo.program=r.program),this._soundsByTrack.has(e)||this._soundsByTrack.set(e,new Map),this._soundsByTrack.get(e).set(r.uniqueId,r)}parseSoundMidi(e,t){for(let i of t.childNodes)if(i.nodeType===L.Element)switch(i.localName){case"Program":e.program=parseInt(i.innerText);break}}parsePartSounding(e,t){for(let i of t.childNodes)if(i.nodeType===L.Element)switch(i.localName){case"TranspositionPitch":for(let r of e.staves)r.displayTranspositionPitch=parseInt(i.innerText);break}}parseTranspose(e,t){let i=0,r=0;for(let n of t.childNodes)if(n.nodeType===L.Element)switch(n.localName){case"Chromatic":r=parseInt(n.innerText);break;case"Octave":i=parseInt(n.innerText);break}for(let n of e.staves)n.displayTranspositionPitch=i*12+r}parseRSE(e,t){for(let i of t.childNodes)if(i.nodeType===L.Element)switch(i.localName){case"ChannelStrip":this.parseChannelStrip(e,i);break}}parseChannelStrip(e,t){for(let i of t.childNodes)if(i.nodeType===L.Element)switch(i.localName){case"Parameters":this.parseChannelStripParameters(e,i);break}}parseChannelStripParameters(e,t){if(t.firstChild&&t.firstChild.value){let i=t.firstChild.value.split(" ");i.length>=12&&(e.playbackInfo.balance=Math.floor(parseFloat(i[11])*16),e.playbackInfo.volume=Math.floor(parseFloat(i[12])*16))}}parseMasterBarsNode(e){for(let t of e.childNodes)if(t.nodeType===L.Element)switch(t.localName){case"MasterBar":this.parseMasterBar(t);break}}parseMasterBar(e){let t=new mr;this._masterBars.length===0&&this._hasAnacrusis&&(t.isAnacrusis=!0);for(let i of e.childNodes)if(i.nodeType===L.Element)switch(i.localName){case"Time":let r=i.innerText.split("/");t.timeSignatureNumerator=parseInt(r[0]),t.timeSignatureDenominator=parseInt(r[1]);break;case"FreeTime":t.isFreeTime=!0;break;case"DoubleBar":t.isDoubleBar=!0;break;case"Section":t.section=new xu,t.section.marker=i.findChildElement("Letter").innerText,t.section.text=i.findChildElement("Text").innerText;break;case"Repeat":i.getAttribute("start").toLowerCase()==="true"&&(t.isRepeatStart=!0),i.getAttribute("end").toLowerCase()==="true"&&i.getAttribute("count")&&(t.repeatCount=parseInt(i.getAttribute("count")));break;case"AlternateEndings":let n=i.innerText.split(" "),a=0;for(let l=0;l<n.length;l++)a=a|1<<-1+parseInt(n[l]);t.alternateEndings=a;break;case"Bars":this._barsOfMasterBar.push(i.innerText.split(" "));break;case"TripletFeel":switch(i.innerText){case"NoTripletFeel":t.tripletFeel=ce.NoTripletFeel;break;case"Triplet8th":t.tripletFeel=ce.Triplet8th;break;case"Triplet16th":t.tripletFeel=ce.Triplet16th;break;case"Dotted8th":t.tripletFeel=ce.Dotted8th;break;case"Dotted16th":t.tripletFeel=ce.Dotted16th;break;case"Scottish8th":t.tripletFeel=ce.Scottish8th;break;case"Scottish16th":t.tripletFeel=ce.Scottish16th;break}break;case"Key":t.keySignature=parseInt(i.findChildElement("AccidentalCount").innerText);let o=i.findChildElement("Mode");if(o)switch(o.innerText.toLowerCase()){case"major":t.keySignatureType=Es.Major;break;case"minor":t.keySignatureType=Es.Minor;break}break;case"Fermatas":this.parseFermatas(t,i);break;case"XProperties":this.parseMasterBarXProperties(i,t);break}this._masterBars.push(t)}parseFermatas(e,t){for(let i of t.childNodes)if(i.nodeType===L.Element)switch(i.localName){case"Fermata":this.parseFermata(e,i);break}}parseFermata(e,t){let i=0,r=new ep;for(let n of t.childNodes)if(n.nodeType===L.Element)switch(n.localName){case"Type":switch(n.innerText){case"Short":r.type=Ts.Short;break;case"Medium":r.type=Ts.Medium;break;case"Long":r.type=Ts.Long;break}break;case"Length":r.length=parseFloat(n.innerText);break;case"Offset":let a=n.innerText.split("/");if(a.length===2){let o=parseInt(a[0]),l=parseInt(a[1]);i=o/l*re.QuarterTime|0}break}e.addFermata(i,r)}parseBars(e){for(let t of e.childNodes)if(t.nodeType===L.Element)switch(t.localName){case"Bar":this.parseBar(t);break}}parseBar(e){let t=new Sr,i=e.getAttribute("id");for(let r of e.childNodes)if(r.nodeType===L.Element)switch(r.localName){case"Voices":this._voicesOfBar.set(i,r.innerText.split(" "));break;case"Clef":switch(r.innerText){case"Neutral":t.clef=ie.Neutral;break;case"G2":t.clef=ie.G2;break;case"F4":t.clef=ie.F4;break;case"C4":t.clef=ie.C4;break;case"C3":t.clef=ie.C3;break}break;case"Ottavia":switch(r.innerText){case"8va":t.clefOttava=Te._8va;break;case"15ma":t.clefOttava=Te._15ma;break;case"8vb":t.clefOttava=Te._8vb;break;case"15mb":t.clefOttava=Te._15mb;break}break;case"SimileMark":switch(r.innerText){case"Simple":t.simileMark=Qi.Simple;break;case"FirstOfDouble":t.simileMark=Qi.FirstOfDouble;break;case"SecondOfDouble":t.simileMark=Qi.SecondOfDouble;break}break;case"XProperties":this.parseBarXProperties(r,t);break}this._barsById.set(i,t)}parseVoices(e){for(let t of e.childNodes)if(t.nodeType===L.Element)switch(t.localName){case"Voice":this.parseVoice(t);break}}parseVoice(e){let t=new Js,i=e.getAttribute("id");for(let r of e.childNodes)if(r.nodeType===L.Element)switch(r.localName){case"Beats":this._beatsOfVoice.set(i,r.innerText.split(" "));break}this._voiceById.set(i,t)}parseBeats(e){for(let t of e.childNodes)if(t.nodeType===L.Element)switch(t.localName){case"Beat":this.parseBeat(t);break}}parseBeat(e){let t=new Wt,i=e.getAttribute("id");for(let r of e.childNodes)if(r.nodeType===L.Element)switch(r.localName){case"Notes":this._notesOfBeat.set(i,r.innerText.split(" "));break;case"Rhythm":this._rhythmOfBeat.set(i,r.getAttribute("ref"));break;case"Fadding":r.innerText==="FadeIn"&&(t.fadeIn=!0);break;case"Tremolo":switch(r.innerText){case"1/2":t.tremoloSpeed=k.Eighth;break;case"1/4":t.tremoloSpeed=k.Sixteenth;break;case"1/8":t.tremoloSpeed=k.ThirtySecond;break}break;case"Chord":t.chordId=r.innerText;break;case"Hairpin":switch(r.innerText){case"Crescendo":t.crescendo=ki.Crescendo;break;case"Decrescendo":t.crescendo=ki.Decrescendo;break}break;case"Arpeggio":r.innerText==="Up"?t.brushType=Ve.ArpeggioUp:t.brushType=Ve.ArpeggioDown;break;case"Properties":this.parseBeatProperties(r,t);break;case"XProperties":this.parseBeatXProperties(r,t);break;case"FreeText":t.text=r.innerText;break;case"TransposedPitchStemOrientation":switch(r.innerText){case"Upward":t.preferredBeamDirection=E.Up;break;case"Downward":t.preferredBeamDirection=E.Down;break}break;case"Dynamic":switch(r.innerText){case"PPP":t.dynamics=de.PPP;break;case"PP":t.dynamics=de.PP;break;case"P":t.dynamics=de.P;break;case"MP":t.dynamics=de.MP;break;case"MF":t.dynamics=de.MF;break;case"F":t.dynamics=de.F;break;case"FF":t.dynamics=de.FF;break;case"FFF":t.dynamics=de.FFF;break}break;case"GraceNotes":switch(r.innerText){case"OnBeat":t.graceType=$.OnBeat;break;case"BeforeBeat":t.graceType=$.BeforeBeat;break}break;case"Legato":r.getAttribute("origin")==="true"&&(t.isLegatoOrigin=!0);break;case"Whammy":let n=new A(0,0);n.value=this.toBendValue(parseFloat(r.getAttribute("originValue"))),n.offset=this.toBendOffset(parseFloat(r.getAttribute("originOffset"))),t.addWhammyBarPoint(n);let a=new A(0,0);a.value=this.toBendValue(parseFloat(r.getAttribute("middleValue"))),a.offset=this.toBendOffset(parseFloat(r.getAttribute("middleOffset1"))),t.addWhammyBarPoint(a);let o=new A(0,0);o.value=this.toBendValue(parseFloat(r.getAttribute("middleValue"))),o.offset=this.toBendOffset(parseFloat(r.getAttribute("middleOffset2"))),t.addWhammyBarPoint(o);let l=new A(0,0);l.value=this.toBendValue(parseFloat(r.getAttribute("destinationValue"))),l.offset=this.toBendOffset(parseFloat(r.getAttribute("destinationOffset"))),t.addWhammyBarPoint(l);break;case"Ottavia":switch(r.innerText){case"8va":t.ottava=Te._8va;break;case"8vb":t.ottava=Te._8vb;break;case"15ma":t.ottava=Te._15ma;break;case"15mb":t.ottava=Te._15mb;break}break;case"Lyrics":t.lyrics=this.parseBeatLyrics(r),this._skipApplyLyrics=!0;break;case"Slashed":t.slashed=!0;break}this._beatById.set(i,t)}parseBeatLyrics(e){const t=[];for(let i of e.childNodes)if(i.nodeType===L.Element)switch(i.localName){case"Line":t.push(i.innerText);break}return t}parseBeatXProperties(e,t){for(let i of e.childNodes)if(i.nodeType===L.Element)switch(i.localName){case"XProperty":let r=i.getAttribute("id"),n=0;switch(r){case"1124204545":n=parseInt(i.findChildElement("Int").innerText),t.invertBeamDirection=n===1;break;case"687935489":n=parseInt(i.findChildElement("Int").innerText),t.brushDuration=n;break}break}}parseBarXProperties(e,t){for(let i of e.childNodes)if(i.nodeType===L.Element)switch(i.localName){case"XProperty":switch(i.getAttribute("id")){case"1124139520":const n=i.findChildElement("Double")??i.findChildElement("Float");t.displayScale=parseFloat(n.innerText);break}break}}parseMasterBarXProperties(e,t){for(let i of e.childNodes)if(i.nodeType===L.Element)switch(i.localName){case"XProperty":switch(i.getAttribute("id")){case"1124073984":t.displayScale=parseFloat(i.findChildElement("Double").innerText);break}break}}parseBeatProperties(e,t){let i=!1,r=null,n=null,a=null,o=null,l=null;for(let h of e.childNodes)if(h.nodeType===L.Element)switch(h.localName){case"Property":switch(h.getAttribute("name")){case"Brush":h.findChildElement("Direction").innerText==="Up"?t.brushType=Ve.BrushUp:t.brushType=Ve.BrushDown;break;case"PickStroke":h.findChildElement("Direction").innerText==="Up"?t.pickStroke=At.Up:t.pickStroke=At.Down;break;case"Slapped":h.findChildElement("Enable")&&(t.slap=!0);break;case"Popped":h.findChildElement("Enable")&&(t.pop=!0);break;case"VibratoWTremBar":switch(h.findChildElement("Strength").innerText){case"Wide":t.vibrato=Be.Wide;break;case"Slight":t.vibrato=Be.Slight;break}break;case"WhammyBar":i=!0;break;case"WhammyBarExtend":break;case"WhammyBarOriginValue":r||(r=new A(0,0)),r.value=this.toBendValue(parseFloat(h.findChildElement("Float").innerText));break;case"WhammyBarOriginOffset":r||(r=new A(0,0)),r.offset=this.toBendOffset(parseFloat(h.findChildElement("Float").innerText));break;case"WhammyBarMiddleValue":n=this.toBendValue(parseFloat(h.findChildElement("Float").innerText));break;case"WhammyBarMiddleOffset1":a=this.toBendOffset(parseFloat(h.findChildElement("Float").innerText));break;case"WhammyBarMiddleOffset2":o=this.toBendOffset(parseFloat(h.findChildElement("Float").innerText));break;case"WhammyBarDestinationValue":l||(l=new A(A.MaxPosition,0)),l.value=this.toBendValue(parseFloat(h.findChildElement("Float").innerText));break;case"WhammyBarDestinationOffset":l||(l=new A(0,0)),l.offset=this.toBendOffset(parseFloat(h.findChildElement("Float").innerText));break}break}i&&(r||(r=new A(0,0)),l||(l=new A(A.MaxPosition,0)),t.addWhammyBarPoint(r),a&&n&&t.addWhammyBarPoint(new A(a,n)),o&&n&&t.addWhammyBarPoint(new A(o,n)),!a&&!o&&n&&t.addWhammyBarPoint(new A(A.MaxPosition/2|0,n)),t.addWhammyBarPoint(l))}parseNotes(e){for(let t of e.childNodes)if(t.nodeType===L.Element)switch(t.localName){case"Note":this.parseNote(t);break}}parseNote(e){let t=new je,i=e.getAttribute("id");for(let r of e.childNodes)if(r.nodeType===L.Element)switch(r.localName){case"Properties":this.parseNoteProperties(r,t,i);break;case"AntiAccent":r.innerText.toLowerCase()==="normal"&&(t.isGhost=!0);break;case"LetRing":t.isLetRing=!0;break;case"Trill":t.trillValue=parseInt(r.innerText),t.trillSpeed=k.Sixteenth;break;case"Accent":let n=parseInt(r.innerText);n&1&&(t.isStaccato=!0),n&4&&(t.accentuated=et.Heavy),n&8&&(t.accentuated=et.Normal),n&16&&(t.accentuated=et.Tenuto);break;case"Tie":r.getAttribute("destination").toLowerCase()==="true"&&(t.isTieDestination=!0);break;case"Vibrato":switch(r.innerText){case"Slight":t.vibrato=Be.Slight;break;case"Wide":t.vibrato=Be.Wide;break}break;case"LeftFingering":switch(t.isFingering=!0,r.innerText){case"P":t.leftHandFinger=oe.Thumb;break;case"I":t.leftHandFinger=oe.IndexFinger;break;case"M":t.leftHandFinger=oe.MiddleFinger;break;case"A":t.leftHandFinger=oe.AnnularFinger;break;case"C":t.leftHandFinger=oe.LittleFinger;break}break;case"RightFingering":switch(t.isFingering=!0,r.innerText){case"P":t.rightHandFinger=oe.Thumb;break;case"I":t.rightHandFinger=oe.IndexFinger;break;case"M":t.rightHandFinger=oe.MiddleFinger;break;case"A":t.rightHandFinger=oe.AnnularFinger;break;case"C":t.rightHandFinger=oe.LittleFinger;break}break;case"InstrumentArticulation":t.percussionArticulation=parseInt(r.innerText);break}this._noteById.set(i,t)}parseNoteProperties(e,t,i){let r=!1,n=null,a=null,o=null,l=null,h=null,u=-1,c=-1;for(let d of e.childNodes)if(d.nodeType===L.Element)switch(d.localName){case"Property":switch(d.getAttribute("name")){case"ShowStringNumber":d.findChildElement("Enable")&&(t.showStringNumber=!0);break;case"String":t.string=parseInt(d.findChildElement("String").innerText)+1;break;case"Fret":t.fret=parseInt(d.findChildElement("Fret").innerText);break;case"Element":u=parseInt(d.findChildElement("Element").innerText);break;case"Variation":c=parseInt(d.findChildElement("Variation").innerText);break;case"Tapped":this._tappedNotes.set(i,!0);break;case"HarmonicType":let g=d.findChildElement("HType");if(g)switch(g.innerText){case"NoHarmonic":t.harmonicType=X.None;break;case"Natural":t.harmonicType=X.Natural;break;case"Artificial":t.harmonicType=X.Artificial;break;case"Pinch":t.harmonicType=X.Pinch;break;case"Tap":t.harmonicType=X.Tap;break;case"Semi":t.harmonicType=X.Semi;break;case"Feedback":t.harmonicType=X.Feedback;break}break;case"HarmonicFret":let w=d.findChildElement("HFret");w&&(t.harmonicValue=parseFloat(w.innerText));break;case"Muted":d.findChildElement("Enable")&&(t.isDead=!0);break;case"PalmMuted":d.findChildElement("Enable")&&(t.isPalmMute=!0);break;case"Octave":t.octave=parseInt(d.findChildElement("Number").innerText),t.tone===-1&&(t.tone=0);break;case"Tone":t.tone=parseInt(d.findChildElement("Step").innerText);break;case"ConcertPitch":this.parseConcertPitch(d,t);break;case"Bended":r=!0;break;case"BendOriginValue":n||(n=new A(0,0)),n.value=this.toBendValue(parseFloat(d.findChildElement("Float").innerText));break;case"BendOriginOffset":n||(n=new A(0,0)),n.offset=this.toBendOffset(parseFloat(d.findChildElement("Float").innerText));break;case"BendMiddleValue":a=this.toBendValue(parseFloat(d.findChildElement("Float").innerText));break;case"BendMiddleOffset1":o=this.toBendOffset(parseFloat(d.findChildElement("Float").innerText));break;case"BendMiddleOffset2":l=this.toBendOffset(parseFloat(d.findChildElement("Float").innerText));break;case"BendDestinationValue":h||(h=new A(A.MaxPosition,0)),h.value=this.toBendValue(parseFloat(d.findChildElement("Float").innerText));break;case"BendDestinationOffset":h||(h=new A(0,0)),h.offset=this.toBendOffset(parseFloat(d.findChildElement("Float").innerText));break;case"HopoOrigin":d.findChildElement("Enable")&&(t.isHammerPullOrigin=!0);break;case"HopoDestination":break;case"LeftHandTapped":t.isLeftHandTapped=!0;break;case"Slide":let S=parseInt(d.findChildElement("Flags").innerText);S&1?t.slideOutType=ne.Shift:S&2?t.slideOutType=ne.Legato:S&4?t.slideOutType=ne.OutDown:S&8&&(t.slideOutType=ne.OutUp),S&16?t.slideInType=vt.IntoFromBelow:S&32&&(t.slideInType=vt.IntoFromAbove),S&64?t.slideOutType=ne.PickSlideDown:S&128&&(t.slideOutType=ne.PickSlideUp);break}break}r&&(n||(n=new A(0,0)),h||(h=new A(A.MaxPosition,0)),t.addBendPoint(n),o&&a&&t.addBendPoint(new A(o,a)),l&&a&&t.addBendPoint(new A(l,a)),!o&&!l&&a&&t.addBendPoint(new A(A.MaxPosition/2|0,a)),t.addBendPoint(h)),u!==-1&&c!==-1&&(t.percussionArticulation=nt.articulationFromElementVariation(u,c))}parseConcertPitch(e,t){const i=e.findChildElement("Pitch");if(i){for(let r of i.childNodes)if(r.nodeType===L.Element)switch(r.localName){case"Accidental":switch(r.innerText){case"x":t.accidentalMode=ot.ForceDoubleSharp;break;case"#":t.accidentalMode=ot.ForceSharp;break;case"b":t.accidentalMode=ot.ForceFlat;break;case"bb":t.accidentalMode=ot.ForceDoubleFlat;break}break}}}toBendValue(e){return e*rs.BendPointValueFactor|0}toBendOffset(e){return e*rs.BendPointPositionFactor}parseRhythms(e){for(let t of e.childNodes)if(t.nodeType===L.Element)switch(t.localName){case"Rhythm":this.parseRhythm(t);break}}parseRhythm(e){let t=new Zx,i=e.getAttribute("id");t.id=i;for(let r of e.childNodes)if(r.nodeType===L.Element)switch(r.localName){case"NoteValue":switch(r.innerText){case"Long":t.value=k.QuadrupleWhole;break;case"DoubleWhole":t.value=k.DoubleWhole;break;case"Whole":t.value=k.Whole;break;case"Half":t.value=k.Half;break;case"Quarter":t.value=k.Quarter;break;case"Eighth":t.value=k.Eighth;break;case"16th":t.value=k.Sixteenth;break;case"32nd":t.value=k.ThirtySecond;break;case"64th":t.value=k.SixtyFourth;break;case"128th":t.value=k.OneHundredTwentyEighth;break;case"256th":t.value=k.TwoHundredFiftySixth;break}break;case"PrimaryTuplet":t.tupletNumerator=parseInt(r.getAttribute("num")),t.tupletDenominator=parseInt(r.getAttribute("den"));break;case"AugmentationDot":t.dots=parseInt(r.getAttribute("count"));break}this._rhythmById.set(i,t)}buildModel(){for(let e=0,t=this._masterBars.length;e<t;e++){let i=this._masterBars[e];this.score.addMasterBar(i)}for(let e of this._tracksMapping){if(!e)continue;let t=this._tracksById.get(e);this.score.addTrack(t)}for(let e of this._barsOfMasterBar){let t=0;for(let i=0,r=0;i<e.length&&r<this.score.tracks.length;i++){let n=e[i];if(n!==rs.InvalidId){let a=this._barsById.get(n),o=this.score.tracks[r],l=o.staves[t];if(l.addBar(a),this._voicesOfBar.has(n))for(let h of this._voicesOfBar.get(n))if(h!==rs.InvalidId){let u=this._voiceById.get(h);if(a.addVoice(u),this._beatsOfVoice.has(h)){for(let c of this._beatsOfVoice.get(h))if(c!==rs.InvalidId){let d=Zf.clone(this._beatById.get(c));u.addBeat(d);let p=this._rhythmOfBeat.get(c),g=this._rhythmById.get(p);if(d.duration=g.value,d.dots=g.dots,d.tupletNumerator=g.tupletNumerator,d.tupletDenominator=g.tupletDenominator,this._notesOfBeat.has(c)){for(let w of this._notesOfBeat.get(c))if(w!==rs.InvalidId){const S=Tw.clone(this._noteById.get(w));l.isPercussion?(S.fret=-1,S.string=-1):S.percussionArticulation=-1,d.addNote(S),this._tappedNotes.has(w)&&(d.tap=!0)}}}}}else{let u=new Js;a.addVoice(u);let c=new Wt;c.isEmpty=!0,c.duration=k.Quarter,u.addBeat(c)}t===o.staves.length-1?(r++,t=0):t++}else r++}}for(let e of this._tracksMapping){if(!e)continue;let t=this._tracksById.get(e),i=!1;for(const r of t.staves)if(r.isPercussion){i=!0;break}if(i||(t.percussionArticulations=[]),this._automationsPerTrackIdAndBarIndex.has(e)){const r=this._automationsPerTrackIdAndBarIndex.get(e);for(const[n,a]of r)if(t.staves.length>0&&n<t.staves[0].bars.length){const o=t.staves[0].bars[n];if(o.voices.length>0&&o.voices[0].beats.length>0){const l=o.voices[0].beats[0];for(const h of a)l.automations.push(h)}}}}for(const[e,t]of this._masterTrackAutomations){let i=this.score.masterBars[e];for(let r=0,n=t.length;r<n;r++){let a=t[r];a.type===gt.Tempo&&(e===0&&(this.score.tempo=a.value|0,a.text&&(this.score.tempoLabel=a.text)),i.tempoAutomations.push(a))}}}}rs.InvalidId="-1";rs.BendPointPositionFactor=A.MaxPosition/100;rs.BendPointValueFactor=1/25;class hc{constructor(){this.isMultiRest=!1,this.trackViewGroups=[]}}class ym{constructor(){this.showNumbered=!1,this.showSlash=!1,this.showStandardNotation=!1,this.showTablature=!1}}class Ew{apply(e){if(this.scoreViews.length>0){let t=0;for(let i of this.scoreViews[0].trackViewGroups){if(t<e.tracks.length){const r=e.tracks[t];for(const n of r.staves)n.showTablature=i.showTablature,n.showStandardNotation=i.showStandardNotation,n.showSlash=i.showSlash,n.showNumbered=i.showNumbered}t++}}}constructor(e){this.scoreViews=[];let t=Tt.fromBuffer(e);const i=v.readInt32BE(t);for(let r=0;r<i;r++){const n=new hc;this.scoreViews.push(n),n.isMultiRest=_e.gpReadBool(t);const a=v.readInt32BE(t);for(let o=0;o<a;o++){let l=t.readByte();l===0&&(l=1);let h=new ym;h.showStandardNotation=(l&1)!==0,h.showTablature=(l&2)!==0,h.showSlash=(l&4)!==0,h.showNumbered=(l&8)!==0,n.trackViewGroups.push(h)}}}static writeForScore(e){const t=Tt.withCapacity(128),i=[new hc];for(const r of e.tracks){const n=new ym;n.showStandardNotation=r.staves[0].showStandardNotation,n.showTablature=r.staves[0].showTablature,n.showSlash=r.staves[0].showSlash,n.showNumbered=r.staves[0].showNumbered,i[0].trackViewGroups.push(n);const a=new hc;a.trackViewGroups.push(n),i.push(a)}v.writeInt32BE(t,i.length);for(const r of i){t.writeByte(r.isMultiRest?1:0),v.writeInt32BE(t,r.trackViewGroups.length);for(const n of r.trackViewGroups){let a=0;n.showStandardNotation&&(a=a|1),n.showTablature&&(a=a|2),n.showSlash&&(a=a|4),n.showNumbered&&(a=a|8),t.writeByte(a)}}return v.writeInt32BE(t,1),t.toArray()}}class ip{}class eh extends ip{constructor(e){super(),this.n=e}}class sn extends ip{constructor(e,t){super(),this.left=e,this.right=t}}class Cd extends ip{constructor(e,t){super(),this.n=e,this.table=t}}class Ct{static make(e,t,i,r){let n=[],a=[];if(r>32)throw new ut("Invalid huffman");for(let h=0;h<r;h++)n.push(0),a.push(0);for(let h=0;h<i;h++){let u=e[h+t];if(u>=r)throw new ut("Invalid huffman");n[u]++}let o=0;for(let h=1;h<r-1;h++)o=o+n[h]<<1,a[h]=o;let l=new Map;for(let h=0;h<i;h++){let u=e[h+t];if(u!==0){let c=a[u-1];a[u-1]=c+1,l.set(c<<5|u,h)}}return Ct.treeCompress(new sn(Ct.treeMake(l,r,0,1),Ct.treeMake(l,r,1,1)))}static treeMake(e,t,i,r){if(r>t)throw new ut("Invalid huffman");let n=i<<5|r;return e.has(n)?new eh(e.get(n)):(i=i<<1,r+=1,new sn(Ct.treeMake(e,t,i,r),Ct.treeMake(e,t,i|1,r)))}static treeCompress(e){let t=Ct.treeDepth(e);if(t===0)return e;if(t===1){if(e instanceof sn)return new sn(Ct.treeCompress(e.left),Ct.treeCompress(e.right));throw new ut("assert")}let i=1<<t,r=[];for(let n=0;n<i;n++)r.push(new eh(-1));return Ct.treeWalk(r,0,0,t,e),new Cd(t,r)}static treeWalk(e,t,i,r,n){n instanceof sn&&r>0?(Ct.treeWalk(e,t,i+1,r-1,n.left),Ct.treeWalk(e,t|1<<i,i+1,r-1,n.right)):e[t]=Ct.treeCompress(n)}static treeDepth(e){if(e instanceof eh)return 0;if(e instanceof Cd)throw new ut("assert");if(e instanceof sn){let t=Ct.treeDepth(e.left),i=Ct.treeDepth(e.right);return 1+(t<i?t:i)}return 0}}var rt;(function(s){s[s.Head=0]="Head",s[s.Block=1]="Block",s[s.CData=2]="CData",s[s.Flat=3]="Flat",s[s.Crc=4]="Crc",s[s.Dist=5]="Dist",s[s.DistOne=6]="DistOne",s[s.Done=7]="Done"})(rt||(rt={}));class gs{constructor(){this.buffer=new Uint8Array(gs.BufferSize),this.pos=0}slide(){let e=new Uint8Array(gs.BufferSize);this.pos-=gs.Size,e.set(this.buffer.subarray(gs.Size,gs.Size+this.pos),0),this.buffer=e}addBytes(e,t,i){this.pos+i>gs.BufferSize&&this.slide(),this.buffer.set(e.subarray(t,t+i),this.pos),this.pos+=i}addByte(e){this.pos===gs.BufferSize&&this.slide(),this.buffer[this.pos]=e,this.pos++}getLastChar(){return this.buffer[this.pos-1]}available(){return this.pos}}gs.Size=32768;gs.BufferSize=65536;class ti{static buildFixedHuffman(){let e=[];for(let t=0;t<288;t++)e.push(t<=143?8:t<=255?9:t<=279?7:8);return Ct.make(e,0,288,10)}constructor(e){this._nbits=0,this._bits=0,this._state=rt.Block,this._isFinal=!1,this._huffman=ti._fixedHuffman,this._huffdist=null,this._len=0,this._dist=0,this._needed=0,this._output=null,this._outpos=0,this._lengths=[],this._window=new gs,this._input=e;for(let t=0;t<19;t++)this._lengths.push(-1)}readBytes(e,t,i){if(this._needed=i,this._outpos=t,this._output=e,i>0)for(;this.inflateLoop(););return i-this._needed}inflateLoop(){switch(this._state){case rt.Head:let e=this._input.readByte();if((e&15)!==8)throw new ut("Invalid data");let i=this._input.readByte(),r=(i&32)!==0;if(((e<<8)+i)%31!==0)throw new ut("Invalid data");if(r)throw new ut("Unsupported dictionary");return this._state=rt.Block,!0;case rt.Crc:return this._state=rt.Done,!0;case rt.Done:return!1;case rt.Block:switch(this._isFinal=this.getBit(),this.getBits(2)){case 0:if(this._len=v.readUInt16LE(this._input),v.readUInt16LE(this._input)!==65535-this._len)throw new ut("Invalid data");this._state=rt.Flat;let o=this.inflateLoop();return this.resetBits(),o;case 1:return this._huffman=ti._fixedHuffman,this._huffdist=null,this._state=rt.CData,!0;case 2:let l=this.getBits(5)+257,h=this.getBits(5)+1,u=this.getBits(4)+4;for(let d=0;d<u;d++)this._lengths[ti.CodeLengthsPos[d]]=this.getBits(3);for(let d=u;d<19;d++)this._lengths[ti.CodeLengthsPos[d]]=0;this._huffman=Ct.make(this._lengths,0,19,8);let c=[];for(let d=0;d<l+h;d++)c.push(0);return this.inflateLengths(c,l+h),this._huffdist=Ct.make(c,l,h,16),this._huffman=Ct.make(c,0,l,16),this._state=rt.CData,!0;default:throw new ut("Invalid data")}case rt.Flat:{let a=this._len<this._needed?this._len:this._needed,o=v.readByteArray(this._input,a);return this._len-=a,this.addBytes(o,0,a),this._len===0&&(this._state=this._isFinal?rt.Crc:rt.Block),this._needed>0}case rt.DistOne:{let a=this._len<this._needed?this._len:this._needed;return this.addDistOne(a),this._len-=a,this._len===0&&(this._state=rt.CData),this._needed>0}case rt.Dist:for(;this._len>0&&this._needed>0;){let a=this._len<this._dist?this._len:this._dist,o=this._needed<a?this._needed:a;this.addDist(this._dist,o),this._len-=o}return this._len===0&&(this._state=rt.CData),this._needed>0;case rt.CData:let n=this.applyHuffman(this._huffman);if(n<256)return this.addByte(n),this._needed>0;if(n===256)return this._state=this._isFinal?rt.Crc:rt.Block,!0;{n=n-257&255;let a=ti.LenExtraBitsTbl[n];if(a===-1)throw new ut("Invalid data");this._len=ti.LenBaseValTbl[n]+this.getBits(a);let o=this._huffdist,l=o?this.applyHuffman(o):this.getRevBits(5);if(a=ti.DistExtraBitsTbl[l],a===-1)throw new ut("Invalid data");if(this._dist=ti.DistBaseValTbl[l]+this.getBits(a),this._dist>this._window.available())throw new ut("Invalid data");return this._state=this._dist===1?rt.DistOne:rt.Dist,!0}}return!1}addDistOne(e){let t=this._window.getLastChar();for(let i=0;i<e;i++)this.addByte(t)}addByte(e){this._window.addByte(e),this._output[this._outpos]=e,this._needed--,this._outpos++}addDist(e,t){this.addBytes(this._window.buffer,this._window.pos-e,t)}getBit(){this._nbits===0&&(this._nbits=8,this._bits=this._input.readByte());let e=(this._bits&1)===1;return this._nbits--,this._bits=this._bits>>1,e}getBits(e){for(;this._nbits<e;)this._bits=this._bits|this._input.readByte()<<this._nbits,this._nbits+=8;let t=this._bits&(1<<e)-1;return this._nbits-=e,this._bits=this._bits>>e,t}getRevBits(e){return e===0?0:this.getBit()?1<<e-1|this.getRevBits(e-1):this.getRevBits(e-1)}resetBits(){this._bits=0,this._nbits=0}addBytes(e,t,i){this._window.addBytes(e,t,i),this._output.set(e.subarray(t,t+i),this._outpos),this._needed-=i,this._outpos+=i}inflateLengths(e,t){let i=0,r=0;for(;i<t;){let n=this.applyHuffman(this._huffman);switch(n){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:case 10:case 11:case 12:case 13:case 14:case 15:r=n,e[i]=n,i++;break;case 16:let a=i+3+this.getBits(2);if(a>t)throw new ut("Invalid data");for(;i<a;)e[i]=r,i++;break;case 17:if(i+=3+this.getBits(3),i>t)throw new ut("Invalid data");break;case 18:if(i+=11+this.getBits(7),i>t)throw new ut("Invalid data");break;default:throw new ut("Invalid data")}}}applyHuffman(e){if(e instanceof eh)return e.n;if(e instanceof sn)return this.applyHuffman(this.getBit()?e.right:e.left);if(e instanceof Cd)return this.applyHuffman(e.table[this.getBits(e.n)]);throw new ut("Invalid data")}}ti.LenExtraBitsTbl=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,-1,-1];ti.LenBaseValTbl=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258];ti.DistExtraBitsTbl=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,-1,-1];ti.DistBaseValTbl=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577];ti.CodeLengthsPos=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];ti._fixedHuffman=ti.buildFixedHuffman();class or{constructor(e,t){this.fullName=e;let i=e.lastIndexOf("/");this.fileName=i===-1||i===e.length-1?this.fullName:e.substr(i+1),this.data=t}}or.OptionalDataDescriptorSignature=134695760;or.CompressionMethodDeflate=8;or.LocalFileHeaderSignature=67324752;or.CentralFileHeaderSignature=33639248;or.EndOfCentralDirSignature=101010256;class sp{constructor(e){this._readable=e}read(){let e=[];for(;;){let t=this.readEntry();if(!t)break;e.push(t)}return e}readEntry(){let e=this._readable;if(v.readInt32LE(e)!==or.LocalFileHeaderSignature)return null;v.readUInt16LE(e);let i=v.readUInt16LE(e),r=v.readUInt16LE(e),n=r!==0;if(n&&r!==or.CompressionMethodDeflate)return null;v.readInt16LE(this._readable),v.readInt16LE(this._readable),v.readInt32LE(e),v.readInt32LE(e);let a=v.readInt32LE(e),o=v.readInt16LE(e),l=v.readInt16LE(e),h=v.toString(v.readByteArray(e,o),"utf-8");e.skip(l);let u;if(n){let c=Tt.empty(),d=new ti(this._readable),p=new Uint8Array(65536);for(;;){let g=d.readBytes(p,0,p.length);if(c.write(p,0,g),g<p.length)break}u=c.toArray()}else u=v.readByteArray(this._readable,a);return i&8&&(v.readInt32LE(this._readable)===or.OptionalDataDescriptorSignature&&v.readInt32LE(this._readable),v.readInt32LE(this._readable),v.readInt32LE(this._readable)),new or(h,u)}}class tv{constructor(){this.trackViewGroups=[]}}class iv{constructor(){this.isVisible=!1}}var Ed;(function(s){s[s.PageVertical=0]="PageVertical",s[s.PageGrid=1]="PageGrid",s[s.PageParchment=2]="PageParchment",s[s.ScreenVertical=3]="ScreenVertical",s[s.ScreenHorizontal=4]="ScreenHorizontal",s[s.PageHorizontal=5]="PageHorizontal"})(Ed||(Ed={}));class Lw{constructor(e,t){this.zoomLevel=4,this.view=Ed.PageVertical,this.muiltiVoiceCursor=!1,this.scoreViews=[];const i=Tt.fromBuffer(t);this.zoomLevel=v.readInt32BE(i),this.view=i.readByte(),this.muiltiVoiceCursor=i.readByte()!=0;const r=e.scoreViews.length;for(let n=0;n<r;n++){const a=new tv;this.scoreViews.push(a);const o=e.scoreViews[n];for(let l=0;l<o.trackViewGroups.length;l++){const h=new iv;h.isVisible=i.readByte()!=0,a.trackViewGroups.push(h)}}}apply(e){if(this.scoreViews.length>0){let t=0;for(let i of this.scoreViews[0].trackViewGroups){if(t<e.tracks.length){const r=e.tracks[t];r.isVisibleOnMultiTrack=i.isVisible}t++}}}static writeForScore(e){const t=Tt.withCapacity(128);v.writeInt32BE(t,4),t.writeByte(0);const i=e.tracks.length>0&&e.tracks[0].staves[0].bars[0].isMultiVoice;t.writeByte(i?255:0);for(const r of e.tracks)t.writeByte(r.isVisibleOnMultiTrack?255:0);for(const r of e.tracks)t.writeByte(255);return t.toArray()}}class sv extends Ma{get name(){return"Guitar Pro 7-8"}constructor(){super()}readScore(){C.debug(this.name,"Loading ZIP entries");let e=new sp(this.data),t;try{t=e.read()}catch(u){throw new Ye("No Zip archive",u)}C.debug(this.name,"Zip entries loaded");let i=null,r=null,n=null,a=null;for(let u of t)switch(u.fileName){case"score.gpif":i=v.toString(u.data,this.settings.importer.encoding);break;case"BinaryStylesheet":r=u.data;break;case"PartConfiguration":n=u.data;break;case"LayoutConfiguration":a=u.data;break}if(!i)throw new Ye("No score.gpif found in zip archive");C.debug(this.name,"Start Parsing score.gpif");let o=new rs;o.parseXml(i,this.settings),C.debug(this.name,"score.gpif parsed");let l=o.score;r&&(C.debug(this.name,"Start Parsing BinaryStylesheet"),new vu(r).apply(l),C.debug(this.name,"BinaryStylesheet parsed"));let h=null;return n&&(C.debug(this.name,"Start Parsing Part Configuration"),h=new Ew(n),h.apply(l),C.debug(this.name,"Part Configuration parsed")),a&&h!=null&&(C.debug(this.name,"Start Parsing Layout Configuration"),new Lw(h,a).apply(l),C.debug(this.name,"Layout Configuration parsed")),l}}class Ao extends Pt{constructor(){super(Nt.Format,"Unexpected end of data within reader"),Object.setPrototypeOf(this,Ao.prototype)}}class Io{constructor(e){this._currentByte=0,this._position=Io.ByteSize,this._source=e}readByte(){return this.readBits(8)}readBytes(e){const t=new Uint8Array(e);for(let i=0;i<e;i++)t[i]=this.readByte()&255;return t}readBits(e){let t=0,i=e-1;for(;i>=0;)t=t|this.readBit()<<i,i--;return t}readBitsReversed(e){let t=0;for(let i=0;i<e;i++)t=t|this.readBit()<<i;return t}readBit(){if(this._position>=8){if(this._currentByte=this._source.readByte(),this._currentByte===-1)throw new Ao;this._position=0}const e=this._currentByte>>Io.ByteSize-this._position-1&1;return this._position++,e}readAll(){let e=Tt.empty();try{for(;;)e.writeByte(this.readByte()&255)}catch(t){if(!(t instanceof Ao))throw t}return e.toArray()}}Io.ByteSize=8;class rv{constructor(){this.fileName="",this.fileSize=0,this.data=null}}class rp{constructor(){this.files=[],this.files=[],this.fileFilter=e=>!0}load(e){let t=new Io(e);this.readBlock(t)}readHeader(e){return this.getString(e.readBytes(4),0,4)}decompress(e,t=!1){let i=Tt.empty(),r,n=this.getInteger(e.readBytes(4),0);try{for(;i.length<n;)if(e.readBits(1)===1){let c=e.readBits(4),d=e.readBitsReversed(c),p=e.readBitsReversed(c),g=i.length-d,w=Math.min(d,p);r=i.getBuffer(),i.write(r,g,w)}else{let c=e.readBitsReversed(2);for(let d=0;d<c;d++)i.writeByte(e.readByte())}}catch(u){if(!(u instanceof Ao))throw u}r=i.getBuffer();let a=t?4:0,o=i.length-a,l=new Uint8Array(o),h=o;return l.set(r.subarray(a,a+h),0),l}readBlock(e){let t=this.readHeader(e);if(t==="BCFZ")this.readUncompressedBlock(this.decompress(e,!0));else if(t==="BCFS")this.readUncompressedBlock(e.readAll());else throw new Ye("Unsupported format")}readUncompressedBlock(e){let t=4096,i=t;for(;i+3<e.length;){if(this.getInteger(e,i)===2){let n=new rv;n.fileName=this.getString(e,i+4,127),n.fileSize=this.getInteger(e,i+140);let a=!this.fileFilter||this.fileFilter(n.fileName);a&&this.files.push(n);let o=i+148,l=0,h=0,u=a?Tt.withCapacity(n.fileSize):null;for(;l=this.getInteger(e,o+4*h++),l!==0;)i=l*t,a&&u.write(e,i,t);if(a){n.data=new Uint8Array(Math.min(n.fileSize,u.length));let c=u.toArray();n.data.set(c.subarray(0,0+n.data.length),0)}}i+=t}}getString(e,t,i){let r="";for(let n=0;n<i;n++){let a=e[t+n]&255;if(a===0)break;r+=String.fromCharCode(a)}return r}getInteger(e,t){return e[t+3]<<24|e[t+2]<<16|e[t+1]<<8|e[t]}}rp.HeaderBcFs="BCFS";rp.HeaderBcFz="BCFZ";class nv extends Ma{get name(){return"Guitar Pro 6"}constructor(){super()}readScore(){C.debug(this.name,"Loading GPX filesystem");let e=new rp;e.fileFilter=h=>h.endsWith("score.gpif")||h.endsWith("BinaryStylesheet")||h.endsWith("PartConfiguration")||h.endsWith("LayoutConfiguration"),e.load(this.data),C.debug(this.name,"GPX filesystem loaded");let t=null,i=null,r=null,n=null;for(let h of e.files)switch(h.fileName){case"score.gpif":t=v.toString(h.data,this.settings.importer.encoding);break;case"BinaryStylesheet":i=h.data;break;case"PartConfiguration":r=h.data;break;case"LayoutConfiguration":n=h.data;break}if(!t)throw new Ye("No score.gpif found in GPX");C.debug(this.name,"Start Parsing score.gpif");let a=new rs;a.parseXml(t,this.settings),C.debug(this.name,"score.gpif parsed");let o=a.score;i&&(C.debug(this.name,"Start Parsing BinaryStylesheet"),new vu(i).apply(o),C.debug(this.name,"BinaryStylesheet parsed"));let l=null;return r&&(C.debug(this.name,"Start Parsing Part Configuration"),l=new Ew(r),l.apply(o),C.debug(this.name,"Part Configuration parsed")),n&&l!=null&&(C.debug(this.name,"Start Parsing Layout Configuration"),new Lw(l,n).apply(o),C.debug(this.name,"Layout Configuration parsed")),o}}class av extends Ma{get name(){return"MusicXML"}constructor(){super(),this._currentPartGroup=null,this._trackFirstMeasureNumber=0,this._maxVoices=0,this._currentDirection=null,this._currentChord=null,this._divisionsPerQuarterNote=0,this._voiceOfStaff=new Map,this._isBeamContinue=!1,this._previousBeatWasPulled=!1,this._previousBeat=null}readScore(){this._trackById=new Map,this._partGroups=new Map,this._tieStarts=[],this._tieStartIds=new Map,this._slurStarts=new Map;let e=this.extractMusicXml(),t=new Mh;try{t.parse(e)}catch{throw new Ye("Unsupported format")}return this._score=new Rn,this._score.tempo=120,this.parseDom(t),this.settings.importer.mergePartGroupsInMusicXml&&this.mergePartGroups(),this._score.finish(this.settings),this._score.rebuildRepeatGroups(),this._score}extractMusicXml(){const e=new sp(this.data);let t;try{t=e.read()}catch{t=[]}if(t.length===0)return this.data.reset(),v.toString(this.data.readAll(),this.settings.importer.encoding);const i=t.find(h=>h.fullName==="META-INF/container.xml");if(!i)throw new Ye("No compressed MusicXML");const r=new Mh;try{r.parse(v.toString(i.data,this.settings.importer.encoding))}catch(h){throw new Ye("Malformed container.xml, could not parse as XML",h)}let n=r.firstElement;if(!n||n.localName!=="container")throw new Ye("Malformed container.xml, root element not 'container'");const a=n.findChildElement("rootfiles");if(!a)throw new Ye("Malformed container.xml, 'container/rootfiles' not found");let o="";for(const h of a.childNodes)if(h.nodeType==L.Element&&h.localName==="rootfile"){o=h.getAttribute("full-path");break}if(!o)throw new Ye("Unsupported compressed MusicXML, missing rootfile");const l=t.find(h=>h.fullName===o);if(!l)throw new Ye(`Malformed container.xml, '${o}' not contained in zip`);return v.toString(l.data,this.settings.importer.encoding)}mergePartGroups(){let e=!1;for(const t of this._partGroups.values())t.length>1&&(this.mergeGroup(t),e=!0);if(e)for(let t=0;t<this._score.tracks.length;t++)this._score.tracks[t].index=t}mergeGroup(e){let t=e[0];for(let i=1;i<e.length;i++){let r=e[i];for(let a of r.staves)t.addStaff(a);let n=this._score.tracks.indexOf(r);this._score.tracks.splice(n,1)}}parseDom(e){let t=e.firstElement;if(!t)throw new Ye("Unsupported format");switch(t.localName){case"score-partwise":this.parsePartwise(t);break;case"score-timewise":break;default:throw new Ye("Unsupported format")}}parsePartwise(e){for(let t of e.childNodes)if(t.nodeType===L.Element)switch(t.localName){case"work":this.parseWork(t);break;case"movement-title":this._score.title=t.innerText;break;case"identification":this.parseIdentification(t);break;case"part-list":this.parsePartList(t);break;case"part":this.parsePart(t);break}}parseWork(e){for(let t of e.childNodes)if(t.nodeType===L.Element)switch(t.localName){case"work-title":this._score.title=t.innerText;break}}parsePart(e){let t=e.getAttribute("id");if(!this._trackById.has(t))if(this._trackById.size===1){for(const[n,a]of this._trackById)(a.staves.length===0||a.staves[0].bars.length===0)&&(t=n);if(!this._trackById.has(t))return}else return;let i=this._trackById.get(t),r=!0;this._maxVoices=0;for(let n of e.childNodes)if(n.nodeType===L.Element)switch(n.localName){case"measure":this.parseMeasure(n,i,r)&&(r=!1);break}for(let n of i.staves)for(let a of n.bars)this.ensureVoices(a)}parseMeasure(e,t,i){if(e.getAttribute("implicit")==="yes"&&e.getElementsByTagName("note",!1).length===0)return!1;let r=0;if(i)this._divisionsPerQuarterNote=0,this._trackFirstMeasureNumber=parseInt(e.getAttribute("number")),this._trackFirstMeasureNumber||(this._trackFirstMeasureNumber=0),r=0;else{if(r=parseInt(e.getAttribute("number")),!r)return!1;r-=this._trackFirstMeasureNumber}if(i){let l=e.getElementsByTagName("attributes",!1);if(l.length>0){let h=l[0].getElementsByTagName("staves",!1);if(h.length>0){let u=parseInt(h[0].innerText);t.ensureStaveCount(u)}}}let n=new Array(t.staves.length),a=null;for(let l=t.staves[0].bars.length;l<=r;l++)for(let h=0;h<t.staves.length;h++){let u=new Sr;if(n[h]=u,t.staves[h].bars.length>0){let c=t.staves[h].bars[t.staves[h].bars.length-1];u.clef=c.clef}a=this.getOrCreateMasterBar(r),t.staves[h].addBar(u),this.ensureVoices(u)}let o=new Map;if(a){let l=!1;for(let h of e.childNodes)if(h.nodeType===L.Element)switch(h.localName){case"note":this.parseNoteBeat(h,n);break;case"forward":this.parseForward(h,n);break;case"direction":this.parseDirection(h,a);break;case"attributes":l||(this.parseAttributes(h,n,a,t),l=!0);break;case"harmony":this.parseHarmony(h,t,o);break;case"sound":break;case"barline":this.parseBarline(h,a);break}}return!0}ensureVoices(e){for(;e.voices.length<this._maxVoices;){let t=new Js;e.addVoice(t);let i=new Wt;i.isEmpty=!0,i.chordId=this._currentChord,t.addBeat(i)}}getOrCreateBeat(e,t,i){let r=0,n=e.getElementsByTagName("voice",!1);n.length>0&&(r=parseInt(n[0].innerText)-1);let a=this._previousBeatWasPulled;this._previousBeatWasPulled=!1;let o=e.getElementsByTagName("staff",!1),l=1;if(o.length>0){l=parseInt(o[0].innerText),(this._isBeamContinue||a)&&this._previousBeat.voice.bar.staff.index!==l-1&&(l=this._previousBeat.voice.bar.staff.index+1,this._previousBeatWasPulled=!0);let d=t[0].staff.track.index+"-"+l;this._voiceOfStaff.has(d)||this._voiceOfStaff.set(d,r)}l--;let h;l<0?h=t[0]:l>=t.length?h=t[t.length-1]:h=t[l];let u,c=this.getOrCreateVoice(h,r);return i&&c.beats.length>0||c.beats.length===1&&c.isEmpty?u=c.beats[c.beats.length-1]:(u=new Wt,u.isEmpty=!1,c.addBeat(u)),this._isBeamContinue=!1,this._previousBeat=u,u}parseForward(e,t){let i=this.getOrCreateBeat(e,t,!1),n=parseInt(e.findChildElement("duration").innerText)*k.Quarter/this._divisionsPerQuarterNote,a=[k.SixtyFourth,k.ThirtySecond,k.Sixteenth,k.Eighth,k.Quarter,k.Half,k.Whole];for(let o of a)if(n>=o){i.duration=o,n-=o;break}i.isEmpty=!1}parseStaffDetails(e,t){for(let i of e.childNodes)if(i.nodeType===L.Element)switch(i.localName){case"staff-lines":for(let r of t.staves)r.stringTuning.tunings=new Array(parseInt(i.innerText)).fill(0);break;case"staff-tuning":this.parseStaffTuning(i,t);break}for(let i of t.staves)this.isEmptyTuning(i.tuning)&&(i.stringTuning.tunings=[])}parseStaffTuning(e,t){let i=parseInt(e.getAttribute("line")),r="C",n="",a=0;for(let l of e.childNodes)if(l.nodeType===L.Element)switch(l.localName){case"tuning-step":r=l.innerText;break;case"tuning-alter":a=parseInt(l.innerText);break;case"tuning-octave":n=l.innerText;break}let o=Re.getTuningForText(r+n)+a;for(let l of t.staves)l.tuning[l.tuning.length-i]=o}parseHarmony(e,t,i){let r=new $r;for(let a of e.childNodes)if(a.nodeType===L.Element)switch(a.localName){case"root":r.name=this.parseHarmonyRoot(a);break;case"kind":r.name=r.name+this.parseHarmonyKind(a);break;case"frame":this.parseHarmonyFrame(a,r);break}this._currentChord=Re.newGuid();const n=r.uniqueId;i.has(n)&&(r.showDiagram=!1);for(let a of t.staves)a.addChord(this._currentChord,r);i.set(n,r)}parseHarmonyRoot(e){let t="",i="";for(let r of e.childNodes)if(r.nodeType===L.Element)switch(r.localName){case"root-step":t=r.innerText;break;case"root-alter":switch(parseInt(e.innerText)){case-2:i="bb";break;case-1:i="b";break;case 0:i="";break;case 1:i="#";break;case 2:i="##";break}break}return t+i}parseHarmonyKind(e){const t=e.getAttribute("text");let i="";if(t)i=t;else switch(e.innerText){case"major":i="";break;case"minor":i="m";break;case"augmented":i="+";break;case"diminished":i="○";break;case"dominant":i="7";break;case"major-seventh":i="7M";break;case"minor-seventh":i="m7";break;case"diminished-seventh":i="○7";break;case"augmented-seventh":i="+7";break;case"half-diminished":i="⍉";break;case"major-minor":i="mMaj";break;case"major-sixth":i="maj6";break;case"minor-sixth":i="m6";break;case"dominant-ninth":i="9";break;case"major-ninth":i="maj9";break;case"minor-ninth":i="m9";break;case"dominant-11th":i="11";break;case"major-11th":i="maj11";break;case"minor-11th":i="m11";break;case"dominant-13th":i="13";break;case"major-13th":i="maj13";break;case"minor-13th":i="m13";break;case"suspended-second":i="sus2";break;case"suspended-fourth":i="sus4";break}return i}parseHarmonyFrame(e,t){for(let i of e.childNodes)if(i.nodeType===L.Element)switch(i.localName){case"frame-strings":const r=parseInt(i.innerText);t.strings=new Array(r);for(let o=0;o<r;o++)t.strings[o]=-1;break;case"first-fret":t.firstFret=parseInt(i.innerText);break;case"frame-note":let n=null,a=null;for(let o of i.childNodes)switch(o.localName){case"string":n=parseInt(o.innerText);break;case"fret":a=parseInt(o.innerText),n&&a>=0&&(t.strings[n-1]=a);break;case"barre":n&&a&&o.getAttribute("type")==="start"&&t.barreFrets.push(a);break}break}}parseBarline(e,t){for(let i of e.childNodes)if(i.nodeType===L.Element)switch(i.localName){case"repeat":this.parseRepeat(i,t);break;case"ending":this.parseEnding(i,t);break}}parseEnding(e,t){let i=parseInt(e.getAttribute("number"));i>0&&(--i,t.alternateEndings=t.alternateEndings|1<<i&255)}parseRepeat(e,t){let i=e.getAttribute("direction"),r=parseInt(e.getAttribute("times"));(r<0||isNaN(r))&&(r=2),i==="backward"?t.repeatCount=r:i==="forward"&&(t.isRepeatStart=!0)}parseNoteBeat(e,t){let i=e.getElementsByTagName("chord",!1).length>0,r=this.getOrCreateBeat(e,t,i);!r.chordId&&this._currentChord&&(r.chordId=this._currentChord,this._currentChord=null),this._currentDirection&&(r.text=this._currentDirection,this._currentDirection=null);let n=new je;r.voice.isEmpty=!1,r.isEmpty=!1,r.addNote(n),r.dots=0;let a=!1;for(let o of e.childNodes)if(o.nodeType===L.Element)switch(o.localName){case"grace":r.graceType=$.BeforeBeat,r.duration=k.ThirtySecond;break;case"duration":if(r.isRest&&!a)switch(parseInt(o.innerText)){case 1:r.duration=k.Whole;break;case 2:r.duration=k.Half;break;case 4:r.duration=k.Quarter;break;case 8:r.duration=k.Eighth;break;case 16:r.duration=k.Sixteenth;break;case 32:r.duration=k.ThirtySecond;break;case 64:r.duration=k.SixtyFourth;break;default:r.duration=k.Quarter;break}break;case"tie":this.parseTied(o,n);break;case"cue":break;case"instrument":break;case"type":r.duration=this.getDuration(o.innerText),r.graceType!==$.None&&r.duration<k.Sixteenth&&(r.duration=k.Eighth);break;case"dot":r.dots++;break;case"accidental":this.parseAccidental(o,n);break;case"time-modification":this.parseTimeModification(o,r);break;case"stem":break;case"notehead":o.getAttribute("parentheses")==="yes"&&(n.isGhost=!0);break;case"beam":o.innerText==="continue"&&(this._isBeamContinue=!0);break;case"notations":this.parseNotations(o,r,n);break;case"lyric":this.parseLyric(o,r);break;case"pitch":this.parsePitch(o,n);break;case"unpitched":this.parseUnpitched(o,n);break;case"rest":a=o.getAttribute("measure")==="yes",r.isEmpty=!1,r.notes=[],r.duration=k.Whole;break}if(n.isStringed){for(let o=0;o<r.notes.length;o++)if(r.notes[o].string===n.string&&r.notes[o]!==n){r.removeNote(n);break}}}getDuration(e){switch(e){case"256th":case"128th":case"64th":return k.SixtyFourth;case"32nd":return k.ThirtySecond;case"16th":return k.Sixteenth;case"eighth":return k.Eighth;case"quarter":return k.Quarter;case"half":return k.Half;case"long":case"breve":case"whole":return k.Whole}return k.Quarter}parseLyric(e,t){for(let i of e.childNodes)if(i.nodeType===L.Element)switch(i.localName){case"text":t.text?t.text+=" "+i.innerText:t.text=i.innerText;break}}parseAccidental(e,t){switch(e.innerText){case"sharp":t.accidentalMode=ot.ForceSharp;break;case"natural":t.accidentalMode=ot.ForceNatural;break;case"flat":t.accidentalMode=ot.ForceFlat;break}}parseTied(e,t){if(e.getAttribute("type")==="start")this._tieStartIds.has(t.id)||(this._tieStartIds.set(t.id,!0),this._tieStarts.push(t));else if(e.getAttribute("type")==="stop"&&this._tieStarts.length>0&&!t.isTieDestination){const i=this._tieStarts[0];i.beat.voice.index===t.beat.voice.index&&i.beat.voice.bar.staff.index===t.beat.voice.bar.staff.index&&i.beat.voice.bar.staff.track.index===t.beat.voice.bar.staff.track.index&&(t.isTieDestination=!0,t.tieOrigin=this._tieStarts[0]),this._tieStarts.splice(0,1),this._tieStartIds.delete(t.id)}}parseNotations(e,t,i){for(let r of e.childNodes)if(r.nodeType===L.Element)switch(r.localName){case"articulations":this.parseArticulations(r,i);break;case"tied":this.parseTied(r,i);break;case"slide":case"glissando":r.getAttribute("type")==="start"&&(i.slideOutType=ne.Shift);break;case"dynamics":this.parseDynamics(r,t);break;case"technical":this.parseTechnical(r,i);break;case"ornaments":this.parseOrnaments(r,i);break;case"slur":let n=r.getAttribute("number");switch(n||(n="1"),n=t.voice.bar.staff.index+"_"+n,r.getAttribute("type")){case"start":this._slurStarts.set(n,i);break;case"stop":if(this._slurStarts.has(n)){i.isSlurDestination=!0;let a=this._slurStarts.get(n);a.slurDestination=i,i.slurOrigin=a}break}break}}parseOrnaments(e,t){for(let i of e.childNodes)if(i.nodeType===L.Element)switch(i.localName){case"tremolo":switch(parseInt(i.innerText)){case 1:t.beat.tremoloSpeed=k.Eighth;break;case 2:t.beat.tremoloSpeed=k.Sixteenth;break;case 3:t.beat.tremoloSpeed=k.ThirtySecond;break}break}}parseTechnical(e,t){let i=[];for(let r of e.childNodes)if(r.nodeType===L.Element)switch(r.localName){case"string":t.string=parseInt(r.innerText),t.string!==-2147483648&&(t.string=t.beat.voice.bar.staff.tuning.length-t.string+1);break;case"fret":t.fret=parseInt(r.innerText);break;case"down-bow":t.beat.pickStroke=At.Down;break;case"up-bow":t.beat.pickStroke=At.Up;break;case"bend":i.push(r);break}i.length>0&&this.parseBends(i,t),(t.string===-2147483648||t.fret===-2147483648)&&(t.string=-1,t.fret=-1)}parseBends(e,t){let i=A.MaxPosition/e.length,r=0,n=0,a=!0;for(let o of e){let l=o.findChildElement("bend-alter");if(l){let h=Math.round(Math.abs(parseFloat(l.innerText))*2);o.findChildElement("pre-bend")?a?(r+=h,t.addBendPoint(new A(n,r)),n+=i,t.addBendPoint(new A(n,r)),a=!1):n+=i:o.findChildElement("release")?(a&&(r+=h),t.addBendPoint(new A(n,r)),n+=i,r-=h,t.addBendPoint(new A(n,r)),a=!1):(t.addBendPoint(new A(n,r)),r+=h,n+=i,t.addBendPoint(new A(n,r)),a=!1)}}}parseArticulations(e,t){for(let i of e.childNodes)switch(i.localName){case"accent":t.accentuated=et.Normal;break;case"strong-accent":t.accentuated=et.Heavy;break;case"staccato":case"detached-legato":t.isStaccato=!0;break;case"tenuto":t.accentuated=et.Tenuto;break}}parseDynamics(e,t){for(let i of e.childNodes)if(i.nodeType===L.Element)switch(i.localName){case"p":t.dynamics=de.P;break;case"pp":t.dynamics=de.PP;break;case"ppp":t.dynamics=de.PPP;break;case"f":t.dynamics=de.F;break;case"ff":t.dynamics=de.FF;break;case"fff":t.dynamics=de.FFF;break;case"mp":t.dynamics=de.MP;break;case"mf":t.dynamics=de.MF;break}}parseTimeModification(e,t){for(let i of e.childNodes)if(i.nodeType===L.Element)switch(i.localName){case"actual-notes":t.tupletNumerator=parseInt(i.innerText);break;case"normal-notes":t.tupletDenominator=parseInt(i.innerText);break}}parseUnpitched(e,t){let i="",r=0,n=0;for(let o of e.childNodes)if(o.nodeType===L.Element)switch(o.localName){case"display-step":i=o.innerText;break;case"display-alter":r=parseInt(o.innerText);break;case"display-octave":n=parseInt(o.innerText);break}let a=n*12+Re.getToneForText(i)+r;t.octave=a/12|0,t.tone=a-t.octave*12}parsePitch(e,t){let i="",r=0,n=0;for(let o of e.childNodes)if(o.nodeType===L.Element)switch(o.localName){case"step":i=o.innerText;break;case"alter":r=parseFloat(o.innerText),isNaN(r)&&(r=0);break;case"octave":n=parseInt(o.innerText)+1;break}let a=n*12+Re.getToneForText(i)+(r|0);t.octave=a/12|0,t.tone=a-t.octave*12}getOrCreateVoice(e,t){if(t<e.voices.length)return e.voices[t];for(let i=e.voices.length;i<=t;i++)e.addVoice(new Js);return this._maxVoices=Math.max(this._maxVoices,e.voices.length),e.voices[t]}parseDirection(e,t){for(let i of e.childNodes)if(i.nodeType===L.Element)switch(i.localName){case"sound":let r=i.getAttribute("tempo");if(r){let a=new Vt;a.isLinear=!0,a.type=gt.Tempo,a.value=parseInt(r),t.tempoAutomations.push(a),t.index===0&&(t.score.tempo=a.value)}break;case"direction-type":let n=i.firstElement;switch(n.localName){case"words":this._currentDirection=n.innerText;break;case"metronome":this.parseMetronome(n,t);break}break}}parseMetronome(e,t){let i=k.Quarter,r=120;for(let a of e.childNodes)if(a.nodeType===L.Element)switch(a.localName){case"beat-unit":i=this.getDuration(a.innerText);break;case"per-minute":r=parseInt(a.innerText);break}let n=new Vt;n.type=gt.Tempo,n.value=r*(i/4)|0,this.hasSameTempo(t,n)||(t.tempoAutomations.push(n),t.index===0&&(t.score.tempo=n.value))}hasSameTempo(e,t){for(const i of e.tempoAutomations)if(t.ratioPosition===i.ratioPosition&&t.value==i.value)return!0;return!1}parseAttributes(e,t,i,r){let n=0,a=!1;for(let o of e.childNodes)if(o.nodeType===L.Element)switch(o.localName){case"divisions":this._divisionsPerQuarterNote=parseInt(o.innerText);break;case"key":this.parseKey(o,i);break;case"time":this.parseTime(o,i),a=!0;break;case"clef":n=parseInt(o.getAttribute("number")),isNaN(n)&&(n=1),this.parseClef(o,t[n-1]);break;case"staff-details":this.parseStaffDetails(o,r);break;case"transpose":this.parseTranspose(o,r);break}a||(i.timeSignatureCommon=!0)}parseTranspose(e,t){let i=0;for(let r of e.childNodes)if(r.nodeType===L.Element)switch(r.localName){case"chromatic":i+=parseInt(r.innerText);break;case"octave-change":i+=parseInt(r.innerText)*12;break}for(let r of t.staves)r.transpositionPitch=i}parseClef(e,t){let i="s",r=0;for(let n of e.childNodes)if(n.nodeType===L.Element)switch(n.localName){case"sign":i=n.innerText.toLowerCase();break;case"line":r=parseInt(n.innerText);break;case"clef-octave-change":switch(parseInt(n.innerText)){case-2:t.clefOttava=Te._15mb;break;case-1:t.clefOttava=Te._8vb;break;case 1:t.clefOttava=Te._8va;break;case 2:t.clefOttava=Te._15mb;break}break}switch(i){case"g":t.clef=ie.G2;break;case"f":t.clef=ie.F4;break;case"c":r===3?t.clef=ie.C3:t.clef=ie.C4;break;case"percussion":t.clef=ie.Neutral,t.staff.isPercussion=!0;break;case"tab":t.clef=ie.G2,t.staff.showTablature=!0;break;default:t.clef=ie.G2;break}}parseTime(e,t){e.getAttribute("symbol")==="common"&&(t.timeSignatureCommon=!0);let i=!1,r=!1;for(let n of e.childNodes)if(n.nodeType===L.Element){let a=n.innerText;switch(n.localName){case"beats":i||(a.indexOf("+")===-1?t.timeSignatureNumerator=parseInt(a):t.timeSignatureNumerator=4,i=!0);break;case"beat-type":r||(a.indexOf("+")===-1?t.timeSignatureDenominator=parseInt(a):t.timeSignatureDenominator=4,r=!0);break}}}parseKey(e,t){let i=-2147483648,r="";for(let n of e.childNodes)if(n.nodeType===L.Element)switch(n.localName){case"fifths":i=parseInt(n.innerText);break;case"key-step":break;case"key-alter":break;case"mode":r=n.innerText;break}-7<=i&&i<=7?t.keySignature=i:t.keySignature=fe.C,r==="minor"?t.keySignatureType=Es.Minor:t.keySignatureType=Es.Major}getOrCreateMasterBar(e){if(e<this._score.masterBars.length)return this._score.masterBars[e];for(let t=this._score.masterBars.length;t<=e;t++){let i=new mr;if(this._score.masterBars.length>0){let r=this._score.masterBars[this._score.masterBars.length-1];i.timeSignatureDenominator=r.timeSignatureDenominator,i.timeSignatureNumerator=r.timeSignatureNumerator,i.keySignature=r.keySignature,i.keySignatureType=r.keySignatureType}this._score.addMasterBar(i)}return this._score.masterBars[e]}parseIdentification(e){for(let t of e.childNodes)if(t.nodeType===L.Element)switch(t.localName){case"creator":t.getAttribute("type")==="composer"&&(this._score.music=t.innerText);break;case"rights":this._score.copyright&&(this._score.copyright+=`
`),this._score.copyright+=t.innerText;break}}parsePartList(e){for(let t of e.childNodes)if(t.nodeType===L.Element)switch(t.localName){case"part-group":this.parsePartGroup(t);break;case"score-part":this.parseScorePart(t);break}}parsePartGroup(e){switch(e.getAttribute("type")){case"start":this._currentPartGroup=e.getAttribute("number"),this._partGroups.set(this._currentPartGroup,[]);break;case"stop":this._currentPartGroup=null;break}}parseScorePart(e){let t=e.getAttribute("id"),i=new Qs;i.ensureStaveCount(1);let r=i.staves[0];r.showStandardNotation=!0,this._trackById.set(t,i),this._score.addTrack(i),this._currentPartGroup&&this._partGroups.get(this._currentPartGroup).push(i);for(let n of e.childNodes)if(n.nodeType===L.Element)switch(n.localName){case"part-name":i.name=n.innerText;break;case"part-abbreviation":i.shortName=n.innerText;break;case"midi-instrument":this.parseMidiInstrument(n,i);break}this.isEmptyTuning(i.staves[0].tuning)&&(i.staves[0].stringTuning.tunings=[])}isEmptyTuning(e){if(!e)return!0;for(let t=0;t<e.length;t++)if(e[t]!==0)return!1;return!0}parseMidiInstrument(e,t){for(let i of e.childNodes)if(i.nodeType===L.Element)switch(i.localName){case"midi-channel":t.playbackInfo.primaryChannel=parseInt(i.innerText);break;case"midi-program":t.playbackInfo.program=parseInt(i.innerText);break;case"volume":t.playbackInfo.volume=Math.floor(parseInt(i.innerText)/100*16);break;case"pan":t.playbackInfo.balance=Math.max(0,Math.min(16,Math.floor((parseInt(i.innerText)+90)/180*16)));break}}}var ba;(function(s){s[s.SingleTrackMultiChannel=0]="SingleTrackMultiChannel",s[s.MultiTrack=1]="MultiTrack"})(ba||(ba={}));class Mw{constructor(){this.events=[]}addEvent(e){if(this.events.length===0||e.tick>=this.events[this.events.length-1].tick)this.events.push(e);else{let t=this.events.length;for(;t>0&&this.events[t-1].tick>e.tick;)t--;this.events.splice(t,0,e)}}writeTo(e){let t=Tt.empty(),i=0;for(let a of this.events){let o=a.tick-i;zr.writeVariableInt(t,o),a.writeTo(t),i=a.tick}const r=new Uint8Array([77,84,114,107]);e.write(r,0,r.length);let n=t.toArray();v.writeInt32BE(e,n.length),e.write(n,0,n.length)}}class zr{constructor(){this.format=ba.SingleTrackMultiChannel,this.division=re.QuarterTime,this.tracks=[]}get events(){if(this.tracks.length==1)return this.tracks[0].events;{const e=[];for(const t of this.tracks)this.events.push(...t.events);return e.sort((t,i)=>t.tick-i.tick),e}}ensureTracks(e){for(;this.tracks.length<e;)this.tracks.push(new Mw)}addEvent(e){this.format==ba.SingleTrackMultiChannel?(this.ensureTracks(1),this.tracks[0].addEvent(e)):(this.ensureTracks(e.track+1),this.tracks[e.track].addEvent(e))}toBinary(){let e=Tt.empty();return this.writeTo(e),e.toArray()}writeTo(e){let t=new Uint8Array([77,84,104,100]);e.write(t,0,t.length),v.writeInt32BE(e,6),v.writeInt16BE(e,this.format),v.writeInt16BE(e,this.tracks.length),v.writeInt16BE(e,this.division);for(const i of this.tracks)i.writeTo(e)}static writeVariableInt(e,t){let i=new Uint8Array(4),r=0;do i[r++]=t&127,t>>=7;while(t>0);for(;r>0;)r--,r>0?e.writeByte(i[r]|128):e.writeByte(i[r])}}var ye;(function(s){s[s.TimeSignature=88]="TimeSignature",s[s.NoteOn=128]="NoteOn",s[s.NoteOff=144]="NoteOff",s[s.ControlChange=176]="ControlChange",s[s.ProgramChange=192]="ProgramChange",s[s.TempoChange=81]="TempoChange",s[s.PitchBend=224]="PitchBend",s[s.PerNotePitchBend=96]="PerNotePitchBend",s[s.EndOfTrack=47]="EndOfTrack",s[s.AlphaTabRest=241]="AlphaTabRest",s[s.AlphaTabMetronome=242]="AlphaTabMetronome",s[s.SystemExclusive=240]="SystemExclusive",s[s.SystemExclusive2=247]="SystemExclusive2",s[s.Meta=255]="Meta"})(ye||(ye={}));class kr{constructor(e,t,i){this.track=e,this.tick=t,this.type=i}get command(){return this.type}get message(){return 0}get data1(){return 0}get data2(){return 0}}class Fw extends kr{constructor(e,t,i,r,n,a){super(e,t,ye.TimeSignature),this.track=e,this.tick=t,this.numerator=i,this.denominatorIndex=r,this.midiClocksPerMetronomeClick=n,this.thirtySecondNodesInQuarter=a}writeTo(e){e.writeByte(255),e.writeByte(88),zr.writeVariableInt(e,4),e.writeByte(this.numerator&255),e.writeByte(this.denominatorIndex&255),e.writeByte(this.midiClocksPerMetronomeClick&255),e.writeByte(this.thirtySecondNodesInQuarter&255)}}class yr extends kr{constructor(e,t,i){super(e,t,i)}writeTo(e){e.writeByte(240);const t=Tt.withCapacity(16);t.writeByte(yr.AlphaTabManufacturerId),this.writeEventData(t),t.writeByte(247),zr.writeVariableInt(e,t.length),t.copyTo(e)}}yr.AlphaTabManufacturerId=125;yr.MetronomeEventId=0;yr.RestEventId=1;class Rw extends yr{constructor(e,t,i,r,n){super(e,t,ye.AlphaTabMetronome),this.isMetronome=!0,this.metronomeNumerator=i,this.metronomeDurationInMilliseconds=n,this.metronomeDurationInTicks=r}writeEventData(e){e.writeByte(yr.MetronomeEventId),e.writeByte(this.metronomeNumerator),v.writeInt32LE(e,this.metronomeDurationInTicks),v.writeInt32LE(e,this.metronomeDurationInMilliseconds)}}class Dw extends yr{constructor(e,t,i){super(e,t,ye.AlphaTabRest),this.channel=i}writeEventData(e){e.writeByte(yr.RestEventId),e.writeByte(this.channel)}}class Aw extends kr{constructor(e,t,i,r,n,a){super(e,t,i),this.channel=r,this.noteKey=n,this.noteVelocity=a}get data1(){return this.noteKey}get data2(){return this.noteVelocity}}class Iw extends Aw{constructor(e,t,i,r,n){super(e,t,ye.NoteOn,i,r,n)}writeTo(e){e.writeByte(this.channel&15|144),e.writeByte(this.noteKey&255),e.writeByte(this.noteVelocity&255)}}class Ow extends Aw{constructor(e,t,i,r,n){super(e,t,ye.NoteOff,i,r,n)}writeTo(e){e.writeByte(this.channel&15|128),e.writeByte(this.noteKey&255),e.writeByte(this.noteVelocity&255)}}class Vw extends kr{constructor(e,t,i,r,n){super(e,t,ye.ControlChange),this.channel=i,this.controller=r,this.value=n}writeTo(e){e.writeByte(this.channel&15|176),e.writeByte(this.controller&255),e.writeByte(this.value&255)}get data1(){return this.controller}get data2(){return this.value}}class Hw extends kr{constructor(e,t,i,r){super(e,t,ye.ProgramChange),this.channel=i,this.program=r}writeTo(e){e.writeByte(this.channel&15|192),e.writeByte(this.program&255)}get data1(){return this.program}}class Ww extends kr{constructor(e,t){super(0,e,ye.TempoChange),this.microSecondsPerQuarterNote=t}writeTo(e){e.writeByte(255),e.writeByte(81),e.writeByte(3),e.writeByte(this.microSecondsPerQuarterNote>>16&255),e.writeByte(this.microSecondsPerQuarterNote>>8&255),e.writeByte(this.microSecondsPerQuarterNote&255)}}class zw extends kr{constructor(e,t,i,r){super(e,t,ye.PitchBend),this.channel=i,this.value=r}writeTo(e){e.writeByte(this.channel&15|224),e.writeByte(this.value&127),e.writeByte(this.value>>7&127)}get data1(){return this.value&127}get data2(){return this.value>>7&127}}class Gw extends kr{constructor(e,t,i,r,n){super(e,t,ye.PerNotePitchBend),this.channel=i,this.noteKey=r,this.value=n}writeTo(e){throw new Pt(Nt.General,"Note Bend (Midi2.0) events cannot be exported to SMF1.0")}}class Uw extends kr{constructor(e,t){super(e,t,ye.EndOfTrack)}writeTo(e){e.writeByte(255),e.writeByte(47),e.writeByte(0)}}class lo{constructor(e,t){this.time=0,this.eventIndex=e,this.event=t,this.isMetronome=this.event.type==ye.AlphaTabMetronome}static newMetronomeEvent(e,t,i,r,n){const a=new Rw(0,t,i,r,n);return new lo(e,a)}}class le{}le.DefaultChannelCount=17;le.MetronomeChannel=le.DefaultChannelCount-1;le.AudioChannels=2;le.MinVolume=0;le.MinProgram=0;le.MaxProgram=127;le.MinPlaybackSpeed=.125;le.MaxPlaybackSpeed=8;le.MaxPitchWheel=16384;le.MaxPitchWheel20=4294967296;le.DefaultPitchWheel=le.MaxPitchWheel/2;le.MicroBufferCount=32;le.MicroBufferSize=64;class wm{constructor(e,t,i){this.bpm=e,this.ticks=t,this.time=i}}class uc{constructor(){this.tempoChanges=[],this.firstProgramEventPerChannel=new Map,this.firstTimeSignatureNumerator=0,this.firstTimeSignatureDenominator=0,this.synthData=[],this.division=re.QuarterTime,this.eventIndex=0,this.currentTime=0,this.playbackRange=null,this.playbackRangeStartTime=0,this.playbackRangeEndTime=0,this.endTick=0,this.endTime=0}}class ov{get isPlayingMain(){return this._currentState==this._mainState}get isPlayingOneTimeMidi(){return this._currentState==this._oneTimeState}get isPlayingCountIn(){return this._currentState==this._countInState}constructor(e){this._oneTimeState=null,this._countInState=null,this.isLooping=!1,this.playbackSpeed=1,this._synthesizer=e,this._mainState=new uc,this._currentState=this._mainState}get mainPlaybackRange(){return this._mainState.playbackRange}set mainPlaybackRange(e){this._mainState.playbackRange=e,e&&(this._mainState.playbackRangeStartTime=this.tickPositionToTimePositionWithSpeed(this._mainState,e.startTick,1),this._mainState.playbackRangeEndTime=this.tickPositionToTimePositionWithSpeed(this._mainState,e.endTick,1))}get currentTime(){return this._currentState.currentTime/this.playbackSpeed}get currentEndTick(){return this._currentState.endTick}get currentEndTime(){return this._currentState.endTime/this.playbackSpeed}mainSeek(e){if(e*=this.playbackSpeed,this.mainPlaybackRange&&(e<this._mainState.playbackRangeStartTime?e=this._mainState.playbackRangeStartTime:e>this._mainState.playbackRangeEndTime&&(e=this._mainState.playbackRangeEndTime)),e>this._mainState.currentTime)this.mainSilentProcess(e-this._mainState.currentTime);else if(e<this._mainState.currentTime){if(this._mainState.currentTime=0,this._mainState.eventIndex=0,this.isPlayingMain){let t=this._synthesizer.metronomeVolume;this._synthesizer.noteOffAll(!0),this._synthesizer.resetSoft(),this._synthesizer.setupMetronomeChannel(t)}this.mainSilentProcess(e)}}mainSilentProcess(e){if(e<=0)return;let t=Date.now(),i=this._mainState.currentTime+e;if(this.isPlayingMain)for(;this._mainState.currentTime<i;)this.fillMidiEventQueueLimited(i-this._mainState.currentTime)&&this._synthesizer.synthesizeSilent(le.MicroBufferSize);this._mainState.currentTime=i;let r=Date.now()-t;C.debug("Sequencer","Silent seek finished in "+r+"ms (main)")}loadOneTimeMidi(e){this._oneTimeState=this.createStateFromFile(e),this._currentState=this._oneTimeState}loadMidi(e){this._mainState=this.createStateFromFile(e),this._currentState=this._mainState}createStateFromFile(e){const t=new uc;t.tempoChanges=[],t.division=e.division,t.eventIndex=0,t.currentTime=0,t.synthData=[];let i=120,r=0,n=0,a=0,o=0,l=0,h=0,u=0,c=0;for(let d of e.events){let p=new lo(t.synthData.length,d);t.synthData.push(p);let g=d.tick-c;if(r+=g,n+=g*(6e4/(i*e.division)),p.time=n,c=d.tick,o>0)for(;h<r;){let w=lo.newMetronomeEvent(t.synthData.length,h,Math.floor(h/o)%a,o,l);t.synthData.push(w),w.time=u,h+=o,u+=l}if(d.type===ye.TempoChange)i=6e7/d.microSecondsPerQuarterNote,t.tempoChanges.push(new wm(i,r,n)),l=o*(6e4/(i*e.division));else if(d.type===ye.TimeSignature){let w=d,S=Math.pow(2,w.denominatorIndex);a=w.numerator,o=t.division*(4/S)|0,l=o*(6e4/(i*e.division)),t.firstTimeSignatureDenominator===0&&(t.firstTimeSignatureNumerator=w.numerator,t.firstTimeSignatureDenominator=S)}else if(d.type===ye.ProgramChange){let w=d.channel;t.firstProgramEventPerChannel.has(w)||t.firstProgramEventPerChannel.set(w,p)}}return t.synthData.sort((d,p)=>d.time>p.time?1:d.time<p.time?-1:d.eventIndex-p.eventIndex),t.endTime=n,t.endTick=r,t}fillMidiEventQueue(){return this.fillMidiEventQueueLimited(-1)}fillMidiEventQueueLimited(e){let t=le.MicroBufferSize/this._synthesizer.outSampleRate*1e3*this.playbackSpeed,i=this.internalEndTime;e>0&&(e<t&&(t=e),i=Math.min(this.internalEndTime,this._currentState.currentTime+e));let r=!1;for(this._currentState.currentTime+=t;this._currentState.eventIndex<this._currentState.synthData.length&&this._currentState.synthData[this._currentState.eventIndex].time<this._currentState.currentTime&&this._currentState.currentTime<i;)this._synthesizer.dispatchEvent(this._currentState.synthData[this._currentState.eventIndex]),this._currentState.eventIndex++,r=!0;return r}mainTickPositionToTimePosition(e){return this.tickPositionToTimePositionWithSpeed(this._mainState,e,this.playbackSpeed)}mainTimePositionToTickPosition(e){return this.timePositionToTickPositionWithSpeed(this._mainState,e,this.playbackSpeed)}currentTimePositionToTickPosition(e){return this.timePositionToTickPositionWithSpeed(this._currentState,e,this.playbackSpeed)}tickPositionToTimePositionWithSpeed(e,t,i){let r=0,n=120,a=0;for(const o of e.tempoChanges){if(t<o.ticks)break;r=o.time,n=o.bpm,a=o.ticks}return t-=a,r+=t*(6e4/(n*e.division)),r/i}timePositionToTickPositionWithSpeed(e,t,i){t*=i;let r=0,n=120,a=0;for(const o of e.tempoChanges){if(t<o.time)break;r=o.ticks,n=o.bpm,a=o.time}return t-=a,r+=t/(6e4/(n*e.division))|0,r+1}get internalEndTime(){return this.isPlayingMain?this.mainPlaybackRange?this._currentState.playbackRangeEndTime:this._currentState.endTime:this._currentState.endTime}get isFinished(){return this._currentState.currentTime>=this.internalEndTime}stop(){this.isPlayingMain&&this.mainPlaybackRange?this._currentState.currentTime=this.mainPlaybackRange.startTick:this._currentState.currentTime=0,this._currentState.eventIndex=0}resetOneTimeMidi(){this._oneTimeState=null,this._currentState=this._mainState}resetCountIn(){this._countInState=null,this._currentState=this._mainState}startCountIn(){this.generateCountInMidi(),this._currentState=this._countInState,this.stop(),this._synthesizer.noteOffAll(!0)}generateCountInMidi(){const e=new uc;e.division=this._mainState.division;let t=120,i=4,r=4;this._mainState.eventIndex===0?(t=this._mainState.tempoChanges[0].bpm,i=this._mainState.firstTimeSignatureNumerator,r=this._mainState.firstTimeSignatureDenominator):(t=this._synthesizer.currentTempo,i=this._synthesizer.timeSignatureNumerator,r=this._synthesizer.timeSignatureDenominator),e.tempoChanges.push(new wm(t,0,0));let n=e.division*(4/r)|0,a=n*(6e4/(t*this._mainState.division)),o=0,l=0;for(let h=0;h<i;h++){let u=lo.newMetronomeEvent(e.synthData.length,o,h,n,a);e.synthData.push(u),u.time=l,o+=n,l+=a}e.synthData.sort((h,u)=>h.time>u.time?1:h.time<u.time?-1:h.eventIndex-u.eventIndex),e.endTime=l,e.endTick=o,this._countInState=e}}var dt;(function(s){s[s.Paused=0]="Paused",s[s.Playing=1]="Playing"})(dt||(dt={}));class ho{constructor(e,t){this.state=e,this.stopped=t}}class Oo{constructor(e,t,i,r,n){this.currentTime=e,this.endTime=t,this.currentTick=i,this.endTick=r,this.isSeek=n}}class Vi{constructor(){this.id="",this.size=0}static load(e,t,i){if(e&&Vi.HeaderSize>e.size||i.position+Vi.HeaderSize>=i.length||(t.id=v.read8BitStringLength(i,4),t.id.charCodeAt(0)<=32||t.id.charCodeAt(0)>=122)||(t.size=v.readUInt32LE(i),e&&Vi.HeaderSize+t.size>e.size))return!1;e&&(e.size-=Vi.HeaderSize+t.size);let r=t.id==="RIFF",n=t.id==="LIST";return r&&e?!1:!r&&!n?!0:(t.id=v.read8BitStringLength(i,4),t.id.charCodeAt(0)<=32||t.id.charCodeAt(0)>=122?!1:(t.size-=4,!0))}}Vi.HeaderSize=8;class np{constructor(){this.phdrs=[],this.pbags=[],this.pmods=[],this.pgens=[],this.insts=[],this.ibags=[],this.imods=[],this.igens=[],this.sHdrs=[],this.fontSamples=new Float32Array(0)}load(e){const t=new Vi,i=new Vi;if(!Vi.load(null,t,e)||t.id!=="sfbk")throw new ut("Soundfont is not a valid Soundfont2 file");for(;Vi.load(t,i,e);){let r=new Vi;if(i.id==="pdta")for(;Vi.load(i,r,e);)switch(r.id){case"phdr":for(let n=0,a=r.size/Ad.SizeInFile|0;n<a;n++)this.phdrs.push(new Ad(e));break;case"pbag":for(let n=0,a=r.size/Dd.SizeInFile|0;n<a;n++)this.pbags.push(new Dd(e));break;case"pmod":for(let n=0,a=r.size/Id.SizeInFile|0;n<a;n++)this.pmods.push(new Id(e));break;case"pgen":for(let n=0,a=r.size/Ni.SizeInFile|0;n<a;n++)this.pgens.push(new Ni(e));break;case"inst":for(let n=0,a=r.size/Rd.SizeInFile|0;n<a;n++)this.insts.push(new Rd(e));break;case"ibag":for(let n=0,a=r.size/Ld.SizeInFile|0;n<a;n++)this.ibags.push(new Ld(e));break;case"imod":for(let n=0,a=r.size/Md.SizeInFile|0;n<a;n++)this.imods.push(new Md(e));break;case"igen":for(let n=0,a=r.size/Fd.SizeInFile|0;n<a;n++)this.igens.push(new Fd(e));break;case"shdr":for(let n=0,a=r.size/Od.SizeInFile|0;n<a;n++)this.sHdrs.push(new Od(e));break;default:e.position+=r.size;break}else if(i.id==="sdta")for(;Vi.load(i,r,e);)switch(r.id){case"smpl":this.fontSamples=np.loadSamples(r,e);break;default:e.position+=r.size;break}else e.position+=i.size}}static loadSamples(e,t){let i=e.size/2|0;const r=new Float32Array(i);let n=0;const a=new Uint8Array(16*1024);for(;i>0;){let o=Math.min(i,a.length/2|0);t.read(a,0,o*2);for(let l=0;l<o;l++){const h=ue.int32ToInt16(a[l*2+1]<<8|a[l*2]);r[n+l]=h/32767}i-=o,n+=o}return r}}class Ld{constructor(e){this.instGenNdx=v.readUInt16LE(e),this.instModNdx=v.readUInt16LE(e)}}Ld.SizeInFile=4;class Md{constructor(e){this.modSrcOper=v.readUInt16LE(e),this.modDestOper=v.readUInt16LE(e),this.modAmount=v.readInt16LE(e),this.modAmtSrcOper=v.readUInt16LE(e),this.modTransOper=v.readUInt16LE(e)}}Md.SizeInFile=10;class Fd{constructor(e){this.genOper=v.readUInt16LE(e),this.genAmount=new $w(e)}}Fd.SizeInFile=4;class Rd{constructor(e){this.instName=v.read8BitStringLength(e,20),this.instBagNdx=v.readUInt16LE(e)}}Rd.SizeInFile=22;class Dd{constructor(e){this.genNdx=v.readUInt16LE(e),this.modNdx=v.readUInt16LE(e)}}Dd.SizeInFile=4;class Ni{constructor(e){this.genOper=v.readUInt16LE(e),this.genAmount=new $w(e)}}Ni.SizeInFile=4;Ni.GenInstrument=41;Ni.GenKeyRange=43;Ni.GenVelRange=44;Ni.GenSampleId=53;class Ad{constructor(e){this.presetName=v.read8BitStringLength(e,20),this.preset=v.readUInt16LE(e),this.bank=v.readUInt16LE(e),this.presetBagNdx=v.readUInt16LE(e),this.library=v.readUInt32LE(e),this.genre=v.readUInt32LE(e),this.morphology=v.readUInt32LE(e)}}Ad.SizeInFile=38;class Id{constructor(e){this.modSrcOper=v.readUInt16LE(e),this.modDestOper=v.readUInt16LE(e),this.modAmount=v.readUInt16LE(e),this.modAmtSrcOper=v.readUInt16LE(e),this.modTransOper=v.readUInt16LE(e)}}Id.SizeInFile=10;class Od{constructor(e){this.sampleName=v.read8BitStringLength(e,20),this.start=v.readUInt32LE(e),this.end=v.readUInt32LE(e),this.startLoop=v.readUInt32LE(e),this.endLoop=v.readUInt32LE(e),this.sampleRate=v.readUInt32LE(e),this.originalPitch=e.readByte(),this.pitchCorrection=v.readSInt8(e),this.sampleLink=v.readUInt16LE(e),this.sampleType=v.readUInt16LE(e)}}Od.SizeInFile=46;class $w{get shortAmount(){return ue.uint16ToInt16(this.wordAmount)}get lowByteAmount(){return this.wordAmount&255}get highByteAmount(){return(this.wordAmount&65280)>>8&255}constructor(e){this.wordAmount=v.readUInt16LE(e)}}class lv{constructor(){this.presetIndex=0,this.bank=0,this.pitchWheel=0,this.perNotePitchWheel=new Map,this.midiPan=0,this.midiVolume=0,this.midiExpression=0,this.midiRpn=0,this.midiData=0,this.panOffset=0,this.gainDb=0,this.pitchRange=0,this.tuning=0,this.mixVolume=0,this.mute=!1,this.solo=!1}}class hv{constructor(){this.activeChannel=0,this.channelList=[]}setupVoice(e,t){const i=this.channelList[this.activeChannel],r=t.region.pan+i.panOffset;t.playingChannel=this.activeChannel,t.mixVolume=i.mixVolume,t.noteGainDb+=i.gainDb,t.updatePitchRatio(i,e.outSampleRate),r<=-.5?(t.panFactorLeft=1,t.panFactorRight=0):r>=.5?(t.panFactorLeft=0,t.panFactorRight=1):(t.panFactorLeft=Math.sqrt(.5-r),t.panFactorRight=Math.sqrt(.5+r))}}var tr;(function(s){s[s.None=0]="None",s[s.Continuous=1]="Continuous",s[s.Sustain=2]="Sustain"})(tr||(tr={}));var un;(function(s){s[s.StereoInterleaved=0]="StereoInterleaved",s[s.StereoUnweaved=1]="StereoUnweaved",s[s.Mono=2]="Mono"})(un||(un={}));class uv{constructor(){this.name="",this.presetNumber=0,this.bank=0,this.regions=null,this.fontSamples=null}}class it{static timecents2Secs(e){return Math.pow(2,e/1200)}static decibelsToGain(e){return e>-100?Math.pow(10,e*.05):0}static gainToDecibels(e){return e<=1e-5?-100:20*Math.log10(e)}static cents2Hertz(e){return 8.176*Math.pow(2,e/1200)}static clamp(e,t,i){return e<=t?t:e>=i?i:e}}class Ja{constructor(e){this.delay=0,this.attack=0,this.hold=0,this.decay=0,this.sustain=0,this.release=0,this.keynumToHold=0,this.keynumToDecay=0,e&&(this.delay=e.delay,this.attack=e.attack,this.hold=e.hold,this.decay=e.decay,this.sustain=e.sustain,this.release=e.release,this.keynumToHold=e.keynumToHold,this.keynumToDecay=e.keynumToDecay)}clear(){this.delay=0,this.attack=0,this.hold=0,this.decay=0,this.sustain=0,this.release=0,this.keynumToHold=0,this.keynumToDecay=0}envToSecs(e){this.delay=this.delay<-11950?0:it.timecents2Secs(this.delay),this.attack=this.attack<-11950?0:it.timecents2Secs(this.attack),this.release=this.release<-11950?0:it.timecents2Secs(this.release),this.keynumToHold===0&&(this.hold=this.hold<-11950?0:it.timecents2Secs(this.hold)),this.keynumToDecay===0&&(this.decay=this.decay<-11950?0:it.timecents2Secs(this.decay)),this.sustain<0?this.sustain=0:e?this.sustain=it.decibelsToGain(-this.sustain/10):this.sustain=1-this.sustain/1e3}}var me;(function(s){s[s.StartAddrsOffset=0]="StartAddrsOffset",s[s.EndAddrsOffset=1]="EndAddrsOffset",s[s.StartloopAddrsOffset=2]="StartloopAddrsOffset",s[s.EndloopAddrsOffset=3]="EndloopAddrsOffset",s[s.StartAddrsCoarseOffset=4]="StartAddrsCoarseOffset",s[s.ModLfoToPitch=5]="ModLfoToPitch",s[s.VibLfoToPitch=6]="VibLfoToPitch",s[s.ModEnvToPitch=7]="ModEnvToPitch",s[s.InitialFilterFc=8]="InitialFilterFc",s[s.InitialFilterQ=9]="InitialFilterQ",s[s.ModLfoToFilterFc=10]="ModLfoToFilterFc",s[s.ModEnvToFilterFc=11]="ModEnvToFilterFc",s[s.EndAddrsCoarseOffset=12]="EndAddrsCoarseOffset",s[s.ModLfoToVolume=13]="ModLfoToVolume",s[s.Unused1=14]="Unused1",s[s.ChorusEffectsSend=15]="ChorusEffectsSend",s[s.ReverbEffectsSend=16]="ReverbEffectsSend",s[s.Pan=17]="Pan",s[s.Unused2=18]="Unused2",s[s.Unused3=19]="Unused3",s[s.Unused4=20]="Unused4",s[s.DelayModLFO=21]="DelayModLFO",s[s.FreqModLFO=22]="FreqModLFO",s[s.DelayVibLFO=23]="DelayVibLFO",s[s.FreqVibLFO=24]="FreqVibLFO",s[s.DelayModEnv=25]="DelayModEnv",s[s.AttackModEnv=26]="AttackModEnv",s[s.HoldModEnv=27]="HoldModEnv",s[s.DecayModEnv=28]="DecayModEnv",s[s.SustainModEnv=29]="SustainModEnv",s[s.ReleaseModEnv=30]="ReleaseModEnv",s[s.KeynumToModEnvHold=31]="KeynumToModEnvHold",s[s.KeynumToModEnvDecay=32]="KeynumToModEnvDecay",s[s.DelayVolEnv=33]="DelayVolEnv",s[s.AttackVolEnv=34]="AttackVolEnv",s[s.HoldVolEnv=35]="HoldVolEnv",s[s.DecayVolEnv=36]="DecayVolEnv",s[s.SustainVolEnv=37]="SustainVolEnv",s[s.ReleaseVolEnv=38]="ReleaseVolEnv",s[s.KeynumToVolEnvHold=39]="KeynumToVolEnvHold",s[s.KeynumToVolEnvDecay=40]="KeynumToVolEnvDecay",s[s.Instrument=41]="Instrument",s[s.Reserved1=42]="Reserved1",s[s.KeyRange=43]="KeyRange",s[s.VelRange=44]="VelRange",s[s.StartloopAddrsCoarseOffset=45]="StartloopAddrsCoarseOffset",s[s.Keynum=46]="Keynum",s[s.Velocity=47]="Velocity",s[s.InitialAttenuation=48]="InitialAttenuation",s[s.Reserved2=49]="Reserved2",s[s.EndloopAddrsCoarseOffset=50]="EndloopAddrsCoarseOffset",s[s.CoarseTune=51]="CoarseTune",s[s.FineTune=52]="FineTune",s[s.SampleID=53]="SampleID",s[s.SampleModes=54]="SampleModes",s[s.Reserved3=55]="Reserved3",s[s.ScaleTuning=56]="ScaleTuning",s[s.ExclusiveClass=57]="ExclusiveClass",s[s.OverridingRootKey=58]="OverridingRootKey",s[s.Unused5=59]="Unused5",s[s.EndOper=60]="EndOper"})(me||(me={}));class zn{constructor(e){this.loopMode=tr.None,this.sampleRate=0,this.loKey=0,this.hiKey=0,this.loVel=0,this.hiVel=0,this.group=0,this.offset=0,this.end=0,this.loopStart=0,this.loopEnd=0,this.transpose=0,this.tune=0,this.pitchKeyCenter=0,this.pitchKeyTrack=0,this.attenuation=0,this.pan=0,this.ampEnv=new Ja,this.modEnv=new Ja,this.initialFilterQ=0,this.initialFilterFc=0,this.modEnvToPitch=0,this.modEnvToFilterFc=0,this.modLfoToFilterFc=0,this.modLfoToVolume=0,this.delayModLFO=0,this.freqModLFO=0,this.modLfoToPitch=0,this.delayVibLFO=0,this.freqVibLFO=0,this.vibLfoToPitch=0,e&&(this.loopMode=e.loopMode,this.sampleRate=e.sampleRate,this.loKey=e.loKey,this.hiKey=e.hiKey,this.loVel=e.loVel,this.hiVel=e.hiVel,this.group=e.group,this.offset=e.offset,this.end=e.end,this.loopStart=e.loopStart,this.loopEnd=e.loopEnd,this.transpose=e.transpose,this.tune=e.tune,this.pitchKeyCenter=e.pitchKeyCenter,this.pitchKeyTrack=e.pitchKeyTrack,this.attenuation=e.attenuation,this.pan=e.pan,this.ampEnv=new Ja(e.ampEnv),this.modEnv=new Ja(e.modEnv),this.initialFilterQ=e.initialFilterQ,this.initialFilterFc=e.initialFilterFc,this.modEnvToPitch=e.modEnvToPitch,this.modEnvToFilterFc=e.modEnvToFilterFc,this.modLfoToFilterFc=e.modLfoToFilterFc,this.modLfoToVolume=e.modLfoToVolume,this.delayModLFO=e.delayModLFO,this.freqModLFO=e.freqModLFO,this.modLfoToPitch=e.modLfoToPitch,this.delayVibLFO=e.delayVibLFO,this.freqVibLFO=e.freqVibLFO,this.vibLfoToPitch=e.vibLfoToPitch)}clear(e){this.loopMode=tr.None,this.sampleRate=0,this.loKey=0,this.hiKey=0,this.loVel=0,this.hiVel=0,this.group=0,this.offset=0,this.end=0,this.loopStart=0,this.loopEnd=0,this.transpose=0,this.tune=0,this.pitchKeyCenter=0,this.pitchKeyTrack=0,this.attenuation=0,this.pan=0,this.ampEnv.clear(),this.modEnv.clear(),this.initialFilterQ=0,this.initialFilterFc=0,this.modEnvToPitch=0,this.modEnvToFilterFc=0,this.modLfoToFilterFc=0,this.modLfoToVolume=0,this.delayModLFO=0,this.freqModLFO=0,this.modLfoToPitch=0,this.delayVibLFO=0,this.freqVibLFO=0,this.vibLfoToPitch=0,this.hiKey=127,this.hiVel=127,this.pitchKeyCenter=60,!e&&(this.pitchKeyTrack=100,this.pitchKeyCenter=-1,this.ampEnv.delay=-12e3,this.ampEnv.attack=-12e3,this.ampEnv.hold=-12e3,this.ampEnv.decay=-12e3,this.ampEnv.release=-12e3,this.modEnv.delay=-12e3,this.modEnv.attack=-12e3,this.modEnv.hold=-12e3,this.modEnv.decay=-12e3,this.modEnv.release=-12e3,this.initialFilterFc=13500,this.delayModLFO=-12e3,this.delayVibLFO=-12e3)}operator(e,t){switch(e){case me.StartAddrsOffset:this.offset+=ue.int16ToUint32(t.shortAmount);break;case me.EndAddrsOffset:this.end+=ue.int16ToUint32(t.shortAmount);break;case me.StartloopAddrsOffset:this.loopStart+=ue.int16ToUint32(t.shortAmount);break;case me.EndloopAddrsOffset:this.loopEnd+=ue.int16ToUint32(t.shortAmount);break;case me.StartAddrsCoarseOffset:this.offset+=ue.int16ToUint32(t.shortAmount)*32768;break;case me.ModLfoToPitch:this.modLfoToPitch=t.shortAmount;break;case me.VibLfoToPitch:this.vibLfoToPitch=t.shortAmount;break;case me.ModEnvToPitch:this.modEnvToPitch=t.shortAmount;break;case me.InitialFilterFc:this.initialFilterFc=t.shortAmount;break;case me.InitialFilterQ:this.initialFilterQ=t.shortAmount;break;case me.ModLfoToFilterFc:this.modLfoToFilterFc=t.shortAmount;break;case me.ModEnvToFilterFc:this.modEnvToFilterFc=t.shortAmount;break;case me.EndAddrsCoarseOffset:this.end+=ue.int16ToUint32(t.shortAmount)*32768;break;case me.ModLfoToVolume:this.modLfoToVolume=t.shortAmount;break;case me.Pan:this.pan=t.shortAmount/1e3;break;case me.DelayModLFO:this.delayModLFO=t.shortAmount;break;case me.FreqModLFO:this.freqModLFO=t.shortAmount;break;case me.DelayVibLFO:this.delayVibLFO=t.shortAmount;break;case me.FreqVibLFO:this.freqVibLFO=t.shortAmount;break;case me.DelayModEnv:this.modEnv.delay=t.shortAmount;break;case me.AttackModEnv:this.modEnv.attack=t.shortAmount;break;case me.HoldModEnv:this.modEnv.hold=t.shortAmount;break;case me.DecayModEnv:this.modEnv.decay=t.shortAmount;break;case me.SustainModEnv:this.modEnv.sustain=t.shortAmount;break;case me.ReleaseModEnv:this.modEnv.release=t.shortAmount;break;case me.KeynumToModEnvHold:this.modEnv.keynumToHold=t.shortAmount;break;case me.KeynumToModEnvDecay:this.modEnv.keynumToDecay=t.shortAmount;break;case me.DelayVolEnv:this.ampEnv.delay=t.shortAmount;break;case me.AttackVolEnv:this.ampEnv.attack=t.shortAmount;break;case me.HoldVolEnv:this.ampEnv.hold=t.shortAmount;break;case me.DecayVolEnv:this.ampEnv.decay=t.shortAmount;break;case me.SustainVolEnv:this.ampEnv.sustain=t.shortAmount;break;case me.ReleaseVolEnv:this.ampEnv.release=t.shortAmount;break;case me.KeynumToVolEnvHold:this.ampEnv.keynumToHold=t.shortAmount;break;case me.KeynumToVolEnvDecay:this.ampEnv.keynumToDecay=t.shortAmount;break;case me.KeyRange:this.loKey=t.lowByteAmount,this.hiKey=t.highByteAmount;break;case me.VelRange:this.loVel=t.lowByteAmount,this.hiVel=t.highByteAmount;break;case me.StartloopAddrsCoarseOffset:this.loopStart+=ue.int16ToUint32(t.shortAmount)*32768;break;case me.InitialAttenuation:this.attenuation+=t.shortAmount*.1;break;case me.EndloopAddrsCoarseOffset:this.loopEnd+=ue.int16ToUint32(t.shortAmount)*32768;break;case me.CoarseTune:this.transpose+=t.shortAmount;break;case me.FineTune:this.tune+=t.shortAmount;break;case me.SampleModes:this.loopMode=(t.wordAmount&3)===3?tr.Sustain:(t.wordAmount&3)===1?tr.Continuous:tr.None;break;case me.ScaleTuning:this.pitchKeyTrack=t.shortAmount;break;case me.ExclusiveClass:this.group=t.wordAmount;break;case me.OverridingRootKey:this.pitchKeyCenter=t.shortAmount;break}}}var Ae;(function(s){s[s.None=0]="None",s[s.Delay=1]="Delay",s[s.Attack=2]="Attack",s[s.Hold=3]="Hold",s[s.Decay=4]="Decay",s[s.Sustain=5]="Sustain",s[s.Release=6]="Release",s[s.Done=7]="Done"})(Ae||(Ae={}));class Vo{constructor(){this.level=0,this.slope=0,this.samplesUntilNextSegment=0,this.segment=Ae.None,this.midiVelocity=0,this.parameters=null,this.segmentIsExponential=!1,this.isAmpEnv=!1}nextSegment(e,t){if(this.parameters)for(;;)switch(e){case Ae.None:if(this.samplesUntilNextSegment=this.parameters.delay*t|0,this.samplesUntilNextSegment>0){this.segment=Ae.Delay,this.segmentIsExponential=!1,this.level=0,this.slope=0;return}e=Ae.Delay;break;case Ae.Delay:if(this.samplesUntilNextSegment=this.parameters.attack*t|0,this.samplesUntilNextSegment>0){this.isAmpEnv||(this.samplesUntilNextSegment=this.parameters.attack*((145-this.midiVelocity)/144)*t|0),this.segment=Ae.Attack,this.segmentIsExponential=!1,this.level=0,this.slope=1/this.samplesUntilNextSegment;return}e=Ae.Attack;break;case Ae.Attack:if(this.samplesUntilNextSegment=this.parameters.hold*t|0,this.samplesUntilNextSegment>0){this.segment=Ae.Hold,this.segmentIsExponential=!1,this.level=1,this.slope=0;return}e=Ae.Hold;break;case Ae.Hold:if(this.samplesUntilNextSegment=this.parameters.decay*t|0,this.samplesUntilNextSegment>0){if(this.segment=Ae.Decay,this.level=1,this.isAmpEnv){let i=-9.226/this.samplesUntilNextSegment;this.slope=Math.exp(i),this.segmentIsExponential=!0,this.parameters.sustain>0&&(this.samplesUntilNextSegment=Math.log(this.parameters.sustain)/i|0)}else this.slope=-1/this.samplesUntilNextSegment,this.samplesUntilNextSegment=this.parameters.decay*(1-this.parameters.sustain)*t|0,this.segmentIsExponential=!1;return}e=Ae.Decay;break;case Ae.Decay:this.segment=Ae.Sustain,this.level=this.parameters.sustain,this.slope=0,this.samplesUntilNextSegment=2147483647,this.segmentIsExponential=!1;return;case Ae.Sustain:if(this.segment=Ae.Release,this.samplesUntilNextSegment=(this.parameters.release<=0?Vo.FastReleaseTime:this.parameters.release)*t|0,this.isAmpEnv){let i=-9.226/this.samplesUntilNextSegment;this.slope=Math.exp(i),this.segmentIsExponential=!0}else this.slope=-this.level/this.samplesUntilNextSegment,this.segmentIsExponential=!1;return;default:this.segment=Ae.Done,this.segmentIsExponential=!1,this.level=0,this.slope=0,this.samplesUntilNextSegment=134217727;return}}setup(e,t,i,r,n){this.parameters=new Ja(e),this.parameters.keynumToHold>0&&(this.parameters.hold+=this.parameters.keynumToHold*(60-t),this.parameters.hold=this.parameters.hold<-1e4?0:it.timecents2Secs(this.parameters.hold)),this.parameters.keynumToDecay>0&&(this.parameters.decay+=this.parameters.keynumToDecay*(60-t),this.parameters.decay=this.parameters.decay<-1e4?0:it.timecents2Secs(this.parameters.decay)),this.midiVelocity=i|0,this.isAmpEnv=r,this.nextSegment(Ae.None,n)}process(e,t){this.slope>0&&(this.segmentIsExponential?this.level*=Math.pow(this.slope,e):this.level+=this.slope*e),this.samplesUntilNextSegment-=e,this.samplesUntilNextSegment<=0&&this.nextSegment(this.segment,t)}}Vo.FastReleaseTime=.01;class bm{constructor(){this.samplesUntil=0,this.level=0,this.delta=0}setup(e,t,i){this.samplesUntil=e*i|0,this.delta=4*it.cents2Hertz(t)/i,this.level=0}process(e){if(this.samplesUntil>e){this.samplesUntil-=e;return}this.level+=this.delta*e,this.level>1?(this.delta=-this.delta,this.level=2-this.level):this.level<-1&&(this.delta=-this.delta,this.level=-2-this.level)}}class Sm{constructor(e){this.qInv=0,this.a0=0,this.a1=0,this.b1=0,this.b2=0,this.z1=0,this.z2=0,this.active=!1,e&&(this.qInv=e.qInv,this.a0=e.a0,this.a1=e.a1,this.b1=e.b1,this.b2=e.b2,this.z1=e.z1,this.z2=e.z2,this.active=e.active)}setup(e){let t=Math.tan(Math.PI*e),i=t*t,r=1/(1+t*this.qInv+i);this.a0=i*r,this.a1=2*this.a0,this.b1=2*(i-1)*r,this.b2=(1-t*this.qInv+i)*r}process(e){let t=e*this.a0+this.z1;return this.z1=e*this.a1+this.z2-this.b1*t,this.z2=e*this.a0-this.b2*t,t}}class Ho{constructor(){this.playingPreset=0,this.playingKey=0,this.playingChannel=0,this.region=null,this.pitchInputTimecents=0,this.pitchOutputFactor=0,this.sourceSamplePosition=0,this.noteGainDb=0,this.panFactorLeft=0,this.panFactorRight=0,this.playIndex=0,this.loopStart=0,this.loopEnd=0,this.ampEnv=new Vo,this.modEnv=new Vo,this.lowPass=new Sm,this.modLfo=new bm,this.vibLfo=new bm,this.mixVolume=0,this.mute=!1}updatePitchRatio(e,t){let i=e.pitchWheel;e.perNotePitchWheel.has(this.playingKey)&&(i+=e.perNotePitchWheel.get(this.playingKey)-8192);const r=i===8192?e.tuning:i/16383*e.pitchRange*2-e.pitchRange+e.tuning;this.calcPitchRatio(r,t)}calcPitchRatio(e,t){if(!this.region)return;const i=this.playingKey+this.region.transpose+this.region.tune/100;let r=this.region.pitchKeyCenter+(i-this.region.pitchKeyCenter)*(this.region.pitchKeyTrack/100);e!==0&&(r+=e),this.pitchInputTimecents=r*100,this.pitchOutputFactor=this.region.sampleRate/(it.timecents2Secs(this.region.pitchKeyCenter*100)*t)}end(e){this.region&&(this.ampEnv.nextSegment(Ae.Sustain,e),this.modEnv.nextSegment(Ae.Sustain,e),this.region.loopMode===tr.Sustain&&(this.loopEnd=this.loopStart))}endQuick(e){this.ampEnv.parameters.release=0,this.ampEnv.nextSegment(Ae.Sustain,e),this.modEnv.parameters.release=0,this.modEnv.nextSegment(Ae.Sustain,e)}render(e,t,i,r,n){if(!this.region)return;let a=this.region,l=e.presets[this.playingPreset].fontSamples,h=0,u=e.outputMode===un.StereoUnweaved?r:-1,c=a.modEnvToPitch!==0||a.modEnvToFilterFc!==0,d=this.modLfo.delta>0&&(a.modLfoToPitch!==0||a.modLfoToFilterFc!==0||a.modLfoToVolume!==0),p=this.vibLfo.delta>0&&a.vibLfoToPitch!==0,g=this.loopStart<this.loopEnd,w=this.loopStart,S=this.loopEnd,b=a.end,m=S+1,y=this.sourceSamplePosition,B=new Sm(this.lowPass),_=a.modLfoToFilterFc!==0||a.modEnvToFilterFc!==0,P=0,N=0,D=0,Q=0,J=a.modLfoToPitch!==0||a.modEnvToPitch!==0||a.vibLfoToPitch!==0,ge=0,qt=0,Ti=0,Kt=0,gi=a.modLfoToVolume!==0,oi=0,mi=0;for(_?(P=e.outSampleRate,N=a.initialFilterFc,D=a.modLfoToFilterFc,Q=a.modEnvToFilterFc):(P=0,N=0,D=0,Q=0),J?(ge=0,qt=a.modLfoToPitch,Ti=a.vibLfoToPitch,Kt=a.modEnvToPitch):(ge=it.timecents2Secs(this.pitchInputTimecents)*this.pitchOutputFactor,qt=0,Ti=0,Kt=0),gi?mi=a.modLfoToVolume*.1:(oi=it.decibelsToGain(this.noteGainDb),mi=0);r>0;){let W,se,pe=0,Me=r>Ho.RenderEffectSampleBlock?Ho.RenderEffectSampleBlock:r;if(r-=Me,_){let ke=N+this.modLfo.level*D+this.modEnv.level*Q;B.active=ke<=13500,B.active&&B.setup(it.cents2Hertz(ke)/P)}switch(J&&(ge=it.timecents2Secs(this.pitchInputTimecents+(this.modLfo.level*qt+this.vibLfo.level*Ti+this.modEnv.level*Kt))*this.pitchOutputFactor),gi&&(oi=it.decibelsToGain(this.noteGainDb+this.modLfo.level*mi)),W=oi*this.ampEnv.level,n?W=0:W*=this.mixVolume,this.ampEnv.process(Me,e.outSampleRate),c&&this.modEnv.process(Me,e.outSampleRate),d&&this.modLfo.process(Me),p&&this.vibLfo.process(Me),e.outputMode){case un.StereoInterleaved:for(se=W*this.panFactorLeft,pe=W*this.panFactorRight;Me-- >0&&y<b;){let ke=y|0,Ms=ke>=S&&g?w:ke+1,li=y-ke,jt=l[ke]*(1-li)+l[Ms]*li;B.active&&(jt=B.process(jt)),t[i+h]+=jt*se,h++,t[i+h]+=jt*pe,h++,y+=ge,y>=m&&g&&(y-=S-w+1)}break;case un.StereoUnweaved:for(se=W*this.panFactorLeft,pe=W*this.panFactorRight;Me-- >0&&y<b;){let ke=y|0,Ms=ke>=S&&g?w:ke+1,li=y-ke,jt=l[ke]*(1-li)+l[Ms]*li;B.active&&(jt=B.process(jt)),t[i+h]+=jt*se,h++,t[i+u]+=jt*pe,u++,y+=ge,y>=m&&g&&(y-=S-w+1)}break;case un.Mono:for(;Me-- >0&&y<b;){let ke=y|0,Ms=ke>=S&&g?w:ke+1,li=y-ke,jt=l[ke]*(1-li)+l[Ms]*li;B.active&&(jt=B.process(jt)),t[i+h]=jt*W,h++,y+=ge,y>=m&&g&&(y-=S-w+1)}break}if(y>=b||this.ampEnv.segment===Ae.Done){this.kill();return}}this.sourceSamplePosition=y,(B.active||_)&&(this.lowPass=B)}kill(){this.playingPreset=-1}}Ho.RenderEffectSampleBlock=le.MicroBufferSize;class Vd{constructor(){this._items=[],this._position=0,this.isEmpty=!0}clear(){this._items=[],this._position=0,this.isEmpty=!0}enqueue(e){this.isEmpty=!1,this._items.push(e)}peek(){return this._items[this._position]}dequeue(){const e=this._items[this._position];return this._position++,this._position>=this._items.length/2&&(this._items=this._items.slice(this._position),this._position=0),this.isEmpty=this._items.length==0,e}toArray(){const e=this._items.slice(this._position);return e.reverse(),e}}var Le;(function(s){s[s.BankSelectCoarse=0]="BankSelectCoarse",s[s.ModulationCoarse=1]="ModulationCoarse",s[s.DataEntryCoarse=6]="DataEntryCoarse",s[s.VolumeCoarse=7]="VolumeCoarse",s[s.PanCoarse=10]="PanCoarse",s[s.ExpressionControllerCoarse=11]="ExpressionControllerCoarse",s[s.BankSelectFine=32]="BankSelectFine",s[s.ModulationFine=33]="ModulationFine",s[s.DataEntryFine=38]="DataEntryFine",s[s.VolumeFine=39]="VolumeFine",s[s.PanFine=42]="PanFine",s[s.ExpressionControllerFine=43]="ExpressionControllerFine",s[s.HoldPedal=64]="HoldPedal",s[s.LegatoPedal=68]="LegatoPedal",s[s.NonRegisteredParameterFine=98]="NonRegisteredParameterFine",s[s.NonRegisteredParameterCourse=99]="NonRegisteredParameterCourse",s[s.RegisteredParameterFine=100]="RegisteredParameterFine",s[s.RegisteredParameterCourse=101]="RegisteredParameterCourse",s[s.AllSoundOff=120]="AllSoundOff",s[s.ResetControllers=121]="ResetControllers",s[s.AllNotesOff=123]="AllNotesOff"})(Le||(Le={}));class cv{constructor(e){this._midiEventQueue=new Vd,this._mutedChannels=new Map,this._soloChannels=new Map,this._isAnySolo=!1,this._transpositionPitches=new Map,this._liveTranspositionPitches=new Map,this.currentTempo=0,this.timeSignatureNumerator=0,this.timeSignatureDenominator=0,this.presets=null,this._voices=[],this._channels=null,this._voicePlayIndex=0,this.outputMode=un.StereoInterleaved,this.outSampleRate=0,this.globalGainDb=0,this.outSampleRate=e}synthesize(e,t,i){return this.fillWorkingBuffer(e,t,i)}synthesizeSilent(e){this.fillWorkingBuffer(null,0,e)}channelGetMixVolume(e){return this._channels&&e<this._channels.channelList.length?this._channels.channelList[e].mixVolume:1}channelSetMixVolume(e,t){let i=this.channelInit(e);for(let r of this._voices)r.playingChannel===e&&r.playingPreset!==-1&&(r.mixVolume=t);i.mixVolume=t}channelSetMute(e,t){t?this._mutedChannels.set(e,!0):this._mutedChannels.delete(e)}channelSetSolo(e,t){t?this._soloChannels.set(e,!0):this._soloChannels.delete(e),this._isAnySolo=this._soloChannels.size>0}resetChannelStates(){this._mutedChannels=new Map,this._soloChannels=new Map,this._liveTranspositionPitches=new Map,this.applyTranspositionPitches(new Map),this._isAnySolo=!1}setChannelTranspositionPitch(e,t){let i=0;this._liveTranspositionPitches.has(e)&&(i=this._liveTranspositionPitches.get(e)),t===0?this._liveTranspositionPitches.delete(e):this._liveTranspositionPitches.set(e,t);for(const r of this._voices)if(r.playingChannel===e&&r.playingChannel!==9){let n=0;n-=i,n+=t,r.playingKey+=n,this._channels&&r.updatePitchRatio(this._channels.channelList[r.playingChannel],this.outSampleRate)}}applyTranspositionPitches(e){const t=this._transpositionPitches;for(const i of this._voices)if(i.playingChannel>=0&&i.playingChannel!==9){let r=0;t.has(i.playingChannel)&&(r-=t.get(i.playingChannel)),e.has(i.playingChannel)&&(r+=e.get(i.playingChannel)),i.playingKey+=r,this._channels&&i.updatePitchRatio(this._channels.channelList[i.playingChannel],this.outSampleRate)}this._transpositionPitches=e}dispatchEvent(e){this._midiEventQueue.enqueue(e)}fillWorkingBuffer(e,t,i){const r=this._isAnySolo,n=[];for(;!this._midiEventQueue.isEmpty;){let a=this._midiEventQueue.dequeue();a.isMetronome&&this.metronomeVolume>0?(this.channelNoteOff(le.MetronomeChannel,33),this.channelNoteOn(le.MetronomeChannel,33,95/127)):a.event&&this.processMidiMessage(a.event),n.push(a)}for(const a of this._voices)if(a.playingPreset!==-1){const o=a.playingChannel,l=this._mutedChannels.has(o)||r&&o!=le.MetronomeChannel&&!this._soloChannels.has(o);e?a.render(this,e,t,i,l):a.kill()}return n}processMidiMessage(e){switch(C.debug("MIdi","Processing Midi message "+ye[e.type]+"/"+e.tick),e.type){case ye.TimeSignature:const i=e;this.timeSignatureNumerator=i.numerator,this.timeSignatureDenominator=Math.pow(2,i.denominatorIndex);break;case ye.NoteOn:const r=e;this.channelNoteOn(r.channel,r.noteKey,r.noteVelocity/127);break;case ye.NoteOff:const n=e;this.channelNoteOff(n.channel,n.noteKey);break;case ye.ControlChange:const a=e;this.channelMidiControl(a.channel,a.controller,a.value);break;case ye.ProgramChange:const o=e;this.channelSetPresetNumber(o.channel,o.program,o.channel===9);break;case ye.TempoChange:const l=e;this.currentTempo=6e7/l.microSecondsPerQuarterNote;break;case ye.PitchBend:const h=e;this.channelSetPitchWheel(h.channel,h.value);break;case ye.PerNotePitchBend:const u=e;let c=u.value;c=c*le.MaxPitchWheel/le.MaxPitchWheel20,this.channelSetPerNotePitchWheel(u.channel,u.noteKey,c);break}}get metronomeVolume(){return this.channelGetMixVolume(le.MetronomeChannel)}set metronomeVolume(e){this.setupMetronomeChannel(e)}setupMetronomeChannel(e){this.channelSetMixVolume(le.MetronomeChannel,e),e>0&&(this.channelSetVolume(le.MetronomeChannel,1),this.channelSetPresetNumber(le.MetronomeChannel,0,!0))}get masterVolume(){return it.decibelsToGain(this.globalGainDb)}set masterVolume(e){var t=it.gainToDecibels(e);const i=t-this.globalGainDb;if(i!==0){for(const r of this._voices)r.playingPreset!==-1&&(r.noteGainDb+=i);this.globalGainDb=t}}resetSoft(){for(const e of this._voices)e.playingPreset!==-1&&(e.ampEnv.segment<Ae.Release||e.ampEnv.parameters.release!==0)&&e.endQuick(this.outSampleRate);if(this._channels)for(const e of this._channels.channelList)e.presetIndex=0,e.bank=0,e.pitchWheel=8192,e.midiPan=8192,e.perNotePitchWheel.clear(),e.midiVolume=16383,e.midiExpression=16383,e.midiRpn=65535,e.midiData=0,e.panOffset=0,e.gainDb=0,e.pitchRange=2,e.tuning=0}get presetCount(){var e;return((e=this.presets)==null?void 0:e.length)??0}reset(){for(let e of this._voices)e.playingPreset!==-1&&(e.ampEnv.segment<Ae.Release||e.ampEnv.parameters.release!==0)&&e.endQuick(this.outSampleRate);this._channels=null}setOutput(e,t,i){this.outputMode=e,this.outSampleRate=t>=1?t:44100,this.globalGainDb=i}noteOn(e,t,i){if(!this.presets)return;const r=i*127|0;if(e<0||e>=this.presets.length)return;if(i<=0){this.noteOff(e,t);return}const n=this._voicePlayIndex++;for(const a of this.presets[e].regions){if(t<a.loKey||t>a.hiKey||r<a.loVel||r>a.hiVel)continue;let o=null;if(a.group!==0)for(const u of this._voices)u.playingPreset===e&&u.region.group===a.group?u.endQuick(this.outSampleRate):u.playingPreset===-1&&!o&&(o=u);else for(let u of this._voices)u.playingPreset===-1&&(o=u);if(!o){for(let u=0;u<4;u++){const c=new Ho;c.playingPreset=-1,this._voices.push(c)}o=this._voices[this._voices.length-4]}o.region=a,o.playingPreset=e,o.playingKey=t,o.playIndex=n,o.noteGainDb=this.globalGainDb-a.attenuation-it.gainToDecibels(1/i),this._channels?this._channels.setupVoice(this,o):(o.calcPitchRatio(0,this.outSampleRate),o.panFactorLeft=Math.sqrt(.5-a.pan),o.panFactorRight=Math.sqrt(.5+a.pan)),o.sourceSamplePosition=a.offset;const l=a.loopMode!==tr.None&&a.loopStart<a.loopEnd;o.loopStart=l?a.loopStart:0,o.loopEnd=l?a.loopEnd:0,o.ampEnv.setup(a.ampEnv,t,r,!0,this.outSampleRate),o.modEnv.setup(a.modEnv,t,r,!1,this.outSampleRate);const h=a.initialFilterQ/10;o.lowPass.qInv=1/Math.pow(10,h/20),o.lowPass.z1=0,o.lowPass.z2=0,o.lowPass.active=a.initialFilterFc<=13500,o.lowPass.active&&o.lowPass.setup(it.cents2Hertz(a.initialFilterFc)/this.outSampleRate),o.modLfo.setup(a.delayModLFO,a.freqModLFO,this.outSampleRate),o.vibLfo.setup(a.delayVibLFO,a.freqVibLFO,this.outSampleRate)}}bankNoteOn(e,t,i,r){let n=this.getPresetIndex(e,t);return n===-1?!1:(this.noteOn(n,i,r),!0)}noteOff(e,t){let i=null,r=null,n=[];for(let a of this._voices)a.playingPreset!==e||a.playingKey!==t||a.ampEnv.segment>=Ae.Release||(!i||a.playIndex<i.playIndex?(i=a,r=a,n.push(a)):a.playIndex===i.playIndex&&(r=a,n.push(a)));if(i)for(const a of n)a!==i&&a!==r&&(a.playIndex!==i.playIndex||a.playingPreset!==e||a.playingKey!==t||a.ampEnv.segment>=Ae.Release)||a.end(this.outSampleRate)}bankNoteOff(e,t,i){const r=this.getPresetIndex(e,t);return r===-1?!1:(this.noteOff(r,i),!0)}noteOffAll(e){for(const t of this._voices)t.playingPreset!==-1&&(e?t.endQuick(this.outSampleRate):t.ampEnv.segment<Ae.Release&&t.end(this.outSampleRate))}get activeVoiceCount(){let e=0;for(const t of this._voices)t.playingPreset!==-1&&e++;return e}channelInit(e){if(this._channels&&e<this._channels.channelList.length)return this._channels.channelList[e];this._channels||(this._channels=new hv);for(let t=this._channels.channelList.length;t<=e;t++){let i=new lv;i.presetIndex=0,i.bank=0,i.pitchWheel=8192,i.midiPan=8192,i.midiVolume=16383,i.midiExpression=16383,i.midiRpn=65535,i.midiData=0,i.panOffset=0,i.gainDb=0,i.pitchRange=2,i.tuning=0,i.mixVolume=1,this._channels.channelList.push(i)}return this._channels.channelList[e]}getPresetIndex(e,t){if(!this.presets)return-1;for(let i=this.presets.length-1;i>=0;i--){let r=this.presets[i];if(r.presetNumber===t&&r.bank===e)return i}return-1}getPresetName(e){return this.presets?e<0||e>=this.presets.length?null:this.presets[e].name:null}bankGetPresetName(e,t){return this.getPresetName(this.getPresetIndex(e,t))}channelNoteOn(e,t,i){!this._channels||e>this._channels.channelList.length||(this._transpositionPitches.has(e)&&(t+=this._transpositionPitches.get(e)),this._liveTranspositionPitches.has(e)&&(t+=this._liveTranspositionPitches.get(e)),this._channels.activeChannel=e,this.noteOn(this._channels.channelList[e].presetIndex,t,i))}channelNoteOff(e,t){this._transpositionPitches.has(e)&&(t+=this._transpositionPitches.get(e)),this._liveTranspositionPitches.has(e)&&(t+=this._liveTranspositionPitches.get(e));const i=[];let r=null,n=null;for(const o of this._voices)o.playingPreset===-1||o.playingChannel!==e||o.playingKey!==t||o.ampEnv.segment>=Ae.Release||(!r||o.playIndex<r.playIndex?(r=o,n=o,i.push(o)):o.playIndex===r.playIndex&&(n=o,i.push(o)));if(this.channelInit(e).perNotePitchWheel.delete(t),!!r)for(const o of i)o!==r&&o!==n&&(o.playIndex!==r.playIndex||o.playingPreset===-1||o.playingChannel!==e||o.playingKey!==t||o.ampEnv.segment>=Ae.Release)||o.end(this.outSampleRate)}channelNoteOffAll(e){this.channelInit(e).perNotePitchWheel.clear();for(const i of this._voices)i.playingPreset!==-1&&i.playingChannel===e&&i.ampEnv.segment<Ae.Release&&i.end(this.outSampleRate)}channelSoundsOffAll(e){this.channelInit(e).perNotePitchWheel.clear();for(let i of this._voices)i.playingPreset!==-1&&i.playingChannel===e&&(i.ampEnv.segment<Ae.Release||i.ampEnv.parameters.release===0)&&i.endQuick(this.outSampleRate)}channelSetPresetIndex(e,t){this.channelInit(e).presetIndex=ue.int32ToUint16(t)}channelSetPresetNumber(e,t,i=!1){const r=this.channelInit(e);let n=0;return i?(n=this.getPresetIndex(128|r.bank&32767,t),n===-1&&(n=this.getPresetIndex(128,t)),n===-1&&(n=this.getPresetIndex(128,0)),n===-1&&(n=this.getPresetIndex(r.bank&2047,t))):n=this.getPresetIndex(r.bank&2047,t),r.presetIndex=n,n!==-1}channelSetBank(e,t){this.channelInit(e).bank=ue.int32ToUint16(t)}channelSetBankPreset(e,t,i){const r=this.channelInit(e),n=this.getPresetIndex(t,i);return n===-1?!1:(r.presetIndex=ue.int32ToUint16(n),r.bank=ue.int32ToUint16(t),!0)}channelSetPan(e,t){for(const i of this._voices)if(i.playingChannel===e&&i.playingPreset!==-1){let r=i.region.pan+t-.5;r<=-.5?(i.panFactorLeft=1,i.panFactorRight=0):r>=.5?(i.panFactorLeft=0,i.panFactorRight=1):(i.panFactorLeft=Math.sqrt(.5-r),i.panFactorRight=Math.sqrt(.5+r))}this.channelInit(e).panOffset=t-.5}channelSetVolume(e,t){const i=this.channelInit(e),r=it.gainToDecibels(t),n=r-i.gainDb;if(n!==0){for(const a of this._voices)a.playingChannel===e&&a.playingPreset!==-1&&(a.noteGainDb+=n);i.gainDb=r}}channelSetPitchWheel(e,t){const i=this.channelInit(e);i.pitchWheel!==t&&(i.pitchWheel=ue.int32ToUint16(t),this.channelApplyPitch(e,i))}channelSetPerNotePitchWheel(e,t,i){this._transpositionPitches.has(e)&&(t+=this._transpositionPitches.get(e)),this._liveTranspositionPitches.has(e)&&(t+=this._liveTranspositionPitches.get(e));const r=this.channelInit(e);r.perNotePitchWheel.has(t)&&r.perNotePitchWheel.get(t)===i||(r.perNotePitchWheel.set(t,i),this.channelApplyPitch(e,r,t))}channelApplyPitch(e,t,i=-1){for(const r of this._voices)r.playingChannel===e&&r.playingPreset!==-1&&(i==-1||r.playingKey===i)&&r.updatePitchRatio(t,this.outSampleRate)}channelSetPitchRange(e,t){const i=this.channelInit(e);i.pitchRange!==t&&(i.pitchRange=t,i.pitchWheel!==8192&&this.channelApplyPitch(e,i))}channelSetTuning(e,t){const i=this.channelInit(e);i.tuning!==t&&(i.tuning=t,this.channelApplyPitch(e,i))}channelMidiControl(e,t,i){let r=this.channelInit(e);switch(t){case Le.DataEntryFine:r.midiData=ue.int32ToUint16(r.midiData&16256|i),r.midiRpn===0?this.channelSetPitchRange(e,(r.midiData>>7)+.01*(r.midiData&127)):r.midiRpn===1?this.channelSetTuning(e,(r.tuning|0)+(r.midiData-8192)/8192):r.midiRpn===2&&this.channelSetTuning(e,i-64+(r.tuning-(r.tuning|0)));return;case Le.VolumeCoarse:r.midiVolume=ue.int32ToUint16(r.midiVolume&127|i<<7),this.channelSetVolume(e,Math.pow(r.midiVolume/16383*(r.midiExpression/16383),3));return;case Le.VolumeFine:r.midiVolume=ue.int32ToUint16(r.midiVolume&16256|i),this.channelSetVolume(e,Math.pow(r.midiVolume/16383*(r.midiExpression/16383),3));return;case Le.ExpressionControllerCoarse:r.midiExpression=ue.int32ToUint16(r.midiExpression&127|i<<7),this.channelSetVolume(e,Math.pow(r.midiVolume/16383*(r.midiExpression/16383),3));return;case Le.ExpressionControllerFine:r.midiExpression=ue.int32ToUint16(r.midiExpression&16256|i),this.channelSetVolume(e,Math.pow(r.midiVolume/16383*(r.midiExpression/16383),3));return;case Le.PanCoarse:r.midiPan=ue.int32ToUint16(r.midiPan&127|i<<7),this.channelSetPan(e,r.midiPan/16383);return;case Le.PanFine:r.midiPan=ue.int32ToUint16(r.midiPan&16256|i),this.channelSetPan(e,r.midiPan/16383);return;case Le.DataEntryCoarse:r.midiData=ue.int32ToUint16(r.midiData&127|i<<7),r.midiRpn===0?this.channelSetPitchRange(e,(r.midiData>>7)+.01*(r.midiData&127)):r.midiRpn===1?this.channelSetTuning(e,(r.tuning|0)+(r.midiData-8192)/8192):r.midiRpn===2&&t===Le.DataEntryCoarse&&this.channelSetTuning(e,i-64+(r.tuning-(r.tuning|0)));return;case Le.BankSelectCoarse:r.bank=ue.int32ToUint16(32768|i);return;case Le.BankSelectFine:r.bank=ue.int32ToUint16((r.bank&32768?(r.bank&127)<<7:0)|i);return;case Le.RegisteredParameterCourse:r.midiRpn=ue.int32ToUint16((r.midiRpn===65535?0:r.midiRpn)&127|i<<7);return;case Le.RegisteredParameterFine:r.midiRpn=ue.int32ToUint16((r.midiRpn===65535?0:r.midiRpn)&16256|i);return;case Le.NonRegisteredParameterFine:r.midiRpn=65535;return;case Le.NonRegisteredParameterCourse:r.midiRpn=65535;return;case Le.AllSoundOff:this.channelSoundsOffAll(e);return;case Le.AllNotesOff:this.channelNoteOffAll(e);return;case Le.ResetControllers:r.midiVolume=16383,r.midiExpression=16383,r.midiPan=8192,r.bank=0,this.channelSetVolume(e,1),this.channelSetPan(e,.5),this.channelSetPitchRange(e,2);return}}channelGetPresetIndex(e){return this._channels&&e<this._channels.channelList.length?this._channels.channelList[e].presetIndex:0}channelGetPresetBank(e){return this._channels&&e<this._channels.channelList.length?this._channels.channelList[e].bank&32767:0}channelGetPan(e){return this._channels&&e<this._channels.channelList.length?this._channels.channelList[e].panOffset-.5:.5}channelGetVolume(e){return this._channels&&e<this._channels.channelList.length?it.decibelsToGain(this._channels.channelList[e].gainDb):1}channelGetPitchWheel(e){return this._channels&&e<this._channels.channelList.length?this._channels.channelList[e].pitchWheel:8192}channelGetPitchRange(e){return this._channels&&e<this._channels.channelList.length?this._channels.channelList[e].pitchRange:2}channelGetTuning(e){return this._channels&&e<this._channels.channelList.length?this._channels.channelList[e].tuning:0}resetPresets(){this.presets=[]}loadPresets(e,t){const i=[];for(let r=0;r<e.phdrs.length-1;r++){const n=e.phdrs[r];let a=0;const o=new uv;i.push(o),o.name=n.presetName,o.bank=n.bank,o.presetNumber=n.preset,o.fontSamples=e.fontSamples;let l=0;for(let u=n.presetBagNdx;u<e.phdrs[r+1].presetBagNdx;u++){const c=e.pbags[u];let d=0,p=127,g=0,w=127;for(let S=c.genNdx;S<e.pbags[u+1].genNdx;S++){let b=e.pgens[S];if(b.genOper===Ni.GenKeyRange){d=b.genAmount.lowByteAmount,p=b.genAmount.highByteAmount;continue}if(b.genOper===Ni.GenVelRange){g=b.genAmount.lowByteAmount,w=b.genAmount.highByteAmount;continue}if(b.genOper!==Ni.GenInstrument||b.genAmount.wordAmount>=e.insts.length)continue;let m=e.insts[b.genAmount.wordAmount];for(let y=m.instBagNdx;y<e.insts[b.genAmount.wordAmount+1].instBagNdx;y++){let B=e.ibags[y],_=0,P=127,N=0,D=127;for(let Q=B.instGenNdx;Q<e.ibags[y+1].instGenNdx;Q++){let J=e.igens[Q];if(J.genOper===Ni.GenKeyRange){_=J.genAmount.lowByteAmount,P=J.genAmount.highByteAmount;continue}if(J.genOper===Ni.GenVelRange){N=J.genAmount.lowByteAmount,D=J.genAmount.highByteAmount;continue}J.genOper===53&&P>=d&&_<=p&&D>=g&&N<=w&&l++}}}}o.regions=new Array(l);let h=new zn;h.clear(!0);for(let u=n.presetBagNdx;u<e.phdrs[r+1].presetBagNdx;u++){const c=e.pbags[u],d=new zn(h);let p=!1;for(let g=c.genNdx;g<e.pbags[u+1].genNdx;g++){const w=e.pgens[g];if(w.genOper===Ni.GenInstrument){let S=w.genAmount.wordAmount;if(S>=e.insts.length)continue;let b=new zn;b.clear(!1);let m=e.insts[S];for(let y=m.instBagNdx;y<e.insts[S+1].instBagNdx;y++){let B=e.ibags[y],_=new zn(b),P=!1;for(let N=B.instGenNdx;N<e.ibags[y+1].instGenNdx;N++){let D=e.igens[N];if(D.genOper===Ni.GenSampleId){if(_.hiKey<d.loKey||_.loKey>d.hiKey||_.hiVel<d.loVel||_.loVel>d.hiVel)continue;d.loKey>_.loKey&&(_.loKey=d.loKey),d.hiKey<_.hiKey&&(_.hiKey=d.hiKey),d.loVel>_.loVel&&(_.loVel=d.loVel),d.hiVel<_.hiVel&&(_.hiVel=d.hiVel),_.offset+=d.offset,_.end+=d.end,_.loopStart+=d.loopStart,_.loopEnd+=d.loopEnd,_.transpose+=d.transpose,_.tune+=d.tune,_.pitchKeyTrack+=d.pitchKeyTrack,_.attenuation+=d.attenuation,_.pan+=d.pan,_.ampEnv.delay+=d.ampEnv.delay,_.ampEnv.attack+=d.ampEnv.attack,_.ampEnv.hold+=d.ampEnv.hold,_.ampEnv.decay+=d.ampEnv.decay,_.ampEnv.sustain+=d.ampEnv.sustain,_.ampEnv.release+=d.ampEnv.release,_.modEnv.delay+=d.modEnv.delay,_.modEnv.attack+=d.modEnv.attack,_.modEnv.hold+=d.modEnv.hold,_.modEnv.decay+=d.modEnv.decay,_.modEnv.sustain+=d.modEnv.sustain,_.modEnv.release+=d.modEnv.release,_.initialFilterQ+=d.initialFilterQ,_.initialFilterFc+=d.initialFilterFc,_.modEnvToPitch+=d.modEnvToPitch,_.modEnvToFilterFc+=d.modEnvToFilterFc,_.delayModLFO+=d.delayModLFO,_.freqModLFO+=d.freqModLFO,_.modLfoToPitch+=d.modLfoToPitch,_.modLfoToFilterFc+=d.modLfoToFilterFc,_.modLfoToVolume+=d.modLfoToVolume,_.delayVibLFO+=d.delayVibLFO,_.freqVibLFO+=d.freqVibLFO,_.vibLfoToPitch+=d.vibLfoToPitch,_.ampEnv.envToSecs(!0),_.modEnv.envToSecs(!1),_.delayModLFO=_.delayModLFO<-11950?0:it.timecents2Secs(_.delayModLFO),_.delayVibLFO=_.delayVibLFO<-11950?0:it.timecents2Secs(_.delayVibLFO),_.pan<-.5?_.pan=-.5:_.pan>.5&&(_.pan=.5),(_.initialFilterQ<1500||_.initialFilterQ>13500)&&(_.initialFilterQ=0);let Q=e.sHdrs[D.genAmount.wordAmount];_.offset+=Q.start,_.end+=Q.end,_.loopStart+=Q.startLoop,_.loopEnd+=Q.endLoop,Q.endLoop>0&&(_.loopEnd-=1),_.pitchKeyCenter===-1&&(_.pitchKeyCenter=Q.originalPitch),_.tune+=Q.pitchCorrection,_.sampleRate=Q.sampleRate,_.end!==0&&_.end<o.fontSamples.length?_.end++:_.end=o.fontSamples.length,o.regions[a]=new zn(_),a++,P=!0}else _.operator(D.genOper,D.genAmount)}B===e.ibags[m.instBagNdx]&&!P&&(b=new zn(_))}p=!0}else d.operator(w.genOper,w.genAmount)}c===e.pbags[n.presetBagNdx]&&!p&&(h=d)}}if(!t||!this.presets)this.presets=i;else for(const r of i)this.presets.push(r)}}class kt{constructor(){this._listeners=[]}on(e){this._listeners.push(e)}off(e){this._listeners=this._listeners.filter(t=>t!==e)}trigger(){for(const e of this._listeners)e()}}class Se{constructor(){this._listeners=[]}on(e){this._listeners.push(e)}off(e){this._listeners=this._listeners.filter(t=>t!==e)}trigger(e){for(const t of this._listeners)t(e)}}class ap{constructor(e){this.events=e}}class op{constructor(e){this.playbackRange=e}}class Yw{get isReadyForPlayback(){return this.isReady&&this._isSoundFontLoaded&&this._isMidiLoaded}get logLevel(){return C.logLevel}set logLevel(e){C.logLevel=e}get masterVolume(){return this._synthesizer.masterVolume}set masterVolume(e){e=Math.max(e,le.MinVolume),this._synthesizer.masterVolume=e}get metronomeVolume(){return this._metronomeVolume}set metronomeVolume(e){e=Math.max(e,le.MinVolume),this._metronomeVolume=e,this._synthesizer.metronomeVolume=e}get countInVolume(){return this._countInVolume}set countInVolume(e){e=Math.max(e,le.MinVolume),this._countInVolume=e}get midiEventsPlayedFilter(){return Array.from(this._midiEventsPlayedFilter)}set midiEventsPlayedFilter(e){this._midiEventsPlayedFilter=new Set(e)}get playbackSpeed(){return this._sequencer.playbackSpeed}set playbackSpeed(e){e=it.clamp(e,le.MinPlaybackSpeed,le.MaxPlaybackSpeed);let t=this._sequencer.playbackSpeed;this._sequencer.playbackSpeed=e,this.timePosition=this.timePosition*(t/e)}get tickPosition(){return this._tickPosition}set tickPosition(e){this.timePosition=this._sequencer.mainTickPositionToTimePosition(e)}get timePosition(){return this._timePosition}set timePosition(e){C.debug("AlphaSynth",`Seeking to position ${e}ms (main)`),this._sequencer.mainSeek(e),this.updateTimePosition(e,!0),this._sequencer.isPlayingMain&&(this._notPlayedSamples=0,this.output.resetSamples())}get playbackRange(){return this._sequencer.mainPlaybackRange}set playbackRange(e){this._sequencer.mainPlaybackRange=e,e&&(this.tickPosition=e.startTick),this.playbackRangeChanged.trigger(new op(e))}get isLooping(){return this._sequencer.isLooping}set isLooping(e){this._sequencer.isLooping=e}destroy(){C.debug("AlphaSynth","Destroying player"),this.stop(),this.output.destroy()}constructor(e,t){this._isSoundFontLoaded=!1,this._isMidiLoaded=!1,this._tickPosition=0,this._timePosition=0,this._metronomeVolume=0,this._countInVolume=0,this._playedEventsQueue=new Vd,this._midiEventsPlayedFilter=new Set,this._notPlayedSamples=0,this._synthStopping=!1,this.isReady=!1,this.state=dt.Paused,this.ready=new kt,this.readyForPlayback=new kt,this.finished=new kt,this.soundFontLoaded=new kt,this.soundFontLoadFailed=new Se,this.midiLoaded=new Se,this.midiLoadFailed=new Se,this.stateChanged=new Se,this.positionChanged=new Se,this.midiEventsPlayed=new Se,this.playbackRangeChanged=new Se,C.debug("AlphaSynth","Initializing player"),this.state=dt.Paused,C.debug("AlphaSynth","Creating output"),this.output=e,C.debug("AlphaSynth","Creating synthesizer"),this._synthesizer=new cv(this.output.sampleRate),this._sequencer=new ov(this._synthesizer),C.debug("AlphaSynth","Opening output"),this.output.ready.on(()=>{this.isReady=!0,this.ready.trigger(),this.checkReadyForPlayback()}),this.output.sampleRequest.on(()=>{if(this.state==dt.Playing&&(!this._sequencer.isFinished||this._synthesizer.activeVoiceCount>0)){let i=new Float32Array(le.MicroBufferSize*le.MicroBufferCount*le.AudioChannels),r=0;for(let n=0;n<le.MicroBufferCount;n++){this._sequencer.fillMidiEventQueue();const a=this._synthesizer.synthesize(i,r,le.MicroBufferSize);r+=le.MicroBufferSize*le.AudioChannels;for(const o of a)this._midiEventsPlayedFilter.has(o.event.type)&&this._playedEventsQueue.enqueue(o);if(this._sequencer.isFinished)break}r<i.length&&(i=i.subarray(0,r)),this._notPlayedSamples+=i.length,this.output.addSamples(i)}else{let i=new Float32Array(0);this.output.addSamples(i)}}),this.output.samplesPlayed.on(this.onSamplesPlayed.bind(this)),this.output.open(t)}play(){return this.state!==dt.Paused||!this._isMidiLoaded?!1:(this.output.activate(),this.playInternal(),this._countInVolume>0&&(C.debug("AlphaSynth","Starting countin"),this._sequencer.startCountIn(),this._synthesizer.setupMetronomeChannel(this._countInVolume),this.updateTimePosition(0,!0)),this.output.play(),!0)}playInternal(){this._sequencer.isPlayingOneTimeMidi&&(C.debug("AlphaSynth","Cancelling one time midi"),this.stopOneTimeMidi()),C.debug("AlphaSynth","Starting playback"),this._synthesizer.setupMetronomeChannel(this.metronomeVolume),this._synthStopping=!1,this.state=dt.Playing,this.stateChanged.trigger(new ho(this.state,!1))}pause(){this.state===dt.Paused||!this._isMidiLoaded||(C.debug("AlphaSynth","Pausing playback"),this.state=dt.Paused,this.stateChanged.trigger(new ho(this.state,!1)),this.output.pause(),this._synthesizer.noteOffAll(!1))}playPause(){this.state!==dt.Paused||!this._isMidiLoaded?this.pause():this.play()}stop(){this._isMidiLoaded&&(C.debug("AlphaSynth","Stopping playback"),this.state=dt.Paused,this.output.pause(),this._notPlayedSamples=0,this._sequencer.stop(),this._synthesizer.noteOffAll(!0),this.tickPosition=this._sequencer.mainPlaybackRange?this._sequencer.mainPlaybackRange.startTick:0,this.stateChanged.trigger(new ho(this.state,!0)))}playOneTimeMidiFile(e){this._sequencer.isPlayingOneTimeMidi?this.stopOneTimeMidi():this.pause(),this._sequencer.loadOneTimeMidi(e),this._synthesizer.noteOffAll(!0),this.updateTimePosition(0,!0),this._notPlayedSamples=0,this.output.resetSamples(),this.output.play()}resetSoundFonts(){this.stop(),this._synthesizer.resetPresets(),this._isSoundFontLoaded=!1,this.soundFontLoaded.trigger()}loadSoundFont(e,t){this.pause();let i=Tt.fromBuffer(e);try{C.debug("AlphaSynth","Loading soundfont from bytes");let r=new np;r.load(i),this._synthesizer.loadPresets(r,t),this._isSoundFontLoaded=!0,this.soundFontLoaded.trigger(),C.debug("AlphaSynth","soundFont successfully loaded"),this.checkReadyForPlayback()}catch(r){C.error("AlphaSynth","Could not load soundfont from bytes "+r),this.soundFontLoadFailed.trigger(r)}}checkReadyForPlayback(){this.isReadyForPlayback&&(this._synthesizer.setupMetronomeChannel(this.metronomeVolume),this.readyForPlayback.trigger())}loadMidiFile(e){this.stop();try{C.debug("AlphaSynth","Loading midi from model"),this._sequencer.loadMidi(e),this._isMidiLoaded=!0,this.midiLoaded.trigger(new Oo(0,this._sequencer.currentEndTime,0,this._sequencer.currentEndTick,!1)),C.debug("AlphaSynth","Midi successfully loaded"),this.checkReadyForPlayback(),this.tickPosition=0}catch(t){C.error("AlphaSynth","Could not load midi from model "+t),this.midiLoadFailed.trigger(t)}}applyTranspositionPitches(e){this._synthesizer.applyTranspositionPitches(e)}setChannelTranspositionPitch(e,t){this._synthesizer.setChannelTranspositionPitch(e,t)}setChannelMute(e,t){this._synthesizer.channelSetMute(e,t)}resetChannelStates(){this._synthesizer.resetChannelStates()}setChannelSolo(e,t){this._synthesizer.channelSetSolo(e,t)}setChannelVolume(e,t){t=Math.max(t,le.MinVolume),this._synthesizer.channelSetMixVolume(e,t)}onSamplesPlayed(e){if(e===0)return;let t=e/this._synthesizer.outSampleRate*1e3;this._notPlayedSamples-=e*le.AudioChannels,this.updateTimePosition(this._timePosition+t,!1),this.checkForFinish()}checkForFinish(){let e=0,t=0;this.playbackRange&&this._sequencer.isPlayingMain?(e=this.playbackRange.startTick,t=this.playbackRange.endTick):t=this._sequencer.currentEndTick,this._tickPosition>=t&&this._notPlayedSamples<=0&&(this._notPlayedSamples=0,this._sequencer.isPlayingCountIn?(C.debug("AlphaSynth","Finished playback (count-in)"),this._sequencer.resetCountIn(),this.timePosition=this._sequencer.currentTime,this.playInternal(),this.output.resetSamples()):this._sequencer.isPlayingOneTimeMidi?(C.debug("AlphaSynth","Finished playback (one time)"),this.output.resetSamples(),this.state=dt.Paused,this.stopOneTimeMidi()):this.isLooping?(C.debug("AlphaSynth","Finished playback (main looping)"),this.finished.trigger(),this.tickPosition=e,this._synthStopping=!1):this._synthesizer.activeVoiceCount>0?this._synthStopping||(this._synthesizer.noteOffAll(!0),this._synthStopping=!0):(this._synthStopping=!1,C.debug("AlphaSynth","Finished playback (main)"),this.finished.trigger(),this.stop()))}stopOneTimeMidi(){this.output.pause(),this._synthesizer.noteOffAll(!0),this._sequencer.resetOneTimeMidi(),this.timePosition=this._sequencer.currentTime}updateTimePosition(e,t){let i=e;this._timePosition=i;let r=this._sequencer.currentTimePositionToTickPosition(i);this._tickPosition=r;const n=this._sequencer.currentEndTime,a=this._sequencer.currentEndTick;i>n&&(i=n,r=a);const o=this._sequencer.isPlayingMain?"main":this._sequencer.isPlayingCountIn?"count-in":"one-time";if(C.debug("AlphaSynth",`Position changed: (time: ${i}/${n}, tick: ${r}/${a}, Active Voices: ${this._synthesizer.activeVoiceCount} (${o})`),this._sequencer.isPlayingMain&&this.positionChanged.trigger(new Oo(i,n,r,a,t)),t)this._playedEventsQueue.clear();else{const l=new Vd;for(;!this._playedEventsQueue.isEmpty&&this._playedEventsQueue.peek().time<i;){const h=this._playedEventsQueue.dequeue();l.enqueue(h.event)}l.isEmpty||this.midiEventsPlayed.trigger(new ap(l.toArray()))}}}class I{static parseEnum(e,t){switch(typeof e){case"string":const i=parseInt(e);return isNaN(i)?t[Object.keys(t).find(r=>r.toLowerCase()===e.toLowerCase())]:i;case"number":return e;case"undefined":case"object":return null}throw new Pt(Nt.Format,`Could not parse enum value '${e}'`)}static forEach(e,t){if(e instanceof Map)e.forEach(t);else if(typeof e=="object")for(const i in e)t(e[i],i)}static getValue(e,t){return e instanceof Map?e.get(t):typeof e=="object"?e[t]:null}}class dv{constructor(e,t,i){this.text=e,this.startPos=t,this.endPos=i}}class ia{constructor(e){this.style="normal",this.variant="normal",this.weight="normal",this.stretch="normal",this.lineHeight="normal",this.size="1rem",this.families=[],this.parseOnlyFamilies=!1,this._currentTokenIndex=-1,this._input="",this._currentToken=null,this._input=e,this._tokens=this.splitToTokens(e)}splitToTokens(e){const t=[];let i=0;for(;i<e.length;){let r=i;for(;r<e.length&&e.charAt(r)!==" ";)r++;r>i&&t.push(new dv(e.substring(i,r),i,r)),i=r+1}return t}parse(){var e;if(this.reset(),this._tokens.length===1)switch((e=this._currentToken)==null?void 0:e.text){case"caption":case"icon":case"menu":case"message-box":case"small-caption":case"status-bar":case"inherit":return}this.parseOnlyFamilies||(this.fontStyleVariantWeight(),this.fontSizeLineHeight()),this.fontFamily()}static parseFamilies(e){const t=new ia(e);return t.parseOnlyFamilies=!0,t.parse(),t.families}fontFamily(){if(!this._currentToken){if(this.parseOnlyFamilies)return;throw new Error("Missing font list")}const e=this._input.substr(this._currentToken.startPos).trim();let t=0;for(;t<e.length;){let i=e.charAt(t);if(i===" "||i==",")t++;else if(i==='"'||i==="'"){const r=this.findEndOfQuote(e,t+1,i);this.families.push(e.substring(t+1,r).split("\\"+i).join(i)),t=r+1}else{const r=this.findEndOfQuote(e,t+1,",");this.families.push(e.substring(t,r).trim()),t=r+1}}}findEndOfQuote(e,t,i){let r=!1;for(;t<e.length;){const n=e.charAt(t);if(!r&&n===i)return t;!r&&n==="\\"?r=!0:r=!1,t+=1}return e.length}fontSizeLineHeight(){if(!this._currentToken)throw new Error("Missing font size");const e=this._currentToken.text.split("/");if(e.length>=3)throw new Error(`Invalid font size '${this._currentToken}' specified`);if(this.nextToken(),e.length>=2)if(e[1]==="/"){if(!this._currentToken)throw new Error("Missing line-height after font size");this.lineHeight=this._currentToken.text,this.nextToken()}else this.size=e[0],this.lineHeight=e[1];else if(e.length>=1){if(this.size=e[0],this._currentToken&&this._currentToken.text.indexOf("/")===0)if(this._currentToken.text==="/"){if(this.nextToken(),!this._currentToken)throw new Error("Missing line-height after font size");this.lineHeight=this._currentToken.text,this.nextToken()}else this.lineHeight=this._currentToken.text.substr(1),this.nextToken()}else throw new Error("Missing font size")}nextToken(){this._currentTokenIndex++,this._currentTokenIndex<this._tokens.length?this._currentToken=this._tokens[this._currentTokenIndex]:this._currentToken=null}fontStyleVariantWeight(){let e=!1,t=!1,i=!1,r=3,n=[];for(;;){if(!this._currentToken)return;let a=this._currentToken.text;switch(a){case"normal":case"inherit":n.push(a),r--,this.nextToken();break;case"italic":case"oblique":this.style=a,e=!0,r--,this.nextToken();break;case"small-caps":this.variant=a,t=!0,r--,this.nextToken();break;case"bold":case"bolder":case"lighter":case"100":case"200":case"300":case"400":case"500":case"600":case"700":case"800":case"900":this.weight=a,i=!0,r--,this.nextToken();break;default:return}if(r===0)break}for(;n.length>0;){const a=n.pop();i?t?e||(this.style=a):this.variant=a:this.weight=a}}reset(){this._currentTokenIndex=-1,this.nextToken()}static quoteFont(e){return e.indexOf(" ")===-1?e:`"${e.replaceAll('"','\\"')}"`}}var Ue;(function(s){s[s.Plain=0]="Plain",s[s.Italic=1]="Italic"})(Ue||(Ue={}));var Ci;(function(s){s[s.Regular=0]="Regular",s[s.Bold=1]="Bold"})(Ci||(Ci={}));class he{reset(){this._cssScale=0,this._css=this.toCssString()}get family(){return this._families[0]}set family(e){this.families=ia.parseFamilies(e)}get families(){return this._families}set families(e){this._families=e,this.reset()}get size(){return this._size}set size(e){this._size=e,this.reset()}get style(){return this._style}set style(e){this._style=e,this.reset()}get weight(){return this._weight}set weight(e){this._weight=e,this.reset()}get isBold(){return this.weight===Ci.Bold}get isItalic(){return this.style===Ue.Italic}constructor(e,t,i=Ue.Plain,r=Ci.Regular){this._cssScale=0,this._families=ia.parseFamilies(e),this._size=t,this._style=i,this._weight=r,this._css=this.toCssString()}static withFamilyList(e,t,i=Ue.Plain,r=Ci.Regular){const n=new he("",t,i,r);return n.families=e,n}toCssString(e=1){if(!this._css||!(Math.abs(e-this._cssScale)<.01)){let t="";this.isBold&&(t+="bold "),this.isItalic&&(t+="italic "),t+=this.size*e,t+="px ",t+=this.families.map(i=>ia.quoteFont(i)).join(", "),this._css=t,this._cssScale=e}return this._css}static fromJson(e){if(e instanceof he)return e;switch(typeof e){case"undefined":return null;case"object":{const t=e;let i=t.get("families"),r=t.get("size"),n=I.parseEnum(t.get("style"),Ue),a=I.parseEnum(t.get("weight"),Ci);return he.withFamilyList(i,r,n,a)}case"string":{const t=new ia(e);t.parse();let i=t.families,r=t.size.toLowerCase(),n=0;switch(r){case"xx-small":n=7;break;case"x-small":n=10;break;case"small":case"smaller":n=13;break;case"medium":n=16;break;case"large":case"larger":n=18;break;case"x-large":n=24;break;case"xx-large":n=32;break;default:try{r.endsWith("em")?n=parseFloat(r.substr(0,r.length-2))*16:r.endsWith("pt")?n=parseFloat(r.substr(0,r.length-2))*16/12:r.endsWith("px")?n=parseFloat(r.substr(0,r.length-2)):n=12}catch{n=12}break}let a=Ue.Plain;t.style==="italic"&&(a=Ue.Italic);let o=Ci.Regular;switch(t.weight.toLowerCase()){case"normal":case"lighter":break;default:o=Ci.Bold;break}return he.withFamilyList(i,n,a,o)}default:return null}}static toJson(e){const t=new Map;return t.set("families",e.families),t.set("size",e.size),t.set("style",e.style),t.set("weight",e.weight),t}}class $t{constructor(){this.copyrightFont=new he($t.sansFont,12,Ue.Plain,Ci.Bold),this.titleFont=new he($t.serifFont,32,Ue.Plain),this.subTitleFont=new he($t.serifFont,20,Ue.Plain),this.wordsFont=new he($t.serifFont,15,Ue.Plain),this.effectFont=new he($t.serifFont,12,Ue.Italic),this.fretboardNumberFont=new he($t.sansFont,11,Ue.Plain),this.numberedNotationFont=new he($t.sansFont,16,Ue.Plain),this.numberedNotationGraceFont=new he($t.sansFont,14,Ue.Plain),this.tablatureFont=new he($t.sansFont,13,Ue.Plain),this.graceFont=new he($t.sansFont,11,Ue.Plain),this.staffLineColor=new Ce(165,165,165,255),this.barSeparatorColor=new Ce(34,34,17,255),this.barNumberFont=new he($t.sansFont,11,Ue.Plain),this.barNumberColor=new Ce(200,0,0,255),this.fingeringFont=new he($t.serifFont,14,Ue.Plain),this.inlineFingeringFont=new he($t.serifFont,12,Ue.Plain),this.markerFont=new he($t.serifFont,14,Ue.Plain,Ci.Bold),this.mainGlyphColor=new Ce(0,0,0,255),this.secondaryGlyphColor=new Ce(0,0,0,100),this.scoreInfoColor=new Ce(0,0,0,255)}}$t.sansFont="Arial, sans-serif";$t.serifFont="Georgia, serif";var Yr;(function(s){s[s.Automatic=0]="Automatic",s[s.UseModelLayout=1]="UseModelLayout"})(Yr||(Yr={}));class fv{constructor(){this.scale=1,this.stretchForce=1,this.layoutMode=ur.Page,this.staveProfile=er.Default,this.barsPerRow=-1,this.startBar=1,this.barCount=-1,this.barCountPerPartial=10,this.justifyLastSystem=!1,this.resources=new $t,this.padding=[35,35],this.firstSystemPaddingTop=5,this.systemPaddingTop=10,this.systemPaddingBottom=20,this.lastSystemPaddingBottom=0,this.systemLabelPaddingLeft=0,this.systemLabelPaddingRight=5,this.accoladeBarPaddingRight=3,this.notationStaffPaddingTop=5,this.notationStaffPaddingBottom=5,this.effectStaffPaddingTop=0,this.effectStaffPaddingBottom=0,this.systemsLayoutMode=Yr.Automatic}}class pv{constructor(){this.encoding="utf-8",this.mergePartGroupsInMusicXml=!1,this.beatTextAsLyrics=!1}}var ir;(function(s){s[s.Off=0]="Off",s[s.Continuous=1]="Continuous",s[s.OffScreen=2]="OffScreen"})(ir||(ir={}));class gv{constructor(){this.noteWideLength=480,this.noteWideAmplitude=2,this.noteSlightLength=480,this.noteSlightAmplitude=2,this.beatWideLength=240,this.beatWideAmplitude=3,this.beatSlightLength=240,this.beatSlightAmplitude=3}}class mv{constructor(){this.simpleSlidePitchOffset=6,this.simpleSlideDurationRatio=.25,this.shiftSlideDurationRatio=.5}}var Wo;(function(s){s[s.WebAudioAudioWorklets=0]="WebAudioAudioWorklets",s[s.WebAudioScriptProcessor=1]="WebAudioScriptProcessor"})(Wo||(Wo={}));class yv{constructor(){this.soundFont=null,this.scrollElement="html,body",this.outputMode=Wo.WebAudioAudioWorklets,this.enablePlayer=!1,this.enableCursor=!0,this.enableAnimatedBeatCursor=!0,this.enableElementHighlighting=!0,this.enableUserInteraction=!0,this.scrollOffsetX=0,this.scrollOffsetY=0,this.scrollMode=ir.Continuous,this.scrollSpeed=300,this.nativeBrowserSmoothScroll=!0,this.songBookBendDuration=75,this.songBookDipDuration=150,this.vibrato=new gv,this.slide=new mv,this.playTripletFeel=!0,this.bufferTimeInMilliseconds=500}}class cc{static fromJson(e,t){t&&I.forEach(t,(i,r)=>this.setProperty(e,r.toLowerCase(),i))}static toJson(e){if(!e)return null;const t=new Map;return t.set("scriptfile",e.scriptFile),t.set("fontdirectory",e.fontDirectory),t.set("file",e.file),t.set("tex",e.tex),t.set("tracks",e.tracks),t.set("enablelazyloading",e.enableLazyLoading),t.set("engine",e.engine),t.set("loglevel",e.logLevel),t.set("useworkers",e.useWorkers),t.set("includenotebounds",e.includeNoteBounds),t}static setProperty(e,t,i){switch(t){case"scriptfile":return e.scriptFile=i,!0;case"fontdirectory":return e.fontDirectory=i,!0;case"file":return e.file=i,!0;case"tex":return e.tex=i,!0;case"tracks":return e.tracks=i,!0;case"enablelazyloading":return e.enableLazyLoading=i,!0;case"engine":return e.engine=i,!0;case"loglevel":return e.logLevel=I.parseEnum(i,ws),!0;case"useworkers":return e.useWorkers=i,!0;case"includenotebounds":return e.includeNoteBounds=i,!0}return!1}}class dc{static fromJson(e,t){t&&I.forEach(t,(i,r)=>this.setProperty(e,r.toLowerCase(),i))}static toJson(e){if(!e)return null;const t=new Map;return t.set("copyrightfont",he.toJson(e.copyrightFont)),t.set("titlefont",he.toJson(e.titleFont)),t.set("subtitlefont",he.toJson(e.subTitleFont)),t.set("wordsfont",he.toJson(e.wordsFont)),t.set("effectfont",he.toJson(e.effectFont)),t.set("fretboardnumberfont",he.toJson(e.fretboardNumberFont)),t.set("numberednotationfont",he.toJson(e.numberedNotationFont)),t.set("numberednotationgracefont",he.toJson(e.numberedNotationGraceFont)),t.set("tablaturefont",he.toJson(e.tablatureFont)),t.set("gracefont",he.toJson(e.graceFont)),t.set("stafflinecolor",Ce.toJson(e.staffLineColor)),t.set("barseparatorcolor",Ce.toJson(e.barSeparatorColor)),t.set("barnumberfont",he.toJson(e.barNumberFont)),t.set("barnumbercolor",Ce.toJson(e.barNumberColor)),t.set("fingeringfont",he.toJson(e.fingeringFont)),t.set("inlinefingeringfont",he.toJson(e.inlineFingeringFont)),t.set("markerfont",he.toJson(e.markerFont)),t.set("mainglyphcolor",Ce.toJson(e.mainGlyphColor)),t.set("secondaryglyphcolor",Ce.toJson(e.secondaryGlyphColor)),t.set("scoreinfocolor",Ce.toJson(e.scoreInfoColor)),t}static setProperty(e,t,i){switch(t){case"copyrightfont":return e.copyrightFont=he.fromJson(i),!0;case"titlefont":return e.titleFont=he.fromJson(i),!0;case"subtitlefont":return e.subTitleFont=he.fromJson(i),!0;case"wordsfont":return e.wordsFont=he.fromJson(i),!0;case"effectfont":return e.effectFont=he.fromJson(i),!0;case"fretboardnumberfont":return e.fretboardNumberFont=he.fromJson(i),!0;case"numberednotationfont":return e.numberedNotationFont=he.fromJson(i),!0;case"numberednotationgracefont":return e.numberedNotationGraceFont=he.fromJson(i),!0;case"tablaturefont":return e.tablatureFont=he.fromJson(i),!0;case"gracefont":return e.graceFont=he.fromJson(i),!0;case"stafflinecolor":return e.staffLineColor=Ce.fromJson(i),!0;case"barseparatorcolor":return e.barSeparatorColor=Ce.fromJson(i),!0;case"barnumberfont":return e.barNumberFont=he.fromJson(i),!0;case"barnumbercolor":return e.barNumberColor=Ce.fromJson(i),!0;case"fingeringfont":return e.fingeringFont=he.fromJson(i),!0;case"inlinefingeringfont":return e.inlineFingeringFont=he.fromJson(i),!0;case"markerfont":return e.markerFont=he.fromJson(i),!0;case"mainglyphcolor":return e.mainGlyphColor=Ce.fromJson(i),!0;case"secondaryglyphcolor":return e.secondaryGlyphColor=Ce.fromJson(i),!0;case"scoreinfocolor":return e.scoreInfoColor=Ce.fromJson(i),!0}return!1}}class fc{static fromJson(e,t){t&&I.forEach(t,(i,r)=>this.setProperty(e,r.toLowerCase(),i))}static toJson(e){if(!e)return null;const t=new Map;return t.set("scale",e.scale),t.set("stretchforce",e.stretchForce),t.set("layoutmode",e.layoutMode),t.set("staveprofile",e.staveProfile),t.set("barsperrow",e.barsPerRow),t.set("startbar",e.startBar),t.set("barcount",e.barCount),t.set("barcountperpartial",e.barCountPerPartial),t.set("justifylastsystem",e.justifyLastSystem),t.set("resources",dc.toJson(e.resources)),t.set("padding",e.padding),t.set("firstsystempaddingtop",e.firstSystemPaddingTop),t.set("systempaddingtop",e.systemPaddingTop),t.set("systempaddingbottom",e.systemPaddingBottom),t.set("lastsystempaddingbottom",e.lastSystemPaddingBottom),t.set("systemlabelpaddingleft",e.systemLabelPaddingLeft),t.set("systemlabelpaddingright",e.systemLabelPaddingRight),t.set("accoladebarpaddingright",e.accoladeBarPaddingRight),t.set("notationstaffpaddingtop",e.notationStaffPaddingTop),t.set("notationstaffpaddingbottom",e.notationStaffPaddingBottom),t.set("effectstaffpaddingtop",e.effectStaffPaddingTop),t.set("effectstaffpaddingbottom",e.effectStaffPaddingBottom),t.set("systemslayoutmode",e.systemsLayoutMode),t}static setProperty(e,t,i){switch(t){case"scale":return e.scale=i,!0;case"stretchforce":return e.stretchForce=i,!0;case"layoutmode":return e.layoutMode=I.parseEnum(i,ur),!0;case"staveprofile":return e.staveProfile=I.parseEnum(i,er),!0;case"barsperrow":return e.barsPerRow=i,!0;case"startbar":return e.startBar=i,!0;case"barcount":return e.barCount=i,!0;case"barcountperpartial":return e.barCountPerPartial=i,!0;case"justifylastsystem":return e.justifyLastSystem=i,!0;case"padding":return e.padding=i,!0;case"firstsystempaddingtop":return e.firstSystemPaddingTop=i,!0;case"systempaddingtop":return e.systemPaddingTop=i,!0;case"systempaddingbottom":return e.systemPaddingBottom=i,!0;case"lastsystempaddingbottom":return e.lastSystemPaddingBottom=i,!0;case"systemlabelpaddingleft":return e.systemLabelPaddingLeft=i,!0;case"systemlabelpaddingright":return e.systemLabelPaddingRight=i,!0;case"accoladebarpaddingright":return e.accoladeBarPaddingRight=i,!0;case"notationstaffpaddingtop":return e.notationStaffPaddingTop=i,!0;case"notationstaffpaddingbottom":return e.notationStaffPaddingBottom=i,!0;case"effectstaffpaddingtop":return e.effectStaffPaddingTop=i,!0;case"effectstaffpaddingbottom":return e.effectStaffPaddingBottom=i,!0;case"systemslayoutmode":return e.systemsLayoutMode=I.parseEnum(i,Yr),!0}if(["resources"].indexOf(t)>=0)return dc.fromJson(e.resources,i),!0;for(const r of["resources"])if(t.indexOf(r)===0&&dc.setProperty(e.resources,t.substring(r.length),i))return!0;return!1}}class pc{static fromJson(e,t){t&&I.forEach(t,(i,r)=>this.setProperty(e,r.toLowerCase(),i))}static toJson(e){if(!e)return null;const t=new Map;t.set("notationmode",e.notationMode),t.set("fingeringmode",e.fingeringMode);{const i=new Map;t.set("elements",i);for(const[r,n]of e.elements)i.set(r.toString(),n)}return t.set("rhythmmode",e.rhythmMode),t.set("rhythmheight",e.rhythmHeight),t.set("transpositionpitches",e.transpositionPitches),t.set("displaytranspositionpitches",e.displayTranspositionPitches),t.set("smallgracetabnotes",e.smallGraceTabNotes),t.set("extendbendarrowsontiednotes",e.extendBendArrowsOnTiedNotes),t.set("extendlineeffectstobeatend",e.extendLineEffectsToBeatEnd),t.set("slurheight",e.slurHeight),t}static setProperty(e,t,i){switch(t){case"notationmode":return e.notationMode=I.parseEnum(i,St),!0;case"fingeringmode":return e.fingeringMode=I.parseEnum(i,Cs),!0;case"elements":return e.elements=new Map,I.forEach(i,(r,n)=>{e.elements.set(I.parseEnum(n,K),r)}),!0;case"rhythmmode":return e.rhythmMode=I.parseEnum(i,ar),!0;case"rhythmheight":return e.rhythmHeight=i,!0;case"transpositionpitches":return e.transpositionPitches=i,!0;case"displaytranspositionpitches":return e.displayTranspositionPitches=i,!0;case"smallgracetabnotes":return e.smallGraceTabNotes=i,!0;case"extendbendarrowsontiednotes":return e.extendBendArrowsOnTiedNotes=i,!0;case"extendlineeffectstobeatend":return e.extendLineEffectsToBeatEnd=i,!0;case"slurheight":return e.slurHeight=i,!0}return!1}}class gc{static fromJson(e,t){t&&I.forEach(t,(i,r)=>this.setProperty(e,r.toLowerCase(),i))}static toJson(e){if(!e)return null;const t=new Map;return t.set("encoding",e.encoding),t.set("mergepartgroupsinmusicxml",e.mergePartGroupsInMusicXml),t.set("beattextaslyrics",e.beatTextAsLyrics),t}static setProperty(e,t,i){switch(t){case"encoding":return e.encoding=i,!0;case"mergepartgroupsinmusicxml":return e.mergePartGroupsInMusicXml=i,!0;case"beattextaslyrics":return e.beatTextAsLyrics=i,!0}return!1}}class mc{static fromJson(e,t){t&&I.forEach(t,(i,r)=>this.setProperty(e,r.toLowerCase(),i))}static toJson(e){if(!e)return null;const t=new Map;return t.set("notewidelength",e.noteWideLength),t.set("notewideamplitude",e.noteWideAmplitude),t.set("noteslightlength",e.noteSlightLength),t.set("noteslightamplitude",e.noteSlightAmplitude),t.set("beatwidelength",e.beatWideLength),t.set("beatwideamplitude",e.beatWideAmplitude),t.set("beatslightlength",e.beatSlightLength),t.set("beatslightamplitude",e.beatSlightAmplitude),t}static setProperty(e,t,i){switch(t){case"notewidelength":return e.noteWideLength=i,!0;case"notewideamplitude":return e.noteWideAmplitude=i,!0;case"noteslightlength":return e.noteSlightLength=i,!0;case"noteslightamplitude":return e.noteSlightAmplitude=i,!0;case"beatwidelength":return e.beatWideLength=i,!0;case"beatwideamplitude":return e.beatWideAmplitude=i,!0;case"beatslightlength":return e.beatSlightLength=i,!0;case"beatslightamplitude":return e.beatSlightAmplitude=i,!0}return!1}}class yc{static fromJson(e,t){t&&I.forEach(t,(i,r)=>this.setProperty(e,r.toLowerCase(),i))}static toJson(e){if(!e)return null;const t=new Map;return t.set("simpleslidepitchoffset",e.simpleSlidePitchOffset),t.set("simpleslidedurationratio",e.simpleSlideDurationRatio),t.set("shiftslidedurationratio",e.shiftSlideDurationRatio),t}static setProperty(e,t,i){switch(t){case"simpleslidepitchoffset":return e.simpleSlidePitchOffset=i,!0;case"simpleslidedurationratio":return e.simpleSlideDurationRatio=i,!0;case"shiftslidedurationratio":return e.shiftSlideDurationRatio=i,!0}return!1}}class wc{static fromJson(e,t){t&&I.forEach(t,(i,r)=>this.setProperty(e,r.toLowerCase(),i))}static toJson(e){if(!e)return null;const t=new Map;return t.set("soundfont",e.soundFont),t.set("outputmode",e.outputMode),t.set("enableplayer",e.enablePlayer),t.set("enablecursor",e.enableCursor),t.set("enableanimatedbeatcursor",e.enableAnimatedBeatCursor),t.set("enableelementhighlighting",e.enableElementHighlighting),t.set("enableuserinteraction",e.enableUserInteraction),t.set("scrolloffsetx",e.scrollOffsetX),t.set("scrolloffsety",e.scrollOffsetY),t.set("scrollmode",e.scrollMode),t.set("scrollspeed",e.scrollSpeed),t.set("nativebrowsersmoothscroll",e.nativeBrowserSmoothScroll),t.set("songbookbendduration",e.songBookBendDuration),t.set("songbookdipduration",e.songBookDipDuration),t.set("vibrato",mc.toJson(e.vibrato)),t.set("slide",yc.toJson(e.slide)),t.set("playtripletfeel",e.playTripletFeel),t.set("buffertimeinmilliseconds",e.bufferTimeInMilliseconds),t}static setProperty(e,t,i){switch(t){case"soundfont":return e.soundFont=i,!0;case"scrollelement":return e.scrollElement=i,!0;case"outputmode":return e.outputMode=I.parseEnum(i,Wo),!0;case"enableplayer":return e.enablePlayer=i,!0;case"enablecursor":return e.enableCursor=i,!0;case"enableanimatedbeatcursor":return e.enableAnimatedBeatCursor=i,!0;case"enableelementhighlighting":return e.enableElementHighlighting=i,!0;case"enableuserinteraction":return e.enableUserInteraction=i,!0;case"scrolloffsetx":return e.scrollOffsetX=i,!0;case"scrolloffsety":return e.scrollOffsetY=i,!0;case"scrollmode":return e.scrollMode=I.parseEnum(i,ir),!0;case"scrollspeed":return e.scrollSpeed=i,!0;case"nativebrowsersmoothscroll":return e.nativeBrowserSmoothScroll=i,!0;case"songbookbendduration":return e.songBookBendDuration=i,!0;case"songbookdipduration":return e.songBookDipDuration=i,!0;case"playtripletfeel":return e.playTripletFeel=i,!0;case"buffertimeinmilliseconds":return e.bufferTimeInMilliseconds=i,!0}if(["vibrato"].indexOf(t)>=0)return mc.fromJson(e.vibrato,i),!0;for(const r of["vibrato"])if(t.indexOf(r)===0&&mc.setProperty(e.vibrato,t.substring(r.length),i))return!0;if(["slide"].indexOf(t)>=0)return yc.fromJson(e.slide,i),!0;for(const r of["slide"])if(t.indexOf(r)===0&&yc.setProperty(e.slide,t.substring(r.length),i))return!0;return!1}}class Sa{static fromJson(e,t){t&&I.forEach(t,(i,r)=>this.setProperty(e,r.toLowerCase(),i))}static toJson(e){if(!e)return null;const t=new Map;return t.set("core",cc.toJson(e.core)),t.set("display",fc.toJson(e.display)),t.set("notation",pc.toJson(e.notation)),t.set("importer",gc.toJson(e.importer)),t.set("player",wc.toJson(e.player)),t}static setProperty(e,t,i){if(["core",""].indexOf(t)>=0)return cc.fromJson(e.core,i),!0;for(const r of["core",""])if(t.indexOf(r)===0&&cc.setProperty(e.core,t.substring(r.length),i))return!0;if(["display",""].indexOf(t)>=0)return fc.fromJson(e.display,i),!0;for(const r of["display",""])if(t.indexOf(r)===0&&fc.setProperty(e.display,t.substring(r.length),i))return!0;if(["notation"].indexOf(t)>=0)return pc.fromJson(e.notation,i),!0;for(const r of["notation"])if(t.indexOf(r)===0&&pc.setProperty(e.notation,t.substring(r.length),i))return!0;if(["importer"].indexOf(t)>=0)return gc.fromJson(e.importer,i),!0;for(const r of["importer"])if(t.indexOf(r)===0&&gc.setProperty(e.importer,t.substring(r.length),i))return!0;if(["player"].indexOf(t)>=0)return wc.fromJson(e.player,i),!0;for(const r of["player"])if(t.indexOf(r)===0&&wc.setProperty(e.player,t.substring(r.length),i))return!0;return!1}}class vn{constructor(){this.core=new hb,this.display=new fv,this.notation=new Do,this.importer=new pv,this.player=new yv}setSongBookModeSettings(){this.notation.notationMode=St.SongBook,this.notation.smallGraceTabNotes=!1,this.notation.fingeringMode=Cs.SingleNoteEffectBand,this.notation.extendBendArrowsOnTiedNotes=!1,this.notation.elements.set(K.ParenthesisOnTiedBends,!1),this.notation.elements.set(K.TabNotesOnTiedBends,!1),this.notation.elements.set(K.ZerosOnDiveWhammys,!0)}static get songBook(){let e=new vn;return e.setSongBookModeSettings(),e}fillFromJson(e){Sa.fromJson(this,e)}}class km{static fromJson(e,t){t&&I.forEach(t,(i,r)=>this.setProperty(e,r,i))}static toJson(e){if(!e)return null;const t=new Map;return t.set("marker",e.marker),t.set("text",e.text),t}static setProperty(e,t,i){switch(t){case"marker":return e.marker=i,!0;case"text":return e.text=i,!0}return!1}}class Fh{static fromJson(e,t){t&&I.forEach(t,(i,r)=>this.setProperty(e,r,i))}static toJson(e){if(!e)return null;const t=new Map;return t.set("islinear",e.isLinear),t.set("type",e.type),t.set("value",e.value),t.set("ratioposition",e.ratioPosition),t.set("text",e.text),t}static setProperty(e,t,i){switch(t){case"islinear":return e.isLinear=i,!0;case"type":return e.type=I.parseEnum(i,gt),!0;case"value":return e.value=i,!0;case"ratioposition":return e.ratioPosition=i,!0;case"text":return e.text=i,!0}return!1}}class _m{static fromJson(e,t){t&&I.forEach(t,(i,r)=>this.setProperty(e,r,i))}static toJson(e){if(!e)return null;const t=new Map;return t.set("type",e.type),t.set("length",e.length),t}static setProperty(e,t,i){switch(t){case"type":return e.type=I.parseEnum(i,Ts),!0;case"length":return e.length=i,!0}return!1}}class Bm{static fromJson(e,t){t&&I.forEach(t,(i,r)=>this.setProperty(e,r,i))}static toJson(e){if(!e)return null;const t=new Map;if(t.set("alternateendings",e.alternateEndings),t.set("keysignature",e.keySignature),t.set("keysignaturetype",e.keySignatureType),t.set("isdoublebar",e.isDoubleBar),t.set("isrepeatstart",e.isRepeatStart),t.set("repeatcount",e.repeatCount),t.set("timesignaturenumerator",e.timeSignatureNumerator),t.set("timesignaturedenominator",e.timeSignatureDenominator),t.set("timesignaturecommon",e.timeSignatureCommon),t.set("isfreetime",e.isFreeTime),t.set("tripletfeel",e.tripletFeel),t.set("section",km.toJson(e.section)),t.set("tempoautomations",e.tempoAutomations.map(i=>Fh.toJson(i))),e.fermata!==null){const i=new Map;t.set("fermata",i);for(const[r,n]of e.fermata)i.set(r.toString(),_m.toJson(n))}return t.set("start",e.start),t.set("isanacrusis",e.isAnacrusis),t.set("displayscale",e.displayScale),t.set("displaywidth",e.displayWidth),t}static setProperty(e,t,i){switch(t){case"alternateendings":return e.alternateEndings=i,!0;case"keysignature":return e.keySignature=I.parseEnum(i,fe),!0;case"keysignaturetype":return e.keySignatureType=I.parseEnum(i,Es),!0;case"isdoublebar":return e.isDoubleBar=i,!0;case"isrepeatstart":return e.isRepeatStart=i,!0;case"repeatcount":return e.repeatCount=i,!0;case"timesignaturenumerator":return e.timeSignatureNumerator=i,!0;case"timesignaturedenominator":return e.timeSignatureDenominator=i,!0;case"timesignaturecommon":return e.timeSignatureCommon=i,!0;case"isfreetime":return e.isFreeTime=i,!0;case"tripletfeel":return e.tripletFeel=I.parseEnum(i,ce),!0;case"tempoautomations":e.tempoAutomations=[];for(const r of i){const n=new Vt;Fh.fromJson(n,r),e.tempoAutomations.push(n)}return!0;case"fermata":return e.fermata=new Map,I.forEach(i,(r,n)=>{const a=new ep;_m.fromJson(a,r),e.addFermata(parseInt(n),a)}),!0;case"start":return e.start=i,!0;case"isanacrusis":return e.isAnacrusis=i,!0;case"displayscale":return e.displayScale=i,!0;case"displaywidth":return e.displayWidth=i,!0}return["section"].indexOf(t)>=0?(i?(e.section=new xu,km.fromJson(e.section,i)):e.section=null,!0):!1}}class Rh{static fromJson(e,t){t&&I.forEach(t,(i,r)=>this.setProperty(e,r,i))}static toJson(e){if(!e)return null;const t=new Map;return t.set("offset",e.offset),t.set("value",e.value),t}static setProperty(e,t,i){switch(t){case"offset":return e.offset=i,!0;case"value":return e.value=i,!0}return!1}}class xm{static fromJson(e,t){t&&I.forEach(t,(i,r)=>this.setProperty(e,r,i))}static toJson(e){var i;if(!e)return null;const t=new Map;return t.set("id",e.id),t.set("accentuated",e.accentuated),t.set("bendtype",e.bendType),t.set("bendstyle",e.bendStyle),t.set("iscontinuedbend",e.isContinuedBend),e.bendPoints!==null&&t.set("bendpoints",(i=e.bendPoints)==null?void 0:i.map(r=>Rh.toJson(r))),t.set("fret",e.fret),t.set("string",e.string),t.set("showstringnumber",e.showStringNumber),t.set("octave",e.octave),t.set("tone",e.tone),t.set("percussionarticulation",e.percussionArticulation),t.set("isvisible",e.isVisible),t.set("islefthandtapped",e.isLeftHandTapped),t.set("ishammerpullorigin",e.isHammerPullOrigin),t.set("isslurdestination",e.isSlurDestination),t.set("harmonictype",e.harmonicType),t.set("harmonicvalue",e.harmonicValue),t.set("isghost",e.isGhost),t.set("isletring",e.isLetRing),t.set("ispalmmute",e.isPalmMute),t.set("isdead",e.isDead),t.set("isstaccato",e.isStaccato),t.set("slideintype",e.slideInType),t.set("slideouttype",e.slideOutType),t.set("vibrato",e.vibrato),t.set("istiedestination",e.isTieDestination),t.set("lefthandfinger",e.leftHandFinger),t.set("righthandfinger",e.rightHandFinger),t.set("isfingering",e.isFingering),t.set("trillvalue",e.trillValue),t.set("trillspeed",e.trillSpeed),t.set("durationpercent",e.durationPercent),t.set("accidentalmode",e.accidentalMode),t.set("dynamics",e.dynamics),e.toJson(t),t}static setProperty(e,t,i){switch(t){case"id":return e.id=i,!0;case"accentuated":return e.accentuated=I.parseEnum(i,et),!0;case"bendtype":return e.bendType=I.parseEnum(i,G),!0;case"bendstyle":return e.bendStyle=I.parseEnum(i,Ee),!0;case"iscontinuedbend":return e.isContinuedBend=i,!0;case"bendpoints":if(i){e.bendPoints=[];for(const r of i){const n=new A;Rh.fromJson(n,r),e.addBendPoint(n)}}return!0;case"fret":return e.fret=i,!0;case"string":return e.string=i,!0;case"showstringnumber":return e.showStringNumber=i,!0;case"octave":return e.octave=i,!0;case"tone":return e.tone=i,!0;case"percussionarticulation":return e.percussionArticulation=i,!0;case"isvisible":return e.isVisible=i,!0;case"islefthandtapped":return e.isLeftHandTapped=i,!0;case"ishammerpullorigin":return e.isHammerPullOrigin=i,!0;case"isslurdestination":return e.isSlurDestination=i,!0;case"harmonictype":return e.harmonicType=I.parseEnum(i,X),!0;case"harmonicvalue":return e.harmonicValue=i,!0;case"isghost":return e.isGhost=i,!0;case"isletring":return e.isLetRing=i,!0;case"ispalmmute":return e.isPalmMute=i,!0;case"isdead":return e.isDead=i,!0;case"isstaccato":return e.isStaccato=i,!0;case"slideintype":return e.slideInType=I.parseEnum(i,vt),!0;case"slideouttype":return e.slideOutType=I.parseEnum(i,ne),!0;case"vibrato":return e.vibrato=I.parseEnum(i,Be),!0;case"istiedestination":return e.isTieDestination=i,!0;case"lefthandfinger":return e.leftHandFinger=I.parseEnum(i,oe),!0;case"righthandfinger":return e.rightHandFinger=I.parseEnum(i,oe),!0;case"isfingering":return e.isFingering=i,!0;case"trillvalue":return e.trillValue=i,!0;case"trillspeed":return e.trillSpeed=I.parseEnum(i,k),!0;case"durationpercent":return e.durationPercent=i,!0;case"accidentalmode":return e.accidentalMode=I.parseEnum(i,ot),!0;case"dynamics":return e.dynamics=I.parseEnum(i,de),!0}return e.setProperty(t,i)}}class vm{static fromJson(e,t){t&&I.forEach(t,(i,r)=>this.setProperty(e,r,i))}static toJson(e){var i;if(!e)return null;const t=new Map;return t.set("id",e.id),t.set("notes",e.notes.map(r=>xm.toJson(r))),t.set("isempty",e.isEmpty),t.set("whammystyle",e.whammyStyle),t.set("ottava",e.ottava),t.set("islegatoorigin",e.isLegatoOrigin),t.set("duration",e.duration),t.set("automations",e.automations.map(r=>Fh.toJson(r))),t.set("dots",e.dots),t.set("fadein",e.fadeIn),t.set("lyrics",e.lyrics),t.set("hasrasgueado",e.hasRasgueado),t.set("pop",e.pop),t.set("slap",e.slap),t.set("tap",e.tap),t.set("text",e.text),t.set("slashed",e.slashed),t.set("brushtype",e.brushType),t.set("brushduration",e.brushDuration),t.set("tupletdenominator",e.tupletDenominator),t.set("tupletnumerator",e.tupletNumerator),t.set("iscontinuedwhammy",e.isContinuedWhammy),t.set("whammybartype",e.whammyBarType),e.whammyBarPoints!==null&&t.set("whammybarpoints",(i=e.whammyBarPoints)==null?void 0:i.map(r=>Rh.toJson(r))),t.set("vibrato",e.vibrato),t.set("chordid",e.chordId),t.set("gracetype",e.graceType),t.set("pickstroke",e.pickStroke),t.set("tremolospeed",e.tremoloSpeed),t.set("crescendo",e.crescendo),t.set("displaystart",e.displayStart),t.set("playbackstart",e.playbackStart),t.set("displayduration",e.displayDuration),t.set("playbackduration",e.playbackDuration),t.set("dynamics",e.dynamics),t.set("invertbeamdirection",e.invertBeamDirection),t.set("preferredbeamdirection",e.preferredBeamDirection),t.set("beamingmode",e.beamingMode),t}static setProperty(e,t,i){switch(t){case"id":return e.id=i,!0;case"notes":e.notes=[];for(const r of i){const n=new je;xm.fromJson(n,r),e.addNote(n)}return!0;case"isempty":return e.isEmpty=i,!0;case"whammystyle":return e.whammyStyle=I.parseEnum(i,Ee),!0;case"ottava":return e.ottava=I.parseEnum(i,Te),!0;case"islegatoorigin":return e.isLegatoOrigin=i,!0;case"duration":return e.duration=I.parseEnum(i,k),!0;case"automations":e.automations=[];for(const r of i){const n=new Vt;Fh.fromJson(n,r),e.automations.push(n)}return!0;case"dots":return e.dots=i,!0;case"fadein":return e.fadeIn=i,!0;case"lyrics":return e.lyrics=i,!0;case"hasrasgueado":return e.hasRasgueado=i,!0;case"pop":return e.pop=i,!0;case"slap":return e.slap=i,!0;case"tap":return e.tap=i,!0;case"text":return e.text=i,!0;case"slashed":return e.slashed=i,!0;case"brushtype":return e.brushType=I.parseEnum(i,Ve),!0;case"brushduration":return e.brushDuration=i,!0;case"tupletdenominator":return e.tupletDenominator=i,!0;case"tupletnumerator":return e.tupletNumerator=i,!0;case"iscontinuedwhammy":return e.isContinuedWhammy=i,!0;case"whammybartype":return e.whammyBarType=I.parseEnum(i,xe),!0;case"whammybarpoints":if(i){e.whammyBarPoints=[];for(const r of i){const n=new A;Rh.fromJson(n,r),e.addWhammyBarPoint(n)}}return!0;case"vibrato":return e.vibrato=I.parseEnum(i,Be),!0;case"chordid":return e.chordId=i,!0;case"gracetype":return e.graceType=I.parseEnum(i,$),!0;case"pickstroke":return e.pickStroke=I.parseEnum(i,At),!0;case"tremolospeed":return e.tremoloSpeed=I.parseEnum(i,k),!0;case"crescendo":return e.crescendo=I.parseEnum(i,ki),!0;case"displaystart":return e.displayStart=i,!0;case"playbackstart":return e.playbackStart=i,!0;case"displayduration":return e.displayDuration=i,!0;case"playbackduration":return e.playbackDuration=i,!0;case"dynamics":return e.dynamics=I.parseEnum(i,de),!0;case"invertbeamdirection":return e.invertBeamDirection=i,!0;case"preferredbeamdirection":return e.preferredBeamDirection=I.parseEnum(i,E),!0;case"beamingmode":return e.beamingMode=I.parseEnum(i,ks),!0}return!1}}class Tm{static fromJson(e,t){t&&I.forEach(t,(i,r)=>this.setProperty(e,r,i))}static toJson(e){if(!e)return null;const t=new Map;return t.set("id",e.id),t.set("beats",e.beats.map(i=>vm.toJson(i))),t.set("isempty",e.isEmpty),t}static setProperty(e,t,i){switch(t){case"id":return e.id=i,!0;case"beats":e.beats=[];for(const r of i){const n=new Wt;vm.fromJson(n,r),e.addBeat(n)}return!0;case"isempty":return e.isEmpty=i,!0}return!1}}class Nm{static fromJson(e,t){t&&I.forEach(t,(i,r)=>this.setProperty(e,r,i))}static toJson(e){if(!e)return null;const t=new Map;return t.set("id",e.id),t.set("clef",e.clef),t.set("clefottava",e.clefOttava),t.set("voices",e.voices.map(i=>Tm.toJson(i))),t.set("similemark",e.simileMark),t.set("displayscale",e.displayScale),t.set("displaywidth",e.displayWidth),t}static setProperty(e,t,i){switch(t){case"id":return e.id=i,!0;case"clef":return e.clef=I.parseEnum(i,ie),!0;case"clefottava":return e.clefOttava=I.parseEnum(i,Te),!0;case"voices":e.voices=[];for(const r of i){const n=new Js;Tm.fromJson(n,r),e.addVoice(n)}return!0;case"similemark":return e.simileMark=I.parseEnum(i,Qi),!0;case"displayscale":return e.displayScale=i,!0;case"displaywidth":return e.displayWidth=i,!0}return!1}}class Pm{static fromJson(e,t){t&&I.forEach(t,(i,r)=>this.setProperty(e,r,i))}static toJson(e){if(!e)return null;const t=new Map;return t.set("name",e.name),t.set("firstfret",e.firstFret),t.set("strings",e.strings),t.set("barrefrets",e.barreFrets),t.set("showname",e.showName),t.set("showdiagram",e.showDiagram),t.set("showfingering",e.showFingering),t}static setProperty(e,t,i){switch(t){case"name":return e.name=i,!0;case"firstfret":return e.firstFret=i,!0;case"strings":return e.strings=i,!0;case"barrefrets":return e.barreFrets=i,!0;case"showname":return e.showName=i,!0;case"showdiagram":return e.showDiagram=i,!0;case"showfingering":return e.showFingering=i,!0}return!1}}class Cm{static fromJson(e,t){t&&I.forEach(t,(i,r)=>this.setProperty(e,r,i))}static toJson(e){if(!e)return null;const t=new Map;return t.set("isstandard",e.isStandard),t.set("name",e.name),t.set("tunings",e.tunings),t}static setProperty(e,t,i){switch(t){case"isstandard":return e.isStandard=i,!0;case"name":return e.name=i,!0;case"tunings":return e.tunings=i,!0}return!1}}class Em{static fromJson(e,t){t&&I.forEach(t,(i,r)=>this.setProperty(e,r,i))}static toJson(e){if(!e)return null;const t=new Map;if(t.set("bars",e.bars.map(i=>Nm.toJson(i))),e.chords!==null){const i=new Map;t.set("chords",i);for(const[r,n]of e.chords)i.set(r.toString(),Pm.toJson(n))}return t.set("capo",e.capo),t.set("transpositionpitch",e.transpositionPitch),t.set("displaytranspositionpitch",e.displayTranspositionPitch),t.set("stringtuning",Cm.toJson(e.stringTuning)),t.set("showslash",e.showSlash),t.set("shownumbered",e.showNumbered),t.set("showtablature",e.showTablature),t.set("showstandardnotation",e.showStandardNotation),t.set("ispercussion",e.isPercussion),t.set("standardnotationlinecount",e.standardNotationLineCount),t}static setProperty(e,t,i){switch(t){case"bars":e.bars=[];for(const r of i){const n=new Sr;Nm.fromJson(n,r),e.addBar(n)}return!0;case"chords":return e.chords=new Map,I.forEach(i,(r,n)=>{const a=new $r;Pm.fromJson(a,r),e.addChord(n,a)}),!0;case"capo":return e.capo=i,!0;case"transpositionpitch":return e.transpositionPitch=i,!0;case"displaytranspositionpitch":return e.displayTranspositionPitch=i,!0;case"showslash":return e.showSlash=i,!0;case"shownumbered":return e.showNumbered=i,!0;case"showtablature":return e.showTablature=i,!0;case"showstandardnotation":return e.showStandardNotation=i,!0;case"ispercussion":return e.isPercussion=i,!0;case"standardnotationlinecount":return e.standardNotationLineCount=i,!0}return["stringtuning"].indexOf(t)>=0?(Cm.fromJson(e.stringTuning,i),!0):!1}}class Lm{static fromJson(e,t){t&&I.forEach(t,(i,r)=>this.setProperty(e,r,i))}static toJson(e){if(!e)return null;const t=new Map;return t.set("volume",e.volume),t.set("balance",e.balance),t.set("port",e.port),t.set("program",e.program),t.set("primarychannel",e.primaryChannel),t.set("secondarychannel",e.secondaryChannel),t.set("ismute",e.isMute),t.set("issolo",e.isSolo),t}static setProperty(e,t,i){switch(t){case"volume":return e.volume=i,!0;case"balance":return e.balance=i,!0;case"port":return e.port=i,!0;case"program":return e.program=i,!0;case"primarychannel":return e.primaryChannel=i,!0;case"secondarychannel":return e.secondaryChannel=i,!0;case"ismute":return e.isMute=i,!0;case"issolo":return e.isSolo=i,!0}return!1}}class Mm{static fromJson(e,t){t&&I.forEach(t,(i,r)=>this.setProperty(e,r,i))}static toJson(e){if(!e)return null;const t=new Map;return t.set("elementtype",e.elementType),t.set("staffline",e.staffLine),t.set("noteheaddefault",e.noteHeadDefault),t.set("noteheadhalf",e.noteHeadHalf),t.set("noteheadwhole",e.noteHeadWhole),t.set("techniquesymbol",e.techniqueSymbol),t.set("techniquesymbolplacement",e.techniqueSymbolPlacement),t.set("outputmidinumber",e.outputMidiNumber),t}static setProperty(e,t,i){switch(t){case"elementtype":return e.elementType=i,!0;case"staffline":return e.staffLine=i,!0;case"noteheaddefault":return e.noteHeadDefault=I.parseEnum(i,f),!0;case"noteheadhalf":return e.noteHeadHalf=I.parseEnum(i,f),!0;case"noteheadwhole":return e.noteHeadWhole=I.parseEnum(i,f),!0;case"techniquesymbol":return e.techniqueSymbol=I.parseEnum(i,f),!0;case"techniquesymbolplacement":return e.techniqueSymbolPlacement=I.parseEnum(i,te),!0;case"outputmidinumber":return e.outputMidiNumber=i,!0}return!1}}class Fm{static fromJson(e,t){t&&I.forEach(t,(i,r)=>this.setProperty(e,r,i))}static toJson(e){if(!e)return null;const t=new Map;return t.set("staves",e.staves.map(i=>Em.toJson(i))),t.set("playbackinfo",Lm.toJson(e.playbackInfo)),t.set("color",Ce.toJson(e.color)),t.set("name",e.name),t.set("isvisibleonmultitrack",e.isVisibleOnMultiTrack),t.set("shortname",e.shortName),t.set("defaultsystemslayout",e.defaultSystemsLayout),t.set("systemslayout",e.systemsLayout),t.set("percussionarticulations",e.percussionArticulations.map(i=>Mm.toJson(i))),t}static setProperty(e,t,i){switch(t){case"staves":e.staves=[];for(const r of i){const n=new Pw;Em.fromJson(n,r),e.addStaff(n)}return!0;case"color":return e.color=Ce.fromJson(i),!0;case"name":return e.name=i,!0;case"isvisibleonmultitrack":return e.isVisibleOnMultiTrack=i,!0;case"shortname":return e.shortName=i,!0;case"defaultsystemslayout":return e.defaultSystemsLayout=i,!0;case"systemslayout":return e.systemsLayout=i,!0;case"percussionarticulations":e.percussionArticulations=[];for(const r of i){const n=new O;Mm.fromJson(n,r),e.percussionArticulations.push(n)}return!0}return["playbackinfo"].indexOf(t)>=0?(Lm.fromJson(e.playbackInfo,i),!0):!1}}class Rm{static fromJson(e,t){t&&I.forEach(t,(i,r)=>this.setProperty(e,r,i))}static toJson(e){if(!e)return null;const t=new Map;return t.set("hidedynamics",e.hideDynamics),t}static setProperty(e,t,i){switch(t){case"hidedynamics":return e.hideDynamics=i,!0}return!1}}class Dm{static fromJson(e,t){t&&I.forEach(t,(i,r)=>this.setProperty(e,r,i))}static toJson(e){if(!e)return null;const t=new Map;return t.set("album",e.album),t.set("artist",e.artist),t.set("copyright",e.copyright),t.set("instructions",e.instructions),t.set("music",e.music),t.set("notices",e.notices),t.set("subtitle",e.subTitle),t.set("title",e.title),t.set("words",e.words),t.set("tab",e.tab),t.set("tempo",e.tempo),t.set("tempolabel",e.tempoLabel),t.set("masterbars",e.masterBars.map(i=>Bm.toJson(i))),t.set("tracks",e.tracks.map(i=>Fm.toJson(i))),t.set("defaultsystemslayout",e.defaultSystemsLayout),t.set("systemslayout",e.systemsLayout),t.set("stylesheet",Rm.toJson(e.stylesheet)),t}static setProperty(e,t,i){switch(t){case"album":return e.album=i,!0;case"artist":return e.artist=i,!0;case"copyright":return e.copyright=i,!0;case"instructions":return e.instructions=i,!0;case"music":return e.music=i,!0;case"notices":return e.notices=i,!0;case"subtitle":return e.subTitle=i,!0;case"title":return e.title=i,!0;case"words":return e.words=i,!0;case"tab":return e.tab=i,!0;case"tempo":return e.tempo=i,!0;case"tempolabel":return e.tempoLabel=i,!0;case"masterbars":e.masterBars=[];for(const r of i){const n=new mr;Bm.fromJson(n,r),e.addMasterBar(n)}return!0;case"tracks":e.tracks=[];for(const r of i){const n=new Qs;Fm.fromJson(n,r),e.addTrack(n)}return!0;case"defaultsystemslayout":return e.defaultSystemsLayout=i,!0;case"systemslayout":return e.systemsLayout=i,!0}return["stylesheet"].indexOf(t)>=0?(Rm.fromJson(e.stylesheet,i),!0):!1}}class at{static jsonReplacer(e,t){if(t instanceof Map){if("fromEntries"in Object)return Object.fromEntries(t);{const i={};for(const[r,n]of t)i[r]=n;return i}}else if(ArrayBuffer.isView(t))return Array.apply([],[t]);return t}static scoreToJson(e){let t=at.scoreToJsObject(e);return JSON.stringify(t,at.jsonReplacer)}static jsonToScore(e,t){return at.jsObjectToScore(JSON.parse(e),t)}static scoreToJsObject(e){return Dm.toJson(e)}static jsObjectToScore(e,t){let i=new Rn;return Dm.fromJson(i,e),i.finish(t??new vn),i}static settingsToJson(e){let t=at.settingsToJsObject(e);return JSON.stringify(t,at.jsonReplacer)}static jsonToSettings(e){return at.jsObjectToSettings(JSON.parse(e))}static settingsToJsObject(e){return Sa.toJson(e)}static jsObjectToSettings(e){let t=new vn;return Sa.fromJson(t,e),t}static jsObjectToMidiFile(e){let t=new zr;return I.forEach(e,(i,r)=>{switch(r){case"division":t.division=i;break;case"tracks":for(let n of i){let a=at.jsObjectToMidiTrack(n);t.tracks.push(a)}break}}),t}static jsObjectToMidiTrack(e){let t=new Mw;return I.forEach(e,(i,r)=>{switch(r){case"events":for(let n of i){let a=at.jsObjectToMidiEvent(n);t.events.push(a)}break}}),t}static jsObjectToMidiEvent(e){let t=I.getValue(e,"track"),i=I.getValue(e,"tick"),r=I.getValue(e,"type");switch(r){case ye.TimeSignature:return new Fw(t,i,I.getValue(e,"numerator"),I.getValue(e,"denominatorIndex"),I.getValue(e,"midiClocksPerMetronomeClick"),I.getValue(e,"thirdySecondNodesInQuarter"));case ye.AlphaTabRest:return new Dw(t,i,I.getValue(e,"channel"));case ye.AlphaTabMetronome:return new Rw(t,i,I.getValue(e,"metronomeNumerator"),I.getValue(e,"metronomeDurationInTicks"),I.getValue(e,"metronomeDurationInMilliseconds"));case ye.NoteOn:return new Iw(t,i,I.getValue(e,"channel"),I.getValue(e,"noteKey"),I.getValue(e,"noteVelocity"));case ye.NoteOff:return new Ow(t,i,I.getValue(e,"channel"),I.getValue(e,"noteKey"),I.getValue(e,"noteVelocity"));case ye.ControlChange:return new Vw(t,i,I.getValue(e,"channel"),I.getValue(e,"controller"),I.getValue(e,"value"));case ye.ProgramChange:return new Hw(t,i,I.getValue(e,"channel"),I.getValue(e,"program"));case ye.TempoChange:return new Ww(i,I.getValue(e,"microSecondsPerQuarterNote"));case ye.PitchBend:return new zw(t,i,I.getValue(e,"channel"),I.getValue(e,"value"));case ye.PerNotePitchBend:return new Gw(t,i,I.getValue(e,"channel"),I.getValue(e,"noteKey"),I.getValue(e,"value"));case ye.EndOfTrack:return new Uw(t,i)}throw new Pt(Nt.Format,"Unknown Midi Event type: "+r)}static midiFileToJsObject(e){const t=new Map;t.set("division",e.division);const i=[];for(let r of e.tracks)i.push(at.midiTrackToJsObject(r));return t.set("tracks",i),t}static midiTrackToJsObject(e){const t=new Map,i=[];for(let r of e.events)i.push(at.midiEventToJsObject(r));return t.set("events",i),t}static midiEventToJsObject(e){const t=new Map;switch(t.set("track",e.track),t.set("tick",e.tick),t.set("type",e.type),e.type){case ye.TimeSignature:t.set("numerator",e.numerator),t.set("denominatorIndex",e.denominatorIndex),t.set("midiClocksPerMetronomeClick",e.midiClocksPerMetronomeClick),t.set("thirdySecondNodesInQuarter",e.thirtySecondNodesInQuarter);break;case ye.AlphaTabRest:t.set("channel",e.channel);break;case ye.AlphaTabMetronome:t.set("metronomeNumerator",e.metronomeNumerator),t.set("metronomeDurationInMilliseconds",e.metronomeDurationInMilliseconds),t.set("metronomeDurationInTicks",e.metronomeDurationInTicks);break;case ye.NoteOn:case ye.NoteOff:t.set("channel",e.channel),t.set("noteKey",e.noteKey),t.set("noteVelocity",e.noteVelocity);break;case ye.ControlChange:t.set("channel",e.channel),t.set("controller",e.controller),t.set("value",e.value);break;case ye.ProgramChange:t.set("channel",e.channel),t.set("program",e.program);break;case ye.TempoChange:t.set("microSecondsPerQuarterNote",e.microSecondsPerQuarterNote);break;case ye.PitchBend:t.set("channel",e.channel),t.set("value",e.value);break;case ye.PerNotePitchBend:t.set("channel",e.channel),t.set("noteKey",e.noteKey),t.set("value",e.value);break;case ye.EndOfTrack:break}return t}}class He{constructor(){this.ready=new kt,this.samplesPlayed=new Se,this.sampleRequest=new kt}get sampleRate(){return He.preferredSampleRate}open(){C.debug("AlphaSynth","Initializing synth worker"),this._worker=T.globalThis,this._worker.addEventListener("message",this.handleMessage.bind(this)),this.ready.trigger()}destroy(){this._worker.postMessage({cmd:"alphaSynth.output.destroy"})}handleMessage(e){let t=e.data;switch(t.cmd){case He.CmdOutputSampleRequest:this.sampleRequest.trigger();break;case He.CmdOutputSamplesPlayed:this.samplesPlayed.trigger(t.samples);break}}addSamples(e){this._worker.postMessage({cmd:"alphaSynth.output.addSamples",samples:e})}play(){this._worker.postMessage({cmd:"alphaSynth.output.play"})}pause(){this._worker.postMessage({cmd:"alphaSynth.output.pause"})}resetSamples(){this._worker.postMessage({cmd:"alphaSynth.output.resetSamples"})}activate(){}}He.CmdOutputPrefix="alphaSynth.output.";He.CmdOutputAddSamples=He.CmdOutputPrefix+"addSamples";He.CmdOutputPlay=He.CmdOutputPrefix+"play";He.CmdOutputPause=He.CmdOutputPrefix+"pause";He.CmdOutputResetSamples=He.CmdOutputPrefix+"resetSamples";He.CmdOutputStop=He.CmdOutputPrefix+"stop";He.CmdOutputSampleRequest=He.CmdOutputPrefix+"sampleRequest";He.CmdOutputSamplesPlayed=He.CmdOutputPrefix+"samplesPlayed";He.preferredSampleRate=0;class lp{constructor(e,t){this._main=e,this._main.addEventListener("message",this.handleMessage.bind(this)),this._player=new Yw(new He,t),this._player.positionChanged.on(this.onPositionChanged.bind(this)),this._player.stateChanged.on(this.onPlayerStateChanged.bind(this)),this._player.finished.on(this.onFinished.bind(this)),this._player.soundFontLoaded.on(this.onSoundFontLoaded.bind(this)),this._player.soundFontLoadFailed.on(this.onSoundFontLoadFailed.bind(this)),this._player.soundFontLoadFailed.on(this.onSoundFontLoadFailed.bind(this)),this._player.midiLoaded.on(this.onMidiLoaded.bind(this)),this._player.midiLoadFailed.on(this.onMidiLoadFailed.bind(this)),this._player.readyForPlayback.on(this.onReadyForPlayback.bind(this)),this._player.midiEventsPlayed.on(this.onMidiEventsPlayed.bind(this)),this._player.playbackRangeChanged.on(this.onPlaybackRangeChanged.bind(this)),this._main.postMessage({cmd:"alphaSynth.ready"})}static init(){let e=T.globalThis;e.addEventListener("message",t=>{let i=t.data;switch(i.cmd){case"alphaSynth.initialize":He.preferredSampleRate=i.sampleRate,C.logLevel=i.logLevel,T.globalThis.alphaSynthWebWorker=new lp(e,i.bufferTimeInMilliseconds);break}})}handleMessage(e){let t=e.data;switch(t.cmd){case"alphaSynth.setLogLevel":C.logLevel=t.value;break;case"alphaSynth.setMasterVolume":this._player.masterVolume=t.value;break;case"alphaSynth.setMetronomeVolume":this._player.metronomeVolume=t.value;break;case"alphaSynth.setPlaybackSpeed":this._player.playbackSpeed=t.value;break;case"alphaSynth.setTickPosition":this._player.tickPosition=t.value;break;case"alphaSynth.setTimePosition":this._player.timePosition=t.value;break;case"alphaSynth.setPlaybackRange":this._player.playbackRange=t.value;break;case"alphaSynth.setIsLooping":this._player.isLooping=t.value;break;case"alphaSynth.setCountInVolume":this._player.countInVolume=t.value;break;case"alphaSynth.setMidiEventsPlayedFilter":this._player.midiEventsPlayedFilter=t.value;break;case"alphaSynth.play":this._player.play();break;case"alphaSynth.pause":this._player.pause();break;case"alphaSynth.playPause":this._player.playPause();break;case"alphaSynth.stop":this._player.stop();break;case"alphaSynth.playOneTimeMidiFile":this._player.playOneTimeMidiFile(at.jsObjectToMidiFile(t.midi));break;case"alphaSynth.loadSoundFontBytes":this._player.loadSoundFont(t.data,t.append);break;case"alphaSynth.resetSoundFonts":this._player.resetSoundFonts();break;case"alphaSynth.loadMidi":this._player.loadMidiFile(at.jsObjectToMidiFile(t.midi));break;case"alphaSynth.setChannelMute":this._player.setChannelMute(t.channel,t.mute);break;case"alphaSynth.setChannelTranspositionPitch":this._player.setChannelTranspositionPitch(t.channel,t.semitones);break;case"alphaSynth.setChannelSolo":this._player.setChannelSolo(t.channel,t.solo);break;case"alphaSynth.setChannelVolume":this._player.setChannelVolume(t.channel,t.volume);break;case"alphaSynth.resetChannelStates":this._player.resetChannelStates();break;case"alphaSynth.destroy":this._player.destroy(),this._main.postMessage({cmd:"alphaSynth.destroyed"});break;case"alphaSynth.applyTranspositionPitches":this._player.applyTranspositionPitches(new Map(JSON.parse(t.transpositionPitches)));break}}onPositionChanged(e){this._main.postMessage({cmd:"alphaSynth.positionChanged",currentTime:e.currentTime,endTime:e.endTime,currentTick:e.currentTick,endTick:e.endTick,isSeek:e.isSeek})}onPlayerStateChanged(e){this._main.postMessage({cmd:"alphaSynth.playerStateChanged",state:e.state,stopped:e.stopped})}onFinished(){this._main.postMessage({cmd:"alphaSynth.finished"})}onSoundFontLoaded(){this._main.postMessage({cmd:"alphaSynth.soundFontLoaded"})}onSoundFontLoadFailed(e){this._main.postMessage({cmd:"alphaSynth.soundFontLoadFailed",error:this.serializeException(e)})}serializeException(e){let t=JSON.parse(JSON.stringify(e));return e.message&&(t.message=e.message),e.stack&&(t.stack=e.stack),e.constructor&&e.constructor.name&&(t.type=e.constructor.name),t}onMidiLoaded(e){this._main.postMessage({cmd:"alphaSynth.midiLoaded",currentTime:e.currentTime,endTime:e.endTime,currentTick:e.currentTick,endTick:e.endTick,isSeek:e.isSeek})}onMidiLoadFailed(e){this._main.postMessage({cmd:"alphaSynth.midiLoaded",error:this.serializeException(e)})}onReadyForPlayback(){this._main.postMessage({cmd:"alphaSynth.readyForPlayback"})}onMidiEventsPlayed(e){this._main.postMessage({cmd:"alphaSynth.midiEventsPlayed",events:e.events.map(at.midiEventToJsObject)})}onPlaybackRangeChanged(e){this._main.postMessage({cmd:"alphaSynth.playbackRangeChanged",playbackRange:e.playbackRange})}}var Ei;(function(s){s[s.Browser=0]="Browser",s[s.NodeJs=1]="NodeJs",s[s.BrowserModule=2]="BrowserModule"})(Ei||(Ei={}));class Am{constructor(e,t){this.characterWidths=e,this.fontSizeToHeight=t}}class Yt{static generateFontLookup(e){if(!Yt.FontSizeLookupTables.has(e))if(!T.isRunningInWorker&&T.webPlatform!=Ei.NodeJs){let i=document.createElement("canvas").getContext("2d");const r=11;i.font=`${r}px ${e}`;const n=[];let a="";for(let d=Yt.ControlChars;d<255;d++){let p=String.fromCharCode(d);a+=p;const g=i.measureText(p);n.push(g.width)}const o=i.measureText(a+"ÄÖÜÁÈ"),l=0-Math.abs(o.fontBoundingBoxAscent),u=0+Math.abs(o.fontBoundingBoxDescent)-l,c=new Am(new Uint8Array(n),u/r);Yt.FontSizeLookupTables.set(e,c)}else{const t=new Am(new Uint8Array([8]),1.2);Yt.FontSizeLookupTables.set(e,t)}}static measureString(e,t,i,r,n){let a,o=11,l=t[0];for(let c=0;c<t.length;c++)if(Yt.FontSizeLookupTables.has(t[c])){l=t[c];break}Yt.FontSizeLookupTables.has(l)||Yt.generateFontLookup(l),a=Yt.FontSizeLookupTables.get(l);let h=1;r===Ue.Italic&&(h*=1.1),n===Ci.Bold&&(h*=1.1);let u=0;for(let c=0;c<e.length;c++){let d=Math.min(a.characterWidths.length-1,e.charCodeAt(c)-Yt.ControlChars);d>=0&&(u+=a.characterWidths[d]*i/o)}return h*=1.07,new Bu(u*h,i*a.fontSizeToHeight)}}Yt.FontSizeLookupTables=new Map;Yt.ControlChars=32;class cn{constructor(){this.id=Re.newGuid(),this.x=0,this.y=0,this.width=0,this.height=0,this.totalWidth=0,this.totalHeight=0,this.firstMasterBarIndex=-1,this.lastMasterBarIndex=-1,this.renderResult=null}}class Xw{constructor(){this.beats=[]}addBeat(e){e.barBounds=this,this.beats.push(e),this.masterBarBounds.addBeat(e)}findBeatAtPos(e){let t=null;for(let i of this.beats)if(!t||i.realBounds.x<e)t=i;else if(i.realBounds.x>e)break;return t}finish(){this.beats.sort((e,t)=>e.realBounds.x-t.realBounds.x)}}class Qw{constructor(){this.notes=null}addNote(e){this.notes||(this.notes=[]),e.beatBounds=this,this.notes.push(e)}findNoteAtPos(e,t){const i=this.notes;if(!i)return null;for(let r of i){let n=r.noteHeadBounds.y+r.noteHeadBounds.h,a=r.noteHeadBounds.x+r.noteHeadBounds.w;if(r.noteHeadBounds.x<=e&&r.noteHeadBounds.y<=t&&e<=a&&t<=n)return r.note}return null}}class Jw{constructor(){this.index=0,this.isFirstOfLine=!1,this.bars=[],this.staffSystemBounds=null}get staveGroupBounds(){return this.staffSystemBounds}addBar(e){e.masterBarBounds=this,this.bars.push(e)}findBeatAtPos(e,t){let i=null,r=1e7;for(let n of this.bars){let a=n.findBeatAtPos(e);if(a&&(!i||i.realBounds.x<a.realBounds.x)){const o=Math.abs(a.realBounds.x-e);(!i||o<r)&&(i=a)}}return i?i.beat:null}finish(){this.bars.sort((e,t)=>e.realBounds.y<t.realBounds.y?-1:e.realBounds.y>t.realBounds.y?1:e.realBounds.x<t.realBounds.x?-1:e.realBounds.x>t.realBounds.x?1:0);for(const e of this.bars)e.finish()}addBeat(e){this.staffSystemBounds.boundsLookup.addBeat(e)}}class al{}class qw{constructor(){this.index=0,this.bars=[]}finish(){for(let e of this.bars)e.finish()}addBar(e){this.boundsLookup.addMasterBar(e),e.staffSystemBounds=this,this.bars.push(e)}findBarAtPos(e){let t=null;for(let i of this.bars)if(!t||i.realBounds.x<e)t=i;else if(e>i.realBounds.x+i.realBounds.w)break;return t}}class zo{constructor(){this._beatLookup=new Map,this._masterBarLookup=new Map,this._currentStaffSystem=null,this.staffSystems=[],this.isFinished=!1}toJson(){let e={},t=[];e.staffSystems=t;for(let i of this.staffSystems){let r={};r.visualBounds=this.boundsToJson(i.visualBounds),r.realBounds=this.boundsToJson(i.realBounds),r.bars=[];for(let n of i.bars){let a={};a.lineAlignedBounds=this.boundsToJson(n.lineAlignedBounds),a.visualBounds=this.boundsToJson(n.visualBounds),a.realBounds=this.boundsToJson(n.realBounds),a.index=n.index,a.bars=[];for(let o of n.bars){let l={};l.visualBounds=this.boundsToJson(o.visualBounds),l.realBounds=this.boundsToJson(o.realBounds),l.beats=[];for(let h of o.beats){let u={};u.visualBounds=this.boundsToJson(h.visualBounds),u.realBounds=this.boundsToJson(h.realBounds);let c=u;if(c.beatIndex=h.beat.index,c.voiceIndex=h.beat.voice.index,c.barIndex=h.beat.voice.bar.index,c.staffIndex=h.beat.voice.bar.staff.index,c.trackIndex=h.beat.voice.bar.staff.track.index,h.notes){let d=u.notes=[];for(let p of h.notes){let g={},w=g;w.index=p.note.index,g.noteHeadBounds=this.boundsToJson(p.noteHeadBounds),d.push(g)}}l.beats.push(u)}a.bars.push(l)}r.bars.push(a)}t.push(r)}return e}static fromJson(e,t){let i=new zo,r=e.staffSystems;for(let n of r){let a=new qw;a.visualBounds=n.visualBounds,a.realBounds=n.realBounds,i.addStaffSystem(a);for(let o of n.bars){let l=new Jw;l.index=o.index,l.isFirstOfLine=o.isFirstOfLine,l.lineAlignedBounds=o.lineAlignedBounds,l.visualBounds=o.visualBounds,l.realBounds=o.realBounds,a.addBar(l);for(let h of o.bars){let u=new Xw;u.visualBounds=h.visualBounds,u.realBounds=h.realBounds,l.addBar(u);for(let c of h.beats){let d=new Qw;d.visualBounds=c.visualBounds,d.realBounds=c.realBounds;let p=c;if(d.beat=t.tracks[p.trackIndex].staves[p.staffIndex].bars[p.barIndex].voices[p.voiceIndex].beats[p.beatIndex],c.notes){d.notes=[];for(let g of c.notes){let w=new al,S=g;w.note=d.beat.notes[S.index],w.noteHeadBounds=g.noteHeadBounds,d.addNote(w)}}u.addBeat(d)}}}}return i}boundsToJson(e){let t={};return t.x=e.x,t.y=e.y,t.w=e.w,t.h=e.h,t}finish(){for(let e of this.staffSystems)e.finish();this.isFinished=!0}addStaffSystem(e){e.index=this.staffSystems.length,e.boundsLookup=this,this.staffSystems.push(e),this._currentStaffSystem=e}addMasterBar(e){e.staffSystemBounds?this._masterBarLookup.set(e.index,e):(e.staffSystemBounds=this._currentStaffSystem,this._masterBarLookup.set(e.index,e),this._currentStaffSystem.addBar(e))}addBeat(e){var t;this._beatLookup.has(e.beat.id)||this._beatLookup.set(e.beat.id,[]),(t=this._beatLookup.get(e.beat.id))==null||t.push(e)}findMasterBarByIndex(e){return this._masterBarLookup.has(e)?this._masterBarLookup.get(e):null}findMasterBar(e){let t=e.index;return this._masterBarLookup.has(t)?this._masterBarLookup.get(t):null}findBeat(e){const t=this.findBeats(e);return t?t[0]:null}findBeats(e){let t=e.id;return this._beatLookup.has(t)?this._beatLookup.get(t):null}getBeatAtPos(e,t){let i=0,r=this.staffSystems.length-1,n=-1;for(;i<=r;){let l=(r+i)/2|0,h=this.staffSystems[l];if(t>=h.realBounds.y&&t<=h.realBounds.y+h.realBounds.h){n=l;break}t<h.realBounds.y?r=l-1:i=l+1}if(n===-1)return null;let o=this.staffSystems[n].findBarAtPos(e);return o?o.findBeatAtPos(e,t):null}getNoteAtPos(e,t,i){const r=this.findBeats(e);if(r)for(const n of r){const a=n.findNoteAtPos(t,i);if(a)return a}return null}}class Kw{constructor(e){this._currentLayoutMode=ur.Page,this._currentRenderEngine=null,this._renderedTracks=null,this.canvas=null,this.score=null,this.tracks=null,this.layout=null,this.boundsLookup=null,this.width=0,this.preRender=new Se,this.renderFinished=new Se,this.partialRenderFinished=new Se,this.partialLayoutFinished=new Se,this.postRenderFinished=new kt,this.error=new Se,this.settings=e,this.recreateCanvas(),this.recreateLayout()}destroy(){var e;this.score=null,(e=this.canvas)==null||e.destroy(),this.canvas=null,this.layout=null,this.boundsLookup=null,this.tracks=null}recreateCanvas(){var e;return this._currentRenderEngine!==this.settings.core.engine?((e=this.canvas)==null||e.destroy(),this.canvas=T.getRenderEngineFactory(this.settings.core.engine).createCanvas(),this._currentRenderEngine=this.settings.core.engine,!0):!1}recreateLayout(){return!this.layout||this._currentLayoutMode!==this.settings.display.layoutMode?(this.layout=T.getLayoutEngineFactory(this.settings.display.layoutMode).createLayout(this),this._currentLayoutMode=this.settings.display.layoutMode,!0):!1}renderScore(e,t){try{this.score=e;let i=null;if(e!=null&&t!=null){if(!t)i=e.tracks.slice(0);else{i=[];for(let r of t)r>=0&&r<e.tracks.length&&i.push(e.tracks[r])}i.length===0&&e.tracks.length>0&&i.push(e.tracks[0])}this.tracks=i,this.render()}catch(i){this.error.trigger(i)}}renderTracks(e){e.length===0?this.score=null:this.score=e[0].score,this.tracks=e,this.render()}updateSettings(e){this.settings=e}renderResult(e){try{const t=this.layout;t?(C.debug("Rendering","Request render of lazy partial "+e),t.renderLazyPartial(e)):C.warning("Rendering","Request render of lazy partial "+e+" ignored, no layout exists")}catch(t){this.error.trigger(t)}}render(){if(this.width===0){C.warning("Rendering","AlphaTab skipped rendering because of width=0 (element invisible)",null);return}if(this.boundsLookup=new zo,this.recreateCanvas(),this.canvas.lineWidth=this.settings.display.scale,this.canvas.settings=this.settings,!this.tracks||this.tracks.length===0||!this.score)C.debug("Rendering","Clearing rendered tracks because no score or tracks are set"),this.preRender.trigger(!1),this._renderedTracks=null,this.onRenderFinished(),this.postRenderFinished.trigger(),C.debug("Rendering","Clearing finished");else{C.debug("Rendering","Rendering "+this.tracks.length+" tracks");for(let e=0;e<this.tracks.length;e++){let t=this.tracks[e];C.debug("Rendering","Track "+e+": "+t.name)}this.preRender.trigger(!1),this.recreateLayout(),this.layoutAndRender(),C.debug("Rendering","Rendering finished")}}resizeRender(){this.recreateLayout()||this.recreateCanvas()||this._renderedTracks!==this.tracks||!this.tracks?(C.debug("Rendering","Starting full rerendering due to layout or canvas change",null),this.render()):this.layout.supportsResize?(C.debug("Rendering","Starting optimized rerendering for resize"),this.boundsLookup=new zo,this.preRender.trigger(!0),this.canvas.settings=this.settings,this.layout.resize(),this.onRenderFinished(),this.postRenderFinished.trigger()):C.debug("Rendering","Current layout does not support dynamic resizing, nothing was done",null),C.debug("Rendering","Resize finished")}layoutAndRender(){C.debug("Rendering","Rendering at scale "+this.settings.display.scale+" with layout "+this.layout.name,null),this.layout.layoutAndRender(),this._renderedTracks=this.tracks,this.onRenderFinished(),this.postRenderFinished.trigger()}onRenderFinished(){var t;(t=this.boundsLookup)==null||t.finish();const e=new cn;e.totalHeight=this.layout.height,e.totalWidth=this.layout.width,e.renderResult=this.canvas.onRenderFinished(),this.renderFinished.trigger(e)}}class hp{constructor(e){this._main=e,this._main.addEventListener("message",this.handleMessage.bind(this),!1)}static init(){T.globalThis.alphaTabWebWorker=new hp(T.globalThis)}handleMessage(e){let t=e.data;switch(t?t.cmd:""){case"alphaTab.initialize":let r=at.jsObjectToSettings(t.settings);C.logLevel=r.core.logLevel,this._renderer=new Kw(r),this._renderer.partialRenderFinished.on(a=>{this._main.postMessage({cmd:"alphaTab.partialRenderFinished",result:a})}),this._renderer.partialLayoutFinished.on(a=>{this._main.postMessage({cmd:"alphaTab.partialLayoutFinished",result:a})}),this._renderer.renderFinished.on(a=>{this._main.postMessage({cmd:"alphaTab.renderFinished",result:a})}),this._renderer.postRenderFinished.on(()=>{var a;this._main.postMessage({cmd:"alphaTab.postRenderFinished",boundsLookup:((a=this._renderer.boundsLookup)==null?void 0:a.toJson())??null})}),this._renderer.preRender.on(a=>{this._main.postMessage({cmd:"alphaTab.preRender",resize:a})}),this._renderer.error.on(this.error.bind(this));break;case"alphaTab.invalidate":this._renderer.render();break;case"alphaTab.resizeRender":this._renderer.resizeRender();break;case"alphaTab.renderResult":this._renderer.renderResult(t.resultId);break;case"alphaTab.setWidth":this._renderer.width=t.width;break;case"alphaTab.renderScore":this.updateFontSizes(t.fontSizes);let n=t.score==null?null:at.jsObjectToScore(t.score,this._renderer.settings);this.renderMultiple(n,t.trackIndexes);break;case"alphaTab.updateSettings":this.updateSettings(t.settings);break}}updateFontSizes(e){if(!(e instanceof Map)){const t=e;e=new Map;for(const i in t)e.set(i,t[i])}if(e){Yt.FontSizeLookupTables||(Yt.FontSizeLookupTables=new Map);for(let[t,i]of e)Yt.FontSizeLookupTables.set(t,i)}}updateSettings(e){Sa.fromJson(this._renderer.settings,e)}renderMultiple(e,t){try{this._renderer.renderScore(e,t)}catch(i){this.error(i)}}error(e){C.error("Worker","An unexpected error occurred in worker",e),this._main.postMessage({cmd:"alphaTab.error",error:e})}}class wv{constructor(){this._canvas=null,this._color=new Ce(0,0,0,255),this._font=new he("Arial",10,Ue.Plain),this._lineWidth=0;let e=document.createElement("span");e.classList.add("at"),document.body.appendChild(e);let t=window.getComputedStyle(e),i=t.fontFamily;(i.startsWith('"')||i.startsWith("'"))&&(i=i.substr(1,i.length-2)),this._musicFont=new he(i,parseFloat(t.fontSize),Ue.Plain),this._measureCanvas=document.createElement("canvas"),this._measureCanvas.width=10,this._measureCanvas.height=10,this._measureCanvas.style.width="10px",this._measureCanvas.style.height="10px",this._measureContext=this._measureCanvas.getContext("2d"),this._measureContext.textBaseline="hanging"}destroy(){}onRenderFinished(){return null}beginRender(e,t){this._canvas=document.createElement("canvas"),this._canvas.width=e*T.HighDpiFactor|0,this._canvas.height=t*T.HighDpiFactor|0,this._canvas.style.width=e+"px",this._canvas.style.height=t+"px",this._context=this._canvas.getContext("2d"),this._context.textBaseline="hanging",this._context.scale(T.HighDpiFactor,T.HighDpiFactor),this._context.lineWidth=this._lineWidth}endRender(){let e=this._canvas;return this._canvas=null,e}get color(){return this._color}set color(e){this._color.rgba!==e.rgba&&(this._color=e,this._context.strokeStyle=e.rgba,this._context.fillStyle=e.rgba)}get lineWidth(){return this._lineWidth}set lineWidth(e){this._lineWidth=e,this._context&&(this._context.lineWidth=e)}fillRect(e,t,i,r){i>0&&this._context.fillRect(e|0,t|0,i,r)}strokeRect(e,t,i,r){this._context.strokeRect(e|0,t|0,i,r)}beginPath(){this._context.beginPath()}closePath(){this._context.closePath()}moveTo(e,t){this._context.moveTo(e,t)}lineTo(e,t){this._context.lineTo(e,t)}quadraticCurveTo(e,t,i,r){this._context.quadraticCurveTo(e,t,i,r)}bezierCurveTo(e,t,i,r,n,a){this._context.bezierCurveTo(e,t,i,r,n,a)}fillCircle(e,t,i){this._context.beginPath(),this._context.arc(e,t,i,0,Math.PI*2,!0),this.fill()}strokeCircle(e,t,i){this._context.beginPath(),this._context.arc(e,t,i,0,Math.PI*2,!0),this.stroke()}fill(){this._context.fill(),this._context.beginPath()}stroke(){this._context.stroke(),this._context.beginPath()}get font(){return this._font}set font(e){this._font=e,this._context&&(this._context.font=e.toCssString(this.settings.display.scale)),this._measureContext.font=e.toCssString(this.settings.display.scale)}get textAlign(){switch(this._context.textAlign){case"left":return Y.Left;case"center":return Y.Center;case"right":return Y.Right;default:return Y.Left}}set textAlign(e){switch(e){case Y.Left:this._context.textAlign="left";break;case Y.Center:this._context.textAlign="center";break;case Y.Right:this._context.textAlign="right";break}}get textBaseline(){switch(this._context.textBaseline){case"hanging":return te.Top;case"middle":return te.Middle;case"bottom":return te.Bottom;default:return te.Top}}set textBaseline(e){switch(e){case te.Top:this._context.textBaseline="hanging";break;case te.Middle:this._context.textBaseline="middle";break;case te.Bottom:this._context.textBaseline="bottom";break}}beginGroup(e){}endGroup(){}fillText(e,t,i){this._context.fillText(e,t,i)}measureText(e){const t=this._measureContext.measureText(e);return new Bu(t.width,t.actualBoundingBoxDescent-t.actualBoundingBoxAscent)}fillMusicFontSymbol(e,t,i,r,n=!1){r!==f.None&&this.fillMusicFontSymbolText(e,t,i,String.fromCharCode(r),n)}fillMusicFontSymbols(e,t,i,r,n=!1){let a="";for(let o of r)o!==f.None&&(a+=String.fromCharCode(o));this.fillMusicFontSymbolText(e,t,i,a,n)}fillMusicFontSymbolText(e,t,i,r,n=!1){let a=this._context.textAlign,o=this._context.textBaseline,l=this._context.font;this._context.font=this._musicFont.toCssString(i),this._context.textBaseline="middle",n?this._context.textAlign="center":this._context.textAlign="left",this._context.fillText(r,e,t),this._context.textBaseline=o,this._context.font=l,this._context.textAlign=a}beginRotate(e,t,i){this._context.save(),this._context.translate(e,t),this._context.rotate(i*Math.PI/180)}endRotate(){this._context.restore()}}class Ws{constructor(e,t=!1){this._midiFile=e,this._smf1Mode=t}addTimeSignature(e,t,i){let r=0,n=i;for(;n=n>>1,n>0;)r++;this._midiFile.addEvent(new Fw(0,e,t,r,48,8))}addRest(e,t,i){this._smf1Mode||this._midiFile.addEvent(new Dw(e,t,i))}addNote(e,t,i,r,n,a){this._midiFile.addEvent(new Iw(e,t,a,Ws.fixValue(r),Ws.fixValue(n))),this._midiFile.addEvent(new Ow(e,t+i,a,Ws.fixValue(r),Ws.fixValue(n)))}static fixValue(e){return e>127?127:e<0?0:e}addControlChange(e,t,i,r,n){this._midiFile.addEvent(new Vw(e,t,i,r,Ws.fixValue(n)))}addProgramChange(e,t,i,r){this._midiFile.addEvent(new Hw(e,t,i,r))}addTempo(e,t){const i=6e7/t|0;this._midiFile.addEvent(new Ww(e,i))}addBend(e,t,i,r){r>=le.MaxPitchWheel?r=le.MaxPitchWheel:r=Math.floor(r),this._midiFile.addEvent(new zw(e,t,i,r))}addNoteBend(e,t,i,r,n){this._smf1Mode?this.addBend(e,t,i,n):(n=n*le.MaxPitchWheel20/le.MaxPitchWheel,this._midiFile.addEvent(new Gw(e,t,i,r,n)))}finishTrack(e,t){(this._midiFile.format==ba.MultiTrack||e==0)&&this._midiFile.addEvent(new Uw(e,t))}}class bv{constructor(e,t){this.closingIndex=0,this.group=e,this.opening=t,e.closings=e.closings.sort((i,r)=>i.index-r.index),this.iterations=e.closings.map(i=>0)}}class Sv{get finished(){return this.index>=this._score.masterBars.length}constructor(e){this._repeatStack=[],this._groupsOnStack=new Set,this._previousAlternateEndings=0,this.shouldPlay=!0,this.index=0,this.currentTick=0,this._score=e}processCurrent(){const e=this._score.masterBars[this.index];let t=e.alternateEndings;if(t===0&&(t=this._previousAlternateEndings),e===e.repeatGroup.opening&&e.repeatGroup.isClosed&&!this._groupsOnStack.has(e.repeatGroup)){const i=new bv(e.repeatGroup,e);this._repeatStack.push(i),this._groupsOnStack.add(e.repeatGroup),this._previousAlternateEndings=0,t=e.alternateEndings}if(this._repeatStack.length===0||t===0)this.shouldPlay=!0;else{const i=this._repeatStack[this._repeatStack.length-1],r=i.iterations[i.closingIndex];this._previousAlternateEndings=t,t&1<<r?this.shouldPlay=!0:this.shouldPlay=!1}this.shouldPlay&&(this.currentTick+=e.calculateDuration())}moveNext(){const t=this._score.masterBars[this.index].repeatCount-1;if(this._repeatStack.length>0&&t>0){const i=this._repeatStack[this._repeatStack.length-1];if(i.iterations[i.closingIndex]<t){this.index=i.opening.index,i.iterations[i.closingIndex]++;for(let n=0;n<i.closingIndex;n++)i.iterations[n]=0;i.closingIndex=0,this._previousAlternateEndings=0}else i.closingIndex<i.group.closings.length-1?(i.closingIndex++,this.index++):(this._repeatStack.pop(),this._groupsOnStack.delete(i.group),this.index++)}else this.index++}}class kv{constructor(e,t){this.beat=e,this.playbackStart=t}}class ts{get duration(){return this.end-this.start}constructor(e,t){this._highlightedBeats=new Map,this.highlightedBeats=[],this.nextBeat=null,this.previousBeat=null,this.start=e,this.end=t}highlightBeat(e,t){e.isEmpty&&!e.voice.isEmpty||this._highlightedBeats.has(e.id)||(this._highlightedBeats.set(e.id,!0),this.highlightedBeats.push(new kv(e,t)))}getVisibleBeatAtStart(e){for(const t of this.highlightedBeats)if(t.playbackStart==this.start&&e.has(t.beat.voice.bar.staff.track.index))return t.beat;return null}}class Rl{constructor(e,t){this.tick=e,this.tempo=t}}class jw{constructor(){this.start=0,this.end=0,this.tempoChanges=[],this.firstBeat=null,this.lastBeat=null,this.nextMasterBar=null,this.previousMasterBar=null}get tempo(){return this.tempoChanges[0].tempo}insertAfter(e,t){this.firstBeat==null||e==null||this.lastBeat==null?(this.firstBeat=t,this.lastBeat=t):(t.nextBeat=e.nextBeat,t.previousBeat=e,e.nextBeat&&(e.nextBeat.previousBeat=t),e.nextBeat=t,e==this.lastBeat&&(this.lastBeat=t))}insertBefore(e,t){this.firstBeat==null||e==null||this.lastBeat==null?(this.firstBeat=t,this.lastBeat=t):(t.previousBeat=e.previousBeat,t.nextBeat=e,e.previousBeat&&(e.previousBeat.nextBeat=t),e.previousBeat=t,e==this.firstBeat&&(this.firstBeat=t))}addBeat(e,t,i,r){const n=i+r;if(this.firstBeat==null){const a=new ts(i,n);a.highlightBeat(e,t),this.insertAfter(this.firstBeat,a)}else if(i>=this.lastBeat.end){const a=new ts(this.lastBeat.end,n);a.highlightBeat(e,t),this.insertAfter(this.lastBeat,a)}else{let a=null;if(i<this.firstBeat.start)a=this.firstBeat;else{let o=this.firstBeat;for(;o!=null;){if(i>=o.start&&i<o.end){a=o;break}o=o.nextBeat}if(a===null)throw new Pt(Nt.General,"Error on building lookup, unknown variant")}if(i<a.start)if(n==a.start){const o=new ts(i,a.start);o.highlightBeat(e,t),this.insertBefore(this.firstBeat,o)}else if(n<a.end){const o=new ts(i,a.start);o.highlightBeat(e,t),this.insertBefore(a,o);const l=new ts(a.start,n);for(const h of a.highlightedBeats)l.highlightBeat(h.beat,h.playbackStart);l.highlightBeat(e,t),this.insertBefore(a,l),a.start=n}else if(n==a.end){const o=new ts(i,a.start);o.highlightBeat(e,t),a.highlightBeat(e,t),this.insertBefore(a,o)}else{const o=new ts(i,a.start);o.highlightBeat(e,t),a.highlightBeat(e,t),this.insertBefore(a,o),this.addBeat(e,t,a.end,n-a.end)}else if(i>a.start)if(n==a.end){const o=new ts(a.start,i);for(const l of a.highlightedBeats)o.highlightBeat(l.beat,l.playbackStart);a.start=i,a.highlightBeat(e,t),this.insertBefore(a,o)}else if(n<a.end){const o=new ts(a.start,i);this.insertBefore(a,o);const l=new ts(i,n);this.insertBefore(a,l);for(const h of a.highlightedBeats)o.highlightBeat(h.beat,h.playbackStart),l.highlightBeat(h.beat,h.playbackStart);l.highlightBeat(e,t),a.start=n}else{const o=new ts(a.start,i);for(const l of a.highlightedBeats)o.highlightBeat(l.beat,l.playbackStart);a.start=i,a.highlightBeat(e,t),this.insertBefore(a,o),this.addBeat(e,t,a.end,n-a.end)}else if(n===a.end)a.highlightBeat(e,t);else if(n<a.end){const o=new ts(a.start,n);for(const l of a.highlightedBeats)o.highlightBeat(l.beat,l.playbackStart);o.highlightBeat(e,t),a.start=n,this.insertBefore(a,o)}else a.highlightBeat(e,t),this.addBeat(e,t,a.end,n-a.end)}}}class _v{get start(){return this.masterBar.start+this.beatLookup.start}get end(){return this.start+this.tickDuration}constructor(e){this.nextBeat=null,this.tickDuration=0,this.duration=0,this.masterBar=e}calculateDuration(){if(this.masterBar.tempoChanges.length===1)this.duration=re.ticksToMillis(this.tickDuration,this.masterBar.tempoChanges[0].tempo);else{let e=0,t=this.start,i=this.masterBar.tempoChanges[0].tempo;const r=this.end;for(const n of this.masterBar.tempoChanges)if(n.tick<t)i=n.tempo;else{if(n.tick>r)break;e+=re.ticksToMillis(n.tick-t,i),i=n.tempo,t=n.tick}r>t&&(e+=re.ticksToMillis(r-t,i)),this.duration=e}}}class Bv{constructor(){this._currentMasterBar=null,this.masterBarLookup=new Map,this.masterBars=[]}findBeat(e,t,i=null){let r=null;return i&&(r=this.findBeatFast(e,i,t)),r||(r=this.findBeatSlow(e,i,t,!1)),r}findBeatFast(e,t,i){if(i>=t.start&&i<t.end)return t;if(t.nextBeat&&i>=t.nextBeat.start&&i<t.nextBeat.end){const r=t.nextBeat;return this.fillNextBeat(r,e),r}return null}fillNextBeat(e,t){e.nextBeat=this.findBeatInMasterBar(e.masterBar,e.beatLookup.nextBeat,e.end,t,!1,!0),e.nextBeat==null&&(e.nextBeat=this.findBeatSlow(t,e,e.end,!0)),e.nextBeat&&(e.tickDuration=e.nextBeat.start-e.start,e.calculateDuration()),e.nextBeat||(e.tickDuration=e.masterBar.end-e.start,e.calculateDuration())}findBeatSlow(e,t,i,r){let n=null;if(t!=null&&(t.masterBar.start<=i&&t.masterBar.end>i?n=t.masterBar:t.masterBar.nextMasterBar&&t.masterBar.nextMasterBar.start<=i&&t.masterBar.nextMasterBar.end>i&&(n=t.masterBar.nextMasterBar)),n||(n=this.findMasterBar(i)),!n)return null;for(;n;){if(n.firstBeat){let a=this.findBeatInMasterBar(n,n.firstBeat,i,e,!0,r);if(a)return a}n=n.nextMasterBar}return null}findBeatInMasterBar(e,t,i,r,n,a){if(!t)return null;let o=null,l=null;const h=i-e.start;for(;t!=null&&l==null;){if(t.start<=h&&h<t.end){if(o=t,l=t.getVisibleBeatAtStart(r),!l)if(a){let c=e;for(;c!=null&&l==null;){for(;t!=null;){if(l=t.getVisibleBeatAtStart(r),l){o=t,e=c;break}t=t.nextBeat}(!l||!o)&&(c=c.nextMasterBar,t=(c==null?void 0:c.firstBeat)??null)}}else{let c=e;for(;c!=null&&l==null;){for(;t!=null;){if(l=t.getVisibleBeatAtStart(r),l){o=t,e=c;break}t=t.previousBeat}(!l||!o)&&(c=c.previousMasterBar,t=(c==null?void 0:c.firstBeat)??null)}}}else if(t.end>h)break;t=(t==null?void 0:t.nextBeat)??null}return l==null?null:this.createResult(e,o,l,n,r)}createResult(e,t,i,r,n){const a=new _v(e);return a.beat=i,a.beatLookup=t,a.tickDuration=t.end-t.start,r&&this.fillNextBeat(a,n),a.calculateDuration(),a}findMasterBar(e){const t=this.masterBars;let i=0,r=t.length-1;for(;i<=r;){const n=(r+i)/2|0,a=t[n];if(e>=a.start&&e<a.end)return a;e<a.start?r=n-1:i=n+1}return null}getMasterBar(e){if(!this.masterBarLookup.has(e.index)){const t=new jw;return t.masterBar=e,t}return this.masterBarLookup.get(e.index)}getMasterBarStart(e){return this.masterBarLookup.has(e.index)?this.masterBarLookup.get(e.index).start:0}getBeatStart(e){return this.masterBarLookup.has(e.voice.bar.index)?this.masterBarLookup.get(e.voice.bar.index).start+e.playbackStart:0}addMasterBar(e){this.masterBars.push(e),this._currentMasterBar&&(e.previousMasterBar=this._currentMasterBar,this._currentMasterBar.nextMasterBar=e),this._currentMasterBar=e,this.masterBarLookup.has(e.masterBar.index)||this.masterBarLookup.set(e.masterBar.index,e)}addBeat(e,t,i){const r=this._currentMasterBar;if(r)if(t<0&&r.previousMasterBar){const n=r.previousMasterBar.end-r.previousMasterBar.start,a=n+t,o=a+i;if(r.previousMasterBar.addBeat(e,a,a,i),o>n){const l=i+t;r.addBeat(e,t,0,l)}}else r.addBeat(e,t,t,i)}}class xv{constructor(){this.noteOnly=0,this.untilTieOrSlideEnd=0,this.letRingEnd=0}}class vv{constructor(){this.firstBeatDuration=0,this.secondBeatStartOffset=0,this.secondBeatDuration=0}}class Ne{constructor(e,t,i){this._programsPerChannel=new Map,this.tickLookup=new Bv,this.applyTranspositionPitches=!0,this.transpositionPitches=new Map,this._currentTripletFeel=null,this.vibratoResolution=16,this._score=e,this._settings=t||new vn,this._handler=i}generate(){this.transpositionPitches.clear();for(const r of this._score.tracks)this.generateTrack(r);C.debug("Midi","Begin midi generation");const e=new Sv(this._score);let t=null,i=this._score.tempo;for(;!e.finished;){const r=e.index,n=this._score.masterBars[r],a=e.currentTick;if(e.processCurrent(),e.shouldPlay){this.generateMasterBar(n,t,a,i),n.tempoAutomations.length>0&&(i=n.tempoAutomations[0].value);for(const o of this._score.tracks)for(const l of o.staves)r<l.bars.length&&this.generateBar(l.bars[r],a,i);n.tempoAutomations.length>0&&(i=n.tempoAutomations[n.tempoAutomations.length-1].value)}e.moveNext(),t=n}for(const r of this._score.tracks)this._handler.finishTrack(r.index,e.currentTick);C.debug("Midi","Midi generation done")}generateTrack(e){this.generateChannel(e,e.playbackInfo.primaryChannel,e.playbackInfo),e.playbackInfo.primaryChannel!==e.playbackInfo.secondaryChannel&&this.generateChannel(e,e.playbackInfo.secondaryChannel,e.playbackInfo)}addProgramChange(e,t,i,r){(!this._programsPerChannel.has(i)||this._programsPerChannel.get(i)!==r)&&(this._handler.addProgramChange(e.index,t,i,r),this._programsPerChannel.set(i,r))}static buildTranspositionPitches(e,t){const i=new Map;for(const r of e.tracks){const n=r.index<t.notation.transpositionPitches.length?t.notation.transpositionPitches[r.index]:0;i.set(r.playbackInfo.primaryChannel,n),i.set(r.playbackInfo.secondaryChannel,n)}return i}generateChannel(e,t,i){const r=e.index<this._settings.notation.transpositionPitches.length?this._settings.notation.transpositionPitches[e.index]:0;this.transpositionPitches.set(t,r);let n=Ne.toChannelShort(i.volume),a=Ne.toChannelShort(i.balance);this._handler.addControlChange(e.index,0,t,Le.VolumeCoarse,n),this._handler.addControlChange(e.index,0,t,Le.PanCoarse,a),this._handler.addControlChange(e.index,0,t,Le.ExpressionControllerCoarse,127),this._handler.addControlChange(e.index,0,t,Le.RegisteredParameterFine,0),this._handler.addControlChange(e.index,0,t,Le.RegisteredParameterCourse,0),this._handler.addControlChange(e.index,0,t,Le.DataEntryFine,0),this._handler.addControlChange(e.index,0,t,Le.DataEntryCoarse,Ne.PitchBendRangeInSemitones),this.addProgramChange(e,0,t,i.program)}static toChannelShort(e){const t=Math.max(-32768,Math.min(32767,e*8-1));return Math.max(t,-1)+1}generateMasterBar(e,t,i,r){(!t||t.timeSignatureDenominator!==e.timeSignatureDenominator||t.timeSignatureNumerator!==e.timeSignatureNumerator)&&this._handler.addTimeSignature(i,e.timeSignatureNumerator,e.timeSignatureDenominator);const n=e.calculateDuration(),a=new jw;if(e.tempoAutomations.length>0){e.tempoAutomations[0].ratioPosition>0&&a.tempoChanges.push(new Rl(i,r));for(const o of e.tempoAutomations){const l=i+n*o.ratioPosition;this._handler.addTempo(l,o.value),a.tempoChanges.push(new Rl(l,o.value))}}else t?a.tempoChanges.push(new Rl(i,r)):(this._handler.addTempo(i,e.score.tempo),a.tempoChanges.push(new Rl(i,e.score.tempo)));a.masterBar=e,a.start=i,a.end=a.start+n,this.tickLookup.addMasterBar(a)}generateBar(e,t,i){let r=this.getPlaybackBar(e);for(const n of r.voices)this.generateVoice(n,t,e,i)}getPlaybackBar(e){switch(e.simileMark){case Qi.Simple:e.previousBar&&(e=this.getPlaybackBar(e.previousBar));break;case Qi.FirstOfDouble:e.previousBar&&e.previousBar.previousBar&&(e=this.getPlaybackBar(e.previousBar.previousBar));break;case Qi.SecondOfDouble:e.previousBar&&e.previousBar.previousBar&&(e=this.getPlaybackBar(e.previousBar.previousBar));break}return e}generateVoice(e,t,i,r){if(e.isEmpty&&(!e.bar.isEmpty||e.index!==0))return;const n=i.masterBar.tempoAutomations.slice();let a=r;const o=i.masterBar.calculateDuration();for(const l of e.beats){const h=l.playbackStart/o;for(;n.length>0&&n[0].ratioPosition<=h;)a=n.shift().value;this.generateBeat(l,t,i,a)}}generateBeat(e,t,i,r){let n=e.playbackStart,a=e.playbackDuration;const o=e.voice.bar.masterBar.calculateDuration();e.voice.bar.isEmpty?a=o:e.voice.bar.masterBar.tripletFeel!==ce.NoTripletFeel&&this._settings.player.playTripletFeel&&(this._currentTripletFeel?(n-=this._currentTripletFeel.secondBeatStartOffset,a=this._currentTripletFeel.secondBeatDuration,this._currentTripletFeel=null):(this._currentTripletFeel=Ne.calculateTripletFeelInfo(n,a,e),this._currentTripletFeel&&(a=this._currentTripletFeel.firstBeatDuration))),i===e.voice.bar?this.tickLookup.addBeat(e,n,a):this.tickLookup.addBeat(e,0,a);const l=e.voice.bar.staff.track;for(const h of e.automations)this.generateNonTempoAutomation(e,h,t);if(e.isRest)this._handler.addRest(l.index,t+n,l.playbackInfo.primaryChannel);else{let h=this.getBrushInfo(e);for(const u of e.notes)this.generateNote(u,t+n,a,r,h)}if(e.vibrato!==Be.None){let h=240,u=3;switch(e.vibrato){case Be.Slight:h=this._settings.player.vibrato.beatSlightLength,u=this._settings.player.vibrato.beatSlightAmplitude;break;case Be.Wide:h=this._settings.player.vibrato.beatWideLength,u=this._settings.player.vibrato.beatWideAmplitude;break}this.generateVibratorWithParams(t+n,e.playbackDuration,h,u,(c,d)=>{this._handler.addBend(e.voice.bar.staff.track.index,c,l.playbackInfo.secondaryChannel,d)})}}static calculateTripletFeelInfo(e,t,i){let r;switch(i.voice.bar.masterBar.tripletFeel){case ce.Triplet8th:case ce.Dotted8th:case ce.Scottish8th:r=k.Eighth;break;case ce.Triplet16th:case ce.Dotted16th:case ce.Scottish16th:r=k.Sixteenth;break;default:return null}const n=re.toTicks(r);if(t!==n||e%n!==0||!i.nextBeat||i.nextBeat.voice!==i.voice||i.playbackDuration!==n)return null;const a=new vv;switch(i.voice.bar.masterBar.tripletFeel){case ce.Triplet8th:a.firstBeatDuration=re.applyTuplet(re.toTicks(k.Quarter),3,2),a.secondBeatDuration=re.applyTuplet(re.toTicks(k.Eighth),3,2);break;case ce.Dotted8th:a.firstBeatDuration=re.applyDot(re.toTicks(k.Eighth),!1),a.secondBeatDuration=re.toTicks(k.Sixteenth);break;case ce.Scottish8th:a.firstBeatDuration=re.toTicks(k.Sixteenth),a.secondBeatDuration=re.applyDot(re.toTicks(k.Eighth),!1);break;case ce.Triplet16th:a.firstBeatDuration=re.applyTuplet(re.toTicks(k.Eighth),3,2),a.secondBeatDuration=re.applyTuplet(re.toTicks(k.Sixteenth),3,2);break;case ce.Dotted16th:a.firstBeatDuration=re.applyDot(re.toTicks(k.Sixteenth),!1),a.secondBeatDuration=re.toTicks(k.ThirtySecond);break;case ce.Scottish16th:a.firstBeatDuration=re.toTicks(k.ThirtySecond),a.secondBeatDuration=re.applyDot(re.toTicks(k.Sixteenth),!1);break}return a.secondBeatStartOffset=t-a.firstBeatDuration,a}generateNote(e,t,i,r,n){const a=e.beat.voice.bar.staff.track,o=e.beat.voice.bar.staff;let l=e.calculateRealValue(this.applyTranspositionPitches,!0);if(e.isPercussion){const w=nt.getArticulation(e);w&&(l=w.outputMidiNumber)}const h=e.isStringed&&e.string<=n.length?n[e.string-1]:0,u=t+h,c=this.getNoteDuration(e,i,r);c.untilTieOrSlideEnd-=h,c.noteOnly-=h,c.letRingEnd-=h;const d=Ne.getNoteVelocity(e),p=e.hasBend||e.beat.hasWhammyBar||e.beat.vibrato!==Be.None?a.playbackInfo.secondaryChannel:a.playbackInfo.primaryChannel;let g=0;if(e.hasBend?g=Ne.getPitchWheel(e.bendPoints[0].value):e.beat.hasWhammyBar?g=Ne.getPitchWheel(e.beat.whammyBarPoints[0].value):e.isTieDestination||e.slideOrigin&&e.slideOrigin.slideOutType===ne.Legato?g=-1:g=Ne.getPitchWheel(0),g>=0&&this._handler.addNoteBend(a.index,u,p,l,g),e.beat.fadeIn&&this.generateFadeIn(e,u,c),e.isTrill&&!o.isPercussion){this.generateTrill(e,u,c,l,d,p);return}if(e.beat.isTremolo){this.generateTremoloPicking(e,u,c,l,d,p);return}if(e.hasBend?this.generateBend(e,u,c,l,p,r):e.beat.hasWhammyBar&&e.index===0?this.generateWhammy(e.beat,u,c,p,r):e.slideInType!==vt.None||e.slideOutType!==ne.None?this.generateSlide(e,u,c,l,p,r):(e.vibrato!==Be.None||e.isTieDestination&&e.tieOrigin.vibrato!==Be.None)&&this.generateVibrato(e,u,c,l,p),!e.isTieDestination&&(!e.slideOrigin||e.slideOrigin.slideOutType!==ne.Legato)){let w=Math.max(c.untilTieOrSlideEnd,c.letRingEnd);this._handler.addNote(a.index,u,w,l,d,p)}}getNoteDuration(e,t,i){const r=new xv;if(r.noteOnly=t,r.untilTieOrSlideEnd=t,r.letRingEnd=t,e.isDead)return r.noteOnly=this.applyStaticDuration(Ne.DefaultDurationDead,t,i),r.untilTieOrSlideEnd=r.noteOnly,r.letRingEnd=r.noteOnly,r;if(e.isPalmMute)return r.noteOnly=this.applyStaticDuration(Ne.DefaultDurationPalmMute,t,i),r.untilTieOrSlideEnd=r.noteOnly,r.letRingEnd=r.noteOnly,r;if(e.isStaccato)return r.noteOnly=t/2|0,r.untilTieOrSlideEnd=r.noteOnly,r.letRingEnd=r.noteOnly,r;if(e.isTieOrigin){const n=e.tieDestination;if(n)if(e.isTieDestination){const a=this.getNoteDuration(n,n.beat.playbackDuration,i);r.untilTieOrSlideEnd=t+a.untilTieOrSlideEnd}else{const a=e.beat.absolutePlaybackStart,o=this.getNoteDuration(n,n.beat.playbackDuration,i),l=n.beat.absolutePlaybackStart+o.untilTieOrSlideEnd;r.untilTieOrSlideEnd=l-a}}else if(e.slideOutType===ne.Legato){const n=e.slideTarget;if(n){const a=e.beat.absolutePlaybackStart,o=this.getNoteDuration(n,n.beat.playbackDuration,i),l=n.beat.absolutePlaybackStart+o.untilTieOrSlideEnd;r.untilTieOrSlideEnd=l-a}}if(e.isLetRing&&this._settings.notation.notationMode===St.GuitarPro){let n=e.beat,a=0;const o=e.beat.voice.bar.masterBar.calculateDuration();for(;n.nextBeat;){let l=n.nextBeat;if(l.isRest||e.isStringed&&l.hasNoteOnString(e.string))break;if(n=n.nextBeat,a=n.absolutePlaybackStart-e.beat.absolutePlaybackStart+n.playbackDuration,a>o){a=o;break}}n===e.beat?r.letRingEnd=t:r.letRingEnd=a}else r.letRingEnd=r.untilTieOrSlideEnd;return r}applyStaticDuration(e,t,i){const r=i*e/A.MaxPosition|0;return Math.min(r,t)}static getNoteVelocity(e){let t=e.dynamics;switch(!e.beat.voice.bar.staff.isPercussion&&e.hammerPullOrigin&&t--,e.isGhost&&t--,e.accentuated){case et.Normal:t++;break;case et.Heavy:t+=2;break}return re.dynamicToVelocity(t)}generateFadeIn(e,t,i){const r=e.beat.voice.bar.staff.track,a=Ne.toChannelShort(r.playbackInfo.volume)/i.noteOnly,o=120,l=i.noteOnly/o|0,h=t+i.noteOnly;for(let u=l-1;u>=0;u--){const c=h-u*o,d=(c-t)*a;u===l-1&&(this._handler.addControlChange(r.index,t,r.playbackInfo.primaryChannel,Le.VolumeCoarse,d),this._handler.addControlChange(r.index,t,r.playbackInfo.secondaryChannel,Le.VolumeCoarse,d)),this._handler.addControlChange(r.index,c,r.playbackInfo.primaryChannel,Le.VolumeCoarse,d),this._handler.addControlChange(r.index,c,r.playbackInfo.secondaryChannel,Le.VolumeCoarse,d)}}generateVibrato(e,t,i,r,n){let a=0,o=0;switch(e.vibrato!==Be.None?e.vibrato:e.isTieDestination?e.tieOrigin.vibrato:Be.Slight){case Be.Slight:a=this._settings.player.vibrato.noteSlightLength,o=this._settings.player.vibrato.noteSlightAmplitude;break;case Be.Wide:a=this._settings.player.vibrato.noteWideLength,o=this._settings.player.vibrato.noteWideAmplitude;break;default:return}const h=e.beat.voice.bar.staff.track;this.generateVibratorWithParams(t,i.noteOnly,a,o,(u,c)=>{this._handler.addNoteBend(h.index,u,n,r,c)})}generateVibratorWithParams(e,t,i,r,n){const a=this.vibratoResolution,o=i/2|0;e+=i;const l=e+t;for(;e<l;){let h=0;const u=e+i<l?i:l-e;for(;h<u;){let c=r*Math.sin(h*Math.PI/o);n(e+h|0,Ne.getPitchWheel(c)),h+=a}e+=i}}static getPitchWheel(e){return le.DefaultPitchWheel+e/2*Ne.PitchValuePerSemitone}generateSlide(e,t,i,r,n,a){let o=e.slideOutType===ne.Legato?i.noteOnly:i.untilTieOrSlideEnd,l=[],h=e.beat.voice.bar.staff.track;const u=this._settings.player.slide.simpleSlidePitchOffset,c=Math.floor(A.MaxPosition*this._settings.player.slide.simpleSlideDurationRatio),d=Math.floor(A.MaxPosition*this._settings.player.slide.shiftSlideDurationRatio);switch(e.slideInType){case vt.IntoFromAbove:l.push(new A(0,u)),l.push(new A(c,0));break;case vt.IntoFromBelow:l.push(new A(0,-u)),l.push(new A(c,0));break}switch(e.slideOutType){case ne.Legato:case ne.Shift:l.push(new A(d,0));const p=(e.slideTarget.calculateRealValue(this.applyTranspositionPitches,!0)-e.calculateRealValue(this.applyTranspositionPitches,!0))*2;l.push(new A(A.MaxPosition,p));break;case ne.OutDown:l.push(new A(A.MaxPosition-c,0)),l.push(new A(A.MaxPosition,-u));break;case ne.OutUp:l.push(new A(A.MaxPosition-c,0)),l.push(new A(A.MaxPosition,u));break}this.generateWhammyOrBend(t,o,l,a,(p,g)=>{this._handler.addNoteBend(h.index,p,n,r,g)})}generateBend(e,t,i,r,n,a){let o=e.bendPoints,l=e.beat.voice.bar.staff.track;const h=(g,w)=>{this._handler.addNoteBend(l.index,g,n,r,w)};let u=null,c;if(e.isTieOrigin&&this._settings.notation.extendBendArrowsOnTiedNotes){let g=e;for(;g.isTieOrigin&&!g.tieDestination.hasBend;)g=g.tieDestination;c=g.beat.absolutePlaybackStart-e.beat.absolutePlaybackStart+this.getNoteDuration(g,g.beat.playbackDuration,a).noteOnly}else if(e.isTieOrigin&&e.beat.graceType!==$.None){switch(e.tieDestination.bendType){case G.Bend:case G.BendRelease:case G.PrebendBend:u=e.tieDestination.bendPoints[1].value;break;case G.Prebend:case G.PrebendRelease:u=e.tieDestination.bendPoints[0].value;break}c=Math.max(i.noteOnly,re.millisToTicks(this._settings.player.songBookBendDuration,a))}else c=i.noteOnly;o[0].value>0&&!e.isContinuedBend&&t>0&&t--;const d=Math.min(c,re.millisToTicks(this._settings.player.songBookBendDuration,a));let p=[];switch(e.bendType){case G.Custom:p=o;break;case G.Bend:case G.Release:switch(e.bendStyle){case Ee.Default:p=o;break;case Ee.Gradual:p.push(new A(0,e.bendPoints[0].value)),(!u||u<e.bendPoints[1].value)&&(u=e.bendPoints[1].value),p.push(new A(A.MaxPosition,u));break;case Ee.Fast:(!u||u<e.bendPoints[1].value)&&(u=e.bendPoints[1].value),e.beat.graceType===$.BendGrace?this.generateSongBookWhammyOrBend(t,c,!0,[e.bendPoints[0].value,u],d,a,h):this.generateSongBookWhammyOrBend(t,c,!1,[e.bendPoints[0].value,u],d,a,h);return}break;case G.BendRelease:switch(e.bendStyle){case Ee.Default:p=o;break;case Ee.Gradual:p.push(new A(0,e.bendPoints[0].value)),p.push(new A(A.MaxPosition/2|0,e.bendPoints[1].value)),p.push(new A(A.MaxPosition,e.bendPoints[2].value));break;case Ee.Fast:this.generateSongBookWhammyOrBend(t,c,!1,[e.bendPoints[0].value,e.bendPoints[1].value,e.bendPoints[2].value],d,a,h);return}break;case G.Hold:p=o;break;case G.Prebend:p=o;break;case G.PrebendBend:switch(e.bendStyle){case Ee.Default:p=o;break;case Ee.Gradual:p.push(new A(0,e.bendPoints[0].value)),p.push(new A(A.MaxPosition,e.bendPoints[1].value));break;case Ee.Fast:const g=Ne.getPitchWheel(e.bendPoints[0].value);h(t,g|0),(!u||u<e.bendPoints[1].value)&&(u=e.bendPoints[1].value),this.generateSongBookWhammyOrBend(t,c,!1,[e.bendPoints[0].value,u],d,a,h);return}break;case G.PrebendRelease:switch(e.bendStyle){case Ee.Default:p=o;break;case Ee.Gradual:p.push(new A(0,e.bendPoints[0].value)),p.push(new A(A.MaxPosition,e.bendPoints[1].value));break;case Ee.Fast:const g=Ne.getPitchWheel(e.bendPoints[0].value);h(t,g|0),this.generateSongBookWhammyOrBend(t,c,!1,[e.bendPoints[0].value,e.bendPoints[1].value],d,a,h);return}break}this.generateWhammyOrBend(t,c,p,a,h)}generateSongBookWhammyOrBend(e,t,i,r,n,a,o){const l=i?e:e+t-n,h=n/(r.length-1);for(let u=0;u<r.length-1;u++){const c=Ne.getPitchWheel(r[u]),d=Ne.getPitchWheel(r[u+1]),p=l+h*u;this.generateBendValues(p,h,c,d,a,o)}}generateWhammy(e,t,i,r,n){const a=e.whammyBarPoints,o=e.voice.bar.staff.track,l=i.noteOnly;a[0].value>0&&!e.isContinuedWhammy&&t--;const h=(c,d)=>{this._handler.addBend(o.index,c,r,d)};let u=[];switch(e.whammyBarType){case xe.Custom:u=a;break;case xe.Dive:switch(e.whammyStyle){case Ee.Default:u=a;break;case Ee.Gradual:u.push(new A(0,a[0].value)),u.push(new A(A.MaxPosition,a[1].value));break;case Ee.Fast:const c=Math.min(l,re.millisToTicks(this._settings.player.songBookBendDuration,n));this.generateSongBookWhammyOrBend(t,l,!1,[a[0].value,a[1].value],c,n,h);return}break;case xe.Dip:switch(e.whammyStyle){case Ee.Default:u=a;break;case Ee.Gradual:u.push(new A(0,a[0].value)),u.push(new A(A.MaxPosition/2|0,a[1].value)),u.push(new A(A.MaxPosition,a[2].value));break;case Ee.Fast:const c=Math.min(l,re.millisToTicks(this._settings.player.songBookDipDuration,n));this.generateSongBookWhammyOrBend(t,l,!0,[a[0].value,a[1].value,a[2].value],c,n,h);return}break;case xe.Hold:u=a;break;case xe.Predive:u=a;break;case xe.PrediveDive:switch(e.whammyStyle){case Ee.Default:u=a;break;case Ee.Gradual:u.push(new A(0,a[0].value)),u.push(new A(A.MaxPosition/2|0,a[0].value)),u.push(new A(A.MaxPosition,a[1].value));break;case Ee.Fast:const c=Ne.getPitchWheel(a[0].value);this._handler.addBend(o.index,t,r,c|0);const d=Math.min(l,re.millisToTicks(this._settings.player.songBookBendDuration,n));this.generateSongBookWhammyOrBend(t,l,!1,[a[0].value,a[1].value],d,n,h);return}break}this.generateWhammyOrBend(t,l,u,n,h)}generateWhammyOrBend(e,t,i,r,n){const a=t/A.MaxPosition;for(let o=0;o<i.length-1;o++){const l=i[o],h=i[o+1],u=Ne.getPitchWheel(l.value),c=Ne.getPitchWheel(h.value),d=a*(h.offset-l.offset),p=e+a*l.offset;this.generateBendValues(p,d,u,c,r,n)}}generateBendValues(e,t,i,r,n,a){const o=re.ticksToMillis(t,n),l=Math.abs(r-i)/Ne.PitchValuePerSemitone,h=Math.max(Ne.MinBreakpointsPerSemitone*l,o/Ne.MillisecondsPerBreakpoint),u=t/h,c=(r-i)/h;for(let d=0;d<h;d++)a(e|0,Math.round(i)),i+=c,e+=u;i<r&&a(e|0,r)}generateTrill(e,t,i,r,n,a){const o=e.beat.voice.bar.staff.track,l=e.stringTuning+e.trillFret;let h=re.toTicks(e.trillSpeed),u=!0,c=t,d=t+i.untilTieOrSlideEnd;for(;c+10<d;)c+h>=d&&(h=d-c),this._handler.addNote(o.index,c,h,u?l:r,n,a),u=!u,c+=h}generateTremoloPicking(e,t,i,r,n,a){const o=e.beat.voice.bar.staff.track;let l=re.toTicks(e.beat.tremoloSpeed),h=t;const u=t+i.untilTieOrSlideEnd;for(;h+10<u;)h+l>=u&&(l=u-h),this._handler.addNote(o.index,h,l,r,n,a),h+=l}getBrushInfo(e){const t=new Int32Array(e.voice.bar.staff.tuning.length);if(e.brushType!==Ve.None){let i=0,r=0;for(const n of e.notes)n.isTieDestination||(i|=1<<n.string-1,r++);if(e.notes.length>0){let n=0;const a=e.brushDuration/(r-1)|0;for(let o=0;o<e.voice.bar.staff.tuning.length;o++){let l=e.brushType===Ve.ArpeggioDown||e.brushType===Ve.BrushDown?o:t.length-1-o;i&1<<l&&(t[l]=n,n+=a)}}}return t}generateNonTempoAutomation(e,t,i){switch(t.type){case gt.Instrument:this.addProgramChange(e.voice.bar.staff.track,e.playbackStart+i,e.voice.bar.staff.track.playbackInfo.primaryChannel,(t.value|0)&255),this.addProgramChange(e.voice.bar.staff.track,e.playbackStart+i,e.voice.bar.staff.track.playbackInfo.secondaryChannel,(t.value|0)&255);break;case gt.Balance:let r=Ne.toChannelShort(t.value);this._handler.addControlChange(e.voice.bar.staff.track.index,e.playbackStart+i,e.voice.bar.staff.track.playbackInfo.primaryChannel,Le.PanCoarse,r),this._handler.addControlChange(e.voice.bar.staff.track.index,e.playbackStart+i,e.voice.bar.staff.track.playbackInfo.secondaryChannel,Le.PanCoarse,r);break;case gt.Volume:let n=Ne.toChannelShort(t.value);this._handler.addControlChange(e.voice.bar.staff.track.index,e.playbackStart+i,e.voice.bar.staff.track.playbackInfo.primaryChannel,Le.VolumeCoarse,n),this._handler.addControlChange(e.voice.bar.staff.track.index,e.playbackStart+i,e.voice.bar.staff.track.playbackInfo.secondaryChannel,Le.VolumeCoarse,n);break}}prepareSingleBeat(e){let t=-1,i=-1,r=e;for(;r&&(t===-1||i===-1);){for(const u of e.automations)switch(u.type){case gt.Instrument:i=u.value;break;case gt.Tempo:t=u.value;break}r=r.previousBeat}const n=e.voice.bar.staff.track,a=e.voice.bar.masterBar;t===-1&&(t=a.score.tempo);const o=e.playbackStart/a.calculateDuration();for(const u of a.tempoAutomations)if(u.ratioPosition<=o)t=u.value;else break;i===-1&&(i=n.playbackInfo.program);const l=n.playbackInfo.volume;this.generateTrack(n),this._handler.addTimeSignature(0,a.timeSignatureNumerator,a.timeSignatureDenominator),this._handler.addTempo(0,t);let h=Ne.toChannelShort(l);return this._handler.addControlChange(0,0,n.playbackInfo.primaryChannel,Le.VolumeCoarse,h),this._handler.addControlChange(0,0,n.playbackInfo.secondaryChannel,Le.VolumeCoarse,h),t}generateSingleBeat(e){const t=this.prepareSingleBeat(e);this.generateBeat(e,-e.playbackStart,e.voice.bar,t)}generateSingleNote(e){const t=this.prepareSingleBeat(e.beat);this.generateNote(e,0,e.beat.playbackDuration,t,new Int32Array(e.beat.voice.bar.staff.tuning.length))}}Ne.DefaultDurationDead=30;Ne.DefaultDurationPalmMute=80;Ne.PitchBendRangeInSemitones=8*2;Ne.PitchValuePerSemitone=le.DefaultPitchWheel/Ne.PitchBendRangeInSemitones;Ne.MinBreakpointsPerSemitone=6;Ne.MillisecondsPerBreakpoint=150;class Zw{constructor(){this.startTick=0,this.endTick=0}}class qe{constructor(e,t){this.width=0,this.height=0,this.x=e,this.y=t}get scale(){return this.renderer.scale}doLayout(){}paint(e,t,i){}}class Ii extends qe{constructor(e=0,t=0){super(e,t),this.beat=null,this.nextGlyph=null,this.previousGlyph=null}}class ht extends Ii{constructor(e,t,i,r){super(e,t),this.glyphScale=0,this.glyphScale=i,this.symbol=r}paint(e,t,i){i.fillMusicFontSymbol(e+this.x,t+this.y,this.glyphScale*this.scale,this.symbol,!1)}}class ee extends ht{constructor(e,t,i,r){super(e,t,r?ee.GraceScale:1,ee.getSymbol(i)),this._isGrace=r,this._duration=i}paint(e,t,i){let r=this._isGrace?this.scale:0;i.fillMusicFontSymbol(e+this.x,t+this.y+r,this.glyphScale*this.scale,this.symbol,!1)}doLayout(){let e=(this._isGrace?ee.GraceScale:1)*this.scale;switch(this._duration){case k.QuadrupleWhole:this.width=14*e;break;case k.DoubleWhole:this.width=14*(this._isGrace?ee.GraceScale:1)*this.scale;break;case k.Whole:this.width=14*(this._isGrace?ee.GraceScale:1)*this.scale;break;default:this.width=ee.QuarterNoteHeadWidth*(this._isGrace?ee.GraceScale:1)*this.scale;break}this.height=ee.NoteHeadHeight*e}static getSymbol(e){switch(e){case k.QuadrupleWhole:return f.NoteheadDoubleWholeSquare;case k.DoubleWhole:return f.NoteheadDoubleWhole;case k.Whole:return f.NoteheadWhole;case k.Half:return f.NoteheadHalf;default:return f.NoteheadBlack}}}ee.GraceScale=.75;ee.NoteHeadHeight=8;ee.QuarterNoteHeadWidth=9;class ol extends ht{constructor(e,t,i,r,n){super(e,t,n?ee.GraceScale:1,ol.getSymbol(i,r,n))}doLayout(){this.width=0}static getSymbol(e,t,i){if(i&&(e=k.Eighth),t===E.Up)switch(e){case k.Eighth:return f.FlagEighthUp;case k.Sixteenth:return f.FlagSixteenthUp;case k.ThirtySecond:return f.FlagThirtySecondUp;case k.SixtyFourth:return f.FlagSixtyFourthUp;case k.OneHundredTwentyEighth:return f.FlagOneHundredTwentyEighthUp;case k.TwoHundredFiftySixth:return f.FlagTwoHundredFiftySixthUp;default:return f.FlagEighthUp}switch(e){case k.Eighth:return f.FlagEighthDown;case k.Sixteenth:return f.FlagSixteenthDown;case k.ThirtySecond:return f.FlagThirtySecondDown;case k.SixtyFourth:return f.FlagSixtyFourthDown;case k.OneHundredTwentyEighth:return f.FlagOneHundredTwentyEighthDown;case k.TwoHundredFiftySixth:return f.FlagOneHundredTwentyEighthDown;default:return f.FlagEighthDown}}}ol.FlagWidth=11;class Ui extends qe{get onTimeX(){return this.onNotes.x+this.onNotes.centerX}constructor(e,t){super(0,0),this.ties=[],this.minWidth=0,this.beat=e,this.ties=[],this.voiceContainer=t}addTie(e){e.renderer=this.renderer,this.ties.push(e)}drawBeamHelperAsFlags(e){return e.hasFlag(!1,void 0)}registerLayoutingInfo(e){let t=this.preNotes.computedWidth+this.onNotes.centerX;this.beat.graceGroup&&!this.beat.graceGroup.isComplete&&(t+=Ui.GraceBeatPadding*this.renderer.scale);let i=this.onNotes.computedWidth-this.onNotes.centerX;const r=this.renderer.helpers.getBeamingHelperForBeat(this.beat);(r&&this.drawBeamHelperAsFlags(r)||this.beat.graceType!==$.None)&&(i+=ol.FlagWidth*this.scale*(this.beat.graceType!==$.None?ee.GraceScale:1));for(const n of this.ties)i+=n.width;this.beat.graceType!==$.None&&(i+=Ui.GraceBeatPadding*this.renderer.scale),e.addBeatSpring(this.beat,t,i),e.setPreBeatSize(this.beat,this.preNotes.computedWidth),e.setOnBeatSize(this.beat,this.onNotes.computedWidth),e.setBeatCenterX(this.beat,this.onNotes.centerX)}applyLayoutingInfo(e){let t=e.getBeatCenterX(this.beat)-this.onNotes.centerX;this.beat.graceGroup&&!this.beat.graceGroup.isComplete&&(t+=Ui.GraceBeatPadding*this.renderer.scale),this.preNotes.x=t,this.preNotes.width=e.getPreBeatSize(this.beat),this.onNotes.width=e.getOnBeatSize(this.beat),this.onNotes.x=this.preNotes.x+this.preNotes.width,this.onNotes.updateBeamingHelper(),this.updateWidth()}doLayout(){this.preNotes.x=0,this.preNotes.renderer=this.renderer,this.preNotes.container=this,this.preNotes.doLayout(),this.onNotes.x=this.preNotes.x+this.preNotes.width,this.onNotes.renderer=this.renderer,this.onNotes.container=this,this.onNotes.doLayout();let e=this.beat.notes.length-1;for(;e>=0;)this.createTies(this.beat.notes[e--]);this.renderer.registerTies(this.ties),this.updateWidth()}updateWidth(){if(this.minWidth=this.preNotes.width+this.onNotes.width,!this.beat.isRest)if(this.onNotes.beamingHelper.beats.length===1)this.beat.duration>=k.Eighth&&(this.minWidth+=20*this.scale);else switch(this.beat.duration){case k.OneHundredTwentyEighth:case k.TwoHundredFiftySixth:this.minWidth+=10*this.scale;break}let e=0;for(let t of this.ties)t.width>e&&(e=t.width);this.minWidth+=e,this.width=this.minWidth}scaleToWidth(e){this.onNotes.updateBeamingHelper(),this.width=e}createTies(e){}static getGroupId(e){return"b"+e.id}paint(e,t,i){if(this.beat.voice.isEmpty||this.preNotes.isEmpty&&this.onNotes.isEmpty&&this.ties.length===0)return;i.beginGroup(Ui.getGroupId(this.beat)),this.preNotes.paint(e+this.x,t+this.y,i),this.onNotes.paint(e+this.x,t+this.y,i);let n=e-this.voiceContainer.x-this.renderer.x,a=t-this.voiceContainer.y-this.renderer.y;for(let o=0,l=this.ties.length;o<l;o++){let h=this.ties[o];h.renderer=this.renderer,h.paint(n,a,i)}i.endGroup()}buildBoundingsLookup(e,t,i,r){let n=new Qw;n.beat=this.beat,n.visualBounds=new si,n.visualBounds.x=t+this.x+this.onNotes.x,n.visualBounds.y=e.visualBounds.y,n.visualBounds.w=this.onNotes.width,n.visualBounds.h=e.visualBounds.h,n.realBounds=new si,n.realBounds.x=t+this.x,n.realBounds.y=e.realBounds.y,n.realBounds.w=this.width,n.realBounds.h=e.realBounds.h,r&&(n.visualBounds.x=t+this.x,n.realBounds.x=n.visualBounds.x),e.addBeat(n),this.renderer.settings.core.includeNoteBounds&&this.onNotes.buildBoundingsLookup(n,t+this.x,i+this.y)}}Ui.GraceBeatPadding=3;class Im{constructor(){this.oldWidth=0,this.newWidth=0,this.settings=null}core(){return this.settings&&this.causeIssue()?this.settings.core:new hb}causeIssue(){return this.settings=null,!0}}class eb{constructor(e){this.activeBeats=e}}class Dl{constructor(e){this.bounds=null,this.beat=e}}class Tv{constructor(e,t){this._startTime=0,this._trackIndexes=null,this._trackIndexLookup=null,this._isDestroyed=!1,this.score=null,this.tracks=[],this._tickCache=null,this.player=null,this._cursorWrapper=null,this._barCursor=null,this._beatCursor=null,this._selectionWrapper=null,this._previousTick=0,this._playerState=dt.Paused,this._currentBeat=null,this._currentBarBounds=null,this._previousStateForCursor=dt.Paused,this._previousCursorCache=null,this._lastScroll=0,this.playedBeatChanged=new Se,this.activeBeatsChanged=new Se,this._beatMouseDown=!1,this._noteMouseDown=!1,this._selectionStart=null,this._selectionEnd=null,this.beatMouseDown=new Se,this.beatMouseMove=new Se,this.beatMouseUp=new Se,this.noteMouseDown=new Se,this.noteMouseMove=new Se,this.noteMouseUp=new Se,this.scoreLoaded=new Se,this.resize=new Se,this.renderStarted=new Se,this.renderFinished=new Se,this.postRenderFinished=new kt,this.error=new Se,this.playerReady=new kt,this.playerFinished=new kt,this.soundFontLoaded=new kt,this.midiLoad=new Se,this.midiLoaded=new Se,this.playerStateChanged=new Se,this.playerPositionChanged=new Se,this.midiEventsPlayed=new Se,this.playbackRangeChanged=new Se,this.settingsUpdated=new kt,this.uiFacade=e,this.container=e.rootContainer,e.initialize(this,t),C.logLevel=this.settings.core.logLevel,this.canvasElement=e.createCanvasElement(),this.container.appendChild(this.canvasElement),this.settings.core.useWorkers&&this.uiFacade.areWorkersSupported&&T.getRenderEngineFactory(this.settings.core.engine).supportsWorkers?this.renderer=this.uiFacade.createWorkerRenderer():this.renderer=new Kw(this.settings),this.container.resize.on(T.throttle(()=>{this._isDestroyed||this.container.width!==this.renderer.width&&this.triggerResize()},e.resizeThrottle));let i=new Im;i.oldWidth=this.renderer.width,i.newWidth=this.container.width|0,i.settings=this.settings,this.onResize(i),this.renderer.preRender.on(this.onRenderStarted.bind(this)),this.renderer.renderFinished.on(r=>{this.onRenderFinished(r)}),this.renderer.postRenderFinished.on(()=>{let r=Date.now()-this._startTime;C.debug("rendering","Rendering completed in "+r+"ms"),this.onPostRenderFinished()}),this.renderer.preRender.on(r=>{this._startTime=Date.now()}),this.renderer.partialLayoutFinished.on(this.appendRenderResult.bind(this)),this.renderer.partialRenderFinished.on(this.updateRenderResult.bind(this)),this.renderer.renderFinished.on(r=>{this.appendRenderResult(r),this.appendRenderResult(null)}),this.renderer.error.on(this.onError.bind(this)),this.settings.player.enablePlayer&&this.setupPlayer(),this.setupClickHandling(),this.uiFacade.beginInvoke(()=>{this.uiFacade.initialRender()})}destroy(){this._isDestroyed=!0,this.player&&this.player.destroy(),this.uiFacade.destroy(),this.renderer.destroy()}updateSettings(){var t;const e=this.score;e&&Re.applyPitchOffsets(this.settings,e),this.renderer.updateSettings(this.settings),this.settings.player.enablePlayer?(this.setupPlayer(),e&&((t=this.player)==null||t.applyTranspositionPitches(Ne.buildTranspositionPitches(e,this.settings)))):this.destroyPlayer(),this.onSettingsUpdated()}load(e,t){try{return this.uiFacade.load(e,i=>{this.renderScore(i,t)},i=>{this.onError(i)})}catch(i){return this.onError(i),!1}}renderScore(e,t){let i=[];if(!t)e.tracks.length>0&&i.push(e.tracks[0]);else if(t.length===0)e.tracks.length>0&&i.push(e.tracks[0]);else if(t.length===1&&t[0]===-1)for(let r of e.tracks)i.push(r);else for(let r of t)r>=0&&r<=e.tracks.length&&i.push(e.tracks[r]);this.internalRenderTracks(e,i)}renderTracks(e){if(e.length>0){let t=e[0].score;for(let i of e)if(i.score!==t){this.onError(new Pt(Nt.General,"All rendered tracks must belong to the same score."));return}this.internalRenderTracks(t,e)}}internalRenderTracks(e,t){if(Re.applyPitchOffsets(this.settings,e),e!==this.score){this.score=e,this.tracks=t,this._trackIndexes=[];for(let i of t)this._trackIndexes.push(i.index);this._trackIndexLookup=new Set(this._trackIndexes),this.onScoreLoaded(e),this.loadMidiForScore(),this.render()}else{this.tracks=t,this._trackIndexes=[];for(let i of t)this._trackIndexes.push(i.index);this._trackIndexLookup=new Set(this._trackIndexes),this.render()}}triggerResize(){if(!this.container.isVisible)C.warning("Rendering","AlphaTab container was invisible while autosizing, waiting for element to become visible",null),this.uiFacade.rootContainerBecameVisible.on(()=>{C.debug("Rendering","AlphaTab container became visible, doing autosizing",null),this.triggerResize()});else{let e=new Im;e.oldWidth=this.renderer.width,e.newWidth=this.container.width,e.settings=this.settings,this.onResize(e),this.renderer.updateSettings(this.settings),this.renderer.width=this.container.width,this.renderer.resizeRender()}}appendRenderResult(e){e?(this.canvasElement.width=e.totalWidth,this.canvasElement.height=e.totalHeight,this._cursorWrapper&&(this._cursorWrapper.width=e.totalWidth,this._cursorWrapper.height=e.totalHeight),(e.width>0||e.height>0)&&this.uiFacade.beginAppendRenderResults(e)):this.uiFacade.beginAppendRenderResults(e)}updateRenderResult(e){e&&e.renderResult&&this.uiFacade.beginUpdateRenderResults(e)}tex(e,t){try{let i=new Ut;i.logErrors=!0,i.initFromString(e,this.settings);let r=i.readScore();this.renderScore(r,t)}catch(i){this.onError(i)}}loadSoundFont(e,t=!1){return this.player?this.uiFacade.loadSoundFont(e,t):!1}resetSoundFonts(){this.player&&this.player.resetSoundFonts()}render(){this.renderer&&(this.uiFacade.canRender?(this.renderer.width=this.container.width,this.renderer.renderScore(this.score,this._trackIndexes)):this.uiFacade.canRenderChanged.on(()=>this.render()))}get tickCache(){return this._tickCache}get isReadyForPlayback(){return this.player?this.player.isReadyForPlayback:!1}get playerState(){return this.player?this.player.state:dt.Paused}get masterVolume(){return this.player?this.player.masterVolume:0}set masterVolume(e){this.player&&(this.player.masterVolume=e)}get metronomeVolume(){return this.player?this.player.metronomeVolume:0}set metronomeVolume(e){this.player&&(this.player.metronomeVolume=e)}get countInVolume(){return this.player?this.player.countInVolume:0}set countInVolume(e){this.player&&(this.player.countInVolume=e)}get midiEventsPlayedFilter(){return this.player?this.player.midiEventsPlayedFilter:[]}set midiEventsPlayedFilter(e){this.player&&(this.player.midiEventsPlayedFilter=e)}get tickPosition(){return this.player?this.player.tickPosition:0}set tickPosition(e){this.player&&(this.player.tickPosition=e)}get timePosition(){return this.player?this.player.timePosition:0}set timePosition(e){this.player&&(this.player.timePosition=e)}get playbackRange(){return this.player?this.player.playbackRange:null}set playbackRange(e){this.player&&(this.player.playbackRange=e,this.settings.player.enableCursor&&this.updateSelectionCursor(e))}get playbackSpeed(){return this.player?this.player.playbackSpeed:0}set playbackSpeed(e){this.player&&(this.player.playbackSpeed=e)}get isLooping(){return this.player?this.player.isLooping:!1}set isLooping(e){this.player&&(this.player.isLooping=e)}destroyPlayer(){this.player&&(this.player.destroy(),this.player=null,this._previousTick=0,this._playerState=dt.Paused,this.destroyCursors())}setupPlayer(){this.updateCursors(),!this.player&&(this.player=this.uiFacade.createWorkerPlayer(),this.player&&(this.player.ready.on(()=>{this.loadMidiForScore()}),this.player.readyForPlayback.on(()=>{if(this.onPlayerReady(),this.tracks)for(let e of this.tracks){let t=e.playbackInfo.volume/16;this.player.setChannelVolume(e.playbackInfo.primaryChannel,t),this.player.setChannelVolume(e.playbackInfo.secondaryChannel,t)}}),this.player.soundFontLoaded.on(this.onSoundFontLoaded.bind(this)),this.player.soundFontLoadFailed.on(e=>{this.onError(e)}),this.player.midiLoaded.on(this.onMidiLoaded.bind(this)),this.player.midiLoadFailed.on(e=>{this.onError(e)}),this.player.stateChanged.on(this.onPlayerStateChanged.bind(this)),this.player.positionChanged.on(this.onPlayerPositionChanged.bind(this)),this.player.midiEventsPlayed.on(this.onMidiEventsPlayed.bind(this)),this.player.playbackRangeChanged.on(this.onPlaybackRangeChanged.bind(this)),this.player.finished.on(this.onPlayerFinished.bind(this)),this.setupPlayerEvents()))}loadMidiForScore(){if(!this.player||!this.score||!this.player.isReady)return;C.debug("AlphaTab","Generating Midi");let e=new zr,t=new Ws(e),i=new Ne(this.score,this.settings,t);i.applyTranspositionPitches=!1,i.generate(),this._tickCache=i.tickLookup,this.onMidiLoad(e),this.player.loadMidiFile(e),this.player.applyTranspositionPitches(i.transpositionPitches)}changeTrackVolume(e,t){if(this.player)for(let i of e)this.player.setChannelVolume(i.playbackInfo.primaryChannel,t),this.player.setChannelVolume(i.playbackInfo.secondaryChannel,t)}changeTrackSolo(e,t){if(this.player)for(let i of e)this.player.setChannelSolo(i.playbackInfo.primaryChannel,t),this.player.setChannelSolo(i.playbackInfo.secondaryChannel,t)}changeTrackMute(e,t){if(this.player)for(let i of e)this.player.setChannelMute(i.playbackInfo.primaryChannel,t),this.player.setChannelMute(i.playbackInfo.secondaryChannel,t)}changeTrackTranspositionPitch(e,t){if(this.player)for(let i of e)this.player.setChannelTranspositionPitch(i.playbackInfo.primaryChannel,t),this.player.setChannelTranspositionPitch(i.playbackInfo.secondaryChannel,t)}play(){return this.player?this.player.play():!1}pause(){this.player&&this.player.pause()}playPause(){this.player&&this.player.playPause()}stop(){this.player&&this.player.stop()}playBeat(e){if(!this.player)return;let t=new zr,i=new Ws(t);new Ne(e.voice.bar.staff.track.score,this.settings,i).generateSingleBeat(e),this.player.playOneTimeMidiFile(t)}playNote(e){if(!this.player)return;let t=new zr,i=new Ws(t);new Ne(e.beat.voice.bar.staff.track.score,this.settings,i).generateSingleNote(e),this.player.playOneTimeMidiFile(t)}destroyCursors(){this._cursorWrapper&&(this.uiFacade.destroyCursors(),this._cursorWrapper=null,this._barCursor=null,this._beatCursor=null,this._selectionWrapper=null)}updateCursors(){if(this.settings.player.enableCursor&&!this._cursorWrapper){let e=this.uiFacade.createCursors();e&&(this._cursorWrapper=e.cursorWrapper,this._barCursor=e.barCursor,this._beatCursor=e.beatCursor,this._selectionWrapper=e.selectionWrapper),this._currentBeat!==null&&this.cursorUpdateBeat(this._currentBeat,!1,this._previousTick>10,!0)}else!this.settings.player.enableCursor&&this._cursorWrapper&&this.destroyCursors()}setupPlayerEvents(){this._previousTick=0,this._playerState=dt.Paused,this.renderer.postRenderFinished.on(()=>{this._currentBeat=null,this.cursorUpdateTick(this._previousTick,!1,this._previousTick>10)}),this.player&&(this.player.positionChanged.on(e=>{this._previousTick=e.currentTick,this.uiFacade.beginInvoke(()=>{this.cursorUpdateTick(e.currentTick,!1)})}),this.player.stateChanged.on(e=>{if(this._playerState=e.state,!e.stopped&&e.state===dt.Paused){let t=this._currentBeat,i=this._tickCache;t&&i&&(this.player.tickPosition=i.getBeatStart(t.beat))}}))}cursorUpdateTick(e,t,i=!1){let r=this._tickCache;if(r){let n=this._trackIndexLookup;if(n!=null&&n.size>0){let a=r.findBeat(n,e,this._currentBeat);a&&this.cursorUpdateBeat(a,t,i)}}}cursorUpdateBeat(e,t,i,r=!1){var g;const n=e.beat,a=((g=e.nextBeat)==null?void 0:g.beat)??null,o=e.duration,l=e.beatLookup.highlightedBeats;if(!n)return;let h=this.renderer.boundsLookup;if(!h)return;let u=this._currentBeat,c=this._previousCursorCache,d=this._previousStateForCursor;if(!r&&n===(u==null?void 0:u.beat)&&h===c&&d===this._playerState)return;let p=h.findBeat(n);p&&(this._currentBeat=e,this._previousCursorCache=h,this._previousStateForCursor=this._playerState,this.uiFacade.beginInvoke(()=>{this.internalCursorUpdateBeat(n,a,o,t,l,h,p,i)}))}scrollToCursor(){const e=this._currentBarBounds;e&&this.internalScrollToCursor(e)}internalScrollToCursor(e){let t=this.uiFacade.getScrollContainer(),i=T.getLayoutEngineFactory(this.settings.display.layoutMode).vertical,r=this.settings.player.scrollMode;if(i){let n=e.realBounds.y+this.settings.player.scrollOffsetY;if(n!==this._lastScroll)switch(this._lastScroll=n,r){case ir.Continuous:let a=this.uiFacade.getOffset(t,this.container);this.uiFacade.scrollToY(t,a.y+n,this.settings.player.scrollSpeed);break;case ir.OffScreen:let o=t.scrollTop+this.uiFacade.getOffset(null,t).h;if(e.visualBounds.y+e.visualBounds.h>=o||e.visualBounds.y<t.scrollTop){let l=e.realBounds.y+this.settings.player.scrollOffsetY;this.uiFacade.scrollToY(t,l,this.settings.player.scrollSpeed)}break}}else{let n=e.visualBounds.x;if(n!==this._lastScroll)switch(this._lastScroll=n,r){case ir.Continuous:let a=e.realBounds.x+this.settings.player.scrollOffsetX;this._lastScroll=e.visualBounds.x,this.uiFacade.scrollToX(t,a,this.settings.player.scrollSpeed);break;case ir.OffScreen:let o=t.scrollLeft+this.uiFacade.getOffset(null,t).w;if(e.visualBounds.x+e.visualBounds.w>=o||e.visualBounds.x<t.scrollLeft){let l=e.realBounds.x+this.settings.player.scrollOffsetX;this._lastScroll=e.visualBounds.x,this.uiFacade.scrollToX(t,l,this.settings.player.scrollSpeed)}break}}}internalCursorUpdateBeat(e,t,i,r,n,a,o,l){const h=this._barCursor,u=this._beatCursor;let c=o.barBounds.masterBarBounds,d=c.visualBounds;this._currentBarBounds=c,h&&h.setBounds(d.x,d.y,d.w,d.h),u&&(this.settings.player.enableAnimatedBeatCursor&&u.stopAnimation(),u.setBounds(o.visualBounds.x,d.y,1,d.h)),this.settings.player.enableElementHighlighting&&this.uiFacade.removeHighlights();let p=!1;if(this._playerState===dt.Playing&&!r){if(this.settings.player.enableElementHighlighting)for(let g of n){let w=Ui.getGroupId(g.beat);this.uiFacade.highlightElements(w,e.voice.bar.index)}if(this.settings.player.enableAnimatedBeatCursor){let g=c.visualBounds.x+c.visualBounds.w;if(t){let w=a.findBeat(t);w&&w.barBounds.masterBarBounds.staffSystemBounds===c.staffSystemBounds&&(g=w.visualBounds.x)}this.uiFacade.beginInvoke(()=>{u&&u.transitionToX(i/this.playbackSpeed,g)})}l=!r,p=!0}l&&!this._beatMouseDown&&this.settings.player.scrollMode!==ir.Off&&this.internalScrollToCursor(c),p&&(this.onPlayedBeatChanged(e),this.onActiveBeatsChanged(new eb(n.map(g=>g.beat))))}onPlayedBeatChanged(e){this._isDestroyed||(this.playedBeatChanged.trigger(e),this.uiFacade.triggerEvent(this.container,"playedBeatChanged",e))}onActiveBeatsChanged(e){this._isDestroyed||(this.activeBeatsChanged.trigger(e),this.uiFacade.triggerEvent(this.container,"activeBeatsChanged",e))}onBeatMouseDown(e,t){this._isDestroyed||(this.settings.player.enablePlayer&&this.settings.player.enableCursor&&this.settings.player.enableUserInteraction&&(this._selectionStart=new Dl(t),this._selectionEnd=null),this._beatMouseDown=!0,this.beatMouseDown.trigger(t),this.uiFacade.triggerEvent(this.container,"beatMouseDown",t,e))}onNoteMouseDown(e,t){this._isDestroyed||(this._noteMouseDown=!0,this.noteMouseDown.trigger(t),this.uiFacade.triggerEvent(this.container,"noteMouseDown",t,e))}onBeatMouseMove(e,t){this._isDestroyed||(this.settings.player.enableUserInteraction&&(!this._selectionEnd||this._selectionEnd.beat!==t)&&(this._selectionEnd=new Dl(t),this.cursorSelectRange(this._selectionStart,this._selectionEnd)),this.beatMouseMove.trigger(t),this.uiFacade.triggerEvent(this.container,"beatMouseMove",t,e))}onNoteMouseMove(e,t){this._isDestroyed||(this.noteMouseMove.trigger(t),this.uiFacade.triggerEvent(this.container,"noteMouseMove",t,e))}onBeatMouseUp(e,t){var i,r;if(!this._isDestroyed){if(this.settings.player.enablePlayer&&this.settings.player.enableCursor&&this.settings.player.enableUserInteraction){if(this._selectionEnd){let n=((i=this._tickCache)==null?void 0:i.getBeatStart(this._selectionStart.beat))??this._selectionStart.beat.absolutePlaybackStart;if((((r=this._tickCache)==null?void 0:r.getBeatStart(this._selectionEnd.beat))??this._selectionEnd.beat.absolutePlaybackStart)<n){let o=this._selectionStart;this._selectionStart=this._selectionEnd,this._selectionEnd=o}}if(this._selectionStart&&this._tickCache){let n=this._tickCache,a=n.getMasterBarStart(this._selectionStart.beat.voice.bar.masterBar);if(this._currentBeat=null,this._playerState===dt.Paused&&this.cursorUpdateTick(this._tickCache.getBeatStart(this._selectionStart.beat),!1),this.tickPosition=a+this._selectionStart.beat.playbackStart,this._selectionEnd&&this._selectionStart.beat!==this._selectionEnd.beat){let o=n.getMasterBarStart(this._selectionEnd.beat.voice.bar.masterBar),l=new Zw;l.startTick=a+this._selectionStart.beat.playbackStart,l.endTick=o+this._selectionEnd.beat.playbackStart+this._selectionEnd.beat.playbackDuration-50,this.playbackRange=l}else this._selectionStart=null,this.playbackRange=null,this.cursorSelectRange(this._selectionStart,this._selectionEnd)}}this.beatMouseUp.trigger(t),this.uiFacade.triggerEvent(this.container,"beatMouseUp",t,e),this._beatMouseDown=!1}}onNoteMouseUp(e,t){this._isDestroyed||(this.noteMouseUp.trigger(t),this.uiFacade.triggerEvent(this.container,"noteMouseUp",t,e),this._noteMouseDown=!1)}updateSelectionCursor(e){if(this._tickCache)if(e){const t=this._tickCache.findBeat(this._trackIndexLookup,e.startTick),i=this._tickCache.findBeat(this._trackIndexLookup,e.endTick);if(t&&i){const r=new Dl(t.beat),n=new Dl(i.beat);this.cursorSelectRange(r,n)}}else this.cursorSelectRange(null,null)}setupClickHandling(){this.canvasElement.mouseDown.on(e=>{var n,a;if(!e.isLeftMouseButton)return;this.settings.player.enableUserInteraction&&e.preventDefault();let t=e.getX(this.canvasElement),i=e.getY(this.canvasElement),r=((n=this.renderer.boundsLookup)==null?void 0:n.getBeatAtPos(t,i))??null;if(r&&(this.onBeatMouseDown(e,r),this.settings.core.includeNoteBounds)){const o=(a=this.renderer.boundsLookup)==null?void 0:a.getNoteAtPos(r,t,i);o&&this.onNoteMouseDown(e,o)}}),this.canvasElement.mouseMove.on(e=>{var n,a;if(!this._beatMouseDown)return;let t=e.getX(this.canvasElement),i=e.getY(this.canvasElement),r=((n=this.renderer.boundsLookup)==null?void 0:n.getBeatAtPos(t,i))??null;if(r&&(this.onBeatMouseMove(e,r),this._noteMouseDown)){const o=(a=this.renderer.boundsLookup)==null?void 0:a.getNoteAtPos(r,t,i);o&&this.onNoteMouseMove(e,o)}}),this.canvasElement.mouseUp.on(e=>{var n,a;if(!this._beatMouseDown)return;this.settings.player.enableUserInteraction&&e.preventDefault();let t=e.getX(this.canvasElement),i=e.getY(this.canvasElement),r=((n=this.renderer.boundsLookup)==null?void 0:n.getBeatAtPos(t,i))??null;if(this.onBeatMouseUp(e,r),this._noteMouseDown)if(r){const o=((a=this.renderer.boundsLookup)==null?void 0:a.getNoteAtPos(r,t,i))??null;this.onNoteMouseUp(e,o)}else this.onNoteMouseUp(e,null)}),this.renderer.postRenderFinished.on(()=>{!this._selectionStart||!this.settings.player.enablePlayer||!this.settings.player.enableCursor||!this.settings.player.enableUserInteraction||this.cursorSelectRange(this._selectionStart,this._selectionEnd)})}cursorSelectRange(e,t){var h,u;let i=this.renderer.boundsLookup;if(!i)return;let r=this._selectionWrapper;if(!r||(r.clear(),!e||!t||e.beat===t.beat))return;e.bounds||(e.bounds=i.findBeat(e.beat)),t.bounds||(t.bounds=i.findBeat(t.beat));let n=((h=this._tickCache)==null?void 0:h.getBeatStart(e.beat))??e.beat.absolutePlaybackStart;if((((u=this._tickCache)==null?void 0:u.getBeatStart(t.beat))??t.beat.absolutePlaybackStart)<n){let c=e;e=t,t=c}let o=e.bounds.realBounds.x,l=t.bounds.realBounds.x+t.bounds.realBounds.w;if(t.beat.index===t.beat.voice.beats.length-1&&(l=t.bounds.barBounds.masterBarBounds.realBounds.x+t.bounds.barBounds.masterBarBounds.realBounds.w),e.bounds.barBounds.masterBarBounds.staffSystemBounds!==t.bounds.barBounds.masterBarBounds.staffSystemBounds){let c=e.bounds.barBounds.masterBarBounds.staffSystemBounds.visualBounds.x,d=e.bounds.barBounds.masterBarBounds.staffSystemBounds.visualBounds.x+e.bounds.barBounds.masterBarBounds.staffSystemBounds.visualBounds.w,p=this.uiFacade.createSelectionElement();p.setBounds(o,e.bounds.barBounds.masterBarBounds.visualBounds.y,d-o,e.bounds.barBounds.masterBarBounds.visualBounds.h),r.appendChild(p);let g=e.bounds.barBounds.masterBarBounds.staffSystemBounds.index+1,w=t.bounds.barBounds.masterBarBounds.staffSystemBounds.index;for(let b=g;b<w;b++){let m=i.staffSystems[b],y=this.uiFacade.createSelectionElement();y.setBounds(c,m.visualBounds.y,d-c,m.visualBounds.h),r.appendChild(y)}let S=this.uiFacade.createSelectionElement();S.setBounds(c,t.bounds.barBounds.masterBarBounds.visualBounds.y,l-c,t.bounds.barBounds.masterBarBounds.visualBounds.h),r.appendChild(S)}else{let c=this.uiFacade.createSelectionElement();c.setBounds(o,e.bounds.barBounds.masterBarBounds.visualBounds.y,l-o,e.bounds.barBounds.masterBarBounds.visualBounds.h),r.appendChild(c)}}onScoreLoaded(e){this._isDestroyed||(this.scoreLoaded.trigger(e),this.uiFacade.triggerEvent(this.container,"scoreLoaded",e))}onResize(e){this._isDestroyed||(this.resize.trigger(e),this.uiFacade.triggerEvent(this.container,"resize",e))}onRenderStarted(e){this._isDestroyed||(this.renderStarted.trigger(e),this.uiFacade.triggerEvent(this.container,"renderStarted",e))}onRenderFinished(e){this._isDestroyed||(this.renderFinished.trigger(e),this.uiFacade.triggerEvent(this.container,"renderFinished",e))}onPostRenderFinished(){this._isDestroyed||(this.postRenderFinished.trigger(),this.uiFacade.triggerEvent(this.container,"postRenderFinished",null))}onError(e){this._isDestroyed||(C.error("API","An unexpected error occurred",e),this.error.trigger(e),this.uiFacade.triggerEvent(this.container,"error",e))}onPlayerReady(){this._isDestroyed||(this.playerReady.trigger(),this.uiFacade.triggerEvent(this.container,"playerReady",null))}onPlayerFinished(){this._isDestroyed||(this.playerFinished.trigger(),this.uiFacade.triggerEvent(this.container,"playerFinished",null))}onSoundFontLoaded(){this._isDestroyed||(this.soundFontLoaded.trigger(),this.uiFacade.triggerEvent(this.container,"soundFontLoaded",null))}onMidiLoad(e){this._isDestroyed||(this.midiLoad.trigger(e),this.uiFacade.triggerEvent(this.container,"midiLoad",e))}onMidiLoaded(e){this._isDestroyed||(this.midiLoaded.trigger(e),this.uiFacade.triggerEvent(this.container,"midiFileLoaded",e))}onPlayerStateChanged(e){this._isDestroyed||(this.playerStateChanged.trigger(e),this.uiFacade.triggerEvent(this.container,"playerStateChanged",e))}onPlayerPositionChanged(e){this._isDestroyed||this.score!==null&&this.tracks.length>0&&(this.playerPositionChanged.trigger(e),this.uiFacade.triggerEvent(this.container,"playerPositionChanged",e))}onMidiEventsPlayed(e){this._isDestroyed||(this.midiEventsPlayed.trigger(e),this.uiFacade.triggerEvent(this.container,"midiEventsPlayed",e))}onPlaybackRangeChanged(e){this._isDestroyed||(this.playbackRangeChanged.trigger(e),this.uiFacade.triggerEvent(this.container,"playbackRangeChanged",e))}onSettingsUpdated(){this._isDestroyed||(this.settingsUpdated.trigger(),this.uiFacade.triggerEvent(this.container,"settingsUpdated",null))}}class Zs extends Pt{constructor(e,t){super(Nt.General,e),this.xhr=t,Object.setPrototypeOf(this,Zs.prototype)}}class sa{static loadScoreAsync(e,t,i,r){let n=new XMLHttpRequest;n.open("GET",e,!0,null,null),n.responseType="arraybuffer",n.onreadystatechange=()=>{if(n.readyState===XMLHttpRequest.DONE){let a=n.response;if(n.status===200||n.status===0&&a)try{let o=n.response,l=new Uint8Array(o),h=sa.loadScoreFromBytes(l,r);t(h)}catch(o){i(o)}else n.status===0?i(new Zs(`You are offline!!
 Please Check Your Network.`,n)):n.status===404?i(new Zs("Requested URL not found.",n)):n.status===500?i(new Zs("Internel Server Error.",n)):n.statusText==="parsererror"?i(new Zs(`Error.
Parsing JSON Request failed.`,n)):n.statusText==="timeout"?i(new Zs("Request Time out.",n)):i(new Zs("Unknow Error: "+n.responseText,n))}},n.send()}static loadScoreFromBytes(e,t){t||(t=new vn);let i=T.buildImporters();C.debug("ScoreLoader",`Loading score from ${e.length} bytes using ${i.length} importers`);let r=null,n=Tt.fromBuffer(e);for(let a of i){n.reset();try{C.debug("ScoreLoader","Importing using importer "+a.name),a.init(n,t),r=a.readScore(),C.debug("ScoreLoader","Score imported using "+a.name);break}catch(o){if(o instanceof Ye)C.debug("ScoreLoader",a.name+" does not support the file");else throw C.error("ScoreLoader","Score import failed due to unexpected error: ",o),o}}if(r)return r;throw new Ye("No compatible importer found for file")}}class bc{get isLeftMouseButton(){return this.mouseEvent.button===0}getX(e){let t=e.element,r=t.getBoundingClientRect().left+t.ownerDocument.defaultView.pageXOffset;return this.mouseEvent.pageX-r}getY(e){let t=e.element,r=t.getBoundingClientRect().top+t.ownerDocument.defaultView.pageYOffset;return this.mouseEvent.pageY-r}preventDefault(){this.mouseEvent.preventDefault()}constructor(e){this.mouseEvent=e}}class zs{get width(){return this.element.offsetWidth}set width(e){this.element.style.width=e+"px"}get scrollLeft(){return this.element.scrollLeft}set scrollLeft(e){this.element.scrollTop=e}get scrollTop(){return this.element.scrollLeft}set scrollTop(e){this.element.scrollTop=e}get height(){return this.element.offsetHeight}set height(e){e>=0?this.element.style.height=e+"px":this.element.style.height="100%"}get isVisible(){return!!this.element.offsetWidth||!!this.element.offsetHeight||!!this.element.getClientRects().length}constructor(e){this._resizeListeners=0,this.lastBounds=new si,this.element=e,this.mouseDown={on:t=>{this.element.addEventListener("mousedown",i=>{t(new bc(i))},!0)},off:t=>{}},this.mouseUp={on:t=>{this.element.addEventListener("mouseup",i=>{t(new bc(i))},!0)},off:t=>{}},this.mouseMove={on:t=>{this.element.addEventListener("mousemove",i=>{t(new bc(i))},!0)},off:t=>{}},this.resize={on:t=>{this._resizeListeners===0&&zs.resizeObserver.value.observe(this.element),this.element.addEventListener("resize",t,!0),this._resizeListeners++},off:t=>{this.element.removeEventListener("resize",t,!0),this._resizeListeners--,this._resizeListeners<=0&&(this._resizeListeners=0,zs.resizeObserver.value.unobserve(this.element))}}}stopAnimation(){this.element.style.transition="none"}transitionToX(e,t){this.element.style.transition=`transform ${e}ms linear`,this.setBounds(t,NaN,NaN,NaN)}setBounds(e,t,i,r){isNaN(e)&&(e=this.lastBounds.x),isNaN(t)&&(t=this.lastBounds.y),isNaN(i)&&(i=this.lastBounds.w),isNaN(r)&&(r=this.lastBounds.h),this.element.style.transform=`translate(${e}px, ${t}px) scale(${i}, ${r})`,this.element.style.transformOrigin="top left",this.lastBounds.x=e,this.lastBounds.y=t,this.lastBounds.w=i,this.lastBounds.h=r}appendChild(e){this.element.appendChild(e.element)}clear(){this.element.innerHTML=""}}zs.resizeObserver=new xw(()=>new ResizeObserver(s=>{for(const e of s){let t=new CustomEvent("resize",{detail:e});e.target.dispatchEvent(t)}}));class tb{constructor(e){this._isStarted=!1,this.isFontLoaded=!1,this.fontLoaded=new Se,this._originalFamilies=e,this._families=e}checkForFontAvailability(){if(T.isRunningInWorker){this.isFontLoaded=!1;return}if(this._isStarted)return;this._isStarted=!0;let e=0,t=window.setInterval(()=>{C.warning("Rendering",`Could not load font '${this._families[0]}' within ${(e+1)*5} seconds`,null),this._families.length>1?(this._families.shift(),e=0):e++},5e3);C.debug("Font",`Start checking for font availablility: ${this._families.join(", ")}`);let i=a=>{this._families.length>1?(C.debug("Font",`[${this._families[0]}] Loading Failed, switching to ${this._families[1]}`,a),this._families.shift(),window.setTimeout(()=>{n()},0)):(C.error("Font",`[${this._originalFamilies.join(",")}] Loading Failed, rendering cannot start`,a),window.clearInterval(t))},r=a=>{C.debug("Font",`[${a}] Font API signaled available`),this.isFontLoaded=!0,window.clearInterval(t),this.fontLoaded.trigger(this._families[0])},n=async()=>{for(const a of this._families)if(await this.isFontAvailable(a,!1)){r(a);return}try{await document.fonts.load(`1em ${this._families[0]}`)}catch(a){i(a)}return C.debug("Font",`[${this._families[0]}] Font API signaled loaded`),await this.isFontAvailable(this._families[0],!0)?r(this._families[0]):i("Font not available"),!0};document.fonts.ready.then(()=>{n()})}isFontAvailable(e,t){return new Promise(i=>{const r="1em "+e;if(document.fonts.check(r))i(!0);else if(t){C.debug("Font",`Font ${e} not available, creating test element to trigger load`);const n=document.createElement("div");n.style.font=r,n.style.opacity="0",n.style.position="absolute",n.style.top="0",n.style.left="0",n.innerText=`Trigger ${e} load`,document.body.appendChild(n),setTimeout(()=>{document.body.removeChild(n),document.fonts.check(r)?i(!0):i(!1)},200)}else i(!1)})}}class up{constructor(e){this._writePosition=0,this._readPosition=0,this.count=0,this._buffer=new Float32Array(e)}clear(){this._readPosition=0,this._writePosition=0,this.count=0,this._buffer=new Float32Array(this._buffer.length)}write(e,t,i){let r=0;i>this._buffer.length-this.count&&(i=this._buffer.length-this.count);const n=Math.min(this._buffer.length-this._writePosition,i);return this._buffer.set(e.subarray(t,t+n),this._writePosition),this._writePosition+=n,this._writePosition%=this._buffer.length,r+=n,r<i&&(this._buffer.set(e.subarray(t+r,t+r+i-r),this._writePosition),this._writePosition+=i-r,r=i),this.count+=r,r}read(e,t,i){i>this.count&&(i=this.count);let r=0;const n=Math.min(this._buffer.length-this._readPosition,i);return e.set(this._buffer.subarray(this._readPosition,this._readPosition+n),t),r+=n,this._readPosition+=n,this._readPosition%=this._buffer.length,r<i&&(e.set(this._buffer.subarray(this._readPosition,this._readPosition+i-r),t+r),this._readPosition+=i-r,r=i),this.count-=r,r}}class zi{constructor(){this._context=null,this._buffer=null,this._source=null,this.ready=new kt,this.samplesPlayed=new Se,this.sampleRequest=new kt}get sampleRate(){return this._context?this._context.sampleRate:zi.PreferredSampleRate}activate(e){this._context||(this._context=this.createAudioContext()),(this._context.state==="suspended"||this._context.state==="interrupted")&&(C.debug("WebAudio","Audio Context is suspended, trying resume"),this._context.resume().then(()=>{var t,i;C.debug("WebAudio",`Audio Context resume success: state=${(t=this._context)==null?void 0:t.state}, sampleRate:${(i=this._context)==null?void 0:i.sampleRate}`),e&&e()},t=>{var i,r;C.warning("WebAudio",`Audio Context resume failed: state=${(i=this._context)==null?void 0:i.state}, sampleRate:${(r=this._context)==null?void 0:r.sampleRate}, reason=${t}`)}))}patchIosSampleRate(){let e=navigator.userAgent;if(e.indexOf("iPhone")!==-1||e.indexOf("iPad")!==-1){let t=this.createAudioContext(),i=t.createBuffer(1,1,zi.PreferredSampleRate),r=t.createBufferSource();r.buffer=i,r.connect(t.destination),r.start(0),r.disconnect(0),t.close()}}createAudioContext(){if("AudioContext"in T.globalThis)return new AudioContext;if("webkitAudioContext"in T.globalThis)return new webkitAudioContext;throw new Pt(Nt.General,"AudioContext not found")}open(e){this.patchIosSampleRate(),this._context=this.createAudioContext(),this._context.state==="suspended"&&this.registerResumeHandler()}registerResumeHandler(){this._resumeHandler=(()=>{this.activate(()=>{this.unregisterResumeHandler()})}).bind(this),document.body.addEventListener("touchend",this._resumeHandler,!1),document.body.addEventListener("click",this._resumeHandler,!1)}unregisterResumeHandler(){const e=this._resumeHandler;e&&(document.body.removeEventListener("touchend",e,!1),document.body.removeEventListener("click",e,!1))}play(){let e=this._context;this.activate(),this._buffer=e.createBuffer(2,zi.BufferSize,e.sampleRate),this._source=e.createBufferSource(),this._source.buffer=this._buffer,this._source.loop=!0}pause(){this._source&&(this._source.stop(0),this._source.disconnect()),this._source=null}destroy(){var e;this.pause(),(e=this._context)==null||e.close(),this._context=null,this.unregisterResumeHandler()}onSamplesPlayed(e){this.samplesPlayed.trigger(e)}onSampleRequest(){this.sampleRequest.trigger()}onReady(){this.ready.trigger()}}zi.BufferSize=4096;zi.PreferredSampleRate=44100;class ib extends zi{constructor(){super(...arguments),this._audioNode=null,this._bufferCount=0,this._requestedBufferCount=0,this._outputBuffer=new Float32Array(0)}open(e){super.open(e),this._bufferCount=Math.floor(e*this.sampleRate/1e3/zi.BufferSize),this._circularBuffer=new up(zi.BufferSize*this._bufferCount),this.onReady()}play(){super.play();let e=this._context;this._audioNode=e.createScriptProcessor(4096,0,2),this._audioNode.onaudioprocess=this.generateSound.bind(this),this._circularBuffer.clear(),this.requestBuffers(),this._source=e.createBufferSource(),this._source.buffer=this._buffer,this._source.loop=!0,this._source.connect(this._audioNode,0,0),this._source.start(0),this._audioNode.connect(e.destination,0,0)}pause(){super.pause(),this._audioNode&&this._audioNode.disconnect(0),this._audioNode=null}addSamples(e){this._circularBuffer.write(e,0,e.length),this._requestedBufferCount--}resetSamples(){this._circularBuffer.clear()}requestBuffers(){const e=this._bufferCount/2|0;let t=e*zi.BufferSize;if(this._circularBuffer.count+this._requestedBufferCount*zi.BufferSize<t){for(let r=0;r<e;r++)this.onSampleRequest();this._requestedBufferCount+=e}}generateSound(e){let t=e.outputBuffer.getChannelData(0),i=e.outputBuffer.getChannelData(1),r=t.length+i.length,n=this._outputBuffer;n.length!==r&&(n=new Float32Array(r),this._outputBuffer=n);const a=this._circularBuffer.read(n,0,Math.min(n.length,this._circularBuffer.count));let o=0;const l=Math.min(t.length,a);for(let h=0;h<l;h++)t[h]=n[o++],i[h]=n[o++];if(a<t.length)for(let h=a;h<t.length;h++)t[h]=0,i[h]=0;this.onSamplesPlayed(a/le.AudioChannels),this.requestBuffers()}}class Nv{constructor(e,t){this.loaded=e,this.total=t}}class Hd{get isReady(){return this._workerIsReady&&this._outputIsReady}get isReadyForPlayback(){return this._workerIsReadyForPlayback}get state(){return this._state}get logLevel(){return C.logLevel}set logLevel(e){C.logLevel=e,this._synth.postMessage({cmd:"alphaSynth.setLogLevel",value:e})}get masterVolume(){return this._masterVolume}set masterVolume(e){e=Math.max(e,le.MinVolume),this._masterVolume=e,this._synth.postMessage({cmd:"alphaSynth.setMasterVolume",value:e})}get metronomeVolume(){return this._metronomeVolume}set metronomeVolume(e){e=Math.max(e,le.MinVolume),this._metronomeVolume=e,this._synth.postMessage({cmd:"alphaSynth.setMetronomeVolume",value:e})}get countInVolume(){return this._countInVolume}set countInVolume(e){e=Math.max(e,le.MinVolume),this._countInVolume=e,this._synth.postMessage({cmd:"alphaSynth.setCountInVolume",value:e})}get midiEventsPlayedFilter(){return this._midiEventsPlayedFilter}set midiEventsPlayedFilter(e){this._midiEventsPlayedFilter=e,this._synth.postMessage({cmd:"alphaSynth.setMidiEventsPlayedFilter",value:e})}get playbackSpeed(){return this._playbackSpeed}set playbackSpeed(e){e=it.clamp(e,le.MinPlaybackSpeed,le.MaxPlaybackSpeed),this._playbackSpeed=e,this._synth.postMessage({cmd:"alphaSynth.setPlaybackSpeed",value:e})}get tickPosition(){return this._tickPosition}set tickPosition(e){e<0&&(e=0),this._tickPosition=e,this._synth.postMessage({cmd:"alphaSynth.setTickPosition",value:e})}get timePosition(){return this._timePosition}set timePosition(e){e<0&&(e=0),this._timePosition=e,this._synth.postMessage({cmd:"alphaSynth.setTimePosition",value:e})}get isLooping(){return this._isLooping}set isLooping(e){this._isLooping=e,this._synth.postMessage({cmd:"alphaSynth.setIsLooping",value:e})}get playbackRange(){return this._playbackRange}set playbackRange(e){e&&(e.startTick<0&&(e.startTick=0),e.endTick<0&&(e.endTick=0)),this._playbackRange=e,this._synth.postMessage({cmd:"alphaSynth.setPlaybackRange",value:e})}constructor(e,t){this._workerIsReadyForPlayback=!1,this._workerIsReady=!1,this._outputIsReady=!1,this._state=dt.Paused,this._masterVolume=0,this._metronomeVolume=0,this._countInVolume=0,this._playbackSpeed=0,this._tickPosition=0,this._timePosition=0,this._isLooping=!1,this._playbackRange=null,this._midiEventsPlayedFilter=[],this.ready=new kt,this.readyForPlayback=new kt,this.finished=new kt,this.soundFontLoaded=new kt,this.soundFontLoadFailed=new Se,this.midiLoaded=new Se,this.midiLoadFailed=new Se,this.stateChanged=new Se,this.positionChanged=new Se,this.midiEventsPlayed=new Se,this.playbackRangeChanged=new Se,this._workerIsReadyForPlayback=!1,this._workerIsReady=!1,this._outputIsReady=!1,this._state=dt.Paused,this._masterVolume=0,this._metronomeVolume=0,this._playbackSpeed=0,this._tickPosition=0,this._timePosition=0,this._isLooping=!1,this._playbackRange=null,this._output=e,this._output.ready.on(this.onOutputReady.bind(this)),this._output.samplesPlayed.on(this.onOutputSamplesPlayed.bind(this)),this._output.sampleRequest.on(this.onOutputSampleRequest.bind(this)),this._output.open(t.player.bufferTimeInMilliseconds);try{this._synth=T.createWebWorker(t)}catch(i){C.error("AlphaSynth","Failed to create WebWorker: "+i)}this._synth.addEventListener("message",this.handleWorkerMessage.bind(this),!1),this._synth.postMessage({cmd:"alphaSynth.initialize",sampleRate:this._output.sampleRate,logLevel:t.core.logLevel,bufferTimeInMilliseconds:t.player.bufferTimeInMilliseconds}),this.masterVolume=1,this.playbackSpeed=1,this.metronomeVolume=0}destroy(){this._synth.postMessage({cmd:"alphaSynth.destroy"})}play(){return this._output.activate(),this._synth.postMessage({cmd:"alphaSynth.play"}),!0}pause(){this._synth.postMessage({cmd:"alphaSynth.pause"})}playPause(){this._output.activate(),this._synth.postMessage({cmd:"alphaSynth.playPause"})}stop(){this._synth.postMessage({cmd:"alphaSynth.stop"})}playOneTimeMidiFile(e){this._synth.postMessage({cmd:"alphaSynth.playOneTimeMidiFile",midi:at.midiFileToJsObject(e)})}loadSoundFont(e,t){this._synth.postMessage({cmd:"alphaSynth.loadSoundFontBytes",data:e,append:t})}loadSoundFontFromUrl(e,t,i){C.debug("AlphaSynth",`Start loading Soundfont from url ${e}`);let r=new XMLHttpRequest;r.open("GET",e,!0,null,null),r.responseType="arraybuffer",r.onload=n=>{let a=new Uint8Array(r.response);this.loadSoundFont(a,t)},r.onerror=n=>{C.error("AlphaSynth","Loading failed: "+n.message),this.soundFontLoadFailed.trigger(new Zs(n.message,r))},r.onprogress=n=>{C.debug("AlphaSynth",`Soundfont downloading: ${n.loaded}/${n.total} bytes`),i(new Nv(n.loaded,n.total))},r.send()}resetSoundFonts(){this._synth.postMessage({cmd:"alphaSynth.resetSoundFonts"})}loadMidiFile(e){this._synth.postMessage({cmd:"alphaSynth.loadMidi",midi:at.midiFileToJsObject(e)})}applyTranspositionPitches(e){this._synth.postMessage({cmd:"alphaSynth.applyTranspositionPitches",transpositionPitches:JSON.stringify(Array.from(e.entries()))})}setChannelTranspositionPitch(e,t){this._synth.postMessage({cmd:"alphaSynth.setChannelTranspositionPitch",channel:e,semitones:t})}setChannelMute(e,t){this._synth.postMessage({cmd:"alphaSynth.setChannelMute",channel:e,mute:t})}resetChannelStates(){this._synth.postMessage({cmd:"alphaSynth.resetChannelStates"})}setChannelSolo(e,t){this._synth.postMessage({cmd:"alphaSynth.setChannelSolo",channel:e,solo:t})}setChannelVolume(e,t){t=Math.max(t,le.MinVolume),this._synth.postMessage({cmd:"alphaSynth.setChannelVolume",channel:e,volume:t})}handleWorkerMessage(e){let t=e.data;switch(t.cmd){case"alphaSynth.ready":this._workerIsReady=!0,this.checkReady();break;case"alphaSynth.destroyed":this._synth.terminate();break;case"alphaSynth.readyForPlayback":this._workerIsReadyForPlayback=!0,this.checkReadyForPlayback();break;case"alphaSynth.positionChanged":this._timePosition=t.currentTime,this._tickPosition=t.currentTick,this.positionChanged.trigger(new Oo(t.currentTime,t.endTime,t.currentTick,t.endTick,t.isSeek));break;case"alphaSynth.midiEventsPlayed":this.midiEventsPlayed.trigger(new ap(t.events.map(at.jsObjectToMidiEvent)));break;case"alphaSynth.playerStateChanged":this._state=t.state,this.stateChanged.trigger(new ho(t.state,t.stopped));break;case"alphaSynth.playbackRangeChanged":this._playbackRange=t.playbackRange,this.playbackRangeChanged.trigger(new op(this._playbackRange));break;case"alphaSynth.finished":this.finished.trigger();break;case"alphaSynth.soundFontLoaded":this.soundFontLoaded.trigger();break;case"alphaSynth.soundFontLoadFailed":this.soundFontLoadFailed.trigger(t.error);break;case"alphaSynth.midiLoaded":this.checkReadyForPlayback(),this.midiLoaded.trigger(new Oo(t.currentTime,t.endTime,t.currentTick,t.endTick,t.isSeek));break;case"alphaSynth.midiLoadFailed":this.checkReadyForPlayback(),this.midiLoadFailed.trigger(t.error);break;case"alphaSynth.output.addSamples":this._output.addSamples(t.samples);break;case"alphaSynth.output.play":this._output.play();break;case"alphaSynth.output.pause":this._output.pause();break;case"alphaSynth.output.destroy":this._output.destroy();break;case"alphaSynth.output.resetSamples":this._output.resetSamples();break}}checkReady(){this.isReady&&this.ready.trigger()}checkReadyForPlayback(){this.isReadyForPlayback&&this.readyForPlayback.trigger()}onOutputSampleRequest(){this._synth.postMessage({cmd:"alphaSynth.output.sampleRequest"})}onOutputSamplesPlayed(e){this._synth.postMessage({cmd:"alphaSynth.output.samplesPlayed",samples:e})}onOutputReady(){this._outputIsReady=!0,this.checkReady()}}class Pv{constructor(e,t){this._width=0,this.boundsLookup=null,this.preRender=new Se,this.partialRenderFinished=new Se,this.partialLayoutFinished=new Se,this.renderFinished=new Se,this.postRenderFinished=new kt,this.error=new Se,this._api=e;try{this._worker=T.createWebWorker(t)}catch(i){C.error("Rendering",`Failed to create WebWorker: ${i}`);return}this._worker.postMessage({cmd:"alphaTab.initialize",settings:this.serializeSettingsForWorker(t)}),this._worker.addEventListener("message",this.handleWorkerMessage.bind(this))}destroy(){this._worker.terminate()}updateSettings(e){this._worker.postMessage({cmd:"alphaTab.updateSettings",settings:this.serializeSettingsForWorker(e)})}serializeSettingsForWorker(e){const t=at.settingsToJsObject(e);return t.delete("player"),t}render(){this._worker.postMessage({cmd:"alphaTab.render"})}resizeRender(){this._worker.postMessage({cmd:"alphaTab.resizeRender"})}renderResult(e){this._worker.postMessage({cmd:"alphaTab.renderResult",resultId:e})}get width(){return this._width}set width(e){this._width=e,this._worker.postMessage({cmd:"alphaTab.setWidth",width:e})}handleWorkerMessage(e){let t=e.data;switch(t.cmd){case"alphaTab.preRender":this.preRender.trigger(t.resize);break;case"alphaTab.partialRenderFinished":this.partialRenderFinished.trigger(t.result);break;case"alphaTab.partialLayoutFinished":this.partialLayoutFinished.trigger(t.result);break;case"alphaTab.renderFinished":this.renderFinished.trigger(t.result);break;case"alphaTab.postRenderFinished":this.boundsLookup=zo.fromJson(t.boundsLookup,this._api.score),this.boundsLookup.finish(),this.postRenderFinished.trigger();break;case"alphaTab.error":this.error.trigger(t.error);break}}renderScore(e,t){let i=e==null?null:at.scoreToJsObject(e);this._worker.postMessage({cmd:"alphaTab.renderScore",score:i,trackIndexes:t,fontSizes:Yt.FontSizeLookupTables})}}class Cv{constructor(e,t,i,r){this.cursorWrapper=e,this.barCursor=t,this.beatCursor=i,this.selectionWrapper=r}}class Go{static init(){var e;Go._isRegistered||(Go._isRegistered=!0,registerProcessor("alphatab",(e=class extends AudioWorkletProcessor{constructor(i){super(i),this._outputBuffer=new Float32Array(0),this._bufferCount=0,this._requestedBufferCount=0,this._isStopped=!1,C.debug("WebAudio","creating processor"),this._bufferCount=Math.floor(i.processorOptions.bufferTimeInMilliseconds*sampleRate/1e3/e.BufferSize),this._circularBuffer=new up(e.BufferSize*this._bufferCount),this.port.onmessage=this.handleMessage.bind(this)}handleMessage(i){let r=i.data;switch(r.cmd){case He.CmdOutputAddSamples:const a=r.samples;this._circularBuffer.write(a,0,a.length),this._requestedBufferCount--;break;case He.CmdOutputResetSamples:this._circularBuffer.clear();break;case He.CmdOutputStop:this._isStopped=!0;break}}process(i,r,n){if(r.length!==1&&r[0].length!==2)return!1;let a=r[0][0],o=r[0][1];if(!a||!o)return!0;let l=a.length+o.length,h=this._outputBuffer;h.length!==l&&(h=new Float32Array(l),this._outputBuffer=h);const u=this._circularBuffer.read(h,0,Math.min(h.length,this._circularBuffer.count));let c=0;const d=Math.min(a.length,u);for(let p=0;p<d;p++)a[p]=h[c++],o[p]=h[c++];if(u<a.length)for(let p=u;p<a.length;p++)a[p]=0,o[p]=0;return this.port.postMessage({cmd:He.CmdOutputSamplesPlayed,samples:u/le.AudioChannels}),this.requestBuffers(),this._circularBuffer.count>0||!this._isStopped}requestBuffers(){const i=this._bufferCount/2|0;let r=i*e.BufferSize;if(this._circularBuffer.count+this._requestedBufferCount*e.BufferSize<r){for(let a=0;a<i;a++)this.port.postMessage({cmd:He.CmdOutputSampleRequest});this._requestedBufferCount+=i}}},e.BufferSize=4096,e)))}}Go._isRegistered=!1;class sb extends zi{constructor(e){super(),this._worklet=null,this._bufferTimeInMilliseconds=0,this._settings=e}open(e){super.open(e),this._bufferTimeInMilliseconds=e,this.onReady()}play(){super.play();let e=this._context;T.createAudioWorklet(e,this._settings).then(()=>{this._worklet=new AudioWorkletNode(e,"alphatab",{numberOfOutputs:1,outputChannelCount:[2],processorOptions:{bufferTimeInMilliseconds:this._bufferTimeInMilliseconds}}),this._worklet.port.onmessage=this.handleMessage.bind(this),this._source.connect(this._worklet),this._source.start(0),this._worklet.connect(e.destination)},t=>{C.error("WebAudio",`Audio Worklet creation failed: reason=${t}`)})}handleMessage(e){let t=e.data;switch(t.cmd){case He.CmdOutputSamplesPlayed:this.onSamplesPlayed(t.samples);break;case He.CmdOutputSampleRequest:this.onSampleRequest();break}}pause(){super.pause(),this._worklet&&(this._worklet.port.postMessage({cmd:He.CmdOutputStop}),this._worklet.port.onmessage=null,this._worklet.disconnect()),this._worklet=null}addSamples(e){var t;(t=this._worklet)==null||t.port.postMessage({cmd:He.CmdOutputAddSamples,samples:e})}resetSamples(){var e;(e=this._worklet)==null||e.port.postMessage({cmd:He.CmdOutputResetSamples})}}class Ev extends zs{constructor(e,t,i){super(e),this._xscale=t,this._yscale=i}get width(){return this.element.offsetWidth/this._xscale}set width(e){this.element.style.width=e*this._xscale+"px"}get height(){return this.element.offsetHeight/this._yscale}set height(e){e>=0?this.element.style.height=e*this._yscale+"px":this.element.style.height="100%"}setBounds(e,t,i,r){isNaN(e)&&(e=this.lastBounds.x),isNaN(t)&&(t=this.lastBounds.y),isNaN(i)?i=this.lastBounds.w:i=i/this._xscale,isNaN(r)?r=this.lastBounds.h:r=r/this._yscale,this.element.style.transform=`translate(${e}px, ${t}px) scale(${i}, ${r})`,this.element.style.transformOrigin="top left",this.lastBounds.x=e,this.lastBounds.y=t,this.lastBounds.w=i,this.lastBounds.h=r}}var Ds;(function(s){s[s.LayoutDone=0]="LayoutDone",s[s.RenderRequested=1]="RenderRequested",s[s.RenderDone=2]="RenderDone",s[s.Detached=3]="Detached"})(Ds||(Ds={}));class Lv{get resizeThrottle(){return 10}get canRender(){return this.areAllFontsLoaded()}areAllFontsLoaded(){if(T.bravuraFontChecker.checkForFontAvailability(),!T.bravuraFontChecker.isFontLoaded)return!1;let e=!1;for(const t of this._fontCheckers.values())t.isFontLoaded||(e=!0);return e?!1:(C.debug("Font","All fonts loaded: "+this._fontCheckers.size),!0)}onFontLoaded(e){Yt.generateFontLookup(e),this.areAllFontsLoaded()&&this.canRenderChanged.trigger()}constructor(e){if(this._fontCheckers=new Map,this._contents=null,this._file=null,this._totalResultCount=0,this._initialTrackIndexes=null,this._barToElementLookup=new Map,this._resultIdToElementLookup=new Map,this.rootContainerBecameVisible=new kt,this.canRenderChanged=new kt,this._highlightedElements=[],this._scrollContainer=null,T.webPlatform!==Ei.Browser&&T.webPlatform!==Ei.BrowserModule)throw new Pt(Nt.General,"Usage of AlphaTabApi is only possible in browser environments. For usage in node use the Low Level APIs");e.classList.add("alphaTab"),this.rootContainer=new zs(e),this.areWorkersSupported="Worker"in window,T.bravuraFontChecker.fontLoaded.on(this.onFontLoaded.bind(this)),this._intersectionObserver=new IntersectionObserver(this.onElementVisibilityChanged.bind(this),{threshold:[0,.01,1]}),this._intersectionObserver.observe(e)}onElementVisibilityChanged(e){for(const t of e){const i=t.target;if(i===this.rootContainer.element)t.isIntersecting&&(this.rootContainerBecameVisible.trigger(),this._intersectionObserver.unobserve(this.rootContainer.element));else if("layoutResultId"in i&&this._api.settings.core.enableLazyLoading){const r=i;t.isIntersecting?r.renderedResultId!==r.layoutResultId?this._resultIdToElementLookup.has(r.layoutResultId)?r.resultState!==Ds.RenderRequested&&(r.resultState=Ds.RenderRequested,this._api.renderer.renderResult(r.layoutResultId)):i.replaceChildren():r.resultState===Ds.Detached&&(i.replaceChildren(...r.renderedResult),r.resultState=Ds.RenderDone):r.resultState===Ds.RenderDone&&(r.resultState=Ds.Detached,r.replaceChildren())}}}createWorkerRenderer(){return new Pv(this._api,this._api.settings)}initialize(e,t){this._api=e;let i;t instanceof vn?i=t:i=at.jsObjectToSettings(t);let r=this.getDataAttributes();Sa.fromJson(i,r),i.notation.notationMode===St.SongBook&&i.setSongBookModeSettings(),e.settings=i,this.setupFontCheckers(i),this._initialTrackIndexes=this.parseTracks(i.core.tracks),this._contents="";let n=e.container;i.core.tex&&(this._contents=n.element.innerHTML,n.element.innerHTML=""),this.createStyleElement(i),this._file=i.core.file}setupFontCheckers(e){this.registerFontChecker(e.display.resources.copyrightFont),this.registerFontChecker(e.display.resources.effectFont),this.registerFontChecker(e.display.resources.fingeringFont),this.registerFontChecker(e.display.resources.graceFont),this.registerFontChecker(e.display.resources.markerFont),this.registerFontChecker(e.display.resources.tablatureFont),this.registerFontChecker(e.display.resources.titleFont),this.registerFontChecker(e.display.resources.wordsFont),this.registerFontChecker(e.display.resources.barNumberFont),this.registerFontChecker(e.display.resources.fretboardNumberFont),this.registerFontChecker(e.display.resources.subTitleFont)}registerFontChecker(e){if(!this._fontCheckers.has(e.families.join(", "))){let t=new tb(e.families);this._fontCheckers.set(e.families.join(", "),t),t.fontLoaded.on(this.onFontLoaded.bind(this)),t.checkForFontAvailability()}}destroy(){this.rootContainer.element.innerHTML=""}createCanvasElement(){let e=document.createElement("div");return e.className="at-surface",e.style.fontSize="0",e.style.overflow="hidden",e.style.lineHeight="0",e.style.position="relative",new zs(e)}triggerEvent(e,t,i=null,r){let n=e.element;t="alphaTab."+t;let a=document.createEvent("CustomEvent"),o=r?r.mouseEvent:null;if(a.initCustomEvent(t,!1,!1,i),o&&(a.originalEvent=o),n.dispatchEvent(a),window&&"jQuery"in window){let l=window.jQuery,h=[];h.push(i),o&&h.push(o),l(n).trigger(t,h)}}load(e,t,i){if(e instanceof Rn)return t(e),!0;if(e instanceof ArrayBuffer){let r=new Uint8Array(e);return t(sa.loadScoreFromBytes(r,this._api.settings)),!0}return e instanceof Uint8Array?(t(sa.loadScoreFromBytes(e,this._api.settings)),!0):typeof e=="string"?(sa.loadScoreAsync(e,t,i,this._api.settings),!0):!1}loadSoundFont(e,t){return this._api.player?e instanceof ArrayBuffer?(this._api.player.loadSoundFont(new Uint8Array(e),t),!0):e instanceof Uint8Array?(this._api.player.loadSoundFont(e,t),!0):typeof e=="string"?(this._api.loadSoundFontFromUrl(e,t),!0):!1:!1}initialRender(){this._api.renderer.preRender.on(t=>{this._totalResultCount=0,this._resultIdToElementLookup.clear(),this._barToElementLookup.clear()});const e=()=>{this._api.renderer.width=this.rootContainer.width|0,this._api.renderer.updateSettings(this._api.settings),this._contents?(this._api.tex(this._contents,this._initialTrackIndexes??void 0),this._initialTrackIndexes=null):this._file&&sa.loadScoreAsync(this._file,t=>{this._api.renderScore(t,this._initialTrackIndexes??void 0),this._initialTrackIndexes=null},t=>{this._api.onError(t)},this._api.settings)};this.rootContainer.isVisible?e():this.rootContainerBecameVisible.on(e)}createStyleElement(e){let t=this._api.container.element.ownerDocument;T.createStyleElement(t,e.core.fontDirectory)}parseTracks(e){if(!e)return[];let t=[];if(typeof e=="string")try{if(e==="all")return[-1];e=JSON.parse(e)}catch{e=[0]}if(typeof e=="number")t.push(e);else if("length"in e){let i=e.length,r=e;for(let n=0;n<i;n++){let a=r[n],o=0;typeof a=="number"?o=a:"index"in a?o=a.index:o=parseInt(a.toString()),(o>=0||o===-1)&&t.push(o)}}else"index"in e&&t.push(e.index);return t}getDataAttributes(){let e=new Map,t=this._api.container.element;if(t.dataset)for(let i of Object.keys(t.dataset)){let r=t.dataset[i];try{r=JSON.parse(r)}catch{r===""&&(r=null)}e.set(i,r)}else for(let i=0;i<t.attributes.length;i++){let r=t.attributes.item(i),n=r.nodeName;if(n.startsWith("data-")){let a=n.substr(5).split("-"),o=a[0];for(let h=1;h<a.length;h++)o+=a[h].substr(0,1).toUpperCase()+a[h].substr(1);let l=r.nodeValue;try{l=JSON.parse(l)}catch{l===""&&(l=null)}e.set(o,l)}}return e}beginUpdateRenderResults(e){if(!this._resultIdToElementLookup.has(e.id))return;const t=this._resultIdToElementLookup.get(e.id),i=e.renderResult;typeof i=="string"?t.innerHTML=i:"nodeType"in i&&t.replaceChildren(i),t.resultState=Ds.RenderDone,t.renderedResultId=e.id,t.renderedResult=Array.from(t.children)}beginAppendRenderResults(e){const t=this._api.canvasElement.element;if(e){let i;this._totalResultCount<t.childElementCount?i=t.childNodes.item(this._totalResultCount):(i=document.createElement("div"),t.appendChild(i)),i.style.zIndex="1",i.style.position="absolute",i.style.left=e.x+"px",i.style.top=e.y+"px",i.style.width=e.width+"px",i.style.height=e.height+"px",i.style.display="inline-block",i.layoutResultId=e.id,i.resultState=Ds.LayoutDone,delete i.renderedResultId,delete i.renderedResult,this._resultIdToElementLookup.set(e.id,i);for(let r=e.firstMasterBarIndex;r<=e.lastMasterBarIndex;r++)r>=0&&this._barToElementLookup.set(r,i);this._api.settings.core.enableLazyLoading&&(this._intersectionObserver.unobserve(i),this._intersectionObserver.observe(i)),this._totalResultCount++}else for(;t.childElementCount>this._totalResultCount;)this._api.settings.core.enableLazyLoading&&this._intersectionObserver.unobserve(t.lastChild),t.removeChild(t.lastElementChild)}createWorkerPlayer(){let e=null,t="ScriptProcessorNode"in window;return window.isSecureContext&&"AudioWorkletNode"in window&&this._api.settings.player.outputMode===Wo.WebAudioAudioWorklets?(C.debug("Player","Will use webworkers for synthesizing and web audio api with worklets for playback"),e=new Hd(new sb(this._api.settings),this._api.settings)):t&&(C.debug("Player","Will use webworkers for synthesizing and web audio api with ScriptProcessor for playback"),e=new Hd(new ib,this._api.settings)),e?e.ready.on(()=>{this._api.settings.player.soundFont&&this._api.loadSoundFontFromUrl(this._api.settings.player.soundFont,!1)}):C.error("Player","Player requires webworkers and web audio api, browser unsupported",null),e}beginInvoke(e){window.requestAnimationFrame(()=>{e()})}highlightElements(e,t){const i=this._barToElementLookup.get(t);if(i){let r=i.getElementsByClassName(e);for(let n=0;n<r.length;n++)r.item(n).classList.add("at-highlight"),this._highlightedElements.push(r.item(n))}}removeHighlights(){const e=this._highlightedElements;if(e){for(const t of e)t.classList.remove("at-highlight");this._highlightedElements=[]}}destroyCursors(){let e=this._api.container.element,t=e.querySelector(".at-cursors");e.removeChild(t)}createCursors(){let e=this._api.container.element,t=document.createElement("div");t.classList.add("at-cursors");let i=document.createElement("div");i.classList.add("at-selection");const r=this.createScalingElement(),n=this.createScalingElement();let a=r.element;a.classList.add("at-cursor-bar");let o=n.element;return o.classList.add("at-cursor-beat"),e.style.position="relative",e.style.textAlign="left",t.style.position="absolute",t.style.zIndex="1000",t.style.display="inline",t.style.pointerEvents="none",i.style.position="absolute",a.style.position="absolute",a.style.left="0",a.style.top="0",a.style.willChange="transform",r.width=1,r.height=1,r.setBounds(0,0,1,1),o.style.position="absolute",o.style.transition="all 0s linear",o.style.left="0",o.style.top="0",o.style.willChange="transform",n.width=3,n.height=1,n.setBounds(0,0,1,1),e.insertBefore(t,e.firstChild),t.appendChild(i),t.appendChild(a),t.appendChild(o),new Cv(new zs(t),r,n,new zs(i))}getOffset(e,t){let i=t.element,r=i.getBoundingClientRect(),n=r.top+i.ownerDocument.defaultView.pageYOffset,a=r.left+i.ownerDocument.defaultView.pageXOffset;if(e){let l=e.element,h=l.nodeName.toLowerCase();if(h!=="html"&&h!=="body"){let u=this.getOffset(null,e);n=n+l.scrollTop-u.y,a=a+l.scrollLeft-u.x}}let o=new si;return o.x=a,o.y=n,o.w=r.width,o.h=r.height,o}getScrollContainer(){if(this._scrollContainer)return this._scrollContainer;let e=typeof this._api.settings.player.scrollElement=="string"?document.querySelector(this._api.settings.player.scrollElement):this._api.settings.player.scrollElement,t=e.nodeName.toLowerCase();return(t==="html"||t==="body")&&("scrollingElement"in document?e=document.scrollingElement:navigator.userAgent.indexOf("WebKit")!==-1?e=document.body:e=document.documentElement),this._scrollContainer=new zs(e),this._scrollContainer}createSelectionElement(){return this.createScalingElement()}createScalingElement(){const e=document.createElement("div");e.style.position="absolute";const t=new Ev(e,100,100);return t.width=1,t.height=1,t.setBounds(0,0,1,1),t}scrollToY(e,t,i){this.internalScrollToY(e.element,t,i)}scrollToX(e,t,i){this.internalScrollToX(e.element,t,i)}internalScrollToY(e,t,i){if(this._api.settings.player.nativeBrowserSmoothScroll)e.scrollTo({top:t,behavior:"smooth"});else{let r=e.scrollTop,n=t-r,a=0,o=l=>{a===0&&(a=l);let h=l-a,u=Math.min(h/i,1);e.scrollTop=r+n*u|0,h<i&&window.requestAnimationFrame(o)};window.requestAnimationFrame(o)}}internalScrollToX(e,t,i){if(this._api.settings.player.nativeBrowserSmoothScroll)e.scrollTo({left:t,behavior:"smooth"});else{let r=e.scrollLeft,n=t-r,a=0,o=l=>{a===0&&(a=l);let h=l-a,u=Math.min(h/i,1);e.scrollLeft=r+n*u|0,h<i&&window.requestAnimationFrame(o)};window.requestAnimationFrame(o)}}}class Tu extends Tv{constructor(e,t){super(new Lv(e),t),this.soundFontLoad=new Se}tex(e,t){let i=this.uiFacade;super.tex(e,i.parseTracks(t))}print(e,t=null){let i=window.open("","","width=0,height=0"),r=i.document.createElement("div");e?r.style.width=e:this.settings.display.layoutMode===ur.Horizontal?r.style.width="297mm":r.style.width="210mm",i.document.write(`
        <!DOCTYPE html>
        <html>
          <head>
            <style>
            .at-surface {
                width: auto !important;
                height: auto !important;
            }
            .at-surface > div {
                position: relative!important;
                left: auto !important;
                top: auto !important;
                break-inside: avoid;
            }
            </style>
          </head>
          <body></body>
        </html>
        `);const n=this.score;n&&(n.artist&&n.title?i.document.title=`${n.title} - ${n.artist}`:n.title&&(i.document.title=`${n.title}`)),i.document.body.appendChild(r);let a=typeof window.screenLeft<"u"?window.screenLeft:window.left,o=typeof window.screenTop<"u"?window.screenTop:window.top,l="innerWidth"in window?window.innerWidth:"clientWidth"in document.documentElement?document.documentElement.clientWidth:window.screen.width,h="innerHeight"in window?window.innerHeight:"clientHeight"in document.documentElement?document.documentElement.clientHeight:window.screen.height,u=r.offsetWidth+50,c=window.innerHeight,d=(l/2|0)-(u/2|0)+a,p=(h/2|0)-(c/2|0)+o;i.resizeTo(u,c),i.moveTo(d,p),i.focus();let g=at.jsObjectToSettings(at.settingsToJsObject(this.settings));g.core.enableLazyLoading=!1,g.core.useWorkers=!0,g.core.file=null,g.core.tracks=null,g.player.enableCursor=!1,g.player.enablePlayer=!1,g.player.enableElementHighlighting=!1,g.player.enableUserInteraction=!1,g.player.soundFont=null,g.display.scale=.8,g.display.stretchForce=.8,Sa.fromJson(g,t);let w=new Tu(r,g);i.onunload=()=>{w.destroy()},w.renderer.postRenderFinished.on(()=>{i.print()}),w.renderTracks(this.tracks)}downloadMidi(e=ba.SingleTrackMultiChannel){if(!this.score)return;let t=new zr;t.format=e;let i=new Ws(t,!0);new Ne(this.score,this.settings,i).generate();let n=t.toBinary(),a=this.score.title?`${this.score.title}.mid`:"File.mid",o=document.createElement("a");o.download=a;let l=new Blob([n],{type:"audio/midi"}),h=URL.createObjectURL(l);o.href=h,o.style.display="none",document.body.appendChild(o),o.click(),document.body.removeChild(o)}changeTrackMute(e,t){let i=this.trackIndexesToTracks(this.uiFacade.parseTracks(e));super.changeTrackMute(i,t)}changeTrackSolo(e,t){let i=this.trackIndexesToTracks(this.uiFacade.parseTracks(e));super.changeTrackSolo(i,t)}changeTrackVolume(e,t){let i=this.trackIndexesToTracks(this.uiFacade.parseTracks(e));super.changeTrackVolume(i,t)}trackIndexesToTracks(e){if(!this.score)return[];let t=[];if(e.length===1&&e[0]===-1)for(let i of this.score.tracks)t.push(i);else for(let i of e)i>=0&&i<this.score.tracks.length&&t.push(this.score.tracks[i]);return t}loadSoundFontFromUrl(e,t){this.player&&this.player.loadSoundFontFromUrl(e,t,i=>{this.soundFontLoad.trigger(i),this.uiFacade.triggerEvent(this.container,"soundFontLoad",i)})}}class Om{constructor(){this._initListeners=[]}exec(e,t,i){if(typeof t!="string"&&(i=[t],t="init"),t.charCodeAt(0)===95||t==="exec")return null;let r=new jQuery(e),n=r.data("alphaTab");if(t==="destroy"&&!n)return null;if(t!=="init"&&!n)throw new Error("alphaTab not initialized");let a=this[t];if(a){let o=[r,n].concat(i);return a.apply(this,o)}else return C.error("Api","Method '"+t+"' does not exist on jQuery.alphaTab"),null}init(e,t,i){if(!t){t=new Tu(e[0],i),e.data("alphaTab",t);for(let r of this._initListeners)r(e,t,i)}}destroy(e,t){e.removeData("alphaTab"),t.destroy()}print(e,t,i,r){t.print(i,r)}load(e,t,i,r){return t.load(i,r)}render(e,t){t.render()}renderScore(e,t,i,r){t.renderScore(i,r)}renderTracks(e,t,i){t.renderTracks(i)}invalidate(e,t){t.render()}tex(e,t,i,r){t.tex(i,r)}muteTrack(e,t,i,r){t.changeTrackMute(i,r)}soloTrack(e,t,i,r){t.changeTrackSolo(i,r)}trackVolume(e,t,i,r){t.changeTrackVolume(i,r)}loadSoundFont(e,t,i,r){t.loadSoundFont(i,r)}resetSoundFonts(e,t){t.resetSoundFonts()}pause(e,t){t.pause()}play(e,t){return t.play()}playPause(e,t){t.playPause()}stop(e,t){t.stop()}api(e,t){return t}player(e,t){return t.player}isReadyForPlayback(e,t){return t.isReadyForPlayback}playerState(e,t){return t.playerState}masterVolume(e,t,i){return typeof i=="number"&&(t.masterVolume=i),t.masterVolume}metronomeVolume(e,t,i){return typeof i=="number"&&(t.metronomeVolume=i),t.metronomeVolume}countInVolume(e,t,i){return typeof i=="number"&&(t.countInVolume=i),t.countInVolume}midiEventsPlayedFilter(e,t,i){return Array.isArray(i)&&(t.midiEventsPlayedFilter=i),t.midiEventsPlayedFilter}playbackSpeed(e,t,i){return typeof i=="number"&&(t.playbackSpeed=i),t.playbackSpeed}tickPosition(e,t,i){return typeof i=="number"&&(t.tickPosition=i),t.tickPosition}timePosition(e,t,i){return typeof i=="number"&&(t.timePosition=i),t.timePosition}loop(e,t,i){return typeof i=="boolean"&&(t.isLooping=i),t.isLooping}renderer(e,t){return t.renderer}score(e,t){return t.score}settings(e,t){return t.settings}tracks(e,t){return t.tracks}_oninit(e){this._initListeners.push(e)}static restore(e){new jQuery(e).empty().removeData("alphaTab")}}class cp{constructor(){this.buffer="",this._currentPath="",this._currentPathIsEmpty=!0,this.color=new Ce(255,255,255,255),this.lineWidth=1,this.font=new he("Arial",10,Ue.Plain),this.textAlign=Y.Left,this.textBaseline=te.Top}destroy(){}beginRender(e,t){this.buffer=`<svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="${e|0}px" height="${t|0}px" class="at-surface-svg">
`,this._currentPath="",this._currentPathIsEmpty=!0,this.textBaseline=te.Top}beginGroup(e){this.buffer+=`<g class="${e}">`}endGroup(){this.buffer+="</g>"}endRender(){return this.buffer+="</svg>",this.buffer}fillRect(e,t,i,r){i>0&&(this.buffer+=`<rect x="${e|0}" y="${t|0}" width="${i}" height="${r}" fill="${this.color.rgba}" />
`)}strokeRect(e,t,i,r){this.buffer+=`<rect x="${e|0}" y="${t|0}" width="${i}" height="${r}" stroke="${this.color.rgba}"`,this.lineWidth!==1&&(this.buffer+=` stroke-width="${this.lineWidth}"`),this.buffer+=` fill="transparent" />
`}beginPath(){}closePath(){this._currentPath+=" z"}moveTo(e,t){this._currentPath+=` M${e},${t}`}lineTo(e,t){this._currentPathIsEmpty=!1,this._currentPath+=` L${e},${t}`}quadraticCurveTo(e,t,i,r){this._currentPathIsEmpty=!1,this._currentPath+=` Q${e},${t},${i},${r}`}bezierCurveTo(e,t,i,r,n,a){this._currentPathIsEmpty=!1,this._currentPath+=` C${e},${t},${i},${r},${n},${a}`}fillCircle(e,t,i){this._currentPathIsEmpty=!1,this._currentPath+=` M${e-i},${t} A1,1 0 0,0 ${e+i},${t} A1,1 0 0,0 ${e-i},${t} z`,this.fill()}strokeCircle(e,t,i){this._currentPathIsEmpty=!1,this._currentPath+=` M${e-i},${t} A1,1 0 0,0 ${e+i},${t} A1,1 0 0,0 ${e-i},${t} z`,this.stroke()}fill(){this._currentPathIsEmpty||(this.buffer+=`<path d="${this._currentPath}"`,this.color.rgba!=="#000000"&&(this.buffer+=` fill="${this.color.rgba}"`),this.buffer+=' style="stroke: none"/>'),this._currentPath="",this._currentPathIsEmpty=!0}stroke(){if(!this._currentPathIsEmpty){let e=`<path d="${this._currentPath}" stroke="${this.color.rgba}"`;this.lineWidth!==1&&(e+=` stroke-width="${this.lineWidth}"`),e+=' style="fill: none" />',this.buffer+=e}this._currentPath="",this._currentPathIsEmpty=!0}fillText(e,t,i){if(e==="")return;let r=`<text x="${t|0}" y="${i|0}" style="stroke: none; font:${this.font.toCssString(this.settings.display.scale)}; ${this.getSvgBaseLine()}"`;this.color.rgba!=="#000000"&&(r+=` fill="${this.color.rgba}"`),this.textAlign!==Y.Left&&(r+=` text-anchor="${this.getSvgTextAlignment(this.textAlign)}"`),r+=`>${cp.escapeText(e)}</text>`,this.buffer+=r}static escapeText(e){return e.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}getSvgTextAlignment(e){switch(e){case Y.Left:return"start";case Y.Center:return"middle";case Y.Right:return"end"}return""}getSvgBaseLine(){switch(this.textBaseline){case te.Top:return"dominant-baseline: hanging";case te.Bottom:return"dominant-baseline: bottom";default:return""}}measureText(e){return e?Yt.measureString(e,this.font.families,this.font.size,this.font.style,this.font.weight):new Bu(0,0)}onRenderFinished(){return null}beginRotate(e,t,i){this.buffer+='<g transform="translate('+e+" ,"+t+") rotate( "+i+')">'}endRotate(){this.buffer+="</g>"}}class Mv extends cp{constructor(){super()}fillMusicFontSymbol(e,t,i,r,n){r!==f.None&&this.fillMusicFontSymbolText(e,t,i,`&#${r};`,n)}fillMusicFontSymbols(e,t,i,r,n){let a="";for(let o of r)o!==f.None&&(a+=`&#${o};`);this.fillMusicFontSymbolText(e,t,i,a,n)}fillMusicFontSymbolText(e,t,i,r,n){this.buffer+=`<g transform="translate(${e} ${t})" class="at" ><text`,i!==1?this.buffer+=` style="font-size: ${i*100}%; stroke:none"`:this.buffer+=' style="stroke:none"',this.color.rgba!=="#000000"&&(this.buffer+=` fill="${this.color.rgba}"`),n&&(this.buffer+=' text-anchor="'+this.getSvgTextAlignment(Y.Center)+'"'),this.buffer+=`>${r}</text></g>`}}class ll{constructor(){this.isInAccolade=!0,this.isRelevantForBoundsLookup=!0,this.hideOnMultiTrack=!1,this.hideOnPercussionTrack=!1}canCreate(e,t){return!this.hideOnPercussionTrack||!t.isPercussion}}var ae;(function(s){s[s.PreNotes=0]="PreNotes",s[s.OnNotes=1]="OnNotes",s[s.MiddleNotes=2]="MiddleNotes",s[s.Stem=3]="Stem",s[s.PostNotes=4]="PostNotes",s[s.EndBeat=5]="EndBeat"})(ae||(ae={}));class us extends qe{get isEmpty(){return!this.glyphs||this.glyphs.length===0}constructor(e,t){super(e,t),this.glyphs=null}doLayout(){if(!this.glyphs||this.glyphs.length===0){this.width=0;return}let e=0;for(let t=0,i=this.glyphs.length;t<i;t++){let r=this.glyphs[t];r.renderer=this.renderer,r.doLayout(),e=Math.max(e,r.width)}this.width=e}addGlyph(e){this.glyphs||(this.glyphs=[]),this.renderer&&(e.renderer=this.renderer),this.glyphs.push(e)}paint(e,t,i){let r=this.glyphs;if(!(!r||r.length===0))for(let n of r)n.paint(e+this.x,t+this.y,i)}}class Ua extends us{constructor(){super(0,0),this.glyphs=[]}addGlyph(e){e.x=this.glyphs.length===0?0:this.glyphs[this.glyphs.length-1].x+this.glyphs[this.glyphs.length-1].width,e.renderer=this.renderer,e.doLayout(),this.width=e.x+e.width,super.addGlyph(e)}}class rb extends us{constructor(e,t,i){super(e,t),this.voice=i,this.beatGlyphs=[],this.tupletGroups=[]}scaleToWidth(e){const t=this.renderer.scale;let i=this.renderer.layoutingInfo.spaceToForce(e/t);this.scaleToForce(i)}scaleToForce(e){const t=this.renderer.scale;this.width=this.renderer.layoutingInfo.calculateVoiceWidth(e)*t;let i=this.renderer.layoutingInfo.buildOnTimePositions(e),r=this.beatGlyphs;for(let n=0,a=r.length;n<a;n++){let o=r[n];switch(o.beat.graceType){case $.None:o.x=i.get(o.beat.absoluteDisplayStart)*t-o.onTimeX;break;default:const l=o.beat.graceGroup.beats[0].absoluteDisplayStart,h=o.beat.graceGroup.id;if(o.beat.graceGroup.isComplete&&i.has(l)){o.x=i.get(l)*t-o.onTimeX;let u=this.renderer.layoutingInfo.allGraceRods.get(h);const c=o.beat.graceGroup.beats[o.beat.graceGroup.beats.length-1].nextBeat,d=c?this.renderer.layoutingInfo.getPreBeatSize(c)+Ui.GraceBeatPadding*this.renderer.scale:0;o.x-=d,o.x-=u[o.beat.graceIndex].postSpringWidth,o.x+=u[o.beat.graceIndex].graceBeatWidth;const p=u[o.beat.graceGroup.beats.length-1];o.x-=p.graceBeatWidth}else{let u=this.renderer.layoutingInfo.incompleteGraceRods.get(h);const c=u[o.beat.graceIndex].postSpringWidth-u[o.beat.graceIndex].preSpringWidth;n>0?o.beat.graceIndex===0?o.x=r[n-1].x+r[n-1].width:o.x=r[n-1].x+u[o.beat.graceIndex-1].postSpringWidth-u[o.beat.graceIndex-1].preSpringWidth-c:o.x=-c}break}if(n>0){let l=o.x-r[n-1].x;r[n-1].scaleToWidth(l)}if(n===a-1){let l=this.width-r[r.length-1].x;o.scaleToWidth(l)}}}registerLayoutingInfo(e){e.updateVoiceSize(this.width);let t=this.beatGlyphs;for(let i of t)i.registerLayoutingInfo(e)}applyLayoutingInfo(e){let t=this.beatGlyphs;for(let i of t)i.applyLayoutingInfo(e);this.scaleToForce(Math.max(this.renderer.settings.display.stretchForce,e.minStretchForce))}addGlyph(e){let t=e;e.x=this.beatGlyphs.length===0?0:this.beatGlyphs[this.beatGlyphs.length-1].x+this.beatGlyphs[this.beatGlyphs.length-1].width,e.renderer=this.renderer,e.doLayout(),this.beatGlyphs.push(t),this.width=e.x+e.width,t.beat.hasTuplet&&t.beat.tupletGroup.beats[0].id===t.beat.id&&this.tupletGroups.push(t.beat.tupletGroup)}doLayout(){}paint(e,t,i){i.color=this.voice.index===0?this.renderer.resources.mainGlyphColor:this.renderer.resources.secondaryGlyphColor;for(let r=0,n=this.beatGlyphs.length;r<n;r++)this.beatGlyphs[r].paint(e+this.x,t+this.y,i)}}rb.KeySizeBeat="Beat";var U;(function(s){s[s.None=0]="None",s[s.Natural=1]="Natural",s[s.Sharp=2]="Sharp",s[s.Flat=3]="Flat",s[s.NaturalQuarterNoteUp=4]="NaturalQuarterNoteUp",s[s.SharpQuarterNoteUp=5]="SharpQuarterNoteUp",s[s.FlatQuarterNoteUp=6]="FlatQuarterNoteUp",s[s.DoubleSharp=7]="DoubleSharp",s[s.DoubleFlat=8]="DoubleFlat"})(U||(U={}));class Fv{constructor(){this.maxLine=-1e3,this.minLine=-1e3}}class $e{constructor(e){this._registeredAccidentals=new Map,this._appliedScoreLines=new Map,this._appliedScoreLinesByValue=new Map,this._notesByValue=new Map,this._beatLines=new Map,this.maxLineBeat=null,this.minLineBeat=null,this.maxLine=-1e3,this.minLine=-1e3,this._barRenderer=e,this._bar=e.bar}static getPercussionLine(e,t){var i;return t<e.staff.track.percussionArticulations.length?e.staff.track.percussionArticulations[t].staffLine:((i=nt.getArticulationByValue(t))==null?void 0:i.staffLine)??0}static getNoteValue(e){if(e.isPercussion)return e.percussionArticulation;let t=e.displayValue;switch(e.accidentalMode){case ot.ForceDoubleFlat:t+=2;break;case ot.ForceDoubleSharp:t-=2;break;case ot.ForceFlat:t+=1;break;case ot.ForceSharp:t-=1;break}return t}applyAccidental(e){const t=$e.getNoteValue(e);let i=e.hasQuarterToneOffset;return this.getAccidental(t,i,e.beat,!1,e)}applyAccidentalForValue(e,t,i,r){return this.getAccidental(t,i,e,r,null)}static computeLineWithoutAccidentals(e,t){let i=0;const r=$e.getNoteValue(t);return e.staff.isPercussion?i=$e.getPercussionLine(e,r):i=$e.calculateNoteLine(e,r),i}static computeAccidental(e,t,i,r,n=null){let o=e+7,l=i%12,h=o<7?U.Flat:U.Sharp,u=$e.KeySignatureLookup[o][l],c=$e.AccidentalNotes[l],d=U.None;if(r)switch(d=c?h:U.Natural,d){case U.Natural:d=U.NaturalQuarterNoteUp;break;case U.Sharp:d=U.SharpQuarterNoteUp;break;case U.Flat:d=U.FlatQuarterNoteUp;break}else{switch(t){case ot.ForceSharp:d=U.Sharp;break;case ot.ForceDoubleSharp:d=U.DoubleSharp;break;case ot.ForceFlat:d=U.Flat;break;case ot.ForceDoubleFlat:d=U.DoubleFlat;break;default:c?d=h:u&&(d=U.Natural);break}d!==U.None?n!=null?n===d&&(d=U.None):u&&d===h&&(d=U.None):n!==null&&(n===U.Natural?d=U.None:d=U.Natural)}return d}getAccidental(e,t,i,r,n=null){let a=0,o=U.None;if(this._bar.staff.isPercussion)a=$e.getPercussionLine(this._bar,e);else{const l=n?n.accidentalMode:ot.Default;a=$e.calculateNoteLine(this._bar,e);const h=this._registeredAccidentals.has(a)?this._registeredAccidentals.get(a):null;o=$e.computeAccidental(this._bar.masterBar.keySignature,l,e,t,h);let u=!1;switch(o){case U.NaturalQuarterNoteUp:case U.SharpQuarterNoteUp:case U.FlatQuarterNoteUp:break;default:if(n&&n.isTieDestination&&n.beat.index===0){const c=this._barRenderer.previousRenderer;c&&c.accidentalHelper.getNoteLine(n.tieOrigin)===a&&(u=!0)}u?o=U.None:o!==U.None&&this._registeredAccidentals.set(a,o);break}}return n?(this._appliedScoreLines.set(n.id,a),this._notesByValue.set(e,n)):this._appliedScoreLinesByValue.set(e,a),(this.minLine===-1e3||this.minLine<a)&&(this.minLine=a,this.minLineBeat=i),(this.maxLine===-1e3||this.maxLine>a)&&(this.maxLine=a,this.maxLineBeat=i),r||this.registerLine(i,a),o}registerLine(e,t){let i;this._beatLines.has(e.id)?i=this._beatLines.get(e.id):(i=new Fv,this._beatLines.set(e.id,i)),(i.minLine===-1e3||t<i.minLine)&&(i.minLine=t),(i.minLine===-1e3||t>i.maxLine)&&(i.maxLine=t)}getMaxLine(e){return this._beatLines.has(e.id)?this._beatLines.get(e.id).maxLine:0}getMinLine(e){return this._beatLines.has(e.id)?this._beatLines.get(e.id).minLine:0}static calculateNoteLine(e,t){let i=t,r=e.masterBar.keySignature,n=e.clef,a=i%12,o=(i/12|0)-1,l=$e.OctaveSteps[n];l-=o*$e.StepsPerOctave;let h=Re.keySignatureIsSharp(r)||Re.keySignatureIsNatural(r)?$e.SharpNoteSteps:$e.FlatNoteSteps;return l-=h[a],l}getNoteLine(e){return this._appliedScoreLines.get(e.id)}getNoteLineForValue(e,t=!1){return this._appliedScoreLinesByValue.has(e)?this._appliedScoreLinesByValue.get(e):t&&this._notesByValue.has(e)?this.getNoteLine(this._notesByValue.get(e)):0}}$e.KeySignatureLookup=[[!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0],[!0,!0,!0,!0,!0,!1,!0,!0,!0,!0,!0,!0],[!1,!0,!0,!0,!0,!1,!0,!0,!0,!0,!0,!0],[!1,!0,!0,!0,!0,!1,!1,!1,!0,!0,!0,!0],[!1,!1,!1,!0,!0,!1,!1,!1,!0,!0,!0,!0],[!1,!1,!1,!0,!0,!1,!1,!1,!1,!1,!0,!0],[!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!0,!0],[!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1],[!1,!1,!1,!1,!1,!0,!0,!1,!1,!1,!1,!1],[!0,!0,!1,!1,!1,!0,!0,!1,!1,!1,!1,!1],[!0,!0,!1,!1,!1,!0,!0,!0,!0,!1,!1,!1],[!0,!0,!0,!0,!1,!0,!0,!0,!0,!1,!1,!1],[!0,!0,!0,!0,!1,!0,!0,!0,!0,!0,!0,!1],[!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!1],[!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0]];$e.AccidentalNotes=[!1,!0,!1,!0,!1,!1,!0,!1,!0,!1,!0,!1];$e.StepsPerOctave=7;$e.OctaveSteps=[38,32,30,26,38];$e.SharpNoteSteps=[0,0,1,1,2,3,3,4,4,5,5,6];$e.FlatNoteSteps=[0,1,1,2,2,3,4,4,5,5,6,6];class Rv{constructor(){this.staffId="",this.up=0,this.down=0}}class Dv{constructor(){this.startBeat=null,this.startX=0,this.startY=0,this.endBeat=null,this.endX=0,this.endY=0}calcY(e){return this.startX===this.endX?this.startY:(this.endY-this.startY)/(this.endX-this.startX)*(e-this.startX)+this.startY}}class _s{get isRestBeamHelper(){return this.beats.length===1&&this.beats[0].isRest}hasLine(e,t){return e&&this.beatHasLine(t)||!e&&this.beats.length===1&&this.beatHasLine(t)}beatHasLine(e){return e.duration>k.Whole}hasFlag(e,t){return e&&this.beatHasFlag(t)||!e&&this.beats.length===1&&this.beatHasFlag(this.beats[0])}beatHasFlag(e){return!e.isRest&&(e.duration>k.Quarter||e.graceType!==$.None)}constructor(e,t){this._beatLineXPositions=new Map,this._firstNonRestBeat=null,this._lastNonRestBeat=null,this.voice=null,this.beats=[],this.shortestDuration=k.QuadrupleWhole,this.hasTuplet=!1,this.slashBeats=[],this._firstBeatLowestNoteCompareValue=-1,this._firstBeatHighestNoteCompareValue=-1,this._lastBeatLowestNoteCompareValue=-1,this._lastBeatHighestNoteCompareValue=-1,this.lowestNoteInHelper=null,this._lowestNoteCompareValueInHelper=-1,this.highestNoteInHelper=null,this._highestNoteCompareValueInHelper=-1,this.invertBeamDirection=!1,this.preferredBeamDirection=null,this.isGrace=!1,this.minRestLine=null,this.beatOfMinRestLine=null,this.maxRestLine=null,this.beatOfMaxRestLine=null,this.direction=E.Up,this.drawingInfos=new Map,this._staff=e,this._renderer=t,this.beats=[]}getBeatLineX(e,t){return t=t??this.direction,this.hasBeatLineX(e)?t===E.Up?this._beatLineXPositions.get(e.index).up:this._beatLineXPositions.get(e.index).down:0}hasBeatLineX(e){return this._beatLineXPositions.has(e.index)}registerBeatLineX(e,t,i,r){let n=this.getOrCreateBeatPositions(t);n.staffId=e,n.up=i,n.down=r;for(const a of this.drawingInfos.values())a.startBeat==t?a.startX=this.getBeatLineX(t):a.endBeat==t&&(a.endX=this.getBeatLineX(t))}getOrCreateBeatPositions(e){return this._beatLineXPositions.has(e.index)||this._beatLineXPositions.set(e.index,new Rv),this._beatLineXPositions.get(e.index)}finish(){this.direction=this.calculateDirection()}calculateDirection(){let e=null;if(this.voice?this.preferredBeamDirection!==null?e=this.preferredBeamDirection:this.voice.index>0?e=this.invert(E.Down):this.voice.bar.isMultiVoice?e=this.invert(E.Up):this.beats[0].graceType!==$.None&&(e=this.invert(E.Up)):e=E.Up,this.highestNoteInHelper&&this.lowestNoteInHelper){let t=this._renderer.getNoteY(this.highestNoteInHelper,H.Center),i=this._renderer.getNoteY(this.lowestNoteInHelper,H.Center);if(e===null){const r=(t+i)/2;e=this.invert(this._renderer.middleYPosition<r?E.Up:E.Down)}this._renderer.completeBeamingHelper(this)}else e=this.invert(E.Up),this._renderer.completeBeamingHelper(this);return e}static computeLineHeightsForRest(e){switch(e){case k.QuadrupleWhole:return[2,2];case k.DoubleWhole:return[2,2];case k.Whole:return[0,1];case k.Half:return[1,0];case k.Quarter:return[3,3];case k.Eighth:return[2,2];case k.Sixteenth:return[2,4];case k.ThirtySecond:return[4,4];case k.SixtyFourth:return[4,6];case k.OneHundredTwentyEighth:return[6,6];case k.TwoHundredFiftySixth:return[6,8]}return[0,0]}applyRest(e,t){if(this._lastNonRestBeat&&e.index>=this._lastNonRestBeat.index||this._firstNonRestBeat&&e.index<=this._firstNonRestBeat.index)return;let i=t,r=t;const n=_s.computeLineHeightsForRest(e.duration);i-=n[0],r+=n[1];const a=this.minRestLine,o=this.maxRestLine;(a===null||a>i)&&(this.minRestLine=i,this.beatOfMinRestLine=e),(o===null||o<r)&&(this.maxRestLine=r,this.beatOfMaxRestLine=e)}invert(e){if(!this.invertBeamDirection)return e;switch(e){case E.Down:return E.Up;default:return E.Down}}checkBeat(e){e.invertBeamDirection&&(this.invertBeamDirection=!0),this.voice||(this.voice=e.voice);let t=!1;if(this.beats.length===0)t=!0;else switch(this.beats[this.beats.length-1].beamingMode){case ks.Auto:t=_s.canJoin(this.beats[this.beats.length-1],e);break;case ks.ForceSplitToNext:t=!1;break;case ks.ForceMergeWithNext:t=!0;break}return t&&(this.preferredBeamDirection==null&&e.preferredBeamDirection!==null&&(this.preferredBeamDirection=e.preferredBeamDirection),e.hasTuplet&&(this.hasTuplet=!0),e.graceType!==$.None&&(this.isGrace=!0),e.isRest?this.beats.length===0&&this.beats.push(e):(this.isRestBeamHelper&&(this.beats=[]),this.beats.push(e),this.checkNote(e.minNote),this.checkNote(e.maxNote),this.shortestDuration<e.duration&&(this.shortestDuration=e.duration),this._firstNonRestBeat||(this._firstNonRestBeat=e),this._lastNonRestBeat=e),e.slashed&&this.slashBeats.push(e)),t}checkNote(e){if(!e)return;let t,i;this.voice&&e.isPercussion?(t=-$e.getPercussionLine(this.voice.bar,$e.getNoteValue(e)),i=t):(t=$e.getNoteValue(e),i=t,e.harmonicType!==X.None&&e.harmonicType!==X.Natural&&(i=e.realValue-this._staff.displayTranspositionPitch)),this.beats.length===1&&this.beats[0]===e.beat&&((this._firstBeatLowestNoteCompareValue===-1||t<this._firstBeatLowestNoteCompareValue)&&(this._firstBeatLowestNoteCompareValue=t),(this._firstBeatHighestNoteCompareValue===-1||i>this._firstBeatHighestNoteCompareValue)&&(this._firstBeatHighestNoteCompareValue=i)),(this._lastBeatLowestNoteCompareValue===-1||t<this._lastBeatLowestNoteCompareValue)&&(this._lastBeatLowestNoteCompareValue=t),(this._lastBeatHighestNoteCompareValue===-1||i>this._lastBeatHighestNoteCompareValue)&&(this._lastBeatHighestNoteCompareValue=i),(!this.lowestNoteInHelper||t<this._lowestNoteCompareValueInHelper)&&(this.lowestNoteInHelper=e,this._lowestNoteCompareValueInHelper=t),(!this.highestNoteInHelper||i>this._highestNoteCompareValueInHelper)&&(this.highestNoteInHelper=e,this._highestNoteCompareValueInHelper=i)}static canJoin(e,t){if(!e||!t||e.graceType!==t.graceType||e.graceType===$.BendGrace||t.graceType===$.BendGrace)return!1;if(e.graceType!==$.None&&t.graceType!==$.None)return!0;let i=e.voice.bar,r=t.voice.bar;if(i!==r)return!1;let n=e.playbackStart,a=t.playbackStart;if(!_s.canJoinDuration(e.duration)||!_s.canJoinDuration(t.duration))return n===a;if(e.tupletGroup!==t.tupletGroup)return!1;if(e.hasTuplet&&t.hasTuplet&&e.tupletGroup===t.tupletGroup&&e.tupletGroup.isFull)return!0;let o=re.QuarterTime;switch(i.masterBar.timeSignatureDenominator){case 8:i.masterBar.timeSignatureNumerator%3===0&&(o+=re.QuarterTime/2|0);break}let l=(o+n)/o|0|0,h=(o+a)/o|0|0;return l===h}static canJoinDuration(e){switch(e){case k.Whole:case k.Half:case k.Quarter:return!1;default:return!0}}static isFullBarJoin(e,t,i){return Re.getIndex(e.duration)-2-i>0&&Re.getIndex(t.duration)-2-i>0}get beatOfLowestNote(){return this.lowestNoteInHelper.beat}get beatOfHighestNote(){return this.highestNoteInHelper.beat}isPositionFrom(e,t){return this._beatLineXPositions.has(t.index)?this._beatLineXPositions.get(t.index).staffId===e||!this._beatLineXPositions.get(t.index).staffId:!0}}class Av{constructor(e,t){this.topY=0,this.bottomY=0,this.topY=e,this.bottomY=t}}class Iv{constructor(e){this.topY=-1e3,this.bottomY=-1e3,this.slots=[],this.beat=e}addSlot(e,t){if(this.slots.push(new Av(e,t)),this.topY===-1e3)this.topY=e,this.bottomY=t;else{const i=Math.min(e,t),r=Math.max(e,t);i<this.topY&&(this.topY=i),r>this.bottomY&&(this.bottomY=r)}}}class Ov{constructor(){this.reservedLayoutAreasByDisplayTime=new Map,this.restDurationsByDisplayTime=new Map}getBeatMinMaxY(){let e=-1e3,t=-1e3;for(const i of this.reservedLayoutAreasByDisplayTime.values())e===-1e3?(e=i.topY,t=i.bottomY):(e>i.topY&&(e=i.topY),t<i.bottomY&&(t=i.bottomY));return e===-1e3?[0,0]:[e,t]}reserveBeatSlot(e,t,i){t!=i&&(this.reservedLayoutAreasByDisplayTime.has(e.displayStart)||this.reservedLayoutAreasByDisplayTime.set(e.displayStart,new Iv(e)),this.reservedLayoutAreasByDisplayTime.get(e.displayStart).addSlot(t,i),e.isRest&&this.registerRest(e))}registerRest(e){this.restDurationsByDisplayTime.has(e.displayStart)||this.restDurationsByDisplayTime.set(e.displayStart,new Map),this.restDurationsByDisplayTime.get(e.displayStart).has(e.playbackDuration)||this.restDurationsByDisplayTime.get(e.displayStart).set(e.playbackDuration,e.id)}applyRestCollisionOffset(e,t,i){if(e.voice.index>0&&this.reservedLayoutAreasByDisplayTime.has(e.playbackStart)){const r=_s.computeLineHeightsForRest(e.duration).map(u=>u*i);let n=t-r[0],a=t+r[1],o=n;const l=this.reservedLayoutAreasByDisplayTime.get(e.playbackStart);let h=!1;for(const u of l.slots)if(n>=u.topY&&n<=u.bottomY||a>=u.topY&&a<=u.bottomY){h=!0;break}if(h){e.voice.index==1?o=l.topY-r[1]-r[0]:o=l.bottomY;let u=o+r[0]+r[1];const c=i*2;let d=Math.ceil(Math.abs(o-n)/c);return l.addSlot(o,u),o<n?d*-c:d*c}}return 0}}class Vv{constructor(e){this.beamHelpers=[],this.beamHelperLookup=[],this.preferredBeamDirection=null,this._renderer=e,this.collisionHelper=new Ov}initialize(){var e=this._renderer,t=this._renderer.bar;let i=null,r=null;for(let n=0,a=t.voices.length;n<a;n++){let o=t.voices[n];this.beamHelpers.push([]),this.beamHelperLookup.push(new Map);for(let l=0,h=o.beats.length;l<h;l++){let u=o.beats[l],c;u.graceType!==$.None?c=r:(c=i,r=null),(!c||!c.checkBeat(u))&&(c&&c.finish(),c=new _s(t.staff,e),c.preferredBeamDirection=this.preferredBeamDirection,c.checkBeat(u),u.graceType!==$.None?r=c:i=c,this.beamHelpers[o.index].push(c)),this.beamHelperLookup[o.index].set(u.index,c)}i&&i.finish(),r&&r.finish(),i=null,r=null}}getBeamingHelperForBeat(e){return this.beamHelperLookup[e.voice.index].get(e.index)}}class Et extends Ii{constructor(e,t,i){super(e,t),this._textRow=0,this._fretRow=0,this._firstFretSpacing=0,this._chord=i}doLayout(){super.doLayout();const e=this.scale;let t=this.renderer.resources;this._textRow=t.effectFont.size*1.5*e,this._fretRow=t.effectFont.size*1.5*e,this._chord.firstFret>1?this._firstFretSpacing=Et.FretSpacing*e:this._firstFretSpacing=0,this.height=this._textRow+this._fretRow+(Et.Frets-1)*Et.FretSpacing*e+2*Et.Padding*e,this.width=this._firstFretSpacing+(this._chord.staff.tuning.length-1)*Et.StringSpacing*e+2*Et.Padding*e}paint(e,t,i){e+=this.x+Et.Padding*this.scale+this._firstFretSpacing,t+=this.y;let r=this.width-2*Et.Padding*this.scale+this.scale-this._firstFretSpacing,n=Et.StringSpacing*this.scale,a=Et.FretSpacing*this.scale,o=this.renderer.resources,l=Et.CircleRadius*this.scale,h=i.textAlign,u=i.textBaseline;i.font=o.effectFont,i.textAlign=Y.Center,i.textBaseline=te.Top,this._chord.showName&&i.fillText(this._chord.name,e+this.width/2,t+o.effectFont.size/2),t+=this._textRow,e+=n/2,i.font=o.fretboardNumberFont,i.textBaseline=te.Middle;for(let d=0;d<this._chord.staff.tuning.length;d++){let p=e+d*n,g=t+this._fretRow/2,w=this._chord.strings[this._chord.staff.tuning.length-d-1];w<0?i.fillMusicFontSymbol(p,g,this.scale,f.FretboardX,!0):w===0?i.fillMusicFontSymbol(p,g,this.scale,f.FretboardO,!0):(w-=this._chord.firstFret-1,i.fillText(w.toString(),p,g))}t+=this._fretRow;for(let d=0;d<this._chord.staff.tuning.length;d++){let p=e+d*n;i.fillRect(p,t,1,a*Et.Frets+this.scale)}this._chord.firstFret>1&&(i.textAlign=Y.Left,i.fillText(this._chord.firstFret.toString(),e-this._firstFretSpacing,t+a/2)),i.fillRect(e,t-this.scale,r,2*this.scale);for(let d=0;d<=Et.Frets;d++){let p=t+d*a;i.fillRect(e,p,r,this.scale)}let c=new Map;for(let d of this._chord.barreFrets){let p=[-1,-1];c.set(d-this._chord.firstFret,p)}for(let d=0;d<this._chord.strings.length;d++){let p=this._chord.strings[d];if(p>0){if(p-=this._chord.firstFret,c.has(p)){let S=c.get(p);(S[0]===-1||d<S[0])&&(S[0]=d),(S[1]===-1||d>S[1])&&(S[1]=d)}let g=t+p*a+a/2+.5*this.scale,w=e+(this._chord.strings.length-d-1)*n;i.fillCircle(w,g,l)}}for(const[d,p]of c){let g=t+d*a+a/2+.5*this.scale,w=e+(this._chord.strings.length-p[1]-1)*n,S=e+(this._chord.strings.length-p[0]-1)*n;i.fillRect(w,g-l,S-w,l*2)}i.textAlign=h,i.textBaseline=u}}Et.Padding=5;Et.Frets=5;Et.CircleRadius=2.5;Et.StringSpacing=10;Et.FretSpacing=12;class Vm extends us{constructor(e,t,i=Y.Center){super(e,t),this._glyphWidth=0,this.glyphs=[],this._align=i}doLayout(){let e=0;switch(this._align){case Y.Left:e=0;break;case Y.Center:e=(this.width-this._glyphWidth)/2;break;case Y.Right:e=this.width-this._glyphWidth;break}for(let t of this.glyphs)t.x=e,e+=t.width}addGlyphToRow(e){this.glyphs.push(e),this._glyphWidth+=e.width,e.height>this.height&&(this.height=e.height)}}class hl extends us{constructor(e,t,i=Y.Center){super(e,t),this._rows=[],this.height=0,this.glyphs=[],this._align=i}doLayout(){let e=0,t=0,i=hl.Padding*this.scale;this._rows=[];let r=new Vm(e,t,this._align);r.width=this.width;for(let n of this.glyphs)e+n.width<this.width?(r.addGlyphToRow(n),e+=n.width):(r.isEmpty||(r.doLayout(),this._rows.push(r),t+=r.height+i),e=0,r=new Vm(e,t,this._align),r.width=this.width,r.addGlyphToRow(n),e+=n.width);r.isEmpty||(r.doLayout(),this._rows.push(r),t+=r.height+i),this.height=t}paint(e,t,i){for(let r of this._rows)r.paint(e+this.x,t+this.y,i)}}hl.Padding=3;class Hv extends hl{constructor(e,t){super(e,t)}addChord(e){if(e.strings.length>0){let t=new Et(0,0,e);t.renderer=this.renderer,t.doLayout(),this.glyphs.push(t)}}}class Mt extends Ii{constructor(e,t,i,r,n=Y.Left,a=null){super(e,t),this._lineHeights=null,this._lines=i.split(`
`),this.font=r,this.textAlign=n,this.textBaseline=a}doLayout(){super.doLayout(),this._lineHeights=[];const e=this.renderer.scoreRenderer.canvas;for(const t of this._lines){e.font=this.font;const i=e.measureText(t),r=i.height*this.scale;this._lineHeights.push(r),this.height+=r,this.width=Math.max(this.width,i.width)}}paint(e,t,i){let r=i.color;i.color=r,i.font=this.font;let n=i.textAlign,a=i.textBaseline;i.textAlign=this.textAlign,this.textBaseline!==null&&(i.textBaseline=this.textBaseline);let o=t+this.y;for(let l=0;l<this._lines.length;l++)i.fillText(this._lines[l],e+this.x,o),o+=this._lineHeights[l];i.textAlign=n,i.textBaseline=a}}class Wv{get staveId(){return this._factory.staffId}constructor(e,t,i){this._sharedLayoutData=new Map,this.barRenderers=[],this.x=0,this.y=0,this.height=0,this.index=0,this.staffIndex=0,this.trackIndex=0,this.staveTop=0,this.topSpacing=0,this.bottomSpacing=0,this.staveBottom=0,this.isFirstInAccolade=!1,this.isLastInAccolade=!1,this._factory=i,this.trackIndex=e,this.modelStaff=t}getSharedLayoutData(e,t){return this._sharedLayoutData.has(e)?this._sharedLayoutData.get(e):t}setSharedLayoutData(e,t){this._sharedLayoutData.set(e,t)}get isInAccolade(){return this._factory.isInAccolade}get isRelevantForBoundsLookup(){return this._factory.isRelevantForBoundsLookup}registerStaffTop(e){this.staveTop=e}registerStaffBottom(e){this.staveBottom=e}addBarRenderer(e){e.staff=this,e.index=this.barRenderers.length,e.reLayout(),this.barRenderers.push(e),this.system.layout.registerBarRenderer(this.staveId,e)}addBar(e,t){let i;e?i=this._factory.create(this.system.layout.renderer,e):i=new Ge(this.system.layout.renderer,e),i.staff=this,i.index=this.barRenderers.length,i.layoutingInfo=t,i.doLayout(),i.registerLayoutingInfo();const r=i.barDisplayWidth;r>0&&this.system.layout.systemsLayoutMode==Mi.FromModelWithWidths&&(i.width=r),this.barRenderers.push(i),e&&this.system.layout.registerBarRenderer(this.staveId,i)}revertLastBar(){let e=this.barRenderers[this.barRenderers.length-1];this.barRenderers.splice(this.barRenderers.length-1,1),this.system.layout.unregisterBarRenderer(this.staveId,e);for(const t of this.barRenderers)t.applyLayoutingInfo();return e}scaleToWidth(e){this._sharedLayoutData=new Map;let t=this.topOverflow,i=0;switch(this.system.layout.systemsLayoutMode){case Mi.Automatic:let n=(e-this.system.computedWidth)/this.barRenderers.length;for(const o of this.barRenderers){o.x=i,o.y=this.topSpacing+t;let l=o.computedWidth+n;o.scaleToWidth(l),i+=o.width}break;case Mi.FromModelWithScale:e-=this.system.accoladeWidth;const a=this.system.totalBarDisplayScale;for(const o of this.barRenderers){o.x=i,o.y=this.topSpacing+t;const l=o.barDisplayScale*e/a;o.scaleToWidth(l),i+=o.width}break;case Mi.FromModelWithWidths:for(const o of this.barRenderers){o.x=i,o.y=this.topSpacing+t;const l=o.barDisplayWidth;l>0?o.scaleToWidth(l):o.scaleToWidth(o.computedWidth),i+=o.width}break}}get topOverflow(){let e=0;for(let t=0,i=this.barRenderers.length;t<i;t++){let r=this.barRenderers[t];r.topOverflow>e&&(e=r.topOverflow)}return e}get bottomOverflow(){let e=0;for(let t=0,i=this.barRenderers.length;t<i;t++){let r=this.barRenderers[t];r.bottomOverflow>e&&(e=r.bottomOverflow)}return e}finalizeStaff(){const e=this.system.layout.renderer.settings;this.topSpacing=this._factory.getStaffPaddingTop(this)*e.display.scale,this.bottomSpacing=this._factory.getStaffPaddingBottom(this)*e.display.scale,this.height=0;let t=!1,i=this.topOverflow;for(let r=0;r<this.barRenderers.length;r++)this.barRenderers[r].y=this.topSpacing+i,this.height=Math.max(this.height,this.barRenderers[r].height),this.barRenderers[r].finalizeRenderer()&&(t=!0);if(t){i=this.topOverflow;for(let r=0;r<this.barRenderers.length;r++)this.barRenderers[r].y=this.topSpacing+i,this.height=Math.max(this.height,this.barRenderers[r].height),this.barRenderers[r].finalizeRenderer()}this.height>0&&(this.height+=this.topSpacing+i+this.bottomOverflow+this.bottomSpacing)}paint(e,t,i,r,n){if(!(this.height===0||n===0))for(let a=r,o=Math.min(r+n,this.barRenderers.length);a<o;a++)this.barRenderers[a].paint(e+this.x,t+this.y,i)}}class Hm{constructor(){this.timePosition=0,this.longestDuration=0,this.smallestDuration=0,this.force=0,this.springConstant=0,this.preBeatWidth=0,this.graceBeatWidth=0,this.postSpringWidth=0,this.allDurations=new Set}get springWidth(){return this.preSpringWidth+this.postSpringWidth}get preSpringWidth(){return this.preBeatWidth+this.graceBeatWidth}}class ka{constructor(){this._timeSortedSprings=[],this._xMin=0,this._minTime=-1,this._onTimePositionsForce=0,this._onTimePositions=new Map,this._incompleteGraceRodsWidth=0,this.version=0,this.preBeatSizes=new Map,this.onBeatSizes=new Map,this.onBeatCenterX=new Map,this.preBeatSize=0,this.postBeatSize=0,this.voiceSize=0,this.minStretchForce=0,this.totalSpringConstant=0,this.incompleteGraceRods=new Map,this.allGraceRods=new Map,this.springs=new Map,this.height=0}updateVoiceSize(e){e>this.voiceSize&&(this.voiceSize=e,this.version++)}setPreBeatSize(e,t){(!this.preBeatSizes.has(e.id)||this.preBeatSizes.get(e.id)<t)&&(this.preBeatSizes.set(e.id,t),this.version++)}getPreBeatSize(e){return this.preBeatSizes.has(e.id)?this.preBeatSizes.get(e.id):0}setOnBeatSize(e,t){(!this.onBeatSizes.has(e.id)||this.onBeatSizes.get(e.id)<t)&&(this.onBeatSizes.set(e.id,t),this.version++)}getOnBeatSize(e){return this.onBeatSizes.has(e.id)?this.onBeatSizes.get(e.id):0}getBeatCenterX(e){return this.onBeatCenterX.has(e.id)?this.onBeatCenterX.get(e.id):0}setBeatCenterX(e,t){(!this.onBeatCenterX.has(e.id)||this.onBeatCenterX.get(e.id)<t)&&(this.onBeatCenterX.set(e.id,t),this.version++)}updateMinStretchForce(e){this.minStretchForce<e&&(this.minStretchForce=e)}addSpring(e,t,i,r,n){this.version++;let a;if(this.springs.has(e))a=this.springs.get(e),a.postSpringWidth<n&&(a.postSpringWidth=n),a.graceBeatWidth<i&&(a.graceBeatWidth=i),a.preBeatWidth<r&&(a.preBeatWidth=r),t<a.smallestDuration&&(a.smallestDuration=t),t>a.longestDuration&&(a.longestDuration=t),a.allDurations.add(t);else{if(a=new Hm,a.timePosition=e,a.allDurations.add(t),this._timeSortedSprings.length>0){let h=this._timeSortedSprings[this._timeSortedSprings.length-1];for(const u of h.allDurations)h.timePosition+u}a.longestDuration=t,a.postSpringWidth=n,a.graceBeatWidth=i,a.preBeatWidth=r,this.springs.set(e,a);let o=this._timeSortedSprings,l=o.length-1;for(;l>0&&o[l].timePosition>e;)l--;this._timeSortedSprings.splice(l+1,0,a)}return(this._minTime===-1||this._minTime>e)&&(this._minTime=e),a}addBeatSpring(e,t,i){let r=e.absoluteDisplayStart;if(e.graceType!==$.None){const n=e.graceGroup.id;this.allGraceRods.has(n)||this.allGraceRods.set(n,new Array(e.graceGroup.beats.length)),!e.graceGroup.isComplete&&!this.incompleteGraceRods.has(n)&&this.incompleteGraceRods.set(n,new Array(e.graceGroup.beats.length));let a=this.allGraceRods.get(n)[e.graceIndex];if(a)a.postSpringWidth<i&&(a.postSpringWidth=i),a.preBeatWidth<t&&(a.preBeatWidth=t);else{const o=new Hm;o.timePosition=r,o.postSpringWidth=i,o.preBeatWidth=t,e.graceGroup.isComplete||(this.incompleteGraceRods.get(n)[e.graceIndex]=o),this.allGraceRods.get(n)[e.graceIndex]=o}}else{let n=0;if(e.graceGroup&&this.allGraceRods.has(e.graceGroup.id))for(const a of this.allGraceRods.get(e.graceGroup.id))n+=a.springWidth;this.addSpring(r,e.displayDuration,n,t,i)}}finish(){for(const[e,t]of this.allGraceRods){let i=0;if(this.incompleteGraceRods.has(e))for(const r of t)i+=r.preBeatWidth,r.graceBeatWidth=i,i+=r.postSpringWidth;else for(let r=t.length-1;r>=0;r--)t[r].graceBeatWidth=i,i-=t[r].preBeatWidth+t[r].postSpringWidth}this._incompleteGraceRodsWidth=0;for(const e of this.incompleteGraceRods.values())for(const t of e)this._incompleteGraceRodsWidth+=t.preBeatWidth+t.postSpringWidth;this.calculateSpringConstants(),this.version++}calculateSpringConstants(){this._xMin=0;let e=this.springs;for(const r of e.values())r.springWidth<this._xMin&&(this._xMin=r.springWidth);let t=0,i=this._timeSortedSprings;if(i.length===0){this.totalSpringConstant=-1,this.minStretchForce=-1;return}for(let r=0;r<i.length;r++){let n=i[r],a=0;if(r===i.length-1)a=n.longestDuration;else{let o=i[r+1];a=Math.abs(o.timePosition-n.timePosition)}n.springConstant=this.calculateSpringConstant(n,a),t+=1/n.springConstant}this.totalSpringConstant=1/t,this.minStretchForce=0;for(let r=0;r<i.length;r++){let n=i[r],a=0;if(r===i.length-1)a=n.postSpringWidth;else{let l=i[r+1];a=n.postSpringWidth+l.preSpringWidth}r===0&&(a+=n.preSpringWidth);let o=a*n.springConstant;this.updateMinStretchForce(o)}}paint(e,t,i){}calculateSpringConstant(e,t){t<=0&&(t=re.toTicks(k.SixtyFourth)),e.smallestDuration===0&&(e.smallestDuration=t);let i=e.smallestDuration,r=1+.85*Math.log2(t/ka.MinDuration);return i/t*(1/(r*ka.MinDurationWidth))}spaceToForce(e){return this.totalSpringConstant!==-1?(this._timeSortedSprings.length>0&&(e-=this._timeSortedSprings[0].preSpringWidth),e-=this._incompleteGraceRodsWidth,Math.max(e,0)*this.totalSpringConstant):-1}calculateVoiceWidth(e){let t=0;return this.totalSpringConstant!==-1&&(t=this.calculateWidth(e,this.totalSpringConstant)),this._timeSortedSprings.length>0&&(t+=this._timeSortedSprings[0].preSpringWidth),t+=this._incompleteGraceRodsWidth,t}calculateWidth(e,t){return e/t}buildOnTimePositions(e){if(this.totalSpringConstant===-1)return new Map;if(Re.isAlmostEqualTo(this._onTimePositionsForce,e)&&this._onTimePositions)return this._onTimePositions;this._onTimePositionsForce=e;let t=new Map;this._onTimePositions=t;let i=this._timeSortedSprings;if(i.length===0)return t;let r=i[0].preSpringWidth;for(let n=0;n<i.length;n++)t.set(i[n].timePosition,r),r+=this.calculateWidth(e,i[n].springConstant);return t}}ka.MinDuration=30;ka.MinDurationWidth=7;class zv{constructor(){this.width=0,this.isLinkedToPrevious=!1,this.canWrap=!0,this.renderers=[]}}class Gv{constructor(e,t){this.staves=[],this.stavesRelevantForBoundsLookup=[],this.firstStaffInAccolade=null,this.lastStaffInAccolade=null,this.staffSystem=e,this.track=t}addStaff(e){this.staves.push(e),e.isRelevantForBoundsLookup&&this.stavesRelevantForBoundsLookup.push(e)}}class Uo{constructor(e){this._allStaves=[],this._firstStaffInAccolade=null,this._lastStaffInAccolade=null,this._accoladeSpacingCalculated=!1,this.x=0,this.y=0,this.index=0,this.accoladeWidth=0,this.isFull=!1,this.width=0,this.computedWidth=0,this.totalBarDisplayScale=0,this.isLast=!1,this.masterBarsRenderers=[],this.staves=[],this.layout=e,this.topPadding=e.renderer.settings.display.systemPaddingTop,this.bottomPadding=e.renderer.settings.display.systemPaddingBottom}get firstBarIndex(){return this.masterBarsRenderers[0].masterBar.index}get lastBarIndex(){return this.masterBarsRenderers[this.masterBarsRenderers.length-1].masterBar.index}addMasterBarRenderers(e,t){if(e.length===0)return null;this.masterBarsRenderers.push(t),this.calculateAccoladeSpacing(e),t.layoutingInfo.preBeatSize=0;let i=0;for(let r=0,n=this.staves.length;r<n;r++){let a=this.staves[r];for(let o=0,l=a.staves.length;o<l;o++){let h=a.staves[o],u=t.renderers[i++];h.addBarRenderer(u)}}return this.updateWidthFromLastBar(),t}addBars(e,t){if(e.length===0)return null;let i=new zv;i.layoutingInfo=new ka,i.masterBar=e[0].score.masterBars[t],this.masterBarsRenderers.push(i),this.calculateAccoladeSpacing(e);let r=i.layoutingInfo;for(let n of this.staves)for(let a of n.staves){let o=n.track.staves[a.modelStaff.index].bars[t];a.addBar(o,r);let l=a.barRenderers[a.barRenderers.length-1];i.renderers.push(l),l.isLinkedToPrevious&&(i.isLinkedToPrevious=!0),l.canWrap||(i.canWrap=!1)}return r.finish(),i.width=this.updateWidthFromLastBar(),i}revertLastBar(){if(this.masterBarsRenderers.length>1){let e=this.masterBarsRenderers[this.masterBarsRenderers.length-1];this.masterBarsRenderers.splice(this.masterBarsRenderers.length-1,1);let t=0,i=0;for(let r=0,n=this._allStaves.length;r<n;r++){let o=this._allStaves[r].revertLastBar();const l=o.computedWidth;l>t&&(t=l);const h=o.barDisplayScale;h>i&&(i=h)}return this.width-=t,this.computedWidth-=t,this.totalBarDisplayScale-=i,e}return null}updateWidthFromLastBar(){let e=0,t=0;for(let i=0,r=this._allStaves.length;i<r;i++){let n=this._allStaves[i];const a=n.barRenderers[n.barRenderers.length-1];a.applyLayoutingInfo(),a.computedWidth>e&&(e=a.computedWidth);const o=a.barDisplayScale;o>t&&(t=o)}return this.width+=e,this.computedWidth+=e,this.totalBarDisplayScale+=t,e}calculateAccoladeSpacing(e){const t=this.layout.renderer.settings;if(!this._accoladeSpacingCalculated){if(this._accoladeSpacingCalculated=!0,this.index===0&&this.layout.renderer.settings.notation.isNotationElementVisible(K.TrackNames)){let i=this.layout.renderer.canvas,r=t.display.resources.effectFont;i.font=r;for(let n of e)this.accoladeWidth=Math.ceil(Math.max(this.accoladeWidth,i.measureText(n.shortName).width));this.accoladeWidth*=this.layout.scale,this.accoladeWidth+=t.display.systemLabelPaddingLeft*this.layout.scale,this.accoladeWidth+=t.display.systemLabelPaddingRight*this.layout.scale}else this.accoladeWidth=0;this.accoladeWidth+=Uo.AccoladeBarSize*this.layout.scale,this.accoladeWidth+=t.display.accoladeBarPaddingRight*this.layout.scale,this.width+=this.accoladeWidth,this.computedWidth+=this.accoladeWidth}}getStaffTrackGroup(e){for(let t=0,i=this.staves.length;t<i;t++){let r=this.staves[t];if(r.track===e)return r}return null}addStaff(e,t){let i=this.getStaffTrackGroup(e);i||(i=new Gv(this,e),this.staves.push(i)),t.staffTrackGroup=i,t.system=this,t.index=this._allStaves.length,this._allStaves.push(t),i.addStaff(t),t.isInAccolade&&(this._firstStaffInAccolade||(this._firstStaffInAccolade=t,t.isFirstInAccolade=!0),i.firstStaffInAccolade||(i.firstStaffInAccolade=t),this._lastStaffInAccolade||(this._lastStaffInAccolade=t,t.isLastInAccolade=!0),this._lastStaffInAccolade&&(this._lastStaffInAccolade.isLastInAccolade=!1),this._lastStaffInAccolade=t,this._lastStaffInAccolade.isLastInAccolade=!0,i.lastStaffInAccolade=t)}get height(){return this._allStaves.length===0?0:this._allStaves[this._allStaves.length-1].y+this._allStaves[this._allStaves.length-1].height+this.topPadding+this.bottomPadding}scaleToWidth(e){for(let t=0,i=this._allStaves.length;t<i;t++)this._allStaves[t].scaleToWidth(e);this.width=e}paint(e,t,i){t+=this.topPadding,this.paintPartial(e+this.x,t+this.y,i,0,this.masterBarsRenderers.length)}paintPartial(e,t,i,r,n){for(let o=0,l=this._allStaves.length;o<l;o++)this._allStaves[o].paint(e,t,i,r,n);let a=this.layout.renderer.settings.display.resources;if(this.staves.length>0&&r===0){if(i.color=a.barSeparatorColor,this._firstStaffInAccolade&&this._lastStaffInAccolade){let l=t+this._firstStaffInAccolade.y+this._firstStaffInAccolade.staveTop+this._firstStaffInAccolade.topSpacing+this._firstStaffInAccolade.topOverflow,h=t+this._lastStaffInAccolade.y+this._lastStaffInAccolade.topSpacing+this._lastStaffInAccolade.topOverflow+this._lastStaffInAccolade.staveBottom,u=e+this._firstStaffInAccolade.x;i.beginPath(),i.moveTo(u,l),i.lineTo(u,h),i.stroke()}i.font=a.effectFont;const o=this.layout.renderer.settings;for(let l=0,h=this.staves.length;l<h;l++){let u=this.staves[l];if(u.firstStaffInAccolade&&u.lastStaffInAccolade){let c=t+u.firstStaffInAccolade.y+u.firstStaffInAccolade.staveTop+u.firstStaffInAccolade.topSpacing+u.firstStaffInAccolade.topOverflow,d=t+u.lastStaffInAccolade.y+u.lastStaffInAccolade.topSpacing+u.lastStaffInAccolade.topOverflow+u.lastStaffInAccolade.staveBottom;const p=this.index===0&&this.layout.renderer.settings.notation.isNotationElementVisible(K.TrackNames);let g=e+u.firstStaffInAccolade.x,w=Uo.AccoladeBarSize*this.layout.scale,S=o.display.accoladeBarPaddingRight*this.layout.scale,b=c-w*4,m=d+w*4;p&&i.fillText(u.track.shortName,e+o.display.systemLabelPaddingLeft*this.layout.scale,c),i.fillRect(g-S-w,b,w,m-b);let y=g-S-w,B=g+w*2;i.beginPath(),i.moveTo(y,b),i.bezierCurveTo(y,b,y,b,B,b-w),i.bezierCurveTo(g,b+w,y,b+w,y,b+w),i.closePath(),i.fill(),i.beginPath(),i.moveTo(y,m),i.bezierCurveTo(y,m,g,m,B,m+w),i.bezierCurveTo(g,m-w,y,m-w,y,m-w),i.closePath(),i.fill()}}}}finalizeSystem(){const e=this.layout.renderer.settings;this.index===0&&(this.topPadding=e.display.firstSystemPaddingTop*e.display.scale),this.isLast&&(this.bottomPadding=e.display.lastSystemPaddingBottom*e.display.scale);let t=0;for(let i of this._allStaves)i.x=this.accoladeWidth,i.y=t,i.finalizeStaff(),t+=i.height}buildBoundingsLookup(e,t){if(this.layout.renderer.boundsLookup.isFinished||!this._firstStaffInAccolade||!this._lastStaffInAccolade)return;t+=this.topPadding;let i=this._allStaves[this._allStaves.length-1],r=t+this.y+this._firstStaffInAccolade.y,n=t+this.y+this._lastStaffInAccolade.y+this._lastStaffInAccolade.height,a=t+this.y+this._allStaves[0].y,o=t+this.y+i.y+i.height,l=t+this.y+this._firstStaffInAccolade.y+this._firstStaffInAccolade.topSpacing+this._firstStaffInAccolade.topOverflow+(this._firstStaffInAccolade.barRenderers.length>0?this._firstStaffInAccolade.barRenderers[0].topPadding:0),h=t+this.y+i.y+i.height-i.bottomSpacing-i.bottomOverflow-(i.barRenderers.length>0?i.barRenderers[0].bottomPadding:0),u=n-r,c=h-l,d=o-a,p=this.x+this._firstStaffInAccolade.x,g=new qw;g.visualBounds=new si,g.visualBounds.x=e,g.visualBounds.y=t+this.y,g.visualBounds.w=this.width,g.visualBounds.h=this.height-this.topPadding-this.bottomPadding,g.realBounds=new si,g.realBounds.x=e,g.realBounds.y=t+this.y,g.realBounds.w=this.width,g.realBounds.h=this.height,this.layout.renderer.boundsLookup.addStaffSystem(g);let w=new Map;for(let S=0;S<this.staves.length;S++)for(let b of this.staves[S].stavesRelevantForBoundsLookup)for(let m of b.barRenderers){let y;w.has(m.bar.masterBar.index)?y=w.get(m.bar.masterBar.index):(y=new Jw,y.index=m.bar.masterBar.index,y.isFirstOfLine=m.isFirstOfLine,y.realBounds=new si,y.realBounds.x=p+m.x,y.realBounds.y=a,y.realBounds.w=m.width,y.realBounds.h=d,y.visualBounds=new si,y.visualBounds.x=p+m.x,y.visualBounds.y=r,y.visualBounds.w=m.width,y.visualBounds.h=u,y.lineAlignedBounds=new si,y.lineAlignedBounds.x=p+m.x,y.lineAlignedBounds.y=l,y.lineAlignedBounds.w=m.width,y.lineAlignedBounds.h=c,this.layout.renderer.boundsLookup.addMasterBar(y),w.set(y.index,y)),m.buildBoundingsLookup(y,p,t+this.y+b.y)}}getBarX(e){if(!this._firstStaffInAccolade||this.layout.renderer.tracks.length===0)return 0;let t=this.layout.renderer.tracks[0].staves[0].bars[e];return this.layout.getRendererForBar(this._firstStaffInAccolade.staveId,t).x}}Uo.AccoladeBarSize=3;class bs extends us{constructor(e,t,i,r){super(e,t),this._tuning=i,this._trackLabel=r,this.glyphs=[]}doLayout(){if(!(this.glyphs.length>0)){this.createGlyphs(this._tuning);for(const e of this.glyphs)e.renderer=this.renderer,e.doLayout()}}paint(e,t,i){i.textBaseline=te.Middle,super.paint(e,t,i)}createGlyphs(e){const t=this.renderer.scale,i=this.renderer.resources;this.height=0;const r=15*t;if(this._trackLabel.length>0){const o=new Mt(0,this.height,this._trackLabel,i.effectFont,Y.Left);o.renderer=this.renderer,o.doLayout(),this.height+=o.height,o.y+=o.height/2,this.addGlyph(o)}const n=new Mt(0,this.height,e.name,i.effectFont,Y.Left);n.renderer=this.renderer,n.doLayout(),this.height+=n.height,n.y+=n.height/2,this.addGlyph(n);const a=64*t;if(this.renderer.scoreRenderer.canvas.font=i.effectFont,this.width=Math.max(this.renderer.scoreRenderer.canvas.measureText(this._trackLabel).width*t,Math.max(this.renderer.scoreRenderer.canvas.measureText(e.name).width*t,2*a)),!e.isStandard){this.height+=r;const o=bs.CircleNumberScale,l=bs.CircleNumberHeight*o*t;let h=Math.ceil(e.tunings.length/2)|0,u=0,c=this.height;for(let d=0,p=e.tunings.length;d<p;d++){const g=f.GuitarString0+(d+1);this.addGlyph(new ht(u,c+l/2.5,o,g));const w="= "+R.getTextForTuning(e.tunings[d],!1);this.addGlyph(new Mt(u+l+1*t,c,w,i.effectFont,Y.Left)),c+=r,d===h-1&&(c=this.height,u+=a)}this.height+=h*r}this.width+=15*t}}bs.CircleNumberHeight=20;bs.CircleNumberScale=.7;class Uv extends hl{constructor(e,t){super(e,t,Y.Left)}addTuning(e,t){if(e.tunings.length>0){let i=new bs(0,0,e,t);i.renderer=this.renderer,i.doLayout(),this.glyphs.push(i)}}}class $v{constructor(e,t){this.args=e,this.renderCallback=t}}var Mi;(function(s){s[s.Automatic=0]="Automatic",s[s.FromModelWithScale=1]="FromModelWithScale",s[s.FromModelWithWidths=2]="FromModelWithWidths"})(Mi||(Mi={}));class nb{constructor(e){this._barRendererLookup=new Map,this.width=0,this.height=0,this.scoreInfoGlyphs=new Map,this.chordDiagrams=null,this.tuningGlyph=null,this.systemsLayoutMode=Mi.Automatic,this._lazyPartials=new Map,this.firstBarIndex=0,this.lastBarIndex=0,this.renderer=e}resize(){this._lazyPartials.clear(),this.doResize()}layoutAndRender(){this._lazyPartials.clear();let e=this.renderer.score,t=this.renderer.settings.display.startBar;t--,t=Math.min(e.masterBars.length-1,Math.max(0,t)),this.firstBarIndex=t;let i=this.renderer.settings.display.barCount;i<0&&(i=e.masterBars.length),i=t+i-1,i=Math.min(e.masterBars.length-1,Math.max(0,i)),this.lastBarIndex=i,this.createScoreInfoGlyphs(),this.doLayoutAndRender()}registerPartial(e,t){e.height!=0&&(this.renderer.settings.core.enableLazyLoading?(this._lazyPartials.set(e.id,new $v(e,t)),this.renderer.partialLayoutFinished.trigger(e)):(this.renderer.partialLayoutFinished.trigger(e),this.internalRenderLazyPartial(e,t)))}internalRenderLazyPartial(e,t){const i=this.renderer.canvas;i.beginRender(e.width,e.height),t(i),e.renderResult=i.endRender(),this.renderer.partialRenderFinished.trigger(e)}renderLazyPartial(e){if(this._lazyPartials.has(e)){const t=this._lazyPartials.get(e);this.internalRenderLazyPartial(t.args,t.renderCallback)}}createScoreInfoGlyphs(){C.debug("ScoreLayout","Creating score info glyphs");let e=this.renderer.settings.notation,t=this.renderer.score,i=this.renderer.settings.display.resources;this.scoreInfoGlyphs=new Map,t.title&&e.isNotationElementVisible(K.ScoreTitle)&&this.scoreInfoGlyphs.set(K.ScoreTitle,new Mt(0,0,t.title,i.titleFont,Y.Center)),t.subTitle&&e.isNotationElementVisible(K.ScoreSubTitle)&&this.scoreInfoGlyphs.set(K.ScoreSubTitle,new Mt(0,0,t.subTitle,i.subTitleFont,Y.Center)),t.artist&&e.isNotationElementVisible(K.ScoreArtist)&&this.scoreInfoGlyphs.set(K.ScoreArtist,new Mt(0,0,t.artist,i.subTitleFont,Y.Center)),t.album&&e.isNotationElementVisible(K.ScoreAlbum)&&this.scoreInfoGlyphs.set(K.ScoreAlbum,new Mt(0,0,t.album,i.subTitleFont,Y.Center)),t.music&&t.music===t.words&&e.isNotationElementVisible(K.ScoreWordsAndMusic)?this.scoreInfoGlyphs.set(K.ScoreWordsAndMusic,new Mt(0,0,"Music and Words by "+t.words,i.wordsFont,Y.Center)):(t.music&&e.isNotationElementVisible(K.ScoreMusic)&&this.scoreInfoGlyphs.set(K.ScoreMusic,new Mt(0,0,"Music by "+t.music,i.wordsFont,Y.Right)),t.words&&e.isNotationElementVisible(K.ScoreWords)&&this.scoreInfoGlyphs.set(K.ScoreWords,new Mt(0,0,"Words by "+t.words,i.wordsFont,Y.Left)));const r=new Ge(this.renderer,this.renderer.tracks[0].staves[0].bars[0]);for(const[n,a]of this.scoreInfoGlyphs)a.renderer=r,a.doLayout();if(e.isNotationElementVisible(K.GuitarTuning)){let n=[];for(let a of this.renderer.tracks)for(let o of a.staves)if(!o.isPercussion&&o.isStringed&&o.tuning.length>0&&o.showTablature){n.push(o);break}if(n.length>0){this.tuningGlyph=new Uv(0,0),this.tuningGlyph.renderer=r;for(const a of n)this.tuningGlyph.addTuning(a.stringTuning,n.length>1?a.track.name:"")}}if(e.isNotationElementVisible(K.ChordDiagrams)){this.chordDiagrams=new Hv(0,0),this.chordDiagrams.renderer=r;let n=new Set;for(let a of this.renderer.tracks)for(let o of a.staves){const l=o.chords;if(l)for(const[,h]of l)n.has(h.uniqueId)||h.showDiagram&&(n.add(h.uniqueId),this.chordDiagrams.addChord(h))}}}get scale(){return this.renderer.settings.display.scale}createEmptyStaffSystem(){let e=new Uo(this);for(let t=0;t<this.renderer.tracks.length;t++){let i=this.renderer.tracks[t];for(let r=0;r<i.staves.length;r++){let n=i.staves[r],a=T.staveProfiles.get(this.renderer.settings.display.staveProfile);for(let o of a)o.canCreate(i,n)&&e.addStaff(i,new Wv(t,n,o))}}return e}registerBarRenderer(e,t){this._barRendererLookup.has(e)||this._barRendererLookup.set(e,new Map),this._barRendererLookup.get(e).set(t.bar.id,t)}unregisterBarRenderer(e,t){this._barRendererLookup.has(e)&&this._barRendererLookup.get(e).delete(t.bar.id)}getRendererForBar(e,t){let i=t.id;return this._barRendererLookup.has(e)&&this._barRendererLookup.get(e).has(i)?this._barRendererLookup.get(e).get(i):null}layoutAndRenderAnnotation(e){let t="rendered by alphaTab",i=this.renderer.settings.display.resources,r=12*this.renderer.settings.display.scale,n=Math.floor(r);const a=new cn,o=he.withFamilyList(i.copyrightFont.families,r,Ue.Plain,Ci.Bold);this.renderer.canvas.font=o;const l=T.getLayoutEngineFactory(this.renderer.settings.display.layoutMode).vertical;return a.width=this.renderer.canvas.measureText(t).width,a.height=n,a.x=l?(this.width-a.width)/2:this.firstBarX,a.y=e,a.totalWidth=this.width,a.totalHeight=e+n,a.firstMasterBarIndex=-1,a.lastMasterBarIndex=-1,this.registerPartial(a,h=>{h.color=i.mainGlyphColor,h.font=o,h.textAlign=Y.Left,h.textBaseline=te.Top,h.fillText(t,0,0)}),e+n}}var H;(function(s){s[s.TopWithStem=0]="TopWithStem",s[s.Top=1]="Top",s[s.Center=2]="Center",s[s.Bottom=3]="Bottom",s[s.BottomWithStem=4]="BottomWithStem"})(H||(H={}));var Fe;(function(s){s[s.Left=0]="Left",s[s.Center=1]="Center",s[s.Right=2]="Right"})(Fe||(Fe={}));class Ge{get nextRenderer(){return!this.bar||!this.bar.nextBar?null:this.scoreRenderer.layout.getRendererForBar(this.staff.staveId,this.bar.nextBar)}get previousRenderer(){return!this.bar||!this.bar.previousBar?null:this.scoreRenderer.layout.getRendererForBar(this.staff.staveId,this.bar.previousBar)}constructor(e,t){this._preBeatGlyphs=new Ua,this._voiceContainers=new Map,this._postBeatGlyphs=new Ua,this._ties=[],this.x=0,this.y=0,this.width=0,this.computedWidth=0,this.height=0,this.index=0,this.topOverflow=0,this.bottomOverflow=0,this.isLinkedToPrevious=!1,this.canWrap=!0,this._wasFirstOfLine=!1,this._appliedLayoutingInfo=0,this.isFinalized=!1,this.topPadding=0,this.bottomPadding=0,this.scoreRenderer=e,this.bar=t,t&&(this.helpers=new Vv(this))}registerTies(e){this._ties.push(...e)}get middleYPosition(){return 0}registerOverflowTop(e){return e>this.topOverflow?(this.topOverflow=e,!0):!1}registerOverflowBottom(e){return e>this.bottomOverflow?(this.bottomOverflow=e,!0):!1}scaleToWidth(e){let t=e-this._preBeatGlyphs.width-this._postBeatGlyphs.width;for(const i of this._voiceContainers.values())i.scaleToWidth(t);this._postBeatGlyphs.x=this._preBeatGlyphs.x+this._preBeatGlyphs.width+t,this.width=e}get resources(){return this.settings.display.resources}get settings(){return this.scoreRenderer.settings}get scale(){return this.settings.display.scale}get barDisplayScale(){return this.staff.system.staves.length>1?this.bar.masterBar.displayScale:this.bar.displayScale}get barDisplayWidth(){return this.staff.system.staves.length>1?this.bar.masterBar.displayWidth:this.bar.displayWidth}get isFirstOfLine(){return this.index===0}get isLast(){return!this.bar||this.bar.index===this.scoreRenderer.layout.lastBarIndex}registerLayoutingInfo(){let e=this.layoutingInfo,t=this._preBeatGlyphs.width;e.preBeatSize<t&&(e.preBeatSize=t);for(const r of this._voiceContainers.values())r.registerLayoutingInfo(e),r.x+r.width;let i=this._postBeatGlyphs.width;e.postBeatSize<i&&(e.postBeatSize=i)}applyLayoutingInfo(){if(this._appliedLayoutingInfo>=this.layoutingInfo.version)return!1;this._appliedLayoutingInfo=this.layoutingInfo.version,this._preBeatGlyphs.width=this.layoutingInfo.preBeatSize;let e=this._preBeatGlyphs.x+this._preBeatGlyphs.width;for(const i of this._voiceContainers.values()){i.x=this._preBeatGlyphs.x+this._preBeatGlyphs.width,i.applyLayoutingInfo(this.layoutingInfo);let r=i.x+i.width;e<r&&(e=r)}this._postBeatGlyphs.x=Math.floor(e),this._postBeatGlyphs.width=this.layoutingInfo.postBeatSize,this.width=Math.ceil(this._postBeatGlyphs.x+this._postBeatGlyphs.width),this.computedWidth=this.width;const t=this.barDisplayWidth;return t>0&&this.scoreRenderer.layout.systemsLayoutMode==Mi.FromModelWithWidths&&(this.width=t,this.computedWidth=t),!0}finalizeRenderer(){this.isFinalized=!0;let e=!1;const t=this.y-this.staff.topSpacing,i=this.y+this.height+this.staff.bottomSpacing;for(const r of this._ties)if(r.doLayout(),r.height>0){const n=r.y+r.height-i;n>0&&this.registerOverflowBottom(n)&&(e=!0);const a=r.y-t;a<0&&this.registerOverflowTop(a*-1)&&(e=!0)}return e}doLayout(){if(this.bar){this.helpers.initialize(),this._ties=[],this._preBeatGlyphs=new Ua,this._preBeatGlyphs.renderer=this,this._voiceContainers.clear(),this._postBeatGlyphs=new Ua,this._postBeatGlyphs.renderer=this;for(let e=0;e<this.bar.voices.length;e++){let t=this.bar.voices[e];if(this.hasVoiceContainer(t)){let i=new rb(0,0,t);i.renderer=this,this._voiceContainers.set(this.bar.voices[e].index,i)}}this.bar.simileMark===Qi.SecondOfDouble&&(this.canWrap=!1),this.createPreBeatGlyphs(),this.createBeatGlyphs(),this.createPostBeatGlyphs(),this.updateSizes();for(const e of this.helpers.beamHelpers)for(const t of e)t.finish();this.computedWidth=this.width}}hasVoiceContainer(e){return!e.isEmpty||e.index===0}updateSizes(){this.staff.registerStaffTop(this.topPadding),this.staff.registerStaffBottom(this.height-this.bottomPadding);let e=this._voiceContainers,t=this.beatGlyphsStart,i=t;for(const r of e.values()){r.x=t,r.doLayout();let n=r.x+r.width;i<n&&(i=n)}this._postBeatGlyphs.x=Math.floor(i),this.width=Math.ceil(this._postBeatGlyphs.x+this._postBeatGlyphs.width),this.height+=this.layoutingInfo.height*this.scale}addPreBeatGlyph(e){e.renderer=this,this._preBeatGlyphs.addGlyph(e)}addBeatGlyph(e){e.renderer=this,e.preNotes.renderer=this,e.onNotes.renderer=this,e.onNotes.beamingHelper=this.helpers.beamHelperLookup[e.beat.voice.index].get(e.beat.index),this.getVoiceContainer(e.beat.voice).addGlyph(e)}getVoiceContainer(e){return this._voiceContainers.has(e.index)?this._voiceContainers.get(e.index):void 0}getBeatContainer(e){var t,i;return(i=(t=this.getVoiceContainer(e.voice))==null?void 0:t.beatGlyphs)==null?void 0:i[e.index]}getPreNotesGlyphForBeat(e){var t;return(t=this.getBeatContainer(e))==null?void 0:t.preNotes}getOnNotesGlyphForBeat(e){var t;return(t=this.getBeatContainer(e))==null?void 0:t.onNotes}paint(e,t,i){this.paintBackground(e,t,i),i.color=this.resources.mainGlyphColor,this._preBeatGlyphs.paint(e+this.x,t+this.y,i);for(const r of this._voiceContainers.values())i.color=r.voice.index===0?this.resources.mainGlyphColor:this.resources.secondaryGlyphColor,r.paint(e+this.x,t+this.y,i);i.color=this.resources.mainGlyphColor,this._postBeatGlyphs.paint(e+this.x,t+this.y,i)}paintBackground(e,t,i){this.layoutingInfo.paint(e+this.x+this._preBeatGlyphs.x+this._preBeatGlyphs.width,t+this.y+this.height,i)}buildBoundingsLookup(e,t,i){let r=new Xw;r.bar=this.bar,r.visualBounds=new si,r.visualBounds.x=t+this.x,r.visualBounds.y=i+this.y+this.topPadding,r.visualBounds.w=this.width,r.visualBounds.h=this.height-this.topPadding-this.bottomPadding,r.realBounds=new si,r.realBounds.x=t+this.x,r.realBounds.y=i+this.y,r.realBounds.w=this.width,r.realBounds.h=this.height,e.addBar(r);for(const[n,a]of this._voiceContainers){let o=this.bar.isEmpty&&n===0;if(!a.voice.isEmpty||o)for(let l=0,h=a.beatGlyphs.length;l<h;l++)a.beatGlyphs[l].buildBoundingsLookup(r,t+this.x+a.x,i+this.y+a.y,o)}}addPostBeatGlyph(e){this._postBeatGlyphs.addGlyph(e)}createPreBeatGlyphs(){this._wasFirstOfLine=this.isFirstOfLine}createBeatGlyphs(){for(const e of this.bar.voices)this.hasVoiceContainer(e)&&this.createVoiceGlyphs(e)}createVoiceGlyphs(e){}createPostBeatGlyphs(){}get beatGlyphsStart(){return this._preBeatGlyphs.x+this._preBeatGlyphs.width}get postBeatGlyphsStart(){return this._postBeatGlyphs.x}getBeatX(e,t=ae.PreNotes){let i=this.getBeatContainer(e);if(i)switch(t){case ae.PreNotes:return i.voiceContainer.x+i.x;case ae.OnNotes:return i.voiceContainer.x+i.x+i.onNotes.x;case ae.MiddleNotes:return i.voiceContainer.x+i.x+i.onTimeX;case ae.Stem:const r=i.onNotes.beamingHelper?i.onNotes.beamingHelper.getBeatLineX(e):i.onNotes.x+i.onNotes.width/2;return i.voiceContainer.x+r;case ae.PostNotes:return i.voiceContainer.x+i.x+i.onNotes.x+i.onNotes.width;case ae.EndBeat:return i.voiceContainer.x+i.x+i.width}return 0}getNoteX(e,t){let i=this.getBeatContainer(e.beat);return i?i.voiceContainer.x+i.x+i.onNotes.x+i.onNotes.getNoteX(e,t):0}getNoteY(e,t){let i=this.getOnNotesGlyphForBeat(e.beat);return i?i.getNoteY(e,t):NaN}reLayout(){(this._wasFirstOfLine&&!this.isFirstOfLine||!this._wasFirstOfLine&&this.isFirstOfLine)&&(this._preBeatGlyphs=new Ua,this._preBeatGlyphs.renderer=this,this.createPreBeatGlyphs()),this.updateSizes(),this.registerLayoutingInfo()}paintSimileMark(e,t,i){switch(this.bar.simileMark){case Qi.Simple:i.fillMusicFontSymbol(e+this.x+(this.width-20*this.scale)/2,t+this.y+this.height/2,1,f.Repeat1Bar,!1);break;case Qi.SecondOfDouble:i.fillMusicFontSymbol(e+this.x-28*this.scale/2,t+this.y+this.height/2,1,f.Repeat2Bars,!1);break}}completeBeamingHelper(e){}getBeatDirection(e){return this.helpers.getBeamingHelperForBeat(e).direction}}Ge.RawLineSpacing=8;Ge.StemWidth=.12*Ge.RawLineSpacing;Ge.StaffLineThickness=.13*Ge.RawLineSpacing;Ge.BeamThickness=.5*Ge.RawLineSpacing;Ge.BeamSpacing=.25*Ge.RawLineSpacing;var we;(function(s){s[s.SinglePreBeat=0]="SinglePreBeat",s[s.SingleOnBeat=1]="SingleOnBeat",s[s.SingleOnBeatToEnd=2]="SingleOnBeatToEnd",s[s.GroupedOnBeat=3]="GroupedOnBeat",s[s.GroupedOnBeatToEnd=4]="GroupedOnBeatToEnd",s[s.FullBar=5]="FullBar"})(we||(we={}));class Yv extends qe{constructor(e,t){super(0,0),this._uniqueEffectGlyphs=[],this._effectGlyphs=[],this.isEmpty=!0,this.previousBand=null,this.isLinkedToPrevious=!1,this.firstBeat=null,this.lastBeat=null,this.height=0,this.originalHeight=0,this.slot=null,this.voice=e,this.info=t}doLayout(){super.doLayout();for(let e=0;e<this.renderer.bar.voices.length;e++)this._effectGlyphs.push(new Map),this._uniqueEffectGlyphs.push([])}createGlyph(e){if(e.voice===this.voice&&this.info.shouldCreateGlyph(this.renderer.settings,e)&&(!this.info.hideOnMultiTrack||this.renderer.staff.trackIndex===0)){if(this.isEmpty=!1,(!this.firstBeat||e.isBefore(this.firstBeat))&&(this.firstBeat=e),!this.lastBeat||e.isAfter(this.lastBeat))switch(this.lastBeat=e,this.info.sizingMode){case we.SingleOnBeatToEnd:case we.GroupedOnBeatToEnd:this.lastBeat.nextBeat&&(this.lastBeat=this.lastBeat.nextBeat);break}let t=this.createOrResizeGlyph(this.info.sizingMode,e);t.height>this.height&&(this.height=t.height,this.originalHeight=t.height)}}resetHeight(){this.height=this.originalHeight}createOrResizeGlyph(e,t){let i;switch(e){case we.FullBar:return i=this.info.createNewGlyph(this.renderer,t),i.renderer=this.renderer,i.beat=t,i.doLayout(),this._effectGlyphs[t.voice.index].set(t.index,i),this._uniqueEffectGlyphs[t.voice.index].push(i),i;case we.SinglePreBeat:case we.SingleOnBeat:case we.SingleOnBeatToEnd:return i=this.info.createNewGlyph(this.renderer,t),i.renderer=this.renderer,i.beat=t,i.doLayout(),this._effectGlyphs[t.voice.index].set(t.index,i),this._uniqueEffectGlyphs[t.voice.index].push(i),i;case we.GroupedOnBeat:case we.GroupedOnBeatToEnd:let r=e===we.GroupedOnBeat?we.SingleOnBeat:we.SingleOnBeatToEnd;if(t.index>0||this.renderer.index>0){let n=t.previousBeat;if(this.info.shouldCreateGlyph(this.renderer.settings,n)){let a=null;if(t.index>0&&this._effectGlyphs[t.voice.index].has(n.index))a=this._effectGlyphs[t.voice.index].get(n.index);else if(this.renderer.index>0){let h=this.renderer.previousRenderer.getBand(n.voice,this.info.effectId);if(h){let u=h._effectGlyphs[n.voice.index];u.has(n.index)&&(a=u.get(n.index))}}let o=this.createOrResizeGlyph(r,t);return a&&this.info.canExpand(n,t)&&(a.nextGlyph=o,o.previousGlyph=a,this.isLinkedToPrevious=!0),o}return this.createOrResizeGlyph(r,t)}return this.createOrResizeGlyph(r,t);default:return this.createOrResizeGlyph(we.SingleOnBeat,t)}}paint(e,t,i){super.paint(e,t,i);for(let r=0,n=this._uniqueEffectGlyphs.length;r<n;r++){let a=this._uniqueEffectGlyphs[r];for(let o=0,l=a.length;o<l;o++)a[o].paint(e+this.x,t+this.y,i)}}alignGlyphs(){for(let e=0;e<this._effectGlyphs.length;e++)for(const t of this._effectGlyphs[e].keys())this.alignGlyph(this.info.sizingMode,this.renderer.bar.voices[e].beats[t])}alignGlyph(e,t){let i=this._effectGlyphs[t.voice.index].get(t.index),r,n=this.renderer.getBeatContainer(t);switch(e){case we.SinglePreBeat:r=n.preNotes,i.x=this.renderer.beatGlyphsStart+r.x+n.x,i.width=r.width;break;case we.SingleOnBeat:case we.GroupedOnBeat:r=n.onNotes,i.x=this.renderer.beatGlyphsStart+r.x+n.x,i.width=r.width;break;case we.SingleOnBeatToEnd:case we.GroupedOnBeatToEnd:r=n.onNotes,i.x=this.renderer.beatGlyphsStart+r.x+n.x,n.beat.isLastOfVoice?i.width=this.renderer.width-i.x:i.width=n.width-n.preNotes.width-n.preNotes.x;break;case we.FullBar:i.width=this.renderer.width;break}}}class Xv{constructor(){this.uniqueEffectId=null,this.y=0,this.height=0,this.firstBeat=null,this.lastBeat=null}}class Qv{constructor(){this.bands=[],this.shared=new Xv}update(e){e.info.canShareBand||(this.shared.uniqueEffectId=e.info.effectId),e.slot=this,this.bands.push(e),e.height>this.shared.height&&(this.shared.height=e.height),(!this.shared.firstBeat||e.firstBeat.isBefore(this.shared.firstBeat))&&(this.shared.firstBeat=e.firstBeat),(!this.shared.lastBeat||e.lastBeat.isAfter(this.shared.lastBeat))&&(this.shared.lastBeat=e.lastBeat)}canBeUsed(e){return(!this.shared.uniqueEffectId&&e.info.canShareBand||e.info.effectId===this.shared.uniqueEffectId)&&(!this.shared.firstBeat||this.shared.lastBeat.isBefore(e.firstBeat)||this.shared.lastBeat.isBefore(this.shared.firstBeat))}}class Jv{constructor(){this.slots=[],this._effectSlot=new Map}getOrCreateSlot(e){if(this._effectSlot.has(e.info.effectId)){let i=this._effectSlot.get(e.info.effectId);if(i.canBeUsed(e))return i}for(let i of this.slots)if(i.canBeUsed(e))return i;let t=new Qv;return this.slots.push(t),t}register(e){let t=this.getOrCreateSlot(e);t.update(e),this._effectSlot.set(e.info.effectId,t)}}class Dn extends us{constructor(){super(0,0),this.computedWidth=0}doLayout(){let e=0;if(this.glyphs)for(let t=0,i=this.glyphs.length;t<i;t++){let r=this.glyphs[t];r.x=e,r.renderer=this.renderer,r.doLayout(),e+=r.width}this.width=e,this.computedWidth=e}noteLoop(e){for(let t=this.container.beat.notes.length-1;t>=0;t--)e(this.container.beat.notes[t])}}class An extends Dn{constructor(){super(...arguments),this.centerX=0}updateBeamingHelper(){}buildBoundingsLookup(e,t,i){}getNoteX(e,t){return 0}getNoteY(e,t){return 0}}class qv extends Ge{constructor(e,t,i){super(e,t),this._bands=[],this._bandLookup=new Map,this.sizingInfo=null,this._infos=i}updateSizes(){this.topOverflow=0,this.bottomOverflow=0,this.topPadding=0,this.bottomPadding=0,this.updateHeight(),super.updateSizes()}finalizeRenderer(){let e=super.finalizeRenderer();return this.updateHeight()&&(e=!0),e}updateHeight(){if(!this.sizingInfo)return!1;let e=0;for(let t of this.sizingInfo.slots){t.shared.y=e;for(let i of t.bands)i.y=e,i.height=t.shared.height;e+=t.shared.height}return e!==this.height?(this.height=e,!0):!1}applyLayoutingInfo(){const e=!super.applyLayoutingInfo();if(this.index>0){let t=this.previousRenderer;this.sizingInfo=t.sizingInfo}else this.sizingInfo=new Jv;for(let t of this._bands)t.resetHeight(),t.alignGlyphs(),t.isEmpty||this.sizingInfo.register(t);return this.updateHeight(),e}scaleToWidth(e){super.scaleToWidth(e);for(let t of this._bands)t.alignGlyphs()}createBeatGlyphs(){this._bands=[],this._bandLookup=new Map;for(let e of this.bar.voices)if(this.hasVoiceContainer(e))for(let t of this._infos){let i=new Yv(e,t);i.renderer=this,i.doLayout(),this._bands.push(i),this._bandLookup.set(e.index+"."+t.effectId,i)}for(let e of this.bar.voices)this.hasVoiceContainer(e)&&this.createVoiceGlyphs(e);for(let e of this._bands)e.isLinkedToPrevious&&(this.isLinkedToPrevious=!0)}createVoiceGlyphs(e){for(let t of e.beats){let i=new Ui(t,this.getVoiceContainer(e));i.preNotes=new Dn,i.onNotes=new An,this.addBeatGlyph(i);for(let r of this._bands)r.createGlyph(t)}}paint(e,t,i){this.paintBackground(e,t,i);for(let r of this._bands)i.color=r.voice.index===0?this.resources.mainGlyphColor:this.resources.secondaryGlyphColor,r.isEmpty||r.paint(e+this.x,t+this.y,i)}getBand(e,t){let i=e.index+"."+t;return this._bandLookup.has(i)?this._bandLookup.get(i):null}}class Gn extends ll{get staffId(){return this._staffId}getStaffPaddingTop(e){return e.system.layout.renderer.settings.display.effectStaffPaddingTop}getStaffPaddingBottom(e){return e.system.layout.renderer.settings.display.effectStaffPaddingBottom}constructor(e,t,i=null){super(),this.infos=t,this._staffId=e,this.isInAccolade=!1,this.isRelevantForBoundsLookup=!1,this.shouldShow=i}canCreate(e,t){const i=this.shouldShow;return super.canCreate(e,t)&&(!i||i(e,t))}create(e,t){return new qv(e,t,this.infos.filter(i=>e.settings.notation.isNotationElementVisible(i.notationElement)))}}class $o extends Ii{constructor(e,t,i){super(e,t),this._endingsString="",this._endings=[];for(let r=0;r<mr.MaxAlternateEndings;r++)i&1<<r&&this._endings.push(r)}doLayout(){super.doLayout(),this.height=this.renderer.resources.wordsFont.size+($o.Padding*this.scale+2);let e="";for(let t=0,i=this._endings.length;t<i;t++)e+=this._endings[t]+1,e+=". ";this._endingsString=e}paint(e,t,i){super.paint(e,t,i);let r=i.textBaseline;if(i.textBaseline=te.Top,this._endings.length>0){let n=this.renderer.resources;i.font=n.wordsFont,i.moveTo(e+this.x,t+this.y+this.height),i.lineTo(e+this.x,t+this.y),i.lineTo(e+this.x+this.width,t+this.y),i.stroke(),i.fillText(this._endingsString,e+this.x+$o.Padding*this.scale,t+this.y*this.scale)}i.textBaseline=r}}$o.Padding=3;class _t{get effectId(){return this.notationElement.toString()}}class Kv extends _t{get notationElement(){return K.EffectAlternateEndings}get hideOnMultiTrack(){return!0}get canShareBand(){return!1}get sizingMode(){return we.FullBar}shouldCreateGlyph(e,t){return t.voice.index===0&&t.index===0&&t.voice.bar.masterBar.alternateEndings!==0}createNewGlyph(e,t){return new $o(0,0,t.voice.bar.masterBar.alternateEndings)}canExpand(e,t){return!0}}class jv extends _t{get notationElement(){return K.EffectCapo}get hideOnMultiTrack(){return!1}get canShareBand(){return!1}get sizingMode(){return we.SingleOnBeat}shouldCreateGlyph(e,t){return t.index===0&&t.voice.bar.index===0&&t.voice.bar.staff.capo!==0}createNewGlyph(e,t){return new Mt(0,0,"Capo. fret "+t.voice.bar.staff.capo,e.resources.effectFont,Y.Left)}canExpand(e,t){return!1}}class Zv extends _t{get notationElement(){return K.EffectChordNames}get hideOnMultiTrack(){return!1}get canShareBand(){return!0}get sizingMode(){return we.SingleOnBeat}shouldCreateGlyph(e,t){return t.hasChord}createNewGlyph(e,t){return new Mt(0,0,t.chord.name,e.resources.effectFont,Y.Center)}canExpand(e,t){return!1}}class ul extends Ii{constructor(e){super(),this.forceGroupedRendering=!1,this.endOnBarLine=!1,this.endPosition=e}get isLinkedWithPrevious(){return!!this.previousGlyph&&this.previousGlyph.renderer.staff.system===this.renderer.staff.system}get isLinkedWithNext(){return!!this.nextGlyph&&this.nextGlyph.renderer.isFinalized&&this.nextGlyph.renderer.staff.system===this.renderer.staff.system}paint(e,t,i){if(this.isLinkedWithPrevious)return;if(!this.isLinkedWithNext&&!this.forceGroupedRendering){this.paintNonGrouped(e,t,i);return}let r;if(!this.isLinkedWithNext&&this.forceGroupedRendering)r=this;else for(r=this.nextGlyph;r.isLinkedWithNext;)r=r.nextGlyph;let n=r.renderer,a=r.beat,o=this.endPosition,l=e-this.renderer.x,h=this.calculateEndX(n,a,l,o);this.paintGrouped(e,t,h,i)}calculateEndX(e,t,i,r){return t?i+e.x+e.getBeatX(t,r):i+e.x+this.x+this.width}paintNonGrouped(e,t,i){let r=e-this.renderer.x,n=this.calculateEndX(this.renderer,this.beat,r,this.endPosition);this.paintGrouped(e,t,n,i)}}class Yo extends ul{constructor(e,t,i){super(ae.EndBeat),this._crescendo=ki.None,this._crescendo=i,this.x=e,this.y=t}doLayout(){super.doLayout(),this.height=17*this.scale}paintGrouped(e,t,i,r){let n=e+this.x,a=this.height*this.scale;r.beginPath(),this._crescendo===ki.Crescendo?(i-=Yo.Padding*this.scale,r.moveTo(i,t+this.y),r.lineTo(n,t+this.y+a/2),r.lineTo(i,t+this.y+a)):(i-=Yo.Padding*this.scale,r.moveTo(n,t+this.y),r.lineTo(i,t+this.y+a/2),r.lineTo(n,t+this.y+a)),r.stroke()}}Yo.Padding=ee.QuarterNoteHeadWidth/2|0;class eT extends _t{get notationElement(){return K.EffectCrescendo}get hideOnMultiTrack(){return!1}get canShareBand(){return!0}get sizingMode(){return we.GroupedOnBeatToEnd}shouldCreateGlyph(e,t){return t.crescendo!==ki.None}createNewGlyph(e,t){return new Yo(0,0,t.crescendo)}canExpand(e,t){return e.crescendo===t.crescendo}}class dp extends ht{constructor(e,t,i){super(e,t,.6,dp.getSymbol(i))}doLayout(){super.doLayout(),this.height=17*this.scale,this.y+=this.height/2}static getSymbol(e){switch(e){case de.PPP:return f.DynamicPPP;case de.PP:return f.DynamicPP;case de.P:return f.DynamicPiano;case de.MP:return f.DynamicMP;case de.MF:return f.DynamicMF;case de.F:return f.DynamicForte;case de.FF:return f.DynamicFF;case de.FFF:return f.DynamicFFF;default:return f.None}}}class tT extends _t{get notationElement(){return K.EffectDynamics}get hideOnMultiTrack(){return!1}get canShareBand(){return!1}get sizingMode(){return we.SingleOnBeat}shouldCreateGlyph(e,t){return this.internalShouldCreateGlyph(t)}internalShouldCreateGlyph(e){if(e.voice.bar.staff.track.score.stylesheet.hideDynamics||e.isEmpty||e.voice.isEmpty||e.isRest||e.graceType!==$.None)return!1;let t=this.getPreviousDynamicsBeat(e),i=e.voice.index===0&&!t||e.dynamics!==(t==null?void 0:t.dynamics);if(i&&e.voice.index>0){for(let r of e.voice.bar.voices)if(r.index<e.voice.index){let n=r.getBeatAtPlaybackStart(e.playbackStart);n&&e.dynamics===n.dynamics&&this.internalShouldCreateGlyph(n)&&(i=!1)}}return i}getPreviousDynamicsBeat(e){let t=e.previousBeat;for(;t!=null;){if(!t.isRest&&t.graceType===$.None)return t;t=t.previousBeat}return null}createNewGlyph(e,t){return new dp(0,0,t.dynamics)}canExpand(e,t){return!0}}class iT extends Ii{doLayout(){super.doLayout(),this.height=17*this.scale}paint(e,t,i){let r=6*this.scale,n=Math.max(this.width,14*this.scale),a=this.height/2;i.beginPath(),i.moveTo(e+this.x,t+this.y+a),i.quadraticCurveTo(e+this.x+n/2,t+this.y+a,e+this.x+n,t+this.y+a-r),i.moveTo(e+this.x,t+this.y+a),i.quadraticCurveTo(e+this.x+n/2,t+this.y+a,e+this.x+n,t+this.y+a+r),i.stroke()}}class sT extends _t{get notationElement(){return K.EffectFadeIn}get hideOnMultiTrack(){return!1}get canShareBand(){return!0}get sizingMode(){return we.SingleOnBeat}shouldCreateGlyph(e,t){return t.fadeIn}createNewGlyph(e,t){return new iT}canExpand(e,t){return!0}}class fp extends ht{constructor(e,t,i){super(e,t,1,fp.getSymbol(i))}static getSymbol(e){switch(e){case Ts.Short:return f.FermataShortAbove;case Ts.Medium:return f.FermataAbove;case Ts.Long:return f.FermataLongAbove;default:return f.None}}doLayout(){this.width=23*this.scale,this.height=12*this.scale}paint(e,t,i){super.paint(e-this.width/2,t+this.height,i)}}class rT extends _t{get notationElement(){return K.EffectFermata}get hideOnMultiTrack(){return!1}get canShareBand(){return!1}get sizingMode(){return we.SingleOnBeat}shouldCreateGlyph(e,t){return t.voice.index===0&&!!t.fermata}createNewGlyph(e,t){return new fp(0,0,t.fermata.type)}canExpand(e,t){return!0}}class nT extends _t{get notationElement(){return K.EffectFingering}get hideOnMultiTrack(){return!1}get canShareBand(){return!0}get sizingMode(){return we.SingleOnBeat}shouldCreateGlyph(e,t){return t.voice.index!==0||t.isRest||e.notation.fingeringMode!==Cs.SingleNoteEffectBand&&e.notation.fingeringMode!==Cs.SingleNoteEffectBandForcePiano||t.notes.length!==1?!1:t.notes[0].isFingering}createNewGlyph(e,t){let i=oe.Unknown,r=!1,n=t.notes[0];n.leftHandFinger!==oe.Unknown?(i=n.leftHandFinger,r=!0):n.rightHandFinger!==oe.Unknown&&(i=n.rightHandFinger);let a=Re.fingerToString(e.settings,t,i,r)??"";return new Mt(0,0,a,e.resources.fingeringFont,Y.Left)}canExpand(e,t){return!0}}class In extends _t{constructor(){super(...arguments),this.lastCreateInfo=null}shouldCreateGlyph(e,t){this.lastCreateInfo=[];for(let i=0,r=t.notes.length;i<r;i++){let n=t.notes[i];this.shouldCreateGlyphForNote(n)&&this.lastCreateInfo.push(n)}return this.lastCreateInfo.length>0}get hideOnMultiTrack(){return!1}get canShareBand(){return!0}canExpand(e,t){return!0}}class _r extends ul{constructor(e){super(ae.OnNotes),this._label=e}doLayout(){this.renderer.settings.notation.extendLineEffectsToBeatEnd&&(this.endPosition=ae.EndBeat,this.forceGroupedRendering=!0),super.doLayout(),this.height=this.renderer.resources.effectFont.size}paintNonGrouped(e,t,i){let r=this.renderer.resources;i.font=r.effectFont;let n=i.textAlign;i.textAlign=Y.Center,i.fillText(this._label,e+this.x,t+this.y),i.textAlign=n}paintGrouped(e,t,i,r){this.paintNonGrouped(e,t,r);let n=3*this.scale,a=r.measureText(this._label).width,o=e+this.x+a/2+n,l=t+this.y+4*this.scale,h=8*this.scale;if(i>o){let u=o;for(;u<i;)r.beginPath(),r.moveTo(u,l|0),r.lineTo(Math.min(u+h,i),l|0),u+=h+n,r.stroke();r.beginPath(),r.moveTo(i,l-5*this.scale|0),r.lineTo(i,l+5*this.scale|0),r.stroke()}}}_r.LineSpacing=3;_r.LineTopPadding=4;_r.LineTopOffset=5;_r.LineSize=8;class Pr extends In{get effectId(){return this._effectId}get notationElement(){return K.EffectHarmonics}constructor(e){switch(super(),this._beat=null,this._harmonicType=e,e){case X.None:this._effectId="harmonics-none";break;case X.Natural:this._effectId="harmonics-natural";break;case X.Artificial:this._effectId="harmonics-artificial";break;case X.Pinch:this._effectId="harmonics-pinch";break;case X.Tap:this._effectId="harmonics-tap";break;case X.Semi:this._effectId="harmonics-semi";break;case X.Feedback:this._effectId="harmonics-feedback";break;default:this._effectId="";break}}shouldCreateGlyphForNote(e){return!e.isHarmonic||e.harmonicType!==this._harmonicType?!1:(e.beat!==this._beat&&(this._beat=e.beat),!0)}get sizingMode(){return we.GroupedOnBeat}createNewGlyph(e,t){return new _r(Pr.harmonicToString(this._harmonicType))}static harmonicToString(e){switch(e){case X.Natural:return"N.H.";case X.Artificial:return"A.H.";case X.Pinch:return"P.H.";case X.Tap:return"T.H.";case X.Semi:return"S.H.";case X.Feedback:return"Fdbk."}return""}}class aT extends _t{get notationElement(){return K.EffectLetRing}get canShareBand(){return!1}get hideOnMultiTrack(){return!1}shouldCreateGlyph(e,t){return t.isLetRing}get sizingMode(){return we.GroupedOnBeat}createNewGlyph(e,t){return new _r("LetRing")}canExpand(e,t){return!0}}class oT extends Ii{constructor(e,t,i,r,n=Y.Center){super(e,t),this._lines=i,this.font=r,this.textAlign=n}doLayout(){super.doLayout(),this.height=this.font.size*this._lines.length}paint(e,t,i){i.font=this.font;let r=i.textAlign;i.textAlign=this.textAlign;for(let n=0;n<this._lines.length;n++)this._lines[n]&&i.fillText(this._lines[n],e+this.x,t+this.y+n*this.font.size);i.textAlign=r}}class lT extends _t{get notationElement(){return K.EffectLyrics}get hideOnMultiTrack(){return!1}get canShareBand(){return!1}get sizingMode(){return we.SingleOnBeat}shouldCreateGlyph(e,t){return!!t.lyrics}createNewGlyph(e,t){return new oT(0,0,t.lyrics,e.resources.effectFont,Y.Center)}canExpand(e,t){return!0}}class hT extends _t{get notationElement(){return K.EffectMarker}get hideOnMultiTrack(){return!0}get canShareBand(){return!0}get sizingMode(){return we.SinglePreBeat}shouldCreateGlyph(e,t){return t.voice.bar.staff.index===0&&t.voice.index===0&&t.index===0&&t.voice.bar.masterBar.isSectionStart}createNewGlyph(e,t){return new Mt(0,0,t.voice.bar.masterBar.section.marker?"["+t.voice.bar.masterBar.section.marker+"] "+t.voice.bar.masterBar.section.text:t.voice.bar.masterBar.section.text,e.resources.markerFont,Y.Left)}canExpand(e,t){return!0}}class uT extends ul{constructor(e,t){super(ae.PostNotes),this._ottava=e,this._aboveStaff=t}doLayout(){super.doLayout(),this.height=13*this.scale}paintNonGrouped(e,t,i){this.paintOttava(e,t,i)}paintOttava(e,t,i){let r=0;switch(this._ottava){case Te._15ma:r=37*this.scale,i.fillMusicFontSymbol(e+this.x-r/2,t+this.y+this.height,.8,f.QuindicesimaAlta,!1);break;case Te._8va:r=26*this.scale,i.fillMusicFontSymbol(e+this.x-r/2,t+this.y+this.height,.8,f.OttavaAlta,!1);break;case Te._8vb:r=23*this.scale,i.fillMusicFontSymbol(e+this.x-r/2,t+this.y+this.height,.8,f.OttavaBassaVb,!1);break;case Te._15mb:r=36*this.scale,i.fillMusicFontSymbols(e+this.x-r/2,t+this.y+this.height,.8,[f.Quindicesima,f.OctaveBaselineM,f.OctaveBaselineB],!1);break}return r/2}paintGrouped(e,t,i,r){let n=this.paintOttava(e,t,r),a=3*this.scale,o=e+this.x+n+a,l=t+this.y;l+=this._aboveStaff?2*this.scale:this.height-2*this.scale;let h=8*this.scale;if(i>o){let u=o;for(;u<i;)r.beginPath(),r.moveTo(u,l|0),r.lineTo(Math.min(u+h,i),l|0),u+=h+a,r.stroke();r.beginPath(),this._aboveStaff?(r.moveTo(i,l),r.lineTo(i,t+this.y+this.height)):(r.moveTo(i,l),r.lineTo(i,t+this.y)),r.stroke()}}}class Wm extends _t{get effectId(){return"ottavia-"+(this._aboveStaff?"above":"below")}get notationElement(){return K.EffectOttavia}get hideOnMultiTrack(){return!1}get canShareBand(){return!0}get sizingMode(){return we.GroupedOnBeat}constructor(e){super(),this._aboveStaff=e}shouldCreateGlyph(e,t){switch(t.ottava){case Te._15ma:return this._aboveStaff;case Te._8va:return this._aboveStaff;case Te._8vb:return!this._aboveStaff;case Te._15mb:return!this._aboveStaff}return!1}createNewGlyph(e,t){return new uT(t.ottava,this._aboveStaff)}canExpand(e,t){return e.ottava===t.ottava}}class cT extends In{get notationElement(){return K.EffectPalmMute}shouldCreateGlyphForNote(e){return e.isPalmMute}get sizingMode(){return we.GroupedOnBeat}createNewGlyph(e,t){return new _r("P.M.")}constructor(){super()}}class dT extends In{get notationElement(){return K.EffectPickSlide}shouldCreateGlyphForNote(e){return e.slideOutType===ne.PickSlideDown||e.slideOutType===ne.PickSlideUp}get sizingMode(){return we.GroupedOnBeat}createNewGlyph(e,t){return new _r("P.S.")}constructor(){super()}}class Xo extends ht{constructor(e,t,i){super(e,t,ee.GraceScale,Xo.getSymbol(i))}doLayout(){this.width=9*this.scale,this.height=13*this.scale}paint(e,t,i){super.paint(e,t+this.height,i)}static getSymbol(e){switch(e){case At.Up:return f.StringsUpBow;case At.Down:return f.StringsDownBow;default:return f.None}}}class fT extends _t{get notationElement(){return K.EffectPickStroke}get hideOnMultiTrack(){return!1}get canShareBand(){return!0}get sizingMode(){return we.SingleOnBeat}shouldCreateGlyph(e,t){return t.pickStroke!==At.None}createNewGlyph(e,t){return new Xo(0,0,t.pickStroke)}canExpand(e,t){return!0}}class ab extends ul{constructor(e){super(ae.EndBeat),this._stepSize=0,this._type=e}doLayout(){switch(super.doLayout(),this._type){case Be.Slight:this._stepSize=12*this.scale;break;case Be.Wide:this._stepSize=23*this.scale;break}this.height=18*this.scale}paintGrouped(e,t,i,r){let n=e+this.x,a=i-n,o=Math.max(1,a/this._stepSize);r.beginPath(),r.moveTo(n,t+this.y);for(let l=0;l<o;l++)r.lineTo(n+this._stepSize/2,t+this.y+this.height),r.lineTo(n+this._stepSize,t+this.y),n+=this._stepSize;r.stroke()}}class zm extends _t{get notationElement(){return K.EffectSlightBeatVibrato}get hideOnMultiTrack(){return!1}get canShareBand(){return!0}get sizingMode(){return we.GroupedOnBeatToEnd}shouldCreateGlyph(e,t){return t.vibrato===Be.Slight}createNewGlyph(e,t){return new ab(Be.Slight)}canExpand(e,t){return!0}}class Tn extends ul{constructor(e,t,i,r=1.2,n=!1){super(ae.EndBeat),this._scale=0,this._symbol=f.None,this._symbolSize=0,this._type=i,this._scale=r,this.x=e,this.y=t,this._partialWaves=n}doLayout(){super.doLayout();let e=0;switch(this._type){case Be.Slight:this._symbol=f.WiggleTrill,this._symbolSize=9*this._scale,e=6*this._scale;break;case Be.Wide:this._symbol=f.WiggleVibratoMediumFast,this._symbolSize=10*this._scale,e=10*this._scale;break}this.height=e*this.scale}paintGrouped(e,t,i,r){let n=e+this.x,a=i-n,o=this._symbolSize*this.scale,l=a/o;this._partialWaves||(l=Math.floor(l)),l<1&&(l=1);let h=0;for(let u=0;u<l;u++)r.fillMusicFontSymbol(e+this.x+h,t+this.y+this.height*2,this._scale*this.scale,this._symbol,!1),h+=o}}class Gm extends In{get notationElement(){return K.EffectSlightNoteVibrato}shouldCreateGlyphForNote(e){return e.vibrato===Be.Slight||e.isTieDestination&&e.tieOrigin.vibrato===Be.Slight}get sizingMode(){return we.GroupedOnBeatToEnd}createNewGlyph(e,t){return new Tn(0,0,Be.Slight,1.2)}constructor(){super()}}class pT extends _t{get notationElement(){return K.EffectTap}get hideOnMultiTrack(){return!1}get canShareBand(){return!0}get sizingMode(){return we.SingleOnBeat}shouldCreateGlyph(e,t){return t.slap||t.pop||t.tap}createNewGlyph(e,t){let i=e.resources;return t.slap?new Mt(0,0,"S",i.effectFont,Y.Left):t.pop?new Mt(0,0,"P",i.effectFont,Y.Left):new Mt(0,0,"T",i.effectFont,Y.Left)}canExpand(e,t){return!0}}class gT extends Ii{constructor(e){super(0,0),this.tempoAutomations=e}doLayout(){super.doLayout(),this.height=25*this.scale}paint(e,t,i){const r=e+this.x,n=e+this.renderer.postBeatGlyphsStart;for(const a of this.tempoAutomations){const o=e+this.x+(n-r)*a.ratioPosition,l=this.renderer.resources;i.font=l.markerFont,i.fillMusicFontSymbol(o,t+this.y+this.height*.8,this.scale*ee.GraceScale,f.NoteQuarterUp,!1),i.textBaseline=te.Top,i.fillText("= "+a.value.toString(),o+this.height/2,t+this.y+i.font.size/2)}}}class mT extends _t{get notationElement(){return K.EffectTempo}get hideOnMultiTrack(){return!0}get canShareBand(){return!1}get sizingMode(){return we.SinglePreBeat}shouldCreateGlyph(e,t){return t.voice.bar.staff.index===0&&t.voice.index===0&&t.index===0&&t.voice.bar.masterBar.tempoAutomations.length>0}createNewGlyph(e,t){return new gT(t.voice.bar.masterBar.tempoAutomations)}canExpand(e,t){return!0}}class yT extends _t{get notationElement(){return K.EffectText}get hideOnMultiTrack(){return!1}get canShareBand(){return!1}get sizingMode(){return we.SingleOnBeat}shouldCreateGlyph(e,t){return!!t.text}createNewGlyph(e,t){return new Mt(0,0,t.text,e.resources.effectFont,Y.Left)}canExpand(e,t){return!0}}class wT extends Ii{constructor(e,t){super(e,t)}doLayout(){super.doLayout(),this.height=this.renderer.resources.markerFont.size*this.scale}paint(e,t,i){let r=this.renderer.resources;i.font=r.markerFont;let n=i.measureText("tr").width;i.fillText("tr",e+this.x,t+this.y);let a=n+3*this.scale,o=this.width-a,l=1.2,h=11*this.scale*l,u=Math.max(1,(o-a)/h),c=a,d=t+this.y+this.height*1.2;for(let p=0;p<u;p++)i.fillMusicFontSymbol(e+this.x+c,d,l,f.WiggleTrill,!1),c+=h}}class Um extends In{get notationElement(){return K.EffectTrill}shouldCreateGlyphForNote(e){return e.isTrill}get sizingMode(){return we.SingleOnBeat}createNewGlyph(e,t){return new wT(0,0)}}var Je;(function(s){s[s.Full=0]="Full",s[s.PartialLeft=1]="PartialLeft",s[s.PartialRight=2]="PartialRight"})(Je||(Je={}));class Pe extends Ii{constructor(e){super(0,0),this._tripletFeel=e}doLayout(){super.doLayout(),this.height=25*this.scale}paint(e,t,i){e+=this.x,t+=this.y;let r=t+this.height*ee.GraceScale;i.font=this.renderer.resources.effectFont,i.fillText("(",e,t+this.height*.3);let n=e+10*this.scale,a=e+40*this.scale;switch(this._tripletFeel){case ce.NoTripletFeel:this.renderBarNote(n,r,Pe.NoteScale,i,[Je.Full]),this.renderBarNote(a,r,Pe.NoteScale,i,[Je.Full]);break;case ce.Triplet8th:this.renderBarNote(n,r,Pe.NoteScale,i,[Je.Full]),i.fillMusicFontSymbol(a,r,Pe.NoteScale,f.NoteQuarterUp,!1),i.fillMusicFontSymbol(a+Pe.NoteSeparation*this.scale,r,Pe.NoteScale,f.NoteEighthUp,!1),this.renderTriplet(a,t,i);break;case ce.Triplet16th:this.renderBarNote(n,r,Pe.NoteScale,i,[Je.Full,Je.Full]),this.renderBarNote(a,r,Pe.NoteScale,i,[Je.Full,Je.PartialRight]),this.renderTriplet(a,t,i);break;case ce.Dotted8th:this.renderBarNote(n,r,Pe.NoteScale,i,[Je.Full]),this.renderBarNote(a,r,Pe.NoteScale,i,[Je.Full,Je.PartialRight]),i.fillCircle(a+9*this.scale,r,this.scale);break;case ce.Dotted16th:this.renderBarNote(n,r,Pe.NoteScale,i,[Je.Full,Je.Full]),this.renderBarNote(a,r,Pe.NoteScale,i,[Je.Full,Je.Full,Je.PartialRight]),i.fillCircle(a+9*this.scale,r,this.scale);break;case ce.Scottish8th:this.renderBarNote(n,r,Pe.NoteScale,i,[Je.Full]),this.renderBarNote(a,r,Pe.NoteScale,i,[Je.Full,Je.PartialLeft]),i.fillCircle(a+Pe.NoteSeparation*this.scale+8*this.scale,r,this.scale);break;case ce.Scottish16th:this.renderBarNote(n,r,Pe.NoteScale,i,[Je.Full,Je.Full]),this.renderBarNote(a,r,Pe.NoteScale,i,[Je.Full,Je.Full,Je.PartialLeft]),i.fillCircle(a+Pe.NoteSeparation*this.scale+8*this.scale,r,this.scale);break}i.fillText("=",e+30*this.scale,t+5*this.scale),i.fillText(")",e+65*this.scale,t+this.height*.3)}renderBarNote(e,t,i,r,n){r.fillMusicFontSymbol(e,t,i,f.NoteQuarterUp,!1);let a=Pe.NoteSeparation/2*this.scale;for(let o=0;o<n.length;o++)switch(n[o]){case Je.Full:r.fillRect(e+4*this.scale,t-Pe.NoteHeight*this.scale+Pe.BarSeparation*this.scale*o,Pe.NoteSeparation*this.scale,Pe.BarHeight*this.scale);break;case Je.PartialLeft:r.fillRect(e+4*this.scale,t-Pe.NoteHeight*this.scale+Pe.BarSeparation*this.scale*o,a,Pe.BarHeight*this.scale);break;case Je.PartialRight:r.fillRect(e+4*this.scale+a,t-Pe.NoteHeight*this.scale+Pe.BarSeparation*this.scale*o,a,Pe.BarHeight*this.scale);break}r.fillMusicFontSymbol(e+Pe.NoteSeparation*this.scale,t,i,f.NoteQuarterUp,!1)}renderTriplet(e,t,i){t+=2*this.scale;let r=this.renderer.resources.effectFont;i.font=he.withFamilyList(r.families,r.size*.8,r.style);let n=e+Pe.NoteSeparation*this.scale+3*this.scale;i.beginPath(),i.moveTo(e,t+3*this.scale),i.lineTo(e,t),i.lineTo(e+5*this.scale,t),i.moveTo(n+5*this.scale,t+3*this.scale),i.lineTo(n+5*this.scale,t),i.lineTo(n,t),i.stroke(),i.fillText("3",e+7*this.scale,t-10*this.scale),i.font=r}}Pe.NoteScale=.4;Pe.NoteHeight=12;Pe.NoteSeparation=12;Pe.BarHeight=2;Pe.BarSeparation=3;class bT extends _t{get notationElement(){return K.EffectTripletFeel}get hideOnMultiTrack(){return!0}get canShareBand(){return!1}get sizingMode(){return we.SinglePreBeat}shouldCreateGlyph(e,t){return t.index===0&&(t.voice.bar.masterBar.index===0&&t.voice.bar.masterBar.tripletFeel!==ce.NoTripletFeel||t.voice.bar.masterBar.index>0&&t.voice.bar.masterBar.tripletFeel!==t.voice.bar.masterBar.previousMasterBar.tripletFeel)}createNewGlyph(e,t){return new Pe(t.voice.bar.masterBar.tripletFeel)}canExpand(e,t){return!0}}class ST extends _t{get notationElement(){return K.EffectWhammyBar}get hideOnMultiTrack(){return!1}get canShareBand(){return!1}get sizingMode(){return we.GroupedOnBeat}shouldCreateGlyph(e,t){return t.hasWhammyBar}createNewGlyph(e,t){return new _r("w/bar")}canExpand(e,t){return!0}}class $m extends _t{get notationElement(){return K.EffectWideBeatVibrato}get hideOnMultiTrack(){return!1}get canShareBand(){return!0}get sizingMode(){return we.GroupedOnBeatToEnd}shouldCreateGlyph(e,t){return t.vibrato===Be.Wide}createNewGlyph(e,t){return new ab(Be.Wide)}canExpand(e,t){return!0}}class Ym extends In{get notationElement(){return K.EffectWideNoteVibrato}shouldCreateGlyphForNote(e){return e.vibrato===Be.Wide||e.isTieDestination&&e.tieOrigin.vibrato===Be.Wide}get sizingMode(){return we.GroupedOnBeatToEnd}createNewGlyph(e,t){return new Tn(0,0,Be.Wide,1.2)}}class Xm{constructor(){this.x=0,this.width=0,this.masterBars=[]}}class kT extends nb{get name(){return"HorizontalScreen"}constructor(e){super(e),this._system=null,this._pagePadding=null}get supportsResize(){return!1}get firstBarX(){let e=this._pagePadding[0];return this._system&&(e+=this._system.accoladeWidth),e}doResize(){}doLayoutAndRender(){switch(this._pagePadding=this.renderer.settings.display.padding,this.renderer.settings.display.systemsLayoutMode){case Yr.Automatic:this.systemsLayoutMode=Mi.Automatic;break;case Yr.UseModelLayout:this.systemsLayoutMode=Mi.FromModelWithWidths;break}this._pagePadding||(this._pagePadding=[0,0,0,0]),this._pagePadding.length===1?this._pagePadding=[this._pagePadding[0],this._pagePadding[0],this._pagePadding[0],this._pagePadding[0]]:this._pagePadding.length===2&&(this._pagePadding=[this._pagePadding[0],this._pagePadding[1],this._pagePadding[0],this._pagePadding[1]]);let e=this.renderer.score,t=this.renderer.settings.display.startBar;t--,t=Math.min(e.masterBars.length-1,Math.max(0,t));let i=t,r=this.renderer.settings.display.barCount;r<=0&&(r=e.masterBars.length),r=t+r-1,r=Math.min(e.masterBars.length-1,Math.max(0,r)),this._system=this.createEmptyStaffSystem(),this._system.isLast=!0,this._system.x=this._pagePadding[0],this._system.y=this._pagePadding[1];let n=this.renderer.settings.display.barCountPerPartial,a=[],o=new Xm,l=0;for(;i<=r;){let u=this._system.addBars(this.renderer.tracks,i);if(u)if(o.masterBars.length===0&&u.isLinkedToPrevious&&a.length>0){let c=a[a.length-1];c.masterBars.push(e.masterBars[i]),c.width+=u.width,l+=u.width,o.x+=l}else o.masterBars.push(e.masterBars[i]),o.width+=u.width,o.masterBars.length>=n&&(a.length===0&&(o.width+=this._system.accoladeWidth+this._pagePadding[0]),l+=o.width,a.push(o),C.debug(this.name,"Finished partial from bar "+o.masterBars[0].index+" to "+o.masterBars[o.masterBars.length-1].index,null),o=new Xm,o.x=l);i++}o.masterBars.length>0&&(a.length===0&&(o.width+=this._system.accoladeWidth+this._pagePadding[0]),a.push(o),C.debug(this.name,"Finished partial from bar "+o.masterBars[0].index+" to "+o.masterBars[o.masterBars.length-1].index,null)),this.finalizeStaffSystem(),this.height=Math.floor(this._system.y+this._system.height),this.width=this._system.x+this._system.width+this._pagePadding[2],i=0;let h=0;for(let u=0;u<a.length;u++){const c=a[u],d=new cn;d.x=h,d.y=0,d.totalWidth=this.width,d.totalHeight=this.height,d.width=c.width,d.height=this.height,d.firstMasterBarIndex=c.masterBars[0].index,d.lastMasterBarIndex=c.masterBars[c.masterBars.length-1].index,h+=c.width;const p=i,g=u;this._system.buildBoundingsLookup(0,0),this.registerPartial(d,w=>{let S=this._system.getBarX(c.masterBars[0].index)+this._system.accoladeWidth;g===0&&(S-=this._system.x+this._system.accoladeWidth),w.color=this.renderer.settings.display.resources.mainGlyphColor,w.textAlign=Y.Left,C.debug(this.name,"Rendering partial from bar "+c.masterBars[0].index+" to "+c.masterBars[c.masterBars.length-1].index,null),this._system.paintPartial(-S,this._system.y,w,p,c.masterBars.length)}),i+=c.masterBars.length}this.height=this.layoutAndRenderAnnotation(this.height)+this._pagePadding[3]}finalizeStaffSystem(){this._system.scaleToWidth(this._system.width),this._system.finalizeSystem()}}class _T extends nb{get name(){return"PageView"}constructor(e){super(e),this._systems=[],this._allMasterBarRenderers=[],this._barsFromPreviousSystem=[],this._pagePadding=null}doLayoutAndRender(){switch(this.renderer.settings.display.systemsLayoutMode){case Yr.Automatic:this.systemsLayoutMode=Mi.Automatic;break;case Yr.UseModelLayout:this.systemsLayoutMode=Mi.FromModelWithScale;break}this._pagePadding=this.renderer.settings.display.padding,this._pagePadding||(this._pagePadding=[0,0,0,0]),this._pagePadding.length===1?this._pagePadding=[this._pagePadding[0],this._pagePadding[0],this._pagePadding[0],this._pagePadding[0]]:this._pagePadding.length===2&&(this._pagePadding=[this._pagePadding[0],this._pagePadding[1],this._pagePadding[0],this._pagePadding[1]]);let e=this._pagePadding[1];this.width=this.renderer.width,this._allMasterBarRenderers=[],e=this.layoutAndRenderScoreInfo(e,-1),e=this.layoutAndRenderTunings(e,-1),e=this.layoutAndRenderChordDiagrams(e,-1),e=this.layoutAndRenderScore(e),e=this.layoutAndRenderAnnotation(e),this.height=e+this._pagePadding[3]}get supportsResize(){return!0}get firstBarX(){let e=this._pagePadding[0];return this._systems.length>0&&(e+=this._systems[0].accoladeWidth),e}doResize(){let e=this._pagePadding[1];this.width=this.renderer.width;let t=this.height;e=this.layoutAndRenderScoreInfo(e,t),e=this.layoutAndRenderTunings(e,t),e=this.layoutAndRenderChordDiagrams(e,t),e=this.resizeAndRenderScore(e,t),e=this.layoutAndRenderAnnotation(e),this.height=e+this._pagePadding[3]}layoutAndRenderTunings(e,t=-1){if(!this.tuningGlyph)return e;let i=this.renderer.settings.display.resources;this.tuningGlyph.x=this._pagePadding[0],this.tuningGlyph.width=this.width,this.tuningGlyph.doLayout();let r=this.tuningGlyph.height;const n=new cn;return n.x=0,n.y=e,n.width=this.width,n.height=r,n.totalWidth=this.width,n.totalHeight=t<0?e+n.height:t,this.registerPartial(n,a=>{a.color=i.scoreInfoColor,a.textAlign=Y.Center,this.tuningGlyph.paint(0,0,a)}),e+r}layoutAndRenderChordDiagrams(e,t=-1){if(!this.chordDiagrams)return e;const i=this.renderer.settings.display.resources;this.chordDiagrams.width=this.width,this.chordDiagrams.doLayout();const r=Math.floor(this.chordDiagrams.height),n=new cn;return n.x=0,n.y=e,n.width=this.width,n.height=r,n.totalWidth=this.width,n.totalHeight=t<0?e+r:t,this.registerPartial(n,a=>{a.color=i.scoreInfoColor,a.textAlign=Y.Center,this.chordDiagrams.paint(0,0,a)}),e+r}layoutAndRenderScoreInfo(e,t=-1){C.debug(this.name,"Layouting score info");const i=new cn;i.x=0,i.y=e;let r=0,n=this.scale,a=this.renderer.settings.display.resources,o=[K.ScoreTitle,K.ScoreSubTitle,K.ScoreArtist,K.ScoreAlbum,K.ScoreWordsAndMusic];for(let u=0;u<o.length;u++)if(this.scoreInfoGlyphs.has(o[u])){let c=this.scoreInfoGlyphs.get(o[u]);c.x=this.width/2,c.y=r,c.textAlign=Y.Center,r+=c.font.size*n}let l=!1,h=0;if(this.scoreInfoGlyphs.has(K.ScoreMusic)){let u=this.scoreInfoGlyphs.get(K.ScoreMusic);u.x=this.width-this._pagePadding[2],u.y=r,u.textAlign=Y.Right,l=!0,h=u.font.size*n}if(this.scoreInfoGlyphs.has(K.ScoreWords)){let u=this.scoreInfoGlyphs.get(K.ScoreWords);u.x=this._pagePadding[0],u.y=r,u.textAlign=Y.Left,l=!0,h=u.font.size*n}return l&&(r+=h),this.scoreInfoGlyphs.size>0&&(r=Math.floor(r+17*this.scale),i.width=this.width,i.height=r,i.totalWidth=this.width,i.totalHeight=t<0?e+i.height:t,this.registerPartial(i,u=>{u.color=a.scoreInfoColor,u.textAlign=Y.Center;for(const c of this.scoreInfoGlyphs.values())c.paint(0,0,u)})),e+r}resizeAndRenderScore(e,t){if(this.renderer.settings.display.barsPerRow>0||this.systemsLayoutMode==Mi.FromModelWithScale)for(let r=0;r<this._systems.length;r++){let n=this._systems[r];this.fitSystem(n),e+=this.paintSystem(n,t)}else{this._systems=[];let r=0,n=this.maxWidth,a=this.createEmptyStaffSystem();for(a.index=this._systems.length,a.x=this._pagePadding[0],a.y=e;r<this._allMasterBarRenderers.length;){let o=this._allMasterBarRenderers[r];if(a.width+o.width<=n||a.masterBarsRenderers.length===0)a.addMasterBarRenderers(this.renderer.tracks,o),r++;else{for(;o&&!o.canWrap&&a.masterBarsRenderers.length>1;)o=a.revertLastBar(),r--;a.isFull=!0,a.isLast=this.lastBarIndex===a.lastBarIndex,this._systems.push(a),this.fitSystem(a),e+=this.paintSystem(a,t),a=this.createEmptyStaffSystem(),a.index=this._systems.length,a.x=this._pagePadding[0],a.y=e}}a.isLast=this.lastBarIndex===a.lastBarIndex,this.fitSystem(a),e+=this.paintSystem(a,t)}return e}layoutAndRenderScore(e){let i=this.firstBarIndex,r=this.lastBarIndex;for(this._systems=[];i<=r;){let n=this.createStaffSystem(i,r);this._systems.push(n),n.x=this._pagePadding[0],n.y=e,i=n.lastBarIndex+1,this.fitSystem(n),C.debug(this.name,"Rendering partial from bar "+n.firstBarIndex+" to "+n.lastBarIndex,null),e+=this.paintSystem(n,e)}return e}paintSystem(e,t){let i=Math.floor(e.height);const r=new cn;return r.x=0,r.y=e.y,r.totalWidth=this.width,r.totalHeight=t,r.width=this.width,r.height=i,r.firstMasterBarIndex=e.firstBarIndex,r.lastMasterBarIndex=e.lastBarIndex,e.buildBoundingsLookup(0,0),this.registerPartial(r,n=>{this.renderer.canvas.color=this.renderer.settings.display.resources.mainGlyphColor,this.renderer.canvas.textAlign=Y.Left,e.paint(0,-r.y,n)}),t+=i,i}fitSystem(e){e.isFull||e.width>this.maxWidth||this.renderer.settings.display.justifyLastSystem?e.scaleToWidth(this.maxWidth):e.scaleToWidth(e.width),e.finalizeSystem()}getBarsPerSystem(e){let t=this.renderer.settings.display.barsPerRow;if(this.systemsLayoutMode==Mi.FromModelWithScale){let i,r;this.renderer.tracks.length>1?(i=this.renderer.score.defaultSystemsLayout,r=this.renderer.score.systemsLayout):(i=this.renderer.tracks[0].defaultSystemsLayout,r=this.renderer.tracks[0].systemsLayout),t=e<r.length?r[e]:i}return t}createStaffSystem(e,t){let i=this.createEmptyStaffSystem();i.index=this._systems.length;let r=this.getBarsPerSystem(i.index),n=this.maxWidth,a=t+1,o=e;for(;o<a;){if(this._barsFromPreviousSystem.length>0)for(let h of this._barsFromPreviousSystem)i.addMasterBarRenderers(this.renderer.tracks,h),o=h.masterBar.index;else{let h=i.addBars(this.renderer.tracks,o);h&&this._allMasterBarRenderers.push(h)}this._barsFromPreviousSystem=[];let l=!1;if((r===-1&&i.width>=n&&i.masterBarsRenderers.length!==0||i.masterBarsRenderers.length===r+1)&&(l=!0),l){let h=i.revertLastBar();if(h)for(this._barsFromPreviousSystem.push(h);h&&!h.canWrap&&i.masterBarsRenderers.length>1;)h=i.revertLastBar(),h&&this._barsFromPreviousSystem.push(h);return i.isFull=!0,i.isLast=!1,this._barsFromPreviousSystem.reverse(),i}i.x=0,o++}return i.isLast=t===i.lastBarIndex,i}get maxWidth(){return this.renderer.width-this._pagePadding[0]-this._pagePadding[2]}}class Xs extends ht{constructor(e,t,i,r){super(e,t,r,Xs.getMusicSymbol(i)),this._accidentalType=i}static getMusicSymbol(e){switch(e){case U.Natural:return f.AccidentalNatural;case U.Sharp:return f.AccidentalSharp;case U.Flat:return f.AccidentalFlat;case U.NaturalQuarterNoteUp:return f.AccidentalQuarterToneNaturalArrowUp;case U.SharpQuarterNoteUp:return f.AccidentalQuarterToneSharpArrowUp;case U.FlatQuarterNoteUp:return f.AccidentalQuarterToneFlatArrowUp;case U.DoubleSharp:return f.AccidentalDoubleSharp;case U.DoubleFlat:return f.AccidentalDoubleFlat}return f.None}doLayout(){switch(this._accidentalType){case U.DoubleFlat:this.width=18;break;default:this.width=8;break}this.width=this.width*this.glyphScale*this.scale}}class pp extends ht{constructor(e,t,i,r){super(e,t,1,pp.getSymbol(i)),this._clef=i,this._clefOttava=r}doLayout(){switch(this._clef){case ie.Neutral:this.width=15*this.scale;break;case ie.C3:case ie.C4:case ie.F4:case ie.G2:this.width=28*this.scale;break}}static getSymbol(e){switch(e){case ie.Neutral:return f.UnpitchedPercussionClef1;case ie.C3:return f.CClef;case ie.C4:return f.CClef;case ie.F4:return f.FClef;case ie.G2:return f.GClef;default:return f.None}}paint(e,t,i){super.paint(e,t,i);let r,n=!1;switch(this._clefOttava){case Te._15ma:r=new ht(-4*this.scale,0,.5,f.Quindicesima),n=!0;break;case Te._8va:r=new ht(-2*this.scale,0,.5,f.Ottava),n=!0;break;case Te._8vb:r=new ht(-6*this.scale,0,.5,f.Ottava);break;case Te._15mb:r=new ht(-8*this.scale,0,.5,f.Quindicesima);break;default:return}let a=0,o=0;switch(this._clef){case ie.Neutral:a=n?-12:15,o=0;break;case ie.C3:a=n?-19:27,o=0;break;case ie.C4:a=n?-19:27,o=0;break;case ie.F4:a=n?-9:27,o=-4;break;case ie.G2:a=n?-37:30,o=0;break;default:return}r.renderer=this.renderer,r.doLayout();let l=this.width/2;r.paint(e+this.x+l+o*this.scale,t+this.y+a*this.scale,i)}}class uo extends Ii{constructor(e,t,i){super(e,t),this._note=i}static getSymbol(e,t){switch(e){case et.None:return f.None;case et.Normal:return t?f.ArticAccentAbove:f.ArticAccentBelow;case et.Heavy:return t?f.ArticMarcatoAbove:f.ArticMarcatoBelow;case et.Tenuto:return t?f.ArticTenutoAbove:f.ArticTenutoBelow;default:return f.None}}doLayout(){this.width=9*this.scale,this.height=9*this.scale}paint(e,t,i){const r=this.renderer.getBeatDirection(this._note.beat),n=uo.getSymbol(this._note.accentuated,r==E.Down),a=2*this.scale,o=r==E.Up?t+this.y:t+this.y+this.height-a;i.fillMusicFontSymbol(e+this.x-2*this.scale,o,this.scale,n,!1)}}class Qo extends qe{constructor(e,t,i){super(e,t),this._size=0,this._size=i}doLayout(){this.width=this._size+3*this.scale}paint(e,t,i){i.fillCircle(e+this.x,t+this.y,this._size)}}class BT extends ht{constructor(e,t,i){super(e,t,i?ee.GraceScale:1,f.NoteheadXOrnate),this._isGrace=i}doLayout(){this.width=9*(this._isGrace?ee.GraceScale:1)*this.scale,this.height=ee.NoteHeadHeight*this.scale}}class Dh extends ht{constructor(e,t,i,r){super(e,t,r?ee.GraceScale:1,Dh.getSymbol(i)),this._isGrace=r}static getSymbol(e){switch(e){case k.QuadrupleWhole:case k.DoubleWhole:case k.Whole:case k.Half:return f.NoteheadDiamondWhiteWide;default:return f.NoteheadDiamondBlackWide}}doLayout(){this.width=9*(this._isGrace?ee.GraceScale:1)*this.scale,this.height=ee.NoteHeadHeight*this.scale}}class pt extends qe{constructor(e,t,i){super(0,0),this.yOffset=0,this.startNoteRenderer=null,this.endNoteRenderer=null,this.tieDirection=E.Up,this._startX=0,this._startY=0,this._endX=0,this._endY=0,this._tieHeight=0,this._shouldDraw=!1,this.startBeat=e,this.endBeat=t,this.forEnd=i}doLayout(){if(this.width=0,!this.endBeat){this._shouldDraw=!1;return}let e=this.renderer.scoreRenderer.layout.getRendererForBar(this.renderer.staff.staveId,this.startBeat.voice.bar);this.startNoteRenderer=e;let t=this.renderer.scoreRenderer.layout.getRendererForBar(this.renderer.staff.staveId,this.endBeat.voice.bar);this.endNoteRenderer=t,this._startX=0,this._endX=0,this._startY=0,this._endY=0,this.height=0,this._shouldDraw=!1,this.tieDirection=e?this.getBeamDirection(this.startBeat,e):this.getBeamDirection(this.endBeat,t),!this.forEnd&&e?(e!==t?(this._startX=e.x+this.getStartX(),this._startY=e.y+this.getStartY()+this.yOffset,!t||e.staff!==t.staff?(this._endX=e.x+e.width,this._endY=this._startY):(this._endX=t.x+this.getEndX(),this._endY=t.y+this.getEndY()+this.yOffset)):(this._startX=e.x+this.getStartX(),this._endX=t.x+this.getEndX(),this._startY=e.y+this.getStartY()+this.yOffset,this._endY=t.y+this.getEndY()+this.yOffset),this._shouldDraw=!0):(!e||e.staff!==t.staff)&&(this._startX=t.x,this._endX=t.x+this.getEndX(),this._startY=t.y+this.getEndY()+this.yOffset,this._endY=this._startY,this._shouldDraw=!0),this._shouldDraw&&(this.y=Math.min(this._startY,this._endY),this.shouldDrawBendSlur()?this._tieHeight=0:(this._tieHeight=this.getTieHeight(this._startX,this._startY,this._endX,this._endY),this.height=pt.calculateActualTieHeight(this.renderer.scale,this._startX,this._startY,this._endX,this._endY,this.tieDirection===E.Down,this._tieHeight,4).h),this.tieDirection===E.Up&&(this.y-=this.height))}paint(e,t,i){this._shouldDraw&&(this.shouldDrawBendSlur()?pt.drawBendSlur(i,e+this._startX,t+this._startY,e+this._endX,t+this._endY,this.tieDirection===E.Down,this.scale):pt.paintTie(i,this.scale,e+this._startX,t+this._startY,e+this._endX,t+this._endY,this.tieDirection===E.Down,this._tieHeight,4))}shouldDrawBendSlur(){return!1}getTieHeight(e,t,i,r){return 22}getBeamDirection(e,t){return E.Down}getStartY(){return 0}getEndY(){return 0}getStartX(){return 0}getEndX(){return 0}static calculateActualTieHeight(e,t,i,r,n,a,o,l){const h=pt.computeBezierControlPoints(e,t,i,r,n,a,o,l);t=h[0],i=h[1];const u=h[2],c=h[3];r=h[6],n=h[7];const d=(t-u)/(t-2*u+r),p=pt.calculateExtrema(t,i,u,c,r,n,d),g=p.length>0?Math.min(t,r,p[0]):Math.min(t,r),w=p.length>0?Math.max(t,r,p[0]):Math.max(t,r),S=(i-c)/(i-2*c+n),b=pt.calculateExtrema(t,i,u,c,r,n,S),m=b.length>0?Math.min(i,n,b[1]):Math.min(i,n),y=b.length>0?Math.max(i,n,b[1]):Math.max(i,n),B=new si;return B.x=g,B.y=m,B.w=w-g,B.h=y-m,B}static calculateExtrema(e,t,i,r,n,a,o){if(o<=0||1<=o)return[];const l=e+(i-e)*o,h=t+(r-t)*o,u=i+(n-i)*o,c=r+(a-r)*o;return[l+(u-l)*o,h+(c-h)*o]}static computeBezierControlPoints(e,t,i,r,n,a,o,l){if(t===r&&i===n)return[];if(r<t){let m=t;t=r,r=m,m=i,i=n,n=m}o*=e,l*=e;let h=n-i,u=r-t,c=Math.sqrt(h*h+u*u);a?h*=-1:u*=-1,h/=c,u/=c;let d=(r+t)/2,p=(n+i)/2,g=d+o*h,w=p+o*u,S=d+(o-l)*h,b=p+(o-l)*u;return[t,i,g,w,S,b,r,n]}static paintTie(e,t,i,r,n,a,o=!1,l=22,h=4){const u=pt.computeBezierControlPoints(t,i,r,n,a,o,l,h);e.beginPath(),e.moveTo(u[0],u[1]),e.quadraticCurveTo(u[2],u[3],u[6],u[7]),e.quadraticCurveTo(u[4],u[5],u[0],u[1]),e.closePath(),e.fill()}static drawBendSlur(e,t,i,r,n,a,o,l){let h=n-i,u=r-t,c=Math.sqrt(h*h+u*u);a?h*=-1:u*=-1,h/=c,u/=c;let d=(r+t)/2,p=(n+i)/2,g=pt.BendSlurHeight*o;r-t<20&&(g/=2);let w=d+g*h,S=p+g*u;if(e.beginPath(),e.moveTo(t,i),e.lineTo(w,S),e.lineTo(r,n),e.stroke(),l){let b=e.measureText(l).width,m=a?0:-e.font.size;e.fillText(l,w-b/2,S+m)}}}pt.BendSlurHeight=11;class _a extends qe{constructor(e){super(0,0),this._isOpen=e}doLayout(){super.doLayout(),this.width=_a.Size*this.scale}paint(e,t,i){this._isOpen?pt.paintTie(i,this.scale,e+this.x+this.width,t+this.y+this.height,e+this.x+this.width,t+this.y,!1,6,3):pt.paintTie(i,this.scale,e+this.x,t+this.y,e+this.x,t+this.y+this.height,!1,6,3)}}_a.Size=6;class xT{constructor(e,t){this.line=0,this.line=e,this.isGhost=t}}class Ah extends qe{constructor(e){super(0,0),this._infos=[],this._glyphs=[],this.isEmpty=!0,this._isOpen=e}addParenthesis(e){let t=this.renderer,i=t.getNoteLine(e),r=e.isGhost||this.isTiedBend(e)&&t.settings.notation.isNotationElementVisible(K.ParenthesisOnTiedBends);this.addParenthesisOnLine(i,r)}addParenthesisOnLine(e,t){let i=new xT(e,t);this._infos.push(i),t&&(this.isEmpty=!1)}isTiedBend(e){return e.isTieDestination?e.tieOrigin.hasBend?!0:this.isTiedBend(e.tieOrigin):!1}doLayout(){let e=this.renderer;this._infos.sort((r,n)=>r.line-n.line);let t=null,i=e.getScoreHeight(1);for(let r=0,n=this._infos.length;r<n;r++){let a;if(!this._infos[r].isGhost)t=null;else if(!t)a=new _a(this._isOpen),a.renderer=this.renderer,a.y=e.getScoreY(this._infos[r].line)-i,a.height=i*2,a.doLayout(),this._glyphs.push(a),t=a;else{let o=e.getScoreY(this._infos[r].line)+i;t.height=o-t.y}}this.width=this._glyphs.length>0?this._glyphs[0].width:0}paint(e,t,i){super.paint(e,t,i);for(let r of this._glyphs)r.paint(e+this.x,t+this.y,i)}}class vT{constructor(e,t){this.line=0,this.glyph=e,this.line=t}}class ob extends qe{constructor(){super(0,0),this._infos=[],this._noteHeadPadding=0,this.minNote=null,this.maxNote=null,this.spacingChanged=new kt,this.upLineX=0,this.downLineX=0,this.displacedX=0,this.noteStartX=0}add(e,t){let i=new vT(e,t);this._infos.push(i),(!this.minNote||this.minNote.line>i.line)&&(this.minNote=i),(!this.maxNote||this.maxNote.line<i.line)&&(this.maxNote=i)}get hasTopOverflow(){return!!this.minNote&&this.minNote.line<=0}get hasBottomOverflow(){return!!this.maxNote&&this.maxNote.line>8}doLayout(){this._infos.sort((o,l)=>l.line-o.line);let e=0,t=!1,i=0,r=!1,n=this.direction,a=0;for(let o=0,l=this._infos.length;o<l;o++){let h=this._infos[o].glyph;h.renderer=this.renderer,h.doLayout();let u=!1;o===0?e=h.width:Math.abs(i-this._infos[o].line)<=1?t?t=!1:(u=!0,h.x=e,r=!0,t=!0):t=!1,n===E.Down?h.x=u?0:e:h.x=u?e:0,h.x+=this.noteStartX,i=this._infos[o].line,a=Math.max(a,h.x+h.width)}r?(this._noteHeadPadding=0,this.upLineX=e,this.downLineX=e):(this._noteHeadPadding=n===E.Down?-e:0,a+=this._noteHeadPadding,this.upLineX=a,this.downLineX=0),this.displacedX=e,this.width=a}paint(e,t,i){e+=this.x,t+=this.y;let r=this.renderer,n=3*this.scale,a=this.width-this.noteStartX+n*2;if(this.hasTopOverflow){let h=i.color;i.color=r.resources.staffLineColor;let u=-2;for(;u>=this.minNote.line;){let c=t+r.getScoreY(u);i.fillRect(e-n+this.noteStartX,c,a,this.scale),u-=2}i.color=h}if(this.hasBottomOverflow){let h=i.color;i.color=r.resources.staffLineColor;let u=10;for(;u<=this.maxNote.line;){let c=t+r.getScoreY(u);i.fillRect(e-n+this.noteStartX,c,a,this.scale),u+=2}i.color=h}let o=this._infos,l=e+this._noteHeadPadding;for(let h of o)h.glyph.renderer=this.renderer,h.glyph.paint(l,t,i)}}class Nu extends ht{constructor(e,t,i){super(e,t,1,Nu.getSymbol(i))}doLayout(){this.width=12*this.scale}static getSymbol(e){switch(e){case k.ThirtySecond:return f.Tremolo3;case k.Sixteenth:return f.Tremolo2;case k.Eighth:return f.Tremolo1;default:return f.None}}}class TT extends ob{constructor(){super(),this._noteGlyphLookup=new Map,this._notes=[],this._tremoloPicking=null,this.aboveBeatEffects=new Map,this.belowBeatEffects=new Map}get direction(){return this.beamingHelper.direction}getNoteX(e,t){if(this._noteGlyphLookup.has(e.id)){let i=this._noteGlyphLookup.get(e.id),r=this.x+i.x+this._noteHeadPadding;switch(t){case Fe.Left:break;case Fe.Center:r+=i.width/2;break;case Fe.Right:r+=i.width;break}return r}return 0}getNoteY(e,t){if(this._noteGlyphLookup.has(e.id)){const i=this._noteGlyphLookup.get(e.id);let r=this.y+i.y;switch(t){case H.TopWithStem:r-=this.renderer.getStemSize(this.beamingHelper);break;case H.Top:r-=i.height/2;break;case H.Center:break;case H.Bottom:r+=i.height/2;break;case H.BottomWithStem:r+=this.renderer.getStemSize(this.beamingHelper);break}return r}return 0}addNoteGlyph(e,t,i){super.add(e,i),this._noteGlyphLookup.set(t.id,e),this._notes.push(t)}updateBeamingHelper(e){this.beamingHelper&&this.beamingHelper.registerBeatLineX("score",this.beat,e+this.x+this.upLineX,e+this.x+this.downLineX)}doLayout(){super.doLayout();let e=this.renderer,t=this.direction,i=0,r=0,n=1,a=-n;this.direction===E.Up?(r=e.getScoreY(this.minNote.line),i=e.getScoreY(this.maxNote.line-2)):(r=e.getScoreY(this.minNote.line-1),i=e.getScoreY(this.maxNote.line+1),a*=-1,n*=-1);let o=null,l=null;for(const h of this.aboveBeatEffects.values())h.renderer=this.renderer,h.doLayout(),i+=a*h.height,h.y=i,(o===null||o>i)&&(o=i),(l===null||l<i)&&(l=i);for(const h of this.belowBeatEffects.values())h.renderer=this.renderer,h.doLayout(),r+=n*h.height,h.y=r,(o===null||o>r)&&(o=r),(l===null||l<r)&&(l=r);if(o!==null&&e.registerBeatEffectOverflows(o,l??0),this.beat.isTremolo){let h=0,u=t===E.Up?this.minNote:this.maxNote,c=t===E.Up?this.displacedX:0,d=this.beat.tremoloSpeed;switch(d){case k.ThirtySecond:h=t===E.Up?-15:15;break;case k.Sixteenth:h=t===E.Up?-12:15;break;case k.Eighth:h=t===E.Up?-10:10;break;default:h=t===E.Up?-10:15;break}this.beat.duration<k.Half&&(c=this.width/2),this._tremoloPicking=new Nu(c,u.glyph.y+h*this.scale,d),this._tremoloPicking.renderer=this.renderer,this._tremoloPicking.doLayout()}}buildBoundingsLookup(e,t,i){for(let r of this._notes)if(this._noteGlyphLookup.has(r.id)){let n=this._noteGlyphLookup.get(r.id),a=new al;a.note=r,a.noteHeadBounds=new si,a.noteHeadBounds.x=t+this.x+this._noteHeadPadding+n.x,a.noteHeadBounds.y=i+this.y+n.y-n.height/2,a.noteHeadBounds.w=n.width,a.noteHeadBounds.h=n.height,e.addNote(a)}}paint(e,t,i){for(const r of this.aboveBeatEffects.values())r.paint(e+this.x+2*this.scale,t+this.y,i);for(const r of this.belowBeatEffects.values())r.paint(e+this.x+2*this.scale,t+this.y,i);super.paint(e,t,i),this._tremoloPicking&&this._tremoloPicking.paint(e,t,i)}}class Nn extends ht{constructor(e,t,i){super(e,t,1,Nn.getSymbol(i)),this._duration=i}static getSymbol(e){switch(e){case k.QuadrupleWhole:return f.RestLonga;case k.DoubleWhole:return f.RestDoubleWhole;case k.Whole:return f.RestWhole;case k.Half:return f.RestHalf;case k.Quarter:return f.RestQuarter;case k.Eighth:return f.RestEighth;case k.Sixteenth:return f.RestSixteenth;case k.ThirtySecond:return f.RestThirtySecond;case k.SixtyFourth:return f.RestSixtyFourth;case k.OneHundredTwentyEighth:return f.RestOneHundredTwentyEighth;case k.TwoHundredFiftySixth:return f.RestTwoHundredFiftySixth;default:return f.None}}static getSize(e){switch(e){case k.QuadrupleWhole:case k.DoubleWhole:case k.Whole:case k.Half:case k.Quarter:case k.Eighth:case k.Sixteenth:return 9;case k.ThirtySecond:return 12;case k.SixtyFourth:return 14;case k.OneHundredTwentyEighth:case k.TwoHundredFiftySixth:return 20}return 10}doLayout(){this.width=Nn.getSize(this._duration)*this.scale}updateBeamingHelper(e){this.beamingHelper&&this.beamingHelper.registerBeatLineX("score",this.beat,e+this.x+this.width/2,e+this.x+this.width/2)}}class Qm{constructor(){this.x=0,this.y=-3e3,this.width=0}}class gp extends us{constructor(){super(0,0)}doLayout(){if(!this.glyphs||this.glyphs.length===0){this.width=0;return}this.glyphs.sort((i,r)=>i.y<r.y?-1:i.y>r.y?1:0);let e=[];e.push(new Qm);let t=21*this.scale;for(let i=0,r=this.glyphs.length;i<r;i++){let n=this.glyphs[i];n.renderer=this.renderer,n.doLayout();let a=0;for(;e[a].y>n.y;)a++,a===e.length&&e.push(new Qm);n.x=a,e[a].y=n.y+t,e[a].width<n.width&&(e[a].width=n.width)}this.width=0;for(const i of e)this.width+=i.width,i.x=this.width;for(let i=0,r=this.glyphs.length;i<r;i++){let n=this.glyphs[i];const a=e[n.x];n.x=this.width-a.x}}}class Si extends ob{get direction(){return E.Up}constructor(e,t=!1){super(),this._showParenthesis=!1,this._noteValueLookup=new Map,this._accidentals=new gp,this._preNoteParenthesis=null,this._postNoteParenthesis=null,this.isEmpty=!0,this.noteHeadOffset=0,this._beat=e,this._showParenthesis=t,t&&(this._preNoteParenthesis=new Ah(!0),this._postNoteParenthesis=new Ah(!1))}containsNoteValue(e){return this._noteValueLookup.has(e)}getNoteValueY(e){return this._noteValueLookup.has(e)?this.y+this._noteValueLookup.get(e).y:0}addGlyph(e,t=!1){let i=this.renderer,r=new ee(0,0,k.Quarter,!0),n=i.accidentalHelper.applyAccidentalForValue(this._beat,e,t,!0),a=i.accidentalHelper.getNoteLineForValue(e,!1);if(r.y=i.getScoreY(a),this._showParenthesis&&(this._preNoteParenthesis.renderer=this.renderer,this._postNoteParenthesis.renderer=this.renderer,this._preNoteParenthesis.addParenthesisOnLine(a,!0),this._postNoteParenthesis.addParenthesisOnLine(a,!0)),n!==U.None){let o=new Xs(0,r.y,n,ee.GraceScale);o.renderer=this.renderer,this._accidentals.renderer=this.renderer,this._accidentals.addGlyph(o)}this._noteValueLookup.set(e,r),this.add(r,a),this.isEmpty=!1}doLayout(){let e=0;this._showParenthesis&&(this._preNoteParenthesis.x=e,this._preNoteParenthesis.renderer=this.renderer,this._preNoteParenthesis.doLayout(),e+=this._preNoteParenthesis.width+Si.ElementPadding*this.scale),this._accidentals.isEmpty||(e+=this._accidentals.width+Si.ElementPadding*this.scale,this._accidentals.x=e,this._accidentals.renderer=this.renderer,this._accidentals.doLayout(),e+=this._accidentals.width+Si.ElementPadding*this.scale),this.noteStartX=e,super.doLayout(),this.noteHeadOffset=this.noteStartX+(this.width-this.noteStartX)/2,this._showParenthesis&&(this._postNoteParenthesis.x=this.width+Si.ElementPadding*this.scale,this._postNoteParenthesis.renderer=this.renderer,this._postNoteParenthesis.doLayout(),this.width+=this._postNoteParenthesis.width+Si.ElementPadding*this.scale)}paint(e,t,i){this._accidentals.isEmpty||this._accidentals.paint(e+this.x,t+this.y,i),this._showParenthesis&&(this._preNoteParenthesis.paint(e+this.x,t+this.y,i),this._postNoteParenthesis.paint(e+this.x,t+this.y,i)),super.paint(e,t,i)}}Si.ElementPadding=2;class mp extends qe{constructor(){super(...arguments),this.BendNoteHeads=[]}drawBendSlur(e,t,i,r,n,a,o,l){pt.drawBendSlur(e,t,i,r,n,a,o,l)}doLayout(){super.doLayout(),this.width=0;for(let e of this.BendNoteHeads)e.doLayout(),this.width+=e.width+10*this.scale}getTieDirection(e,t){switch(t.getBeatDirection(e)){case E.Up:return E.Down;default:return E.Up}}}mp.EndPadding=(10/2|0)+3;class vr extends A{constructor(e=0,t=0){super(e,t),this.lineValue=0,this.lineValue=t}}class ns extends qe{constructor(){super(0,0),this._notes=[],this._renderPoints=new Map,this._preBendMinValue=-1,this._bendMiddleMinValue=-1,this._bendEndMinValue=-1,this._bendEndContinuedMinValue=-1,this._releaseMinValue=-1,this._releaseContinuedMinValue=-1,this._maxBendValue=-1}addBends(e){this._notes.push(e);let t=this.createRenderingPoints(e);this._renderPoints.set(e.id,t),(this._maxBendValue===-1||this._maxBendValue<e.maxBendPoint.value)&&(this._maxBendValue=e.maxBendPoint.value);let i=0;switch(e.bendType){case G.Bend:i=t[1].value,e.isTieOrigin?(this._bendEndContinuedMinValue===-1||i<this._bendEndContinuedMinValue)&&(this._bendEndContinuedMinValue=i):(this._bendEndMinValue===-1||i<this._bendEndMinValue)&&(this._bendEndMinValue=i);break;case G.Release:i=t[1].value,e.isTieOrigin?(this._releaseContinuedMinValue===-1||i<this._releaseContinuedMinValue)&&(this._releaseContinuedMinValue=i):i>0&&(this._releaseMinValue===-1||i<this._releaseMinValue)&&(this._releaseMinValue=i);break;case G.BendRelease:i=t[1].value,(this._bendMiddleMinValue===-1||i<this._bendMiddleMinValue)&&(this._bendMiddleMinValue=i),i=t[2].value,e.isTieOrigin?(this._releaseContinuedMinValue===-1||i<this._releaseContinuedMinValue)&&(this._releaseContinuedMinValue=i):i>0&&(this._releaseMinValue===-1||i<this._releaseMinValue)&&(this._releaseMinValue=i);break;case G.Prebend:i=t[0].value,(this._preBendMinValue===-1||i<this._preBendMinValue)&&(this._preBendMinValue=i);break;case G.PrebendBend:i=t[0].value,(this._preBendMinValue===-1||i<this._preBendMinValue)&&(this._preBendMinValue=i),i=t[1].value,e.isTieOrigin?(this._bendEndContinuedMinValue===-1||i<this._bendEndContinuedMinValue)&&(this._bendEndContinuedMinValue=i):(this._bendEndMinValue===-1||i<this._bendEndMinValue)&&(this._bendEndMinValue=i);break;case G.PrebendRelease:i=t[0].value,(this._preBendMinValue===-1||i<this._preBendMinValue)&&(this._preBendMinValue=i),i=t[1].value,e.isTieOrigin?(this._releaseContinuedMinValue===-1||i<this._releaseContinuedMinValue)&&(this._releaseContinuedMinValue=i):i>0&&(this._releaseMinValue===-1||i<this._releaseMinValue)&&(this._releaseMinValue=i);break}}doLayout(){super.doLayout();let e=this._maxBendValue*ns.BendValueHeight*this.scale;this.renderer.registerOverflowTop(e);let t=0;for(let i of this._notes){let r=this._renderPoints.get(i.id);switch(i.bendType){case G.Bend:r[1].lineValue=i.isTieOrigin?this._bendEndContinuedMinValue:this._bendEndMinValue;break;case G.Release:t=i.isTieOrigin?this._releaseContinuedMinValue:this._releaseMinValue,t>=0&&(r[1].lineValue=t);break;case G.BendRelease:r[1].lineValue=this._bendMiddleMinValue,t=i.isTieOrigin?this._releaseContinuedMinValue:this._releaseMinValue,t>=0&&(r[2].lineValue=t);break;case G.Prebend:r[0].lineValue=this._preBendMinValue;break;case G.PrebendBend:r[0].lineValue=this._preBendMinValue,r[1].lineValue=i.isTieOrigin?this._bendEndContinuedMinValue:this._bendEndMinValue;break;case G.PrebendRelease:r[0].lineValue=this._preBendMinValue,t=i.isTieOrigin?this._releaseContinuedMinValue:this._releaseMinValue,t>=0&&(r[1].lineValue=t);break}}this.width=0,this._notes.sort((i,r)=>i.isStringed?i.string-r.string:i.realValue-r.realValue)}createRenderingPoints(e){let t=[];switch(e.bendType){case G.Custom:for(let i of e.bendPoints)t.push(new vr(i.offset,i.value));break;case G.BendRelease:t.push(new vr(0,e.bendPoints[0].value)),t.push(new vr(A.MaxPosition/2|0,e.bendPoints[1].value)),t.push(new vr(A.MaxPosition,e.bendPoints[3].value));break;case G.Bend:case G.Hold:case G.Prebend:case G.PrebendBend:case G.PrebendRelease:case G.Release:t.push(new vr(0,e.bendPoints[0].value)),t.push(new vr(A.MaxPosition,e.bendPoints[1].value));break}return t}paint(e,t,i){let r=i.color;this._notes.length>1&&(i.color=this.renderer.resources.secondaryGlyphColor);for(let n of this._notes){let a=this._renderPoints.get(n.id),o=this.renderer,l=n,h=!1,u=null,c=!1,d=n.bendStyle===Ee.Gradual?"grad.":"",p=null;for(;l.isTieOrigin;){let y=l.tieDestination;if(u=this.renderer.scoreRenderer.layout.getRendererForBar(this.renderer.staff.staveId,y.beat.voice.bar),!u||o.staff!==u.staff)break;if(l=y,h=!0,l.hasBend||!this.renderer.settings.notation.extendBendArrowsOnTiedNotes){c=!0;break}}p=l.beat,u=this.renderer.scoreRenderer.layout.getRendererForBar(this.renderer.staff.staveId,p.voice.bar),p.isLastOfVoice&&!l.hasBend&&this.renderer.settings.notation.extendBendArrowsOnTiedNotes&&(p=null);let g=0,w=0,S=t+o.y;g=e+o.x,a[0].value>0||n.isContinuedBend?g+=o.getBeatX(n.beat,ae.MiddleNotes):g+=o.getNoteX(n,Fe.Right),!p||p.isLastOfVoice&&!c?w=e+u.x+u.postBeatGlyphsStart:c||!p.nextBeat?w=e+u.x+u.getBeatX(p,ae.MiddleNotes):n.bendType===G.Hold?w=e+u.x+u.getBeatX(p.nextBeat,ae.OnNotes):w=e+u.x+u.getBeatX(p.nextBeat,ae.PreNotes),h||(w-=ns.ArrowSize*this.scale);let m=(w-g)/A.MaxPosition;i.beginPath();for(let y=0,B=a.length-1;y<B;y++){let _=a[y],P=a[y+1];y===0&&_.value!==0&&!n.isTieDestination&&this.paintBend(n,new vr(0,0),_,g,S,m,d,i),n.bendType!==G.Prebend?(y===0&&(g+=2*this.scale),this.paintBend(n,_,P,g,S,m,d,i)):n.isTieOrigin&&n.tieDestination.hasBend&&(P=new vr(A.MaxPosition,_.value),P.lineValue=_.lineValue,this.paintBend(n,_,P,g,S,m,d,i))}i.color=r}}paintBend(e,t,i,r,n,a,o,l){let h=this.renderer,u=this.renderer.resources,c=h.lineOffset/2,d=r+a*t.offset,p=ns.BendValueHeight*this.scale,g=n-p*t.lineValue;t.value===0?i.offset===t.offset?g+=h.getNoteY(e.beat.maxStringNote,H.Top):g+=h.getNoteY(e,H.Center):g+=c;let w=r+a*i.offset,S=n-p*i.lineValue;i.lineValue===0?S+=h.getNoteY(e,H.Center):S+=c;let b=0,m=ns.ArrowSize*this.scale;if(i.value>t.value?(S+m>g&&(S=g-m),l.beginPath(),l.moveTo(w,S),l.lineTo(w-m*.5,S+m),l.lineTo(w+m*.5,S+m),l.closePath(),l.fill(),b=m):i.value!==t.value&&(S<g&&(S=g+m),l.beginPath(),l.moveTo(w,S),l.lineTo(w-m*.5,S-m),l.lineTo(w+m*.5,S-m),l.closePath(),l.fill(),b=-m),l.stroke(),t.value===i.value){if(t.lineValue>0){let y=w,B=ns.DashSize*this.scale,_=d+B;if((y-d)/(B*2)<1)l.moveTo(y,g),l.lineTo(d,g);else for(;y>_;)l.moveTo(y,g),l.lineTo(y-B,g),y-=B*2;l.stroke()}}else w>d?(l.moveTo(d,g),l.bezierCurveTo((d+w)/2,g,w,g,w,S+b),l.stroke()):(l.moveTo(d,g),l.lineTo(w,S),l.stroke());if(o&&t.offset<i.offset){l.font=u.graceFont;let y=l.measureText(o).width,B=0,_=0;if(g>S){let P=Math.abs(g-S);B=P>l.font.size*1.3?g-P/2:g,_=(d+w-y)/2}else B=g,_=w-y;l.fillText(o,_,B)}if(i.value!==0&&t.value!==i.value){let y=i.value,B=i.value>t.value;y=Math.abs(y);let _="";if(y===4)_="full",y-=4;else if(y>=4||y<=-4){let P=y/4|0;_+=P,y-=P*4}if(y>0&&(_+=ns.getFractionSign(y)),_!==""){S=n-p*i.value;let P=S;B||(P=g+Math.abs(S-g)*1/3),l.font=u.tablatureFont;let N=l.measureText(_).width,D=P-u.tablatureFont.size*.5-2*this.scale,Q=w-N/2;l.fillText(_,Q,D)}}}static getFractionSign(e){switch(e){case 1:return"¼";case 2:return"½";case 3:return"¾";default:return e+"/ 4"}}}ns.ArrowSize=6;ns.DashSize=3;ns.BendValueHeight=6;class Hi extends qe{constructor(e){super(0,0),this._isSimpleDip=!1,this._beat=e,this._renderPoints=this.createRenderingPoints(e)}createRenderingPoints(e){if(e.whammyBarType===xe.Custom)return e.whammyBarPoints;let t=[];switch(e.whammyBarType){case xe.Dive:case xe.Hold:case xe.PrediveDive:case xe.Predive:t.push(new A(0,e.whammyBarPoints[0].value)),t.push(new A(A.MaxPosition,e.whammyBarPoints[1].value));break;case xe.Dip:t.push(new A(0,e.whammyBarPoints[0].value)),t.push(new A(A.MaxPosition/2|0,e.whammyBarPoints[1].value)),t.push(new A(A.MaxPosition,e.whammyBarPoints[e.whammyBarPoints.length-1].value));break}return t}doLayout(){super.doLayout(),this._isSimpleDip=this.renderer.settings.notation.notationMode===St.SongBook&&this._beat.whammyBarType===xe.Dip;let e=null,t=null,i=this._beat;for(;i&&i.hasWhammyBar;)(!e||e.value>i.minWhammyPoint.value)&&(e=i.minWhammyPoint),(!t||t.value<i.maxWhammyPoint.value)&&(t=i.maxWhammyPoint),i=i.nextBeat;let r=t.value>0?Math.abs(this.getOffset(t.value)):0;(r>0||this._beat.whammyBarPoints[0].value!==0||this.renderer.settings.notation.isNotationElementVisible(K.ZerosOnDiveWhammys))&&(r+=this.renderer.resources.tablatureFont.size*2);let n=e.value<0?Math.abs(this.getOffset(e.value)):0;this.renderer.registerOverflowTop(r+n);let a=this.renderer.staff.getSharedLayoutData(Hi.TopOffsetSharedDataKey,-1);r>a&&this.renderer.staff.setSharedLayoutData(Hi.TopOffsetSharedDataKey,r)}getOffset(e){if(e===0)return 0;let t=Hi.PerHalfSize*this.scale+Math.log2(Math.abs(e)/2)*Hi.PerHalfSize*this.scale;return e<0&&(t=-t),t}paint(e,t,i){let r=this.renderer,n=this._beat.nextBeat,a=null,o=ae.PreNotes;n&&(a=this.renderer.scoreRenderer.layout.getRendererForBar(this.renderer.staff.staveId,n.voice.bar),!a||a.staff!==r.staff||a!==r&&!n.hasWhammyBar?(n=null,a=null):o=n.hasWhammyBar&&(r.settings.notation.notationMode!==St.SongBook||n.whammyBarType!==xe.Dip)?ae.MiddleNotes:ae.PreNotes);let l=0,h=0;this._isSimpleDip?(l=e+r.x+r.getBeatX(this._beat,ae.OnNotes)-2*this.scale,h=e+r.x+r.getBeatX(this._beat,ae.PostNotes)+2*this.scale):(l=e+r.x+r.getBeatX(this._beat,ae.MiddleNotes),h=a?e+a.x+a.getBeatX(n,o):e+r.x+r.width-2*this.scale);let u=i.textAlign;if(i.textAlign=Y.Center,this._renderPoints.length>=2){let c=(h-l)/A.MaxPosition;i.beginPath();let d=t+this.renderer.staff.getSharedLayoutData(Hi.TopOffsetSharedDataKey,0),p=this._beat.whammyStyle===Ee.Gradual?"grad.":"";for(let g=0,w=this._renderPoints.length-1;g<w;g++){let S=this._renderPoints[g],b=this._renderPoints[g+1],m=g<w-2?this._renderPoints[g+2]:null,y=g===0;g===0&&S.value!==0&&!this._beat.isContinuedWhammy&&(this.paintWhammy(!1,new A(0,0),S,b,l,d,c,i),y=!1),this.paintWhammy(y,S,b,m,l,d,c,i,p),p=""}i.stroke()}i.textAlign=u}paintWhammy(e,t,i,r,n,a,o,l,h){let u=n+o*t.offset,c=n+o*i.offset,d=a-this.getOffset(t.value),p=a-this.getOffset(i.value);if(t.offset===i.offset){let S=Hi.DashSize*this.scale;if(Math.abs(p-d)/(S*2)<1)l.moveTo(u,d),l.lineTo(c,p);else{let m=Math.max(d,p),y=Math.min(d,p);for(;m>y;)l.moveTo(u,y),l.lineTo(u,y+S),y+=S*2}l.stroke()}else if(t.value===i.value){let S=Hi.DashSize*this.scale;if(Math.abs(c-u)/(S*2)<1)l.moveTo(u,d),l.lineTo(c,p);else{let m=Math.max(u,c),y=Math.min(u,c);for(;m>y;)l.moveTo(m,d),l.lineTo(m-S,d),m-=S*2}l.stroke()}else l.moveTo(u,d),l.lineTo(c,p);let g=this.renderer.resources;if(e&&!this._beat.isContinuedWhammy&&!this._isSimpleDip){let S=d;S-=g.tablatureFont.size+2*this.scale,this.renderer.settings.notation.isNotationElementVisible(K.ZerosOnDiveWhammys)&&l.fillText("0",u,S),h&&(S-=g.tablatureFont.size+2*this.scale,l.fillText(h,u,S))}let w=Math.abs(i.value);if((w!==0||this.renderer.settings.notation.isNotationElementVisible(K.ZerosOnDiveWhammys)&&!this._isSimpleDip)&&t.value!==i.value){let S="";if(i.value<0&&(S+="-"),w>=4){let y=w/4|0;S+=y,w-=y*4}else w===0&&(S+="0");w>0&&(S+=ns.getFractionSign(w));let b=0;this._isSimpleDip?b=Math.min(d,p)-g.tablatureFont.size-2*this.scale:(b=t.offset===i.offset?Math.min(d,p):p,b-=g.tablatureFont.size+2*this.scale,r&&r.value>i.value&&(b-=2*this.scale));let m=c;l.fillText(S,m,b)}}}Hi.TopOffsetSharedDataKey="tab.whammy.topoffset";Hi.PerHalfSize=6;Hi.DashSize=3;class wn extends mp{constructor(e){super(0,0),this._beat=e}doLayout(){let e=this.renderer.settings.notation.notationMode;switch(this._beat.whammyBarType){case xe.None:case xe.Custom:case xe.Hold:return;case xe.Dive:case xe.PrediveDive:{let t=new Si(this._beat,!1);t.renderer=this.renderer;let i=this._beat.whammyBarPoints[this._beat.whammyBarPoints.length-1];for(let r of this._beat.notes)r.isTieOrigin||t.addGlyph(this.getBendNoteValue(r,i),i.value%2!==0);t.doLayout(),this.BendNoteHeads.push(t)}break;case xe.Dip:if(e===St.SongBook){let t=this.renderer.resources;this.renderer.simpleWhammyOverflow=t.tablatureFont.size*1.5+wn.SimpleDipHeight*this.scale+wn.SimpleDipPadding*this.scale}else{let t=new Si(this._beat,!1);if(t.renderer=this.renderer,this.renderer.settings.notation.notationMode===St.GuitarPro){let r=this._beat.whammyBarPoints[1];for(let n of this._beat.notes)t.addGlyph(this.getBendNoteValue(n,this._beat.whammyBarPoints[1]),r.value%2!==0)}t.doLayout(),this.BendNoteHeads.push(t);let i=new Si(this._beat,!1);if(i.renderer=this.renderer,this.renderer.settings.notation.notationMode===St.GuitarPro){let r=this._beat.whammyBarPoints[this._beat.whammyBarPoints.length-1];for(let n of this._beat.notes)i.addGlyph(this.getBendNoteValue(n,r),r.value%2!==0)}i.doLayout(),this.BendNoteHeads.push(i)}break;case xe.Predive:break}super.doLayout()}paint(e,t,i){let r=this._beat;switch(r.whammyBarType){case xe.None:case xe.Custom:return}let n=this.renderer.settings.notation.notationMode,a=this.renderer.scoreRenderer.layout.getRendererForBar(this.renderer.staff.staveId,r.voice.bar),o=e+a.x+a.getBeatX(r,ae.MiddleNotes),l=this.getTieDirection(r,a),h=this._beat.notes.length===1?l:E.Up,u=i.textAlign;for(let c=0;c<r.notes.length;c++){let d=r.notes[c],p=t+a.y;c>0&&c>=(this._beat.notes.length/2|0)&&(h=E.Down),h===E.Down?p+=a.getNoteY(d,H.Bottom):p+=a.getNoteY(d,H.Top);let g=e+a.x;r.isLastOfVoice?g+=a.width:g+=a.getBeatX(r,ae.EndBeat),g-=8*this.scale;let w=r.whammyStyle===Ee.Gradual&&c===0?"grad.":"",S=null;d.isTieOrigin&&(S=this.renderer.scoreRenderer.layout.getRendererForBar(this.renderer.staff.staveId,d.tieDestination.beat.voice.bar),S&&S.staff===a.staff?g=e+S.x+S.getBeatX(d.tieDestination.beat,ae.MiddleNotes):S=null);let b=ee.NoteHeadHeight*this.scale*ee.GraceScale*.5;h===E.Up&&(b=-b);let m=r.whammyBarPoints.length>0?this.getBendNoteValue(d,r.whammyBarPoints[r.whammyBarPoints.length-1]):0,y=0,B=!1;switch(this.BendNoteHeads.length>0&&this.BendNoteHeads[0].containsNoteValue(m)?(y=this.BendNoteHeads[0].getNoteValueY(m)+b,B=!0):S&&(d.isTieOrigin&&d.tieDestination.beat.hasWhammyBar||d.beat.isContinuedWhammy)?(y=t+S.y+S.getNoteY(d.tieDestination,H.Top),B=!0,h===E.Down&&(y+=ee.NoteHeadHeight*this.scale)):d.isTieOrigin&&(S?y=t+S.y+S.getNoteY(d.tieDestination,H.Top):y=p,h===E.Down&&(y+=ee.NoteHeadHeight*this.scale)),r.whammyBarType){case xe.Hold:d.isTieOrigin&&pt.paintTie(i,this.scale,o,p,g,y,l===E.Down,22,4);break;case xe.Dive:c===0&&(this.BendNoteHeads[0].x=g-this.BendNoteHeads[0].noteHeadOffset,this.BendNoteHeads[0].y=t+a.y,this.BendNoteHeads[0].paint(0,0,i),this.BendNoteHeads[0].containsNoteValue(m)&&(y+=this.BendNoteHeads[0].y)),B?this.drawBendSlur(i,o,p,g,y,h===E.Down,this.scale,w):d.isTieOrigin&&pt.paintTie(i,this.scale,o,p,g,y,l===E.Down,22,4);break;case xe.Dip:if(n===St.SongBook){if(c===0){let N=e+a.x+a.getBeatX(this._beat,ae.OnNotes)-2*this.scale,D=e+a.x+a.getBeatX(this._beat,ae.PostNotes)+2*this.scale,Q=(N+D)/2,J=((this._beat.whammyBarPoints[1].value-this._beat.whammyBarPoints[0].value)/4|0).toString();i.font=this.renderer.resources.tablatureFont,i.fillText(J,Q,t+this.y);let ge=t+this.y+i.font.size+2*this.scale,qt=ge+wn.SimpleDipHeight*this.scale;this._beat.whammyBarPoints[1].value>this._beat.whammyBarPoints[0].value?(i.moveTo(N,qt),i.lineTo(Q,ge),i.lineTo(D,qt)):(i.moveTo(N,ge),i.lineTo(Q,qt),i.lineTo(D,ge)),i.stroke()}d.isTieOrigin&&pt.paintTie(i,this.scale,o,p,g,y,l===E.Down,22,4)}else{let N=(o+g)/2;this.BendNoteHeads[0].x=N-this.BendNoteHeads[0].noteHeadOffset,this.BendNoteHeads[0].y=t+a.y,this.BendNoteHeads[0].paint(0,0,i);let D=this.getBendNoteValue(d,r.whammyBarPoints[1]),Q=this.BendNoteHeads[0].getNoteValueY(D)+b;this.drawBendSlur(i,o,p,N,Q,h===E.Down,this.scale,w),this.BendNoteHeads[1].x=g-this.BendNoteHeads[1].noteHeadOffset,this.BendNoteHeads[1].y=t+a.y,this.BendNoteHeads[1].paint(0,0,i),y=this.BendNoteHeads[1].getNoteValueY(m)+b,this.drawBendSlur(i,N,Q,g,y,h===E.Down,this.scale,w)}break;case xe.PrediveDive:case xe.Predive:let _=e+a.x+a.getBeatX(d.beat,ae.PreNotes);_+=a.getPreNotesGlyphForBeat(d.beat).prebendNoteHeadOffset;let P=t+a.y+a.getScoreY(a.accidentalHelper.getNoteLineForValue(d.displayValue-(d.beat.whammyBarPoints[0].value/2|0),!1))+b;this.drawBendSlur(i,_,P,o,p,h===E.Down,this.scale,w),this.BendNoteHeads.length>0&&(this.BendNoteHeads[0].x=g-this.BendNoteHeads[0].noteHeadOffset,this.BendNoteHeads[0].y=t+a.y,this.BendNoteHeads[0].paint(0,0,i),this.drawBendSlur(i,o,p,g,y,h===E.Down,this.scale,w));break}}i.textAlign=u}getBendNoteValue(e,t){return e.displayValueWithoutBend+(t.value/2|0)}}wn.SimpleDipHeight=Hi.PerHalfSize*2;wn.SimpleDipPadding=2;class Bt extends qe{constructor(e,t,i){super(e,t),this.width=i}}class NT extends ht{constructor(e,t,i,r,n){super(e,t,n?ee.GraceScale:1,i.getSymbol(r)),this._isGrace=n,this._articulation=i}paint(e,t,i){let r=this._isGrace?this.scale:0;i.fillMusicFontSymbol(e+this.x,t+this.y+r,this.glyphScale*this.scale,this.symbol,!1),this._articulation.techniqueSymbol!==f.None&&this._articulation.techniqueSymbolPlacement===te.Middle&&i.fillMusicFontSymbol(e+this.x,t+this.y+r,this.glyphScale*this.scale,this._articulation.techniqueSymbol,!1)}doLayout(){let e=(this._isGrace?ee.GraceScale:1)*this.scale;switch(this.symbol){case f.NoteheadWhole:this.width=14;break;case f.NoteheadCircleX:case f.NoteheadDiamondWhite:this.width=9;break;case f.NoteheadHeavyXHat:case f.NoteheadHeavyX:this.width=13;break;default:this.width=10;break}this.width=this.width*(this._isGrace?ee.GraceScale:1)*this.scale,this.height=ee.NoteHeadHeight*e}}class Jm extends ht{constructor(e,t){super(e,t,ee.GraceScale,f.ArticStaccatoAbove)}doLayout(){this.width=ee.QuarterNoteHeadWidth*this.scale,this.height=7*this.scale}paint(e,t,i){super.paint(e+3*this.scale,t+5*this.scale,i)}}class PT extends ht{constructor(e,t){super(e,t,.5,f.PictEdgeOfCymbal)}doLayout(){this.width=22*this.scale,this.height=15*this.scale}paint(e,t,i){super.paint(e-3*this.scale,t+this.height,i)}}class CT extends ht{constructor(e,t){super(e,t,ee.GraceScale,f.GuitarGolpe)}doLayout(){this.width=9*this.scale,this.height=10*this.scale}paint(e,t,i){super.paint(e,t+this.height,i)}}class ET extends Ii{constructor(){super(...arguments),this._strings=new Set}addString(e){this._strings.add(e)}doLayout(){const e=bs.CircleNumberHeight*bs.CircleNumberScale*this.scale;this.height=(e+3)*this._strings.size,this.width=e}paint(e,t,i){const r=this.renderer.bar.staff.tuning.length;let n=0;const a=bs.CircleNumberHeight*bs.CircleNumberScale*this.scale;for(const o of this._strings){const l=r-o,h=f.GuitarString1+l;i.fillMusicFontSymbol(e+this.x+ee.NoteHeadHeight/2,t+this.y+a+n,bs.CircleNumberScale,h,!0),n+=a+3*this.scale}}}class Rt extends Ii{constructor(e,t,i,r){super(e,t),this.beatEffects=new Map,this._isGrace=r,this._duration=i,this._symbol=Rt.getSymbol(i)}paint(e,t,i){let r=this._isGrace?this.scale:0;const n=this._isGrace?ee.GraceScale:1;i.fillMusicFontSymbol(e+this.x,t+this.y+r,n*this.scale,this._symbol,!1);for(const a of this.beatEffects.values())a.paint(e+this.x,t+this.y,i)}doLayout(){const e=(this._isGrace?ee.GraceScale:1)*this.scale;switch(this._duration){case k.QuadrupleWhole:case k.DoubleWhole:case k.Whole:this.width=Rt.WholeNoteHeadWidth*e;break;case k.Half:this.width=Rt.HalfNoteHeadWidth*e;break;default:this.width=Rt.QuarterNoteHeadWidth*e;break}this.height=Rt.NoteHeadHeight*e;let t=7*this.scale,i=Rt.NoteHeadHeight*this.scale;for(const r of this.beatEffects.values())r.y+=i,r.x+=this.width/2,r.renderer=this.renderer,i+=t,r.doLayout()}static getSymbol(e){switch(e){case k.QuadrupleWhole:case k.DoubleWhole:case k.Whole:return f.NoteheadSlashWhiteWhole;case k.Half:return f.NoteheadSlashWhiteHalf;default:return f.NoteheadSlashVerticalEnds}}updateBeamingHelper(e){this.beamingHelper&&this.beamingHelper.registerBeatLineX("slash",this.beat,e+this.x+this.width,e+this.x)}}Rt.NoteHeadHeight=17;Rt.QuarterNoteHeadWidth=12;Rt.HalfNoteHeadWidth=25;Rt.WholeNoteHeadWidth=32;class LT extends An{constructor(){super(...arguments),this._collisionOffset=-1e3,this._skipPaint=!1,this.slash=null,this.noteHeads=null,this.restGlyph=null}getNoteX(e,t){return this.noteHeads?this.noteHeads.getNoteX(e,t):0}buildBoundingsLookup(e,t,i){this.noteHeads&&this.noteHeads.buildBoundingsLookup(e,t+this.x,i+this.y)}getNoteY(e,t){return this.noteHeads?this.noteHeads.getNoteY(e,t):0}updateBeamingHelper(){if(this.noteHeads)this.noteHeads.updateBeamingHelper(this.container.x+this.x);else if(this.restGlyph){if(this.restGlyph.updateBeamingHelper(this.container.x+this.x),this.renderer.bar.isMultiVoice&&this._collisionOffset===-1e3){this._collisionOffset=this.renderer.helpers.collisionHelper.applyRestCollisionOffset(this.container.beat,this.restGlyph.y,this.renderer.getScoreHeight(1)),this.y+=this._collisionOffset;const e=this.renderer.helpers.collisionHelper.restDurationsByDisplayTime;e.has(this.container.beat.playbackStart)&&e.get(this.container.beat.playbackStart).has(this.container.beat.playbackDuration)&&e.get(this.container.beat.playbackStart).get(this.container.beat.playbackDuration)!==this.container.beat.id&&(this._skipPaint=!0)}}else this.slash&&this.slash.updateBeamingHelper(this.container.x+this.x)}paint(e,t,i){this._skipPaint||super.paint(e,t,i)}doLayout(){let e=this.renderer;if(!this.container.beat.isEmpty)if(this.container.beat.isRest){let t=Math.ceil((this.renderer.bar.staff.standardNotationLineCount-1)/2)*2;this.container.beat.duration===k.Whole&&this.renderer.bar.staff.standardNotationLineCount!==1&&this.renderer.bar.staff.standardNotationLineCount!==3&&(t-=2);const i=new Nn(0,e.getScoreY(t),this.container.beat.duration);if(this.restGlyph=i,i.beat=this.container.beat,i.beamingHelper=this.beamingHelper,this.addGlyph(i),this.renderer.bar.isMultiVoice)if(this.container.beat.voice.index===0){const r=_s.computeLineHeightsForRest(this.container.beat.duration);let n=i.y-e.getScoreHeight(r[0]),a=i.y+e.getScoreHeight(r[1]);this.renderer.helpers.collisionHelper.reserveBeatSlot(this.container.beat,n,a)}else this.renderer.helpers.collisionHelper.registerRest(this.container.beat);if(this.beamingHelper&&this.beamingHelper.applyRest(this.container.beat,t),this.container.beat.dots>0){this.addGlyph(new Bt(0,0,5*this.scale));for(let r=0;r<this.container.beat.dots;r++){let n=new us(0,0);n.renderer=this.renderer,this.createBeatDot(t,n),this.addGlyph(n)}}}else{if(this.container.beat.slashed){const t=this.container.beat.graceType!==$.None,i=(e.heightLineCount-1)/2,r=e.getLineY(i),n=new Rt(0,r,this.container.beat.duration,t);this.slash=n,n.beat=this.container.beat,n.beamingHelper=this.beamingHelper,this.addGlyph(n)}else{const t=new TT;this.noteHeads=t,t.beat=this.container.beat,t.beamingHelper=this.beamingHelper;let i=new Ah(!1);i.renderer=this.renderer;for(let r of this.container.beat.notes)r.isVisible&&(this.createNoteGlyph(r),i.addParenthesis(r));this.addGlyph(t),i.isEmpty||(this.addGlyph(new Bt(0,0,4*(this.container.beat.graceType!==$.None?ee.GraceScale:1)*this.scale)),this.addGlyph(i))}if(this.container.beat.hasWhammyBar){let t=new wn(this.container.beat);t.renderer=this.renderer,t.doLayout(),this.container.ties.push(t)}if(this.container.beat.dots>0){this.addGlyph(new Bt(0,0,5*this.scale));for(let t=0;t<this.container.beat.dots;t++){let i=new us(0,0);i.renderer=this.renderer;for(let r of this.container.beat.notes)this.createBeatDot(e.getNoteLine(r),i);this.addGlyph(i)}}}super.doLayout(),this.container.beat.isEmpty?this.centerX=this.width/2:this.restGlyph?this.centerX=this.restGlyph.x+this.restGlyph.width/2:this.noteHeads?this.centerX=this.noteHeads.x+this.noteHeads.width/2:this.slash&&(this.centerX=this.slash.x+this.slash.width/2)}createBeatDot(e,t){let i=this.renderer;t.addGlyph(new Qo(0,i.getScoreY(e),1.5*this.scale))}createNoteHeadGlyph(e){let t=this.container.beat.graceType!==$.None;if(e.beat.voice.bar.staff.isPercussion){const i=nt.getArticulation(e);if(i)return new NT(0,0,i,e.beat.duration,t);C.warning("Rendering",`No articulation found for percussion instrument ${e.percussionArticulation}`)}return e.isDead?new BT(0,0,t):e.beat.graceType===$.BendGrace?new ee(0,0,k.Quarter,!0):e.harmonicType===X.Natural?new Dh(0,0,e.beat.duration,t):new ee(0,0,e.beat.duration,t)}createNoteGlyph(e){if(e.beat.graceType===$.BendGrace&&!e.hasBend)return;let t=this.renderer,i=this.createNoteHeadGlyph(e),r=t.getNoteLine(e);if(i.y=t.getScoreY(r),this.noteHeads.addNoteGlyph(i,e,r),e.harmonicType!==X.None&&e.harmonicType!==X.Natural){let a=e.displayValue+e.harmonicPitch;i=new Dh(0,0,e.beat.duration,this.container.beat.graceType!==$.None),r=t.accidentalHelper.getNoteLineForValue(a,!1),i.y=t.getScoreY(r),this.noteHeads.addNoteGlyph(i,e,r)}const n=this.noteHeads.belowBeatEffects;if(e.isStaccato&&!n.has("Staccato")&&n.set("Staccato",new Jm(0,0)),e.accentuated===et.Normal&&!n.has("Accent")&&n.set("Accent",new uo(0,0,e)),e.accentuated===et.Heavy&&!n.has("HAccent")&&n.set("HAccent",new uo(0,0,e)),e.accentuated===et.Tenuto&&!n.has("Tenuto")&&n.set("Tenuto",new uo(0,0,e)),e.showStringNumber&&e.isStringed){let a;n.has("StringNumber")?a=n.get("StringNumber"):(a=new ET(0,0),n.set("StringNumber",a)),a.addString(e.string)}if(e.isPercussion){const a=nt.getArticulation(e);if(a&&a.techniqueSymbolPlacement!==te.Middle){const o=a.techniqueSymbolPlacement===te.Top?this.noteHeads.aboveBeatEffects:this.noteHeads.belowBeatEffects;switch(a.techniqueSymbol){case f.PictEdgeOfCymbal:o.set("PictEdgeOfCymbal",new PT(0,0));break;case f.ArticStaccatoAbove:o.set("ArticStaccatoAbove",new Jm(0,0));break;case f.StringsUpBow:o.set("StringsUpBow",new Xo(0,0,At.Up));break;case f.StringsDownBow:o.set("StringsDownBow",new Xo(0,0,At.Down));break;case f.GuitarGolpe:o.set("GuitarGolpe",new CT(0,0));break}}}}}class MT extends qe{constructor(e){super(0,0),this._beat=e}doLayout(){this.width=this._beat.brushType===Ve.ArpeggioUp||this._beat.brushType===Ve.ArpeggioDown?10*this.scale:0}paint(e,t,i){if(this._beat.brushType===Ve.ArpeggioUp||this._beat.brushType===Ve.ArpeggioDown){let r=this.renderer,n=r.lineOffset,a=t+this.y+(r.getNoteY(this._beat.maxNote,H.Bottom)-n),o=t+this.y+r.getNoteY(this._beat.minNote,H.Top)+n,l=e+this.x+this.width/2,h=8*this.scale,u=new Tn(0,0,Be.Slight,1.2,!0);u.renderer=this.renderer,u.doLayout();let c=-u.height/2;if(this._beat.brushType===Ve.ArpeggioUp){let d=a+h,p=o-h;u.width=Math.abs(p-d),i.beginRotate(e+this.x+5*this.scale,p,-90),u.paint(0,c,i),i.endRotate(),i.beginPath(),i.moveTo(l,o),i.lineTo(l+h/2,o-h),i.lineTo(l-h/2,o-h),i.closePath(),i.fill()}else if(this._beat.brushType===Ve.ArpeggioDown){let d=a+h,p=o;u.width=Math.abs(p-d),i.beginRotate(e+this.x+5*this.scale,d,90),u.paint(0,c,i),i.endRotate(),i.beginPath(),i.moveTo(l,a),i.lineTo(l+h/2,a+h),i.lineTo(l-h/2,a+h),i.closePath(),i.fill()}}}}class FT{constructor(e,t){this.line=0,this.line=e,this.text=t}}class RT extends us{constructor(){super(0,0),this._infos=new Map}get isEmpty(){return this._infos.size===0}addFingers(e){const t=this.renderer.settings;if(t.notation.fingeringMode!==Cs.ScoreDefault&&t.notation.fingeringMode!==Cs.ScoreForcePiano)return;const i=Re.fingerToString(this.renderer.settings,e.beat,e.leftHandFinger,!0);i&&this.addFinger(e,i);const r=Re.fingerToString(this.renderer.settings,e.beat,e.rightHandFinger,!1);r&&this.addFinger(e,r)}addFinger(e,t){let r=this.renderer.getNoteLine(e);if(this._infos.has(r)){const n=this._infos.get(r);n.text+=t}else{const n=new FT(r,t);this._infos.set(r,n)}}doLayout(){let e=this.renderer;for(const[t,i]of this._infos){const r=new Mt(0,0,i.text,e.resources.inlineFingeringFont,Y.Left,te.Middle);r.renderer=e,r.y=e.getScoreY(i.line),r.doLayout(),this.addGlyph(r),this.width=Math.max(this.width,r.width)}}}class DT extends Dn{get prebendNoteHeadOffset(){return this._prebends?this._prebends.x+this._prebends.noteHeadOffset:0}doLayout(){if(!this.container.beat.isRest){let e=new gp;e.renderer=this.renderer;let t=new RT;t.renderer=this.renderer;let i=new Ah(!0);i.renderer=this.renderer;const r=new Si(this.container.beat,!0);this._prebends=r,r.renderer=this.renderer;for(let n of this.container.beat.notes)if(n.isVisible){if(n.hasBend)switch(n.bendType){case G.PrebendBend:case G.Prebend:case G.PrebendRelease:r.addGlyph(n.displayValue-(n.bendPoints[0].value/2|0),!1);break}else if(n.beat.hasWhammyBar)switch(n.beat.whammyBarType){case xe.PrediveDive:case xe.Predive:this._prebends.addGlyph(n.displayValue-(n.beat.whammyBarPoints[0].value/2|0),!1);break}this.createAccidentalGlyph(n,e),i.addParenthesis(n),t.addFingers(n)}r.isEmpty||(this.addGlyph(r),this.addGlyph(new Bt(0,0,4*(this.container.beat.graceType!==$.None?ee.GraceScale:1)*this.scale))),this.container.beat.brushType!==Ve.None&&(this.addGlyph(new MT(this.container.beat)),this.addGlyph(new Bt(0,0,4*this.scale))),t.isEmpty||(this.addGlyph(new Bt(0,0,2*(this.container.beat.graceType!==$.None?ee.GraceScale:1)*this.scale)),this.addGlyph(t),this.addGlyph(new Bt(0,0,2*(this.container.beat.graceType!==$.None?ee.GraceScale:1)*this.scale))),i.isEmpty||(this.addGlyph(i),this.addGlyph(new Bt(0,0,4*(this.container.beat.graceType!==$.None?ee.GraceScale:1)*this.scale))),e.isEmpty||(this.accidentals=e,this.addGlyph(new Bt(0,0,2*(this.container.beat.graceType!==$.None?ee.GraceScale:1)*this.scale)),this.addGlyph(e),this.addGlyph(new Bt(0,0,2*(this.container.beat.graceType!==$.None?ee.GraceScale:1)*this.scale)))}super.doLayout()}createAccidentalGlyph(e,t){let i=this.renderer,r=i.accidentalHelper.applyAccidental(e),n=i.getNoteLine(e),a=this.container.beat.graceType!==$.None;const o=a?ee.GraceScale:1;if(r!==U.None){let l=new Xs(0,i.getScoreY(n),r,o);l.renderer=this.renderer,t.addGlyph(l)}if(e.harmonicType!==X.None&&e.harmonicType!==X.Natural){let l=e.displayValue+e.harmonicPitch;r=i.accidentalHelper.applyAccidentalForValue(e.beat,l,a,!1),n=i.accidentalHelper.getNoteLineForValue(l,!1);let h=new Xs(0,i.getScoreY(n),r,o);h.renderer=this.renderer,t.addGlyph(h)}}constructor(){super(),this._prebends=null,this.accidentals=null}}class yp extends ht{constructor(e,t,i,r){super(e,t,r,yp.getSymbol(i)),this._digit=0,this._scale=0,this._digit=i,this._scale=r}doLayout(){this.width=this.getDigitWidth(this._digit)*this.scale*this._scale}getDigitWidth(e){switch(e){case 0:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:return 14;case 1:return 10;default:return 0}}static getSymbol(e){switch(e){case 0:return f.TimeSig0;case 1:return f.TimeSig1;case 2:return f.TimeSig2;case 3:return f.TimeSig3;case 4:return f.TimeSig4;case 5:return f.TimeSig5;case 6:return f.TimeSig6;case 7:return f.TimeSig7;case 8:return f.TimeSig8;case 9:return f.TimeSig9;default:return f.None}}}class th extends us{constructor(e,t,i,r=1){super(e,t),this._number=0,this._scale=0,this._number=i,this._scale=r}doLayout(){let e=this._number;for(;e>0;){let t=e%10,i=new yp(0,0,t,this._scale);this.addGlyph(i),e=e/10|0}if(this.glyphs){this.glyphs.reverse();let t=0;for(let i=0,r=this.glyphs.length;i<r;i++){let n=this.glyphs[i];n.x=t,n.y=0,n.renderer=this.renderer,n.doLayout(),t+=n.width}this.width=t}}}th.numberHeight=18;class lb extends us{constructor(e,t,i,r,n,a){super(e,t),this._numerator=0,this._denominator=0,this._numerator=i,this._denominator=r,this._isCommon=n,this._isFreeTime=a}doLayout(){let e=0;const t=th.numberHeight*this.scale;if(this._isFreeTime){const i=new _a(!0);i.renderer=this.renderer,i.y=-t,i.height=t*2,i.doLayout(),this.addGlyph(i),e+=i.width+10*this.scale}if(this._isCommon&&this._numerator===2&&this._denominator===2){let i=new ht(e,0,this.commonScale,f.TimeSigCutCommon);i.width=14*this.scale,this.addGlyph(i),super.doLayout()}else if(this._isCommon&&this._numerator===4&&this._denominator===4){let i=new ht(e,0,this.commonScale,f.TimeSigCommon);i.width=14*this.scale,this.addGlyph(i),super.doLayout()}else{let i=new th(e,-t/2,this._numerator,this.numberScale),r=new th(e,t/2,this._denominator,this.numberScale);this.addGlyph(i),this.addGlyph(r),super.doLayout();const n=this.width-e;i.x=e+(n-i.width)/2,r.x=e+(n-r.width)/2}if(this._isFreeTime){const i=new _a(!1);i.renderer=this.renderer,i.x=this.width+13*this.scale,i.y=-t,i.height=t*2,i.doLayout(),this.addGlyph(i),this.width=i.x+i.width}}}class wp extends lb{get commonScale(){return 1}get numberScale(){return 1}}class AT extends mp{constructor(e){super(0,0),this._notes=[],this._endNoteGlyph=null,this._middleNoteGlyph=null,this._beat=e}addBends(e){if(this._notes.push(e),!e.isTieOrigin)switch(e.bendType){case G.Bend:case G.PrebendRelease:case G.PrebendBend:{let t=this._endNoteGlyph;t||(t=new Si(e.beat,!1),t.renderer=this.renderer,this._endNoteGlyph=t,this.BendNoteHeads.push(t));let i=e.bendPoints[e.bendPoints.length-1];t.addGlyph(this.getBendNoteValue(e,i),i.value%2!==0)}break;case G.Release:if(!e.isTieOrigin){let t=this._endNoteGlyph;t||(t=new Si(e.beat,!1),t.renderer=this.renderer,this._endNoteGlyph=t,this.BendNoteHeads.push(t));let i=e.bendPoints[e.bendPoints.length-1];t.addGlyph(this.getBendNoteValue(e,i),i.value%2!==0)}break;case G.BendRelease:{let t=this._middleNoteGlyph;t||(t=new Si(e.beat,!1),this._middleNoteGlyph=t,t.renderer=this.renderer,this.BendNoteHeads.push(t));let i=e.bendPoints[1];t.addGlyph(this.getBendNoteValue(e,e.bendPoints[1]),i.value%2!==0);let r=this._endNoteGlyph;r||(r=new Si(e.beat,!1),r.renderer=this.renderer,this._endNoteGlyph=r,this.BendNoteHeads.push(r));let n=e.bendPoints[e.bendPoints.length-1];r.addGlyph(this.getBendNoteValue(e,n),n.value%2!==0)}break}}paint(e,t,i){let r=this.renderer.scoreRenderer.layout.getRendererForBar(this.renderer.staff.staveId,this._beat.voice.bar),n=e+r.x+r.getBeatX(this._beat,ae.MiddleNotes),a=e+r.x;this._beat.isLastOfVoice?a+=r.postBeatGlyphsStart:a+=r.getBeatX(this._beat.nextBeat,ae.PreNotes),a-=8*this.scale;let o=(n+a)/2;this._middleNoteGlyph&&(this._middleNoteGlyph.x=o-this._middleNoteGlyph.noteHeadOffset,this._middleNoteGlyph.y=t+r.y,this._middleNoteGlyph.paint(0,0,i)),this._endNoteGlyph&&(this._endNoteGlyph.x=a-this._endNoteGlyph.noteHeadOffset,this._endNoteGlyph.y=t+r.y,this._endNoteGlyph.paint(0,0,i)),this._notes.sort((u,c)=>c.displayValue-u.displayValue);let l=this._beat.graceType===$.BendGrace?this._beat.nextBeat:this._beat,h=this._notes.length===1?this.getTieDirection(l,r):E.Up;for(let u=0;u<this._notes.length;u++){let c=this._notes[u];u>0&&u>=(this._notes.length/2|0)&&(h=E.Down);let d=t+r.y+r.getNoteY(c,H.Top),p=ee.NoteHeadHeight*this.scale*ee.GraceScale*.5;h===E.Down&&(d+=ee.NoteHeadHeight*this.scale);let g=c.bendStyle===Ee.Gradual?"grad.":"";if(c.isTieOrigin){let w=c.tieDestination,S=w?this.renderer.scoreRenderer.layout.getRendererForBar(this.renderer.staff.staveId,w.beat.voice.bar):null;if(!S||S.staff!==r.staff){let b=e+r.x+r.width,m=c.tieDestination.realValue;r.accidentalHelper.applyAccidentalForValue(c.beat,m,!1,!0);let y=t+r.y+r.getScoreY(r.accidentalHelper.getNoteLineForValue(m,!1));c.bendType===G.Hold||c.bendType===G.Prebend?pt.paintTie(i,this.scale,n,d,b,y,h===E.Down,22,4):this.drawBendSlur(i,n,d,b,y,h===E.Down,this.scale,g)}else{let b=e+S.x+S.getBeatX(w.beat,ae.MiddleNotes),m=t+S.y+S.getNoteY(w,H.Top);h===E.Down&&(m+=ee.NoteHeadHeight*this.scale),c.bendType===G.Hold||c.bendType===G.Prebend?pt.paintTie(i,this.scale,n,d,b,m,h===E.Down,22,4):this.drawBendSlur(i,n,d,b,m,h===E.Down,this.scale,g)}switch(c.bendType){case G.Prebend:case G.PrebendBend:case G.PrebendRelease:let b=e+r.x+r.getBeatX(c.beat,ae.PreNotes);b+=r.getPreNotesGlyphForBeat(c.beat).prebendNoteHeadOffset;let m=t+r.y+r.getScoreY(r.accidentalHelper.getNoteLineForValue(c.displayValue-(c.bendPoints[0].value/2|0),!1))+p;this.drawBendSlur(i,b,m,n,d,h===E.Down,this.scale);break}}else{h===E.Up&&(p=-p);let w=0,S=0;switch(c.bendType){case G.Bend:w=this.getBendNoteValue(c,c.bendPoints[c.bendPoints.length-1]),S=this._endNoteGlyph.getNoteValueY(w)+p,this.drawBendSlur(i,n,d,a,S,h===E.Down,this.scale,g);break;case G.BendRelease:let b=this.getBendNoteValue(c,c.bendPoints[1]),m=this._middleNoteGlyph.getNoteValueY(b)+p;this.drawBendSlur(i,n,d,o,m,h===E.Down,this.scale,g),w=this.getBendNoteValue(c,c.bendPoints[c.bendPoints.length-1]),S=this._endNoteGlyph.getNoteValueY(w)+p,this.drawBendSlur(i,o,m,a,S,h===E.Down,this.scale,g);break;case G.Release:this.BendNoteHeads.length>0&&(w=this.getBendNoteValue(c,c.bendPoints[c.bendPoints.length-1]),S=this.BendNoteHeads[0].getNoteValueY(w)+p,this.drawBendSlur(i,n,d,a,S,h===E.Down,this.scale,g));break;case G.Prebend:case G.PrebendBend:case G.PrebendRelease:let y=e+r.x+r.getBeatX(c.beat,ae.PreNotes);y+=r.getPreNotesGlyphForBeat(c.beat).prebendNoteHeadOffset;let B=t+r.y+r.getScoreY(r.accidentalHelper.getNoteLineForValue(c.displayValue-(c.bendPoints[0].value/2|0),!1))+p;this.drawBendSlur(i,y,B,n,d,h===E.Down,this.scale),this.BendNoteHeads.length>0&&(w=this.getBendNoteValue(c,c.bendPoints[c.bendPoints.length-1]),S=this.BendNoteHeads[0].getNoteValueY(w)+p,this.drawBendSlur(i,n,d,a,S,h===E.Down,this.scale,g));break}}}}getBendNoteValue(e,t){return e.displayValueWithoutBend+(t.value/2|0)}}class Wd extends pt{constructor(e,t,i=!1){super(e,t,i)}doLayout(){super.doLayout()}getBeamDirection(e,t){if(e.isRest)return E.Up;switch(t.getBeatDirection(e)){case E.Up:return E.Down;default:return E.Up}}getStartY(){if(this.startBeat.isRest)return this.startNoteRenderer.getScoreY(9);switch(this.tieDirection){case E.Up:return this.startNoteRenderer.getNoteY(this.startBeat.maxNote,H.Top);default:return this.startNoteRenderer.getNoteY(this.startBeat.minNote,H.Bottom)}}getEndY(){const e=this.endNoteRenderer;if(this.endBeat.isRest)switch(this.tieDirection){case E.Up:return e.getScoreY(9);default:return e.getScoreY(0)}const t=this.startNoteRenderer.getBeatDirection(this.startBeat),i=e.getBeatDirection(this.endBeat);if(t!==i&&this.startBeat.graceType===$.None)if(i===this.tieDirection)switch(this.tieDirection){case E.Up:return e.getNoteY(this.endBeat.maxNote,H.TopWithStem);default:return e.getNoteY(this.endBeat.minNote,H.BottomWithStem)}else switch(this.tieDirection){case E.Up:return e.getNoteY(this.endBeat.maxNote,H.BottomWithStem);default:return e.getNoteY(this.endBeat.minNote,H.TopWithStem)}switch(this.tieDirection){case E.Up:return e.getNoteY(this.endBeat.maxNote,H.Top);default:return e.getNoteY(this.endBeat.minNote,H.Bottom)}}getStartX(){return this.startNoteRenderer.getBeatX(this.startBeat,ae.MiddleNotes)}getEndX(){const e=this.endNoteRenderer.getBeatDirection(this.endBeat);return this.endNoteRenderer.getBeatX(this.endBeat,this.endBeat.duration>k.Whole&&e===this.tieDirection?ae.Stem:ae.MiddleNotes)}}class IT extends qe{constructor(e,t,i,r){super(0,0),this._outType=t,this._inType=e,this._startNote=i,this._parent=r}doLayout(){this.width=0}paint(e,t,i){this.paintSlideIn(e,t,i),this.drawSlideOut(e,t,i)}paintSlideIn(e,t,i){let r=this.renderer,n=12*this.scale,a=e+r.x+r.getNoteX(this._startNote,Fe.Left)-2*this.scale,o=t+r.y+r.getNoteY(this._startNote,H.Center),l=a-n,h=t+r.y;switch(this._inType){case vt.IntoFromBelow:h+=r.getNoteY(this._startNote,H.Bottom);break;case vt.IntoFromAbove:h+=r.getNoteY(this._startNote,H.Top);break;default:return}let u=this.getAccidentalsWidth(r,this._startNote.beat);l-=u,a-=u,this.paintSlideLine(i,!1,l,a,h,o)}getAccidentalsWidth(e,t){let i=e.getPreNotesGlyphForBeat(t);return i&&i.accidentals?i.accidentals.width:0}drawSlideOut(e,t,i){let r=this.renderer,n=12*this.scale,a=1*this.scale,o=2*this.scale,l=0,h=0,u=0,c=0,d=!1;switch(this._outType){case ne.Shift:case ne.Legato:if(l=e+r.x+r.getBeatX(this._startNote.beat,ae.PostNotes),h=t+r.y+r.getNoteY(this._startNote,H.Center),this._startNote.slideTarget){let p=this.renderer.scoreRenderer.layout.getRendererForBar(this.renderer.staff.staveId,this._startNote.slideTarget.beat.voice.bar);!p||p.staff!==r.staff?(u=e+r.x+r.width,c=h):(u=e+p.x+p.getBeatX(this._startNote.slideTarget.beat,ae.PreNotes)-a,c=t+p.y+p.getNoteY(this._startNote.slideTarget,H.Center)),this._startNote.slideTarget.realValue>this._startNote.realValue?(h+=o,c-=o):(h-=o,c+=o)}else u=e+r.x+this._parent.x,c=h;break;case ne.OutUp:l=e+r.x+r.getNoteX(this._startNote,Fe.Right),h=t+r.y+r.getNoteY(this._startNote,H.Center),u=l+n,c=t+r.y+r.getNoteY(this._startNote,H.Top);break;case ne.OutDown:l=e+r.x+r.getNoteX(this._startNote,Fe.Right),h=t+r.y+r.getNoteY(this._startNote,H.Center),u=l+n,c=t+r.y+r.getNoteY(this._startNote,H.Bottom);break;case ne.PickSlideUp:l=e+r.x+r.getNoteX(this._startNote,Fe.Right),h=t+r.y+r.getNoteY(this._startNote,H.Center),c=t+r.y+r.getNoteY(this._startNote,H.Top),u=e+r.x+r.width,this._startNote.beat.nextBeat&&this._startNote.beat.nextBeat.voice===this._startNote.beat.voice&&(u=e+r.x+r.getBeatX(this._startNote.beat.nextBeat,ae.PreNotes)),d=!0;break;case ne.PickSlideDown:l=e+r.x+r.getNoteX(this._startNote,Fe.Right),h=t+r.y+r.getNoteY(this._startNote,H.Center),c=t+r.y+r.getNoteY(this._startNote,H.Bottom),u=e+r.x+r.width,this._startNote.beat.nextBeat&&this._startNote.beat.nextBeat.voice===this._startNote.beat.voice&&(u=e+r.x+r.getBeatX(this._startNote.beat.nextBeat,ae.PreNotes)),d=!0;break;default:return}this.paintSlideLine(i,d,l,u,h,c)}paintSlideLine(e,t,i,r,n,a){if(t){let o=new Tn(0,0,Be.Slight,1.2);o.renderer=this.renderer,o.doLayout(),n-=o.height/2,a-=o.height/2;let l=r-i,h=a-n,u=Math.sqrt(Math.pow(h,2)+Math.pow(l,2));o.width=l;let c=Math.asin(h/u)*(180/Math.PI);e.beginRotate(i,n,c),o.paint(0,0,e),e.endRotate()}else e.beginPath(),e.moveTo(i,n),e.lineTo(r,a),e.stroke()}}class Al extends Wd{constructor(e,t,i=!1){super(e.beat,t.beat,i),this._startNote=e,this._endNote=t}getTieHeight(e,t,i,r){return Math.log2(i-e+1)*this.renderer.settings.notation.slurHeight}getStartY(){if(this.isStartCentered())switch(this.tieDirection){case E.Up:return this.startNoteRenderer.getNoteY(this._startNote,H.Top);default:return this.startNoteRenderer.getNoteY(this._startNote,H.Bottom)}return this.startNoteRenderer.getNoteY(this._startNote,H.Center)}getEndY(){if(this.isEndCentered())if(this.isEndOnStem())switch(this.tieDirection){case E.Up:return this.endNoteRenderer.getNoteY(this._endNote,H.TopWithStem);default:return this.endNoteRenderer.getNoteY(this._endNote,H.BottomWithStem)}else switch(this.tieDirection){case E.Up:return this.endNoteRenderer.getNoteY(this._endNote,H.Top);default:return this.endNoteRenderer.getNoteY(this._endNote,H.Bottom)}else return this.endNoteRenderer.getNoteY(this._endNote,H.Center)}isStartCentered(){return this._startNote===this._startNote.beat.maxNote&&this.tieDirection===E.Up||this._startNote===this._startNote.beat.minNote&&this.tieDirection===E.Down}isEndCentered(){return this._startNote.beat.graceType===$.None&&(this._endNote===this._endNote.beat.maxNote&&this.tieDirection===E.Up||this._endNote===this._endNote.beat.minNote&&this.tieDirection===E.Down)}isEndOnStem(){const e=this.endNoteRenderer,t=this.startNoteRenderer.getBeatDirection(this.startBeat),i=e.getBeatDirection(this.endBeat);return t!==i&&this.startBeat.graceType===$.None}getStartX(){return this.isStartCentered()?this.startNoteRenderer.getBeatX(this._startNote.beat,ae.MiddleNotes):this.startNoteRenderer.getNoteX(this._startNote,Fe.Right)}getEndX(){return this.isEndCentered()?this.isEndOnStem()?this.endNoteRenderer.getBeatX(this._endNote.beat,ae.Stem):this.endNoteRenderer.getNoteX(this._endNote,Fe.Center):this.endNoteRenderer.getBeatX(this._endNote.beat,ae.PreNotes)}}class qm extends pt{constructor(e,t,i=!1){super(e?e.beat:null,t?t.beat:null,i),this.startNote=e,this.endNote=t}shouldDrawBendSlur(){return this.renderer.settings.notation.extendBendArrowsOnTiedNotes&&!!this.startNote.bendOrigin&&this.startNote.isTieOrigin}doLayout(){super.doLayout()}getBeamDirection(e,t){switch(t.getBeatDirection(e)){case E.Up:return E.Down;default:return E.Up}}getStartY(){if(this.startBeat.isRest)return this.startNoteRenderer.getScoreY(9);switch(this.tieDirection){case E.Up:return this.startNoteRenderer.getNoteY(this.startNote,H.Top);default:return this.startNoteRenderer.getNoteY(this.startNote,H.Bottom)}}getEndY(){const e=this.endNoteRenderer;if(this.endBeat.isRest)switch(this.tieDirection){case E.Up:return e.getScoreY(9);default:return e.getScoreY(0)}switch(this.tieDirection){case E.Up:return e.getNoteY(this.endNote,H.Top);default:return e.getNoteY(this.endNote,H.Bottom)}}getStartX(){return this.startNoteRenderer.getBeatX(this.startNote.beat,ae.PostNotes)}getEndX(){return this.endNoteRenderer.getBeatX(this.endNote.beat,ae.PreNotes)}}class OT extends Ui{constructor(e,t){super(e,t),this._bend=null,this._effectSlur=null,this._effectEndSlur=null}doLayout(){if(this._effectSlur=null,this._effectEndSlur=null,super.doLayout(),this.beat.isLegatoOrigin){if(!this.beat.previousBeat||!this.beat.previousBeat.isLegatoOrigin){let e=this.beat.nextBeat;for(;e.nextBeat&&e.nextBeat.isLegatoDestination;)e=e.nextBeat;this.addTie(new Wd(this.beat,e,!1))}}else if(this.beat.isLegatoDestination&&!this.beat.isLegatoOrigin){let e=this.beat.previousBeat;for(;e.previousBeat&&e.previousBeat.isLegatoOrigin;)e=e.previousBeat;this.addTie(new Wd(e,this.beat,!0))}this._bend&&(this._bend.renderer=this.renderer,this._bend.doLayout(),this.updateWidth())}createTies(e){if(e.isVisible){if(e.isTieOrigin&&!e.hasBend&&!e.beat.hasWhammyBar&&e.beat.graceType!==$.BendGrace&&e.tieDestination&&e.tieDestination.isVisible){let t=new qm(e,e.tieDestination,!1);this.addTie(t)}if(e.isTieDestination&&!e.tieOrigin.hasBend&&!e.beat.hasWhammyBar){let t=new qm(e.tieOrigin,e,!0);this.addTie(t)}if(e.slideInType!==vt.None||e.slideOutType!==ne.None){let t=new IT(e.slideInType,e.slideOutType,e,this);this.addTie(t)}if(e.isSlurOrigin&&e.slurDestination&&e.slurDestination.isVisible){let t=new Al(e,e.slurDestination,!1);this.addTie(t)}if(e.isSlurDestination){let t=new Al(e.slurOrigin,e,!0);this.addTie(t)}if(!this._effectSlur&&e.isEffectSlurOrigin&&e.effectSlurDestination){const t=new Al(e,e.effectSlurDestination,!1);this._effectSlur=t,this.addTie(t)}if(!this._effectEndSlur&&e.beat.isEffectSlurDestination&&e.beat.effectSlurOrigin){let t=this.onNotes.beamingHelper.direction,i=t===E.Up?e.beat.effectSlurOrigin.minNote:e.beat.effectSlurOrigin.maxNote,r=t===E.Up?e.beat.minNote:e.beat.maxNote;const n=new Al(i,r,!0);this._effectEndSlur=n,this.addTie(n)}if(e.hasBend){if(!this._bend){const t=new AT(e.beat);this._bend=t,t.renderer=this.renderer,this.addTie(t)}this._bend.addBends(e)}}}}class VT extends qe{constructor(e,t,i,r){super(e,t),this._dotOffset=0,this._circleSize=0,this._dotOffset=0,this._circleSize=0,this._dotOffset=r,this._circleSize=i}doLayout(){this.width=13*this.scale}paint(e,t,i){let r=4*this.scale,n=t+this.y+this.renderer.topPadding,a=t+this.y+this.renderer.height-this.renderer.bottomPadding,o=e+this.x+.5,l=a-n;i.fillRect(o,n,r,l),o+=r*2-.5,i.beginPath(),i.moveTo(o,n),i.lineTo(o,a),i.stroke(),o+=3*this.scale;let h=this._circleSize*this.scale,u=(n+a)/2;i.fillCircle(o,u-h*this._dotOffset,h),i.fillCircle(o,u+h*this._dotOffset,h)}}class Pu extends qe{constructor(e,t){super(e,t)}doLayout(){this.renderer.isLast?this.width=15*this.scale:!this.renderer.nextRenderer||this.renderer.nextRenderer.staff!==this.renderer.staff||!this.renderer.nextRenderer.bar.masterBar.isRepeatStart?(this.width=2*this.scale,this.renderer.bar.masterBar.isDoubleBar&&(this.width+=2*this.scale)):this.width=2*this.scale}paint(e,t,i){let r=4*this.scale,n=t+this.y+this.renderer.topPadding,a=t+this.y+this.renderer.height-this.renderer.bottomPadding,o=e+this.x,l=a-n;if(this.renderer.isLast)i.fillRect(o+this.width-r-r,n,this.scale,l),i.fillRect(o+this.width-r,n,r,l);else if(!this.renderer.nextRenderer||this.renderer.nextRenderer.staff!==this.renderer.staff||!this.renderer.nextRenderer.bar.masterBar.isRepeatStart)if(this.renderer.bar.masterBar.isFreeTime){const h=Pu.DashSize*this.scale,u=(o+this.width-this.scale|0)+.5,c=Math.ceil(l/2/h);if(i.beginPath(),c<1)i.moveTo(u,n),i.lineTo(u,a);else{let d=n;const g=(l-c*h)/(c-1);for(;d<a;)i.moveTo(u,d),i.lineTo(u,d+h),d+=h+g}i.stroke()}else i.fillRect(o+this.width-this.scale,n,this.scale,l),this.renderer.bar.masterBar.isDoubleBar&&i.fillRect(o+this.width-5*this.scale,n,this.scale,l)}}Pu.DashSize=4;class HT extends qe{constructor(e,t){super(e,t)}doLayout(){this.width=11*this.scale}paint(e,t,i){let r=4*this.scale,n=t+this.y+this.renderer.topPadding,a=t+this.y+this.renderer.height-this.renderer.bottomPadding,o=e+this.x,l=a-n,h=1.5*this.scale,u=(n+a)/2,c=3;i.fillCircle(o,u-h*c,h),i.fillCircle(o,u+h*c,h),o+=4*this.scale,i.beginPath(),i.moveTo(o,n),i.lineTo(o,a),i.stroke(),o+=3*this.scale+.5,i.fillRect(o,n,r,l)}}class WT extends qe{constructor(e,t,i){super(e,t),this._count=0,this._count=0,this._count=i}doLayout(){this.width=0}paint(e,t,i){let r=this.renderer.resources,n=i.textAlign;i.font=r.barNumberFont,i.textAlign=Y.Right;let a="x"+this._count,o=i.measureText(a).width/1.5;i.fillText(a,e+this.x-o,t+this.y),i.textAlign=n}}class zT extends qe{constructor(e,t,i){super(e,t),this._number=0,this._number=i}doLayout(){this.renderer.scoreRenderer.canvas.font=this.renderer.resources.barNumberFont,this.width=this.renderer.scoreRenderer.canvas.measureText(this._number.toString()).width+5*this.scale}paint(e,t,i){if(!this.renderer.staff.isFirstInAccolade)return;let r=this.renderer.resources,n=i.color;const a=i.textBaseline;i.textBaseline=te.Top,i.color=r.barNumberColor,i.font=r.barNumberFont,i.fillText(this._number.toString(),e+this.x,t+this.y),i.color=n,i.textBaseline=a}}class Xr extends Ge{constructor(e,t){super(e,t),this.firstLineY=0,this._startSpacing=!1,this.tupletSize=0}get lineOffset(){return(this.lineSpacing+1)*this.scale}get tupletOffset(){return 10*this.scale}get topGlyphOverflow(){const e=this.resources;return(e.tablatureFont.size/2+e.tablatureFont.size*.2)*this.scale}get bottomGlyphOverflow(){const e=this.resources;return(e.tablatureFont.size/2+e.tablatureFont.size*.2)*this.scale}initLineBasedSizes(){this.topPadding=this.topGlyphOverflow,this.bottomPadding=this.bottomGlyphOverflow,this.height=this.lineOffset*(this.heightLineCount-1)+this.topPadding+this.bottomPadding}updateSizes(){this.initLineBasedSizes(),this.adjustSizes(),this.updateFirstLineY(),super.updateSizes()}adjustSizes(){}updateFirstLineY(){let e=this.lineOffset*(this.heightLineCount-1),t=(this.drawnLineCount-1)*this.lineOffset;this.firstLineY=this.topPadding+(e-t)/2}doLayout(){this.initLineBasedSizes(),this.updateFirstLineY(),this.tupletSize=15*this.scale+this.resources.effectFont.size*.3,super.doLayout()}getLineY(e){return this.firstLineY+this.getLineHeight(e)}getLineHeight(e){return this.lineOffset*e}paintBackground(e,t,i){super.paintBackground(e,t,i);const r=this.resources;i.color=r.staffLineColor;const n=[];for(let a=0,o=this.drawnLineCount;a<o;a++)n.push([]);this.collectSpaces(n);for(const a of n)a.sort((o,l)=>o[0]>l[0]?1:o[0]<l[0]?-1:0);for(let a=0;a<this.drawnLineCount;a++){const o=this.getLineY(a);let l=0;for(let h of n[a])i.fillRect(e+this.x+l,t+this.y+o|0,h[0]-l,this.scale*Ge.StaffLineThickness),l=h[0]+h[1];i.fillRect(e+this.x+l,t+this.y+o|0,this.width-l,this.scale*Ge.StaffLineThickness)}i.color=r.mainGlyphColor,this.paintSimileMark(e,t,i)}collectSpaces(e){}createStartSpacing(){this._startSpacing||(this.addPreBeatGlyph(new Bt(0,0,2*this.scale)),this._startSpacing=!0)}paintTuplets(e,t,i,r=!1){for(const n of this.bar.voices)if(this.hasVoiceContainer(n)){const a=this.getVoiceContainer(n);for(const o of a.tupletGroups)this.paintTupletHelper(e+this.beatGlyphsStart,t,i,o,r)}}getTupletBeamDirection(e){return this.getBeamDirection(e)}paintTupletHelper(e,t,i,r,n){const a=this.resources;let o=i.textAlign,l=i.textBaseline;i.color=r.voice.index===0?this.resources.mainGlyphColor:this.resources.secondaryGlyphColor,i.textAlign=Y.Center,i.textBaseline=te.Middle;let h,u=r.beats[0].tupletNumerator,c=r.beats[0].tupletDenominator;u===2&&c===3?h="2":u===3&&c===2?h="3":u===4&&c===6?h="4":u===5&&c===4?h="5":u===6&&c===4?h="6":u===7&&c===4?h="7":u===9&&c===8?h="9":u===10&&c===8?h="10":u===11&&c===8?h="11":u===12&&c===8?h="12":u===13&&c===8?h="13":h=u+":"+c;let d=this.tupletOffset,p=5*this.scale;if(r.beats.length===1||!r.isFull)for(const g of r.beats){let w=this.helpers.beamHelperLookup[r.voice.index].get(g.index);if(!w)continue;let S=this.getTupletBeamDirection(w),b=w.getBeatLineX(g),m=this.calculateBeamYWithDirection(w,b,S);S===E.Down?m+=d+p:m-=d+p,i.font=a.effectFont,i.fillText(h,e+this.x+b,t+this.y+m)}else{let g=r.beats[0],w=r.beats[r.beats.length-1],S=null,b=null;for(let ke=0;ke<r.beats.length;ke++)if(!r.beats[ke].isRest){S=r.beats[ke];break}for(let ke=r.beats.length-1;ke>=0;ke--)if(!r.beats[ke].isRest){b=r.beats[ke];break}let m=!1;S||(S=g,m=!0),b||(b=w);let y=this.helpers.beamHelperLookup[r.voice.index].get(g.index),B=this.helpers.beamHelperLookup[r.voice.index].get(w.index),_=y.getBeatLineX(g),P=B.getBeatLineX(w),N=this.helpers.beamHelperLookup[r.voice.index].get(S.index),D=this.helpers.beamHelperLookup[r.voice.index].get(b.index),Q=this.getTupletBeamDirection(y),J=this.calculateBeamYWithDirection(N,_,Q),ge=this.calculateBeamYWithDirection(D,P,Q);m&&(J=Math.max(J,ge),ge=J),i.font=a.effectFont;let qt=i.measureText(h).width,Ti=3*this.scale,Kt=(_+P)/2,gi=Kt-qt/2-Ti,oi=Kt+qt/2+Ti,mi=(ge-J)/(P-_),W=J-mi*_,se=mi*gi+W,pe=mi*Kt+W,Me=mi*oi+W;Q===E.Down&&(d*=-1,p*=-1),i.beginPath(),i.moveTo(e+this.x+_,t+this.y+J-d|0),n?i.quadraticCurveTo(e+this.x+(gi+_)/2,t+this.y+se-d-p|0,e+this.x+gi,t+this.y+se-d-p|0):(i.lineTo(e+this.x+_,t+this.y+J-d-p|0),i.lineTo(e+this.x+gi,t+this.y+se-d-p|0)),i.stroke(),i.beginPath(),i.moveTo(e+this.x+oi,t+this.y+Me-d-p|0),n?i.quadraticCurveTo(e+this.x+(P+oi)/2,t+this.y+Me-d-p|0,e+this.x+P,t+this.y+ge-d|0):(i.lineTo(e+this.x+P,t+this.y+ge-d-p|0),i.lineTo(e+this.x+P,t+this.y+ge-d|0)),i.stroke(),i.fillText(h,e+this.x+Kt,t+this.y+pe-d-p)}i.textAlign=o,i.textBaseline=l}paintBeams(e,t,i){for(const r of this.helpers.beamHelpers)for(const n of r)this.paintBeamHelper(e+this.beatGlyphsStart,t,i,n)}drawBeamHelperAsFlags(e){return e.beats.length===1}paintBeamHelper(e,t,i,r){i.color=r.voice.index===0?this.resources.mainGlyphColor:this.resources.secondaryGlyphColor,r.isRestBeamHelper||(this.drawBeamHelperAsFlags(r)?this.paintFlag(e,t,i,r):this.paintBar(e,t,i,r))}shouldPaintFlag(e,t){return!(e.graceType===$.BendGrace||!t.hasBeatLineX(e)||e.graceType!==$.None&&this.settings.notation.notationMode===St.SongBook||e.duration===k.Whole||e.duration===k.DoubleWhole||e.duration===k.QuadrupleWhole)}paintFlag(e,t,i,r){for(const n of r.beats){if(!this.shouldPaintFlag(n,r))continue;let a=n.graceType!==$.None,o=a?ee.GraceScale:1,l=this.getFlagStemSize(r.shortestDuration),h=r.getBeatLineX(n),u=this.getBeamDirection(r),c=this.getFlagTopY(n,u),d=this.getFlagBottomY(n,u),p=0;if(u===E.Down?(d+=l*o,p=d):(c-=l*o,p=c),!!r.hasLine(!0,n)){if(this.paintBeamingStem(n,t+this.y,e+this.x+h,t+this.y+c,t+this.y+d,i),n.graceType===$.BeforeBeat){let g=15*this.scale,w=12*this.scale;i.beginPath(),u===E.Down?(i.moveTo(e+this.x+h-w/2,t+this.y+d-g),i.lineTo(e+this.x+h+w/2,t+this.y+d)):(i.moveTo(e+this.x+h-w/2,t+this.y+c+g),i.lineTo(e+this.x+h+w/2,t+this.y+c)),i.stroke()}if(r.hasFlag(!0,n)){let g=new ol(h-this.scale/2,p,n.duration,u,a);g.renderer=this,g.doLayout(),g.paint(e+this.x,t+this.y,i)}}}}getFlagStemSize(e){let t=0;switch(e){case k.QuadrupleWhole:case k.Half:case k.Quarter:case k.Eighth:case k.Sixteenth:case k.ThirtySecond:case k.SixtyFourth:case k.OneHundredTwentyEighth:case k.TwoHundredFiftySixth:t=3;break;default:t=0;break}return this.getLineHeight(t)}calculateBeamY(e,t){return this.calculateBeamYWithDirection(e,t,this.getBeamDirection(e))}createPreBeatGlyphs(){super.createPreBeatGlyphs(),this.bar.masterBar.isRepeatStart&&this.addPreBeatGlyph(new VT(0,0,1.5,3)),this.createLinePreBeatGlyphs(),this.addPreBeatGlyph(new zT(0,this.getLineHeight(-.25),this.bar.index+1))}createPostBeatGlyphs(){super.createPostBeatGlyphs(),this.bar.masterBar.isRepeatEnd?(this.addPostBeatGlyph(new HT(this.x,0)),this.bar.masterBar.repeatCount>2&&this.addPostBeatGlyph(new WT(0,this.getLineHeight(-.25),this.bar.masterBar.repeatCount))):this.addPostBeatGlyph(new Pu(0,0))}paintBar(e,t,i,r){for(let n=0,a=r.beats.length;n<a;n++){let o=r.beats[n];if(!r.hasBeatLineX(o))continue;let h=o.graceType!==$.None?ee.GraceScale:1,u=r.getBeatLineX(o),c=this.getBeamDirection(r),d=t+this.y+this.getBarLineStart(o,c),p=t+this.y+this.calculateBeamY(r,u);this.paintBeamingStem(o,t+this.y,e+this.x+u,d,p,i);let g=p;c===E.Down?g+=i.font.size*2:n!==0&&(g-=i.font.size*1.5);let w=6*this.scale*h,S=(Ge.BeamSpacing+Ge.BeamThickness)*this.scale*h,b=Ge.BeamThickness*this.scale*h,m=Re.getIndex(o.duration)-2,y=t+this.y;c===E.Down&&(S=-S,b=-b);for(let B=0;B<m;B++){let _=0,P=0,N=0,D=0,Q=y+B*S;if(n<r.beats.length-1){if(_s.isFullBarJoin(o,r.beats[n+1],B))_=u,P=r.getBeatLineX(r.beats[n+1]);else if(n===0||!_s.isFullBarJoin(r.beats[n-1],o,B))_=u,P=_+w;else continue;N=Q+this.calculateBeamY(r,_),D=Q+this.calculateBeamY(r,P),Xr.paintSingleBar(i,e+this.x+_,N,e+this.x+P,D,b)}else n>0&&!_s.isFullBarJoin(o,r.beats[n-1],B)&&(_=u-w,P=u,N=Q+this.calculateBeamY(r,_),D=Q+this.calculateBeamY(r,P),Xr.paintSingleBar(i,e+this.x+_,N,e+this.x+P,D,b))}}}static paintSingleBar(e,t,i,r,n,a){e.beginPath(),e.moveTo(t,i),e.lineTo(r,n),e.lineTo(r,n+a),e.lineTo(t,i+a),e.closePath(),e.fill()}}class Bs extends Xr{constructor(e,t){super(e,t),this.simpleWhammyOverflow=0,this.beatEffectsMinY=null,this.beatEffectsMaxY=null,this.accidentalHelper=new $e(this)}get lineSpacing(){return Ge.RawLineSpacing}get heightLineCount(){return 5}get drawnLineCount(){return this.bar.staff.standardNotationLineCount}registerBeatEffectOverflows(e,t){const i=this.beatEffectsMinY;(i==null||e<i)&&(this.beatEffectsMinY=e);const r=this.beatEffectsMaxY;(r==null||t>r)&&(this.beatEffectsMaxY=t)}getScoreY(e){return super.getLineY(e/2)}getScoreHeight(e){return super.getLineHeight(e/2)}doLayout(){if(super.doLayout(),!this.bar.isEmpty&&this.accidentalHelper.maxLineBeat){let e=this.getScoreY(-2),t=this.getScoreY(10),i=this.simpleWhammyOverflow;const r=this.beatEffectsMinY;if(r!==null){const u=e-r;u>0&&this.registerOverflowTop(u)}const n=this.beatEffectsMaxY;if(n!==null){const u=n-t;u>0&&this.registerOverflowBottom(u)}this.registerOverflowTop(i);let a=this.getScoreY(this.accidentalHelper.maxLine),o=this.helpers.getBeamingHelperForBeat(this.accidentalHelper.maxLineBeat);o.direction===E.Up&&(a-=this.getStemSize(o),o.hasTuplet&&(a-=this.tupletSize)),a<e&&this.registerOverflowTop(Math.abs(a)+i);let l=this.getScoreY(this.accidentalHelper.minLine),h=this.helpers.getBeamingHelperForBeat(this.accidentalHelper.minLineBeat);h.direction===E.Down&&(l+=this.getStemSize(h),h.hasTuplet&&(l+=this.tupletSize)),l>t&&this.registerOverflowBottom(Math.abs(l)-t)}}paint(e,t,i){super.paint(e,t,i),this.paintBeams(e,t,i),this.paintTuplets(e,t,i)}getSlashFlagY(e,t){let i=(this.heightLineCount-1)/2,r=0;switch(e){case k.QuadrupleWhole:case k.DoubleWhole:case k.Whole:r+=2;break;default:r+=1;break}return t==E.Down?i+=r:i-=r,this.getLineY(i)}getFlagTopY(e,t){return e.slashed?this.getSlashFlagY(e.duration,t):this.getScoreY(this.accidentalHelper.getMinLine(e))}getFlagBottomY(e,t){return e.slashed?this.getSlashFlagY(e.duration,t):this.getScoreY(this.accidentalHelper.getMaxLine(e))}getBeamDirection(e){return e.direction}getStemSize(e){let t=e.beats.length===1?this.getFlagStemSize(e.shortestDuration):this.getBarStemSize(e.shortestDuration);return e.isGrace&&(t=t*ee.GraceScale),t}getBarStemSize(e){let t=0;switch(e){case k.QuadrupleWhole:case k.Half:case k.Quarter:case k.Eighth:case k.Sixteenth:t=6;break;case k.ThirtySecond:t=8;break;case k.SixtyFourth:t=9;break;case k.OneHundredTwentyEighth:t=9;break;case k.TwoHundredFiftySixth:t=10;break;default:t=0;break}return this.getScoreHeight(t)}get middleYPosition(){return this.getScoreY(this.bar.staff.standardNotationLineCount-1)}getNoteY(e,t){if(e.beat.slashed){let r=(this.heightLineCount-1)/2;return this.getLineY(r)}let i=super.getNoteY(e,t);if(isNaN(i)){const r=$e.computeLineWithoutAccidentals(this.bar,e);i=this.getScoreY(r)}return i}applyLayoutingInfo(){const e=super.applyLayoutingInfo();if(e&&this.bar.isMultiVoice){let t=this.getScoreY(-2),i=this.getScoreY(10),r=this.helpers.collisionHelper.getBeatMinMaxY();r[0]<t&&this.registerOverflowTop(Math.abs(r[0])),r[1]>i&&this.registerOverflowBottom(Math.abs(r[1])-i)}return e}calculateBeamYWithDirection(e,t,i){let r=this.getStemSize(e);if(!e.drawingInfos.has(i)){let n=new Dv;e.drawingInfos.set(i,n);const a=e.beats[0],o=e.beats[e.beats.length-1],l=e.isRestBeamHelper;n.startBeat=a,n.startX=e.getBeatLineX(a),l?n.startY=i===E.Up?this.getScoreY(e.minRestLine):this.getScoreY(e.maxRestLine):n.startY=i===E.Up?this.getFlagTopY(a,i)-r:this.getFlagBottomY(a,i)+r,n.endBeat=o,n.endX=e.getBeatLineX(o),l?n.endY=i===E.Up?this.getScoreY(e.minRestLine):this.getScoreY(e.maxRestLine):n.endY=i===E.Up?this.getFlagTopY(o,i)-r:this.getFlagBottomY(o,i)+r;let h=10*this.scale;if(i===E.Down&&n.startY>n.endY&&n.startY-n.endY>h&&(n.endY=n.startY-h),i===E.Down&&n.endY>n.startY&&n.endY-n.startY>h&&(n.startY=n.endY-h),i===E.Up&&n.startY<n.endY&&n.endY-n.startY>h&&(n.endY=n.startY+h),i===E.Up&&n.endY<n.startY&&n.startY-n.endY>h&&(n.startY=n.endY+h),e.beats.length>1){if(i===E.Up){let u=this.getScoreY(this.accidentalHelper.getMinLine(e.beatOfHighestNote))-r;const d=n.calcY(e.getBeatLineX(e.beatOfHighestNote))-u;d>0&&(n.startY-=d,n.endY-=d)}else{let u=this.getScoreY(this.accidentalHelper.getMaxLine(e.beatOfLowestNote))+r;const c=n.calcY(e.getBeatLineX(e.beatOfLowestNote)),d=u-c;d>0&&(n.startY+=d,n.endY+=d)}if(e.minRestLine!==null||e.maxRestLine!==null){const u=Re.getIndex(e.shortestDuration)-2;let c=e.isGrace?ee.GraceScale:1,d=u*(Ge.BeamSpacing+Ge.BeamThickness)*this.scale*c;if(d+=Ge.BeamSpacing,i===E.Up&&e.minRestLine!==null){let p=this.getScoreY(e.minRestLine)-d;const w=n.calcY(e.getBeatLineX(e.beatOfMinRestLine))-p;w>0&&(n.startY-=w,n.endY-=w)}else if(i===E.Down&&e.maxRestLine!==null){let p=this.getScoreY(e.maxRestLine)+d;const g=n.calcY(e.getBeatLineX(e.beatOfMaxRestLine)),w=p-g;w>0&&(n.startY+=w,n.endY+=w)}}if(e.slashBeats.length>0)for(const u of e.slashBeats){const c=n.calcY(e.getBeatLineX(u));let d=this.getSlashFlagY(u.duration,i);i===E.Up?d-=r:i===E.Down&&(d+=r);const p=d-c;p>0&&(n.startY+=p,n.endY+=p)}}}return e.drawingInfos.get(i).calcY(t)}getBarLineStart(e,t){return e.slashed?this.getSlashFlagY(e.duration,t):t===E.Up?this.getScoreY(this.accidentalHelper.getMaxLine(e)):this.getScoreY(this.accidentalHelper.getMinLine(e))}createLinePreBeatGlyphs(){if(this.isFirstOfLine||this.bar.clef!==this.bar.previousBar.clef||this.bar.clefOttava!==this.bar.previousBar.clefOttava){let e=0;switch(this.bar.clef){case ie.Neutral:e=this.bar.staff.standardNotationLineCount-1;break;case ie.F4:e=2;break;case ie.C3:e=4;break;case ie.C4:e=2;break;case ie.G2:e=6;break}this.createStartSpacing(),this.addPreBeatGlyph(new pp(0,this.getScoreY(e)+.5*Ge.StaffLineThickness,this.bar.clef,this.bar.clefOttava))}(this.index===0&&this.bar.masterBar.keySignature!==fe.C||this.bar.previousBar&&this.bar.masterBar.keySignature!==this.bar.previousBar.masterBar.keySignature)&&(this.createStartSpacing(),this.createKeySignatureGlyphs()),(!this.bar.previousBar||this.bar.previousBar&&this.bar.masterBar.timeSignatureNumerator!==this.bar.previousBar.masterBar.timeSignatureNumerator||this.bar.previousBar&&this.bar.masterBar.timeSignatureDenominator!==this.bar.previousBar.masterBar.timeSignatureDenominator||this.bar.previousBar&&this.bar.masterBar.isFreeTime&&this.bar.masterBar.isFreeTime!==this.bar.previousBar.masterBar.isFreeTime)&&(this.createStartSpacing(),this.createTimeSignatureGlyphs())}createKeySignatureGlyphs(){let e=0,t=this.bar.masterBar.keySignature,i=this.bar.previousBar?this.bar.previousBar.masterBar.keySignature:0;switch(this.bar.clef){case ie.Neutral:e=0;break;case ie.G2:e=1;break;case ie.F4:e=3;break;case ie.C3:e=2;break;case ie.C4:e=0;break}let r=new Map,n=[];if(Re.keySignatureIsSharp(t))for(let l=0;l<Math.abs(t);l++){let h=Bs.SharpKsSteps[l]+e;n.push(new Xs(0,this.getScoreY(h),U.Sharp,1)),r.set(h,!0)}else for(let l=0;l<Math.abs(t);l++){let h=Bs.FlatKsSteps[l]+e;n.push(new Xs(0,this.getScoreY(h),U.Flat,1)),r.set(h,!0)}let a=Math.abs(i),o=Re.keySignatureIsSharp(i)?Bs.SharpKsSteps:Bs.FlatKsSteps;for(let l=0;l<a;l++){let h=o[l]+e;r.has(h)||this.addPreBeatGlyph(new Xs(0,this.getScoreY(o[l]+e),U.Natural,1))}for(let l of n)this.addPreBeatGlyph(l)}createTimeSignatureGlyphs(){this.addPreBeatGlyph(new Bt(0,0,5*this.scale));const e=this.bar.staff.standardNotationLineCount-1;this.addPreBeatGlyph(new wp(0,this.getScoreY(e),this.bar.masterBar.timeSignatureNumerator,this.bar.masterBar.timeSignatureDenominator,this.bar.masterBar.timeSignatureCommon,this.bar.masterBar.isFreeTime))}createVoiceGlyphs(e){for(const t of e.beats){let i=new OT(t,this.getVoiceContainer(e));i.preNotes=new DT,i.onNotes=new LT,this.addBeatGlyph(i)}}getNoteLine(e){return this.accidentalHelper.getNoteLine(e)}completeBeamingHelper(e){if(this.bar.isMultiVoice&&e.highestNoteInHelper&&e.lowestNoteInHelper){let t=this.getNoteY(e.highestNoteInHelper,H.Center),i=this.getNoteY(e.lowestNoteInHelper,H.Center),r=this.getStemSize(e);e.hasTuplet&&(r+=this.resources.effectFont.size*2),e.direction==E.Up?t-=r:i+=r;for(const n of e.beats)this.helpers.collisionHelper.reserveBeatSlot(n,t,i)}}paintBeamingStem(e,t,i,r,n,a){a.lineWidth=Ge.StemWidth*this.scale,a.beginPath(),a.moveTo(i,r),a.lineTo(i,n),a.stroke(),a.lineWidth=this.scale}}Bs.StaffId="score";Bs.SharpKsSteps=[-1,2,-2,1,4,0,3];Bs.FlatKsSteps=[3,0,4,1,5,2,6];class GT extends ll{get staffId(){return Bs.StaffId}getStaffPaddingTop(e){return e.system.layout.renderer.settings.display.notationStaffPaddingTop}getStaffPaddingBottom(e){return e.system.layout.renderer.settings.display.notationStaffPaddingBottom}create(e,t){return new Bs(e,t)}canCreate(e,t){return super.canCreate(e,t)&&t.showStandardNotation}constructor(){super()}}class UT extends qe{constructor(e,t,i,r){super(0,0),this._inType=e,this._outType=t,this._startNote=i,this._parent=r}doLayout(){this.width=0}paint(e,t,i){this.paintSlideIn(e,t,i),this.paintSlideOut(e,t,i)}paintSlideIn(e,t,i){let r=this.renderer,n=12*this.scale,a=3*this.scale,o=0,l=0,h=0,u=0;switch(this._inType){case vt.IntoFromBelow:h=e+r.x+r.getNoteX(this._startNote,Fe.Left),u=t+r.y+r.getNoteY(this._startNote,H.Center),o=h-n,l=t+r.y+r.getNoteY(this._startNote,H.Center)+a;break;case vt.IntoFromAbove:h=e+r.x+r.getNoteX(this._startNote,Fe.Left),u=t+r.y+r.getNoteY(this._startNote,H.Center),o=h-n,l=t+r.y+r.getNoteY(this._startNote,H.Center)-a;break;default:return}this.paintSlideLine(i,!1,o,h,l,u)}paintSlideOut(e,t,i){let r=this.renderer,n=12*this.scale,a=3*this.scale,o=0,l=0,h=0,u=0,c=!1;const d=2*this.scale;switch(this._outType){case ne.Shift:case ne.Legato:if(o=e+r.x+r.getBeatX(this._startNote.beat,ae.PostNotes),l=t+r.y+r.getNoteY(this._startNote,H.Center),this._startNote.slideTarget){let p=this.renderer.scoreRenderer.layout.getRendererForBar(this.renderer.staff.staveId,this._startNote.slideTarget.beat.voice.bar);!p||p.staff!==r.staff?(h=e+r.x+r.width,u=l):(h=e+p.x+p.getBeatX(this._startNote.slideTarget.beat,ae.OnNotes)-d,u=t+p.y+p.getNoteY(this._startNote.slideTarget,H.Center)),this._startNote.slideTarget.fret>this._startNote.fret?(l+=a,u-=a):(l-=a,u+=a)}else h=e+r.x+this._parent.x,u=l;break;case ne.OutUp:o=e+r.x+r.getNoteX(this._startNote,Fe.Right),l=t+r.y+r.getNoteY(this._startNote,H.Center),h=o+n-d,u=t+r.y+r.getNoteY(this._startNote,H.Center)-a;break;case ne.OutDown:o=e+r.x+r.getNoteX(this._startNote,Fe.Right),l=t+r.y+r.getNoteY(this._startNote,H.Center),h=o+n-d,u=t+r.y+r.getNoteY(this._startNote,H.Center)+a;break;case ne.PickSlideDown:o=e+r.x+r.getNoteX(this._startNote,Fe.Right),l=t+r.y+r.getNoteY(this._startNote,H.Center),h=e+r.x+r.getBeatX(this._startNote.beat,ae.EndBeat),u=l+a*3,c=!0;break;case ne.PickSlideUp:o=e+r.x+r.getNoteX(this._startNote,Fe.Right),l=t+r.y+r.getNoteY(this._startNote,H.Center),h=e+r.x+r.getBeatX(this._startNote.beat,ae.EndBeat),u=l-a*3,c=!0;break;default:return}this.paintSlideLine(i,c,o,h,l,u)}paintSlideLine(e,t,i,r,n,a){if(t){let o=new Tn(0,0,Be.Slight,1.2);o.renderer=this.renderer,o.doLayout(),n-=o.height/2,a-=o.height/2;let l=r-i,h=a-n,u=Math.sqrt(Math.pow(h,2)+Math.pow(l,2));o.width=l;let c=Math.asin(h/u)*(180/Math.PI);e.beginRotate(i,n,c),o.paint(0,0,e),e.endRotate()}else e.beginPath(),e.moveTo(i,n),e.lineTo(r,a),e.stroke()}}class cr extends pt{constructor(e,t,i=!1){super(e.beat,t.beat,i),this.startNote=e,this.endNote=t}getTieHeight(e,t,i,r){return this.startNote===this.endNote?15:super.getTieHeight(e,t,i,r)}getBeamDirection(e,t){return this.startNote===this.endNote?E.Up:cr.getBeamDirectionForNote(this.startNote)}static getBeamDirectionForNote(e){return e.string>3?E.Up:E.Down}getStartY(){return this.startNote===this.endNote?this.startNoteRenderer.getNoteY(this.startNote,H.Center):this.tieDirection===E.Up?this.startNoteRenderer.getNoteY(this.startNote,H.Top):this.startNoteRenderer.getNoteY(this.startNote,H.Bottom)}getEndY(){return this.getStartY()}getStartX(){return this.startNote===this.endNote?this.getEndX()-20*this.scale:this.startNoteRenderer.getNoteX(this.startNote,Fe.Center)}getEndX(){return this.startNote===this.endNote?this.endNoteRenderer.getNoteX(this.endNote,Fe.Left):this.endNoteRenderer.getNoteX(this.endNote,Fe.Center)}}class Km extends cr{constructor(e,t,i,r=!1){super(e,t,r),this._direction=cr.getBeamDirectionForNote(e),this._forSlide=i}getTieHeight(e,t,i,r){return Math.log(i-e+1)*this.renderer.settings.notation.slurHeight}tryExpand(e,t,i,r){if(this._forSlide!==i||this.forEnd!==r||this.startNote.beat.id!==e.beat.id||this.endNote.beat.id!==t.beat.id||this._direction!==cr.getBeamDirectionForNote(e))return!1;switch(this._direction){case E.Up:e.realValue>this.startNote.realValue&&(this.startNote=e,this.startBeat=e.beat),t.realValue>this.endNote.realValue&&(this.endNote=t,this.endBeat=t.beat);break;case E.Down:e.realValue<this.startNote.realValue&&(this.startNote=e,this.startBeat=e.beat),t.realValue<this.endNote.realValue&&(this.endNote=t,this.endBeat=t.beat);break}return!0}paint(e,t,i){let r=this.renderer.scoreRenderer.layout.getRendererForBar(this.renderer.staff.staveId,this.startBeat.voice.bar),n=this.getBeamDirection(this.startBeat,r),a="tab.slur."+this.startNote.beat.id+"."+this.endNote.beat.id+"."+n,o=this.renderer;o.staff.getSharedLayoutData(a,!1)||(o.staff.setSharedLayoutData(a,!0),super.paint(e,t,i))}}class $T extends Ui{constructor(e,t){super(e,t),this._bend=null,this._effectSlurs=[]}drawBeamHelperAsFlags(e){return e.hasFlag(this.renderer.drawBeamHelperAsFlags(e),this.beat)}doLayout(){this._effectSlurs=[],super.doLayout(),this._bend&&(this._bend.renderer=this.renderer,this._bend.doLayout(),this.updateWidth())}createTies(e){if(!e.isVisible)return;let t=this.renderer;if(e.isTieOrigin&&t.showTiedNotes&&e.tieDestination.isVisible){let i=new cr(e,e.tieDestination,!1);this.addTie(i)}if(e.isTieDestination&&t.showTiedNotes){let i=new cr(e.tieOrigin,e,!0);this.addTie(i)}if(e.isLeftHandTapped&&!e.isHammerPullDestination){let i=new cr(e,e,!1);this.addTie(i)}if(e.isEffectSlurOrigin&&e.effectSlurDestination){let i=!1;for(let r of this._effectSlurs)if(r.tryExpand(e,e.effectSlurDestination,!1,!1)){i=!0;break}if(!i){let r=new Km(e,e.effectSlurDestination,!1,!1);this._effectSlurs.push(r),this.addTie(r)}}if(e.isEffectSlurDestination&&e.effectSlurOrigin){let i=!1;for(let r of this._effectSlurs)if(r.tryExpand(e.effectSlurOrigin,e,!1,!0)){i=!0;break}if(!i){let r=new Km(e.effectSlurOrigin,e,!1,!0);this._effectSlurs.push(r),this.addTie(r)}}if(e.slideInType!==vt.None||e.slideOutType!==ne.None){let i=new UT(e.slideInType,e.slideOutType,e,this);this.addTie(i)}if(e.hasBend){if(!this._bend){const i=new ns;this._bend=i,i.renderer=this.renderer,this.addTie(i)}this._bend.addBends(e)}}}class YT extends qe{constructor(e,t,i){super(e,t),this._noteString=null,this._trillNoteString=null,this._trillNoteStringWidth=0,this.isEmpty=!1,this.noteStringWidth=0,this._note=i}doLayout(){let e=this._note,t=e.fret-e.beat.voice.bar.staff.transpositionPitch;if(e.harmonicType===X.Natural&&e.harmonicValue!==0&&(t=e.harmonicValue-e.beat.voice.bar.staff.transpositionPitch),e.isTieDestination)e.beat.index===0&&this.renderer.settings.notation.notationMode==St.GuitarPro||(e.bendType===G.Bend||e.bendType===G.BendRelease)&&this.renderer.settings.notation.isNotationElementVisible(K.TabNotesOnTiedBends)?this._noteString="("+(e.tieOrigin.fret-e.beat.voice.bar.staff.transpositionPitch).toString()+")":this._noteString="";else if(this._noteString=e.isDead?"x":t.toString(),e.isGhost)this._noteString="("+this._noteString+")";else if(e.harmonicType===X.Natural){let i=this._noteString.indexOf(".");i>=0&&(this._noteString=this._noteString.substr(0,i+2)),this._noteString="<"+this._noteString+">"}if(e.isTrill)this._trillNoteString="("+(e.trillFret-e.beat.voice.bar.staff.transpositionPitch).toString()+")";else if(Re.isAlmostEqualTo(e.harmonicValue,0))this._trillNoteString="";else switch(e.harmonicType){case X.Artificial:case X.Pinch:case X.Tap:case X.Semi:case X.Feedback:let i=(t+e.harmonicValue).toString(),r=i.indexOf(".");r>=0&&(i=i.substr(0,r+2)),this._trillNoteString="<"+i+">";break;default:this._trillNoteString="";break}this.isEmpty=!this._noteString,this.isEmpty||(this.renderer.scoreRenderer.canvas.font=this.renderer.resources.tablatureFont,this.noteStringWidth=this.renderer.scoreRenderer.canvas.measureText(this._noteString).width*this.scale,this.width=this.noteStringWidth,this.height=this.renderer.scoreRenderer.canvas.font.size,this._trillNoteString&&(this.renderer.scoreRenderer.canvas.font=this.renderer.resources.graceFont,this._trillNoteStringWidth=3*this.scale+this.renderer.scoreRenderer.canvas.measureText(this._trillNoteString).width,this.width+=this._trillNoteStringWidth))}paint(e,t,i){if(this.isEmpty)return;let r=this.noteStringWidth+this._trillNoteStringWidth,n=e+this.x+(this.width-r)/2,a=this.renderer.scoreRenderer.canvas.font;this.renderer.scoreRenderer.canvas.font=this.renderer.resources.graceFont,i.fillText(this._trillNoteString,n+this.noteStringWidth+3*this.scale,t+this.y),this.renderer.scoreRenderer.canvas.font=a,i.fillText(this._noteString,n,t+this.y)}buildBoundingsLookup(e,t,i){let r=new al;r.note=this._note,r.noteHeadBounds=new si,r.noteHeadBounds.x=t+this.x,r.noteHeadBounds.y=i+this.y-this.height/2,r.noteHeadBounds.w=this.width,r.noteHeadBounds.h=this.height,e.addNote(r)}}class XT extends qe{constructor(e,t,i){super(e,t),this._notes=[],this.minStringNote=null,this.beatEffects=new Map,this.notesPerString=new Map,this.noteStringWidth=0,this._isGrace=i}buildBoundingsLookup(e,t,i){for(const r of this._notes)r.buildBoundingsLookup(e,t+this.x,i+this.y)}getNoteX(e,t){if(this.notesPerString.has(e.string)){let i=this.notesPerString.get(e.string),r=this.x+i.x;switch(t){case Fe.Left:break;case Fe.Center:r+=i.noteStringWidth/2;break;case Fe.Right:r+=i.width;break}return r}return 0}getNoteY(e,t){if(this.notesPerString.has(e.string)){const i=this.notesPerString.get(e.string);let r=this.y+i.y;switch(t){case H.Top:case H.TopWithStem:r-=i.height/2+2*this.scale;break;case H.Center:break;case H.Bottom:case H.BottomWithStem:r+=i.height/2;break}return r}return 0}doLayout(){let e=0,t=0;for(let a=0,o=this._notes.length;a<o;a++){let l=this._notes[a];l.renderer=this.renderer,l.doLayout(),l.width>e&&(e=l.width),l.noteStringWidth>t&&(t=l.noteStringWidth)}this.noteStringWidth=t;let i=this.renderer.resources.tablatureFont.size,r=this.getNoteY(this.minStringNote,H.Center)+i/2,n=7*this.scale;for(const a of this.beatEffects.values())a.y+=r,a.x+=this.width/2,a.renderer=this.renderer,r+=n,a.doLayout();this.width=e}addNoteGlyph(e,t){this._notes.push(e),this.notesPerString.set(t.string,e),(!this.minStringNote||t.string<this.minStringNote.string)&&(this.minStringNote=t)}paint(e,t,i){e+=this.x,t+=this.y;let r=this.renderer.resources,n=i.textBaseline;i.textBaseline=te.Middle,i.font=this._isGrace?r.graceFont:r.tablatureFont;let a=this._notes,o=this.width;for(let l of a)l.renderer=this.renderer,l.width=o,l.paint(e,t,i);i.textBaseline=n;for(const l of this.beatEffects.values())l.paint(e,t,i)}updateBeamingHelper(e){this.beamingHelper&&this.beamingHelper.isPositionFrom("tab",this.beat)&&this.beamingHelper.registerBeatLineX("tab",this.beat,e+this.x+this.width/2,e+this.x+this.width/2)}}class QT extends ht{constructor(e,t,i,r){super(e,t,1,Nn.getSymbol(r)),this._isVisibleRest=i,this._duration=r}doLayout(){this._isVisibleRest?this.width=Nn.getSize(this._duration)*this.scale:this.width=10*this.scale}updateBeamingHelper(e){this.beamingHelper&&this.beamingHelper.isPositionFrom("tab",this.beat)&&this.beamingHelper.registerBeatLineX("tab",this.beat,e+this.x+this.width/2,e+this.x+this.width/2)}paint(e,t,i){this._isVisibleRest&&super.paint(e,t,i)}}class JT extends An{constructor(){super(...arguments),this.slash=null,this.noteNumbers=null,this.restGlyph=null}getNoteX(e,t){return this.noteNumbers?this.noteNumbers.getNoteX(e,t):0}getNoteY(e,t){return this.noteNumbers?this.noteNumbers.getNoteY(e,t):0}buildBoundingsLookup(e,t,i){this.noteNumbers&&this.noteNumbers.buildBoundingsLookup(e,t+this.x,i+this.y)}doLayout(){let e=this.renderer;if(this.container.beat.isRest){let i=Math.floor((this.renderer.bar.staff.tuning.length-1)/2),r=e.getTabY(i);const n=new QT(0,r,e.showRests,this.container.beat.duration);if(this.restGlyph=n,n.beat=this.container.beat,n.beamingHelper=this.beamingHelper,this.addGlyph(n),this.container.beat.dots>0&&e.showRests){this.addGlyph(new Bt(0,0,5*this.scale));for(let a=0;a<this.container.beat.dots;a++)this.addGlyph(new Qo(0,r,1.5*this.scale))}}else{let i=this.renderer.settings.notation.smallGraceTabNotes&&this.container.beat.graceType!==$.None,r;if(this.container.beat.slashed&&!this.container.beat.notes.some(n=>n.isTieDestination)){const n=Math.floor((this.renderer.bar.staff.tuning.length-1)/2),a=e.getLineY(n),o=new Rt(0,a,this.container.beat.duration,i);this.slash=o,o.beat=this.container.beat,o.beamingHelper=this.beamingHelper,this.addGlyph(o),r=o.beatEffects}else{const n=new XT(0,0,i);this.noteNumbers=n,n.beat=this.container.beat,n.beamingHelper=this.beamingHelper;for(let a of this.container.beat.notes)a.isVisible&&this.createNoteGlyph(a);this.addGlyph(n),r=n.beatEffects}if(this.container.beat.hasWhammyBar){let n=new Hi(this.container.beat);n.renderer=this.renderer,n.doLayout(),this.container.ties.push(n)}if(this.container.beat.isTremolo&&!r.has("tremolo")){let n=0,a=this.container.beat.tremoloSpeed,o=5*this.scale;switch(a){case k.ThirtySecond:n=10;break;case k.Sixteenth:n=5;break;case k.Eighth:n=0;break}this.container.beat.duration<k.Half&&(o=0),r.set("tremolo",new Nu(o,n*this.scale,a))}if(this.container.beat.dots>0&&e.settings.notation.rhythmMode!==ar.Hidden){this.addGlyph(new Bt(0,0,5*this.scale));for(let n=0;n<this.container.beat.dots;n++)this.addGlyph(new Qo(0,e.lineOffset*e.bar.staff.tuning.length+e.settings.notation.rhythmHeight*e.scale,1.5*this.scale))}}if(!this.glyphs)return;let t=0;for(let i=0,r=this.glyphs.length;i<r;i++){let n=this.glyphs[i];n.x=t,n.renderer=this.renderer,n.doLayout(),t+=n.width}this.width=t,this.computedWidth=t,this.container.beat.isEmpty?this.centerX=this.width/2:this.restGlyph?this.centerX=this.restGlyph.x+this.restGlyph.width/2:this.noteNumbers?this.centerX=this.noteNumbers.x+this.noteNumbers.noteStringWidth/2:this.slash&&(this.centerX=this.slash.x+this.slash.width/2)}updateBeamingHelper(){this.noteNumbers?this.noteNumbers.updateBeamingHelper(this.container.x+this.x):this.restGlyph?this.restGlyph.updateBeamingHelper(this.container.x+this.x):this.slash&&this.slash.updateBeamingHelper(this.container.x+this.x)}createNoteGlyph(e){let t=this.renderer,i=new YT(0,0,e),r=e.beat.voice.bar.staff.tuning.length-e.string;i.y=t.getTabY(r),i.renderer=this.renderer,i.doLayout(),this.noteNumbers.addNoteGlyph(i,e);let n=i.y-i.height/2,a=n+i.height;this.renderer.helpers.collisionHelper.reserveBeatSlot(this.container.beat,n,a)}}class qT extends qe{constructor(e){super(0,0),this._beat=e}doLayout(){this.width=10*this.scale}paint(e,t,i){let r=this.renderer,n=t+this.x+r.getNoteY(this._beat.maxStringNote,H.Top),a=t+this.y+r.getNoteY(this._beat.minStringNote,H.Bottom),o=e+this.x+this.width/2|0,l=8*this.scale;if(this._beat.brushType!==Ve.None){if(this._beat.brushType===Ve.BrushUp||this._beat.brushType===Ve.BrushDown)i.beginPath(),i.moveTo(o,n),i.lineTo(o,a),i.stroke();else if(this._beat.brushType===Ve.ArpeggioUp){let h=new Tn(0,0,Be.Slight,1.2,!0);h.renderer=this.renderer,h.doLayout();let u=n,c=a-l;h.width=Math.abs(c-u),i.beginRotate(e+this.x+4*this.scale,c,-90),h.paint(0,-h.height/2,i),i.endRotate()}else if(this._beat.brushType===Ve.ArpeggioDown){let h=new Tn(0,0,Be.Slight,1.2,!0);h.renderer=this.renderer,h.doLayout();let u=n+l,c=a;h.width=Math.abs(c-u),i.beginRotate(e+this.x+4*this.scale,u,90),h.paint(0,-h.height/2,i),i.endRotate()}this._beat.brushType===Ve.BrushUp||this._beat.brushType===Ve.ArpeggioUp?(i.beginPath(),i.moveTo(o,a),i.lineTo(o+l/2,a-l),i.lineTo(o-l/2,a-l),i.closePath(),i.fill()):(i.beginPath(),i.moveTo(o,n),i.lineTo(o+l/2,n+l),i.lineTo(o-l/2,n+l),i.closePath(),i.fill())}}}class KT extends Dn{doLayout(){this.container.beat.brushType!==Ve.None&&!this.container.beat.isRest&&(this.addGlyph(new qT(this.container.beat)),this.addGlyph(new Bt(0,0,4*this.scale))),super.doLayout()}constructor(){super()}}class jT extends qe{constructor(e,t){super(e,t)}doLayout(){this.width=28*this.scale}paint(e,t,i){let r=this.renderer.bar.staff.tuning.length,n=r<=4?f.FourStringTabClef:f.SixStringTabClef,a=r<=4?r/4.5:r/6.5;i.fillMusicFontSymbol(e+this.x+5*this.scale,t+this.y,a*this.scale,n,!1)}}class ZT extends lb{get commonScale(){return 1}get numberScale(){return this.renderer.bar.staff.tuning.length<=4?ee.GraceScale:1}}class Pn extends Xr{constructor(e,t){super(e,t),this._hasTuplets=!1,this.showTimeSignature=!1,this.showRests=!1,this.showTiedNotes=!1,t.staff.showStandardNotation||(this.showTimeSignature=!0,this.showRests=!0,this.showTiedNotes=!0)}get lineSpacing(){return Pn.TabLineSpacing}get heightLineCount(){return this.bar.staff.tuning.length}get drawnLineCount(){return this.bar.staff.tuning.length}getTabY(e){return super.getLineY(e)}getTabHeight(e){return super.getLineHeight(e)}collectSpaces(e){const t=this.scale;for(let i of this.bar.voices)if(this.hasVoiceContainer(i)){let r=this.getVoiceContainer(i);for(let n of r.beatGlyphs){let a=n.onNotes,o=a.noteNumbers;if(o)for(const[l,h]of o.notesPerString)h.isEmpty||e[this.bar.staff.tuning.length-l].push(new Float32Array([r.x+n.x+a.x+o.x,o.width+t]))}}}adjustSizes(){this.settings.notation.rhythmMode!==ar.Hidden&&(this.height+=this.settings.notation.rhythmHeight*this.settings.display.scale,this.bottomPadding+=this.settings.notation.rhythmHeight*this.settings.display.scale)}doLayout(){if(super.doLayout(),this.settings.notation.rhythmMode!==ar.Hidden){this._hasTuplets=!1;for(let e of this.bar.voices)if(this.hasVoiceContainer(e)&&this.getVoiceContainer(e).tupletGroups.length>0){this._hasTuplets=!0;break}this._hasTuplets&&this.registerOverflowBottom(this.tupletSize)}}createLinePreBeatGlyphs(){if(this.isFirstOfLine){let e=(this.bar.staff.tuning.length-1)/2;this.addPreBeatGlyph(new jT(5*this.scale,this.getTabY(e)))}this.showTimeSignature&&(!this.bar.previousBar||this.bar.previousBar&&this.bar.masterBar.timeSignatureNumerator!==this.bar.previousBar.masterBar.timeSignatureNumerator||this.bar.previousBar&&this.bar.masterBar.timeSignatureDenominator!==this.bar.previousBar.masterBar.timeSignatureDenominator||this.bar.previousBar&&this.bar.masterBar.isFreeTime&&this.bar.masterBar.isFreeTime!==this.bar.previousBar.masterBar.isFreeTime)&&(this.createStartSpacing(),this.createTimeSignatureGlyphs())}createTimeSignatureGlyphs(){this.addPreBeatGlyph(new Bt(0,0,5*this.scale));const e=(this.bar.staff.tuning.length+1)/2-1;this.addPreBeatGlyph(new ZT(0,this.getTabY(e),this.bar.masterBar.timeSignatureNumerator,this.bar.masterBar.timeSignatureDenominator,this.bar.masterBar.timeSignatureCommon,this.bar.masterBar.isFreeTime))}createVoiceGlyphs(e){for(const t of e.beats){let i=new $T(t,this.getVoiceContainer(e));i.preNotes=new KT,i.onNotes=new JT,this.addBeatGlyph(i)}}paint(e,t,i){super.paint(e,t,i),this.settings.notation.rhythmMode!==ar.Hidden&&(this.paintBeams(e,t,i),this.paintTuplets(e,t,i))}drawBeamHelperAsFlags(e){return super.drawBeamHelperAsFlags(e)||this.settings.notation.rhythmMode===ar.ShowWithBeams}getFlagTopY(e,t){const i=this.getOnNotesGlyphForBeat(e);return!i.noteNumbers||e.duration===k.Half?this.height-this.settings.notation.rhythmHeight*this.settings.display.scale-this.tupletSize:i.noteNumbers.getNoteY(i.noteNumbers.minStringNote,H.Bottom)}getFlagBottomY(e,t){return this.getFlagAndBarPos()}getFlagStemSize(e){return 0}getBarLineStart(e,t){let i=this.getOnNotesGlyphForBeat(e);return!i.noteNumbers||e.duration===k.Half?this.height-this.settings.notation.rhythmHeight*this.settings.display.scale-this.tupletSize:i.noteNumbers.getNoteY(i.noteNumbers.minStringNote,H.Bottom)+this.lineOffset/2}getBeamDirection(e){return E.Down}getFlagAndBarPos(){return this.height-(this._hasTuplets?this.tupletSize/2:0)}calculateBeamYWithDirection(e,t,i){return this.getFlagAndBarPos()}shouldPaintFlag(e,t){return!super.shouldPaintFlag(e,t)||e.graceType!==$.None?!1:this.drawBeamHelperAsFlags(t)}paintBeamingStem(e,t,i,r,n,a){if(n<r){const h=n;n=r,r=h}a.lineWidth=Ge.StemWidth*this.scale,a.beginPath();let o=[];this.helpers.collisionHelper.reservedLayoutAreasByDisplayTime.has(e.displayStart)&&(o=this.helpers.collisionHelper.reservedLayoutAreasByDisplayTime.get(e.displayStart).slots.slice(),o.sort((h,u)=>h.topY-u.topY));let l=n;for(;l>r;){a.moveTo(i,l);let h=r;if(o.length>0&&o[o.length-1].bottomY>h){const u=o.pop();h=t+u.bottomY,a.lineTo(i,h),l=t+u.topY}else{a.lineTo(i,h);break}}a.stroke(),a.lineWidth=this.scale}}Pn.StaffId="tab";Pn.TabLineSpacing=10;class Sc extends ll{get staffId(){return Pn.StaffId}getStaffPaddingTop(e){return e.system.layout.renderer.settings.display.notationStaffPaddingTop}getStaffPaddingBottom(e){return e.system.layout.renderer.settings.display.notationStaffPaddingBottom}constructor(){super(),this.showTimeSignature=null,this.showRests=null,this.showTiedNotes=null,this.hideOnPercussionTrack=!0}canCreate(e,t){return t.showTablature&&t.tuning.length>0&&super.canCreate(e,t)}create(e,t){let i=new Pn(e,t);return this.showRests!==null&&(i.showRests=this.showRests),this.showTimeSignature!==null&&(i.showTimeSignature=this.showTimeSignature),this.showTiedNotes!==null&&(i.showTiedNotes=this.showTiedNotes),i}}class Jo extends Ii{constructor(){super(0,0)}doLayout(){super.doLayout();const e=this.renderer.resources.effectFont;this.height=e.size+Jo.Padding*this.scale}paint(e,t,i){let r=this.renderer.resources;i.font=r.effectFont;let n=i.textAlign;i.textAlign=Y.Center,i.fillText("T",e+this.x,t+this.y+i.font.size/2),i.textAlign=n,i.strokeCircle(e+this.x,t+this.y+i.font.size/2+(Jo.Padding-1)*this.scale,i.font.size/1.6)}}Jo.Padding=4;class jm extends In{get notationElement(){return K.EffectTap}get sizingMode(){return we.SingleOnBeat}shouldCreateGlyphForNote(e){return e.isLeftHandTapped}createNewGlyph(e,t){return new Jo}}class Br{constructor(){this.noteRange=1,this.x=0,this.y=0}}var dn;(function(s){s[s.None=0]="None",s[s.Rectangle=1]="Rectangle",s[s.Ellipse=2]="Ellipse",s[s.Circle=3]="Circle"})(dn||(dn={}));class kc extends Br{constructor(){super(...arguments),this.align=Y.Left,this.frame=dn.None,this.text="",this.fontFace="",this.weight=0,this.height=0}}class Zm extends Br{constructor(){super(...arguments),this.chord=new $r}}class ey extends Br{}class ty extends Br{}class eN extends Br{constructor(){super(...arguments),this.number=0}}class iy extends Br{constructor(){super(...arguments),this.decrescendo=!1}}class _c extends Br{constructor(){super(...arguments),this.allNumbers=!1,this.firstNumber=0,this.lastNumber=0}}class tN extends Br{constructor(){super(...arguments),this.octave=1}}class iN extends Br{}class sN{constructor(){this.defaultClef=ie.G2,this.description="",this.percussion=!1,this.instrument=0,this.volume=0,this.transpose=0,this.index=0}}class rN{constructor(){this.from=0,this.to=0,this.curly=!1}}class nN{constructor(){this.currentBarIndex=-1,this.currentBarComplete=!0,this.currentBarDuration=0,this.currentPosition=0,this.voiceStemDir=null,this.repeatCount=0,this.repeatEnd=null}}class Ih{constructor(){this._trackChannel=0,this._beamingMode=ks.Auto,this._isFirstSystem=!0,this._staffLookup=new Map,this._brackets=[],this._staffLayoutLookup=new Map,this._staffLayouts=[],this._timeSignature=new mr,this._voiceStates=new Map}parseXml(e,t){this._galleryObjects=new Map,this._tieStarts=[],this._tieStartIds=new Map,this._voiceCounts=new Map,this._slurs=new Map,this._crescendo=new Map,this._isFirstSystem=!0;let i=new Mh;try{i.parse(e)}catch(r){throw new Ye("Could not parse XML",r)}this.parseDom(i),this.consolidate(),this.score.finish(t)}consolidate(){for(const e of this.score.tracks){const t=this._voiceCounts.get(e.index);for(const i of e.staves){for(;i.bars.length<this.score.masterBars.length;)this.addNewBar(i);for(const r of i.bars){for(;r.voices.length<t;)r.addVoice(new Js);for(const n of r.voices)if(n.beats.length===0){const a=new Wt;a.isEmpty=!0,n.addBeat(a)}}}}Ih.applyEffectRange(this._slurs,(e,t)=>{t.isLegatoOrigin=!0}),Ih.applyEffectRange(this._crescendo,(e,t)=>{t.crescendo=e.decrescendo?ki.Decrescendo:ki.Crescendo})}static applyEffectRange(e,t){for(const[i,r]of e){const n=r.noteRange;let a=i;for(let o=0;o<n;o++)if(t(r,a),a.index+1<a.voice.beats.length)a=a.voice.beats[a.index+1];else if(a.voice.bar.index+1<a.voice.bar.staff.bars.length)a=a.voice.bar.staff.bars[a.voice.bar.index+1].voices[a.voice.index].beats[0];else break}}parseDom(e){let t=e.firstElement;if(!t)throw new Ye("No valid XML");if(t.localName==="score"){this.score=new Rn,this.score.tempo=120;for(let i of t.childNodes)if(i.nodeType===L.Element)switch(i.localName){case"info":this.parseInfo(i);break;case"layout":this.parseLayout(i);break;case"gallery":this.parseGallery(i);break;case"pageObjects":this.parsePageObjects(i);break;case"systems":this.parseSystems(i);break}}else throw new Ye('Root node of XML was not "score"')}parseLayout(e){for(let n of e.childNodes)if(n.nodeType===L.Element)switch(n.localName){case"staves":this.parseLayoutStaves(n);break;case"brackets":this.parseBrackets(n);break}const t=this._brackets.filter(n=>!!n.curly);t.sort((n,a)=>n.from-a.from);let i=0,r=null;for(let n=0;n<this._staffLayouts.length;n++){const a=this._staffLayouts[n];for(;i<t.length&&n>t[i].to;)i++;r&&i<t.length&&n>t[i].from&&n<=t[i].to?r.ensureStaveCount(r.staves.length+1):(r=new Qs,r.ensureStaveCount(1),r.name=a.description,r.playbackInfo.volume=Math.floor(a.volume/128*16),r.playbackInfo.program=a.instrument,a.percussion?(r.playbackInfo.primaryChannel=9,r.playbackInfo.secondaryChannel=9):(r.playbackInfo.primaryChannel=this._trackChannel++,r.playbackInfo.secondaryChannel=this._trackChannel++),this.score.addTrack(r));const o=r.staves[r.staves.length-1];o.isPercussion=a.percussion,o.transpositionPitch=a.transpose,o.displayTranspositionPitch=0,o.showTablature=!1,this._staffLookup.set(a.index,o)}}parseBrackets(e){for(let t of e.childNodes)if(t.nodeType===L.Element)switch(t.localName){case"bracket":this.parseBracket(t);break}}parseBracket(e){const t=new rN;t.from=parseInt(e.getAttribute("from")),t.to=parseInt(e.getAttribute("to")),e.attributes.has("curly")&&(t.curly=e.attributes.get("curly")==="true"),this._brackets.push(t)}parseLayoutStaves(e){for(let t of e.childNodes)if(t.nodeType===L.Element)switch(t.localName){case"staffLayout":this.parseStaffLayout(t);break}}parseStaffLayout(e){const t=new sN;t.description=e.getAttribute("description");for(let i of e.childNodes)if(i.nodeType===L.Element)switch(i.localName){case"notation":i.attributes.has("defaultClef")&&(t.defaultClef=this.parseClef(i.attributes.get("defaultClef")));break;case"sound":i.attributes.has("percussion")&&(t.percussion=i.attributes.get("percussion")==="true"),i.attributes.has("instr")&&(t.instrument=parseInt(i.attributes.get("instr"))),i.attributes.has("volume")&&(t.volume=parseInt(i.attributes.get("volume"))),i.attributes.has("transpose")&&(t.transpose=parseInt(i.attributes.get("transpose")));break}this._staffLayoutLookup.set(t.description,t),t.index=this._staffLayouts.length,this._staffLayouts.push(t)}parseClef(e){switch(e){case"treble":return ie.G2;case"bass":return ie.F4;case"alto":return ie.C4;case"tenor":return ie.C4}return ie.G2}parseClefOttava(e){return e.endsWith("-")?Te._8vb:e.endsWith("+")?Te._8va:Te.Regular}parseSystems(e){for(let t of e.childNodes)if(t.nodeType===L.Element)switch(t.localName){case"system":this.parseSystem(t);break}}parseSystem(e){e.attributes.has("tempo")&&this.score.masterBars.length===0&&(this.score.tempo=parseInt(e.attributes.get("tempo"))),e.getAttribute("beamGrouping")==="0"&&(this._beamingMode=ks.ForceSplitToNext);for(let t of e.childNodes)if(t.nodeType===L.Element)switch(t.localName){case"staves":this.parseStaves(e,t);break}this._isFirstSystem=!1}parseStaves(e,t){let i=this.score.masterBars.length;for(let r of t.childNodes)if(r.nodeType===L.Element)switch(r.localName){case"staff":this.parseStaff(e,i,r);break}}parseStaff(e,t,i){const r=i.getAttribute("layout");this._currentStaffLayout=this._staffLayoutLookup.get(r),this._timeSignature.timeSignatureNumerator=4,this._timeSignature.timeSignatureDenominator=4,this._timeSignature.timeSignatureCommon=!1,this.parseTime(i.getAttribute("defaultTime"));const n=this._staffLookup.get(this._currentStaffLayout.index);for(;n.bars.length<t;)this.addNewBar(n);for(let a of i.childNodes)if(a.nodeType===L.Element)switch(a.localName){case"voices":this.parseVoices(r,n,e,t,a);break}}parseTime(e){switch(e){case"allaBreve":case"C":this._timeSignature.timeSignatureNumerator=2,this._timeSignature.timeSignatureDenominator=2,this._timeSignature.timeSignatureCommon=!0;break;case"longAllaBreve":this._timeSignature.timeSignatureNumerator=4,this._timeSignature.timeSignatureDenominator=4,this._timeSignature.timeSignatureCommon=!0;break;default:if(e.indexOf("/")>0){const t=e.split("/");this._timeSignature.timeSignatureNumerator=parseInt(t[0]),this._timeSignature.timeSignatureDenominator=parseInt(t[1]),this._timeSignature.timeSignatureCommon=!1}break}}parseVoices(e,t,i,r,n){let a=0;for(let o of n.childNodes)if(o.nodeType===L.Element)switch(o.localName){case"voice":this.parseVoice(e,t,i,a,r,o),a++;break}}getOrCreateBar(e,t){return t<e.bars.length?e.bars[t]:this.addNewBar(e)}addNewBar(e){let t=new Sr;if(e.bars.length>0?(t.clef=e.bars[e.bars.length-1].clef,t.clefOttava=e.bars[e.bars.length-1].clefOttava):t.clef=this._currentStaffLayout.defaultClef,e.addBar(t),e.bars.length>this.score.masterBars.length){let i=new mr;this.score.addMasterBar(i),i.index>0&&(i.keySignature=i.previousMasterBar.keySignature,i.keySignatureType=i.previousMasterBar.keySignatureType,i.tripletFeel=i.previousMasterBar.tripletFeel),i.timeSignatureDenominator=this._timeSignature.timeSignatureDenominator,i.timeSignatureNumerator=this._timeSignature.timeSignatureNumerator,i.timeSignatureCommon=this._timeSignature.timeSignatureCommon}return t}newBar(e,t){this._currentVoiceState.currentBarIndex++,this._currentBar=this.getOrCreateBar(e,this._currentVoiceState.currentBarIndex),this._currentVoiceState.currentBarDuration=this._currentBar.masterBar.calculateDuration(!1),this._currentVoiceState.currentBarComplete=!1,this._currentVoiceState.currentPosition=0,this.ensureVoice(e,t)}parseVoice(e,t,i,r,n,a){const o=e+"_"+r;if(this._currentVoiceState&&!this._currentVoiceState.currentBarComplete&&(this._currentBar.masterBar.isAnacrusis=!0),this._voiceStates.has(o)?(this._currentVoiceState=this._voiceStates.get(o),this._currentBar=this.getOrCreateBar(t,this._currentVoiceState.currentBarIndex),this.ensureVoice(t,r)):(this._currentVoiceState=new nN,this._currentVoiceState.currentBarIndex=n-1,this._voiceStates.set(o,this._currentVoiceState),this.newBar(t,r)),a.attributes.has("stemDir"))switch(a.attributes.get("stemDir")){case"up":this._currentVoiceState.voiceStemDir=E.Up;break;case"down":this._currentVoiceState.voiceStemDir=E.Down;break;default:this._currentVoiceState.voiceStemDir=null;break}else this._currentVoiceState.voiceStemDir=null;const l=a.findChildElement("noteObjects");if(i.attributes.has("tempo")){const h=new Vt;h.isLinear=!0,h.type=gt.Tempo,h.value=parseInt(i.attributes.get("tempo")),h.ratioPosition=this._currentVoiceState.currentPosition/this._currentVoiceState.currentBarDuration,this._currentBar.masterBar.tempoAutomations.push(h)}if(l){for(let h of l.childNodes)if(h.nodeType===L.Element)switch(this._currentVoiceState.currentBarComplete&&h.localName!=="barline"&&this.newBar(t,r),h.localName){case"clefSign":this._currentBar.clef=this.parseClef(h.getAttribute("clef")),this._currentBar.clefOttava=this.parseClefOttava(h.getAttribute("clef"));break;case"keySign":this._currentBar.masterBar.keySignature=parseInt(h.getAttribute("fifths"));break;case"timeSign":this.parseTime(h.getAttribute("time")),this._currentBar.masterBar.timeSignatureDenominator=this._timeSignature.timeSignatureDenominator,this._currentBar.masterBar.timeSignatureNumerator=this._timeSignature.timeSignatureNumerator,this._currentBar.masterBar.timeSignatureCommon=this._timeSignature.timeSignatureCommon,this._currentVoiceState.currentPosition=0,this._currentVoiceState.currentBarDuration=this._currentBar.masterBar.calculateDuration(!1);break;case"barline":switch(h.getAttribute("type")){case"double":this._currentBar.masterBar.isDoubleBar=!0,this._currentVoiceState.currentBarComplete||(this._currentBar.masterBar.isAnacrusis=!0),this._currentVoiceState.currentBarComplete=!0;break;case"end":this._currentVoiceState.currentBarComplete||(this._currentBar.masterBar.isAnacrusis=!0);break;case"repEnd":this._currentVoiceState.repeatEnd=this._currentBar.masterBar,this._currentBar.masterBar.repeatCount<this._currentVoiceState.repeatCount&&(this._currentBar.masterBar.repeatCount=this._currentVoiceState.repeatCount),this.parseBarDrawObject(h),this._currentVoiceState.currentBarComplete||(this._currentBar.masterBar.isAnacrusis=!0),this._currentVoiceState.currentBarComplete=!0;break;case"repBegin":this.newBar(t,r),this._currentBar.masterBar.isRepeatStart=!0,this._currentVoiceState.repeatEnd=null,this._currentVoiceState.repeatCount=0;break;case"repEndBegin":this._currentVoiceState.repeatEnd=this._currentBar.masterBar,this._currentBar.masterBar.repeatCount<this._currentVoiceState.repeatCount&&(this._currentBar.masterBar.repeatCount=this._currentVoiceState.repeatCount),this.parseBarDrawObject(h),this.newBar(t,r),this._currentBar.masterBar.isRepeatStart=!0;break;case"dashed":this._currentVoiceState.currentBarComplete||(this._currentBar.masterBar.isAnacrusis=!0),this._currentVoiceState.currentBarComplete=!0;break;default:this._currentVoiceState.currentBarComplete||(this._currentBar.masterBar.isAnacrusis=!0),this._currentVoiceState.currentBarComplete=!0;break}break;case"chord":let u=new Wt;this.initFromPreviousBeat(u,this._currentVoice),u.beamingMode=this._beamingMode,this._currentVoiceState.voiceStemDir&&(u.preferredBeamDirection=this._currentVoiceState.voiceStemDir),this.parseDuration(this._currentBar,u,h.findChildElement("duration")),u.updateDurations(),this._currentVoiceState.currentPosition+=u.playbackDuration,this._currentVoice.addBeat(u),this.parseChord(u,h),this._currentVoiceState.currentPosition>=this._currentVoiceState.currentBarDuration&&(this._currentVoiceState.currentBarComplete=!0);break;case"rest":const c=this.parseRestDurations(this._currentBar,h.findChildElement("duration"));c&&(this.initFromPreviousBeat(c,this._currentVoice),c.updateDurations(),this._currentVoiceState.currentPosition+=c.playbackDuration,this._currentVoice.addBeat(c),this._currentVoiceState.currentPosition>=this._currentVoiceState.currentBarDuration&&(this._currentVoiceState.currentBarComplete=!0));break}}}initFromPreviousBeat(e,t){let i=this.getLastBeat(t);i&&(e.dynamics=i.dynamics)}getLastBeat(e){if(e.beats.length>0)return e.beats[e.beats.length-1];if(e.bar.index>0){const t=e.bar.staff.bars[e.bar.index-1];if(e.index<t.voices.length){const i=t.voices[e.index];return this.getLastBeat(i)}}return null}ensureVoice(e,t){for(;this._currentBar.voices.length<t+1;)this._currentBar.addVoice(new Js);(!this._voiceCounts.has(e.track.index)||this._voiceCounts.get(e.track.index)<this._currentBar.voices.length)&&this._voiceCounts.set(e.track.index,this._currentBar.voices.length),this._currentVoice=this._currentBar.voices[t]}parseChord(e,t){const i=new je;for(let r of t.childNodes)if(r.nodeType===L.Element)switch(r.localName){case"stem":switch(r.getAttribute("dir")){case"up":e.preferredBeamDirection=E.Up;break;case"down":e.preferredBeamDirection=E.Down;break}break;case"articulation":switch(r.getAttribute("type")){case"staccato":i.isStaccato=!0;break;case"normalAccent":i.accentuated=et.Normal;break;case"strongAccent":i.accentuated=et.Heavy;break}break;case"lyric":this.parseLyric(e,r);break;case"drawObjects":this.parseBeatDrawObject(e,r);break;case"heads":this.parseHeads(e,i,r);break;case"beam":switch(r.getAttribute("group")){case"force":e.beamingMode=ks.ForceMergeWithNext;break;case"divide":e.beamingMode=ks.ForceSplitToNext;break}break}}parseHeads(e,t,i){for(let r of i.childNodes)if(r.nodeType===L.Element)switch(r.localName){case"head":this.parseHead(e,t,r);break}}parseHead(e,t,i){const r=new je,n=Re.parseTuning(i.getAttribute("pitch"));r.octave=n.octave-1,r.tone=n.noteValue,r.isStaccato=t.isStaccato,r.accentuated=t.accentuated,e.addNote(r);for(let a of i.childNodes)if(a.nodeType===L.Element)switch(a.localName){case"alter":a.attributes.has("step")&&(r.tone+=parseInt(a.attributes.get("step")));break;case"tie":a.attributes.has("begin")?this._tieStartIds.has(r.id)||(this._tieStartIds.set(r.id,!0),this._tieStarts.push(r)):a.attributes.has("end")&&this._tieStarts.length>0&&!r.isTieDestination&&(r.isTieDestination=!0,r.tieOrigin=this._tieStarts[0],this._tieStarts.splice(0,1),this._tieStartIds.delete(r.id));break}}parseBeatDrawObject(e,t){for(let i of t.childNodes)if(i.nodeType===L.Element)switch(i.localName){case"drawObj":const r=this.parseDrawObj(i);if(r){if(r instanceof kc)r.fontFace.startsWith("capella")?r.text==="u"?(e.fermata=new ep,e.fermata.type=Ts.Medium):r.text==="f"?e.dynamics=de.F:r.text==="j"&&(e.dynamics=de.MF):this._isFirstSystem&&this.score.title===""&&r.align===Y.Center&&r.height>16&&r.weight>400?this.score.title=r.text:this._isFirstSystem&&this.score.artist===""&&r.align===Y.Center&&r.y<0?this.score.artist=r.text:this._isFirstSystem&&this.score.music===""&&r.align===Y.Right&&r.y<0?this.score.music=r.text:r.text.startsWith("by capella")||(e.text=r.text);else if(!(r instanceof Zm))if(r instanceof ty)e.vibrato=Be.Slight;else if(r instanceof iy)e.crescendo=r.decrescendo?ki.Decrescendo:ki.Crescendo,r.noteRange++,this._crescendo.set(e,r);else if(r instanceof ey){const n=r;this._slurs.set(e,n)}else r instanceof _c&&this.applyVolta(r)}break}}parseBarDrawObject(e){for(let t of e.childNodes)if(t.nodeType===L.Element)switch(t.localName){case"drawObj":const i=this.parseDrawObj(t);i&&i instanceof _c&&this.applyVolta(i);break}}applyVolta(e){if(e.lastNumber>0?(this._currentVoiceState.repeatCount=e.lastNumber,this._currentVoiceState.repeatEnd&&this._currentVoiceState.repeatEnd.repeatCount<this._currentVoiceState.repeatCount&&(this._currentVoiceState.repeatEnd.repeatCount=this._currentVoiceState.repeatCount)):e.firstNumber>0&&(this._currentVoiceState.repeatCount=e.firstNumber,this._currentVoiceState.repeatEnd&&this._currentVoiceState.repeatEnd.repeatCount<this._currentVoiceState.repeatCount&&(this._currentVoiceState.repeatEnd.repeatCount=this._currentVoiceState.repeatCount)),e.lastNumber>0&&e.firstNumber>0){let t=0;for(let i=e.firstNumber;i<=e.lastNumber;i++)t=t|1<<i-1;this._currentBar.masterBar.alternateEndings=t}else e.lastNumber>0?this._currentBar.masterBar.alternateEndings=1<<e.lastNumber-1:e.firstNumber>0&&(this._currentBar.masterBar.alternateEndings=1<<e.firstNumber-1)}parseLyric(e,t){for(let i of t.childNodes)if(i.nodeType===L.Element)switch(i.localName){case"verse":e.lyrics||(e.lyrics=[]);let r=i.innerText;i.getAttribute("hyphen")==="true"&&(r+="-"),e.lyrics.push(r);break}}parseRestDurations(e,t){const i=t.getAttribute("base");if(i.indexOf("/")!==-1){let n=new Wt;return n.beamingMode=this._beamingMode,this.parseDuration(e,n,t),n}if(parseInt(i)===1){let n=new Wt;return n.beamingMode=this._beamingMode,n.duration=k.Whole,n}else return C.warning("Importer","Multi-Bar rests are not supported"),null}parseDurationValue(e){switch(e){case"2/1":return k.DoubleWhole;case"1/1":return k.Whole;case"1/2":return k.Half;case"1/4":return k.Quarter;case"1/8":return k.Eighth;case"1/16":return k.Sixteenth;case"1/32":return k.ThirtySecond;case"1/64":return k.SixtyFourth;case"1/128":return k.OneHundredTwentyEighth;default:return C.warning("Importer","Unsupported duration"),k.Quarter}}parseDuration(e,t,i){const r=i.getAttribute("base");t.duration=this.parseDurationValue(r),i.attributes.has("dots")&&(t.dots=parseInt(i.attributes.get("dots")));const n=i.findChildElement("tuplet");if(n){t.tupletNumerator=parseInt(n.getAttribute("count"));const a=n.getAttribute("tripartite")==="true"?3:1,o=n.getAttribute("prolong")==="true"?0:1;let l=0;for(;a*Math.pow(2,l+o)<t.tupletNumerator;)l++;t.tupletDenominator=a*Math.pow(2,l)}}parsePageObjects(e){for(let t of e.childNodes)if(t.nodeType===L.Element)switch(t.localName){case"drawObj":const i=this.parseDrawObj(t);if(i&&i instanceof kc)switch(i.align){case Y.Center:this.score.title?this.score.subTitle||(this.score.subTitle=t.innerText):this.score.title=t.innerText;break;case Y.Right:this.score.artist||(this.score.artist=t.innerText);break}break}}parseGallery(e){for(let t of e.childNodes)if(t.nodeType===L.Element)switch(t.localName){case"drawObj":const i=this.parseDrawObj(t);i&&this._galleryObjects.set(t.getAttribute("name"),i);break}}parseDrawObj(e){let t=null,i=1;for(let r of e.childNodes)if(r.nodeType===L.Element)switch(r.localName){case"text":t=this.parseText(r);break;case"guitar":t=this.parseGuitar(r);break;case"slur":t=this.parseSlur(r);break;case"wavyLine":t=this.parseWavyLine(r);break;case"bracket":t=this.parseTupletBracket(r);break;case"wedge":t=this.parseWedge(r);break;case"volta":t=this.parseVolta(r);break;case"octaveClef":t=this.parseOctaveClef(r);break;case"trill":t=this.parseTrill(r);break;case"basic":r.attributes.has("noteRange")&&(i=parseInt(r.attributes.get("noteRange")));break}return t&&(t.noteRange=i),t}parseTrill(e){return new iN}parseOctaveClef(e){const t=new tN;return e.attributes.has("octave")&&(t.octave=parseInt(e.attributes.get("octave"))),t}parseVolta(e){const t=new _c;return t.allNumbers=e.attributes.get("allNumbers")==="true",e.attributes.has("firstNumber")&&(t.firstNumber=parseInt(e.attributes.get("firstNumber"))),e.attributes.has("lastNumber")&&(t.lastNumber=parseInt(e.attributes.get("lastNumber"))),t}parseWedge(e){const t=new iy;return t.decrescendo=e.attributes.get("decrescendo")==="true",t}parseTupletBracket(e){const t=new eN;return e.attributes.has("number")&&(t.number=parseInt(e.attributes.get("number"))),t}parseWavyLine(e){return new ty}parseSlur(e){return new ey}parseGuitar(e){const t=new Zm,i=e.innerText.trim();for(let r=0;r<i.length;r++)i.charAt(r)==="/"?t.chord.strings.push(0):t.chord.strings.push(parseInt(i.charAt(r)));return t}parseText(e){const t=new kc;switch(e.attributes.has("x")&&(t.x=parseFloat(e.attributes.get("x"))),e.attributes.has("x")&&(t.y=parseFloat(e.attributes.get("y"))),e.getAttribute("align")){case"left":t.align=Y.Left;break;case"center":t.align=Y.Center;break;case"right":t.align=Y.Right;break}switch(e.getAttribute("frame")){case"rectangle":t.frame=dn.Rectangle;break;case"ellipse":t.frame=dn.Ellipse;break;case"circle":t.frame=dn.Circle;break;case"none":t.frame=dn.None;break}if(e.firstElement){for(let i of e.childNodes)if(i.nodeType===L.Element)switch(i.localName){case"font":t.fontFace=i.getAttribute("face"),i.attributes.has("weight")&&(t.weight=parseInt(i.attributes.get("weight"))),i.attributes.has("height")&&(t.height=parseInt(i.attributes.get("height")));break;case"content":t.text=i.innerText;break}}else t.text=e.innerText;return t}parseInfo(e){for(let t of e.childNodes)if(t.nodeType===L.Element)switch(t.localName){case"author":this.score.tab=t.firstChild.innerText;break;case"comment":this.score.notices=t.firstChild.innerText;break}}}class aN extends Ma{get name(){return"Capella"}constructor(){super()}readScore(){C.debug(this.name,"Loading ZIP entries");let e=new sp(this.data),t,i=null;if(t=e.read(),C.debug(this.name,"Zip entries loaded"),t.length>0)for(let r of t)switch(r.fileName){case"score.xml":i=v.toString(r.data,this.settings.importer.encoding);break}else this.data.reset(),i=v.toString(this.data.readAll(),this.settings.importer.encoding);if(!i)throw new Ye("No valid capella file");C.debug(this.name,"Start Parsing score.xml");try{let r=new Ih;return r.parseXml(i,this.settings),C.debug(this.name,"score.xml parsed"),r.score}catch(r){throw new Ye("Failed to parse CapXML",r)}}}class oN{constructor(e){this._targets=new Set,this._callback=e,window.addEventListener("resize",this.onWindowResize.bind(this),!1)}observe(e){this._targets.add(e)}unobserve(e){this._targets.delete(e)}disconnect(){this._targets.clear()}onWindowResize(){const e=[];for(const t of this._targets)e.push({target:t,contentRect:void 0,borderBoxSize:void 0,contentBoxSize:[],devicePixelContentBoxSize:[]});this._callback(e,this)}}class lN{constructor(e){this._elements=[];let t=null;const i=this._check.bind(this);this._check=()=>{t||(t=setTimeout(()=>{i(),t=null},100))},this._callback=e,window.addEventListener("resize",this._check,!0),document.addEventListener("scroll",this._check,!0)}observe(e){this._elements.indexOf(e)>=0||(this._elements.push(e),this._check())}unobserve(e){this._elements=this._elements.filter(t=>t!=e)}_check(){const e=[];this._elements.forEach(t=>{const i=t.getBoundingClientRect();i.top+i.height>=0&&i.top<=window.innerHeight&&i.left+i.width>=0&&i.left<=window.innerWidth&&e.push({target:t,isIntersecting:!0})}),e.length&&this._callback(e,this)}}function sy(s,e,t){if(e!=null){if(typeof e!="object"&&typeof e!="function")throw new TypeError("Object expected.");var i,r;if(i===void 0){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");i=e[Symbol.dispose]}if(typeof i!="function")throw new TypeError("Object not disposable.");r&&(i=function(){try{r.call(this)}catch(n){return Promise.reject(n)}}),s.stack.push({value:e,dispose:i,async:t})}return e}var hN=typeof SuppressedError=="function"?SuppressedError:function(s,e,t){var i=new Error(t);return i.name="SuppressedError",i.error=s,i.suppressed=e,i};function ry(s){function e(n){s.error=s.hasError?new hN(n,s.error,"An error was suppressed during disposal."):n,s.hasError=!0}var t,i=0;function r(){for(;t=s.stack.pop();)try{if(!t.async&&i===1)return i=0,s.stack.push(t),Promise.resolve().then(r);if(t.dispose){var n=t.dispose.call(t.value);if(t.async)return i|=2,Promise.resolve(n).then(r,function(a){return e(a),r()})}else i|=1}catch(a){e(a)}if(i===1)return s.hasError?Promise.reject(s.error):Promise.resolve();if(s.hasError)throw s.error}return r()}class Oe{static enable(e,t){Oe.alphaSkia=t,Oe.initializeMusicFont(Oe.alphaSkia.AlphaSkiaTypeface.register(e))}static initializeMusicFont(e){Oe.musicFont=e}static registerFont(e,t){const i=Oe.alphaSkia.AlphaSkiaTypeface.register(e.buffer);t||(t=he.withFamilyList([i.familyName],12,i.isItalic?Ue.Italic:Ue.Plain,i.isBold?Ci.Bold:Ci.Regular));for(const r of t.families)this.customTypeFaces.set(Oe.customTypefaceKey(r,t.isBold,t.isItalic),i);return t}static customTypefaceKey(e,t,i){return e.toLowerCase()+"_"+t+"_"+i}getTypeFace(){if(this._typeFaceCache!=this.font.toCssString(this.settings.display.scale)){if(this._typeFaceIsSystem){const t={stack:[],error:void 0,hasError:!1};try{const i=sy(t,this._typeFace,!1)}catch(i){t.error=i,t.hasError=!0}finally{ry(t)}}for(const t of this.font.families){var e=Oe.customTypefaceKey(t,this.font.isBold,this.font.isItalic);Oe.customTypeFaces.has(e)?(this._typeFaceIsSystem=!1,this._typeFace=Oe.customTypeFaces.get(e)):(this._typeFaceIsSystem=!0,this._typeFace=Oe.alphaSkia.AlphaSkiaTypeface.create(t,this.font.isBold,this.font.isItalic))}this._typeFaceCache=this.font.toCssString(this.settings.display.scale)}return this._typeFace}constructor(){this._color=new Ce(0,0,0,0),this._lineWidth=0,this._typeFaceCache="",this._typeFaceIsSystem=!1,this._typeFace=null,this.font=new he("Arial",10,Ue.Plain),this.textAlign=Y.Left,this.textBaseline=te.Top,this._canvas=new Oe.alphaSkia.AlphaSkiaCanvas,this.color=new Ce(0,0,0,255)}destroy(){const e={stack:[],error:void 0,hasError:!1};try{const t=sy(e,this._canvas,!1)}catch(t){e.error=t,e.hasError=!0}finally{ry(e)}}onRenderFinished(){return null}beginRender(e,t){this._canvas.beginRender(e,t,T.HighDpiFactor)}endRender(){return this._canvas.endRender()}get color(){return this._color}set color(e){this._color.rgba!==e.rgba&&(this._color=e,this._canvas.color=Oe.alphaSkia.AlphaSkiaCanvas.rgbaToColor(e.r,e.g,e.b,e.a))}get lineWidth(){return this._lineWidth}set lineWidth(e){this._lineWidth=e,this._canvas.lineWidth=e}fillRect(e,t,i,r){i>0&&this._canvas.fillRect(e|0,t|0,i,r)}strokeRect(e,t,i,r){this._canvas.strokeRect(e|0,t|0,i,r)}beginPath(){this._canvas.beginPath()}closePath(){this._canvas.closePath()}moveTo(e,t){this._canvas.moveTo(e,t)}lineTo(e,t){this._canvas.lineTo(e,t)}quadraticCurveTo(e,t,i,r){this._canvas.quadraticCurveTo(e,t,i,r)}bezierCurveTo(e,t,i,r,n,a){this._canvas.bezierCurveTo(e,t,i,r,n,a)}fillCircle(e,t,i){this._canvas.fillCircle(e,t,i)}strokeCircle(e,t,i){this._canvas.strokeCircle(e,t,i)}fill(){this._canvas.fill()}stroke(){this._canvas.stroke()}beginGroup(e){}endGroup(){}fillText(e,t,i){if(e.length==0)return;let r=Oe.alphaSkia.AlphaSkiaTextAlign.Left;switch(this.textAlign){case Y.Left:r=Oe.alphaSkia.AlphaSkiaTextAlign.Left;break;case Y.Center:r=Oe.alphaSkia.AlphaSkiaTextAlign.Center;break;case Y.Right:r=Oe.alphaSkia.AlphaSkiaTextAlign.Right;break}let n=Oe.alphaSkia.AlphaSkiaTextBaseline.Top;switch(this.textBaseline){case te.Top:n=Oe.alphaSkia.AlphaSkiaTextBaseline.Top;break;case te.Middle:n=Oe.alphaSkia.AlphaSkiaTextBaseline.Middle;break;case te.Bottom:n=Oe.alphaSkia.AlphaSkiaTextBaseline.Bottom;break}this._canvas.fillText(e,this.getTypeFace(),this.font.size*this.settings.display.scale,t,i,r,n)}measureText(e){return new Bu(this._canvas.measureText(e,this.getTypeFace(),this.font.size*this.settings.display.scale),this.font.size*Oe.FontSizeToLineHeight)}fillMusicFontSymbol(e,t,i,r,n){r!==f.None&&this.fillMusicFontSymbolText(e,t,i,String.fromCharCode(r),n)}fillMusicFontSymbols(e,t,i,r,n){let a="";for(let o of r)o!==f.None&&(a+=String.fromCharCode(o));this.fillMusicFontSymbolText(e,t,i,a,n)}fillMusicFontSymbolText(e,t,i,r,n){this._canvas.fillText(r,Oe.musicFont,T.MusicFontSize*this.settings.display.scale*i,e,t,n?Oe.alphaSkia.AlphaSkiaTextAlign.Center:Oe.alphaSkia.AlphaSkiaTextAlign.Left,Oe.alphaSkia.AlphaSkiaTextBaseline.Alphabetic)}beginRotate(e,t,i){this._canvas.beginRotate(e,t,i)}endRotate(){this._canvas.endRotate()}}Oe.musicFont=null;Oe.customTypeFaces=new Map;Oe.FontSizeToLineHeight=1.2;class ny extends pt{constructor(e,t,i=!1){super(e.beat,t.beat,i),this.startNote=e,this.endNote=t}getTieHeight(e,t,i,r){return this.startNote===this.endNote?15:super.getTieHeight(e,t,i,r)}getBeamDirection(e,t){return E.Down}static getBeamDirectionForNote(e){return E.Down}getStartY(){return this.startNoteRenderer.getNoteY(this.startNote,H.Center)}getEndY(){return this.getStartY()}getStartX(){return this.startNote===this.endNote?this.getEndX()-20*this.scale:this.startNoteRenderer.getNoteX(this.startNote,Fe.Right)}getEndX(){return this.endNoteRenderer.getNoteX(this.endNote,Fe.Left)}}class uN extends Ui{constructor(e,t){super(e,t),this._tiedNoteTie=null}createTies(e){if(e.isVisible){if(!this._tiedNoteTie&&e.isTieOrigin&&e.tieDestination.isVisible){let t=new ny(e,e.tieDestination,!1);this._tiedNoteTie=t,this.addTie(t)}if(!this._tiedNoteTie&&e.isTieDestination){let t=new ny(e.tieOrigin,e,!0);this._tiedNoteTie=t,this.addTie(t)}}}}class cN extends Nn{constructor(e,t,i){super(e,t,i)}updateBeamingHelper(e){this.beamingHelper&&this.beamingHelper.registerBeatLineX("slash",this.beat,e+this.x+this.width/2,e+this.x+this.width/2)}}class dN extends An{constructor(){super(...arguments),this.noteHeads=null,this.restGlyph=null}getNoteX(e,t){if(this.noteHeads){let i=this.noteHeads.x;switch(t){case Fe.Left:break;case Fe.Center:i+=this.noteHeads.width/2;break;case Fe.Right:i+=this.noteHeads.width;break}return i}return 0}buildBoundingsLookup(e,t,i){if(this.noteHeads&&this.container.beat.notes.length>0){const r=new al;r.note=this.container.beat.notes[0],r.noteHeadBounds=new si,r.noteHeadBounds.x=t+this.x+this.noteHeads.x,r.noteHeadBounds.y=i+this.y+this.noteHeads.y-this.noteHeads.height/2,r.noteHeadBounds.w=this.width,r.noteHeadBounds.h=this.height,e.addNote(r)}}getNoteY(e,t){if(this.noteHeads){let i=this.y+this.noteHeads.y;switch(t){case H.Top:case H.TopWithStem:i-=this.noteHeads.height/2+2*this.scale;break;case H.Center:break;case H.Bottom:case H.BottomWithStem:i+=this.noteHeads.height/2;break}return i}return 0}updateBeamingHelper(){this.noteHeads?this.noteHeads.updateBeamingHelper(this.container.x+this.x):this.restGlyph&&this.restGlyph.updateBeamingHelper(this.container.x+this.x)}doLayout(){let e=this.renderer;const t=e.getNoteLine(),i=e.getLineY(t);if(!this.container.beat.isEmpty)if(this.container.beat.isRest){const r=new cN(0,i,this.container.beat.duration);this.restGlyph=r,r.beat=this.container.beat,r.beamingHelper=this.beamingHelper,this.addGlyph(r),this.beamingHelper&&this.beamingHelper.applyRest(this.container.beat,0)}else{const r=this.container.beat.graceType!==$.None,n=new Rt(0,i,this.container.beat.duration,r);this.noteHeads=n,n.beat=this.container.beat,n.beamingHelper=this.beamingHelper,this.addGlyph(n)}if(this.container.beat.dots>0){this.addGlyph(new Bt(0,0,5*this.scale));for(let r=0;r<this.container.beat.dots;r++)this.addGlyph(new Qo(0,e.getLineY(e.getNoteLine())-e.getLineHeight(.5),1.5*this.scale))}super.doLayout(),this.container.beat.isEmpty?this.centerX=this.width/2:this.container.beat.isRest?this.centerX=this.restGlyph.x+this.restGlyph.width/2:this.centerX=this.noteHeads.x+this.noteHeads.width/2}}class Oh extends Xr{constructor(e,t){super(e,t),this.simpleWhammyOverflow=0,this._isOnlySlash=!t.staff.showTablature&&!t.staff.showStandardNotation,this.helpers.preferredBeamDirection=E.Up}get lineSpacing(){return Ge.RawLineSpacing}get heightLineCount(){return 5}get drawnLineCount(){return 1}get bottomGlyphOverflow(){return 0}paint(e,t,i){super.paint(e,t,i),this.paintBeams(e,t,i),this.paintTuplets(e,t,i)}doLayout(){super.doLayout();let e=!1;for(let t of this.bar.voices)if(this.hasVoiceContainer(t)&&this.getVoiceContainer(t).tupletGroups.length>0){e=!0;break}e&&this.registerOverflowTop(this.tupletSize)}getNoteLine(){return 0}getFlagTopY(e,t){return this.getLineY(0)-Rt.NoteHeadHeight/2*this.scale}getFlagBottomY(e,t){return this.getLineY(0)-Rt.NoteHeadHeight/2*this.scale}getBeamDirection(e){return E.Up}getNoteY(e,t){let i=super.getNoteY(e,t);return isNaN(i)&&(i=this.getLineY(0)),i}calculateBeamYWithDirection(e,t,i){return this.getLineY(0)-this.getFlagStemSize(e.shortestDuration)}getBarLineStart(e,t){return this.getLineY(0)-Rt.NoteHeadHeight/2*this.scale}createLinePreBeatGlyphs(){this._isOnlySlash&&(!this.bar.previousBar||this.bar.previousBar&&this.bar.masterBar.timeSignatureNumerator!==this.bar.previousBar.masterBar.timeSignatureNumerator||this.bar.previousBar&&this.bar.masterBar.timeSignatureDenominator!==this.bar.previousBar.masterBar.timeSignatureDenominator||this.bar.previousBar&&this.bar.masterBar.isFreeTime&&this.bar.masterBar.isFreeTime!==this.bar.previousBar.masterBar.isFreeTime)&&(this.createStartSpacing(),this.createTimeSignatureGlyphs())}createTimeSignatureGlyphs(){this.addPreBeatGlyph(new Bt(0,0,5*this.scale));const e=this.bar.masterBar;this.addPreBeatGlyph(new wp(0,this.getLineY(0),e.timeSignatureNumerator,e.timeSignatureDenominator,e.timeSignatureCommon,e.isFreeTime&&(e.previousMasterBar==null||e.isFreeTime!==e.previousMasterBar.isFreeTime)))}createVoiceGlyphs(e){for(const t of e.beats){let i=new uN(t,this.getVoiceContainer(e));i.preNotes=new Dn,i.onNotes=e.index==0?new dN:new An,this.addBeatGlyph(i)}}paintBeamingStem(e,t,i,r,n,a){a.lineWidth=Ge.StemWidth*this.scale,a.beginPath(),a.moveTo(i,r),a.lineTo(i,n),a.stroke(),a.lineWidth=this.scale}}Oh.StaffId="slash";class fN extends ll{get staffId(){return Oh.StaffId}getStaffPaddingTop(e){return e.system.layout.renderer.settings.display.notationStaffPaddingTop}getStaffPaddingBottom(e){return e.system.layout.renderer.settings.display.notationStaffPaddingBottom}create(e,t){return new Oh(e,t)}canCreate(e,t){return super.canCreate(e,t)&&t.showSlash}constructor(){super()}}class Bc extends pt{constructor(e,t,i=!1){super(e?e.beat:null,t?t.beat:null,i),this.startNote=e,this.endNote=t}shouldDrawBendSlur(){return this.renderer.settings.notation.extendBendArrowsOnTiedNotes&&!!this.startNote.bendOrigin&&this.startNote.isTieOrigin}doLayout(){super.doLayout()}getBeamDirection(e,t){return E.Up}getStartY(){return this.startNoteRenderer.getNoteY(this.startNote,H.Top)}getEndY(){return this.getStartY()}getStartX(){return this.startNote===this.endNote?this.getEndX()-20*this.scale:this.startNoteRenderer.getNoteX(this.startNote,Fe.Center)}getEndX(){return this.startNote===this.endNote?this.endNoteRenderer.getNoteX(this.endNote,Fe.Left):this.endNoteRenderer.getNoteX(this.endNote,Fe.Center)}}class ay extends cr{constructor(e,t,i,r=!1){super(e,t,r),this._direction=E.Up,this._forSlide=i}getTieHeight(e,t,i,r){return Math.log(i-e+1)*this.renderer.settings.notation.slurHeight}tryExpand(e,t,i,r){if(this._forSlide!==i||this.forEnd!==r||this.startNote.beat.id!==e.beat.id||this.endNote.beat.id!==t.beat.id)return!1;switch(this._direction){case E.Up:e.realValue>this.startNote.realValue&&(this.startNote=e,this.startBeat=e.beat),t.realValue>this.endNote.realValue&&(this.endNote=t,this.endBeat=t.beat);break;case E.Down:e.realValue<this.startNote.realValue&&(this.startNote=e,this.startBeat=e.beat),t.realValue<this.endNote.realValue&&(this.endNote=t,this.endBeat=t.beat);break}return!0}paint(e,t,i){let r=this.renderer.scoreRenderer.layout.getRendererForBar(this.renderer.staff.staveId,this.startBeat.voice.bar),n=this.getBeamDirection(this.startBeat,r),a="numbered.slur."+this.startNote.beat.id+"."+this.endNote.beat.id+"."+n,o=this.renderer;o.staff.getSharedLayoutData(a,!1)||(o.staff.setSharedLayoutData(a,!0),super.paint(e,t,i))}}class pN extends Ui{constructor(e,t){super(e,t),this._effectSlurs=[]}createTies(e){if(e.isVisible){if(e.isTieOrigin&&e.tieDestination.isVisible){let t=new Bc(e,e.tieDestination,!1);this.addTie(t)}if(e.isTieDestination){let t=new Bc(e.tieOrigin,e,!0);this.addTie(t)}if(e.isLeftHandTapped&&!e.isHammerPullDestination){let t=new Bc(e,e,!1);this.addTie(t)}if(e.isEffectSlurOrigin&&e.effectSlurDestination){let t=!1;for(let i of this._effectSlurs)if(i.tryExpand(e,e.effectSlurDestination,!1,!1)){t=!0;break}if(!t){let i=new ay(e,e.effectSlurDestination,!1,!1);this._effectSlurs.push(i),this.addTie(i)}}if(e.isEffectSlurDestination&&e.effectSlurOrigin){let t=!1;for(let i of this._effectSlurs)if(i.tryExpand(e.effectSlurOrigin,e,!1,!0)){t=!0;break}if(!t){let i=new ay(e.effectSlurOrigin,e,!1,!0);this._effectSlurs.push(i),this.addTie(i)}}}}}class Ba extends qe{constructor(e,t,i,r){super(e,t),this._isGrace=r,this._number=i}paint(e,t,i){const r=this.renderer.resources;i.font=this._isGrace?r.numberedNotationGraceFont:r.numberedNotationFont,i.textBaseline=te.Middle,i.textAlign=Y.Left,i.fillText(this._number.toString(),e+this.x,t+this.y)}doLayout(){const e=(this._isGrace?ee.GraceScale:1)*this.scale;this.width=Ba.NoteHeadWidth*e,this.height=Ba.NoteHeadHeight*e}}Ba.NoteHeadHeight=17;Ba.NoteHeadWidth=12;class qo extends qe{doLayout(){this.width=(14+qo.Padding)*this.scale,this.height=It.BarSize*this.scale}paint(e,t,i){const r=qo.Padding*this.scale;i.fillRect(e+this.x,t+this.y,this.width-r,this.height)}}qo.Padding=3;class gN extends Dn{constructor(){super(...arguments),this.isNaturalizeAccidental=!1,this.accidental=U.None}doLayout(){if(!this.container.beat.isRest&&!this.container.beat.isEmpty){let e=new gp;if(e.renderer=this.renderer,this.container.beat.notes.length>0){const t=this.container.beat.notes[0],i=t?t.accidentalMode:ot.Default,r=$e.getNoteValue(t);let n=$e.computeAccidental(this.renderer.bar.masterBar.keySignature,i,r,t.hasQuarterToneOffset);if(n==U.Natural&&(n=this.renderer.bar.masterBar.keySignature+7<7?U.Sharp:U.Flat,this.isNaturalizeAccidental=!0),n!==U.None){this.accidental=n;let a=this.renderer,o=new Xs(0,a.getLineY(0),n,t.beat.graceType!==$.None?ee.GraceScale*ee.GraceScale:ee.GraceScale);o.renderer=this.renderer,e.addGlyph(o),this.addGlyph(e),this.addGlyph(new Bt(0,0,4*this.scale))}}}super.doLayout()}}class xa extends An{constructor(){super(...arguments),this.noteHeads=null,this.octaveDots=0}getNoteX(e,t){if(this.noteHeads){let i=this.noteHeads.x;switch(t){case Fe.Left:break;case Fe.Center:i+=this.noteHeads.width/2;break;case Fe.Right:i+=this.noteHeads.width;break}return i}return 0}buildBoundingsLookup(e,t,i){if(this.noteHeads&&this.container.beat.notes.length>0){const r=new al;r.note=this.container.beat.notes[0],r.noteHeadBounds=new si,r.noteHeadBounds.x=t+this.x+this.noteHeads.x,r.noteHeadBounds.y=i+this.y+this.noteHeads.y-this.noteHeads.height/2,r.noteHeadBounds.w=this.width,r.noteHeadBounds.h=this.height,e.addNote(r)}}getNoteY(e,t){if(this.noteHeads){let i=this.y+this.noteHeads.y;switch(t){case H.Top:case H.TopWithStem:i-=this.noteHeads.height/2+2*this.scale;break;case H.Center:break;case H.Bottom:case H.BottomWithStem:i+=this.noteHeads.height/2;break}return i}return 0}updateBeamingHelper(){this.beamingHelper&&this.noteHeads&&this.beamingHelper.registerBeatLineX("numbered",this.container.beat,this.container.x+this.x+this.noteHeads.x,this.container.x+this.x+this.noteHeads.x+this.noteHeads.width)}doLayout(){let e=this.renderer;e.shortestDuration<this.container.beat.duration&&(e.shortestDuration=this.container.beat.duration);const t=e.getLineY(e.getNoteLine());if(!this.container.beat.isEmpty){let i="0";if(this.container.beat.notes.length>0){const l=this.renderer.bar.masterBar.keySignatureType,h=this.renderer.bar.masterBar.keySignature,u=h+7,d=(l===Es.Minor?xa.MinorKeySignatureOneValues:xa.MajorKeySignatureOneValues)[u],p=this.container.beat.notes[0];if(p.isDead)i="X";else{let g=p.displayValue-d,w=g<0?(g%12+12)%12:g%12,S=g<0?(Math.abs(g)+12)/12|0:g/12|0;g<0&&(S*=-1),this.octaveDots=S,e.registerOctave(S);let m=(Re.keySignatureIsSharp(h)||Re.keySignatureIsNatural(h)?$e.FlatNoteSteps:$e.SharpNoteSteps)[w]+1;$e.AccidentalNotes[w]&&!this.container.preNotes.isNaturalizeAccidental&&(u<7?m++:m--),i=m.toString()}}const r=this.container.beat.graceType!==$.None,n=new Ba(0,t,i,r);if(this.noteHeads=n,this.addGlyph(n),this.container.beat.dots>0&&this.container.beat.duration>=k.Quarter){this.addGlyph(new Bt(0,0,5*this.scale));for(let l=0;l<this.container.beat.dots;l++){const h=new Qo(0,e.getLineY(0),1.5*this.scale);h.renderer=this.renderer,this.addGlyph(h)}}let a=0;switch(this.container.beat.duration){case k.QuadrupleWhole:a=16;break;case k.DoubleWhole:a=8;break;case k.Whole:a=4;break;case k.Half:a=2;break}let o=a;for(let l=0;l<this.container.beat.dots;l++)o=o/2|0,a+=o;for(let l=0;l<a-1;l++){const h=new qo(0,e.getLineY(0));h.renderer=this.renderer,this.addGlyph(h)}}super.doLayout(),this.container.beat.isEmpty?this.centerX=this.width/2:this.centerX=this.noteHeads.x+this.noteHeads.width/2}}xa.MajorKeySignatureOneValues=[59,66,61,68,63,58,65,60,67,62,69,64,71,66,61];xa.MinorKeySignatureOneValues=[71,66,73,68,63,70,65,72,67,74,69,64,71,66,73];class mN extends qe{constructor(e,t,i,r){super(e,t),this._text="",this._accidental=U.None,this._accidentalOffset=0,this._keySignature=i,this._keySignatureType=r}doLayout(){super.doLayout();const e="1 = ";let t="",i=U.None;switch(this._keySignatureType){case Es.Major:switch(this._keySignature){case fe.Cb:t="  C",i=U.Flat;break;case fe.Gb:t="  G",i=U.Flat;break;case fe.Db:t="  D",i=U.Flat;break;case fe.Ab:t="  A",i=U.Flat;break;case fe.Eb:t="  E",i=U.Flat;break;case fe.Bb:t="  B",i=U.Flat;break;case fe.F:t="F";break;case fe.C:t="C",i=U.None;break;case fe.G:t="G",i=U.None;break;case fe.D:t="D",i=U.None;break;case fe.A:t="A",i=U.None;break;case fe.E:t="E",i=U.None;break;case fe.B:t="B",i=U.None;break;case fe.FSharp:t="  F",i=U.Sharp;break;case fe.CSharp:t="  C",i=U.Sharp;break}break;case Es.Minor:switch(this._keySignature){case fe.Cb:t="  a",i=U.Flat;break;case fe.Gb:t="  e",i=U.Flat;break;case fe.Db:t="  b",i=U.Flat;break;case fe.Ab:t="f",i=U.None;break;case fe.Eb:t="c",i=U.None;break;case fe.Bb:t="g",i=U.None;break;case fe.F:t="d";break;case fe.C:t="a",i=U.None;break;case fe.G:t="e",i=U.None;break;case fe.D:t="b",i=U.None;break;case fe.A:t="  f",i=U.Sharp;break;case fe.E:t="  c",i=U.Sharp;break;case fe.B:t="  g",i=U.Sharp;break;case fe.FSharp:t="  d",i=U.Sharp;break;case fe.CSharp:t="  a",i=U.Sharp;break}break}this._text=e+t,this._accidental=i;const r=this.renderer.scoreRenderer.canvas,n=this.renderer.resources;r.font=n.numberedNotationFont,this._accidentalOffset=r.measureText(e).width,this.width=r.measureText(e+t).width}paint(e,t,i){const r=this.renderer.resources;i.font=r.numberedNotationFont,i.textBaseline=te.Middle,i.fillText(this._text,e+this.x,t+this.y),this._accidental!=U.None&&i.fillMusicFontSymbol(e+this.x+this._accidentalOffset,t+this.y,.7,Xs.getMusicSymbol(this._accidental),!1)}}class It extends Xr{registerOctave(e){this.lowestOctave===null?(this.lowestOctave=e,this.highestOctave=e):(e<this.lowestOctave&&(this.lowestOctave=e),e>this.highestOctave&&(this.highestOctave=e))}constructor(e,t){super(e,t),this.simpleWhammyOverflow=0,this.shortestDuration=k.QuadrupleWhole,this.lowestOctave=null,this.highestOctave=null,this._isOnlyNumbered=!t.staff.showSlash&&!t.staff.showTablature&&!t.staff.showStandardNotation}get lineSpacing(){return Ge.RawLineSpacing}get heightLineCount(){return 5}get drawnLineCount(){return 0}get bottomGlyphOverflow(){return 0}paint(e,t,i){super.paint(e,t,i),this.paintBeams(e,t,i),this.paintTuplets(e,t,i,!0)}doLayout(){super.doLayout();let e=!1;for(let t of this.bar.voices)if(this.hasVoiceContainer(t)&&this.getVoiceContainer(t).tupletGroups.length>0){e=!0;break}if(e&&this.registerOverflowTop(this.tupletSize),!this.bar.isEmpty){let t=Re.getIndex(this.shortestDuration)-2;if(t>0){let r=It.BarSpacing*this.scale,n=It.BarSize*this.scale,a=(t-1)*r+n,o=0;const l=this.lowestOctave;l!==null&&(o=(Math.abs(l)*It.DotSpacing+It.DotSize)*this.scale),this.registerOverflowBottom(a+o)}const i=this.highestOctave;if(i!==null){const r=(Math.abs(i)*It.DotSpacing+It.DotSize)*this.scale;this.registerOverflowTop(r)}}}paintFlag(e,t,i,r){this.paintBar(e,t,i,r)}paintBar(e,t,i,r){const n=this.resources;for(let o=0,l=r.beats.length;o<l;o++){let h=r.beats[o],u=It.BarSpacing*this.scale,c=It.BarSize*this.scale,d=Re.getIndex(h.duration)-2,p=t+this.y,g=this.getBeatX(h,ae.PreNotes)-this.beatGlyphsStart;var a=this.calculateBeamY(r,g);for(let B=0;B<d;B++){let _=0,P=0,N=0,D=p+B*u;o===r.beats.length-1?(_=g,P=this.getBeatX(h,ae.PostNotes)-this.beatGlyphsStart):(_=g,P=this.getBeatX(r.beats[o+1],ae.PreNotes)-this.beatGlyphsStart),N=D+a|0,Xr.paintSingleBar(i,e+this.x+_,N,e+this.x+P,N,c)}let S=this.getBeatContainer(h).onNotes.octaveDots,b=0,m=0;S>0?(b=p+this.getLineY(0)-n.numberedNotationFont.size/1.5,m=It.DotSpacing*-1*this.scale):S<0&&(b=p+a+d*u,m=It.DotSpacing*this.scale);let y=this.getBeatX(h,ae.OnNotes)+4*this.scale-this.beatGlyphsStart;S=Math.abs(S);for(let B=0;B<S;B++)i.fillCircle(e+this.x+y,b,It.DotSize*this.scale),b+=m}}getNoteLine(){return 0}get tupletOffset(){return super.tupletOffset+this.resources.numberedNotationFont.size*this.scale}getFlagTopY(e,t){return this.getLineY(0)-Rt.NoteHeadHeight/2*this.scale}getFlagBottomY(e,t){return this.getLineY(0)-Rt.NoteHeadHeight/2*this.scale}getBeamDirection(e){return E.Down}getTupletBeamDirection(e){return E.Up}getNoteY(e,t){let i=super.getNoteY(e,t);return isNaN(i)&&(i=this.getLineY(0)),i}calculateBeamYWithDirection(e,t,i){const r=this.resources.numberedNotationFont;return this.getLineY(0)+r.size*this.scale}getBarLineStart(e,t){return this.getLineY(0)-Rt.NoteHeadHeight/2*this.scale}createLinePreBeatGlyphs(){(!this.bar.previousBar||this.bar.masterBar.keySignature!==this.bar.previousBar.masterBar.keySignature)&&(this.createStartSpacing(),this.createKeySignatureGlyphs()),this._isOnlyNumbered&&(!this.bar.previousBar||this.bar.previousBar&&this.bar.masterBar.timeSignatureNumerator!==this.bar.previousBar.masterBar.timeSignatureNumerator||this.bar.previousBar&&this.bar.masterBar.timeSignatureDenominator!==this.bar.previousBar.masterBar.timeSignatureDenominator||this.bar.previousBar&&this.bar.masterBar.isFreeTime&&this.bar.masterBar.isFreeTime!==this.bar.previousBar.masterBar.isFreeTime)&&(this.createStartSpacing(),this.createTimeSignatureGlyphs())}createKeySignatureGlyphs(){this.addPreBeatGlyph(new mN(0,this.getLineY(0),this.bar.masterBar.keySignature,this.bar.masterBar.keySignatureType))}createTimeSignatureGlyphs(){this.addPreBeatGlyph(new Bt(0,0,5*this.scale));const e=this.bar.masterBar;this.addPreBeatGlyph(new wp(0,this.getLineY(0),e.timeSignatureNumerator,e.timeSignatureDenominator,e.timeSignatureCommon,e.isFreeTime&&(e.previousMasterBar==null||e.isFreeTime!==e.previousMasterBar.isFreeTime)))}createPostBeatGlyphs(){this._isOnlyNumbered&&super.createPostBeatGlyphs()}createVoiceGlyphs(e){for(const t of e.beats){let i=new pN(t,this.getVoiceContainer(e));i.preNotes=e.index==0?new gN:new Dn,i.onNotes=e.index==0?new xa:new An,this.addBeatGlyph(i)}}paintBeamingStem(e,t,i,r,n,a){a.lineWidth=Ge.StemWidth*this.scale,a.beginPath(),a.moveTo(i,r),a.lineTo(i,n),a.stroke(),a.lineWidth=this.scale}}It.StaffId="numbered";It.BarSpacing=Ge.BeamSpacing+Ge.BeamThickness;It.BarSize=2;It.DotSpacing=5;It.DotSize=2;class yN extends ll{get staffId(){return Oh.StaffId}getStaffPaddingTop(e){return e.system.layout.renderer.settings.display.notationStaffPaddingTop}getStaffPaddingBottom(e){return e.system.layout.renderer.settings.display.notationStaffPaddingBottom}create(e,t){return new It(e,t)}canCreate(e,t){return super.canCreate(e,t)&&t.showNumbered}constructor(){super()}}class wN extends _t{get notationElement(){return K.EffectText}get hideOnMultiTrack(){return!1}get canShareBand(){return!0}get sizingMode(){return we.SinglePreBeat}shouldCreateGlyph(e,t){const i=t.voice.bar.masterBar;return t.voice.bar.staff.index===0&&t.voice.index===0&&t.index===0&&i.isFreeTime&&(i.index===0||i.isFreeTime!=i.previousMasterBar.isFreeTime)}createNewGlyph(e,t){return new Mt(0,0,"Free time",e.resources.effectFont,Y.Left)}canExpand(e,t){return!0}}class oy{constructor(e,t){this.vertical=e,this.createLayout=t}}class xc{constructor(e,t){this.supportsWorkers=e,this.createCanvas=t}}class T{static createStyleElement(e,t){let i=e.getElementById("alphaTabStyle");if(!i){if(!t){C.error("AlphaTab","Font directory could not be detected, cannot create style element");return}i=e.createElement("style"),i.id="alphaTabStyle";let r=`
            @font-face {
                font-family: 'alphaTab';
                 src: url('${t}Bravura.eot');
                 src: url('${t}Bravura.eot?#iefix') format('embedded-opentype')
                      , url('${t}Bravura.woff') format('woff')
                      , url('${t}Bravura.otf') format('opentype')
                      , url('${t}Bravura.svg#Bravura') format('svg');
                 font-weight: normal;
                 font-style: normal;
            }
            .at-surface * {
                cursor: default;
                vertical-align: top;
                overflow: visible;
            }
            .at-surface-svg text {
                dominant-baseline: central;
                white-space:pre;
            }
            .at {
                 font-family: 'alphaTab';
                 speak: none;
                 font-style: normal;
                 font-weight: normal;
                 font-variant: normal;
                 text-transform: none;
                 line-height: 1;
                 line-height: 1;
                 -webkit-font-smoothing: antialiased;
                 -moz-osx-font-smoothing: grayscale;
                 font-size: ${T.MusicFontSize}px;
                 overflow: visible !important;
            }`;i.innerHTML=r,e.getElementsByTagName("head").item(0).appendChild(i),T.bravuraFontChecker.checkForFontAvailability()}}static get globalThis(){if(T._globalThis===void 0){try{T._globalThis=globalThis}catch{}typeof T._globalThis>"u"&&(T._globalThis=self),typeof T._globalThis>"u"&&(T._globalThis=global),typeof T._globalThis>"u"&&(T._globalThis=window),typeof T._globalThis>"u"&&(T._globalThis=Function("return this")())}return this._globalThis}static get isRunningInWorker(){return"WorkerGlobalScope"in T.globalThis}static get isRunningInAudioWorklet(){return"AudioWorkletGlobalScope"in T.globalThis}static throttle(e,t){let i=0;return()=>{T.globalThis.clearTimeout(i),i=T.globalThis.setTimeout(e,t)}}static detectScriptFile(){if(!T.isRunningInWorker&&T.globalThis.ALPHATAB_ROOT){let e=T.globalThis.ALPHATAB_ROOT;return e=T.ensureFullUrl(e),e=T.appendScriptName(e),e}try{const e=import.meta.url;if(e&&e.indexOf("file://")===-1)return e}catch{}return"document"in T.globalThis&&document.currentScript?document.currentScript.src:null}static ensureFullUrl(e){var t,i,r;if(!e)return"";if(!e.startsWith("http")&&!e.startsWith("https")&&!e.startsWith("file")){let n="",a=T.globalThis.location;if(n+=(t=a.protocol)==null?void 0:t.toString(),n+="//",a.hostname&&(n+=(i=a.hostname)==null?void 0:i.toString()),a.port&&(n+=":",n+=(r=a.port)==null?void 0:r.toString()),!e.startsWith("/")){let o=a.pathname.split("/").slice(0,-1).join("/");o.length>0&&(o.startsWith("/")||(n+="/"),n+=o==null?void 0:o.toString())}return e.startsWith("/")||(n+="/"),n+=e==null?void 0:e.toString(),n}return e}static appendScriptName(e){return e&&!e.endsWith(".js")&&(e.endsWith("/")||(e+="/"),e+="alphaTab.js"),e}static detectFontDirectory(){if(!T.isRunningInWorker&&T.globalThis.ALPHATAB_FONT)return T.ensureFullUrl(T.globalThis.ALPHATAB_FONT);const e=T.scriptFile;if(e){let t=e.lastIndexOf("/");if(t>=0)return e.substr(0,t)+"/font/"}return null}static registerJQueryPlugin(){if(!T.isRunningInWorker&&T.globalThis&&"jQuery"in T.globalThis){let e=T.globalThis.jQuery,t=new Om;e.fn.alphaTab=function(i){const r=Array.prototype.slice.call(arguments,1);return this.length===1?t.exec(this[0],i,r):this.each((n,a)=>{t.exec(a,i,r)})},e.alphaTab={restore:Om.restore},e.fn.alphaTab.fn=t}}static getRenderEngineFactory(e){return!e||!T.renderEngines.has(e)?T.renderEngines.get("default"):T.renderEngines.get(e)}static getLayoutEngineFactory(e){return!e||!T.layoutEngines.has(e)?T.layoutEngines.get(ur.Page):T.layoutEngines.get(e)}static buildImporters(){return[new Os,new nv,new sv,new av,new aN,new Ut]}static createDefaultRenderEngines(){const e=new Map;return e.set("svg",new xc(!0,()=>new Mv)),e.set("default",e.get("svg")),e.set("skia",new xc(!1,()=>new Oe)),T.createPlatformSpecificRenderEngines(e),e}static enableAlphaSkia(e,t){Oe.enable(e,t)}static registerAlphaSkiaCustomFont(e,t){return Oe.registerFont(e,t)}static createPlatformSpecificRenderEngines(e){e.set("html5",new xc(!1,()=>new wv))}static createDefaultRenderers(){return[new Gn(T.StaffIdBeforeSlashAlways,[new mT,new bT,new hT,new Kv,new wN,new yT,new Zv]),new fN,new Gn(T.StaffIdBeforeScoreAlways,[new rT]),new Gn(T.StaffIdBeforeScoreHideable,[new ST,new Um,new Wm(!0),new $m,new zm,new Ym,new Gm,new jm],(e,t)=>t.showStandardNotation),new GT,new Gn(T.StaffIdBeforeNumberedAlways,[new eT,new Wm(!1),new tT]),new yN,new Gn(T.StaffIdBeforeTabAlways,[new lT]),new Gn(T.StaffIdBeforeTabHideable,[new Um,new $m,new zm,new Ym,new Gm,new pT,new sT,new Pr(X.Natural),new Pr(X.Artificial),new Pr(X.Pinch),new Pr(X.Tap),new Pr(X.Semi),new Pr(X.Feedback),new aT,new jv,new nT,new cT,new fT,new dT,new jm],(e,t)=>t.showTablature),new Sc]}static createDefaultStaveProfiles(){const e=new Map,t=T.createDefaultRenderers();e.set(er.Default,t),e.set(er.ScoreTab,t);const i=new Set([T.StaffIdBeforeSlashAlways,T.StaffIdBeforeScoreAlways,T.StaffIdBeforeNumberedAlways,T.StaffIdBeforeTabAlways,Bs.StaffId]);e.set(er.Score,t.filter(n=>i.has(n.staffId)));const r=new Set([T.StaffIdBeforeSlashAlways,T.StaffIdBeforeScoreAlways,T.StaffIdBeforeNumberedAlways,T.StaffIdBeforeTabAlways,Pn.StaffId]);return e.set(er.Tab,T.createDefaultRenderers().filter(n=>{if(n instanceof Sc){const a=n;a.showTimeSignature=!0,a.showRests=!0,a.showTiedNotes=!0}return r.has(n.staffId)})),e.set(er.TabMixed,T.createDefaultRenderers().filter(n=>{if(n instanceof Sc){const a=n;a.showTimeSignature=!1,a.showRests=!1,a.showTiedNotes=!1}return r.has(n.staffId)})),e}static createDefaultLayoutEngines(){const e=new Map;return e.set(ur.Page,new oy(!0,t=>new _T(t))),e.set(ur.Horizontal,new oy(!1,t=>new kT(t))),e}static initializeMain(e,t){T.isRunningInWorker||T.isRunningInAudioWorklet||((T.webPlatform===Ei.Browser||T.webPlatform===Ei.BrowserModule)&&(T.registerJQueryPlugin(),T.HighDpiFactor=window.devicePixelRatio,"ResizeObserver"in T.globalThis||(T.globalThis.ResizeObserver=oN),"IntersectionObserver"in T.globalThis||(T.globalThis.IntersectionObserver=lN),"replaceChildren"in Element.prototype||(Element.prototype.replaceChildren=function(...i){this.innerHTML="",this.append(...i)},Document.prototype.replaceChildren=Element.prototype.replaceChildren,DocumentFragment.prototype.replaceChildren=Element.prototype.replaceChildren),"replaceAll"in String.prototype||(String.prototype.replaceAll=function(i,r){return this.replace(new RegExp(i,"g"),r)})),T.createWebWorker=e,T.createAudioWorklet=t)}static get alphaTabWorker(){return this.globalThis.Worker}static initializeWorker(){if(!T.isRunningInWorker)throw new Pt(Nt.General,"Not running in worker, cannot run worker initialization");hp.init(),lp.init(),T.createWebWorker=e=>{throw new Pt(Nt.General,"Nested workers are not supported")}}static initializeAudioWorklet(){if(!T.isRunningInAudioWorklet)throw new Pt(Nt.General,"Not running in audio worklet, cannot run worklet initialization");Go.init()}static detectWebPack(){try{if(typeof __webpack_require__=="function")return!0}catch{}return!1}static detectVite(){try{if(typeof __BASE__=="string")return!0}catch{}return!1}static detectWebPlatform(){try{if(Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]")return Ei.NodeJs}catch{}try{const e=import.meta.url;if(e&&typeof e=="string"&&!e.startsWith("file://"))return Ei.BrowserModule}catch{}return Ei.Browser}}T.StaffIdBeforeSlashAlways="before-slash-always";T.StaffIdBeforeScoreAlways="before-score-always";T.StaffIdBeforeScoreHideable="before-score-hideable";T.StaffIdBeforeNumberedAlways="before-numbered-always";T.StaffIdBeforeTabAlways="before-tab-always";T.StaffIdBeforeTabHideable="before-tab-hideable";T.MusicFontSize=34;T.HighDpiFactor=1;T._globalThis=void 0;T.webPlatform=T.detectWebPlatform();T.isWebPackBundled=T.detectWebPack();T.isViteBundled=T.detectVite();T.scriptFile=T.detectScriptFile();T.fontDirectory=T.detectFontDirectory();T.bravuraFontChecker=new tb(["alphaTab"]);T.renderEngines=T.createDefaultRenderEngines();T.layoutEngines=T.createDefaultLayoutEngines();T.staveProfiles=T.createDefaultStaveProfiles();class hb{constructor(){this.scriptFile=null,this.fontDirectory=null,this.file=null,this.tex=!1,this.tracks=null,this.enableLazyLoading=!0,this.engine="default",this.logLevel=ws.Info,this.useWorkers=!0,this.includeNoteBounds=!1,this.scriptFile=T.scriptFile,this.fontDirectory=T.fontDirectory}}var M;(function(s){s[s.SteelGuitar=1]="SteelGuitar",s[s.AcousticGuitar=2]="AcousticGuitar",s[s.TwelveStringGuitar=3]="TwelveStringGuitar",s[s.ElectricGuitar=4]="ElectricGuitar",s[s.Bass=5]="Bass",s[s.ClassicalGuitar=23]="ClassicalGuitar",s[s.UprightBass=6]="UprightBass",s[s.Ukulele=7]="Ukulele",s[s.Banjo=8]="Banjo",s[s.Mandolin=9]="Mandolin",s[s.Piano=10]="Piano",s[s.Synth=12]="Synth",s[s.Strings=11]="Strings",s[s.Brass=13]="Brass",s[s.Reed=14]="Reed",s[s.Woodwind=15]="Woodwind",s[s.Vocal=16]="Vocal",s[s.PitchedIdiophone=17]="PitchedIdiophone",s[s.Fx=21]="Fx",s[s.PercussionKit=18]="PercussionKit",s[s.Idiophone=19]="Idiophone",s[s.Membraphone=20]="Membraphone"})(M||(M={}));class F{constructor(e,t,i=null){if(this.icon=M.Piano,this.icon=e,this.instrumentSetName=t,i)this.instrumentSetType=i;else{const r=t.split(" ");r[0]=r[0].substr(0,1).toLowerCase()+r[0].substr(1),this.instrumentSetType=r.join("")}}}new F(M.Piano,"Acoustic Piano"),new F(M.Piano,"Acoustic Piano"),new F(M.Piano,"Electric Piano"),new F(M.Piano,"Acoustic Piano"),new F(M.Piano,"Electric Piano"),new F(M.Piano,"Electric Piano"),new F(M.Piano,"Harpsichord"),new F(M.Piano,"Harpsichord"),new F(M.PitchedIdiophone,"Celesta"),new F(M.PitchedIdiophone,"Vibraphone"),new F(M.PitchedIdiophone,"Vibraphone"),new F(M.PitchedIdiophone,"Vibraphone"),new F(M.PitchedIdiophone,"Xylophone"),new F(M.PitchedIdiophone,"Xylophone"),new F(M.PitchedIdiophone,"Vibraphone"),new F(M.Banjo,"Banjo"),new F(M.Piano,"Electric Organ"),new F(M.Piano,"Electric Organ"),new F(M.Piano,"Electric Organ"),new F(M.Piano,"Electric Organ"),new F(M.Piano,"Electric Organ"),new F(M.Piano,"Electric Organ"),new F(M.Woodwind,"Recorder"),new F(M.Piano,"Electric Organ"),new F(M.ClassicalGuitar,"Nylon Guitar"),new F(M.SteelGuitar,"Steel Guitar"),new F(M.SteelGuitar,"Electric Guitar"),new F(M.ElectricGuitar,"Electric Guitar"),new F(M.ElectricGuitar,"Electric Guitar"),new F(M.ElectricGuitar,"Electric Guitar"),new F(M.SteelGuitar,"Electric Guitar"),new F(M.SteelGuitar,"Electric Guitar"),new F(M.Bass,"Acoustic Bass"),new F(M.Bass,"Electric Bass"),new F(M.Bass,"Electric Bass"),new F(M.Bass,"Acoustic Bass"),new F(M.Bass,"Electric Bass"),new F(M.Bass,"Electric Bass"),new F(M.Synth,"Synth Bass"),new F(M.Synth,"Synth Bass"),new F(M.Strings,"Violin"),new F(M.Strings,"Viola"),new F(M.Strings,"Cello"),new F(M.Strings,"Contrabass"),new F(M.Strings,"Violin"),new F(M.Strings,"Violin"),new F(M.Piano,"Harp"),new F(M.Membraphone,"Timpani"),new F(M.Strings,"Violin"),new F(M.Strings,"Violin"),new F(M.Strings,"Violin"),new F(M.Strings,"Violin"),new F(M.Vocal,"Voice"),new F(M.Vocal,"Voice"),new F(M.Vocal,"Voice"),new F(M.Synth,"Pad Synthesizer"),new F(M.Brass,"Trumpet"),new F(M.Brass,"Trombone"),new F(M.Brass,"Tuba"),new F(M.Brass,"Trumpet"),new F(M.Brass,"French Horn"),new F(M.Brass,"Trumpet"),new F(M.Brass,"Trumpet"),new F(M.Brass,"Trumpet"),new F(M.Reed,"Saxophone"),new F(M.Reed,"Saxophone"),new F(M.Reed,"Saxophone"),new F(M.Reed,"Saxophone"),new F(M.Reed,"Oboe"),new F(M.Reed,"English Horn"),new F(M.Reed,"Bassoon"),new F(M.Reed,"Clarinet"),new F(M.Reed,"Piccolo"),new F(M.Woodwind,"Flute"),new F(M.Woodwind,"Recorder"),new F(M.Woodwind,"Flute"),new F(M.Woodwind,"Recorder"),new F(M.Woodwind,"Flute"),new F(M.Woodwind,"Recorder"),new F(M.Woodwind,"Flute"),new F(M.Synth,"Lead Synthesizer"),new F(M.Synth,"Lead Synthesizer"),new F(M.Synth,"Lead Synthesizer"),new F(M.Synth,"Lead Synthesizer"),new F(M.Synth,"Lead Synthesizer"),new F(M.Synth,"Lead Synthesizer"),new F(M.Synth,"Lead Synthesizer"),new F(M.Synth,"Lead Synthesizer"),new F(M.Synth,"Pad Synthesizer"),new F(M.Synth,"Pad Synthesizer"),new F(M.Synth,"Pad Synthesizer"),new F(M.Synth,"Pad Synthesizer"),new F(M.Synth,"Pad Synthesizer"),new F(M.Synth,"Pad Synthesizer"),new F(M.Synth,"Pad Synthesizer"),new F(M.Synth,"Pad Synthesizer"),new F(M.Fx,"Pad Synthesizer"),new F(M.Fx,"Pad Synthesizer"),new F(M.Fx,"Pad Synthesizer"),new F(M.Fx,"Pad Synthesizer"),new F(M.Fx,"Lead Synthesizer"),new F(M.Fx,"Lead Synthesizer"),new F(M.Fx,"Lead Synthesizer"),new F(M.Fx,"Trumpet"),new F(M.ElectricGuitar,"Banjo"),new F(M.Banjo,"Banjo"),new F(M.Ukulele,"Ukulele"),new F(M.Banjo,"Banjo"),new F(M.PitchedIdiophone,"Xylophone"),new F(M.Reed,"Bassoon"),new F(M.Strings,"Violin"),new F(M.Woodwind,"Flute"),new F(M.PitchedIdiophone,"Xylophone"),new F(M.Idiophone,"Celesta"),new F(M.PitchedIdiophone,"Vibraphone"),new F(M.Idiophone,"Xylophone"),new F(M.Membraphone,"Xylophone"),new F(M.Membraphone,"Xylophone"),new F(M.Membraphone,"Xylophone"),new F(M.Idiophone,"Celesta"),new F(M.Fx,"Steel Guitar"),new F(M.Fx,"Recorder"),new F(M.Fx,"Recorder"),new F(M.Fx,"Recorder"),new F(M.Fx,"Recorder"),new F(M.Fx,"Recorder"),new F(M.Fx,"Recorder"),new F(M.Fx,"Timpani");new F(M.PercussionKit,"Drums","drumKit");class bn{static buildCrc32Lookup(){const t=new Uint32Array(256);for(let i=0;i<t.length;i++){let r=i;for(let n=0;n<8;n++)r=(r&1)===1?r>>>1^3988292384:r>>>1;t[i]=r}return t}get value(){return~this._checkValue}constructor(){this._checkValue=bn.CrcInit,this.reset()}update(e,t,i){for(let r=0;r<i;r++)this._checkValue=bn.Crc32Lookup[(this._checkValue^e[t+r])&255]^this._checkValue>>>8}reset(){this._checkValue=bn.CrcInit}}bn.Crc32Lookup=bn.buildCrc32Lookup();bn.CrcInit=4294967295;class Ke{}Ke.MAX_WBITS=15;Ke.WSIZE=1<<Ke.MAX_WBITS;Ke.WMASK=Ke.WSIZE-1;Ke.MIN_MATCH=3;Ke.MAX_MATCH=258;Ke.DEFAULT_MEM_LEVEL=8;Ke.PENDING_BUF_SIZE=1<<Ke.DEFAULT_MEM_LEVEL+8;Ke.HASH_BITS=Ke.DEFAULT_MEM_LEVEL+7;Ke.HASH_SIZE=1<<Ke.HASH_BITS;Ke.HASH_SHIFT=(Ke.HASH_BITS+Ke.MIN_MATCH-1)/Ke.MIN_MATCH;Ke.HASH_MASK=Ke.HASH_SIZE-1;Ke.MIN_LOOKAHEAD=Ke.MAX_MATCH+Ke.MIN_MATCH+1;Ke.MAX_DIST=Ke.WSIZE-Ke.MIN_LOOKAHEAD;class Wi{constructor(e,t,i,r){this.length=null,this.numCodes=0,this.codes=null,this.huffman=e,this.minNumCodes=i,this.maxLength=r,this.freqs=new Int16Array(t),this.bitLengthCounts=new Int32Array(r)}reset(){for(let e=0;e<this.freqs.length;e++)this.freqs[e]=0;this.codes=null,this.length=null}buildTree(){let e=this.freqs.length,t=new Int32Array(e),i=0,r=0;for(let h=0;h<e;h++){let u=this.freqs[h];if(u!==0){let c=i++;for(;c>0;){let d=Math.floor((c-1)/2);if(this.freqs[t[d]]>u)t[c]=t[d],c=d;else break}t[c]=h,r=h}}for(;i<2;){let h=r<2?++r:0;t[i++]=h}this.numCodes=Math.max(r+1,this.minNumCodes);let n=i,a=new Int32Array(4*i-2),o=new Int32Array(2*i-1),l=n;for(let h=0;h<i;h++){let u=t[h];a[2*h]=u,a[2*h+1]=-1,o[h]=this.freqs[u]<<8,t[h]=h}do{let h=t[0],u=t[--i],c=0,d=1;for(;d<i;)d+1<i&&o[t[d]]>o[t[d+1]]&&d++,t[c]=t[d],c=d,d=d*2+1;let p=o[u];for(;d=c,c>0;)if(c=Math.floor((d-1)/2),o[t[c]]>p)t[d]=t[c];else break;t[d]=u;let g=t[0];u=l++,a[2*u]=h,a[2*u+1]=g;let w=Math.min(o[h]&255,o[g]&255);for(p=o[h]+o[g]-w+1,o[u]=p,c=0,d=1;d<i;)d+1<i&&o[t[d]]>o[t[d+1]]&&d++,t[c]=t[d],c=d,d=c*2+1;for(;d=c,d>0;)if(c=Math.floor((d-1)/2),o[t[c]]>p)t[d]=t[c];else break;t[d]=u}while(i>1);this.buildLength(a)}buildLength(e){this.length=new Uint8Array(this.freqs.length);let t=Math.floor(e.length/2),i=Math.floor((t+1)/2),r=0;for(let l=0;l<this.maxLength;l++)this.bitLengthCounts[l]=0;let n=new Int32Array(t);n[t-1]=0;for(let l=t-1;l>=0;l--)if(e[2*l+1]!=-1){let h=n[l]+1;h>this.maxLength&&(h=this.maxLength,r++),n[e[2*l]]=h,n[e[2*l+1]]=h}else{let h=n[l];this.bitLengthCounts[h-1]++,this.length[e[2*l]]=n[l]}if(r==0)return;let a=this.maxLength-1;do{for(;this.bitLengthCounts[--a]==0;);do this.bitLengthCounts[a]--,this.bitLengthCounts[++a]++,r-=1<<this.maxLength-1-a;while(r>0&&a<this.maxLength-1)}while(r>0);this.bitLengthCounts[this.maxLength-1]+=r,this.bitLengthCounts[this.maxLength-2]-=r;let o=2*i;for(let l=this.maxLength;l!=0;l--){let h=this.bitLengthCounts[l-1];for(;h>0;){let u=2*e[o++];e[u+1]==-1&&(this.length[e[u]]=l,h--)}}}getEncodedLength(){let e=0;for(let t=0;t<this.freqs.length;t++)e+=this.freqs[t]*this.length[t];return e}calcBLFreq(e){let t,i,r,n=-1,a=0;for(;a<this.numCodes;){r=1;let o=this.length[a];for(o==0?(t=138,i=3):(t=6,i=3,n!=o&&(e.freqs[o]++,r=0)),n=o,a++;a<this.numCodes&&n==this.length[a]&&(a++,!(++r>=t)););r<i?e.freqs[n]+=r:n!=0?e.freqs[Wi.Repeat3To6]++:r<=10?e.freqs[Wi.Repeat3To10]++:e.freqs[Wi.Repeat11To138]++}}setStaticCodes(e,t){this.codes=e,this.length=t}buildCodes(){let e=new Int32Array(this.maxLength),t=0;this.codes=new Int16Array(this.freqs.length);for(let i=0;i<this.maxLength;i++)e[i]=t,t+=this.bitLengthCounts[i]<<15-i;for(let i=0;i<this.numCodes;i++){let r=this.length[i];r>0&&(this.codes[i]=q.bitReverse(e[r-1]),e[r-1]+=1<<16-r)}}writeTree(e){let t,i,r,n=-1,a=0;for(;a<this.numCodes;){r=1;let o=this.length[a];for(o==0?(t=138,i=3):(t=6,i=3,n!=o&&(e.writeSymbol(o),r=0)),n=o,a++;a<this.numCodes&&n==this.length[a]&&(a++,!(++r>=t)););if(r<i)for(;r-- >0;)e.writeSymbol(n);else n!=0?(e.writeSymbol(Wi.Repeat3To6),this.huffman.pending.writeBits(r-3,2)):r<=10?(e.writeSymbol(Wi.Repeat3To10),this.huffman.pending.writeBits(r-3,3)):(e.writeSymbol(Wi.Repeat11To138),this.huffman.pending.writeBits(r-11,7))}}writeSymbol(e){this.huffman.pending.writeBits(this.codes[e]&65535,this.length[e])}}Wi.Repeat3To6=16;Wi.Repeat3To10=17;Wi.Repeat11To138=18;class q{static staticInit(){let e=0;for(;e<144;)q.staticLCodes[e]=q.bitReverse(48+e<<8),q.staticLLength[e++]=8;for(;e<256;)q.staticLCodes[e]=q.bitReverse(256+e<<7),q.staticLLength[e++]=9;for(;e<280;)q.staticLCodes[e]=q.bitReverse(-256+e<<9),q.staticLLength[e++]=7;for(;e<q.LITERAL_NUM;)q.staticLCodes[e]=q.bitReverse(-88+e<<8),q.staticLLength[e++]=8;for(e=0;e<q.DIST_NUM;e++)q.staticDCodes[e]=q.bitReverse(e<<11),q.staticDLength[e]=5}static bitReverse(e){return q.bit4Reverse[e&15]<<12|q.bit4Reverse[e>>4&15]<<8|q.bit4Reverse[e>>8&15]<<4|q.bit4Reverse[e>>12]}constructor(e){this.last_lit=0,this.extra_bits=0,this.pending=e,this.literalTree=new Wi(this,q.LITERAL_NUM,257,15),this.distTree=new Wi(this,q.DIST_NUM,1,15),this.blTree=new Wi(this,q.BITLEN_NUM,4,7),this.d_buf=new Int16Array(q.BUFSIZE),this.l_buf=new Uint8Array(q.BUFSIZE)}isFull(){return this.last_lit>=q.BUFSIZE}reset(){this.last_lit=0,this.extra_bits=0,this.literalTree.reset(),this.distTree.reset(),this.blTree.reset()}flushStoredBlock(e,t,i,r){this.pending.writeBits((q.STORED_BLOCK<<1)+(r?1:0),3),this.pending.alignToByte(),this.pending.writeShort(i),this.pending.writeShort(~i),this.pending.writeBlock(e,t,i),this.reset()}flushBlock(e,t,i,r){this.literalTree.freqs[q.EOF_SYMBOL]++,this.literalTree.buildTree(),this.distTree.buildTree(),this.literalTree.calcBLFreq(this.blTree),this.distTree.calcBLFreq(this.blTree),this.blTree.buildTree();let n=4;for(let l=18;l>n;l--)this.blTree.length[q.BL_ORDER[l]]>0&&(n=l+1);let a=14+n*3+this.blTree.getEncodedLength()+this.literalTree.getEncodedLength()+this.distTree.getEncodedLength()+this.extra_bits,o=this.extra_bits;for(let l=0;l<q.LITERAL_NUM;l++)o+=this.literalTree.freqs[l]*q.staticLLength[l];for(let l=0;l<q.DIST_NUM;l++)o+=this.distTree.freqs[l]*q.staticDLength[l];a>=o&&(a=o),t>=0&&i+4<a>>3?this.flushStoredBlock(e,t,i,r):a==o?(this.pending.writeBits((q.STATIC_TREES<<1)+(r?1:0),3),this.literalTree.setStaticCodes(q.staticLCodes,q.staticLLength),this.distTree.setStaticCodes(q.staticDCodes,q.staticDLength),this.compressBlock(),this.reset()):(this.pending.writeBits((q.DYN_TREES<<1)+(r?1:0),3),this.sendAllTrees(n),this.compressBlock(),this.reset())}sendAllTrees(e){this.blTree.buildCodes(),this.literalTree.buildCodes(),this.distTree.buildCodes(),this.pending.writeBits(this.literalTree.numCodes-257,5),this.pending.writeBits(this.distTree.numCodes-1,5),this.pending.writeBits(e-4,4);for(let t=0;t<e;t++)this.pending.writeBits(this.blTree.length[q.BL_ORDER[t]],3);this.literalTree.writeTree(this.blTree),this.distTree.writeTree(this.blTree)}compressBlock(){for(let e=0;e<this.last_lit;e++){let t=this.l_buf[e]&255,i=this.d_buf[e];if(i--!=0){let r=q.Lcode(t);this.literalTree.writeSymbol(r);let n=Math.floor((r-261)/4);n>0&&n<=5&&this.pending.writeBits(t&(1<<n)-1,n);let a=q.Dcode(i);this.distTree.writeSymbol(a),n=Math.floor(a/2)-1,n>0&&this.pending.writeBits(i&(1<<n)-1,n)}else this.literalTree.writeSymbol(t)}this.literalTree.writeSymbol(q.EOF_SYMBOL)}tallyDist(e,t){this.d_buf[this.last_lit]=e,this.l_buf[this.last_lit++]=t-3;let i=q.Lcode(t-3);this.literalTree.freqs[i]++,i>=265&&i<285&&(this.extra_bits+=Math.floor((i-261)/4));let r=q.Dcode(e-1);return this.distTree.freqs[r]++,r>=4&&(this.extra_bits+=Math.floor(r/2)-1),this.isFull()}tallyLit(e){return this.d_buf[this.last_lit]=0,this.l_buf[this.last_lit++]=e,this.literalTree.freqs[e]++,this.isFull()}static Lcode(e){if(e==255)return 285;let t=257;for(;e>=8;)t+=4,e=e>>1;return t+e}static Dcode(e){let t=0;for(;e>=4;)t+=2,e=e>>1;return t+e}}q.BUFSIZE=1<<Ke.DEFAULT_MEM_LEVEL+6;q.LITERAL_NUM=286;q.STORED_BLOCK=0;q.STATIC_TREES=1;q.DYN_TREES=2;q.DIST_NUM=30;q.staticLCodes=new Int16Array(q.LITERAL_NUM);q.staticLLength=new Uint8Array(q.LITERAL_NUM);q.staticDCodes=new Int16Array(q.DIST_NUM);q.staticDLength=new Uint8Array(q.DIST_NUM);q.BL_ORDER=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];q.bit4Reverse=new Uint8Array([0,8,4,12,2,10,6,14,1,9,5,13,3,11,7,15]);q.BITLEN_NUM=19;q.EOF_SYMBOL=256;q.staticInit();var bN=Object.freeze({__proto__:null,ActiveBeatsChangedEventArgs:eb,AlphaSynth:Yw,AlphaSynthAudioWorkletOutput:sb,AlphaSynthScriptProcessorOutput:ib,AlphaSynthWebAudioOutputBase:zi,AlphaSynthWebWorkerApi:Hd,CircularSampleBuffer:up,MidiEventsPlayedEventArgs:ap,PlaybackRange:Zw,PlaybackRangeChangedEventArgs:op,get PlayerState(){return dt},PlayerStateChangedEventArgs:ho,PositionChangedEventArgs:Oo});T.isRunningInWorker?T.initializeWorker():T.isRunningInAudioWorklet?T.initializeAudioWorklet():T.initializeMain(s=>{if(T.webPlatform==Ei.NodeJs)throw new Pt(Nt.General,"Workers not yet supported in Node.js");if(T.webPlatform==Ei.BrowserModule||T.isWebPackBundled||T.isViteBundled)return C.debug("AlphaTab","Creating webworker"),new T.alphaTabWorker(new URL(new URL(""+new URL("alphaTab.worker-BBnuRQMH.js",import.meta.url).href,import.meta.url),import.meta.url),{type:"module"});if(!s.core.scriptFile)throw new Pt(Nt.General,"Could not detect alphaTab script file, cannot initialize renderer");try{C.debug("AlphaTab","Creating Blob worker");const e=`importScripts('${s.core.scriptFile}')`,t=new Blob([e]);return new Worker(URL.createObjectURL(t))}catch{return C.warning("Rendering","Could not create inline worker, fallback to normal worker"),new Worker(s.core.scriptFile)}},(s,e)=>{if(T.webPlatform==Ei.NodeJs)throw new Pt(Nt.General,"Audio Worklets not yet supported in Node.js");return T.webPlatform==Ei.BrowserModule||T.isWebPackBundled||T.isViteBundled?(C.debug("AlphaTab","Creating Module worklet"),s.audioWorklet.addModule(new URL(new URL(""+new URL("alphaTab.worklet-DUjwjb9R.js",import.meta.url).href,import.meta.url),import.meta.url))):(C.debug("AlphaTab","Creating Script worklet"),s.audioWorklet.addModule(e.core.scriptFile))});const SN={tex:!0,fontDirectory:"font/",engine:"svg"},kN={staveProfile:"Default",resources:{staffLineColor:"#ffffff80",barSeparatorColor:"#fff",mainGlyphColor:"#fff",secondaryGlyphColor:"#fff",scoreInfoColor:"#fff",barNumberColor:"#fff"}},_N=s=>({scrollElement:s,enableCursor:!0,enableAnimatedBeatCursor:!0,enableElementHighlighting:!0,enablePlayer:!0,enableUserInteraction:!0,soundFont:"soundfont/sonivox.sf2"}),BN={guitarTuning:!1,trackNames:!1},xN={elements:BN},vN=s=>({core:SN,display:kN,notation:xN,player:_N(s)});function bi(s){return s==null}function ly(s){return s[Math.floor(Math.random()*s.length)]}function hy(s,e){return Math.floor(Math.random()*(e-s+1)+s)}function bp(...s){return{items:s}}function fn(s,e,t){return{type:"note",duration:s,steps:e,shift:t}}const TN=()=>{};function NN({bpm:s,tex:e,root:t,scrollArea:i,isLooping:r,instrumentVolume:n,metronomeVolume:a}){const[o,l]=be.useState(),[h,u]=be.useState(!1),[c,d]=be.useState(!1);return be.useEffect(()=>{bi(o)||o.tex(e)},[o,e]),be.useEffect(()=>{bi(o)||(o.isLooping=r)},[o,r]),be.useEffect(()=>{!bi(o)&&bi(o.score)},[o,s]),PN(o,0,n),CN(o,a),be.useEffect(()=>{if(!bi(t)&&!bi(i)){const p=new Tu(t,vN(i));return p.renderStarted.on(()=>u(!0)),p.renderFinished.on(()=>u(!1)),p.playerStateChanged.on(({state:g})=>d(g===bN.PlayerState.Playing)),p.render(),p.isLooping=r,p.metronomeVolume=a,ub(p,0,n),l(p),()=>p.destroy()}return TN},[t,i]),{api:o,isLoading:h,isPlaying:c}}function PN(s,e,t){be.useEffect(()=>{ub(s,e,t)},[e,t,s])}function CN(s,e){be.useEffect(()=>{bi(s)||(s.metronomeVolume=e)},[e])}function ub(s,e,t){var r;if(bi(s))return;const i=(r=s.score)==null?void 0:r.tracks[e];bi(i)||s.changeTrackVolume([i],t)}var cb={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},uy=lr.createContext&&lr.createContext(cb),EN=["attr","size","title"];function LN(s,e){if(s==null)return{};var t=MN(s,e),i,r;if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(s);for(r=0;r<n.length;r++)i=n[r],!(e.indexOf(i)>=0)&&Object.prototype.propertyIsEnumerable.call(s,i)&&(t[i]=s[i])}return t}function MN(s,e){if(s==null)return{};var t={};for(var i in s)if(Object.prototype.hasOwnProperty.call(s,i)){if(e.indexOf(i)>=0)continue;t[i]=s[i]}return t}function Vh(){return Vh=Object.assign?Object.assign.bind():function(s){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(s[i]=t[i])}return s},Vh.apply(this,arguments)}function cy(s,e){var t=Object.keys(s);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(s);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(s,r).enumerable})),t.push.apply(t,i)}return t}function Hh(s){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?cy(Object(t),!0).forEach(function(i){FN(s,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(t)):cy(Object(t)).forEach(function(i){Object.defineProperty(s,i,Object.getOwnPropertyDescriptor(t,i))})}return s}function FN(s,e,t){return e=RN(e),e in s?Object.defineProperty(s,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):s[e]=t,s}function RN(s){var e=DN(s,"string");return typeof e=="symbol"?e:e+""}function DN(s,e){if(typeof s!="object"||!s)return s;var t=s[Symbol.toPrimitive];if(t!==void 0){var i=t.call(s,e||"default");if(typeof i!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(s)}function db(s){return s&&s.map((e,t)=>lr.createElement(e.tag,Hh({key:t},e.attr),db(e.child)))}function jr(s){return e=>lr.createElement(AN,Vh({attr:Hh({},s.attr)},e),db(s.child))}function AN(s){var e=t=>{var{attr:i,size:r,title:n}=s,a=LN(s,EN),o=r||t.size||"1em",l;return t.className&&(l=t.className),s.className&&(l=(l?l+" ":"")+s.className),lr.createElement("svg",Vh({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},t.attr,i,a,{className:l,style:Hh(Hh({color:s.color||t.color},t.style),s.style),height:o,width:o,xmlns:"http://www.w3.org/2000/svg"}),n&&lr.createElement("title",null,n),s.children)};return uy!==void 0?lr.createElement(uy.Consumer,null,t=>e(t)):e(cb)}function IN(s){return jr({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M6 3H8V21H6V3ZM16 3H18V21H16V3Z"},child:[]}]})(s)}function ON(s){return jr({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M6 20.1957V3.80421C6 3.01878 6.86395 2.53993 7.53 2.95621L20.6432 11.152C21.2699 11.5436 21.2699 12.4563 20.6432 12.848L7.53 21.0437C6.86395 21.46 6 20.9812 6 20.1957Z"},child:[]}]})(s)}function VN(s){return jr({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M3 4C3 3.44772 3.44772 3 4 3H20C20.5523 3 21 3.44772 21 4V20C21 20.5523 20.5523 21 20 21H4C3.44772 21 3 20.5523 3 20V4Z"},child:[]}]})(s)}function HN(s){return jr({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M5.88889 16H2C1.44772 16 1 15.5523 1 15V9.00001C1 8.44772 1.44772 8.00001 2 8.00001H5.88889L11.1834 3.66815C11.3971 3.49329 11.7121 3.52479 11.887 3.73851C11.9601 3.82784 12 3.93971 12 4.05513V19.9449C12 20.221 11.7761 20.4449 11.5 20.4449C11.3846 20.4449 11.2727 20.405 11.1834 20.3319L5.88889 16ZM20.4142 12L23.9497 15.5355L22.5355 16.9498L19 13.4142L15.4645 16.9498L14.0503 15.5355L17.5858 12L14.0503 8.46447L15.4645 7.05026L19 10.5858L22.5355 7.05026L23.9497 8.46447L20.4142 12Z"},child:[]}]})(s)}function WN(s){return jr({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M2 16.0001H5.88889L11.1834 20.3319C11.2727 20.405 11.3846 20.4449 11.5 20.4449C11.7761 20.4449 12 20.2211 12 19.9449V4.05519C12 3.93977 11.9601 3.8279 11.887 3.73857C11.7121 3.52485 11.3971 3.49335 11.1834 3.66821L5.88889 8.00007H2C1.44772 8.00007 1 8.44778 1 9.00007V15.0001C1 15.5524 1.44772 16.0001 2 16.0001ZM23 12C23 15.292 21.5539 18.2463 19.2622 20.2622L17.8445 18.8444C19.7758 17.1937 21 14.7398 21 12C21 9.26016 19.7758 6.80629 17.8445 5.15557L19.2622 3.73779C21.5539 5.75368 23 8.70795 23 12ZM18 12C18 10.0883 17.106 8.38548 15.7133 7.28673L14.2842 8.71584C15.3213 9.43855 16 10.64 16 12C16 13.36 15.3213 14.5614 14.2842 15.2841L15.7133 16.7132C17.106 15.6145 18 13.9116 18 12Z"},child:[]}]})(s)}const zN=wt`
  display: flex;
  flex-direction: row;
  gap: 14px;
  align-items: center;
  justify-content: center;
`,GN=wt`
  appearance: none;
  background-color: transparent;
  width: 180px;

  &::-webkit-slider-runnable-track {
    height: 8px;
    background-color: #ffffff60;
    border-radius: 8px;
  }

  &::-moz-range-track {
    height: 8px;
    background-color: #ffffff60;
    border-radius: 8px;
  }

  &::-webkit-slider-thumb {
    box-sizing: border-box;
    appearance: none;
    position: relative;
    background-color: #ffffffdd;
    border-radius: 50%;
    width: 24px;
    height: 24px;
    top: 50%;
    translate: 0 -50%;
    transition: background-color 0.2s ease, transform 0.2s ease;
    cursor: pointer;
    &:hover {
      background-color: #ffffff;
      transform: scale(1.4);
    }
  }

  &::-moz-range-thumb {
    box-sizing: border-box;
    appearance: none;
    position: relative;
    background-color: #ffffffdd;
    border-radius: 50%;
    width: 24px;
    height: 24px;
    transition: background-color 0.2s ease, transform 0.2s ease;
    cursor: pointer;
    &:hover {
      background-color: #ffffff;
      transform: scale(1.4);
    }
  }
`,dy=wt`
  font-size: 1.6em;
  color: #ffffffdd;
  cursor: pointer;
  &:hover {
    color: #ffffff;
  }
`,UN=wt`
  font-size: 1.8em;
  margin-right: 10px;
  color: #ffffff;
`,fy=({value:s,onChange:e,Icon:t,...i})=>ve.jsxs("div",{className:zN,...i,children:[ve.jsx(t,{className:UN}),ve.jsx(HN,{className:dy,onClick:()=>e(0)}),ve.jsx("input",{type:"range",className:GN,min:0,max:1,step:.02,value:s,onChange:r=>e(r.target.valueAsNumber)}),ve.jsx(WN,{className:dy,onClick:()=>e(1)})]});function $N(s){return jr({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M219.05,201.94l-27.4-86.12,25.23-27.75a12,12,0,0,0-17.76-16.14L183.24,89.39l-15.1-47.45A19.93,19.93,0,0,0,149.08,28H106.91A19.93,19.93,0,0,0,87.85,41.94l-50.91,160A20,20,0,0,0,56,228H200a20,20,0,0,0,19.06-26.06ZM179.25,156H155.12L173,136.34ZM109.83,52h36.33l18.42,57.91L122.69,156H76.74ZM61.47,204l7.63-24H186.89l7.63,24Z"},child:[]}]})(s)}function YN(s){return jr({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M152.6 26.32L137.2 441.9 256 486.4l118.8-44.5-15.4-415.58L256 41.09 152.6 26.32zM64 89c-36 0-36 78 0 78h9.51l13-39-13-39H64zm374.5 0l-13 39 13 39h9.5c36 0 36-78 0-78h-9.5zM192 112a16 16 0 0 1 16 16 16 16 0 0 1-16 16 16 16 0 0 1-16-16 16 16 0 0 1 16-16zm128 0a16 16 0 0 1 16 16 16 16 0 0 1-16 16 16 16 0 0 1-16-16 16 16 0 0 1 16-16zm-217.6 7l2.1 6.2 1 2.8-3 9h28l.7-18h-28.8zm278.4 0l.7 18h28.1l-2.1-6.2-1-2.8 3-9h-28.7zM60 217c-36 0-36 78 0 78h9.51l13-39-13-39H60zm382.5 0l-13 39 13 39h9.5c36 0 36-78 0-78h-9.5zM192 240a16 16 0 0 1 16 16 16 16 0 0 1-16 16 16 16 0 0 1-16-16 16 16 0 0 1 16-16zm128 0a16 16 0 0 1 16 16 16 16 0 0 1-16 16 16 16 0 0 1-16-16 16 16 0 0 1 16-16zm-221.56 7l2.06 6.2 1 2.8-3 9h27.3l.7-18H98.44zm287.06 0l.7 18h27.4l-2.1-6.2-1-2.8 3-9h-28zM56 345c-36 0-36 78 0 78h9.51l13-39-13-39H56zm390.5 0l-13 39 13 39h9.5c36 0 36-78 0-78h-9.5zM192 368a16 16 0 0 1 16 16 16 16 0 0 1-16 16 16 16 0 0 1-16-16 16 16 0 0 1 16-16zm128 0a16 16 0 0 1 16 16 16 16 0 0 1-16 16 16 16 0 0 1-16-16 16 16 0 0 1 16-16zm-225.53 7l2.07 6.2.95 2.8-3 9h26.61l.6-18H94.47zm295.83 0l.6 18h26.7l-2.1-6.2-1-2.8 3-9h-27.2z"},child:[]}]})(s)}function XN(s){return jr({tag:"svg",attr:{viewBox:"0 0 15 15",fill:"none"},child:[{tag:"path",attr:{fillRule:"evenodd",clipRule:"evenodd",d:"M3.35355 1.85355C3.54882 1.65829 3.54882 1.34171 3.35355 1.14645C3.15829 0.951184 2.84171 0.951184 2.64645 1.14645L0.646447 3.14645C0.451184 3.34171 0.451184 3.65829 0.646447 3.85355L2.64645 5.85355C2.84171 6.04882 3.15829 6.04882 3.35355 5.85355C3.54882 5.65829 3.54882 5.34171 3.35355 5.14645L2.20711 4H9.5C11.433 4 13 5.567 13 7.5C13 7.77614 13.2239 8 13.5 8C13.7761 8 14 7.77614 14 7.5C14 5.01472 11.9853 3 9.5 3H2.20711L3.35355 1.85355ZM2 7.5C2 7.22386 1.77614 7 1.5 7C1.22386 7 1 7.22386 1 7.5C1 9.98528 3.01472 12 5.5 12H12.7929L11.6464 13.1464C11.4512 13.3417 11.4512 13.6583 11.6464 13.8536C11.8417 14.0488 12.1583 14.0488 12.3536 13.8536L14.3536 11.8536C14.5488 11.6583 14.5488 11.3417 14.3536 11.1464L12.3536 9.14645C12.1583 8.95118 11.8417 8.95118 11.6464 9.14645C11.4512 9.34171 11.4512 9.65829 11.6464 9.85355L12.7929 11H5.5C3.567 11 2 9.433 2 7.5Z",fill:"currentColor"},child:[]}]})(s)}const QN=wt`
  border-radius: 50%;
  width: 100px;
  height: 100px;
  background-color: #ffffff15;
  color: #ffffff;
  font-size: 50px;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: background-color 0.2s ease, outline 0.2s ease;
  border: none;
  &:hover {
    background-color: #ffffff40;
  }
  &:focus {
    outline: 2px solid #ffffff;
  }
`,fb=wt`
  border-radius: 50%;
  width: 60px;
  height: 60px;
  background-color: transparent;
  color: #ffffff;
  font-size: 25px;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: background-color 0.2s ease, outline 0.2s ease;
  background-color: #ffffff20;
  border: none;
  &:hover {
    background-color: #ffffff40;
  }
  &:focus {
    outline: 2px solid #ffffff;
  }
`,JN=wt`
  background-color: #ffffff60;
  &:hover {
    background-color: #ffffff60;
  }
`,qN=({onClick:s,isToggled:e,...t})=>ve.jsx("button",{className:QN,onClick:s,...t,children:e?ve.jsx(IN,{}):ve.jsx(ON,{})}),KN=({onClick:s,isToggled:e,...t})=>{const i=Bw(fb,e?JN:null);return ve.jsx("button",{className:i,onClick:s,...t,children:ve.jsx(XN,{})})},jN=({onClick:s,...e})=>ve.jsx("button",{className:fb,onClick:s,...e,children:ve.jsx(VN,{})}),ZN=wt`
  fill: #ffffff;
`,eP=wt`
  fill: #ffffff99; ;
`,tP=wt`
  fill: #ffffff;
`,iP=wt`
  font-size: 0.85em;
  color: #ffffff99;
`,sP=wt`
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  opacity: 0.8;
  height: 100%;
  gap: 4px;
  cursor: pointer;
  transition: opacity 0.2s ease;
  &:hover {
    opacity: 1;
  }
`,rP=({className:s})=>{const{t:e}=ux();return ve.jsxs("a",{className:Bw(sP,s),href:"https://alphatab.net",children:[ve.jsx("span",{className:iP,children:e("Score.AlphaTabRenderedBy")}),ve.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:200,viewBox:"120 30 550 160",className:s,children:[ve.jsx("path",{className:ZN,d:"M272.361,127.215a40.439,40.439,0,0,1-7.987,12.887,14.527,14.527,0,0,1-17.38,2.956,15.5,15.5,0,0,1-5.228-4.65,22.556,22.556,0,0,1-3.333-7.175,34.1,34.1,0,0,1-1.178-9.242,38.739,38.739,0,0,1,1.322-10.39,26.12,26.12,0,0,1,3.792-8.237,17.9,17.9,0,0,1,6.033-5.425,16.344,16.344,0,0,1,7.986-1.952,12.464,12.464,0,0,1,6.78,1.808,17.174,17.174,0,0,1,5.056,5.052,34.849,34.849,0,0,1,3.792,7.749,101.456,101.456,0,0,1,2.93,9.9Zm18.989,22.99q1.062-.2,2.384-0.545v-6.487q-0.633.173-1.293,0.287a8.18,8.18,0,0,1-1.407.115,4.053,4.053,0,0,1-2.471-.8,8.223,8.223,0,0,1-2.183-3.3,49.048,49.048,0,0,1-2.27-7.06q-1.178-4.565-2.729-12.026L292.7,91.05h-7.929l-6.32,18.714h-0.173A54.687,54.687,0,0,0,275,102.043a27.1,27.1,0,0,0-4.568-6.4,20.347,20.347,0,0,0-6.177-4.363,18.961,18.961,0,0,0-7.986-1.607,25.155,25.155,0,0,0-11.232,2.44,23.773,23.773,0,0,0-8.36,6.774,31.172,31.172,0,0,0-5.2,10.361,45.78,45.78,0,0,0-1.81,13.2,39.2,39.2,0,0,0,1.638,11.653,27.415,27.415,0,0,0,4.654,9.07,21.447,21.447,0,0,0,7.268,5.913,20.8,20.8,0,0,0,9.422,2.123,22.808,22.808,0,0,0,7.412-1.176,20.69,20.69,0,0,0,6.435-3.617,29.477,29.477,0,0,0,5.573-6.2,55.7,55.7,0,0,0,4.884-8.927h0.23q1.033,4.881,2.154,8.5a29.909,29.909,0,0,0,2.471,5.97,10.615,10.615,0,0,0,2.988,3.5,6.391,6.391,0,0,0,3.763,1.148A15.575,15.575,0,0,0,291.35,150.205Zm16.523-.373V62.808h-7.355v87.024h7.355Zm21.837-9.472q6.147,10.849,18.558,10.849a25.024,25.024,0,0,0,11.06-2.382,24,24,0,0,0,8.36-6.687,30.671,30.671,0,0,0,5.286-10.3,45.243,45.243,0,0,0,1.838-13.289,40.843,40.843,0,0,0-1.637-12,26.158,26.158,0,0,0-4.711-9.069,20.89,20.89,0,0,0-7.527-5.769,25.565,25.565,0,0,0-22.465,1.206,23.365,23.365,0,0,0-8.762,9.386h-0.23V91.05h-7.354v85.819h7.354V140.36h0.23Zm-0.23-22.789a25.064,25.064,0,0,1,1.379-8.352,20.471,20.471,0,0,1,3.965-6.86,18.652,18.652,0,0,1,6.262-4.621,19.561,19.561,0,0,1,8.274-1.693,17.175,17.175,0,0,1,7.383,1.55,15.551,15.551,0,0,1,5.63,4.478,21.124,21.124,0,0,1,3.591,7.089,32.071,32.071,0,0,1,1.264,9.328,40.881,40.881,0,0,1-1.35,10.907,25.723,25.723,0,0,1-3.849,8.324,17.429,17.429,0,0,1-6.062,5.309,16.936,16.936,0,0,1-7.986,1.866,18.084,18.084,0,0,1-7.555-1.55,17.481,17.481,0,0,1-5.832-4.219,19.555,19.555,0,0,1-3.764-6.2,20.947,20.947,0,0,1-1.35-7.548v-7.807Zm102.505,32.261V113.5q0-11.766-4.941-17.795t-14.766-6.027q-12.872,0-19.765,11.538h-0.23v-38.4h-7.354v87.024h7.354V116.94a25.054,25.054,0,0,1,1.437-8.755,20.34,20.34,0,0,1,3.849-6.572,16.51,16.51,0,0,1,12.411-5.568q7.525,0,11.089,4.678t3.562,14.552v34.557h7.354Zm51.37-22.617a40.439,40.439,0,0,1-7.987,12.887,14.527,14.527,0,0,1-17.38,2.956,15.5,15.5,0,0,1-5.228-4.65,22.556,22.556,0,0,1-3.333-7.175,34.1,34.1,0,0,1-1.177-9.242,38.74,38.74,0,0,1,1.321-10.39,26.12,26.12,0,0,1,3.792-8.237,17.9,17.9,0,0,1,6.033-5.425,16.344,16.344,0,0,1,7.986-1.952,12.464,12.464,0,0,1,6.78,1.808,17.174,17.174,0,0,1,5.056,5.052,34.849,34.849,0,0,1,3.792,7.749,101.18,101.18,0,0,1,2.93,9.9Zm18.989,22.99q1.062-.2,2.384-0.545v-6.487q-0.633.173-1.293,0.287a8.171,8.171,0,0,1-1.407.115,4.053,4.053,0,0,1-2.471-.8,8.223,8.223,0,0,1-2.183-3.3,49.048,49.048,0,0,1-2.27-7.06q-1.177-4.565-2.729-12.026L503.694,91.05h-7.929l-6.32,18.714h-0.172A54.807,54.807,0,0,0,486,102.043a27.076,27.076,0,0,0-4.568-6.4,20.347,20.347,0,0,0-6.177-4.363,18.961,18.961,0,0,0-7.986-1.607,25.155,25.155,0,0,0-11.232,2.44,23.782,23.782,0,0,0-8.36,6.774,31.172,31.172,0,0,0-5.2,10.361,45.78,45.78,0,0,0-1.81,13.2A39.2,39.2,0,0,0,442.3,134.1a27.434,27.434,0,0,0,4.654,9.07,21.447,21.447,0,0,0,7.268,5.913,20.8,20.8,0,0,0,9.423,2.123,22.806,22.806,0,0,0,7.411-1.176,20.69,20.69,0,0,0,6.435-3.617,29.477,29.477,0,0,0,5.573-6.2,55.7,55.7,0,0,0,4.884-8.927h0.23q1.034,4.881,2.154,8.5a29.909,29.909,0,0,0,2.471,5.97,10.626,10.626,0,0,0,2.988,3.5,6.393,6.393,0,0,0,3.763,1.148A15.575,15.575,0,0,0,502.344,150.205Z"}),ve.jsx("path",{className:eP,d:"M560.53,74.518v-7H505.373v7H529.1v75.314h7.642V74.518H560.53Zm36.431,75.314V111.6q0-10.906-5.027-16.418t-14.852-5.511a34.089,34.089,0,0,0-5.315.431,40.4,40.4,0,0,0-5.314,1.206,38.371,38.371,0,0,0-4.913,1.837,24.746,24.746,0,0,0-4.165,2.382v8.036q8.79-7.519,19.075-7.519,13.156,0,13.157,16.934l-17.868,2.583q-10,1.436-14.939,6.171t-4.941,12.715a17.574,17.574,0,0,0,1.293,6.831,15.016,15.016,0,0,0,3.677,5.309,16.459,16.459,0,0,0,5.8,3.416,22.943,22.943,0,0,0,7.67,1.205,20.793,20.793,0,0,0,11.233-3.1,21.592,21.592,0,0,0,7.842-8.726h0.23v10.448h7.354Zm-7.354-30.654v5.8a22.984,22.984,0,0,1-1.35,7.979,19.184,19.184,0,0,1-3.735,6.315,16.964,16.964,0,0,1-12.841,5.625,15.311,15.311,0,0,1-5.142-.8,10.944,10.944,0,0,1-3.85-2.267,9.77,9.77,0,0,1-2.413-3.473,11.263,11.263,0,0,1-.833-4.363,14.329,14.329,0,0,1,.862-5.309,8.663,8.663,0,0,1,2.7-3.617,13.944,13.944,0,0,1,4.654-2.325,46.1,46.1,0,0,1,6.78-1.435Zm27.928,21.182q6.09,10.849,18.558,10.849a24.891,24.891,0,0,0,11-2.382,23.994,23.994,0,0,0,8.359-6.687,31.049,31.049,0,0,0,5.315-10.3,44.6,44.6,0,0,0,1.867-13.289A40.411,40.411,0,0,0,661,106.664a26.788,26.788,0,0,0-4.711-9.127,20.619,20.619,0,0,0-7.527-5.826A25.565,25.565,0,0,0,626.3,92.916a23.365,23.365,0,0,0-8.762,9.386H617.3V62.808h-7.354v87.024H617.3V140.36h0.23Zm-0.23-22.789a25.064,25.064,0,0,1,1.379-8.352,20.486,20.486,0,0,1,3.964-6.86,18.656,18.656,0,0,1,6.263-4.621,19.561,19.561,0,0,1,8.274-1.693,17.175,17.175,0,0,1,7.383,1.55,15.551,15.551,0,0,1,5.63,4.478,21.124,21.124,0,0,1,3.591,7.089,32.071,32.071,0,0,1,1.264,9.328A40.881,40.881,0,0,1,653.7,129.4a25.723,25.723,0,0,1-3.849,8.324,17.429,17.429,0,0,1-6.062,5.309,16.936,16.936,0,0,1-7.986,1.866,18.092,18.092,0,0,1-7.556-1.55,17.477,17.477,0,0,1-5.831-4.219,19.555,19.555,0,0,1-3.764-6.2,20.947,20.947,0,0,1-1.35-7.548v-7.807Z"}),ve.jsx("path",{className:tP,d:"M169.275,36.386V142.305c-2.905-3.491-7.753-5.425-14.038-5.425-14.459,0-27.1,11.607-27.1,24.378,0,9.766,6.728,14.635,17.088,14.635,15.636,0,27.031-11.977,27.1-24.3V65.77c15.4,7.886,26.484,15.751,32.457,27.168C210.83,104.5,207,120.5,190.548,135.122c-0.421,1.521.258,2.306,1.447,2.254,29.206-24.517,24.482-55.245-2.072-76.383-8.654-6.888-14.95-16.1-17.6-24.608h-3.05Z"})]})]})},nP=wt`
  padding: 0px 40px;
  display: grid;
  grid-template-columns: 1fr 1fr 1fr;
  align-items: center;
  height: 160px;
  width: 100%;
  background-color: #ffffff15;
`,aP=wt`
  display: flex;
  flex-direction: column;
  gap: 10px;
  justify-self: start;
`,oP=wt`
  display: flex;
  flex-direction: column;
  gap: 10px;
  align-items: center;
  justify-content: center;
`,lP=wt`
  display: flex;
  flex-direction: row;
  align-items: center;
  justify-content: center;
  justify-self: center;
  gap: 10px;
`,hP=wt`
  justify-self: end;
`,uP=({isPlaying:s,isLooping:e,instrumentVolume:t,metronomeVolume:i,onPlayPause:r,onLoop:n,onStop:a,onInstrumentVolumeChange:o,onMetronomeVolumeChange:l})=>ve.jsxs("div",{className:nP,children:[ve.jsxs("div",{className:aP,children:[ve.jsx(fy,{Icon:$N,value:i,onChange:l}),ve.jsx(fy,{Icon:YN,value:t,onChange:o})]}),ve.jsx("div",{className:oP,children:ve.jsxs("div",{className:lP,children:[ve.jsx(jN,{onClick:a}),ve.jsx(qN,{onClick:r,isToggled:s}),ve.jsx(KN,{onClick:n,isToggled:e})]})}),ve.jsx(rP,{className:hP})]});var pb={exports:{}},gb={};/**
 * @license React
 * use-sync-external-store-with-selector.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var cl=be;function cP(s,e){return s===e&&(s!==0||1/s===1/e)||s!==s&&e!==e}var dP=typeof Object.is=="function"?Object.is:cP,fP=cl.useSyncExternalStore,pP=cl.useRef,gP=cl.useEffect,mP=cl.useMemo,yP=cl.useDebugValue;gb.useSyncExternalStoreWithSelector=function(s,e,t,i,r){var n=pP(null);if(n.current===null){var a={hasValue:!1,value:null};n.current=a}else a=n.current;n=mP(function(){function l(p){if(!h){if(h=!0,u=p,p=i(p),r!==void 0&&a.hasValue){var g=a.value;if(r(g,p))return c=g}return c=p}if(g=c,dP(u,p))return g;var w=i(p);return r!==void 0&&r(g,w)?g:(u=p,c=w)}var h=!1,u,c,d=t===void 0?null:t;return[function(){return l(e())},d===null?void 0:function(){return l(d())}]},[e,t,i,r]);var o=fP(s,n[0],n[1]);return gP(function(){a.hasValue=!0,a.value=o},[o]),yP(o),o};pb.exports=gb;var wP=pb.exports,$i="default"in fo?lr:fo,py=Symbol.for("react-redux-context"),gy=typeof globalThis<"u"?globalThis:{};function bP(){if(!$i.createContext)return{};const s=gy[py]??(gy[py]=new Map);let e=s.get($i.createContext);return e||(e=$i.createContext(null),s.set($i.createContext,e)),e}var Wh=bP(),SP=()=>{throw new Error("uSES not initialized!")};function mb(s=Wh){return function(){return $i.useContext(s)}}var kP=mb(),yb=SP,_P=s=>{yb=s},BP=(s,e)=>s===e;function xP(s=Wh){const e=s===Wh?kP:mb(s),t=(i,r={})=>{const{equalityFn:n=BP,devModeChecks:a={}}=typeof r=="function"?{equalityFn:r}:r,{store:o,subscription:l,getServerState:h,stabilityCheck:u,identityFunctionCheck:c}=e();$i.useRef(!0);const d=$i.useCallback({[i.name](g){return i(g)}}[i.name],[i,u,a.stabilityCheck]),p=yb(l.addNestedSub,o.getState,h||o.getState,d,n);return $i.useDebugValue(p),p};return Object.assign(t,{withTypes:()=>t}),t}var my=xP();function vP(s){s()}function TP(){let s=null,e=null;return{clear(){s=null,e=null},notify(){vP(()=>{let t=s;for(;t;)t.callback(),t=t.next})},get(){const t=[];let i=s;for(;i;)t.push(i),i=i.next;return t},subscribe(t){let i=!0;const r=e={callback:t,next:null,prev:e};return r.prev?r.prev.next=r:s=r,function(){!i||s===null||(i=!1,r.next?r.next.prev=r.prev:e=r.prev,r.prev?r.prev.next=r.next:s=r.next)}}}}var yy={notify(){},get:()=>[]};function NP(s,e){let t,i=yy,r=0,n=!1;function a(w){u();const S=i.subscribe(w);let b=!1;return()=>{b||(b=!0,S(),c())}}function o(){i.notify()}function l(){g.onStateChange&&g.onStateChange()}function h(){return n}function u(){r++,t||(t=s.subscribe(l),i=TP())}function c(){r--,t&&r===0&&(t(),t=void 0,i.clear(),i=yy)}function d(){n||(n=!0,u())}function p(){n&&(n=!1,c())}const g={addNestedSub:a,notifyNestedSubs:o,handleChangeWrapper:l,isSubscribed:h,trySubscribe:d,tryUnsubscribe:p,getListeners:()=>i};return g}var PP=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",CP=typeof navigator<"u"&&navigator.product==="ReactNative",EP=PP||CP?$i.useLayoutEffect:$i.useEffect;function LP({store:s,context:e,children:t,serverState:i,stabilityCheck:r="once",identityFunctionCheck:n="once"}){const a=$i.useMemo(()=>{const h=NP(s);return{store:s,subscription:h,getServerState:i?()=>i:void 0,stabilityCheck:r,identityFunctionCheck:n}},[s,i,r,n]),o=$i.useMemo(()=>s.getState(),[s]);EP(()=>{const{subscription:h}=a;return h.onStateChange=h.notifyNestedSubs,h.trySubscribe(),o!==s.getState()&&h.notifyNestedSubs(),()=>{h.tryUnsubscribe(),h.onStateChange=void 0}},[a,o]);const l=e||Wh;return $i.createElement(l.Provider,{value:a},t)}var MP=LP;_P(wP.useSyncExternalStoreWithSelector);var Fr=(s=>(s.WHOLE="WHOLE",s.HALF="HALF",s.DOTTED_HALF="DOTTED_HALF",s.QUARTER="QUARTER",s.DOTTED_QUARTER="DOTTED_QUARTER",s.EIGHT="EIGHT",s.DOTTED_EIGHT="DOTTED_EIGHT",s.SIXTEENTH="SIXTEENTH",s.DOTTED_SIXTEENTH="DOTTED_SIXTEENTH",s))(Fr||{}),Ko=(s=>(s.BASS="Bass",s.TREBLE="Treble",s))(Ko||{}),di=(s=>(s.C_MAJOR_A_MINOR="C",s.G_MAJOR_E_MINOR_1_SHARP="G",s.D_MAJOR_B_MINOR_2_SHARPS="D",s.A_MAJOR_F_SHARP_MINOR_3_SHARPS="A",s.E_MAJOR_C_SHARP_MINOR_4_SHARPS="E",s.B_MAJOR_G_SHARP_MINOR_5_SHARPS="B",s.F_SHARP_MAJOR_D_SHARP_MINOR_6_SHARPS="F#",s.C_SHARP_MAJOR_A_SHARP_MINOR_7_SHARPS="C#",s.F_MAJOR_D_MINOR_1_FLAT="F",s.Bb_MAJOR_G_MINOR_2_FLATS="Bb",s.Eb_MAJOR_C_MINOR_2_FLATS="Eb",s.Ab_MAJOR_F_MINOR_4_FLATS="Ab",s.Db_MAJOR_Bb_MINOR_5_FLATS="Db",s.Gb_MAJOR_Eb_MINOR_6_FLATS="Gb",s.Cb_MAJOR_Ab_MINOR_7_FLATS="Gb",s))(di||{});function wb(s){return s!==null&&typeof s=="object"&&"name"in s&&typeof s.name=="string"}function bb(s){return s!==null&&typeof s=="object"&&"step"in s&&typeof s.step=="number"&&"alt"in s&&typeof s.alt=="number"&&!isNaN(s.step)&&!isNaN(s.alt)}var Sb=[0,2,4,-1,1,3,5],kb=Sb.map(s=>Math.floor(s*7/12));function _b(s){const{step:e,alt:t,oct:i,dir:r=1}=s,n=Sb[e]+7*t;if(i===void 0)return[r*n];const a=i-kb[e]-4*t;return[r*n,r*a]}var FP=[3,0,4,1,5,2,6];function Bb(s){const[e,t,i]=s,r=FP[RP(e)],n=Math.floor((e+1)/7);if(t===void 0)return{step:r,alt:n,dir:i};const a=t+4*n+kb[r];return{step:r,alt:n,oct:a,dir:i}}function RP(s){const e=(s+1)%7;return e<0?7+e:e}var wy=(s,e)=>Array(Math.abs(e)+1).join(s),zd=Object.freeze({empty:!0,name:"",num:NaN,q:"",type:"",step:NaN,alt:NaN,dir:NaN,simple:NaN,semitones:NaN,chroma:NaN,coord:[],oct:NaN}),DP="([-+]?\\d+)(d{1,4}|m|M|P|A{1,4})",AP="(AA|A|P|M|m|d|dd)([-+]?\\d+)",IP=new RegExp("^"+DP+"|"+AP+"$");function OP(s){const e=IP.exec(`${s}`);return e===null?["",""]:e[1]?[e[1],e[2]]:[e[4],e[3]]}var by={};function Bi(s){return typeof s=="string"?by[s]||(by[s]=VP(s)):bb(s)?Bi(WP(s)):wb(s)?Bi(s.name):zd}var Sy=[0,2,4,5,7,9,11],xb="PMMPPMM";function VP(s){const e=OP(s);if(e[0]==="")return zd;const t=+e[0],i=e[1],r=(Math.abs(t)-1)%7,n=xb[r];if(n==="M"&&i==="P")return zd;const a=n==="M"?"majorable":"perfectable",o=""+t+i,l=t<0?-1:1,h=t===8||t===-8?t:l*(r+1),u=HP(a,i),c=Math.floor((Math.abs(t)-1)/7),d=l*(Sy[r]+u+12*c),p=(l*(Sy[r]+u)%12+12)%12,g=_b({step:r,alt:u,oct:c,dir:l});return{empty:!1,name:o,num:t,q:i,step:r,alt:u,dir:l,type:a,simple:h,semitones:d,chroma:p,coord:g,oct:c}}function Sp(s,e){const[t,i=0]=s,r=t*7+i*12<0,n=e||r?[-t,-i,-1]:[t,i,1];return Bi(Bb(n))}function HP(s,e){return e==="M"&&s==="majorable"||e==="P"&&s==="perfectable"?0:e==="m"&&s==="majorable"?-1:/^A+$/.test(e)?e.length:/^d+$/.test(e)?-1*(s==="perfectable"?e.length:e.length+1):0}function WP(s){const{step:e,alt:t,oct:i=0,dir:r}=s;if(!r)return"";const n=e+1+7*i,a=n===0?e+1:n,o=r<0?"-":"",l=xb[e]==="M"?"majorable":"perfectable";return o+a+zP(l,t)}function zP(s,e){return e===0?s==="majorable"?"M":"P":e===-1&&s==="majorable"?"m":e>0?wy("A",e):wy("d",s==="perfectable"?e:e+1)}var ky=(s,e)=>Array(Math.abs(e)+1).join(s),vb=Object.freeze({empty:!0,name:"",letter:"",acc:"",pc:"",step:NaN,alt:NaN,chroma:NaN,height:NaN,coord:[],midi:null,freq:null}),_y=new Map,GP=s=>"CDEFGAB".charAt(s),UP=s=>s<0?ky("b",-s):ky("#",s),$P=s=>s[0]==="b"?-s.length:s.length;function zt(s){const e=JSON.stringify(s),t=_y.get(e);if(t)return t;const i=typeof s=="string"?qP(s):bb(s)?zt(KP(s)):wb(s)?zt(s.name):vb;return _y.set(e,i),i}var YP=/^([a-gA-G]?)(#{1,}|b{1,}|x{1,}|)(-?\d*)\s*(.*)$/;function XP(s){const e=YP.exec(s);return e?[e[1].toUpperCase(),e[2].replace(/x/g,"##"),e[3],e[4]]:["","","",""]}function QP(s){return zt(Bb(s))}var JP=(s,e)=>(s%e+e)%e,vc=[0,2,4,5,7,9,11];function qP(s){const e=XP(s);if(e[0]===""||e[3]!=="")return vb;const t=e[0],i=e[1],r=e[2],n=(t.charCodeAt(0)+3)%7,a=$P(i),o=r.length?+r:void 0,l=_b({step:n,alt:a,oct:o}),h=t+i+r,u=t+i,c=(vc[n]+a+120)%12,d=o===void 0?JP(vc[n]+a,12)-12*99:vc[n]+a+12*(o+1),p=d>=0&&d<=127?d:null,g=o===void 0?null:Math.pow(2,(d-69)/12)*440;return{empty:!1,acc:i,alt:a,chroma:c,coord:l,freq:g,height:d,letter:t,midi:p,name:h,oct:o,pc:u,step:n}}function KP(s){const{step:e,alt:t,oct:i}=s,r=GP(e);if(!r)return"";const n=r+UP(t);return i||i===0?n+i:n}function va(s,e){const t=zt(s),i=Array.isArray(e)?e:Bi(e).coord;if(t.empty||!i||i.length<2)return"";const r=t.coord,n=r.length===1?[r[0]+i[0]]:[r[0]+i[0],r[1]+i[1]];return QP(n).name}function Tb(s,e){const t=s.length;return i=>{if(!e)return"";const r=i<0?(t- -i%t)%t:i%t,n=Math.floor(i/t),a=va(e,[0,n]);return va(a,s[r])}}function Nb(s,e){const t=zt(s),i=zt(e);if(t.empty||i.empty)return"";const r=t.coord,n=i.coord,a=n[0]-r[0],o=r.length===2&&n.length===2?n[1]-r[1]:-Math.floor(a*7/12),l=i.height===t.height&&i.midi!==null&&t.midi!==null&&t.step>i.step;return Sp([a,o],l).name}function jP(s,e,t){return function(...i){return console.warn(`${s} is deprecated. Use ${e}.`),t.apply(this,i)}}function ZP(s,e){const t=[];for(;e--;t[e]=e+s);return t}function e2(s,e){const t=[];for(;e--;t[e]=s-e);return t}function t2(s,e){return s<e?ZP(s,e-s+1):e2(s,s-e+1)}function dl(s,e){const t=e.length,i=(s%t+t)%t;return e.slice(i,t).concat(e.slice(0,i))}function i2(s){return s.filter(e=>e===0||e)}var Cn={empty:!0,name:"",setNum:0,chroma:"000000000000",normalized:"000000000000",intervals:[]},Pb=s=>Number(s).toString(2).padStart(12,"0"),By=s=>parseInt(s,2),s2=/^[01]{12}$/;function kp(s){return s2.test(s)}var r2=s=>typeof s=="number"&&s>=0&&s<=4095,n2=s=>s&&kp(s.chroma),xy={[Cn.chroma]:Cn};function Qr(s){const e=kp(s)?s:r2(s)?Pb(s):Array.isArray(s)?f2(s):n2(s)?s.chroma:Cn.chroma;return xy[e]=xy[e]||d2(e)}var a2=s=>Qr(s).chroma,o2=["1P","2m","2M","3m","3M","4P","5d","5P","6m","6M","7m","7M"];function l2(s){const e=[];for(let t=0;t<12;t++)s.charAt(t)==="1"&&e.push(o2[t]);return e}function h2(s,e=!0){const i=Qr(s).chroma.split("");return i2(i.map((r,n)=>{const a=dl(n,i);return e&&a[0]==="0"?null:a.join("")}))}function Cb(s){const e=Qr(s).setNum;return t=>{const i=Qr(t).setNum;return e&&e!==i&&(i&e)===i}}function u2(s){const e=Qr(s).setNum;return t=>{const i=Qr(t).setNum;return e&&e!==i&&(i|e)===i}}function c2(s){const e=s.split("");return e.map((t,i)=>dl(i,e).join(""))}function d2(s){const e=By(s),t=c2(s).map(By).filter(n=>n>=2048).sort()[0],i=Pb(t),r=l2(s);return{empty:!1,name:"",setNum:e,chroma:s,normalized:i,intervals:r}}function f2(s){if(s.length===0)return Cn.chroma;let e;const t=[0,0,0,0,0,0,0,0,0,0,0,0];for(let i=0;i<s.length;i++)e=zt(s[i]),e.empty&&(e=Bi(s[i])),e.empty||(t[e.chroma]=1);return t.join("")}var p2=[["1P 3M 5P","major","M ^  maj"],["1P 3M 5P 7M","major seventh","maj7 Δ ma7 M7 Maj7 ^7"],["1P 3M 5P 7M 9M","major ninth","maj9 Δ9 ^9"],["1P 3M 5P 7M 9M 13M","major thirteenth","maj13 Maj13 ^13"],["1P 3M 5P 6M","sixth","6 add6 add13 M6"],["1P 3M 5P 6M 9M","sixth added ninth","6add9 6/9 69 M69"],["1P 3M 6m 7M","major seventh flat sixth","M7b6 ^7b6"],["1P 3M 5P 7M 11A","major seventh sharp eleventh","maj#4 Δ#4 Δ#11 M7#11 ^7#11 maj7#11"],["1P 3m 5P","minor","m min -"],["1P 3m 5P 7m","minor seventh","m7 min7 mi7 -7"],["1P 3m 5P 7M","minor/major seventh","m/ma7 m/maj7 mM7 mMaj7 m/M7 -Δ7 mΔ -^7 -maj7"],["1P 3m 5P 6M","minor sixth","m6 -6"],["1P 3m 5P 7m 9M","minor ninth","m9 -9"],["1P 3m 5P 7M 9M","minor/major ninth","mM9 mMaj9 -^9"],["1P 3m 5P 7m 9M 11P","minor eleventh","m11 -11"],["1P 3m 5P 7m 9M 13M","minor thirteenth","m13 -13"],["1P 3m 5d","diminished","dim ° o"],["1P 3m 5d 7d","diminished seventh","dim7 °7 o7"],["1P 3m 5d 7m","half-diminished","m7b5 ø -7b5 h7 h"],["1P 3M 5P 7m","dominant seventh","7 dom"],["1P 3M 5P 7m 9M","dominant ninth","9"],["1P 3M 5P 7m 9M 13M","dominant thirteenth","13"],["1P 3M 5P 7m 11A","lydian dominant seventh","7#11 7#4"],["1P 3M 5P 7m 9m","dominant flat ninth","7b9"],["1P 3M 5P 7m 9A","dominant sharp ninth","7#9"],["1P 3M 7m 9m","altered","alt7"],["1P 4P 5P","suspended fourth","sus4 sus"],["1P 2M 5P","suspended second","sus2"],["1P 4P 5P 7m","suspended fourth seventh","7sus4 7sus"],["1P 5P 7m 9M 11P","eleventh","11"],["1P 4P 5P 7m 9m","suspended fourth flat ninth","b9sus phryg 7b9sus 7b9sus4"],["1P 5P","fifth","5"],["1P 3M 5A","augmented","aug + +5 ^#5"],["1P 3m 5A","minor augmented","m#5 -#5 m+"],["1P 3M 5A 7M","augmented seventh","maj7#5 maj7+5 +maj7 ^7#5"],["1P 3M 5P 7M 9M 11A","major sharp eleventh (lydian)","maj9#11 Δ9#11 ^9#11"],["1P 2M 4P 5P","","sus24 sus4add9"],["1P 3M 5A 7M 9M","","maj9#5 Maj9#5"],["1P 3M 5A 7m","","7#5 +7 7+ 7aug aug7"],["1P 3M 5A 7m 9A","","7#5#9 7#9#5 7alt"],["1P 3M 5A 7m 9M","","9#5 9+"],["1P 3M 5A 7m 9M 11A","","9#5#11"],["1P 3M 5A 7m 9m","","7#5b9 7b9#5"],["1P 3M 5A 7m 9m 11A","","7#5b9#11"],["1P 3M 5A 9A","","+add#9"],["1P 3M 5A 9M","","M#5add9 +add9"],["1P 3M 5P 6M 11A","","M6#11 M6b5 6#11 6b5"],["1P 3M 5P 6M 7M 9M","","M7add13"],["1P 3M 5P 6M 9M 11A","","69#11"],["1P 3m 5P 6M 9M","","m69 -69"],["1P 3M 5P 6m 7m","","7b6"],["1P 3M 5P 7M 9A 11A","","maj7#9#11"],["1P 3M 5P 7M 9M 11A 13M","","M13#11 maj13#11 M13+4 M13#4"],["1P 3M 5P 7M 9m","","M7b9"],["1P 3M 5P 7m 11A 13m","","7#11b13 7b5b13"],["1P 3M 5P 7m 13M","","7add6 67 7add13"],["1P 3M 5P 7m 9A 11A","","7#9#11 7b5#9 7#9b5"],["1P 3M 5P 7m 9A 11A 13M","","13#9#11"],["1P 3M 5P 7m 9A 11A 13m","","7#9#11b13"],["1P 3M 5P 7m 9A 13M","","13#9"],["1P 3M 5P 7m 9A 13m","","7#9b13"],["1P 3M 5P 7m 9M 11A","","9#11 9+4 9#4"],["1P 3M 5P 7m 9M 11A 13M","","13#11 13+4 13#4"],["1P 3M 5P 7m 9M 11A 13m","","9#11b13 9b5b13"],["1P 3M 5P 7m 9m 11A","","7b9#11 7b5b9 7b9b5"],["1P 3M 5P 7m 9m 11A 13M","","13b9#11"],["1P 3M 5P 7m 9m 11A 13m","","7b9b13#11 7b9#11b13 7b5b9b13"],["1P 3M 5P 7m 9m 13M","","13b9"],["1P 3M 5P 7m 9m 13m","","7b9b13"],["1P 3M 5P 7m 9m 9A","","7b9#9"],["1P 3M 5P 9M","","Madd9 2 add9 add2"],["1P 3M 5P 9m","","Maddb9"],["1P 3M 5d","","Mb5"],["1P 3M 5d 6M 7m 9M","","13b5"],["1P 3M 5d 7M","","M7b5"],["1P 3M 5d 7M 9M","","M9b5"],["1P 3M 5d 7m","","7b5"],["1P 3M 5d 7m 9M","","9b5"],["1P 3M 7m","","7no5"],["1P 3M 7m 13m","","7b13"],["1P 3M 7m 9M","","9no5"],["1P 3M 7m 9M 13M","","13no5"],["1P 3M 7m 9M 13m","","9b13"],["1P 3m 4P 5P","","madd4"],["1P 3m 5P 6m 7M","","mMaj7b6"],["1P 3m 5P 6m 7M 9M","","mMaj9b6"],["1P 3m 5P 7m 11P","","m7add11 m7add4"],["1P 3m 5P 9M","","madd9"],["1P 3m 5d 6M 7M","","o7M7"],["1P 3m 5d 7M","","oM7"],["1P 3m 6m 7M","","mb6M7"],["1P 3m 6m 7m","","m7#5"],["1P 3m 6m 7m 9M","","m9#5"],["1P 3m 5A 7m 9M 11P","","m11A"],["1P 3m 6m 9m","","mb6b9"],["1P 2M 3m 5d 7m","","m9b5"],["1P 4P 5A 7M","","M7#5sus4"],["1P 4P 5A 7M 9M","","M9#5sus4"],["1P 4P 5A 7m","","7#5sus4"],["1P 4P 5P 7M","","M7sus4"],["1P 4P 5P 7M 9M","","M9sus4"],["1P 4P 5P 7m 9M","","9sus4 9sus"],["1P 4P 5P 7m 9M 13M","","13sus4 13sus"],["1P 4P 5P 7m 9m 13m","","7sus4b9b13 7b9b13sus4"],["1P 4P 7m 10m","","4 quartal"],["1P 5P 7m 9m 11P","","11b9"]],g2=p2;({...Cn});var _p=[],ih={};function m2(){return _p.slice()}function y2(s,e,t){const i=b2(s),r={...Qr(s),name:t||"",quality:i,intervals:s,aliases:e};_p.push(r),r.name&&(ih[r.name]=r),ih[r.setNum]=r,ih[r.chroma]=r,r.aliases.forEach(n=>w2(r,n))}function w2(s,e){ih[e]=s}function b2(s){const e=t=>s.indexOf(t)!==-1;return e("5A")?"Augmented":e("3M")?"Major":e("5d")?"Diminished":e("3m")?"Minor":"Unknown"}g2.forEach(([s,e,t])=>y2(s.split(" "),t.split(" "),e));_p.sort((s,e)=>s.setNum-e.setNum);function S2(){return"1P 2M 3M 4P 5P 6m 7m".split(" ")}var Eb=Bi,k2=s=>Bi(s).name,_2=s=>Bi(s).semitones,B2=s=>Bi(s).q,x2=s=>Bi(s).num;function v2(s){const e=Bi(s);return e.empty?"":e.simple+e.q}function T2(s){const e=Bi(s);if(e.empty)return"";const t=(7-e.step)%7,i=e.type==="perfectable"?-e.alt:-(e.alt+1);return Bi({step:t,alt:i,oct:e.oct,dir:e.dir}).name}var N2=[1,2,2,3,3,4,5,5,6,6,7,7],P2="P m M m M P d P m M m M".split(" ");function C2(s){const e=s<0?-1:1,t=Math.abs(s),i=t%12,r=Math.floor(t/12);return e*(N2[i]+7*r)+P2[i]}var E2=Nb,Lb=Mb((s,e)=>[s[0]+e[0],s[1]+e[1]]),L2=s=>e=>Lb(s,e),M2=Mb((s,e)=>[s[0]-e[0],s[1]-e[1]]);function F2(s,e){const t=Eb(s);if(t.empty)return"";const[i,r,n]=t.coord;return Sp([i+e,r,n]).name}var R2={names:S2,get:Eb,name:k2,num:x2,semitones:_2,quality:B2,fromSemitones:C2,distance:E2,invert:T2,simplify:v2,add:Lb,addTo:L2,subtract:M2,transposeFifths:F2};function Mb(s){return(e,t)=>{const i=Bi(e).coord,r=Bi(t).coord;if(i&&r){const n=s(i,r);return Sp(n).name}}}var D2=[["1P 2M 3M 5P 6M","major pentatonic","pentatonic"],["1P 2M 3M 4P 5P 6M 7M","major","ionian"],["1P 2M 3m 4P 5P 6m 7m","minor","aeolian"],["1P 2M 3m 3M 5P 6M","major blues"],["1P 3m 4P 5d 5P 7m","minor blues","blues"],["1P 2M 3m 4P 5P 6M 7M","melodic minor"],["1P 2M 3m 4P 5P 6m 7M","harmonic minor"],["1P 2M 3M 4P 5P 6M 7m 7M","bebop"],["1P 2M 3m 4P 5d 6m 6M 7M","diminished","whole-half diminished"],["1P 2M 3m 4P 5P 6M 7m","dorian"],["1P 2M 3M 4A 5P 6M 7M","lydian"],["1P 2M 3M 4P 5P 6M 7m","mixolydian","dominant"],["1P 2m 3m 4P 5P 6m 7m","phrygian"],["1P 2m 3m 4P 5d 6m 7m","locrian"],["1P 3M 4P 5P 7M","ionian pentatonic"],["1P 3M 4P 5P 7m","mixolydian pentatonic","indian"],["1P 2M 4P 5P 6M","ritusen"],["1P 2M 4P 5P 7m","egyptian"],["1P 3M 4P 5d 7m","neopolitan major pentatonic"],["1P 3m 4P 5P 6m","vietnamese 1"],["1P 2m 3m 5P 6m","pelog"],["1P 2m 4P 5P 6m","kumoijoshi"],["1P 2M 3m 5P 6m","hirajoshi"],["1P 2m 4P 5d 7m","iwato"],["1P 2m 4P 5P 7m","in-sen"],["1P 3M 4A 5P 7M","lydian pentatonic","chinese"],["1P 3m 4P 6m 7m","malkos raga"],["1P 3m 4P 5d 7m","locrian pentatonic","minor seven flat five pentatonic"],["1P 3m 4P 5P 7m","minor pentatonic","vietnamese 2"],["1P 3m 4P 5P 6M","minor six pentatonic"],["1P 2M 3m 5P 6M","flat three pentatonic","kumoi"],["1P 2M 3M 5P 6m","flat six pentatonic"],["1P 2m 3M 5P 6M","scriabin"],["1P 3M 5d 6m 7m","whole tone pentatonic"],["1P 3M 4A 5A 7M","lydian #5P pentatonic"],["1P 3M 4A 5P 7m","lydian dominant pentatonic"],["1P 3m 4P 5P 7M","minor #7M pentatonic"],["1P 3m 4d 5d 7m","super locrian pentatonic"],["1P 2M 3m 4P 5P 7M","minor hexatonic"],["1P 2A 3M 5P 5A 7M","augmented"],["1P 2M 4P 5P 6M 7m","piongio"],["1P 2m 3M 4A 6M 7m","prometheus neopolitan"],["1P 2M 3M 4A 6M 7m","prometheus"],["1P 2m 3M 5d 6m 7m","mystery #1"],["1P 2m 3M 4P 5A 6M","six tone symmetric"],["1P 2M 3M 4A 5A 6A","whole tone","messiaen's mode #1"],["1P 2m 4P 4A 5P 7M","messiaen's mode #5"],["1P 2M 3M 4P 5d 6m 7m","locrian major","arabian"],["1P 2m 3M 4A 5P 6m 7M","double harmonic lydian"],["1P 2m 2A 3M 4A 6m 7m","altered","super locrian","diminished whole tone","pomeroy"],["1P 2M 3m 4P 5d 6m 7m","locrian #2","half-diminished","aeolian b5"],["1P 2M 3M 4P 5P 6m 7m","mixolydian b6","melodic minor fifth mode","hindu"],["1P 2M 3M 4A 5P 6M 7m","lydian dominant","lydian b7","overtone"],["1P 2M 3M 4A 5A 6M 7M","lydian augmented"],["1P 2m 3m 4P 5P 6M 7m","dorian b2","phrygian #6","melodic minor second mode"],["1P 2m 3m 4d 5d 6m 7d","ultralocrian","superlocrian bb7","superlocrian diminished"],["1P 2m 3m 4P 5d 6M 7m","locrian 6","locrian natural 6","locrian sharp 6"],["1P 2A 3M 4P 5P 5A 7M","augmented heptatonic"],["1P 2M 3m 4A 5P 6M 7m","dorian #4","ukrainian dorian","romanian minor","altered dorian"],["1P 2M 3m 4A 5P 6M 7M","lydian diminished"],["1P 2M 3M 4A 5A 7m 7M","leading whole tone"],["1P 2M 3M 4A 5P 6m 7m","lydian minor"],["1P 2m 3M 4P 5P 6m 7m","phrygian dominant","spanish","phrygian major"],["1P 2m 3m 4P 5P 6m 7M","balinese"],["1P 2m 3m 4P 5P 6M 7M","neopolitan major"],["1P 2M 3M 4P 5P 6m 7M","harmonic major"],["1P 2m 3M 4P 5P 6m 7M","double harmonic major","gypsy"],["1P 2M 3m 4A 5P 6m 7M","hungarian minor"],["1P 2A 3M 4A 5P 6M 7m","hungarian major"],["1P 2m 3M 4P 5d 6M 7m","oriental"],["1P 2m 3m 3M 4A 5P 7m","flamenco"],["1P 2m 3m 4A 5P 6m 7M","todi raga"],["1P 2m 3M 4P 5d 6m 7M","persian"],["1P 2m 3M 5d 6m 7m 7M","enigmatic"],["1P 2M 3M 4P 5A 6M 7M","major augmented","major #5","ionian augmented","ionian #5"],["1P 2A 3M 4A 5P 6M 7M","lydian #9"],["1P 2m 2M 4P 4A 5P 6m 7M","messiaen's mode #4"],["1P 2m 3M 4P 4A 5P 6m 7M","purvi raga"],["1P 2m 3m 3M 4P 5P 6m 7m","spanish heptatonic"],["1P 2M 3m 3M 4P 5P 6M 7m","bebop minor"],["1P 2M 3M 4P 5P 5A 6M 7M","bebop major"],["1P 2m 3m 4P 5d 5P 6m 7m","bebop locrian"],["1P 2M 3m 4P 5P 6m 7m 7M","minor bebop"],["1P 2M 3M 4P 5d 5P 6M 7M","ichikosucho"],["1P 2M 3m 4P 5P 6m 6M 7M","minor six diminished"],["1P 2m 3m 3M 4A 5P 6M 7m","half-whole diminished","dominant diminished","messiaen's mode #2"],["1P 3m 3M 4P 5P 6M 7m 7M","kafi raga"],["1P 2M 3M 4P 4A 5A 6A 7M","messiaen's mode #6"],["1P 2M 3m 3M 4P 5d 5P 6M 7m","composite blues"],["1P 2M 3m 3M 4A 5P 6m 7m 7M","messiaen's mode #3"],["1P 2m 2M 3m 4P 4A 5P 6m 6M 7M","messiaen's mode #7"],["1P 2m 2M 3m 3M 4P 5d 5P 6m 6M 7m 7M","chromatic"]],A2=D2,I2={...Cn,intervals:[],aliases:[]},Bp=[],co={};function O2(){return Bp.map(s=>s.name)}function Fb(s){return co[s]||I2}function xp(){return Bp.slice()}function V2(s,e,t=[]){const i={...Qr(s),name:e,intervals:s,aliases:t};return Bp.push(i),co[i.name]=i,co[i.setNum]=i,co[i.chroma]=i,i.aliases.forEach(r=>H2(i,r)),i}function H2(s,e){co[e]=s}A2.forEach(([s,e,...t])=>V2(s.split(" "),e,t));var W2=Math.log(2),z2=Math.log(440);function Rb(s){const e=12*(Math.log(s)-z2)/W2+69;return Math.round(e*100)/100}var G2="C C# D D# E F F# G G# A A# B".split(" "),U2="C Db D Eb E F Gb G Ab A Bb B".split(" ");function Fa(s,e={}){if(isNaN(s)||s===-1/0||s===1/0)return"";s=Math.round(s);const i=(e.sharps===!0?G2:U2)[s%12];if(e.pitchClass)return i;const r=Math.floor(s/12)-1;return i+r}var $2=["C","D","E","F","G","A","B"],Db=s=>s.name,Ab=s=>s.map(zt).filter(e=>!e.empty);function Y2(s){return s===void 0?$2.slice():Array.isArray(s)?Ab(s).map(Db):[]}var Ls=zt,X2=s=>Ls(s).name,Q2=s=>Ls(s).pc,J2=s=>Ls(s).acc,q2=s=>Ls(s).oct,K2=s=>Ls(s).midi,j2=s=>Ls(s).freq,Z2=s=>Ls(s).chroma;function Ib(s){return Fa(s)}function eC(s){return Fa(Rb(s))}function tC(s){return Fa(Rb(s),{sharps:!0})}function iC(s){return Fa(s,{sharps:!0})}var fl=va,sC=va,Ob=s=>e=>fl(e,s),rC=Ob,Vb=s=>e=>fl(s,e),nC=Vb;function Hb(s,e){return fl(s,[e,0])}var aC=Hb;function oC(s,e){return fl(s,[0,e])}var vp=(s,e)=>s.height-e.height,lC=(s,e)=>e.height-s.height;function Wb(s,e){return e=e||vp,Ab(s).sort(e).map(Db)}function zb(s){return Wb(s,vp).filter((e,t,i)=>t===0||e!==i[t-1])}var hC=s=>{const e=Ls(s);return e.empty?"":Fa(e.midi||e.chroma,{sharps:e.alt>0,pitchClass:e.midi===null})};function Gb(s,e){const t=Ls(s);if(t.empty)return"";const i=Ls(e||Fa(t.midi||t.chroma,{sharps:t.alt<0,pitchClass:!0}));if(i.empty||i.chroma!==t.chroma)return"";if(t.oct===void 0)return i.pc;const r=t.chroma-t.alt,n=i.chroma-i.alt,a=r>11||n<0?-1:r<0||n>11?1:0,o=t.oct+a;return i.pc+o}var Vs={names:Y2,get:Ls,name:X2,pitchClass:Q2,accidentals:J2,octave:q2,midi:K2,ascending:vp,descending:lC,sortedNames:Wb,sortedUniqNames:zb,fromMidi:Ib,fromMidiSharps:iC,freq:j2,fromFreq:eC,fromFreqSharps:tC,chroma:Z2,transpose:fl,tr:sC,transposeBy:Ob,trBy:rC,transposeFrom:Vb,trFrom:nC,transposeFifths:Hb,transposeOctaves:oC,trFifths:aC,simplify:hC,enharmonic:Gb},Tp=[[0,2773,0,"ionian","","Maj7","major"],[1,2902,2,"dorian","m","m7"],[2,3418,4,"phrygian","m","m7"],[3,2741,-1,"lydian","","Maj7"],[4,2774,1,"mixolydian","","7"],[5,2906,3,"aeolian","m","m7","minor"],[6,3434,5,"locrian","dim","m7b5"]],vy={...Cn,name:"",alt:0,modeNum:NaN,triad:"",seventh:"",aliases:[]},uC=Tp.map(cC),Gd={};uC.forEach(s=>{Gd[s.name]=s,s.aliases.forEach(e=>{Gd[e]=s})});function Ub(s){return typeof s=="string"?Gd[s.toLowerCase()]||vy:s&&s.name?Ub(s.name):vy}function cC(s){const[e,t,i,r,n,a,o]=s,l=o?[o]:[],h=Number(t).toString(2);return{empty:!1,intervals:Fb(r).intervals,modeNum:e,chroma:h,normalized:h,name:r,setNum:t,alt:i,triad:n,seventh:a,aliases:l}}function $b(s){return(e,t)=>{const i=Ub(e);if(i.empty)return[];const r=dl(i.modeNum,s),n=i.intervals.map(a=>va(t,a));return r.map((a,o)=>n[o]+a)}}$b(Tp.map(s=>s[4]));$b(Tp.map(s=>s[5]));var dC={empty:!0,name:"",type:"",tonic:null,setNum:NaN,chroma:"",normalized:"",aliases:[],notes:[],intervals:[]};function Yb(s){if(typeof s!="string")return["",""];const e=s.indexOf(" "),t=zt(s.substring(0,e));if(t.empty){const r=zt(s);return r.empty?["",s]:[r.name,""]}const i=s.substring(t.name.length+1).toLowerCase();return[t.name,i.length?i:""]}var fC=O2;function qs(s){const e=Array.isArray(s)?s:Yb(s),t=zt(e[0]).name,i=Fb(e[1]);if(i.empty)return dC;const r=i.name,n=t?i.intervals.map(o=>va(t,o)):[],a=t?t+" "+r:r;return{...i,name:a,type:r,tonic:t,notes:n}}var pC=jP("Scale.scale","Scale.get",qs);function gC(s,e={}){const t=a2(s),i=zt(e.tonic??s[0]??""),r=i.chroma;if(r===void 0)return[];const n=t.split("");n[r]="1";const a=dl(r,n).join(""),o=xp().find(h=>h.chroma===a),l=[];return o&&l.push(i.name+" "+o.name),e.match==="exact"||Xb(a).forEach(h=>{l.push(i.name+" "+h)}),l}function mC(s){const e=qs(s),t=Cb(e.chroma);return m2().filter(i=>t(i.chroma)).map(i=>i.aliases[0])}function Xb(s){const e=kp(s)?s:qs(s).chroma,t=u2(e);return xp().filter(i=>t(i.chroma)).map(i=>i.name)}function yC(s){const e=Cb(qs(s).chroma);return xp().filter(t=>e(t.chroma)).map(t=>t.name)}function Qb(s){const e=s.map(r=>zt(r).pc).filter(r=>r),t=e[0],i=zb(e);return dl(i.indexOf(t),i)}function wC(s){const e=qs(s);if(e.empty)return[];const t=e.tonic?e.notes:e.intervals;return h2(e.chroma).map((i,r)=>{const n=qs(i).name;return n?[t[r],n]:["",""]}).filter(i=>i[0])}function bC(s){const e=Array.isArray(s)?Qb(s):qs(s).notes,t=e.map(i=>zt(i).chroma);return i=>{const r=zt(typeof i=="number"?Ib(i):i),n=r.height;if(n===void 0)return;const a=n%12,o=t.indexOf(a);if(o!==-1)return Gb(r.name,e[o])}}function SC(s){const e=bC(s);return(t,i)=>{const r=zt(t).height,n=zt(i).height;return r===void 0||n===void 0?[]:t2(r,n).map(e).filter(a=>a)}}function kC(s){const{intervals:e,tonic:t}=qs(s),i=Tb(e,t);return r=>r?i(r>0?r-1:r):""}function _C(s){const{intervals:e,tonic:t}=qs(s);return Tb(e,t)}var BC={degrees:kC,detect:gC,extended:Xb,get:qs,modeNames:wC,names:fC,rangeOf:SC,reduced:yC,scaleChords:mC,scaleNotes:Qb,steps:_C,tokenize:Yb,scale:pC};function xC(s){return[`\\track "${s.name}" "${s.shortName}"`,"\\staff{score}",s.instrument?`\\instrument "${s.instrument}"`:void 0,`\\tuning ${["C0"].join(" ")}`].filter(e=>e!==void 0)}function Jb(s,e){return[s,bi(e)?void 0:`{ch "${e}"}`].filter(i=>i!==void 0).join(" ")}function vC({duration:s,note:e,label:t}){const r=R2.semitones(Nb("C0",e));return Jb(`${r}.1.${s}`,t)}function TC(s){return Jb(`r.${s.duration}`,s.label)}function NC(s){switch(s.type){case"note":return vC(s);case"rest":return TC(s)}}function Ty(s){return s.items.map(e=>NC(e)).join(" ")}function PC(s){if(s.bars.length===0)return[];const e=[`\\clef ${s.clef}`,`\\ts ${s.timeSignature.top} ${s.timeSignature.bottom}`,`\\ks ${s.keySignature}`].join(" "),[t,...i]=s.bars;return[`${e} ${Ty(t)}`,...i.map(n=>Ty(n))]}function CC(s){const i=[xC(s).join(" "),PC(s).join(`
|`)].join(`
`);return console.log(i),i}function Zt(s){return`Minified Redux error #${s}; visit https://redux.js.org/Errors?code=${s} for the full message or use the non-minified dev environment for full errors. `}var EC=typeof Symbol=="function"&&Symbol.observable||"@@observable",Ny=EC,Tc=()=>Math.random().toString(36).substring(7).split("").join("."),LC={INIT:`@@redux/INIT${Tc()}`,REPLACE:`@@redux/REPLACE${Tc()}`,PROBE_UNKNOWN_ACTION:()=>`@@redux/PROBE_UNKNOWN_ACTION${Tc()}`},zh=LC;function Np(s){if(typeof s!="object"||s===null)return!1;let e=s;for(;Object.getPrototypeOf(e)!==null;)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(s)===e||Object.getPrototypeOf(s)===null}function qb(s,e,t){if(typeof s!="function")throw new Error(Zt(2));if(typeof e=="function"&&typeof t=="function"||typeof t=="function"&&typeof arguments[3]=="function")throw new Error(Zt(0));if(typeof e=="function"&&typeof t>"u"&&(t=e,e=void 0),typeof t<"u"){if(typeof t!="function")throw new Error(Zt(1));return t(qb)(s,e)}let i=s,r=e,n=new Map,a=n,o=0,l=!1;function h(){a===n&&(a=new Map,n.forEach((S,b)=>{a.set(b,S)}))}function u(){if(l)throw new Error(Zt(3));return r}function c(S){if(typeof S!="function")throw new Error(Zt(4));if(l)throw new Error(Zt(5));let b=!0;h();const m=o++;return a.set(m,S),function(){if(b){if(l)throw new Error(Zt(6));b=!1,h(),a.delete(m),n=null}}}function d(S){if(!Np(S))throw new Error(Zt(7));if(typeof S.type>"u")throw new Error(Zt(8));if(typeof S.type!="string")throw new Error(Zt(17));if(l)throw new Error(Zt(9));try{l=!0,r=i(r,S)}finally{l=!1}return(n=a).forEach(m=>{m()}),S}function p(S){if(typeof S!="function")throw new Error(Zt(10));i=S,d({type:zh.REPLACE})}function g(){const S=c;return{subscribe(b){if(typeof b!="object"||b===null)throw new Error(Zt(11));function m(){const B=b;B.next&&B.next(u())}return m(),{unsubscribe:S(m)}},[Ny](){return this}}}return d({type:zh.INIT}),{dispatch:d,subscribe:c,getState:u,replaceReducer:p,[Ny]:g}}function MC(s){Object.keys(s).forEach(e=>{const t=s[e];if(typeof t(void 0,{type:zh.INIT})>"u")throw new Error(Zt(12));if(typeof t(void 0,{type:zh.PROBE_UNKNOWN_ACTION()})>"u")throw new Error(Zt(13))})}function FC(s){const e=Object.keys(s),t={};for(let n=0;n<e.length;n++){const a=e[n];typeof s[a]=="function"&&(t[a]=s[a])}const i=Object.keys(t);let r;try{MC(t)}catch(n){r=n}return function(a={},o){if(r)throw r;let l=!1;const h={};for(let u=0;u<i.length;u++){const c=i[u],d=t[c],p=a[c],g=d(p,o);if(typeof g>"u")throw o&&o.type,new Error(Zt(14));h[c]=g,l=l||g!==p}return l=l||i.length!==Object.keys(a).length,l?h:a}}function Gh(...s){return s.length===0?e=>e:s.length===1?s[0]:s.reduce((e,t)=>(...i)=>e(t(...i)))}function RC(...s){return e=>(t,i)=>{const r=e(t,i);let n=()=>{throw new Error(Zt(15))};const a={getState:r.getState,dispatch:(l,...h)=>n(l,...h)},o=s.map(l=>l(a));return n=Gh(...o)(r.dispatch),{...r,dispatch:n}}}function DC(s){return Np(s)&&"type"in s&&typeof s.type=="string"}var Kb=Symbol.for("immer-nothing"),Py=Symbol.for("immer-draftable"),qi=Symbol.for("immer-state");function Ss(s,...e){throw new Error(`[Immer] minified error nr: ${s}. Full error at: https://bit.ly/3cXEKWf`)}var Ta=Object.getPrototypeOf;function En(s){return!!s&&!!s[qi]}function wr(s){var e;return s?jb(s)||Array.isArray(s)||!!s[Py]||!!((e=s.constructor)!=null&&e[Py])||Eu(s)||Lu(s):!1}var AC=Object.prototype.constructor.toString();function jb(s){if(!s||typeof s!="object")return!1;const e=Ta(s);if(e===null)return!0;const t=Object.hasOwnProperty.call(e,"constructor")&&e.constructor;return t===Object?!0:typeof t=="function"&&Function.toString.call(t)===AC}function Uh(s,e){Cu(s)===0?Reflect.ownKeys(s).forEach(t=>{e(t,s[t],s)}):s.forEach((t,i)=>e(i,t,s))}function Cu(s){const e=s[qi];return e?e.type_:Array.isArray(s)?1:Eu(s)?2:Lu(s)?3:0}function Ud(s,e){return Cu(s)===2?s.has(e):Object.prototype.hasOwnProperty.call(s,e)}function Zb(s,e,t){const i=Cu(s);i===2?s.set(e,t):i===3?s.add(t):s[e]=t}function IC(s,e){return s===e?s!==0||1/s===1/e:s!==s&&e!==e}function Eu(s){return s instanceof Map}function Lu(s){return s instanceof Set}function rn(s){return s.copy_||s.base_}function $d(s,e){if(Eu(s))return new Map(s);if(Lu(s))return new Set(s);if(Array.isArray(s))return Array.prototype.slice.call(s);const t=jb(s);if(e===!0||e==="class_only"&&!t){const i=Object.getOwnPropertyDescriptors(s);delete i[qi];let r=Reflect.ownKeys(i);for(let n=0;n<r.length;n++){const a=r[n],o=i[a];o.writable===!1&&(o.writable=!0,o.configurable=!0),(o.get||o.set)&&(i[a]={configurable:!0,writable:!0,enumerable:o.enumerable,value:s[a]})}return Object.create(Ta(s),i)}else{const i=Ta(s);if(i!==null&&t)return{...s};const r=Object.create(i);return Object.assign(r,s)}}function Pp(s,e=!1){return Mu(s)||En(s)||!wr(s)||(Cu(s)>1&&(s.set=s.add=s.clear=s.delete=OC),Object.freeze(s),e&&Object.entries(s).forEach(([t,i])=>Pp(i,!0))),s}function OC(){Ss(2)}function Mu(s){return Object.isFrozen(s)}var VC={};function Ln(s){const e=VC[s];return e||Ss(0,s),e}var jo;function eS(){return jo}function HC(s,e){return{drafts_:[],parent_:s,immer_:e,canAutoFreeze_:!0,unfinalizedDrafts_:0}}function Cy(s,e){e&&(Ln("Patches"),s.patches_=[],s.inversePatches_=[],s.patchListener_=e)}function Yd(s){Xd(s),s.drafts_.forEach(WC),s.drafts_=null}function Xd(s){s===jo&&(jo=s.parent_)}function Ey(s){return jo=HC(jo,s)}function WC(s){const e=s[qi];e.type_===0||e.type_===1?e.revoke_():e.revoked_=!0}function Ly(s,e){e.unfinalizedDrafts_=e.drafts_.length;const t=e.drafts_[0];return s!==void 0&&s!==t?(t[qi].modified_&&(Yd(e),Ss(4)),wr(s)&&(s=$h(e,s),e.parent_||Yh(e,s)),e.patches_&&Ln("Patches").generateReplacementPatches_(t[qi].base_,s,e.patches_,e.inversePatches_)):s=$h(e,t,[]),Yd(e),e.patches_&&e.patchListener_(e.patches_,e.inversePatches_),s!==Kb?s:void 0}function $h(s,e,t){if(Mu(e))return e;const i=e[qi];if(!i)return Uh(e,(r,n)=>My(s,i,e,r,n,t)),e;if(i.scope_!==s)return e;if(!i.modified_)return Yh(s,i.base_,!0),i.base_;if(!i.finalized_){i.finalized_=!0,i.scope_.unfinalizedDrafts_--;const r=i.copy_;let n=r,a=!1;i.type_===3&&(n=new Set(r),r.clear(),a=!0),Uh(n,(o,l)=>My(s,i,r,o,l,t,a)),Yh(s,r,!1),t&&s.patches_&&Ln("Patches").generatePatches_(i,t,s.patches_,s.inversePatches_)}return i.copy_}function My(s,e,t,i,r,n,a){if(En(r)){const o=n&&e&&e.type_!==3&&!Ud(e.assigned_,i)?n.concat(i):void 0,l=$h(s,r,o);if(Zb(t,i,l),En(l))s.canAutoFreeze_=!1;else return}else a&&t.add(r);if(wr(r)&&!Mu(r)){if(!s.immer_.autoFreeze_&&s.unfinalizedDrafts_<1)return;$h(s,r),(!e||!e.scope_.parent_)&&typeof i!="symbol"&&Object.prototype.propertyIsEnumerable.call(t,i)&&Yh(s,r)}}function Yh(s,e,t=!1){!s.parent_&&s.immer_.autoFreeze_&&s.canAutoFreeze_&&Pp(e,t)}function zC(s,e){const t=Array.isArray(s),i={type_:t?1:0,scope_:e?e.scope_:eS(),modified_:!1,finalized_:!1,assigned_:{},parent_:e,base_:s,draft_:null,copy_:null,revoke_:null,isManual_:!1};let r=i,n=Cp;t&&(r=[i],n=Zo);const{revoke:a,proxy:o}=Proxy.revocable(r,n);return i.draft_=o,i.revoke_=a,o}var Cp={get(s,e){if(e===qi)return s;const t=rn(s);if(!Ud(t,e))return GC(s,t,e);const i=t[e];return s.finalized_||!wr(i)?i:i===Nc(s.base_,e)?(Pc(s),s.copy_[e]=Jd(i,s)):i},has(s,e){return e in rn(s)},ownKeys(s){return Reflect.ownKeys(rn(s))},set(s,e,t){const i=tS(rn(s),e);if(i!=null&&i.set)return i.set.call(s.draft_,t),!0;if(!s.modified_){const r=Nc(rn(s),e),n=r==null?void 0:r[qi];if(n&&n.base_===t)return s.copy_[e]=t,s.assigned_[e]=!1,!0;if(IC(t,r)&&(t!==void 0||Ud(s.base_,e)))return!0;Pc(s),Qd(s)}return s.copy_[e]===t&&(t!==void 0||e in s.copy_)||Number.isNaN(t)&&Number.isNaN(s.copy_[e])||(s.copy_[e]=t,s.assigned_[e]=!0),!0},deleteProperty(s,e){return Nc(s.base_,e)!==void 0||e in s.base_?(s.assigned_[e]=!1,Pc(s),Qd(s)):delete s.assigned_[e],s.copy_&&delete s.copy_[e],!0},getOwnPropertyDescriptor(s,e){const t=rn(s),i=Reflect.getOwnPropertyDescriptor(t,e);return i&&{writable:!0,configurable:s.type_!==1||e!=="length",enumerable:i.enumerable,value:t[e]}},defineProperty(){Ss(11)},getPrototypeOf(s){return Ta(s.base_)},setPrototypeOf(){Ss(12)}},Zo={};Uh(Cp,(s,e)=>{Zo[s]=function(){return arguments[0]=arguments[0][0],e.apply(this,arguments)}});Zo.deleteProperty=function(s,e){return Zo.set.call(this,s,e,void 0)};Zo.set=function(s,e,t){return Cp.set.call(this,s[0],e,t,s[0])};function Nc(s,e){const t=s[qi];return(t?rn(t):s)[e]}function GC(s,e,t){var r;const i=tS(e,t);return i?"value"in i?i.value:(r=i.get)==null?void 0:r.call(s.draft_):void 0}function tS(s,e){if(!(e in s))return;let t=Ta(s);for(;t;){const i=Object.getOwnPropertyDescriptor(t,e);if(i)return i;t=Ta(t)}}function Qd(s){s.modified_||(s.modified_=!0,s.parent_&&Qd(s.parent_))}function Pc(s){s.copy_||(s.copy_=$d(s.base_,s.scope_.immer_.useStrictShallowCopy_))}var UC=class{constructor(s){this.autoFreeze_=!0,this.useStrictShallowCopy_=!1,this.produce=(e,t,i)=>{if(typeof e=="function"&&typeof t!="function"){const n=t;t=e;const a=this;return function(l=n,...h){return a.produce(l,u=>t.call(this,u,...h))}}typeof t!="function"&&Ss(6),i!==void 0&&typeof i!="function"&&Ss(7);let r;if(wr(e)){const n=Ey(this),a=Jd(e,void 0);let o=!0;try{r=t(a),o=!1}finally{o?Yd(n):Xd(n)}return Cy(n,i),Ly(r,n)}else if(!e||typeof e!="object"){if(r=t(e),r===void 0&&(r=e),r===Kb&&(r=void 0),this.autoFreeze_&&Pp(r,!0),i){const n=[],a=[];Ln("Patches").generateReplacementPatches_(e,r,n,a),i(n,a)}return r}else Ss(1,e)},this.produceWithPatches=(e,t)=>{if(typeof e=="function")return(a,...o)=>this.produceWithPatches(a,l=>e(l,...o));let i,r;return[this.produce(e,t,(a,o)=>{i=a,r=o}),i,r]},typeof(s==null?void 0:s.autoFreeze)=="boolean"&&this.setAutoFreeze(s.autoFreeze),typeof(s==null?void 0:s.useStrictShallowCopy)=="boolean"&&this.setUseStrictShallowCopy(s.useStrictShallowCopy)}createDraft(s){wr(s)||Ss(8),En(s)&&(s=$C(s));const e=Ey(this),t=Jd(s,void 0);return t[qi].isManual_=!0,Xd(e),t}finishDraft(s,e){const t=s&&s[qi];(!t||!t.isManual_)&&Ss(9);const{scope_:i}=t;return Cy(i,e),Ly(void 0,i)}setAutoFreeze(s){this.autoFreeze_=s}setUseStrictShallowCopy(s){this.useStrictShallowCopy_=s}applyPatches(s,e){let t;for(t=e.length-1;t>=0;t--){const r=e[t];if(r.path.length===0&&r.op==="replace"){s=r.value;break}}t>-1&&(e=e.slice(t+1));const i=Ln("Patches").applyPatches_;return En(s)?i(s,e):this.produce(s,r=>i(r,e))}};function Jd(s,e){const t=Eu(s)?Ln("MapSet").proxyMap_(s,e):Lu(s)?Ln("MapSet").proxySet_(s,e):zC(s,e);return(e?e.scope_:eS()).drafts_.push(t),t}function $C(s){return En(s)||Ss(10,s),iS(s)}function iS(s){if(!wr(s)||Mu(s))return s;const e=s[qi];let t;if(e){if(!e.modified_)return e.base_;e.finalized_=!0,t=$d(s,e.scope_.immer_.useStrictShallowCopy_)}else t=$d(s,!0);return Uh(t,(i,r)=>{Zb(t,i,iS(r))}),e&&(e.finalized_=!1),t}var Ki=new UC,sS=Ki.produce;Ki.produceWithPatches.bind(Ki);Ki.setAutoFreeze.bind(Ki);Ki.setUseStrictShallowCopy.bind(Ki);Ki.applyPatches.bind(Ki);Ki.createDraft.bind(Ki);Ki.finishDraft.bind(Ki);function YC(s,e=`expected a function, instead received ${typeof s}`){if(typeof s!="function")throw new TypeError(e)}function XC(s,e=`expected an object, instead received ${typeof s}`){if(typeof s!="object")throw new TypeError(e)}function QC(s,e="expected all items to be functions, instead received the following types: "){if(!s.every(t=>typeof t=="function")){const t=s.map(i=>typeof i=="function"?`function ${i.name||"unnamed"}()`:typeof i).join(", ");throw new TypeError(`${e}[${t}]`)}}var Fy=s=>Array.isArray(s)?s:[s];function JC(s){const e=Array.isArray(s[0])?s[0]:s;return QC(e,"createSelector expects all input-selectors to be functions, but received the following types: "),e}function qC(s,e){const t=[],{length:i}=s;for(let r=0;r<i;r++)t.push(s[r].apply(null,e));return t}var KC=class{constructor(s){this.value=s}deref(){return this.value}},jC=typeof WeakRef<"u"?WeakRef:KC,ZC=0,Ry=1;function Il(){return{s:ZC,v:void 0,o:null,p:null}}function rS(s,e={}){let t=Il();const{resultEqualityCheck:i}=e;let r,n=0;function a(){var c;let o=t;const{length:l}=arguments;for(let d=0,p=l;d<p;d++){const g=arguments[d];if(typeof g=="function"||typeof g=="object"&&g!==null){let w=o.o;w===null&&(o.o=w=new WeakMap);const S=w.get(g);S===void 0?(o=Il(),w.set(g,o)):o=S}else{let w=o.p;w===null&&(o.p=w=new Map);const S=w.get(g);S===void 0?(o=Il(),w.set(g,o)):o=S}}const h=o;let u;if(o.s===Ry)u=o.v;else if(u=s.apply(null,arguments),n++,i){const d=((c=r==null?void 0:r.deref)==null?void 0:c.call(r))??r;d!=null&&i(d,u)&&(u=d,n!==0&&n--),r=typeof u=="object"&&u!==null||typeof u=="function"?new jC(u):u}return h.s=Ry,h.v=u,u}return a.clearCache=()=>{t=Il(),a.resetResultsCount()},a.resultsCount=()=>n,a.resetResultsCount=()=>{n=0},a}function eE(s,...e){const t=typeof s=="function"?{memoize:s,memoizeOptions:e}:s,i=(...r)=>{let n=0,a=0,o,l={},h=r.pop();typeof h=="object"&&(l=h,h=r.pop()),YC(h,`createSelector expects an output function after the inputs, but received: [${typeof h}]`);const u={...t,...l},{memoize:c,memoizeOptions:d=[],argsMemoize:p=rS,argsMemoizeOptions:g=[],devModeChecks:w={}}=u,S=Fy(d),b=Fy(g),m=JC(r),y=c(function(){return n++,h.apply(null,arguments)},...S),B=p(function(){a++;const P=qC(m,arguments);return o=y.apply(null,P),o},...b);return Object.assign(B,{resultFunc:h,memoizedResultFunc:y,dependencies:m,dependencyRecomputations:()=>a,resetDependencyRecomputations:()=>{a=0},lastResult:()=>o,recomputations:()=>n,resetRecomputations:()=>{n=0},memoize:c,argsMemoize:p})};return Object.assign(i,{withTypes:()=>i}),i}var Ep=eE(rS),tE=Object.assign((s,e=Ep)=>{XC(s,`createStructuredSelector expects first argument to be an object where each property is a selector, instead received a ${typeof s}`);const t=Object.keys(s),i=t.map(n=>s[n]);return e(i,(...n)=>n.reduce((a,o,l)=>(a[t[l]]=o,a),{}))},{withTypes:()=>tE});function nS(s){return({dispatch:t,getState:i})=>r=>n=>typeof n=="function"?n(t,i,s):r(n)}var iE=nS(),sE=nS,rE=typeof window<"u"&&window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__?window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__:function(){if(arguments.length!==0)return typeof arguments[0]=="object"?Gh:Gh.apply(null,arguments)};function Dy(s,e){function t(...i){if(e){let r=e(...i);if(!r)throw new Error(Ns(0));return{type:s,payload:r.payload,..."meta"in r&&{meta:r.meta},..."error"in r&&{error:r.error}}}return{type:s,payload:i[0]}}return t.toString=()=>`${s}`,t.type=s,t.match=i=>DC(i)&&i.type===s,t}var aS=class qa extends Array{constructor(...e){super(...e),Object.setPrototypeOf(this,qa.prototype)}static get[Symbol.species](){return qa}concat(...e){return super.concat.apply(this,e)}prepend(...e){return e.length===1&&Array.isArray(e[0])?new qa(...e[0].concat(this)):new qa(...e.concat(this))}};function Ay(s){return wr(s)?sS(s,()=>{}):s}function Iy(s,e,t){if(s.has(e)){let r=s.get(e);return t.update&&(r=t.update(r,e,s),s.set(e,r)),r}if(!t.insert)throw new Error(Ns(10));const i=t.insert(e,s);return s.set(e,i),i}function nE(s){return typeof s=="boolean"}var aE=()=>function(e){const{thunk:t=!0,immutableCheck:i=!0,serializableCheck:r=!0,actionCreatorCheck:n=!0}=e??{};let a=new aS;return t&&(nE(t)?a.push(iE):a.push(sE(t.extraArgument))),a},oE="RTK_autoBatch",oS=s=>e=>{setTimeout(e,s)},lE=typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame:oS(10),hE=(s={type:"raf"})=>e=>(...t)=>{const i=e(...t);let r=!0,n=!1,a=!1;const o=new Set,l=s.type==="tick"?queueMicrotask:s.type==="raf"?lE:s.type==="callback"?s.queueNotification:oS(s.timeout),h=()=>{a=!1,n&&(n=!1,o.forEach(u=>u()))};return Object.assign({},i,{subscribe(u){const c=()=>r&&u(),d=i.subscribe(c);return o.add(u),()=>{d(),o.delete(u)}},dispatch(u){var c;try{return r=!((c=u==null?void 0:u.meta)!=null&&c[oE]),n=!r,n&&(a||(a=!0,l(h))),i.dispatch(u)}finally{r=!0}}})},uE=s=>function(t){const{autoBatch:i=!0}=t??{};let r=new aS(s);return i&&r.push(hE(typeof i=="object"?i:void 0)),r};function cE(s){const e=aE(),{reducer:t=void 0,middleware:i,devTools:r=!0,preloadedState:n=void 0,enhancers:a=void 0}=s||{};let o;if(typeof t=="function")o=t;else if(Np(t))o=FC(t);else throw new Error(Ns(1));let l;typeof i=="function"?l=i(e):l=e();let h=Gh;r&&(h=rE({trace:!1,...typeof r=="object"&&r}));const u=RC(...l),c=uE(u);let d=typeof a=="function"?a(c):c();const p=h(...d);return qb(o,n,p)}function lS(s){const e={},t=[];let i;const r={addCase(n,a){const o=typeof n=="string"?n:n.type;if(!o)throw new Error(Ns(28));if(o in e)throw new Error(Ns(29));return e[o]=a,r},addMatcher(n,a){return t.push({matcher:n,reducer:a}),r},addDefaultCase(n){return i=n,r}};return s(r),[e,t,i]}function dE(s){return typeof s=="function"}function fE(s,e){let[t,i,r]=lS(e),n;if(dE(s))n=()=>Ay(s());else{const o=Ay(s);n=()=>o}function a(o=n(),l){let h=[t[l.type],...i.filter(({matcher:u})=>u(l)).map(({reducer:u})=>u)];return h.filter(u=>!!u).length===0&&(h=[r]),h.reduce((u,c)=>{if(c)if(En(u)){const p=c(u,l);return p===void 0?u:p}else{if(wr(u))return sS(u,d=>c(d,l));{const d=c(u,l);if(d===void 0){if(u===null)return u;throw new Error(Ns(9))}return d}}return u},o)}return a.getInitialState=n,a}var pE=Symbol.for("rtk-slice-createasyncthunk");function gE(s,e){return`${s}/${e}`}function mE({creators:s}={}){var t;const e=(t=s==null?void 0:s.asyncThunk)==null?void 0:t[pE];return function(r){const{name:n,reducerPath:a=n}=r;if(!n)throw new Error(Ns(11));typeof process<"u";const o=(typeof r.reducers=="function"?r.reducers(wE()):r.reducers)||{},l=Object.keys(o),h={sliceCaseReducersByName:{},sliceCaseReducersByType:{},actionCreators:{},sliceMatchers:[]},u={addCase(y,B){const _=typeof y=="string"?y:y.type;if(!_)throw new Error(Ns(12));if(_ in h.sliceCaseReducersByType)throw new Error(Ns(13));return h.sliceCaseReducersByType[_]=B,u},addMatcher(y,B){return h.sliceMatchers.push({matcher:y,reducer:B}),u},exposeAction(y,B){return h.actionCreators[y]=B,u},exposeCaseReducer(y,B){return h.sliceCaseReducersByName[y]=B,u}};l.forEach(y=>{const B=o[y],_={reducerName:y,type:gE(n,y),createNotation:typeof r.reducers=="function"};SE(B)?_E(_,B,u,e):bE(_,B,u)});function c(){const[y={},B=[],_=void 0]=typeof r.extraReducers=="function"?lS(r.extraReducers):[r.extraReducers],P={...y,...h.sliceCaseReducersByType};return fE(r.initialState,N=>{for(let D in P)N.addCase(D,P[D]);for(let D of h.sliceMatchers)N.addMatcher(D.matcher,D.reducer);for(let D of B)N.addMatcher(D.matcher,D.reducer);_&&N.addDefaultCase(_)})}const d=y=>y,p=new Map;let g;function w(y,B){return g||(g=c()),g(y,B)}function S(){return g||(g=c()),g.getInitialState()}function b(y,B=!1){function _(N){let D=N[y];return typeof D>"u"&&B&&(D=S()),D}function P(N=d){const D=Iy(p,B,{insert:()=>new WeakMap});return Iy(D,N,{insert:()=>{const Q={};for(const[J,ge]of Object.entries(r.selectors??{}))Q[J]=yE(ge,N,S,B);return Q}})}return{reducerPath:y,getSelectors:P,get selectors(){return P(_)},selectSlice:_}}const m={name:n,reducer:w,actions:h.actionCreators,caseReducers:h.sliceCaseReducersByName,getInitialState:S,...b(a),injectInto(y,{reducerPath:B,..._}={}){const P=B??a;return y.inject({reducerPath:P,reducer:w},_),{...m,...b(P,!0)}}};return m}}function yE(s,e,t,i){function r(n,...a){let o=e(n);return typeof o>"u"&&i&&(o=t()),s(o,...a)}return r.unwrapped=s,r}var Fu=mE();function wE(){function s(e,t){return{_reducerDefinitionType:"asyncThunk",payloadCreator:e,...t}}return s.withTypes=()=>s,{reducer(e){return Object.assign({[e.name](...t){return e(...t)}}[e.name],{_reducerDefinitionType:"reducer"})},preparedReducer(e,t){return{_reducerDefinitionType:"reducerWithPrepare",prepare:e,reducer:t}},asyncThunk:s}}function bE({type:s,reducerName:e,createNotation:t},i,r){let n,a;if("reducer"in i){if(t&&!kE(i))throw new Error(Ns(17));n=i.reducer,a=i.prepare}else n=i;r.addCase(s,n).exposeCaseReducer(e,n).exposeAction(e,a?Dy(s,a):Dy(s))}function SE(s){return s._reducerDefinitionType==="asyncThunk"}function kE(s){return s._reducerDefinitionType==="reducerWithPrepare"}function _E({type:s,reducerName:e},t,i,r){if(!r)throw new Error(Ns(18));const{payloadCreator:n,fulfilled:a,pending:o,rejected:l,settled:h,options:u}=t,c=r(s,n,u);i.exposeAction(e,c),a&&i.addCase(c.fulfilled,a),o&&i.addCase(c.pending,o),l&&i.addCase(c.rejected,l),h&&i.addMatcher(c.settled,h),i.exposeCaseReducer(e,{fulfilled:a||Ol,pending:o||Ol,rejected:l||Ol,settled:h||Ol})}function Ol(){}function Ns(s){return`Minified Redux Toolkit error #${s}; visit https://redux-toolkit.js.org/Errors?code=${s} for the full message or use the non-minified dev environment for full errors. `}const Na={player:{isLooping:!1,metronomeVolume:0,instrumentVolume:.5},generator:{type:"WHOLE_NOTES",barCount:4,keySignature:di.C_MAJOR_A_MINOR,clef:Ko.TREBLE},display:{showNoteNames:!1},melody:[]},Lp=Fu({name:"generator",initialState:Na.generator,reducers:{setGeneratorConfig:(s,{payload:e})=>e},selectors:{getGeneratorConfig:s=>s}}),BE=bp(fn(Fr.WHOLE,"RANDOM")),xE=bp(fn(Fr.WHOLE,"RANDOM"),fn(Fr.HALF,"RANDOM")),vE=bp(fn(Fr.QUARTER,"RANDOM"),fn(Fr.QUARTER,"RANDOM"),fn(Fr.QUARTER,"RANDOM"),fn(Fr.QUARTER,"RANDOM"));function TE(s){switch(s){case"WHOLE_NOTES":return[BE];case"HALF_NOTES":return[xE];case"QUARTER_NOTES":return[vE];case"MELODY":return[]}}const NE={[di.C_MAJOR_A_MINOR]:"C major",[di.G_MAJOR_E_MINOR_1_SHARP]:"G major",[di.D_MAJOR_B_MINOR_2_SHARPS]:"D major",[di.A_MAJOR_F_SHARP_MINOR_3_SHARPS]:"A major",[di.E_MAJOR_C_SHARP_MINOR_4_SHARPS]:"E major",[di.B_MAJOR_G_SHARP_MINOR_5_SHARPS]:"B major",[di.F_SHARP_MAJOR_D_SHARP_MINOR_6_SHARPS]:"F# major",[di.C_SHARP_MAJOR_A_SHARP_MINOR_7_SHARPS]:"C# major",[di.F_MAJOR_D_MINOR_1_FLAT]:"F major",[di.Bb_MAJOR_G_MINOR_2_FLATS]:"Bb major",[di.Eb_MAJOR_C_MINOR_2_FLATS]:"Eb major",[di.Ab_MAJOR_F_MINOR_4_FLATS]:"Ab major",[di.Db_MAJOR_Bb_MINOR_5_FLATS]:"Db major",[di.Gb_MAJOR_Eb_MINOR_6_FLATS]:"Gb major"};function PE(s){switch(s){case Ko.BASS:return["E2","G4"];case Ko.TREBLE:return["E6","E3"]}}function CE(s,e,t){const i=NE[s],r=BC.get(i).notes,n=Vs.midi(e),a=Vs.midi(t);if(bi(n)||bi(a))throw new Error("Invalid low or high note");const o=[];for(let l=n;l<=a;l++){const h=Vs.fromMidi(l),u=Vs.pitchClass(h),c=Vs.enharmonic(h),d=Vs.pitchClass(c);r.includes(u)&&o.push(h),c!==h&&r.includes(d)&&o.push(c)}return o}function EE(s,e,t,i,r){if(r.type==="rest")return{type:"rest",duration:r.duration};const n=s.indexOf(i),{duration:a,steps:o,shift:l}=r;switch(o){case"RANDOM_SCALE":{const h=hy(Math.max(0,n-8),Math.min(s.length-1,n+8)),u=s[h];return{type:"note",duration:a,note:u}}case"RANDOM":{const h=Vs.midi(i),u=Vs.midi(e),c=Vs.midi(t);if(bi(h)||bi(u)||bi(c))throw new Error("Invalid note input");const d=Math.max(u,h-12),p=Math.min(c,h+12),g=Vs.fromMidi(hy(d,p));return{type:"note",duration:a,note:g}}default:{const h=n+o,u=s[h];return{type:"note",duration:a,note:u}}}}function LE(s,e,t){return t.items.every(i=>{if(i.type==="rest"||i.steps==="RANDOM"||i.steps==="RANDOM_SCALE")return!0;const r=s.indexOf(e)+i.steps;return r>=0&&r<s.length-1})}function ME(s,e,t,i,r){const n=[];let a=i;for(const o of r.items){const l=EE(s,e,t,a,o);l.type==="note"&&(a=l.note),n.push(l)}return{items:n}}function FE(s){return s.items.filter(e=>e.type==="note").pop().note}function RE(s,e,t,i){const[r,n]=PE(i),a=TE(s),o=CE(t,r,n);let l=ly(o);const h=[];for(let u=0;u<e;u+=1){const c=a.filter(p=>LE(o,l,p)),d=ME(o,r,n,l,ly(c));l=FE(d),h.push(d)}return h}const hS=Fu({name:"display",initialState:Na.display,reducers:{setDisplayConfig:(s,{payload:e})=>e},selectors:{getDisplayConfig:s=>s}}),uS=Fu({name:"melody",initialState:Na.melody,reducers:{updateDisplayConfig:(s,{payload:e})=>e},extraReducers:s=>{s.addCase(Lp.actions.setGeneratorConfig,(e,{payload:{barCount:t,clef:i,keySignature:r,type:n}})=>RE(n,t,r,i)),s.addCase(hS.actions.setDisplayConfig,(e,{payload:{showNoteNames:t}})=>{for(const i of e)for(const r of i.items)r.type==="note"&&(r.label=t?r.note:void 0)})},selectors:{getMelody:s=>s}}),DE=Ep([Lp.selectors.getGeneratorConfig,uS.selectors.getMelody],({clef:s,keySignature:e},t)=>({clef:s,keySignature:e,bars:t,instrument:s===Ko.BASS?"AcousticBass":"AcousticGuitarSteel",name:"A Random Melody",shortName:"ex",timeSignature:{bottom:4,top:4}})),AE=Ep([DE],s=>CC(s)),cS=Fu({name:"player",initialState:Na.player,reducers:{setPlayerConfig:(s,{payload:e})=>e},selectors:{getPlayerConfig:s=>s}}),IE=wt`
  //.at-wrap
  width: 100vw;
  height: 100vh;
  margin: 0 auto;
  border: 1px solid rgba(0, 0, 0, 0.12);
  display: flex;
  flex-direction: column;
  overflow: hidden;
  position: relative;
`,OE=wt`
  // .at-content
  position: relative;
  overflow: hidden;
  flex: 1 1 auto;
`,VE=wt`
  // .at-viewport
  overflow-y: auto;
  position: absolute;
  top: 0px;
  left: 0px;
  right: 0px;
  bottom: 0px;
  padding: 20px;
`,HE=()=>{const[s,e]=be.useState(),[t,i]=be.useState(),r=be.useCallback(B=>{e(B??void 0)},[]),n=be.useCallback(B=>{i(B??void 0)},[]),a=my(AE),{isLooping:o,instrumentVolume:l,metronomeVolume:h}=my(cS.selectors.getPlayerConfig),u=120,c=()=>b==null?void 0:b.playPause(),d=()=>{},p=()=>{},g=()=>{},w=()=>{},S=()=>{},{api:b,isPlaying:m,isLoading:y}=NN({tex:a,instrumentVolume:l,metronomeVolume:h,isLooping:o,root:t,scrollArea:s,bpm:u});return ve.jsxs("div",{className:IE,children:[ve.jsx(Qx,{isVisible:y}),ve.jsx("div",{className:OE,children:ve.jsx("div",{className:VE,ref:r,children:ve.jsx("div",{className:"at-main",ref:n})})}),ve.jsx(uP,{bpm:u,isPlaying:m,isLooping:o,instrumentVolume:l,metronomeVolume:h,onLoop:d,onStop:p,onPlayPause:c,onTempoChange:S,onInstrumentVolumeChange:g,onMetronomeVolumeChange:w})]})},dS="stick-app-data";function WE(s){try{localStorage.setItem(dS,JSON.stringify(s))}catch(e){console.error("Could not save state",e)}}function zE(){try{const s=localStorage.getItem(dS);return s===null?Na:JSON.parse(s)}catch(s){return console.error("Could not load state",s),Na}}const GE=s=>e=>t=>{const i=e(t);return WE(s.getState()),i},UE=cE({reducer:{player:cS.reducer,generator:Lp.reducer,display:hS.reducer,melody:uS.reducer},middleware:s=>s().concat(GE),preloadedState:zE()});K1(document.getElementById("root")).render(ve.jsx(MP,{store:UE,children:ve.jsxs(JB,{children:[ve.jsx(AB,{styles:Vx}),ve.jsx(cx,{i18n:Ox,children:ve.jsx(HE,{})})]})}));
